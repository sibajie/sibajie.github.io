<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>解决500 OOPS cannot change directory/root</title>
    <url>/2012/09/03/1000/</url>
    <content><![CDATA[<p>1、查看 SELinux 的状态:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">sestatus -b <span class="string">| grep ftp</span></span><br></pre></td></tr></table></figure>

<p>确切地说,只是查看了ftp的状态.</p>
<p>2、在出现的结果中可以看到:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ftp_home_dir</span>          <span class="literal">off</span></span><br><span class="line">tftpd_disable_trans   <span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>之类.我们现在只要把其中之一设置为on就可以啦.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">setsebool</span> -P ftpd_disable_trans <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">setsebool</span> -P ftp_home_dir <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>3、重启vsftpd:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service vsftpd restart</span></span><br></pre></td></tr></table></figure>

<p>4、 慢慢享受ftp带来的乐趣.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error C++ preprocessor &quot;/lib/cpp&quot; fails sanity check</title>
    <url>/2013/06/21/1002/</url>
    <content><![CDATA[<p>我用的是RHEL5.0,所以,安装以下两个包就行:</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">[root@localhost Server]$ rpm -ivh libstdc++-devel<span class="number">-4.1</span><span class="number">.1</span><span class="number">-52.</span>el5.i386.rpm</span><br><span class="line">warning: libstdc++-devel<span class="number">-4.1</span><span class="number">.1</span><span class="number">-52.</span>el5.i386.rpm: Header V3 DSA signature: NOKEY, key ID <span class="number">37017186</span></span><br><span class="line">Preparing...                ########################################### [<span class="number">100</span>%]</span><br><span class="line">   <span class="number">1</span>:libstdc++-devel        ########################################### [<span class="number">100</span>%]</span><br><span class="line">[root@localhost Server]$ rpm -ivh gcc-c++<span class="number">-4.1</span><span class="number">.1</span><span class="number">-52.</span>el5.i386.rpm</span><br><span class="line">warning: gcc-c++<span class="number">-4.1</span><span class="number">.1</span><span class="number">-52.</span>el5.i386.rpm: Header V3 DSA signature: NOKEY, key ID <span class="number">37017186</span></span><br><span class="line">Preparing...                ########################################### [<span class="number">100</span>%]</span><br><span class="line">   <span class="number">1</span>:gcc-c++                ########################################### [<span class="number">100</span>%]</span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ yum <span class="keyword">install</span> glibc-headers</span><br><span class="line">$ yum <span class="keyword">install</span> gcc-c++</span><br></pre></td></tr></table></figure>

<p>如果是ubuntu系统:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> sudo aptitude install <span class="built_in">build-essential</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决/usr/bin/ld cannot find -lexpat</title>
    <url>/2017/02/09/1001/</url>
    <content><![CDATA[<p>编译安装svn报:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;/usr/bin/ld: cannot find -lexpat&quot;</span></span><br></pre></td></tr></table></figure>

<p>因为系统缺少expat包,需要安装expat包.<br>执行yum命令进行安装.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> expat-devel</span><br></pre></td></tr></table></figure>

<p>安装好之后再进行编译执行make和make install就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>svn Can&#39;t open file &#39;/opt/svn/db/txn-current-lock&#39; Permission denied</title>
    <url>/2016/01/09/1003/</url>
    <content><![CDATA[<p>错误提示:</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">Can<span class="symbol">&#x27;t</span> <span class="keyword">open</span> <span class="keyword">file</span> <span class="symbol">&#x27;XXXXXXXXdbtxn</span>-current-lock&#x27;: 拒绝访问.</span><br><span class="line">Error1: Can<span class="symbol">&#x27;t</span> <span class="keyword">open</span> <span class="symbol">&#x27;db</span>/txn-current-lock&#x27;: Permission denied</span><br></pre></td></tr></table></figure>

<p>解决方法:给svn目录添加读写权限.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">LINUX :#chmod –R o+rw <span class="regexp">/home/</span>svn</span><br><span class="line">windows :属性中操作一下,添加对应的用户,然后设置上权限.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决安装ubuntu时卡在&quot;正在探测文件系统&quot;</title>
    <url>/2019/02/01/1004/</url>
    <content><![CDATA[<p>安装前如果是硬盘安装就打开终端,输入:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sudo umount -l <span class="string">/isodevice</span></span><br></pre></td></tr></table></figure>

<p>如果是光盘安装就打开终端,输入:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sudo umount -l <span class="string">/cdrom</span></span><br></pre></td></tr></table></figure>

<p>可以解决这个问题.</p>
]]></content>
  </entry>
  <entry>
    <title>/etc/issue /etc/motd 登陆信息显示</title>
    <url>/2013/11/10/1005/</url>
    <content><![CDATA[<p>登陆信息显示数据 : <code>/etc/issue</code> 和 <code>/etc/motd</code><br>还记得我们登陆终端机的时候,会有几行提示的字符串.<br>这些设置是在 <code>/etc/issue</code>里面.<br>这些都是我们可以自己设置.<br>我们可以使用Vi来打开.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/i</span>ssue</span><br></pre></td></tr></table></figure>

<p>一般的设置都是只有:Kernel r on an m<br>这些r m是代表什么呢?</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">d</span>    本地端时间的日期</span><br><span class="line"><span class="attribute">l</span>    显示第几个终端机的接口;</span><br><span class="line"><span class="attribute">m</span>    显示硬件的等级(i<span class="number">386</span>/i<span class="number">486</span>/i<span class="number">586</span>/i<span class="number">686</span>....)</span><br><span class="line"><span class="attribute">n</span>    显示主机的网络名称</span><br><span class="line"><span class="attribute">o</span>    显示 domain name</span><br><span class="line"><span class="attribute">r</span>    操作系统的版本 (类似 uname-r)</span><br><span class="line"><span class="attribute">t</span>    显示本地端时间的时间</span><br><span class="line"><span class="attribute">s</span>    操作系统的名称</span><br><span class="line"><span class="attribute">v</span>    操作系统的版本</span><br></pre></td></tr></table></figure>

<p>比如,我进行想设置一下本地端的时间<br>我们可以先vi打开 <code>/etc/issue</code> 或 <code>/etc/motd</code><br>然后按”I”编辑. 然后写入:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">date</span>: d</span><br></pre></td></tr></table></figure>

<p>然后 wq保存.<br>之后呢大家就可以exit退出.重新登陆一下.看看我们设置的有没有成功.<br>那现在我们又有一个需求.<br>比如说,我们的服务器要在2010年8月31日10点开始维护.需要通知给其他的登陆者.<br>这个时候我们需要怎么办呢? 这里就用到了 <code>/etc/motd</code>了.<br>只要把你想说的通知写在这里,那么当别的用户登陆的时候都会提示他.</p>
]]></content>
  </entry>
  <entry>
    <title>关掉RHEL/CentOS的rpc.statd服务</title>
    <url>/2017/08/23/1006/</url>
    <content><![CDATA[<p>rpc.statd占用了一些端口,如果要关闭该服务占用的端口,可以用以下命令完成.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">service nfslock stop</span><br></pre></td></tr></table></figure>

<p>为了不让下次自动启动,那就执行下面的命令:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> nfslock <span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>停止rpcbind服务的命令.</p>
]]></content>
  </entry>
  <entry>
    <title>解决&quot;configure error OpenSSL Crypto headers not found&quot;</title>
    <url>/2012/07/03/1009/</url>
    <content><![CDATA[<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>就可以了,原因就是么有安装openssl.</p>
]]></content>
  </entry>
  <entry>
    <title>解决安装memcache出现configure error libevent is required. If it&#39;s already installed, specify its path using --with-libevent=/dir/</title>
    <url>/2013/08/26/1007/</url>
    <content><![CDATA[<p>这里要安装memcached．但在编译的时候提示需要指定libevent库,可是在安装lnmp的候默认是已经安装过的．解决办法如下:<br>memcached需要libevent支持,所以首先安装libevent.<br>查看系统是否已经安装libevent.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ rpm -<span class="keyword">qa</span>|<span class="keyword">grep</span> libevent</span><br></pre></td></tr></table></figure>

<p>如果有,不要高兴,先升级.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ yum -y <span class="keyword">install</span> libevent</span><br></pre></td></tr></table></figure>

<p>测试libevent是不是已经安装成功.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ ls -al <span class="regexp">/usr/</span>lib | <span class="keyword">grep</span> libevent</span><br></pre></td></tr></table></figure>

<p>可以看到多个已经安装的类包安装memcached.<br>可以先查看编译参数.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget http://memcached.googlecode.com/files/memcached-1.4.8.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar zxvf memcached-1.4.8.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> memcached-1.4.8</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --<span class="built_in">help</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/memcached</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br></pre></td></tr></table></figure>

<p>在这个时候,不一定会编译通过,依旧会出现:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">checking <span class="keyword">for</span> libevent <span class="built_in">directory</span>... configure: error: libevent is required. You can <span class="built_in">get</span> <span class="keyword">it</span> <span class="built_in">from</span> <span class="keyword">http</span>://www.monkey.org/~provos/libevent/</span><br><span class="line">If <span class="keyword">it</span><span class="string">&#x27;s already installed, specify its path using --with-libevent=/dir/</span></span><br></pre></td></tr></table></figure>

<p>因为libevent 这个包是系统默认安装的,没有安装相应的开发所用的头文件.<br>所以,还要使用如下命令来安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libevent-devel</span><br></pre></td></tr></table></figure>

<p>再编辑,即可通过.<br>启用Memcached,</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/memcached/</span>bin/memcached -d -m <span class="number">128</span> -l <span class="number">192.168</span>.<span class="number">1.1</span> -p <span class="number">11211</span> -u root</span><br></pre></td></tr></table></figure>

<p>memcached 启动报error while loading shared libraries: libevent-1.4.s解决办法:<br>原因是找不到libevent-1.4.so.2类库,解决办法如下:<br>使用LD_DEBUG=help ./memcached -v来确定 加载的类库路径,方法如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ln</span> -s /usr/local/lib/libevent-<span class="number">1</span>.<span class="number">4</span>.so.<span class="number">2</span> /lib/libevent-<span class="number">1</span>.<span class="number">4</span>.so.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>貌似用ldconfig也能解决问题.</p>
]]></content>
  </entry>
  <entry>
    <title>MySql5.0 修复Table错误is marked as crashed and last (automatic?)</title>
    <url>/2015/10/12/1008/</url>
    <content><![CDATA[<p>今天公司网站的cms_session表又坏了,保存不了session了,登陆不了! 日志查看了一下,N多错误! 靠靠靠!<br>查了N多资料, 发现这篇BLOG 写的蛮详细的,COPY过来!<br>最后我解决的方法是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">myisamchk -f -o ..<span class="regexp">/data/</span>database1/cms_session.MYI</span><br></pre></td></tr></table></figure>

<p>以下是 网友的BLOG详细资料!<br>我的网站出问题了,访问一看,果然全屏报错,检查mysql日志,错误信息为:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">Table <span class="string">&quot;.dedecmsv4dede_archives&quot;</span> is marked as crashed <span class="keyword">and </span><span class="keyword">should </span><span class="keyword">be </span>repaired</span><br></pre></td></tr></table></figure>

<p>提示说cms的文章表dede_archives被标记有问题,需要修复.于是赶快恢复历史数据,上网查找原因.最终将问题解决.解决方法如下:<br>找到mysql的安装目录的 <code>bin/myisamchk</code>工具,在命令行中输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">myisamchk -c -r ..<span class="regexp">/data/</span>dedecmsv4/dede_archives.MYI</span><br></pre></td></tr></table></figure>

<p>然后myisamchk 工具会帮助你恢复数据表的索引.重新启动mysql,问题解决.<br>问题分析:<br>1、错误产生原因,有网友说是频繁查询和更新dede_archives表造成的索引错误,因为我的页面没有静态生成,而是动态页面,因此比较同意 这种说法.还有说法为是MYSQL数据库因为某种原因而受到了损坏,如:数据库服务器突发性的断电、在提在数据库表提供服务时对表的原文件进行某种操作都 有可能导致MYSQL数据库表被损坏而无法读取数据.总之就是因为某些不可测的问题造成表的损坏.问题的编号为145.<br>2、问题解决办法.<br>当你试图修复一个被破坏的表的问题时,有三种修复类型.如果你得到一个错误信息指出一个临时文件不能建立,删除信息所指出的文件并再试一次–这通常是上一次修复操作遗留下来的.<br>这三种修复方法如下所示:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">% myisamchk <span class="params">--recover</span> <span class="params">--quick</span> <span class="string">/path/to/tblName</span></span><br><span class="line">% myisamchk <span class="params">--recover</span> <span class="string">/path/to/tblName</span></span><br><span class="line">% myisamchk <span class="params">--safe-recover</span> <span class="string">/path/to/tblName</span></span><br></pre></td></tr></table></figure>

<p>第一种是最快的,用来修复最普通的问题;而最后一种是最慢的,用来修复一些其它方法所不能修复的问题.<br>检查和修复MySQL数据文件<br>如果上面的方法无法修复一个被损坏的表,在你放弃之前,你还可以试试下面这两个技巧:<br>如果你怀疑表的 索引文件(<em>.MYI)发生了不可修复的错误,甚至是丢失了这个文件,你可以使用数据文件(</em>.MYD)和数据格式文件(*.frm)重新生成它.首先制 作一个数据文件(tblName.MYD)的拷贝.重启你的MySQL服务并连接到这个服务上,使用下面的命令删除表的内容:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> tblName;</span><br></pre></td></tr></table></figure>

<p>在 删除表的内容的同时,会建立一个新的索引文件.退出登录并重新关闭服务,然后用你刚才保存的数据文件(tblName.MYD)覆盖新的(空)数据文件. 最后,使用myisamchk执行标准的修复(上面的第二种方法),根据表的数据的内容和表的格式文件重新生成索引数据.<br>如果你的表的格式文件(tblName.frm)丢失了或者是发生了不可修复的错误,但是你清楚如何使用相应的CREATE TABLE语句来重新生成这张表,你可以重新生成一个新的.frm文件并和你的数据文件和索引文件(如果索引文件有问题,使用上面的方法重建一个新的)一 起使用.首先制作一个数据和索引文件的拷贝,然后删除原来的文件(删除数据目录下有关这个表的所有记录).<br>启动MySQL服务并使用当初的CREATE TABLE文件建立一个新的表.新的.frm文件应该可以正常工作了,但是最好你还是执行一下标准的修复(上面的第二种方法).<br>3、myisamchk工具介绍(见mysql的官方手册)<br>可以使用myisamchk实用程序来获得有关数据库表的信息或检查、修复、优化他们.myisamchk适用MyISAM表(对应.MYI和.MYD文件的表).<br>调用myisamchk的方法:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shell</span>&gt; myisamchk [<span class="keyword">options</span>] tbl_name …</span><br></pre></td></tr></table></figure>

<p>options指定你想让myisamchk做什么.在后面描述它们.还可以通过调用myisamchk –help得到选项列表.<br>tbl_name是你想要检查或修复的数据库表.如果你不在数据库目录的某处运行myisamchk,你必须指定数据库目录的路径,因为 myisamchk不知道你的数据库位于哪儿.实际上,myisamchk不在乎你正在操作的文件是否位于一个数据库目录;你可以将对应于数据库表的文件 拷贝到别处并且在那里执行恢复操作.<br>如果你愿意,可以用myisamchk命令行命名几个表.还可以通过命名索引文件(用” .MYI”后缀)来指定一个表.它允许你通过使用模式”*.MYI”指定在一个目录所有的表.例如,如果你在数据库目录,可以这样在目录下检查所有的MyISAM表:</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shell</span><span class="bash">&gt; myisamchk *.MYI</span></span><br></pre></td></tr></table></figure>

<p>如果你不在数据库目录下,可通过指定到目录的路径检查所有在那里的表:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">shell&gt; myisamchk <span class="regexp">/path/</span>to<span class="regexp">/database_dir/</span>*.MYI</span><br></pre></td></tr></table></figure>

<p>你甚至可以通过为MySQL数据目录的路径指定一个通配符来检查所有的数据库中的所有表:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">shell&gt; myisamchk <span class="regexp">/path/</span>to<span class="regexp">/datadir/</span>*/*.MYI</span><br></pre></td></tr></table></figure>

<p>推荐的快速检查所有MyISAM表的方式是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">shell&gt; myisamchk --silent --fast <span class="regexp">/path/</span>to<span class="regexp">/datadir/</span>*/*.MYI</span><br></pre></td></tr></table></figure>

<p>如果你想要检查所有MyISAM表并修复任何破坏的表,可以使用下面的命令:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">shell&gt;myisamchk <span class="params">--silent</span> <span class="params">--force</span> <span class="params">--fast</span> <span class="params">--update-state</span> \</span><br><span class="line"><span class="params">--key_buffer_size=64M</span> <span class="params">--myisam_sort_buffer_size=64M</span> \</span><br><span class="line"><span class="params">--read_buffer_size=1M</span> <span class="params">--write_buffer_size=1M</span> \</span><br><span class="line"><span class="string">/path/to/datadir/</span>*/*<span class="string">.MYI</span></span><br></pre></td></tr></table></figure>

<p>该命令假定你有大于64MB的自由内存.关于用myisamchk分配内存的详细信息,参见5.9.5.5节,”myisamchk内存使用”.<br>当你运行myisamchk时,必须确保其它程序不使用表.否则,当你运行myisamchk时,会显示下面的错误消息:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">warnin<span class="variable">g:</span> clients are using <span class="built_in">or</span> haven<span class="comment">&quot;t closed the table properly</span></span><br></pre></td></tr></table></figure>

<p>这说明你正尝试检查正被另一个还没有关闭文件或已经终止而没有正确地关闭文件的程序(例如mysqld服务器)更新的表.<br>如果mysqld正在运行,你必须通过FLUSH TABLES强制清空仍然在内存中的任何表修改.当你运行myisamchk时,必须确保其它程序不使用表.避免该问题的最容易的方法是使用CHECK TABLE而不用myisamchk来检查表.</p>
]]></content>
  </entry>
  <entry>
    <title>解决checking for libmemcached &gt;= 0.17... configure error libmemcached not found</title>
    <url>/2011/09/30/1010/</url>
    <content><![CDATA[<p>网上的解决办法就是编译的时候加上<code>--with-libmemcached=/usr/local/libmemcached</code>,到<code>http://download.tangent.org/</code> 下载0.18版本的编译安装,然后运行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --with-mysql=/u</span>sr<span class="regexp">/bin/my</span>sql_config --with-libmemcached=<span class="regexp">/usr/</span>local<span class="regexp">/libmemcached/</span></span><br></pre></td></tr></table></figure>

<p>重新编译.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error No curses/termcap library found</title>
    <url>/2012/12/29/1012/</url>
    <content><![CDATA[<p>错误的原因是没有安装ncurses-devel.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ncurses-devel</span><br></pre></td></tr></table></figure>
<p>就可以解决这个问题了.</p>
]]></content>
  </entry>
  <entry>
    <title>详解rsync error some files/attrs were not transferred (see previous errors) (code 23) at main.c(1508) [generator=3.0.7]</title>
    <url>/2014/10/02/1011/</url>
    <content><![CDATA[<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">rsync</span> <span class="selector-tag">error</span>: <span class="selector-tag">some</span> <span class="selector-tag">files</span>/<span class="selector-tag">attrs</span> <span class="selector-tag">were</span> <span class="selector-tag">not</span> <span class="selector-tag">transferred</span> (see previous errors) (code <span class="number">23</span>) <span class="selector-tag">at</span> <span class="selector-tag">main</span><span class="selector-class">.c</span>(<span class="number">1508</span>) <span class="selector-attr">[generator=3.0.7]</span></span><br></pre></td></tr></table></figure>

<p>一般出现这个错误的原因有有两个,一个是备份的目录不存在,还有一个就是权限不够.<br>比如执行:</p>
<figure class="highlight ceylon"><table><tr><td class="code"><pre><span class="line">rsync -av <span class="meta">license</span> /tmp</span><br></pre></td></tr></table></figure>

<p>如果license目录不存在就会出现第一个错误,<br>如果不是管理员,对两个目录没有读写权限也会出现那个错误.<br>解决办法也很简单,<br>不存在的 话就备份存在的文件夹.<br>如果权限不够就换管理员操作.</p>
]]></content>
  </entry>
  <entry>
    <title>解决./.libs/libplumb.so undefined reference to &#39;uuid_parse&#39;</title>
    <url>/2016/11/02/1013/</url>
    <content><![CDATA[<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">./.libs/libplumb.so: undefined reference <span class="keyword">to</span> `uuid_pars<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">./.libs/libplumb.so: undefined reference to `uuid_generate&#x27;</span></span><br><span class="line">./.libs/libplumb.so: undefined reference <span class="keyword">to</span> `uuid_copy<span class="string">&#x27;</span></span><br><span class="line"><span class="string">./.libs/libplumb.so: undefined reference to `uuid_is_null&#x27;</span></span><br><span class="line">./.libs/libplumb.so: undefined reference <span class="keyword">to</span> `uuid_unpars<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">./.libs/libplumb.so: undefined reference to `uuid_clear&#x27;</span></span><br><span class="line">./.libs/libplumb.so: undefined reference <span class="keyword">to</span> `uuid_compar<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">collect2: ld returned 1 exit status</span></span><br><span class="line"><span class="string">gmake[2]: *** [ipctest] Error 1</span></span><br><span class="line"><span class="string">gmake[2]: Leaving directory `/root/Reusable-Cluster-Components-glue-1.0.6/lib/clplumbing&#x27;</span></span><br><span class="line">gmake[<span class="number">1</span>]: *** [<span class="keyword">all</span>-<span class="keyword">recursive</span>] Error <span class="number">1</span></span><br><span class="line">gmake[<span class="number">1</span>]: Leaving directory `/root/Reusable-<span class="keyword">Cluster</span>-Components-glue<span class="number">-1.0</span><span class="number">.6</span>/lib<span class="string">&#x27;</span></span><br><span class="line"><span class="string">make: *** [all-recursive] Error 1</span></span><br></pre></td></tr></table></figure>

<p>这个差不多能看出来是uuid方面的包的故障,所以我一开始就想去安装一个libuuid-devel的包,在这个上面消耗了不少时间.但最后通过 google与linux-ha的maillist得到了提示,总算是把这个问题给解决了.解决方法其实很简单,只要在configure时在后面加上:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">LIBS</span>=<span class="string">&#x27;/lib/libuuid.so.1&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>550 create directory operation failed问题解决</title>
    <url>/2014/04/06/1014/</url>
    <content><![CDATA[<p>安装vsftpd后只能浏览而不能上传,出现标题错误,<br>原因是selinux没有关闭,<br>解决办法就是直接把它关闭了.<br>关闭方法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>selinux/config</span><br></pre></td></tr></table></figure>

<p>将 SELINUX=XXX –&gt;XXX 代表级别.<br>改为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ERROR 2002 (HY000) Can&#39;t connect to local MySQL server through socket &#39;/tmp/mysql.sock&#39; (2)</title>
    <url>/2015/01/18/1015/</url>
    <content><![CDATA[<p>这个错误的原因是系统找不到mysql.sock,可以用-S制定这个文件的位置,<br>用</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql -uroot -pdovao -S<span class="regexp">/var/</span>lib<span class="regexp">/mysql/my</span>sql.sock</span><br></pre></td></tr></table></figure>

<p>类似这种方式启动,解决问题.</p>
]]></content>
  </entry>
  <entry>
    <title>解决fatal open lock file /var/lib/postfix/master.lock cannot open file Permission denied</title>
    <url>/2019/05/07/1017/</url>
    <content><![CDATA[<p>安装postfix出现错误如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Apr</span> <span class="number">5</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">59</span> muxiaoshuai postfix/postfix-script[<span class="number">30510</span>]: warning: not owned by postfix: /var/lib/postfix/./master.lock</span><br><span class="line"><span class="attribute">Apr</span> <span class="number">5</span> <span class="number">11</span>:<span class="number">55</span>:<span class="number">46</span> muxiaoshuai postfix/postfix-script[<span class="number">3751</span>]: warning: not owned by postfix: /var/lib/postfix/./master.lock</span><br><span class="line"><span class="attribute">Apr</span> <span class="number">5</span> <span class="number">11</span>:<span class="number">55</span>:<span class="number">46</span> muxiaoshuai postfix/postfix-script[<span class="number">3765</span>]: starting the Postfix mail system</span><br><span class="line"><span class="attribute">Apr</span> <span class="number">5</span> <span class="number">11</span>:<span class="number">55</span>:<span class="number">46</span> muxiaoshuai postfix/master[<span class="number">3766</span>]: fatal: open lock file /var/lib/postfix/master.lock: cannot open file: Permission denied</span><br></pre></td></tr></table></figure>

<p>解决办法是创建目录 <code>/var/lib/postfix/</code>.<br>和创建文件 <code>/var/lib/postfix/master.lock</code>.<br>然后给这个目录和子文件文件夹 777 权限,<br>重新启动postfix搞定.</p>
]]></content>
  </entry>
  <entry>
    <title>解决启动mysql提示Can&#39;t find messagefile &#39;/usr/share/mysql/english/errmsg.sys &#39;</title>
    <url>/2016/06/10/1016/</url>
    <content><![CDATA[<p>遇到这个错误的朋友应该是拆卸mysql又重新安装的,拆卸mysql的时候,下面这个文件是不会删除的,导致第二次的启动失败.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/mysql/</span>english/errmsg.sys</span><br></pre></td></tr></table></figure>

<p>解决办法是在:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>downloads.mysql.com/archives.php</span><br></pre></td></tr></table></figure>

<p>寻找下载对应的mysql版本,解压后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysq-x.x.x<span class="regexp">/sql/</span>share<span class="regexp">/english/</span>errmsg.sys</span><br></pre></td></tr></table></figure>

<p>拷贝到系统的:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/mysql/</span>english/</span><br></pre></td></tr></table></figure>

<p>覆盖同名errmsg.sys文件.<br>或者拆卸mysql,删除该文件夹重新安装,成功.</p>
]]></content>
  </entry>
  <entry>
    <title>解决[ERROR] /usr/libexec/mysqld unknown variable &#39;table_open_cache=64&#39; [ERROR] /usr/local/mysql//libexec/mysqld unknown variable &#39;binlog_format=MIXED&#39;</title>
    <url>/2018/07/10/1019/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[ERROR] <span class="regexp">/usr/</span>libexec/mysqld: unknown variable <span class="string">&#x27;table_open_cache=64&#x27;</span></span><br></pre></td></tr></table></figure>

<p>打开 <code>/etc/my.cnf</code> 注释掉 table_open_cache=64.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[ERROR] <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>libexec/mysqld: unknown variable <span class="string">&#x27;binlog_format=MIXED&#x27;</span></span><br></pre></td></tr></table></figure>

<p>打开 <code>/etc/my.cnf</code> 注释掉 binlog_format=MIXED.</p>
]]></content>
  </entry>
  <entry>
    <title>linux temfs与/dev/shm探讨及其应用</title>
    <url>/2016/05/07/1018/</url>
    <content><![CDATA[<p>什么是tmpfs?</p>
<p>tmpfs是Linux/Unix系统上的一种基于内存的文件系统.tmpfs可以使用您的内存或swap分区来存储文件.由此可见,temfs主要存储暂存的文件.<br>linux内核中的VM子系统负责在后台管理虚拟内存资源Virtual Memory,即RAM和swap资源,透明地将RAM页移动到交换分区或从交换分区到RAM页,tmpfs文件系统需要VM子系统的页面来存储文件.tmpfs自己并不知道这些页面是在交换分区还是在RAM中;做这种决定是VM子系统的工作.tmpfs文件系统所知道的就是它正在使用某种形式的虚拟内存.<br>tmpfs基于内存,因而速度是相当的,另外tmpfs使用的VM资源是动态的,当删除tmpfs中文件,tmpfs 文件系统驱动程序会动态地减小文件系统并释放 VM 资源,当然在其中创建文件时也会动态的分配VM资源.另外,tmpfs不具备持久性,重启后数据不保留,原因很明显,它是基于内存的.<br>编译内核时,启用”Virtual memory file system support”就可以使用tmpfs,linux kernel从2.4以后都开始支持tmpfs.目前主流的linux系统默认已启用tmpfs,如Redhat.</p>
<p>什么是 <code>/dev/shm</code>?</p>
<p>看到dev大家都使知道它是一个设备文件.使用tmpfs文件系统,在Redhat/CentOS等linux发行版中默认大小为物理内存的一半.如我的虚拟机装的是CentOS6.0,分配内存为1G,所以 <code>/dev/shm</code>为500M左右.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem            <span class="keyword">Size</span>  Used Avail Use% Mounted on</span><br><span class="line"><span class="regexp">/dev/</span>sda3             <span class="number">8.8</span>G  <span class="number">4.0</span>G  <span class="number">4.5</span>G  <span class="number">48</span>% /</span><br><span class="line">tmpfs                 <span class="number">499</span>M   <span class="number">88</span>K  <span class="number">499</span>M   <span class="number">1</span>% <span class="regexp">/dev/</span>shm</span><br><span class="line"><span class="regexp">/dev/</span>sda1              <span class="number">97</span>M   <span class="number">43</span>M   <span class="number">50</span>M  <span class="number">47</span>% /boot</span><br></pre></td></tr></table></figure>

<p>tmpfs是基于内存的文件系统,创建时不需要使用mkfs等初始化.如我想把 <code>/dev/shm</code> tmpfs大小改为512M.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmpfs       <span class="regexp">/dev/</span>shm    tmpfs  defaults   <span class="number">0</span>   <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>更改为:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">tmpfs       <span class="regexp">/dev/</span>shm    tmpfs  defaults,<span class="keyword">size</span>=<span class="number">512</span>m   <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ mount -o remount <span class="regexp">/dev/</span>shm</span><br><span class="line">$ df -h</span><br><span class="line">Filesystem            <span class="keyword">Size</span>  Used Avail Use% Mounted on</span><br><span class="line"><span class="regexp">/dev/</span>sda3             <span class="number">8.8</span>G  <span class="number">4.0</span>G  <span class="number">4.5</span>G  <span class="number">48</span>% /</span><br><span class="line">tmpfs                 <span class="number">512</span>M   <span class="number">88</span>K  <span class="number">512</span>M   <span class="number">1</span>% <span class="regexp">/dev/</span>shm</span><br><span class="line"><span class="regexp">/dev/</span>sda1              <span class="number">97</span>M   <span class="number">43</span>M   <span class="number">50</span>M  <span class="number">47</span>% /boot</span><br></pre></td></tr></table></figure>

<p>怎么样,变成512M啦,使用很方便吧,哈哈.<br>当然在生产环境中你可以把内存加大些,反正现在内存很便宜啦,为了提高性能也需要将 <code>/dev/shm</code>加大.如:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mount -o <span class="attribute">size</span>=1500M -o <span class="attribute">nr_inodes</span>=1000000 -o noatime,nodiratime -o remount /dev/shm</span><br></pre></td></tr></table></figure>

<p>nr_innodes指定索引节点数,nodiratime  man中解释如下:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">nodiratime  <span class="keyword">Do</span>  <span class="keyword">not</span>  <span class="keyword">update</span> directory inode <span class="keyword">access</span> times <span class="keyword">on</span> this filesystem.</span><br></pre></td></tr></table></figure>

<p>不更新目录被访问时inode中的记录信息,noatime同理,好处你懂的.</p>
<p>tmpfs应用:</p>
<p>tmpfs是基于内存的,速度是不用说的,硬盘和它没法比.<br>Oracle 中的Automatic Memory Management特性就使用了 <code>/dev/shm</code>.<br>另外如果在网站运维中好好利用tmpfs,将有意想不到的收获.<br>我们先在 <code>/dev/shm</code>建一个tmp目前,并与 <code>/tmp</code>绑定.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">$ mkdir <span class="string">/dev/shm/tmp</span></span><br><span class="line">$ chmod 1777 <span class="string">/dev/shm/tmp</span>  <span class="string">//</span>注意一下权限</span><br><span class="line">$ mount –bind <span class="string">/dev/shm/tmp</span> <span class="string">/tmp</span></span><br><span class="line">$ <span class="keyword">ls</span> -ld <span class="string">/tmp</span></span><br><span class="line"></span><br><span class="line">drwxrwxrwt 2 root root 40 Aug 29 23<span class="function">:58</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>

<p>当然您也可以不绑定,直接mount在现有的安装点上使用tmpfs,如:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">umount   <span class="string">/tmp</span></span><br><span class="line">mount  tmpfs  <span class="string">/tmp</span>   -t tmpfs   -o size=512M</span><br></pre></td></tr></table></figure>

<p>也很方便吧,不需要使用mkfs等命令创建.<br>以下 <code>/tmp</code>使用tmpfs文件系统.</p>
<p>(1)将squid的缓存目录cache_dir放到 <code>/tmp</code>下</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cache_dir</span> ufs /tmp <span class="number">256</span> <span class="number">16</span> <span class="number">256</span></span><br></pre></td></tr></table></figure>

<p>重启一下squid服务,这样缓存目录都放在了tmpfs文件中了,速度不用说吧.</p>
<p>(2)将php的session文件放在 <code>/tmp</code>下</p>
<p>通过phpinfo测试文件查看你的php session存储位置,如果不在 <code>/tmp</code>下,修改php.ini文件,修改如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">session.save_path</span> = <span class="string">&quot;/tmp&quot;</span></span><br></pre></td></tr></table></figure>

<p>当然如果您的网站访问量比较大,可 <code>/tmp</code>下设置分层目录存储session,语法如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">session.save_path</span>=<span class="string">&quot;N;/save_path&quot;</span></span><br></pre></td></tr></table></figure>

<p>N 为分级的级数,save_path 为开始目录.</p>
<p>(3)将服务的socket文件放在 <code>/tmp</code>下</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">如nginx.<span class="built_in">socket</span>和mysql.sock</span><br></pre></td></tr></table></figure>

<p>网上的此类文档太少,本人研究也不够深入,欢迎大家在评论中与我交流你的看法.</p>
]]></content>
  </entry>
  <entry>
    <title>解决readline/readline.h No such file or directory</title>
    <url>/2016/07/26/1021/</url>
    <content><![CDATA[<p>站长遇到这个错误的时候也去百度了一下,结果出现的都是ubuntu的解决办法,这里给出的是centos的解决办法.</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">readline</span>/<span class="built_in">readline</span>.h: No such file <span class="keyword">or</span> <span class="built_in">directory</span></span><br></pre></td></tr></table></figure>

<p>这个错误的时候需要安装readline:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">yum install <span class="built_in">readline</span> <span class="built_in">readline</span>-devel</span><br></pre></td></tr></table></figure>

<p>然后重新运行通过.</p>
]]></content>
  </entry>
  <entry>
    <title>centos编译内核出现*** Warning make dep is unnecessary now.的原因</title>
    <url>/2016/01/22/1020/</url>
    <content><![CDATA[<p>命令make dep实际上读取配置过程生成的配置文件,来创建对应于配置的依赖关系树,从而决定哪些需要编译而那些不需要.不过这条命令在2.6及以后的内核编译中都不再需要.如果执行就会出现如下的提示:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">root<span class="variable">@org</span><span class="symbol">:/usr/src/linux</span><span class="comment"># make dep</span></span><br><span class="line">*** <span class="symbol">Warning:</span> make dep is unnecessary now.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决 ERROR!  Libpcap library/headers (libpcap.a (or .so)/pcap.h)    not found</title>
    <url>/2009/05/05/1023/</url>
    <content><![CDATA[<p>编译安装snort出现错误:</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">ERROR!? Libpcap library/headers (libpcap.a (or .so)/pcap.h)<span class="built_in"></span></span><br><span class="line"><span class="built_in">not </span>found, go get it from http://www.tcpdump.org<span class="built_in"></span></span><br><span class="line"><span class="built_in">or </span>use the --with-libpcap-* options,<span class="built_in"> if </span>you have it installed</span><br><span class="line">in unusual place.? Also<span class="built_in"> check </span>if your libpcap depends on another</span><br><span class="line">shared library that may be installed in an unusual place</span><br></pre></td></tr></table></figure>

<p>解决办法 :</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libpcap*</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux下防御/减轻DDOS攻击</title>
    <url>/2011/10/07/1022/</url>
    <content><![CDATA[<p>DDoS deflate介绍</p>
<p>DDoS deflate是一款免费的用来防御和减轻DDoS攻击的脚本.它通过netstat监测跟踪创建大量网络连接的IP地址,在检测到某个结点超过预设的限 制时,该程序会通过APF或IPTABLES禁止或阻挡这些IP.<br>DDoS deflate官方网站:<a href="http://deflate.medialayer.com/">http://deflate.medialayer.com/</a></p>
<p>如何确认是否受到DDOS攻击?</p>
<p>执行:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -ntu | <span class="type">awk</span> &#x27;&#123;print $<span class="number">5</span>&#125;&#x27; | <span class="type">cut</span> -d: -f1 | <span class="type">sort</span> | <span class="type">uniq</span> -c | <span class="type">sort</span> -n</span><br></pre></td></tr></table></figure>

<p>执行后,将会显示服务器上所有的每个IP多少个连接数.<br>以下是我自己用VPS测试的结果:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">netstat</span> -ntu | awk <span class="string">&#x27;&#123;print <span class="variable">$5</span>&#125;&#x27;</span> | cut -d: -f1 | sort | uniq -c | sort -n</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="number">114.226.9.132</span></span><br><span class="line"><span class="number">1</span> <span class="number">174.129.237.157</span></span><br><span class="line"><span class="number">1</span> <span class="number">58.60.118.142</span></span><br><span class="line"><span class="number">1</span> Address</span><br><span class="line"><span class="number">1</span> servers)</span><br><span class="line"><span class="number">2</span> <span class="number">118.26.131.78</span></span><br><span class="line"><span class="number">3</span> <span class="number">123.125.1.202</span></span><br><span class="line"><span class="number">3</span> <span class="number">220.248.43.119</span></span><br><span class="line"><span class="number">4</span> <span class="number">117.36.231.253</span></span><br><span class="line"><span class="number">4</span> <span class="number">119.162.46.124</span></span><br><span class="line"><span class="number">6</span> <span class="number">219.140.232.128</span></span><br><span class="line"><span class="number">8</span> <span class="number">220.181.61.31</span></span><br><span class="line"><span class="number">2311</span> <span class="number">67.215.242.196</span></span><br></pre></td></tr></table></figure>

<p>每个IP几个、十几个或几十个连接数都还算比较正常,如果像上面成百上千肯定就不正常了.</p>
<p>1、安装DDoS deflate</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">wget http:<span class="string">//www.inetbase.com/scripts/ddos/install.sh</span>   <span class="string">//</span>下载DDoS  deflate</span><br><span class="line">chmod 0700 install.sh    <span class="string">//</span>添加权限</span><br><span class="line"><span class="string">./install.sh</span>             <span class="string">//</span>执行</span><br></pre></td></tr></table></figure>

<p>2、配置DDoS deflate</p>
<p>下面是DDoS deflate的默认配置位于 <code>/usr/local/ddos/ddos.conf</code> ,内容如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">##### Paths of the script and other files</span></span><br><span class="line"><span class="attr">PROGDIR</span>=<span class="string">&quot;/usr/local/ddos&quot;</span></span><br><span class="line"><span class="attr">PROG</span>=<span class="string">&quot;/usr/local/ddos/ddos.sh&quot;</span></span><br><span class="line"><span class="attr">IGNORE_IP_LIST</span>=<span class="string">&quot;/usr/local/ddos/ignore.ip.list&quot;</span>  //IP地址白名单</span><br><span class="line"><span class="attr">CRON</span>=<span class="string">&quot;/etc/cron.d/ddos.cron&quot;</span>    //定时执行程序</span><br><span class="line"><span class="attr">APF</span>=<span class="string">&quot;/etc/apf/apf&quot;</span></span><br><span class="line"><span class="attr">IPT</span>=<span class="string">&quot;/sbin/iptables&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### frequency in minutes for running the script</span></span><br><span class="line"><span class="comment">##### Caution: Every time this setting is changed, run the script with --cron</span></span><br><span class="line"><span class="comment">#####          option so that the new frequency takes effect</span></span><br><span class="line"><span class="attr">FREQ</span>=<span class="number">1</span>   //检查时间间隔,默认<span class="number">1</span>分钟</span><br><span class="line"></span><br><span class="line"><span class="comment">##### How many connections define a bad IP? Indicate that below.</span></span><br><span class="line"><span class="attr">NO_OF_CONNECTIONS</span>=<span class="number">150</span>     //最大连接数,超过这个数IP就会被屏蔽,一般默认即可</span><br><span class="line"></span><br><span class="line"><span class="comment">##### APF_BAN=1 (Make sure your APF version is atleast 0.96)</span></span><br><span class="line"><span class="comment">##### APF_BAN=0 (Uses iptables for banning ips instead of APF)</span></span><br><span class="line"><span class="attr">APF_BAN</span>=<span class="number">1</span>        //使用APF还是iptables.推荐使用iptables,将APF_BAN的值改为<span class="number">0</span>即可.</span><br><span class="line"></span><br><span class="line"><span class="comment">##### KILL=0 (Bad IPs are&#x27;nt banned, good for interactive execution of script)</span></span><br><span class="line"><span class="comment">##### KILL=1 (Recommended setting)</span></span><br><span class="line"><span class="attr">KILL</span>=<span class="number">1</span>   //是否屏蔽IP,默认即可</span><br><span class="line"></span><br><span class="line"><span class="comment">##### An email is sent to the following address when an IP is banned.</span></span><br><span class="line"><span class="comment">##### Blank would suppress sending of mails</span></span><br><span class="line"><span class="attr">EMAIL_TO</span>=<span class="string">&quot;root&quot;</span>   //当IP被屏蔽时给指定邮箱发送邮件,推荐使用,换成自己的邮箱即可</span><br><span class="line"></span><br><span class="line"><span class="comment">##### Number of seconds the banned ip should remain in blacklist.</span></span><br><span class="line"><span class="attr">BAN_PERIOD</span>=<span class="number">600</span>    //禁用IP时间,默认<span class="number">600</span>秒,可根据情况调整</span><br></pre></td></tr></table></figure>

<p>用户可根据给默认配置文件加上的注释提示内容,修改配置文件.<br>查看 <code>/usr/local/ddos/ddos.sh</code>文件的第117行:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -ntu | <span class="type">awk</span> &#x27;&#123;print $<span class="number">5</span>&#125;&#x27; | <span class="type">cut</span> -d: -f1 | <span class="type">sort</span> | <span class="type">uniq</span> -c | <span class="type">sort</span> -nr &gt; $BAD_IP_LIST</span><br></pre></td></tr></table></figure>

<p>修改为以下代码即可!</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -ntu | <span class="type">awk</span> &#x27;&#123;print $<span class="number">5</span>&#125;&#x27; | <span class="type">cut</span> -d: -f1 | <span class="type">sed</span> -n &#x27;/[<span class="number">0</span><span class="number">-9</span>]/p&#x27; | <span class="type">sort</span> | <span class="type">uniq</span> -c | <span class="type">sort</span> -nr &gt; $BAD_IP_LIST</span><br></pre></td></tr></table></figure>

<p>喜欢折腾的可以用Web压力测试软件测试一下效果,相信DDoS deflate还是能给你的VPS或服务器抵御一部分DDOS攻击,给你的网站更多的保护.</p>
]]></content>
  </entry>
  <entry>
    <title>解决umount /home device is busy</title>
    <url>/2016/04/09/1025/</url>
    <content><![CDATA[<p>取消挂载 <code>/home</code>时出现:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">umount:</span> /home: device <span class="built_in">is</span> busy</span><br></pre></td></tr></table></figure>

<p>原因是因为有程序在使用/home目录,我们可以使用fuser查看那些程序的进程,然后杀掉就可以了.</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">$ fuser -m /home</span><br><span class="line"></span><br><span class="line">/home: <span class="number">10278</span><span class="keyword">c</span> <span class="number">10279</span><span class="keyword">c</span> <span class="number">10280</span><span class="keyword">c</span> <span class="number">10281</span><span class="keyword">c</span> <span class="number">10282</span><span class="keyword">c</span> <span class="number">10295</span> <span class="number">10365</span> <span class="number">18222</span><span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p>命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kill</span> -<span class="number">9</span> pid</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决centos-6出现 /usr/bin/ld cannot find lc</title>
    <url>/2018/06/13/1024/</url>
    <content><![CDATA[<p>在centos 6 64位系统上编译mini_sendmail时出现 <code>/usr/bin/ld: cannot find lc</code>错误,<br>查找了一下发现libc.so是存在的,于是使用:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">strace -<span class="keyword">o</span> -<span class="keyword">f</span> <span class="keyword">lc</span>.strace <span class="keyword">make</span></span><br></pre></td></tr></table></figure>

<p>语句跟踪了一下,<br>发现缺少libc.a文件,而在centos 5就没有这种情况,执行以后命令安装:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">yum install glibc-<span class="keyword">static</span></span><br></pre></td></tr></table></figure>

<p>就可以解决这个问题了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决scp提示&quot;bash scp command not found lost connection&quot;故障</title>
    <url>/2020/08/17/1027/</url>
    <content><![CDATA[<p>今天，装完一台redis，并配置好redis.conf后，想偷懒直接用scp传到另一台redis，省去全部重新编辑的麻烦。结果一执行就出现下面这个错误：</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bash: </span><span class="keyword">scp: </span>command not found</span><br></pre></td></tr></table></figure>

<p>所有机器我都是最小化安装，所以很多组件没装也是情理之中，所以用yum装一下scp：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> openssh-clients</span><br></pre></td></tr></table></figure>

<p>装完后，继续执行之前的命令，结果出现如下错误：</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">[root<span class="meta">@cache-ns-4</span> etc]<span class="comment"># scp redis.conf root@192.168.17.125:/usr/local/redis/etc/</span></span><br><span class="line">root<span class="meta">@192.168.17.125&#x27;s</span> password:</span><br><span class="line">bash: scp: command not found</span><br><span class="line">lost connection</span><br><span class="line">[root<span class="meta">@cache-ns-4</span> etc]<span class="comment"># whereis scp</span></span><br><span class="line">scp: /usr/bin/scp /usr/share/man/man1/scp.1.gz</span><br></pre></td></tr></table></figure>

<p>我擦，这就诡异了！明明装了为毛提示不存在呢？原来是因为目标主机也没装scp，倒是我大意了！登陆后再次执行如下命令安装scp：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> openssh-clients</span><br></pre></td></tr></table></figure>

<p>回到之前的服务器上，执行最初的命令，果然毫无意外成功了。</p>
]]></content>
  </entry>
  <entry>
    <title>Address family not supported by protocol - connect(2)的解决办法</title>
    <url>/2014/12/18/1028/</url>
    <content><![CDATA[<p>ruby的socket错误:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Errno::EAFNOSUPPORT: Address <span class="keyword">family</span> <span class="keyword">not</span> supported <span class="keyword">by</span> protocol - <span class="keyword">connect</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>原因解析:地址集不被支持</p>
<p>解决方法:改成ip或者修改 <code>/etc/hosts</code>文件</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">require &#x27;<span class="keyword">socket</span>&#x27;</span><br><span class="line">include Socket::Constants</span><br><span class="line"><span class="keyword">puts</span> <span class="string">&quot;*&quot;</span>*<span class="number">50</span></span><br><span class="line"><span class="keyword">puts</span> AF_INET</span><br><span class="line"><span class="keyword">puts</span> SOCK_STREAM</span><br><span class="line"><span class="keyword">puts</span> <span class="string">&quot;*&quot;</span>*<span class="number">50</span></span><br><span class="line"><span class="keyword">socket</span> = Socket.new(AF_INET, SOCK_STREAM, <span class="number">0</span>)</span><br><span class="line">sockaddr = Socket.pack_sockaddr_in(<span class="number">2202</span>, &#x27;localhost&#x27;) #改成<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">socket</span>.connect(sockaddr)</span><br><span class="line"><span class="keyword">socket</span>.<span class="keyword">puts</span> <span class="string">&quot;Hello from script 2.&quot;</span></span><br><span class="line"><span class="keyword">puts</span> <span class="string">&quot;The server said, &#x27;#&#123;socket.readline.chomp&#125;&#x27;&quot;</span></span><br><span class="line"><span class="keyword">socket</span>.<span class="keyword">close</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache ab 压力测试</title>
    <url>/2016/04/13/1029/</url>
    <content><![CDATA[<p>压力测试是一种基本的质量保证行为,它是每个重要软件测试工作的一部分.压力测试的基本思路很简单:不是在常规条件下运行手动或自动测试,而是在计 算机数量较少或系统资源匮乏的条件下运行测试.通常要进行压力测试的资源包括内部内存、CPU 可用性、磁盘空间和网络带宽等.一般用并发来做压力测试.</p>
<p>1.apache安装</p>
<p>下载:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://httpd.apache.org/download.cgi下载httpd-<span class="number">2</span>.<span class="number">0</span>.<span class="number">58</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>安装:<br>tar -zxvf  httpd-2.0.58.tar.gz<br>./configure –prefix=/usr/local/apache2test –enable-so –enable-shared=max –with-mpm=worker –enable-deflate –enable-headers –enable-rewrite –enable-proxy –enable-proxy –enable-ssl –with-ssl=/path/to/install/openssl_0.97i –enable-modules=all &amp;&amp; make &amp;&amp; make install</p>
<p>(这是正式服务器上的apache2的编译参数,其中 <code>–with-mpm=worker –with-ssl=/path/to/install/openssl_0.97i</code>可以根据实际情况做出修改)<br>然后安装php,并且在 <code>/usr/local/apache2test/conf</code>目录下的httpd.conf里面的DSO支持之后加入</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php <span class="string">.php</span> <span class="string">.phtml</span> <span class="string">.html</span> <span class="string">.htm</span></span><br><span class="line">AddType application/x-httpd-php-source <span class="string">.phps</span></span><br></pre></td></tr></table></figure>

<p>最后将测试的php网页文件添加到 <code>/usr/local/apache2test/htdocs</code>目录下:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>

<p>2.测试工具说明以及安装</p>
<p>ab:</p>
<p>ab是Apache超文本传输协议(HTTP)的性能测试工具. 其设计意图是描绘当前所安装的Apache的执行性能,主要是显示你安装的Apache每秒可以处理多少个请求;<br>概要:运行 <code>/usr/local/apache-install-path/bin/ab -help</code>查看ab的具体命令选项;<br>命令选项-c concurrency 一次产生的请求个数.默认是一次一个.<br>-n requests 在测试会话中所执行的请求个数. 默认时,仅执行一个请求,但通常其结果不  具有代表意义<br>运行结果:主要要注意的是以下内容<br>Time taken for tests: 总共执行所花费的时间.(以上 1000 次共多久)<br>Requests per second:  每秒平均可以处理多少个connection.<br>备注:每次仅仅能针对一个连接做重复的测试.</p>
<p>Siege:</p>
<p>是一个压力测试和评测工具,设计用于WEB开发这评估应用在压力下的承受能力:可以根据配置对一个WEB站点进行多用户的并发访问,记录每个用户所有请求过程的相应时间,并在一定数量的并发访问下重复进行.</p>
<p>下载/安装:</p>
<p>Siege时一个开放源代码项目,可以在<a href="http://www.google.com/">http://www.google.com</a> 上查找<br>备注:最好选择2.5以上版本,因为高版本多包括一个辅助工具,能够做增量压力测试,低版本不包括此工具.</p>
<p>安装:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure –prefix=/</span>path<span class="regexp">/to/i</span>nstall &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>使用说明:</p>
<p>siege使用:</p>
<p>在 <code>/path/to/install/bin/</code>目录下创建需要测试的链接文件,如<a href="http://www.test.com.url,添加需要的测试的链接/">www.test.com.url,添加需要的测试的链接</a>.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">10.5</span>.<span class="number">3.122</span><span class="regexp">/test/g</span>oogle.php/</span><br><span class="line">http:<span class="regexp">//</span><span class="number">10.5</span>.<span class="number">3.122</span><span class="regexp">/test/</span>baidu.php/</span><br><span class="line">http:<span class="regexp">//</span><span class="number">10.5</span>.<span class="number">3.122</span><span class="regexp">/test/</span>sogou.php/</span><br></pre></td></tr></table></figure>

<p>然后保存.<br>siege使用样例:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">siege</span> -c <span class="number">20</span> -r <span class="number">2</span> -f www.chedong.com.url</span><br></pre></td></tr></table></figure>

<p>参数说明:</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">c <span class="number">20</span> 并发<span class="number">20</span>个用户</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">r <span class="number">2</span> 重复循环<span class="number">2</span>次</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">f www.test.com.url 任务列表<span class="symbol">:URL</span>列表</span></span><br></pre></td></tr></table></figure>

<p>输出样例:</p>
<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line">** Siege 2.59</span><br><span class="line">** Preparing 20 concurrent users for battle. 这次&quot;战斗&quot;准备了20个并发用户</span><br><span class="line"><span class="attribute">The server is now under siege.. done. 服务在&quot;围攻&quot;测试中:</span></span><br><span class="line"><span class="attribute">Transactions</span>: 40 hits 完成40次处理</span><br><span class="line"><span class="attribute">Availability</span>: 100.00 % 成功率</span><br><span class="line"><span class="attribute">Elapsed time</span>: 7.67 secs 总共用时</span><br><span class="line"><span class="attribute">Data transferred</span>: 877340 bytes 共数据传输:877340字节</span><br><span class="line"><span class="attribute">Response time</span>: 1.65 secs 相应用时1.65秒:显示网络连接的速度</span><br><span class="line"><span class="attribute">Transaction rate</span>: 5.22 trans/sec 平均每秒完成5.22次处理:表示服务器后台处理的速度</span><br><span class="line"></span><br><span class="line"><span class="attribute">Throughput</span>: 114385.92 bytes/sec 平均每秒传送数据:114385.92字节</span><br><span class="line"><span class="attribute">Concurrency</span>: 8.59 最高并发数 8.59</span><br><span class="line"><span class="attribute">Successful transactions</span>: 40 成功处理次数</span><br><span class="line"><span class="attribute">Failed transactions</span>: 0 失败处理次数</span><br></pre></td></tr></table></figure>

<p>bombardment使用样例:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">bombardment</span> www.test.com.url <span class="number">5</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>初始化URL列表:<a href="http://www.test.com.url/">www.test.com.url</a><br>初始化为:5个用户<br>每次增加:3个用户<br>运行:4次<br>每个客户端之间的延迟为:1秒<br>输出样例和siege一致,但是会在每一次增量结束之后都有输出.</p>
<p>3.测试方法说明</p>
<p>测试步骤:</p>
<p>方法1.安装apache2后,直接使用apache2的默认设置配置,不做任何修改,进行测试;<br>方法2.按照以前文档提出的Web容量规划和内存的大小,计算出相应的启动进程数,配置httpd.conf文件,再进行测试;</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ServerLimit</span>             <span class="number">400</span></span><br><span class="line"><span class="attribute">StartServers</span>            <span class="number">20</span></span><br><span class="line"><span class="attribute">MinSpareServers</span>         <span class="number">20</span></span><br><span class="line"><span class="attribute">MaxSpareServers</span>         <span class="number">50</span></span><br><span class="line"><span class="attribute">MaxClients</span>       <span class="number">300</span></span><br><span class="line"><span class="attribute">MaxRequestsPerChild</span>     <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<p>方法3.超过极限设置,进行测试.(规划容量的2倍进行)</p>
<p>1000个链接,分为不同的并发数请求,10、50、100、200、300、500</p>
<p>ab测试:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 10 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 50 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 100 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 200 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 300 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/apache2.53/</span>bin<span class="regexp">/ab -n 1000 -c 500 http:/</span><span class="regexp">/10.5.3.122/</span>test<span class="regexp">/google.php/</span></span><br></pre></td></tr></table></figure>

<p>siege测试:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">10</span> -r <span class="number">100</span> -f www.test.com.url</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">50</span> -r <span class="number">20</span> -f www.test.com.url</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">100</span> -r <span class="number">10</span> -f www.test.com.url</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">200</span> -r <span class="number">5</span> -f www.test.com.url</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">300</span> -r <span class="number">3</span> -f www.test.com.url</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/siege -c <span class="number">500</span> -r <span class="number">2</span> -f www.test.com.url</span><br><span class="line">增量测试:</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/bombardment www.test.com.url <span class="number">1</span> <span class="number">100</span> <span class="number">5</span> <span class="number">1</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/siege/</span>bin/bombardment www.test.com.url <span class="number">1</span> <span class="number">100</span> <span class="number">6</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>4.测试结果总结</p>
<p>ab测试:测试并发连接数在50<del>500的情况下,方法2比方法1性能略有提升,但是相差在10个并发连接数左右,并且方法1方法2在测试并发数100的情况下,实际并发数都相差无几.<br>siege测试:测试并发数从50之后直到500,性能都有提升,并且在测试并发数100、200、500的情况下,提升相差10</del>30个实际并发数.<br>bombardment测试:相差不大.<br>本次测试的结果不太理想,性能的变化不显著,也不明显,可以所属于失败的测试结果.<br>分析原因:1.本身硬件配置不高,所以默认设置和修改后的设置变化不明显,对性能的提升也明显不足;<br>2.负载情况太少,由于系统性能原因,增量测试都不能过大的进行,系统性能load average过高;<br>3.测试页面程序也太少,没有太大说服力.</p>
<p>ab压力测试</p>
<p>以前安装好APACHE总是不知道该如何测试APACHE的性能,现在总算找到一个测试工具了.就是APACHE自带的测试工具AB(apache benchmark).在APACHE的bin目录下.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">格式: ./ab [<span class="keyword">options</span>] [http://]hostname[:port]/<span class="type">path</span></span><br><span class="line">参数:</span><br><span class="line">    -n requests     Number <span class="keyword">of</span> requests <span class="keyword">to</span> <span class="keyword">perform</span></span><br><span class="line">    //在测试会话中所执行的请求个数.默认时,仅执行一个请求</span><br><span class="line">    -c concurrency Number <span class="keyword">of</span> multiple requests <span class="keyword">to</span> make</span><br><span class="line">    //一次产生的请求个数.默认是一次一个. </span><br><span class="line">    -t timelimit    Seconds <span class="keyword">to</span> max. wait <span class="keyword">for</span> responses</span><br><span class="line">    //测试所进行的最大秒数.其内部隐含值是-n <span class="number">50000.</span>它可以使对服务器的测试限制在一个固定的总时间以内.默认时,没有时间限制.</span><br><span class="line">    -p postfile     File containing data <span class="keyword">to</span> POST</span><br><span class="line">    //包含了需要POST的数据的文件. </span><br><span class="line">    -T content-<span class="keyword">type</span> Content-<span class="keyword">type</span> <span class="keyword">header</span> <span class="keyword">for</span> POSTing</span><br><span class="line">    //POST数据所使用的Content-<span class="keyword">type</span>头信息.</span><br><span class="line">    -v verbosity    How much troubleshooting <span class="keyword">info</span> <span class="keyword">to</span> print</span><br><span class="line">    //设置显示信息的详细程度 - <span class="number">4</span>或更大值会显示头信息, <span class="number">3</span>或更大值可以显示响应代码(<span class="number">404</span>, <span class="number">200</span>等), <span class="number">2</span>或更大值可以显示警告和其他信息. -V 显示版本号并退出.</span><br><span class="line">    -w              Print <span class="keyword">out</span> results <span class="keyword">in</span> HTML <span class="keyword">tables</span></span><br><span class="line">    //以HTML表的格式输出结果.默认时,它是白色背景的两列宽度的一张表.</span><br><span class="line">    -i              Use HEAD <span class="keyword">instead</span> <span class="keyword">of</span> <span class="keyword">GET</span></span><br><span class="line">    // 执行HEAD请求,而不是<span class="keyword">GET</span>.</span><br><span class="line">    -x attributes   String <span class="keyword">to</span> <span class="keyword">insert</span> <span class="keyword">as</span> <span class="keyword">table</span> attributes</span><br><span class="line">    //</span><br><span class="line">    -y attributes   String <span class="keyword">to</span> <span class="keyword">insert</span> <span class="keyword">as</span> tr attributes</span><br><span class="line">    //</span><br><span class="line">    -z attributes   String <span class="keyword">to</span> <span class="keyword">insert</span> <span class="keyword">as</span> td <span class="keyword">or</span> th attributes</span><br><span class="line">    //</span><br><span class="line">    -C <span class="keyword">attribute</span>    <span class="keyword">Add</span> cookie, eg. <span class="string">&#x27;Apache=1234. (repeatable)</span></span><br><span class="line"><span class="string">    //-C cookie-name=value 对请求附加一个Cookie:行. 其典型形式是name=value的一个参数对.此参数可以重复.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    -H attribute    Add Arbitrary header line, eg. &#x27;</span>Accept-<span class="keyword">Encoding</span>: gzip<span class="string">&#x27;</span></span><br><span class="line"><span class="string">                    Inserted after all normal header lines. (repeatable)</span></span><br><span class="line"><span class="string">    -A attribute    Add Basic WWW Authentication, the attributes</span></span><br><span class="line"><span class="string">                    are a colon separated username and password.</span></span><br><span class="line"><span class="string">    -P attribute    Add Basic Proxy Authentication, the attributes</span></span><br><span class="line"><span class="string">                    are a colon separated username and password.</span></span><br><span class="line"><span class="string">    //-P proxy-auth-username:password 对一个中转代理提供BASIC认证信任.用户名和密码由一个:隔开,并以base64编码形式发送.无论服务器是否需要(即, 是否发送了401认证需求代码),此字符串都会被发送.</span></span><br><span class="line"><span class="string">    -X proxy:port   Proxyserver and port number to use</span></span><br><span class="line"><span class="string">    -V              Print version number and exit</span></span><br><span class="line"><span class="string">    -k              Use HTTP KeepAlive feature</span></span><br><span class="line"><span class="string">    -d              Do not show percentiles served table.</span></span><br><span class="line"><span class="string">    -S              Do not show confidence estimators and warnings.</span></span><br><span class="line"><span class="string">    -g filename     Output collected data to gnuplot format file.</span></span><br><span class="line"><span class="string">    -e filename     Output CSV file with percentages served</span></span><br><span class="line"><span class="string">    -h              Display usage information (this message)</span></span><br><span class="line"><span class="string">    //-attributes 设置 属性的字符串. 缺陷程序中有各种静态声明的固定长度的缓冲区.另外,对命令行参数、服务器的响应头和其他外部输入的解析也很简单,这可能会有不良后果.它没有完整地实现 HTTP/1.x; 仅接受某些&#x27;</span>预想<span class="string">&#x27;的响应格式. strstr(3)的频繁使用可能会带来性能问题,即, 你可能是在测试ab而不是服务器的性能.</span></span><br></pre></td></tr></table></figure>

<p>参数很多,一般我们用 -c 和 -n 参数就可以了. 例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/ab -c 1000 -n 1000 http:/</span><span class="regexp">/127.0.0.1/i</span>ndex.php</span><br></pre></td></tr></table></figure>

<p>这个表示同时处理1000个请求并运行1000次index.php文件.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/usr/local/xiaobai/apache2054/bin/ab -c 1000 -n 1000 http://127.0.0.1/index.html.zh-cn.gb2312 </span></span><br><span class="line"><span class="string">This</span> <span class="string">is</span> <span class="string">ApacheBench,</span> <span class="string">Version</span> <span class="number">2.0</span><span class="number">.41</span><span class="string">-dev</span> <span class="string">&lt;$Revision:</span> <span class="number">1.121</span><span class="number">.2</span><span class="number">.12</span> <span class="string">$&gt;</span> <span class="string">apache-2.0</span></span><br><span class="line"><span class="string">Copyright</span> <span class="string">(c)</span> <span class="number">1996 </span><span class="string">Adam</span> <span class="string">Twiss,</span> <span class="string">Zeus</span> <span class="string">Technology</span> <span class="string">Ltd,</span> <span class="string">http://www.zeustech.net/</span></span><br><span class="line"><span class="string">Copyright</span> <span class="string">(c)</span> <span class="number">1998</span><span class="number">-2002</span> <span class="string">The</span> <span class="string">Apache</span> <span class="string">Software</span> <span class="string">Foundation,</span> <span class="string">http://www.apache.org/</span></span><br><span class="line"></span><br><span class="line"><span class="string">Benchmarking</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">(be</span> <span class="string">patient)</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">100</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">200</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">300</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">400</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">500</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">600</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">700</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">800</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Completed</span> <span class="number">900</span> <span class="string">requests</span></span><br><span class="line"><span class="string">Finished</span> <span class="number">1000 </span><span class="string">requests</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Server Software:</span>        <span class="string">Apache/2.0.54</span></span><br><span class="line"><span class="string">//平台apache</span> <span class="string">版本2.0.54</span></span><br><span class="line"><span class="attr">Server Hostname:</span>        <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="string">//服务器主机名</span></span><br><span class="line"><span class="attr">Server Port:</span>            <span class="number">80</span></span><br><span class="line"><span class="string">//服务器端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Document Path:</span>          <span class="string">/index.html.zh-cn.gb2312</span></span><br><span class="line"><span class="string">//测试的页面文档</span></span><br><span class="line"><span class="attr">Document Length:</span>        <span class="number">1018 </span><span class="string">bytes</span></span><br><span class="line"><span class="string">//文档大小</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Concurrency Level:</span>      <span class="number">1000</span></span><br><span class="line"><span class="string">//并发数</span></span><br><span class="line"><span class="attr">Time taken for tests:</span>   <span class="number">8.188731</span> <span class="string">seconds</span></span><br><span class="line"><span class="string">//整个测试持续的时间</span></span><br><span class="line"><span class="attr">Complete requests:</span>      <span class="number">1000</span></span><br><span class="line"><span class="string">//完成的请求数量</span></span><br><span class="line"><span class="attr">Failed requests:</span>        <span class="number">0</span></span><br><span class="line"><span class="string">//失败的请求数量</span></span><br><span class="line"><span class="attr">Write errors:</span>           <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Total transferred:</span>      <span class="number">1361581</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">//整个场景中的网络传输量</span></span><br><span class="line"><span class="attr">HTML transferred:</span>       <span class="number">1055666</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">//整个场景中的HTML内容传输量</span></span><br><span class="line"><span class="attr">Requests per second:</span>    <span class="number">122.12</span> [<span class="comment">#/sec] (mean)</span></span><br><span class="line"><span class="string">//大家最关心的指标之一</span>,<span class="string">相当于</span> <span class="string">LR中的</span> <span class="string">每秒事务数</span>,<span class="string">后面括号中的</span> <span class="string">mean</span> <span class="string">表示这是一个平均值</span></span><br><span class="line"><span class="attr">Time per request:</span>       <span class="number">8188.731</span> [<span class="string">ms</span>] <span class="string">(mean)</span></span><br><span class="line"><span class="string">//大家最关心的指标之二</span>,<span class="string">相当于</span> <span class="string">LR中的</span> <span class="string">平均事务响应时间</span>,<span class="string">后面括号中的</span> <span class="string">mean</span> <span class="string">表示这是一个平均值</span></span><br><span class="line"><span class="attr">Time per request:</span>       <span class="number">8.189</span> [<span class="string">ms</span>] <span class="string">(mean</span>, <span class="string">across</span> <span class="string">all</span> <span class="string">concurrent</span> <span class="string">requests)</span></span><br><span class="line"><span class="string">//每个请求实际运行时间的平均值</span></span><br><span class="line"><span class="attr">Transfer rate:</span>          <span class="number">162.30</span> [<span class="string">Kbytes/sec</span>] <span class="string">received</span></span><br><span class="line"><span class="string">//平均每秒网络上的流量</span>,<span class="string">可以帮助排除是否存在网络流量过大导致响应时间延长的问题</span></span><br><span class="line"></span><br><span class="line"><span class="string">Connection</span> <span class="string">Times</span> <span class="string">(ms)</span></span><br><span class="line">              <span class="string">min</span> <span class="string">mean</span>[<span class="string">+/-sd</span>] <span class="string">median</span>   <span class="string">max</span></span><br><span class="line"><span class="attr">Connect:</span>        <span class="number">4</span> <span class="number">646</span> <span class="number">1078.7     </span><span class="number">89</span>    <span class="number">3291</span></span><br><span class="line"><span class="attr">Processing:</span>   <span class="number">165</span> <span class="number">992</span> <span class="number">493.1</span>    <span class="number">938</span>    <span class="number">4712</span></span><br><span class="line"><span class="attr">Waiting:</span>      <span class="number">118</span> <span class="number">934</span> <span class="number">480.6</span>    <span class="number">882</span>    <span class="number">4554</span></span><br><span class="line"><span class="attr">Total:</span>        <span class="number">813</span> <span class="number">1638 </span><span class="number">1338.9   </span><span class="number">1093    </span><span class="number">7785</span></span><br><span class="line"><span class="string">//网络上消耗的时间的分解</span>,<span class="string">各项数据的具体算法还不是很清楚</span></span><br><span class="line"></span><br><span class="line"><span class="string">Percentage</span> <span class="string">of</span> <span class="string">the</span> <span class="string">requests</span> <span class="string">served</span> <span class="string">within</span> <span class="string">a</span> <span class="string">certain</span> <span class="string">time</span> <span class="string">(ms)</span></span><br><span class="line"><span class="number">50</span><span class="string">%</span>   <span class="number">1093</span></span><br><span class="line"><span class="number">66</span><span class="string">%</span>   <span class="number">1247</span></span><br><span class="line"><span class="number">75</span><span class="string">%</span>   <span class="number">1373</span></span><br><span class="line"><span class="number">80</span><span class="string">%</span>   <span class="number">1493</span></span><br><span class="line"><span class="number">90</span><span class="string">%</span>   <span class="number">4061</span></span><br><span class="line"><span class="number">95</span><span class="string">%</span>   <span class="number">4398</span></span><br><span class="line"><span class="number">98</span><span class="string">%</span>   <span class="number">5608</span></span><br><span class="line"><span class="number">99</span><span class="string">%</span>   <span class="number">7368</span></span><br><span class="line"><span class="number">100</span><span class="string">%</span>   <span class="number">7785</span> <span class="string">(longest</span> <span class="string">request)</span></span><br><span class="line"><span class="string">//整个场景中所有请求的响应情况.在场景中每个请求都有一个响应时间</span>,<span class="string">其中50％的用户响应时间小于1093</span> <span class="string">毫秒</span>,<span class="number">60</span><span class="string">％</span> <span class="string">的用户响应时间小于1247</span> <span class="string">毫秒</span>,<span class="string">最大的响应时间小于7785</span> <span class="string">毫秒</span></span><br></pre></td></tr></table></figure>

<p>由于对于并发请求,cpu实际上并不是同时处理的,而是按照每个请求获得的时间片逐个轮转处理的,所以基本上第一个Time per request时间约等于第二个Time per request时间乘以并发请求数.</p>
]]></content>
  </entry>
  <entry>
    <title>使用 Linux 的 strace 命令跟踪/调试程序</title>
    <url>/2019/06/13/1026/</url>
    <content><![CDATA[<p>安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> strace</span><br></pre></td></tr></table></figure>

<p>使用:</p>
<p>解决phpinfo()中Loaded Configuration File(none)的问题.</p>
<p>命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">strace <span class="regexp">/usr/</span>local<span class="regexp">/php7/</span>sbin/php-fpm -i <span class="number">2</span>&gt;<span class="number">1</span>.log</span><br></pre></td></tr></table></figure>

<p>查看在日志里搜索 php.ini ,就知道程序去哪里查找了.</p>
<p>普通追踪程序:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">strace ls</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>apache Alias指令详解</title>
    <url>/2017/11/18/1030/</url>
    <content><![CDATA[<p>说明映射URL到文件系统的特定区域:</p>
<p>语法     Alias URL-path file-path|directory-path<br>作用域   server config, virtual host<br>状态     基本(B)<br>模块     mod_alias</p>
<p>Alias指令使文档可以被存储在DocumentRoot以外的本地文件系统中.以(%已解码的)url-path路径开头的URL可以被映射到以directory-path开头的本地文件.</p>
<p>示例:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Alias <span class="regexp">/image /</span>ftp<span class="regexp">/pub/im</span>age</span><br></pre></td></tr></table></figure>

<p>对 <code>&quot;http://myserver/image/foo.gif&quot;</code>的请求,服务器将返回 <code>&quot;/ftp/pub/image/foo.gif&quot;</code>文件.因为仅匹配完整路径,所以上述例子不会匹配对 <code>&quot;http://myserver/imagefoo.gif&quot;</code>的请求.对于使用正则表达式的匹配,请参见AliasMatch指令.</p>
<p>注意:如果url-path中有后缀”/“,则服务器要求有后缀”/“以扩展此别名.也就是说 <code>&quot;Alias /icons/ /usr/local/apache/icons/&quot;</code>并不能对 <code>&quot;/icons&quot;</code>实现别名.</p>
<p>注意,可能需要额外指定一个<code>&lt;Directory&gt;</code>段来覆盖别名的最终对象.</p>
<p>.由于只有出现在<code>&lt;Directory&gt;</code>段之前的别名才会被检测,所以它只对最终对象生效.(由于执行别名操作之前<code>&lt;Location&gt;</code>段会被首先扫描一次,所以它们也是有效的).</p>
<p>特别地,如果对在DocumentRoot之外的某个目录建立了一个Alias ,则可能需要明确的对目标目录设定访问权限.</p>
<p>示例:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Alias <span class="regexp">/image /</span>ftp<span class="regexp">/pub/im</span>age &lt;Directory <span class="regexp">/ftp/</span>pub<span class="regexp">/image&gt; Order allow,deny Allow from all &lt;/</span>Directory&gt;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache 防盗链</title>
    <url>/2013/07/05/1031/</url>
    <content><![CDATA[<p>Apache 防盗链的第一种实现方法,可以用 rewrite 实现.首先要确认 Apache 的 rewrite module 可用:能够控制 Apachehttpd.conf 文件的,打开 httpd.conf,确保有这么一行配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure>

<p>然后在找到自己网站对应的 配置的地方,加入下列代码:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span> shuxun.wang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防盗链配置</span></span><br><span class="line"></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://shuxun.wang/.*$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://shuxun.wang$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://www.shuxun.wang/.*$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://www.shuxun.wang$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> .*.(gif|jpg|swf)$ http://www.shuxun.wang/about/nolink.png<span class="meta"> [R,NC]</span></span><br></pre></td></tr></table></figure>

<p>然后重新启动 apache 服务器即可.</p>
<p>有些用户使用的是虚拟主机,没有服务器的控制权,无法修改 httpd.conf 文件和重启服务器.那么请确认你的虚拟主机支持.htaccess,将上面的配置写入 .htaccess 文件,放入根目录或图片所在的目录即可:</p>
<p>.htaccess 文件的内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 防盗链配置</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://shuxun.wang/.*$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://shuxun.wang$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://www.shuxun.wang/.*$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;HTTP_REFERER&#125;</span> !^http://www.shuxun.wang$<span class="meta"> [NC]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> .*.(gif|jpg|swf)$ http://www.shuxun.wang/about/nolink.png<span class="meta"> [R,NC]</span></span><br></pre></td></tr></table></figure>

<p>注意:</p>
<p>httpd.conf 文件里的配置,是在 apache 启动时一次读取,效率很高.<br>.htaccess 文件里的配置,每次访问都需要读取分析,效率很低.<br>使用 SetEnvIfNoCase 和 access 技术实现 Apache 防盗链<br>另一种方式是利用 SetEnvIfNoCase 和 access.具体的代码如下:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">SetEnvIfNoCase Referer <span class="string">&quot;^http://shuxun.wang&quot;</span> <span class="attribute">local_ref</span>=1</span><br><span class="line">SetEnvIfNoCase Referer <span class="string">&quot;^http://www.shuxun.wang&quot;</span> <span class="attribute">local_ref</span>=1</span><br><span class="line"></span><br><span class="line">Order Allow,Deny</span><br><span class="line">Allow <span class="keyword">from</span> <span class="attribute">env</span>=local_ref</span><br></pre></td></tr></table></figure>

<p>将上述代码,放入前面所讲的 httpd.conf 或 .htaccess 文件即可.</p>
]]></content>
  </entry>
  <entry>
    <title>APACHE安全配置</title>
    <url>/2017/01/12/1034/</url>
    <content><![CDATA[<p>Apache服务器走到那里,unix/linux就跟到那里,这足以说明在WEB服务器领域Apache的优良性能与市场占有率.<br>这今天互联网的大环境下,web服务已经成为公司企业必不可少的业务,大多数的安全问题也跟随而来,攻击重点也转移为web攻击,许多web与颇有价值的客户服务与电子商业活动结合在一起,这也是吸引恶意攻击重要原因.<br>先来了解下web所面临的安全风险.</p>
<p>1.HTTP拒绝服务攻击</p>
<p>攻击者通过某些手段使服务器拒绝对http应答,这使Apache对系统资源(cup时间与内存)需求巨增,最终造成系统变慢甚至完全瘫痪,Apache服务器最大的缺点是,它的普遍性使它成为众矢之的,Apache服务器无时无刻不受到DoS攻击威胁,主要有下边几种.</p>
<p>2.数据包洪水攻击</p>
<p>一种中断服务器或本地网络的方法是数据包洪水攻击,它通常使用internet控制报文协议(ICMP,属于网络层协议).<br>包或是udp包,在最简单的形式下,这些攻击都是使服务器或网络负载过重,这意味这攻击者的网络速度必须比目标主机网络速度要快,使用udp包的优势是不会有任何包返回到黑客的计算机(udp效率要比tcp高17倍),而使用ICMP包的优势是攻击者能让攻击更加富与变化,发送有缺陷的包会搞乱并锁住受害者的网络,目前流行的趋势是攻击者欺骗服务器,让其相信正在受来自自身的洪水攻击.</p>
<p>3.磁盘攻击</p>
<p>这是一种很不道德的攻击,它不仅影响计算机的通信,还破坏其硬件,伪造的用户请求利用写命令攻击目标计算机硬盘,让其超过极限,并强制关闭,结局很悲惨.</p>
<p>4.路由不可达</p>
<p>通常DoS攻击,集中在路由器上,攻击者首先获得控制权并操纵目标机器,当攻击者能更改路由表条目时候,会导致整个网络无法通信,这种攻击很阴险,隐蔽,因为网络管理员需要排除的网络不通原因很多,其中一些原因需要详细分辨.</p>
<p>5.分布式拒绝服务攻击</p>
<p>这也是最具有威胁的DDoS攻击,名称很容易理解,简单说就是群欧,很多客户机同时单条服务器,你会发现你将伤痕累累,Apache服务器特别容易受到攻击,无论是DDos还是隐藏来源的攻击,因为Apache无处不在,特别是为Apache特意打造的病毒(特选SSL蠕虫),潜伏在许多主机上,攻击者通过病毒可以操纵大量被感染的机器,对特定目标发动一次浩大的DDoS攻击,通过将蠕虫散播到大量主机,大规模的点对点攻击得以进行,除非你不提供服务,要不然几乎无法阻止这样的攻击,这种攻击通常会定位到大型的网站上.</p>
<p>缓冲区溢出,这种攻击很普遍,攻击者利用CGI程序编写一些缺陷程序偏离正常的流程,程序使用静态的内存分配,攻击者就可以发送一个超长的请求使缓冲区溢出,比如,一些perl编写的处理用户请求的网关脚本,一但缓冲区溢出,攻击者就可以执行恶意指令.</p>
<p>非法获取root权限<br>如果Apache以root权限运行,系统上一些程序的逻辑缺陷或缓冲区溢出漏洞,会让攻击者很容易在本地系统获取linux服务器上的管理者权限,在一些远程情况下,攻击者会利用一些以root身份执行的有缺陷的系统守护进程来取得root权限,或利用有缺陷的服务进程漏洞来取得普通用户权限,以远程登陆,进而控制整个系统.</p>
<p>这边这些都是服务将会遇到的攻击手段,下边来说,如何打造安全的Apache服务器.<br>如果你能遵守下边这些建议,那么你将得到一台相对安全的apache服务器.</p>
<p>一:勤打补丁</p>
<p>你必须要相信这个是最有用的手段,缓冲区溢出等漏洞都必须使用这种手段来防御,勤快点相信对你没有坏处.<br>在http:<a href="http://www.apache.org/">www.apache.org</a> 上最新的changelog中都写有:bug fix ,security bug fix的字样,做为负责任的管理员要经常关注相关漏洞,及时升级系统添加补丁.使用最新安全版本对加强apache至关重要.</p>
<p>二:隐藏和伪装Apache的版本</p>
<p>打乱攻击者的步骤,给攻击者带来麻烦,相信是管理员愿意看到的.软件的漏洞信息和版本是相关的,在攻击者收集你服务软件信息时候给与迷惑是个不错的选择,何况版本号,对攻击者来说相当与GPS定位一样重要.<br>默认情况,系统会把apache版本模块都显示出来(http返回头),如果列举目录的话,会显示域名信息(文件列表正文),去除Apache版本号的方法是修改配置文件,找到关键字,修改为下边.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ServerSignature</span> <span class="literal">off</span></span><br><span class="line">ServerTokens prod</span><br></pre></td></tr></table></figure>

<p>通过分析web服务器类型,大致可以推测操作系统类型,win使用iis,linux普遍apache,默认的Apache配置里没有任何信息保护机制,并且允许目录浏览,通过目录浏览,通常可以得到类似”apache/1.37 Server at apache.linuxforum.net Port 80”或”apache/2.0.49(unix)PHP/4.3.8”的信息.<br>通过修改配置文件中的ServerTokens参数,可以将Apache的相关信息隐藏起来,如果不行的话,可能是提示信息被编译在程序里了,要隐藏需要修改apache的源代码,然后重新编译程序,以替换内容.<br>编辑ap_release.h文件,<br>修改</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;<span class="subst">#define</span> AP_SERVER_BASEPRODUCT&quot;</span><span class="string">&quot;Apache&quot;</span></span><br></pre></td></tr></table></figure>

<p>为</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;<span class="subst">#define</span> AP_SERVER_BASEPRODUCT&quot;</span><span class="string">&quot;Microsoft-IIS/5.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>编辑os/unix/os.h文件:<br>修改</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;<span class="subst">#define</span> PLATFORM&quot;</span><span class="string">&quot;Unix&quot;</span></span><br></pre></td></tr></table></figure>

<p>为</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;#define PLATFORM&quot;</span><span class="symbol">&#x27;Win32</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>修改完成后,重新编译,安装apache,在修改配置文件为上边做过的,再次启动apache后,用工具扫描,发现提示信息中已经显示为windows操作系统了.<br>顺便说下,现在这个论坛,就有点不太讲究,这是论坛错误的返回信息,看了有点汗地感觉.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Apache</span>/<span class="number">2</span>.<span class="number">2</span>.<span class="number">8</span> (Ubuntu) DAV/<span class="number">2</span> SVN/<span class="number">1</span>.<span class="number">4</span>.<span class="number">6</span> mod_ssl/<span class="number">2</span>.<span class="number">2</span>.<span class="number">8</span> OpenSSL/<span class="number">0</span>.<span class="number">9</span>.<span class="number">8</span>g Server at forum.ubuntu.org.cn Port <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>这个等于告诉恶意用户很多有用信息,虽然说不算开了门,但等于被告诉了门在那里,还是相当危险的.</p>
<p>三:建立安全的目录结构apache服务器包括四个目录结构</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">ServerRoot <span class="meta">#保存配置文件,二进制文件与其他服务器配置文件</span></span><br><span class="line">DocumentRoot <span class="meta">#保存web站点内容,包括HTML文件和图片等</span></span><br><span class="line">ScripAlias <span class="meta">#保存CGI脚本</span></span><br><span class="line">Customlog 和 <span class="keyword">Errorlog</span> <span class="meta">#保存日志和错误日志</span></span><br></pre></td></tr></table></figure>

<p>建议的目录结构为,以上四种目录相互独立并且不存在父子逻辑关系.<br>注:<br>ServerRoot目录只能为root用户访问<br>DocumentRoot目录应该能够被管理web站点内容的用户访问和使用apache服务器的apache用户与组访问<br>ScripAlias目录应该只能被CGI开发人员和apache用户访问<br>Customlog 和 Errorlog只能被root访问</p>
<p>下边是一个安全目录结构的事例:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">+-------/etc/</span><br><span class="line"><span class="string">|</span></span><br><span class="line"><span class="string">| +----/http (ServerRoot)</span></span><br><span class="line"><span class="string">| +----/logs (Customlog 和 Errorlog)</span></span><br><span class="line"><span class="string">|</span></span><br><span class="line">+-------var/www</span><br><span class="line"><span class="string">|</span></span><br><span class="line"><span class="string">| +---/cgi-bin (ScripAlias)</span></span><br><span class="line"><span class="string">| +---/html (DocumentRoot)</span></span><br></pre></td></tr></table></figure>

<p>这样的目录结构是比较安全的,因为目录之间独立,某个目录权限错误不会影响到其他目录.</p>
<p>四:为apache使用专门的用户与组</p>
<p>按照最小特权的原则,需要给apache分配一个合适的权限,让其能够完成web服务.<br>注:<br>最小特权原则是系统安全中最基本的原则之一,限制使用者对系统及数据进行存取所需要的最小权限,保证用户可以完成任务,同时也确保被窃取或异常操作所造成的损失.</p>
<p>必须保证apache使用一个专门的用户与组,不要使用系统预定的帐户,比如nobody用户与nogroup组.<br>因为只有root用户可以运行apache,DocumentRoot应该能够被管理web站点内容的用户访问和使用.apache服务器的 apache用户与组访问,例如,希望”test”用户在web站点发布内容,并且可以以httpd身份运行apache服务器,可以这样设定.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">groupadd webteam</span><br><span class="line">usermod -G webteam test</span><br><span class="line">chown -R httpd.webteam <span class="regexp">/www/</span>html</span><br><span class="line">chmod -R <span class="number">2570</span> <span class="regexp">/www/</span>htdocs</span><br><span class="line"><span class="comment">#只有root能访问日志,推荐这样的权限</span></span><br><span class="line">chown -R root.root <span class="regexp">/etc/</span>logs</span><br><span class="line">chown -R <span class="number">700</span> <span class="regexp">/etc/</span>logs</span><br></pre></td></tr></table></figure>

<p>五:web目录的访问策略</p>
<p>对于可以访问的web目录,要使用相对保守的途径进行访问,不要让用户查看任何目录索引列表.<br>禁止使用目录索引:<br>apache在接到用户对一个目录的访问时,会查找DirectoryIndex指令指定的目录索引文件,默认为index.html,如果该文件不存在,那么apache会创建动态列表为用户显示该目录的内容,这样就会暴露web站点结构,因此需要修改配置文件禁止显示动态目录索引,修改httpd.conf.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">Options</span></span> -Indexes FollowSymLinks</span><br></pre></td></tr></table></figure>

<p>Options指令通知apache禁止使用目录索引,FollowSymLinks表示不允许使用符号连接.<br>禁止默认访问:<br>要的安全策略必须要禁止默认访问的存在,只对指定的目录开放权限,如果允许访问 <code>/var/www/html</code>目录,使用如下设定.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">deny</span>,<span class="literal">allow</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br></pre></td></tr></table></figure>

<p>禁止用户重载:<br>为了禁止用户对目录配置文件(htaccess)进行重载(修改),可以这样设定.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">AllowOverride <span class="attribute">None</span></span><br></pre></td></tr></table></figure>

<p>六:apache服务器访问控制</p>
<p>apache的access.conf文件负责设置文件的访问权限,可以实现互联网域名和ip地址的访问控制.<br>如允许192.168.1.1到192.168.1.254的主机访问,可以这样设定.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">deny</span>,<span class="literal">allow</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">allow</span></span> from pair <span class="number">192.168.1.0</span>/<span class="number">255.255.255.0</span></span><br></pre></td></tr></table></figure>

<p>七:apache服务器的密码保护</p>
<p>.htaccess文件是apache上的一个设置文件,它是一个文本文件,.htaccess文件提供了针对目录改变配置的方法.<br>既通过在一个特定的文档目录中放置一个包含一个或多个指令的文件(.htaccess文件),以作用于此目录和子目录.<br>.htaccess的功能包括设置网页密码,设置发生错误时出现的文件,改变首业的文件名.(如,index.html),禁止读取文件名,重新导向文件,加上MIME类别,禁止目录下的文件等.<br>注:.htaccess是一个完整的文件名,不是***.htaccess或其他格式,在/abc目录下放置一个.htaccess文件,那么/abc与它的子目录都会被这个文件影响,但/index.html不会被影响.</p>
<p>.htaccess的建立和使用比较复杂点,如果感兴趣的朋友可以回帖发问,这里就不具体写出来了,这种保护要比某些程序实现的保护安全,那种方法可以通过被猜测方法获取密码,用.htaccess很难被破解,但文本方式的验证会比较慢,对少量用户没影响,但对大量用户就必须使用带数据模块的验证了,这需要编译源代码时候开启模块,默认是不开启的.</p>
<p>八:让apache运行在”监牢”中</p>
<p>“监牢”的意思是指通过chroot机制来更改某个软件运行时所能看到的根目录,简单说,就是被限制在指定目录中,保证软件只能对该目录与子目录文件有所动作,从而保证整个服务器的安全,即使被破坏或侵入,损伤也不大.<br>以前,unix/linux上的daemon都是以root权限启动的,当时,这是一件理所当然的事情,像apache这样的服务器软件,需要绑定到80端口上来监听请求,而root是唯一有这种权限的用户,随着攻击手段和强度的增加,这样会使服务器受到相当大的威胁,一但被利用缓冲区溢出漏洞,就可以控制整个系统.现在的服务器设计通常以root启动,然后进程放弃root权限,改为某个低级的帐号运行.这种方式显然会降低对系统的危害,但攻击者还是会寻找漏洞提升权限,即使无法获得root权限,也可以删除文件,涂改主页等.<br>为了进一步提高系统安全性,linux内核引入chroot机制,chroot是内核中的一个系统调用,软件可以通过调用函数库的chroot 函数,来更改某个进程所能见到的跟目录,比如,apache软件安装在/usr/local/httpd目录,以root启动apache,这个root 权限的父进程会派生数个以nobody权限运行的子进程,父进程监听80端口,然后交给某个子进程处理,这时候子进程所处的目录续承父进程,即/usr /local/httpd目录,但是一但目录权限设定错误,被攻击的apache子进程可以访问/usr/local , /usr ,/tmp甚至整个文件系统,因为apache进程所处的跟目录仍然是整个文件系统的跟目录,如果可以用chroot将apache限制在/usr /local/httpd/下,那么apache所存取的文件都被限制在/usr/local/httpd下,创建chroot监牢的作用就是将进程权限限制在文件目录树下,保证安全.<br>如果自己手动apache的监牢,将是很烦琐和复杂的工作,需要牵扯到库文件,这里可以使用jail包来简化监牢的实现.<br>jail的官方网站为: 有兴趣可以逛逛.<br>这里也不写出具体的创建过程稍微麻烦,如果对安全有需要的话,请回帖,会及时补上.</p>
<p>九:apache服务器防范Dos</p>
<p>apache服务经常会碰到Dos攻击,防范的主要手段是通过软件,apahce Dos Evasive Maneuvers Module.<br>来实现的,它是一款mod_access的代替软件,可以对抗DoS攻击,该软件可以快速拒绝来自相同地址对同一URL的重复请求,通过查询内部一张各子进程的哈希表来实现.<br>可以到网址:<a href="http://online/.securityfocus.com/tools/">http://online/.securityfocus.com/tools/</a> 上下载软件.</p>
<p>十:减少CGI和SSI风险</p>
<p>CGI脚本的漏洞已经成为WEB服务器的首要安全隐患,通常是程序编写CGI脚本产生了许多漏洞,控制CGI的漏洞除了在编写时候注意对输入数据的合法检查,对系统调用的谨慎使用等因素外,首先使用CGI程序所有者的ID来运行这些程序,即使被漏洞危害也仅限于该ID能访问的文件,不会对整个系统带来致命的危害,因此需要谨慎使用CGI程序.<br>1.3版的apache集成了suEXEC程序,可以为apache提供CGI程序的控制支持,可以把suEXEC看做一个包装器,在Apache接到CGI程序的调用请求后,把这个请求交给suEXEC来负责完成具体调用,并从suEXEC返回结果,suEXEC可以解决一些安全问题,但会影响速度.<br>如果是对安全性要求很高时候,建议使用suEXEC,此外还有一个软件CGIWrap,它的安全性要高与suEXEC减少SSI脚本风险,如果用exec等SSI命令运行外部程序,也会存在类似CGI脚本风险,除了内部调试程序时,应使用.<br>option命令禁止其使用:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Option</span> IncludesNOEXEC</span><br></pre></td></tr></table></figure>

<p>十一:使用ssl加固Apache</p>
<p>使用具有SSL功能的服务器,可以提高网站敏感页的安全性能,SSL工作与TCP/IP协议和HTTP协议之间<br>SSL可以加密互联网上传递的数据流,提供身份验证,在线购物而不必担心别人窃取信用卡信息,在基于电子商务和基于web邮件的地方非常重要.<br>SSL的应用相对还是比较麻烦的,有需要的话,可以发贴或查看资料,这几就不多写,篇幅不够.</p>
]]></content>
  </entry>
  <entry>
    <title>apache 隐藏版本信息</title>
    <url>/2016/12/09/1032/</url>
    <content><![CDATA[<p>1.隐藏Apache版本信息</p>
<p>测试默认 apache 的状态信息</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[root@<span class="number">1314</span>it conf]# curl -<span class="keyword">Is</span> localhost</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="type">Date</span>: Tue, <span class="number">16</span> Nov <span class="number">2010</span> <span class="number">04</span>:<span class="number">20</span>:<span class="number">15</span> GMT</span><br><span class="line"><span class="keyword">Server</span>: Apache/<span class="number">2.2</span><span class="number">.3</span> (CentOS) DAV/<span class="number">2</span> PHP/<span class="number">5.1</span><span class="number">.6</span> mod_perl/<span class="number">2.0</span><span class="number">.4</span> Perl/v5<span class="number">.8</span><span class="number">.8</span></span><br><span class="line">X-Powered-<span class="keyword">By</span>: PHP/<span class="number">5.1</span><span class="number">.6</span></span><br><span class="line"><span class="keyword">Connection</span>: <span class="keyword">close</span></span><br><span class="line">Content-<span class="keyword">Type</span>: <span class="type">text</span>/html; charset=GB2312</span><br></pre></td></tr></table></figure>

<p>修改主配置文件 httpd.conf</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ServerSignature</span> <span class="literal">Off</span></span><br><span class="line"><span class="attribute">ServerTokens</span> Prod</span><br></pre></td></tr></table></figure>

<p>重启 apache 测试</p>
<p>测试隐藏版本号后 apache 的状态信息</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[root@<span class="number">1314</span>it conf]# curl -<span class="keyword">Is</span> localhost</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="type">Date</span>: Tue, <span class="number">16</span> Nov <span class="number">2010</span> <span class="number">04</span>:<span class="number">21</span>:<span class="number">41</span> GMT</span><br><span class="line"><span class="keyword">Server</span>: Apache</span><br><span class="line">X-Powered-<span class="keyword">By</span>: PHP/<span class="number">5.1</span><span class="number">.6</span></span><br><span class="line"><span class="keyword">Connection</span>: <span class="keyword">close</span></span><br><span class="line">Content-<span class="keyword">Type</span>: <span class="type">text</span>/html; charset=GB2312</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache安装常见配置</title>
    <url>/2017/04/13/1035/</url>
    <content><![CDATA[<p>打开Apache下的conf文件夹,修改”httpd.conf”这个配置文件.<br>默认路径如:<code>C:Program Files\Apache Software Foundation\Apache2.2conf</code>.</p>
<p>1、修改主目录</p>
<p>将”&lt;Directory “ “&gt;”和”DocumentRoot”这里修改一致,如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;D:websitemakednew_popx.us&quot;</span>&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">&quot;D:websitemakednew_popx.us&quot;</span></span><br></pre></td></tr></table></figure>

<p>2、修改首页文件</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">     DirectoryIndex <span class="keyword">index</span>.html <span class="keyword">index</span>.htm <span class="keyword">index</span>.shtml</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p>3、增加虚拟目录</p>
<p>在 httpd.conf 的 alias_module 下增加一别名定义项,<br>如:<code>Alias &quot;/gg&quot; &quot;D:websitegg&quot;</code>,即可定义虚拟目录.</p>
<p><code>/gg</code> 是网页的目录名称,<code>&quot;D:websitegg&quot;</code> 是网页文件的物理路径.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Alias</span> <span class="string">&quot;/gg&quot;</span> <span class="string">&quot;D:websitegg&quot;</span></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;D:websitegg&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>4、禁止目录访问</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;D:websitemakedggedison&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>将其中的”Options Indexes FollowSymLinks”取消,或者将其修改为”Options -Indexes FollowSymLinks”.</p>
<p>5、虚拟主机配置</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory /&gt;</span></span><br><span class="line">     <span class="attribute"><span class="nomarkup">Options</span></span> FollowSymLinks</span><br><span class="line">     <span class="attribute">AllowOverride</span> None</span><br><span class="line">     <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">deny</span>,<span class="literal">allow</span></span><br><span class="line">     <span class="attribute"><span class="nomarkup">Deny</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>1、先将其中的”Deny from all”修改成”Allow from all”.<br>2、要保证 Listen 80.<br>3、然后写入下面的代码.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NameVirtualHost</span> *:<span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> www.<span class="number">429006</span>.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">&quot;D:websitegg&quot;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> <span class="number">1</span>.<span class="number">429006</span>.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">&quot;D:websitefirefox&quot;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意:其中的”NameVirtualHost <em>:80”不能丢,还有就是这里面的”</em>:80”是不能修改的,不要以为”*”是需要修改的,这里不能修改.</p>
<p>6、虚拟主机权限设置</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;虚拟主机网站目录&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span> </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache 中 KeepAlive 配置的合理使用</title>
    <url>/2012/03/16/1033/</url>
    <content><![CDATA[<p>在 Apache 服务器中,KeepAlive 是一个布尔值,On 代表打开,Off 代表关闭,这个指令在其他众多的 HTTPD 服务器中都是存在的.</p>
<p>KeepAlive 配置指令决定当处理完用户发起的 HTTP 请求后是否立即关闭 TCP 连接,如果 KeepAlive 设置为On,那么用户完成一次访问后,不会立即断开连接,如果还有请求,那么会继续在这一次 TCP 连接中完成,而不用重复建立新的 TCP 连接和关闭TCP 连接,可以提高用户访问速度.</p>
<p>那么我们考虑3种情况:</p>
<p>1.用户浏览一个网页时,除了网页本身外,还引用了多个 javascript 文件,多个 css 文件,多个图片文件,并且这些文件都在同一个 HTTP 服务器上.<br>2.用户浏览一个网页时,除了网页本身外,还引用一个 javascript 文件,一个图片文件.<br>3.用户浏览的是一个动态网页,由程序即时生成内容,并且不引用其他内容.<br>对于上面3中情况,我认为:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span>最适合打开 KeepAlive ,<span class="number">2</span> 随意,<span class="number">3</span> 最适合关闭 KeepAlive</span><br></pre></td></tr></table></figure>

<p>下面我来分析一下原因.<br>在 Apache 中,打开和关闭 KeepAlive 功能,服务器端会有什么异同呢?</p>
<p>先看看理论分析.</p>
<p>打开 KeepAlive 后,意味着每次用户完成全部访问后,都要保持一定时间后才关闭会关闭 TCP 连接,那么在关闭连接之前,必然会有一个Apache 进程对应于该用户而不能处理其他用户,假设 KeepAlive 的超时时间为 10 秒种,服务器每秒处理 50个独立用户访问,那么系统中 Apache 的总进程数就是 10 * 50 ＝ 500 个,如果一个进程占用 4M 内存,那么总共会消耗 2G内存,所以可以看出,在这种配置中,相当消耗内存,但好处是系统只处理了 50次 TCP 的握手和关闭操作.</p>
<p>如果关闭 KeepAlive,如果还是每秒50个用户访问,如果用户每次连续的请求数为3个,那么 Apache 的总进程数就是 50 * 3= 150 个,如果还是每个进程占用 4M 内存,那么总的内存消耗为 600M,这种配置能节省大量内存,但是,系统处理了 150 次 TCP的握手和关闭的操作,因此又会多消耗一些 CPU 资源.</p>
<p>在看看实践的观察.</p>
<p>我在一组大量处理动态网页内 容的服务器中,起初打开 KeepAlive功能,经常观察到用户访问量大时Apache进程数也非常多,系统频繁使用交换内存,系统不稳定,有时负载会出现较大波动.关闭了 KeepAlive功能后,看到明显的变化是: Apache 的进程数减少了,空闲内存增加了,用于文件系统Cache的内存也增加了,CPU的开销增加了,但是服务更稳定了,系统负载也比较稳定,很少有负载大范围 波动的情况,负载有一定程度的降低;变化不明显的是:访问量较少的时候,系统平均负载没有明显变化.</p>
<p>总结一下:<br>在内存非常充足的服务器上,不管是否关闭 KeepAlive 功能,服务器性能不会有明显变化;<br>如果服务器内存较少,或者服务器有非常大量的文件系统访问时,或者主要处理动态网页服务,关闭 KeepAlive 后可以节省很多内存,而节省出来的内存用于文件系统Cache,可以提高文件系统访问的性能,并且系统会更加稳定.</p>
<p>补充1:关于是否应该关闭 KeepAlive 选项,我觉得可以基于下面的一个公式来判断.</p>
<p>在理想的网络连接状况下,系统的 Apache 进程数和内存使用可以用如下公式表达:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">HttpdProcessNumber</span> = KeepAliveTimeout * TotalRequestPerSecond / Average(KeepAliveRequests)</span><br><span class="line"><span class="attr">HttpdUsedMemory</span> = HttpdProcessNumber * MemoryPerHttpdProcess</span><br></pre></td></tr></table></figure>

<p>换成中文:<br>总Apache进程数 = KeepAliveTimeout * 每秒种HTTP请求数 / 平均KeepAlive请求<br>Apache占用内存 = 总Apache进程数 * 平均每进程占用内存数</p>
<p>需要特别说明的是:<br>[平均KeepAlive请求] 数,是指每个用户连接上服务器后,持续发出的 HTTP 请求数.当 KeepAliveTimeout 等 0或者 KeepAlive 关闭时,KeepAliveTimeout 不参与乘的运算从上面的公式看,如果 [每秒用户请求]多,[KeepAliveTimeout] 的值大,[平均KeepAlive请求] 的值小,都会造成 [Apache进程数] 多和 [内存]多,但是当 [平均KeepAlive请求] 的值越大时,[Apache进程数] 和 [内存] 都是趋向于减少的.</p>
<p>基于上面的公式,我们就可以推算出当 平均KeepAlive请求 &lt;= KeepAliveTimeout 时,关闭 KeepAlive 选项是划算的,否则就可以考虑打开.</p>
<p>补充2:KeepAlive 该参数控制Apache是否允许在一个连接中有多个请求,默认打开.但对于大多数论坛类型站点来说,通常设置为off以关闭该支持.</p>
<p>补充3:如果服务器前跑有应用squid服务,或者其它七层设备,KeepAlive On 设定要开启持续长连接<br>实际在 前端有 squid 的情况下, KeepAlive 很关键.记得 On.</p>
]]></content>
  </entry>
  <entry>
    <title>Apache防DDOS模块</title>
    <url>/2017/06/29/1038/</url>
    <content><![CDATA[<p>Apache防DDOS模块mod_evasive的安装配置和使用.<br>前些天,朋友的网站访问很慢,查服务器的连接数也不多,资源占用也少.怀疑有攻击,便想装上mod_evasive试试,试后一切正常,很爽.</p>
<p>安装配置如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.zdziarski.com<span class="regexp">/blog/</span>wp-content<span class="regexp">/uploads/</span><span class="number">2010</span><span class="regexp">/02/m</span>od_evasive_1.<span class="number">10.1</span>.tar.gz</span><br><span class="line">tar zxvf mod_evasive_1.<span class="number">10.1</span>.tar.gz</span><br><span class="line">cd mod_evasive</span><br><span class="line"><span class="regexp">/www/</span>wdlinux<span class="regexp">/apache/</span>bin/apxs -i -a -c mod_evasive20.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/www/</span>wdlinux<span class="regexp">/apache/</span>conf/httpd.conf</span><br><span class="line"></span><br><span class="line">&lt;ifModule mod_evasive20.c&gt;</span><br><span class="line">    DOSHashTableSize    <span class="number">3097</span></span><br><span class="line">    DOSPageCount        <span class="number">5</span></span><br><span class="line">    DOSSiteCount        <span class="number">50</span></span><br><span class="line">    DOSPageInterval     <span class="number">1</span></span><br><span class="line">    DOSSiteInterval     <span class="number">1</span></span><br><span class="line">    DOSBlockingPeriod   <span class="number">360</span></span><br><span class="line">&lt;/ifModule&gt;</span><br></pre></td></tr></table></figure>

<p>mod_evasive 介绍:</p>
<p>mod_evasive 是Apache(httpd)服务器的防DDOS的一个模块.对于WEB服务器来说,是目前比较好的一个防护DDOS攻击的扩展模块.虽然并不能完全防御 DDOS攻击,但在一定条件下,还是起到缓服Apache(httpd)服务器的压力.如配合iptables、硬件防火墙等防火墙设备配合使用,可能有更好的效果.<br>mod_evasive 的官方地址: <a href="http://www.zdziarski.com/">http://www.zdziarski.com</a></p>
<p>相关参数:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">DOSHashTableSize <span class="number">3097</span>:定义哈希表大小.</span><br><span class="line">DOSSiteCount <span class="number">50</span>:允许客户机的最大并发连接.</span><br><span class="line">DOSPageCount <span class="number">2</span>:允许客户机访问同一页的间隔.</span><br><span class="line">DOSPageInterval <span class="number">1</span>:网页访问计数器间隔.</span><br><span class="line">DOSSiteInterval <span class="number">1</span>:全站访问计数器间隔.</span><br><span class="line">DOSSiteInterval <span class="number">60</span>:加入黑名单后拒绝访问时间.</span><br><span class="line">DOSEmailNotify xxxx@gmail.com:有IP加入黑名单后通知管理员.</span><br><span class="line">DOSSystemCommand <span class="string">&quot;sudo iptables -A INPUT -s %s -j DROP&quot;</span>:IP加入黑名单后执行的系统命令.</span><br><span class="line">DOSLogDir <span class="string">&quot;/tmp&quot;</span>:锁定机制临时目录.</span><br><span class="line">DOSWhiteList <span class="number">127.0</span>.<span class="number">0.1</span>:防范白名单,不阻止白名单IP.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache报告No space left on device的解决办法</title>
    <url>/2019/01/14/1036/</url>
    <content><![CDATA[<p>今天在开发时突然apache无法启动了.表现为,输入 httpd -X 后片刻自动退出,同时在error_log中有如下内容:</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[Fri Aug 15 10:54:31 2008]</span> <span class="selector-attr">[emerg]</span> (<span class="number">28</span>)No space <span class="attribute">left</span> on device: Couldn<span class="string">&#x27;t create accept lock</span></span><br></pre></td></tr></table></figure>

<p>df一下发现不是磁盘空间的问题.Google了一下就找到了解决方案,原来是系统的信号量不够用了.用以下命令可以查看所有的信号量:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">$ ipcs -s</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key semid owner perms nsems</span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19234816</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19267585</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19300354</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19398659</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19431428</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19464197</span> nobody <span class="number">600</span> <span class="number">1</span></span><br><span class="line"><span class="number">0x00000000</span> <span class="number">19562502</span> nobody <span class="number">600</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>然后用这行命令删除所有的信号量即可:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">ipcs -s | <span class="keyword">grep</span> nobody | <span class="keyword">perl</span> -lane <span class="string">&#x27;print \`ipcrm sem $F[1]\`&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>apache多个本地虚拟服务名指向同一目录的问题的解决</title>
    <url>/2017/05/07/1037/</url>
    <content><![CDATA[<p>很久没用apache了(因为太膜拜nginx的缘故),最近连虚拟目录都忘了怎么配置,网上找一大堆,没解决我的问题.<br>我是在自己电脑上虚拟几个地址.貌似以前使用的时候(不记得什么版本了,大概1.5 1.6几的),这样写一堆:</p>
<p>那是刚学的时候,记忆模糊</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">&quot;E:/wwwroot/yam&quot;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span>   yam.com</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>

<p>就直接能够运行多个虚拟的地址——都成浮云了.最近装了xampp 1.7.4,几翻搜索有了一些了解.</p>
<p>因为是在本机运行,只有一个IP,我一开始便使用了基于域名写法:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NameVirtualHost</span> *:<span class="number">80</span> ; </span><br><span class="line"><span class="section">&lt;VirtualHost www.site1.com<span class="number">:80</span>&gt;</span> </span><br><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span> www.site<span class="number">1</span>.com</span><br><span class="line"><span class="attribute">ServerAlias</span>  *.site<span class="number">1</span>.com</span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:/www/site<span class="number">1</span></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/www/site1&quot;</span>&gt;</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Options</span></span> Indexes MultiViews</span><br><span class="line"> <span class="attribute">AllowOverride</span> None</span><br><span class="line"> <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span> </span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span> </span><br><span class="line"><span class="section">&lt;VirtualHost www.site2.com<span class="number">:80</span>&gt;</span> </span><br><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span> www.site<span class="number">2</span>.com </span><br><span class="line"><span class="attribute">ServerAlias</span>  www.site<span class="number">2</span>.com</span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:/www/site<span class="number">2</span> </span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/www/site2&quot;</span>&gt;</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Options</span></span> Indexes MultiViews</span><br><span class="line"> <span class="attribute">AllowOverride</span> None</span><br><span class="line"> <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span> </span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span> </span><br></pre></td></tr></table></figure>

<p>浏览器运行文件之后发现,上面所虚拟的2个名称,指向的目录不是site1就是site2的目录(不会随机指向其中一个,而是你对配置文件稍稍修改优先级便有了变化,一直指向同一个目录).</p>
<p>搞得纳闷,也许遇到同样问题的人没想到一个简单的存在,hosts里面的这些域名是对应到127.0.0.1,便对两个名称使用同一<code>&lt;Drectory&gt;&lt;/Drectory&gt;</code>.如果外网访问的话我没试过,两个域名也可解析到同一IP,这样的问题是否同样会出现?如果是的话,我就正确了.</p>
<p>可以改成这样,便可以分别访问到了:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span>   yam.com</span><br><span class="line"></span><br><span class="line"><span class="attribute">ServerAlias</span>  yam.com</span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:/wwwroot</span><br><span class="line"><span class="attribute">DirectoryIndex</span> index.php default.php index.html index.htm</span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/wwwroot&quot;</span>&gt;</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Options</span></span> Indexes MultiViews</span><br><span class="line"> <span class="attribute">AllowOverride</span> None</span><br><span class="line"> <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span>   chinasonic.com</span><br><span class="line"><span class="attribute">ServerAlias</span>  *.chinasonic.com</span><br><span class="line"><span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:/wwwroot/the<span class="number">1</span></span><br><span class="line"><span class="attribute">DirectoryIndex</span> index.php default.php index.html index.htm</span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/wwwroot/the1&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">#Options Indexes MultiViews</span></span><br><span class="line"> <span class="attribute">AllowOverride</span> None</span><br><span class="line"> <span class="attribute"><span class="nomarkup">order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line"> <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>APACHE开启GZIP压缩的方法</title>
    <url>/2015/07/04/1041/</url>
    <content><![CDATA[<p>最近几天一直为新买的VPS做配置,网站一直没有更新,今天就说一下关于APACHE开启gzip的方法,当然这也是配置VPS遇到一个问题,说一下方法.至于为什么要开启gzip不懂的同学可以在网上搜搜,看看GZIP开启的好处,在这里就不多说了,直接说方法.</p>
<p>APACHE的开启GZIP的方法:</p>
<p>首先要先打开apache里面的CONF文件,编辑httpd.conf文件,把下面两个模块开启.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> headers_module modules/mod_headers.so</span><br><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> deflate_module modules/mod_deflate.so</span><br></pre></td></tr></table></figure>

<p>开启方法,就是把前面的”#”去掉.把以下代码复制到httpd.conf最下方空白处就行了,代码如下:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">DeflateCompressionLevel <span class="number">3</span></span><br><span class="line">AddOutputFilter DEFLATE html xml php js css</span><br><span class="line">&lt;Location /&gt;</span><br><span class="line">SetOutputFilter DEFLATE</span><br><span class="line">BrowserMatch ^Mozilla/<span class="number">4</span> gzip-only-text/html</span><br><span class="line">BrowserMatch ^Mozilla/<span class="number">4.0</span>[<span class="number">678</span>] no-gzip</span><br><span class="line">BrowserMatch bMSIE !no-gzip !gzip-only-text/html</span><br><span class="line">SetEnvIfNoCase Request_URI .(?<span class="symbol">:gif|jpe?g|png</span>)<span class="variable">$ </span>no-gzip dont-vary</span><br><span class="line">SetEnvIfNoCase Request_URI .(?<span class="symbol">:exe|t?gz|zip|bz2|sit|rar</span>)<span class="variable">$ </span>no-gzip dont-vary</span><br><span class="line">SetEnvIfNoCase Request_URI .(?<span class="symbol">:pdf|mov|avi|mp3|mp4|rm</span>)<span class="variable">$ </span>no-gzip dont-vary</span><br><span class="line"></span><br><span class="line">Header append Vary User-Agent env=!dont-vary</span><br><span class="line">&lt;<span class="regexp">/Location&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中DeflateCompressionLevel 3是设置的压缩比例,压缩比率的取值范围在 1(最低) 到 9(最高)之间,不建议设置太高,虽然有很高的压缩率,但是占用更多的CPU资源.<br>最后重启一下apache服务器就可以了.最后检测一下,看看是否开启成功.<br>测试网址:<a href="http://tool.chinaz.com/Gzips/">http://tool.chinaz.com/Gzips/</a></p>
]]></content>
  </entry>
  <entry>
    <title>Apache缓存系统</title>
    <url>/2013/04/23/1040/</url>
    <content><![CDATA[<p>apache cookbook有个叫mem_cahce的模块,使用mem_cache模块,编译apache时候必须添加:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;--enable-cache&quot;</span></span><br><span class="line"><span class="string">&quot;--enable-mem-cache&quot;</span></span><br></pre></td></tr></table></figure>

<p>或者使用apxs -ica 添加模块.</p>
<p>mod_mem_cache需要mod_cache模块的支持.</p>
<p>mem_cache 简单应用:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;IfModule mod_cache.c&gt;</span></span><br><span class="line">    <span class="section">&lt;IfModule mod_mem_cache.c&gt;</span></span><br><span class="line">        <span class="attribute">CacheEnable</span> mem /</span><br><span class="line">        <span class="attribute">MCacheSize</span> <span class="number">262144</span></span><br><span class="line">        <span class="attribute">MCacheMaxObjectCount</span> <span class="number">10000</span></span><br><span class="line">        <span class="attribute">MCacheMinObjectSize</span> <span class="number">1</span></span><br><span class="line">        <span class="attribute">MCacheMaxObjectSize</span> <span class="number">1000000</span></span><br><span class="line">        <span class="attribute">MCacheRemovalAlgorithm</span> LRU</span><br><span class="line">    <span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>

<p>说明:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">CacheEnable mem /                   <span class="comment">#需要存储的目录.</span></span><br><span class="line">MCacheSize<span class="number"> 262144 </span>                  <span class="comment">#cache使用内存的最大数量(kbyte)</span></span><br><span class="line">MCacheMaxObjectCount<span class="number"> 10000 </span>         <span class="comment">#允许在cache中存储的最大数量</span></span><br><span class="line">MCacheMinObjectSize<span class="number"> 1 </span>              <span class="comment">#最小允许在cache中存储文件的字节数(byte)</span></span><br><span class="line">MCacheMaxObjectSize<span class="number"> 1000000 </span>        <span class="comment">#最大允许在cache中存储文件的字节书(byte)</span></span><br><span class="line">MCacheRemovalAlgorithm LRU          <span class="comment">#文件在cache中使用的算法(默认GDSF)</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Apache高性能配置</title>
    <url>/2016/04/23/1039/</url>
    <content><![CDATA[<p>对于访问量稍大的站点,Apache的这些默认配置是无法满足需求的,我们仍需调整Apache的一些参数,使Apache能够在大访问量环境下发挥出更好的性能.以下我们对Apache配置文件httpd.conf中对性能影响较大的参数进行一些说明.<br>(1) Timeout 该参数指定Apache在接收请求或发送所请求内容之前的最长等待时间(秒),若超过该时间Apache则放弃处理该请求,并释放连接.该参数默认值为120,推荐设置为60,对于访问量较大的网站可以设置为30.<br>(2) KeepAlive 该参数控制Apache是否允许在一个连接中有多个请求,默认打开.但对于大多数论坛类型站点来说,通常设置为off以关闭该支持.<br>(3) MPM – prefork.c 在默认情况下Apache使用Prefork(进程)工作模式,可以说这部分的参数设置是对Apache性能影响的核心和关键.用户可以在配置文档中找到以下配置段:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;IfModule prefork.c&gt;</span></span><br><span class="line">   <span class="attribute">StartServers</span>       <span class="number">5</span></span><br><span class="line">   <span class="attribute">MinSpareServers</span>    <span class="number">5</span></span><br><span class="line">   <span class="attribute">MaxSpareServers</span>     <span class="number">10</span></span><br><span class="line">   <span class="attribute">MaxClients</span>       <span class="number">15</span></span><br><span class="line">   <span class="attribute">MaxRequestsPerChild</span>   <span class="number">0</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>

<p>这就是控制Apache进程工作的配置段,为了更好的理解上述配置中的各项参数,下面让我们先了解一下Apache是如何控制进程工作的.我们知道,在 Unix系统中,很多服务(Service)的守护进程(Daemon)在启动时会创建一个进程以准备应答可能的连接请求,服务即进入了端口监听状态,当一个来自客户端(Client)的请求被发送至服务所监听的端口时,该服务进程即会处理该请求,在处理过程中,该进程处于独占状态,也就是说如果此时有其他请求到达,这些请求只能”排队”等待当前请求处理完成且服务进程释放.这样就会导致越来越多的请求处于队列等待状态,实际表现就是该服务处理能力非常低下.Apache使用Prefork模式很好的解决了这一问题.下面我们来看看Apache实际上是如何高效率工作的.<br>当Apache启动时,Apache会启动StartSpareServers个空闲进程同时准备接收处理请求,当多个请求到来时,StarSpareServers进行会越来越少,当空闲进程减少到MinSpareServers个时,Apache为了能够继续有充裕的进程处理请求,它会再启动StartsServers个进程备用,这样就大大减少了请求队列等待的可能,使得服务效率提高,这也是为什么叫做Pre-fork的原因;让我们继续跟踪Apache的工作,我们假设Apache已经启动了200个进程来处理请求,理论上来说,此时Apache一共有205个进程,而过了一段时间,假设有100个请求都得到了Apache的响应和处理,那么此时这100个进程就被释放成为空闲进程,那么此时Apache有105个空闲进程.而对于服务而言,启动太多的空闲进程时没有任何意义的,反而会降低服务器的整体性能,那么Apache真的会有105个空闲进程么?当然不会!实际上 Apache随时在检查自己,当发现有超过MaxSpareServers个空闲进程时,则会自动停止关闭一些进程,以保证空闲进程不过过多.说到这里,用户应该对Apache的工作方式有了一定的了解,如果想获得更多更详细的说明请参阅Apache手册文档.<br>我们还有两个参数没有介绍:MaxClients和MaxRequestPerchild;MaxClients指定Apache在同一时间内最多允许有多少客户端能够与其连接,如果超过MaxClients个连接,客户端将会得到一个”服务器繁忙”的错误页面.我们看到默认情况下MaxClients设置为15,这对一些中型站点和大型站点显然是远远不够的!也许您需要同时允许512个客户端连接才能满足应用需求,好吧,那么就让我们把 MaxClients修改为512,保存httpd.conf并退出,重启Apache,很遗憾,在重启过程当中您看到了一些错误提示,Apache重启失败.错误提示中告诉您MaxClients最大只能设定为256,相信您一定很失望.不过不要沮丧,Apache作为世界一流的Web Server一定不会如此单薄的!在默认情况下,MaxClients的确只能设定为不超过256的整数,但是,如果您有需要完全可以随意定制,此时就需要使用ServerLimit参数来配合使用,简单的说ServerLimit就像是水桶,而MaxClients就像是水,您可以通过更换更大的水桶(将ServerLimit设定为一个较大值)来容纳更多的水(MaxClients),但要注意,MaxClients的设定数值是不能大于 ServerLimit的设定数值的!<br>下面让我们了解一下MaxRequestPerChild参数,该参数指定一个连接进程中可以有多少个线程同时工作.也许这样解释过于专业,那么您只要想想”网络蚂蚁”、”网际快车FlashGet”中的”多点同时下载”即可,该参数实际上就是限制最多可以用几个”点”,当这些”点”用完以后就会结束进程,并重新开启一个进程.默认设置为0,即为:不限制.但需要注意,如果将该值设置的过小会引起访问问题,如果没有特殊需要或者访问量压力并非很大可以保持默认值,如果访问量很大则推荐设置为2048,一般现在高负载服务器设置10000也可.<br>好了,解释了这么多,让我们看看经过修改后Perfork.c配置段的推荐配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;IfModule prefork.c&gt;</span></span><br><span class="line">   <span class="attribute">StartServers</span>       <span class="number">5</span></span><br><span class="line">   <span class="attribute">MinSpareServers</span>    <span class="number">5</span></span><br><span class="line">   <span class="attribute">MaxSpareServers</span>     <span class="number">10</span></span><br><span class="line">   <span class="attribute">ServerLimit</span>    <span class="number">1024</span></span><br><span class="line">   <span class="attribute">MaxClients</span>        <span class="number">768</span></span><br><span class="line">   <span class="attribute">MaxRequestsPerChild</span>   <span class="number">0</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>

<p>完成了上述对Apache的调整,Apache已经获得了较大的性能改善.记住,在修改任何参数后都需要重启Apache才能生效的.有关Apache的优化远远不止这些,有兴趣的用户可以阅读Apache手册文档或者寻找一些文献资料学习.</p>
<p>PHP优化对于PHP的优化主要是对php.ini中的相关主要参数进行合理调整和设置,以下我们就来看看php.ini中的一些对性能影响较大的参数应该如何设置.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>php.ini</span><br></pre></td></tr></table></figure>

<p>(1) PHP函数禁用找到:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">disable_functions</span> =</span><br></pre></td></tr></table></figure>

<p>该选项可以设置哪些PHP函数是禁止使用的,PHP中有一些函数的风险性还是相当大的,可以直接执行一些系统级脚本命令,如果允许这些函数执行,当PHP程序出现漏洞时,损失是非常严重的!以下我们给出推荐的禁用函数设置:</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">disable_functions = phpinfo,passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,<span class="keyword">popen</span>,chroot,escapeshellcmd,escapeshellarg,shell_exec,proc_open,proc_get_status</span><br></pre></td></tr></table></figure>

<p>需注意:如果您的服务器中含有一些系统状态检测的PHP程序,则不要禁用shell_exec,proc_open,proc_get_status等函数.</p>
<p>(2) PHP脚本执行时间找到:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">max_execution_time</span> = <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>该选项设定PHP程序的最大执行时间,如果一个PHP脚本被请求,且该PHP脚本在max_execution_time时间内没能执行完毕,则PHP不再继续执行,直接给客户端返回超时错误.没有特殊需要该选项可保持默认设置30秒,如果您的PHP脚本确实需要长执行时间则可以适当增大该时间设置.</p>
<p>(3) PHP脚本处理内存占用找到:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">memory_limit</span> = <span class="number">8</span>M</span><br></pre></td></tr></table></figure>

<p>该选项指定PHP脚本处理所能占用的最大内存,默认为8MB,如果您的服务器内存为1GB以上,则该选项可以设置为12MB以获得更快的PHP脚本处理效率.</p>
<p>(4) PHP全局函数声明找到:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">register_globals</span> = <span class="literal">Off</span></span><br></pre></td></tr></table></figure>

<p>网络上很多关于PHP设置的文章都推荐将该选项设置为On,其实这是一种及其危险的设置方法,很可能引起严重的安全性问题.如果没有特殊的需要,强烈推荐保留默认设置!</p>
<p>(5) PHP上传文件大小限制找到:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">upload_max_filesize</span> = <span class="number">2</span>M</span><br></pre></td></tr></table></figure>

<p>该选项设定PHP所能允许最大上传文件大小,默认为2MB.根据实际应用需求,可以适当增大该设置.</p>
<p>(6) Session存储介质找到:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">session</span>.save_path</span><br></pre></td></tr></table></figure>

<p>如果你的PHP程序使用Session对话,则可以将Session存储位置设置为 <code>/dev/shm</code>,<code>/dev/shm</code>是Linux系统独有的TMPFS 文件系统,是以内存为主要存储方式的文件系统,比RAMDISK更优秀,因为可以使用DISKSWAP作为补充,而且是系统自带的功能模块,不需要另行配置.想想看,从磁盘IO操作到内存操作,速度会快多少?只是需要注意,存储在 <code>/dev/shm</code>的数据,在服务器重启后会全部丢失.不过这对于 Session来说是无足轻重的.</p>
]]></content>
  </entry>
  <entry>
    <title>apache配置虚拟主机(给虚拟目录添加域名)</title>
    <url>/2010/05/25/1042/</url>
    <content><![CDATA[<p>2019年8月8日更新:<br>看到这篇文章感慨颇多,这个域名是我毕业第一个公司的官网域名,现在早已无法打开多年了.</p>
<p>httpd.conf尾部添加</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NameVirtualHost</span> *:<span class="number">80</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> www.dovao.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:\wwwroot\dovao\dovao</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> dovao.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:\wwwroot\dovao\dovao</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> www.dovao.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:\wwwroot\dovao\dovaobbs</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> www.dovao.com</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:\wwwroot\dovao\dovaobbs</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> tuan.dovao.com</span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:\wwwroot\dovao\dovaotuan</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>asp服务器500错误解决</title>
    <url>/2013/05/31/1045/</url>
    <content><![CDATA[<p>解决办法:<br>打开计算机管理IIS后,展开网站,点击出现错误的具体网站-&gt;”高级设置”-&gt;”物理路径凭据”,<br>在弹出的对话框中查看路径凭据是不是选择在”特定用户”,如果是请改成” 应用程序用户(通过身份验证)(A) “,点击确定.</p>
]]></content>
  </entry>
  <entry>
    <title>apache找不到apxs</title>
    <url>/2013/10/13/1044/</url>
    <content><![CDATA[<p>是因为没有安装 httpd-devel.<br>下载相应版本,安装httpd-devel.<br>会产生 <code>/usr/sbin/apxs</code>.<br>注意安装httpd-devel时需要安装apr-devel和apr-util-devel.<br>安装httpd-devel后,先前rpm安装的php也会不能使用.需要重新rpm安装PHP.<br>先查看系统中已经安装的有关PHP的RPM包.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -qa | grep php</span><br><span class="line"></span><br><span class="line"><span class="attribute">php</span>-ldap-<span class="number">4</span>.<span class="number">3</span>.<span class="number">9</span>-<span class="number">3</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">php</span>-mysql-<span class="number">4</span>.<span class="number">3</span>.<span class="number">9</span>-<span class="number">3</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">php</span>-<span class="number">4</span>.<span class="number">3</span>.<span class="number">9</span>-<span class="number">3</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">php</span>-pear-<span class="number">4</span>.<span class="number">3</span>.<span class="number">9</span>-<span class="number">3</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>然后再依次重新安装一次:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh --replacepkgs php-<span class="number">4</span>.<span class="number">3</span>.<span class="number">9</span>-<span class="number">3</span>.<span class="number">1</span>.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>at命令详解</title>
    <url>/2013/12/07/1047/</url>
    <content><![CDATA[<p>假如我们只是想要让特定任务运行一次,那么,这时候就要用到at监控程序了.</p>
<p>设置at命令很简单,指示定运行的时间,那么就会在哪个时候运行.at类似打印进程,会把任务放到 <code>/var/spool/at</code>目录中,到指定时间运行它 .at命令相当于另一个shell,运行at time命令时,它发送一个个命令,可以输入任意命令或者程序.at now + time命令可以在指示任务.</p>
<p>假设处理一个大型数据库,要在别人不用系统时去处理数据,比如凌晨3点10分.那么我们就应该先建立/home/kyle/do_job脚本管理数据库,计划处理 <code>/home/kyle/do_job</code>文件中的结果.正常方式是这样启动下列命令:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">at</span> <span class="number">2</span>:<span class="number">05</span> tomorrow</span><br><span class="line"><span class="keyword">at</span>&gt;/home/kyle/do_job</span><br><span class="line"><span class="keyword">at</span>&gt; Ctrl+D</span><br></pre></td></tr></table></figure>

<p>AT Time中的时间表示方法:<br>例子:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Minuteat</span> now + <span class="number">5</span>  #minutes任务在<span class="number">5</span>分钟后运行</span><br><span class="line"><span class="attribute">Hour</span> at now + <span class="number">1</span>   #hour 任务在<span class="number">1</span>小时后运行</span><br><span class="line"><span class="attribute">Days</span> at now + <span class="number">3</span>   #days 任务在<span class="number">3</span>天后运行</span><br><span class="line"><span class="attribute">Weeks</span> at now + <span class="number">2</span>  #weeks 任务在两周后运行</span><br><span class="line"><span class="attribute">Fixed</span> at midnight #任务在午夜运行</span><br><span class="line"><span class="attribute">Fixed</span> at <span class="number">10</span>:<span class="number">30</span>pm  #任务在晚上<span class="number">10</span>点<span class="number">30</span>分</span><br></pre></td></tr></table></figure>

<p>注意:一定要检查一下atq的服务是否启 动,有些操作系统未必是默认启动的,linux默认为不启动,而ubuntu默认为启动的.检查是否启动,用service atd检查语法,用service atd status检查atd的状态,用service atd start启动atd服务.</p>
<p>查看at执行的具体内容:一般位于 <code>/var/spool/at</code>目录下面, 用vi打开,在最后一部分就是你的执行程序.</p>
]]></content>
  </entry>
  <entry>
    <title>Apache实现多端口多主目录访问多站点</title>
    <url>/2016/10/04/1043/</url>
    <content><![CDATA[<p>在httpd.conf最后面加入如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">Listen</span></span> <span class="number">810</span></span><br><span class="line"><span class="section">&lt;VirtualHost <span class="number">192.168.1.100:810</span>&gt;</span></span><br><span class="line">    <span class="attribute">ServerAdmin</span> &lt;a href=<span class="string">&quot;mailto:webmaster@name.com&quot;</span>&gt;webmaster@name.com&lt;/a&gt;</span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> <span class="number">192.168.1.100:810</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> E:phphtdocsyingkekuaile<span class="number">8</span>tuan</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:phphtdocsyingkekuaile8tuan&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> <span class="literal">all</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">Deny</span>,<span class="literal">Allow</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Deny</span></span> from <span class="literal">all</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>可实现<a href="http://192.168.1.100:810访问">http://192.168.1.100:810访问</a> <code>E:\php\htdocs\yingkekuaile8tuan\</code>路径下的php网站.</p>
]]></content>
  </entry>
  <entry>
    <title>AW ERROR Unknown user&#39;www-data&#39; !</title>
    <url>/2011/02/01/1048/</url>
    <content><![CDATA[<p>修改apahce配置文件 <code>etc/vhcs2vhcs2.conf</code>里面的:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;APACHE_USER = www-data&quot;</span></span><br><span class="line"><span class="string">&quot;APACHE_GROUP = www-data&quot;</span></span><br></pre></td></tr></table></figure>

<p>为:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf</span><br></pre></td></tr></table></figure>

<p>里面apache的用户名密码:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">User</span> <span class="title">apache</span></span><br><span class="line"><span class="keyword">Group</span> <span class="title">apache</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>atlas实现mysql读写分离</title>
    <url>/2013/02/14/1046/</url>
    <content><![CDATA[<p>注意:只能安装在64位的Linux操作系统上,CentOS官方建议rpm安装方式.</p>
<p>获取地址:<a href="https://github.com/Qihoo360/Atlas/releases">https://github.com/Qihoo360/Atlas/releases</a></p>
<p>目前最新的版本为:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Atlas</span>-<span class="number">2</span>.<span class="number">2</span>.<span class="number">1</span>.el<span class="number">5</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm  CentOS <span class="number">5</span>.*  版本</span><br><span class="line"><span class="attribute">Atlas</span>-<span class="number">2</span>.<span class="number">2</span>.<span class="number">1</span>.el<span class="number">6</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm  CentOS <span class="number">6</span>.*  版本</span><br></pre></td></tr></table></figure>

<p>我的环境是CentOS 6.6 Basic Server x86_64</p>
<p>安装命令:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[root@jhq0229 src]</span>$ rpm -<span class="selector-tag">i</span> Atlas-<span class="number">2.2</span>.<span class="number">1</span><span class="selector-class">.el6</span><span class="selector-class">.x86_64</span>.rpm</span><br></pre></td></tr></table></figure>

<p>安装位置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local/mysql-proxy</span><br></pre></td></tr></table></figure>

<p>配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mysql-proxy/</span>conf/test.cnf</span><br></pre></td></tr></table></figure>

<p>重要配置文件详解:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>)线程数</span><br><span class="line">event-threads项设置,过小无法充分发挥多核CPU的性能,过大造成不必要的线程切换开销,推荐设置为CPU的核数.</span><br><span class="line">(<span class="number">2</span>)最小空闲连接数(<span class="number">2.</span>x以上版本不需要该项,<span class="number">1.</span>x版本需要)</span><br><span class="line">min-idle-connections项设置,过小则在高并发下会有报错,过大虽然不报错但在测试时不容易看出读写分离效果,推荐设置为比客户端的并发峰值稍大,详见&lt;配置参数详解&gt;.上面的配置范例是针对Atlas <span class="number">2.</span>X版本,没有该选项.对于Atlas <span class="number">1.</span>X版本的配置文件,需要加入该配置选项</span><br><span class="line">(<span class="number">3</span>)Atlas的工作端口</span><br><span class="line">proxy-address项配置,例如proxy-address = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">1234</span>代表客户端应该使用<span class="number">1234</span>这个端口连接Atlas来发送<span class="keyword">SQL</span>请求.</span><br><span class="line">(<span class="number">4</span>)Atlas的管理端口</span><br><span class="line"><span class="keyword">admin</span>-address项配置,例如<span class="keyword">admin</span>-address = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2345</span>代表DBA应该使用<span class="number">2345</span>这个端口连接Atlas来执行运维管理操作.</span><br><span class="line">(<span class="number">5</span>)管理接口的用户名和密码</span><br><span class="line"><span class="keyword">admin</span>-username项和<span class="keyword">admin</span>-<span class="keyword">password</span>项设置,这两项是用来进入Atlas的管理界面的,与后端连接的MySQL没有关系,所以可以任意设置,不需要MySQL在配置上做任何改动.</span><br><span class="line">(<span class="number">6</span>)日志级别</span><br><span class="line">以<span class="keyword">log</span>-<span class="keyword">level</span>项配置,分为message、<span class="built_in">warning</span>、critical、error、<span class="keyword">debug</span>五个级别.</span><br><span class="line">(<span class="number">7</span>)日志路径</span><br><span class="line">以<span class="keyword">log</span>-<span class="type">path</span>项配置,如<span class="keyword">log</span>-<span class="type">path</span> = /usr/<span class="keyword">local</span>/mysql-proxy/<span class="keyword">log</span>.</span><br><span class="line">(<span class="number">8</span>)主库的IP和端口</span><br><span class="line">proxy-backend-addresses = <span class="number">192.168</span><span class="number">.0</span><span class="number">.12</span>:<span class="number">3306</span></span><br><span class="line">(<span class="number">9</span>)从库的IP和端口,@后面的数字代表权重,用来作负载均衡,若省略则默认为<span class="number">1</span>,可设置多项,用逗号分隔.如果想让主库也能分担读请求的话,只需要将主库信息加入到下面的配置项中.</span><br><span class="line">proxy-<span class="keyword">read</span>-<span class="keyword">only</span>-backend-addresses = <span class="number">192.168</span><span class="number">.0</span><span class="number">.13</span>:<span class="number">3306</span>,<span class="number">192.168</span><span class="number">.0</span><span class="number">.14</span>:<span class="number">3306</span></span><br><span class="line">(<span class="number">10</span>)用户名与其对应的加密过的MySQL密码,密码使用PREFIX/bin目录下的加密程序encrypt加密,用户名与密码之间用冒号分隔.主从数据库上需要先创建该用户并设置密码(用户名和密码在主从数据库上要一致).比如用户名为myuser,密码为mypwd,执行./encrypt mypwd结果为HJBoxfRsjeI=.如果有多个用户用逗号分隔即可.则设置如下行所示:</span><br><span class="line">pwds = myuser: HJBoxfRsjeI=,myuser2:HJBoxfRsjeI=</span><br><span class="line">(<span class="number">11</span>)分表设置,此例中person为库名,mt为表名,id为分表字段,<span class="number">3</span>为子表数量,可设置多项,以逗号分隔,若不分表则不需要设置该项,子表需要事先建好,子表名称为表名_数字,数字范围为[<span class="number">0</span>,子表数<span class="number">-1</span>],如本例里,子表名称为mt_0、mt_1、mt_2</span><br><span class="line"><span class="keyword">tables</span> = person.mt.id<span class="number">.3</span></span><br></pre></td></tr></table></figure>

<p>我的配置:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">admin-username</span> = sibajie</span><br><span class="line"><span class="attr">admin-password</span> = sibajie25<span class="comment">#管理的用户名密码</span></span><br><span class="line"><span class="attr">proxy-backend-addresses</span> = <span class="number">192.168</span>.<span class="number">9.101</span>:<span class="number">3306</span><span class="comment">#后端写服务器</span></span><br><span class="line"><span class="attr">proxy-read-only-backend-addresses</span> = <span class="number">192.168</span>.<span class="number">9.102</span>:<span class="number">3306</span>后端读服务器</span><br><span class="line"><span class="attr">pwds</span> = root:uwvEzdXUofMtoVZBPiOC6Q==,root:uwvEzdXUofMtoVZBPiOC6Q==<span class="comment">#后端服务器用户名密码 密码用bin目录encrypt加密获得,否则无法启动</span></span><br><span class="line"><span class="attr">daemon</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">keepalive</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">event-threads</span> = <span class="number">16</span></span><br><span class="line"><span class="attr">log-level</span> = debug</span><br><span class="line"><span class="attr">log-path</span> = /usr/local/mysql-proxy/log</span><br><span class="line"><span class="attr">sql-log</span> = <span class="literal">ON</span></span><br><span class="line"><span class="attr">proxy-address</span> = <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">3306</span><span class="comment">#操作的端口</span></span><br><span class="line"><span class="attr">admin-address</span> = <span class="number">192.168</span>.<span class="number">9.248</span>:<span class="number">3307</span><span class="comment">#管理的端口</span></span><br></pre></td></tr></table></figure>

<p>保存配置文件,启动:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/bin/</span> mysql-proxyd mysql-proxy start  <span class="comment">#中间是配置文件名称</span></span><br></pre></td></tr></table></figure>

<p>可以复制bin目录mysql-proxyd 到 <code>/etc/init.d/</code>  就可以通过service 启动关闭重启了.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS 5.2下SVN服务器的安装与配置</title>
    <url>/2013/01/08/1050/</url>
    <content><![CDATA[<p>安装了一下SVN服务器,本文没有与Apache整合,过程如下:</p>
<p>一,下载相关软件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>subversion.tigris.org<span class="regexp">/downloads/</span>subversion-<span class="number">1.6</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">wget http:<span class="regexp">//</span>subversion.tigris.org<span class="regexp">/downloads/</span>subversion-deps-<span class="number">1.6</span>.<span class="number">1</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>二,安装及配置:</p>
<p>1,解压,要在同一个目录下:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@youxia201</span> opt]<span class="meta"># tar -zxvf subversion-1.6.1.tar.gz</span></span><br><span class="line">[root<span class="symbol">@youxia201</span> opt]<span class="meta"># tar -zxvf subversion-deps-1.6.1.tar.gz</span></span><br></pre></td></tr></table></figure>

<p>2,编译及安装:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># ./configure --prefix=/usr/local/svn/</span></span><br><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>3,把svn相关的命令添加到环境变量中:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># echo <span class="string">&quot;export PATH=$PATH:/usr/local/svn/bin/&quot;</span> &gt;&gt; /etc/profile</span></span><br><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># source /etc/profile</span></span><br><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># svn</span></span><br><span class="line">svn  svnadmin  svndumpfilter  svnlook  svnserve  svnsync  svnversion</span><br></pre></td></tr></table></figure>

<p>三,建立测试仓库:</p>
<p>1,建立SVN的根目录,研发中心有多个项目部:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@youxia201</span> subversion<span class="number">-1.6</span><span class="number">.1</span>]<span class="meta"># mkdir -p /opt/svn/</span></span><br></pre></td></tr></table></figure>

<p>2,建立一个测试仓库:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@youxia201 subversion-<span class="number">1.6</span>.<span class="number">1</span>]# mkdir -p <span class="regexp">/opt/</span>svn<span class="regexp">/svntest/</span></span><br><span class="line">[root@youxia201 subversion-<span class="number">1.6</span>.<span class="number">1</span>]# svnadmin create <span class="regexp">/opt/</span>svn<span class="regexp">/svntest/</span></span><br></pre></td></tr></table></figure>

<p>3,修改配置文件:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@youxia201 svntest]# <span class="keyword">cd</span> /<span class="keyword">opt</span>/svn/svntest/<span class="keyword">conf</span>/</span><br><span class="line">[root@youxia201 <span class="keyword">conf</span>]# <span class="keyword">ll</span></span><br><span class="line">总计 <span class="number">24</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root  <span class="number">710</span> <span class="number">08</span>-<span class="number">25</span> <span class="number">09</span>:<span class="number">40</span> authz</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root  <span class="number">325</span> <span class="number">08</span>-<span class="number">25</span> <span class="number">09</span>:<span class="number">38</span> passwd</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">1449</span> <span class="number">08</span>-<span class="number">25</span> <span class="number">09</span>:<span class="number">36</span> svnserve.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@youxia201 <span class="keyword">conf</span>]# <span class="keyword">vi</span> svnserve.<span class="keyword">conf</span></span><br><span class="line">[general]</span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = <span class="keyword">write</span></span><br><span class="line">password-db = passwd</span><br><span class="line">authz-db = authz</span><br><span class="line">[root@youxia201 <span class="keyword">conf</span>]# <span class="keyword">vi</span> authz</span><br><span class="line">[svntes<span class="variable">t:</span>/]</span><br><span class="line">lipeng = rw</span><br><span class="line">#给svntest仓库添加一个名称为李鹏的用户,权限为可写.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@youxia201 <span class="keyword">conf</span>]# <span class="keyword">vi</span> passwd</span><br><span class="line">lipeng = <span class="number">123456</span></span><br><span class="line">#由于是测试,密码设置为<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>四,启服务器及测试:</p>
<p>1,启SVN服务,并指定SVN的根目录:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@youxia201</span> test]<span class="meta"># svnserve -d -r /opt/svn/</span></span><br></pre></td></tr></table></figure>

<p>2,服务已经正常起来:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@youxia201</span> test]<span class="comment"># netstat -tunlp | grep svn</span></span><br><span class="line">tcp    0    0 0.0.0.0<span class="symbol">:</span><span class="number">3690</span>    0.0.0.0<span class="symbol">:*</span>    LISTEN    <span class="number">8646</span>/svnserve</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>cacti监控整个集群状态</title>
    <url>/2014/06/28/1049/</url>
    <content><![CDATA[<p>今天讲的是集群的监控,使用cacti可以方便的监控公司的整个集群,但是编译安装非常复杂,今天的方法是使用yum安装,方便快捷.<br>环境:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">OS</span>:CentOS <span class="number">32</span>位 <span class="number">5</span>.<span class="number">6</span></span><br><span class="line"><span class="attribute">DataBase</span>:MySQL<span class="number">5</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">PHP</span> Apache</span><br><span class="line"><span class="attribute">net</span>-snmp</span><br></pre></td></tr></table></figure>

<p>部署CentOS cacti配置需要的环境.</p>
<p>安装MySQL:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> mysql</span><br><span class="line">yum -y <span class="keyword">install</span> mysql-server</span><br><span class="line">yum -y <span class="keyword">install</span> mysql-devel</span><br></pre></td></tr></table></figure>

<p>安装apache:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> httpd</span><br></pre></td></tr></table></figure>

<p>安装php:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> php</span><br><span class="line">yum -y <span class="keyword">install</span> php-mysql</span><br></pre></td></tr></table></figure>

<p>启动各类服务并且加入启动列表:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service httpd <span class="built_in">start</span></span><br><span class="line">service mysqld <span class="built_in">start</span> <span class="comment">#第一次启动会初始化MySQL的数据字典</span></span><br><span class="line">chkconfig httpd <span class="keyword">on</span></span><br><span class="line">chkconfig mysqld <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>由于CentOS cacti配置的运行需要大量的其它库的支持,我们还需要安装一些:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">zlib:</span><br><span class="line">yum -y <span class="keyword">install</span> zlib</span><br><span class="line">libpng:</span><br><span class="line">yum -y <span class="keyword">install</span> libpng</span><br><span class="line">freetype:</span><br><span class="line">yum -y <span class="keyword">install</span> freetype</span><br><span class="line">jpeg:</span><br><span class="line">yum -y <span class="keyword">install</span> libjpeg</span><br><span class="line">fontconfig:</span><br><span class="line">yum -y <span class="keyword">install</span> fontconfig</span><br><span class="line">gd:</span><br><span class="line">yum -y <span class="keyword">install</span> gd</span><br><span class="line">libxml:</span><br><span class="line">yum -y <span class="keyword">install</span> libxml2</span><br><span class="line">yum -y <span class="keyword">install</span> php-gd //如果weathermap没有正常运行可以检查这个</span><br></pre></td></tr></table></figure>

<p>安装rrdtool:</p>
<p>在 <code>/etc/yum.repos.d/</code>下面新建dag.repo文件在文件中输入源地址:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[root@hmg2 yum.repos.d]</span><span class="comment"># cat dag.repo</span></span><br><span class="line"><span class="section">[dag]</span></span><br><span class="line"><span class="attr">name</span>=Dag RPM Repository for Red Hat Enterprise Linux</span><br><span class="line"><span class="attr">baseurl</span>=http://apt.sw.be/redhat/el<span class="variable">$releasever</span>/en/<span class="variable">$basearch</span>/dag</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=http://dag.wieers.com/rpm/packages/RPM-GPG-KEY.dag.txt</span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="section">[root@hmg2 yum.repos.d]</span><span class="comment">#yum -y install rrdtool</span></span><br></pre></td></tr></table></figure>

<p>启动rrdtool服务并且加入启动列表:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service rrdcached <span class="built_in">start</span></span><br><span class="line">chkconfig rrdcached <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>安装snmp的支持工具:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> net-snmp</span><br><span class="line">yum -y <span class="keyword">install</span> net-snmp-utils</span><br></pre></td></tr></table></figure>

<p>启动snmpd服务并且加入启动列表:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service snmpd <span class="built_in">start</span></span><br><span class="line">chkconfig snmpd <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>安装CentOS cacti:</p>
<p>下载CentOS cacti,cacit官方网站:<a href="http://www.cacti.net/download_cacti.php">http://www.cacti.net/download_cacti.php</a>.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.cacti.net<span class="regexp">/downloads/</span>cacti-<span class="number">0.8</span>.<span class="number">7</span>g.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压并放到apache文档目录(/var/www/html是默认apache网站目录):</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -xf cacti-<span class="number">0</span>.<span class="number">8</span>.<span class="number">7</span>g.tar.gz</span><br><span class="line"><span class="attribute">mv</span> cacti-<span class="number">0</span>.<span class="number">8</span>.<span class="number">7</span>g /var/www/html/cacti</span><br></pre></td></tr></table></figure>

<p>编辑CentOS cacti配置文件,这里配置链接MySQL服务的用户名,密码,端口等.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/var/</span>www/html</span><br><span class="line">vi cacti<span class="regexp">/include/</span>config.php</span><br><span class="line"><span class="variable">$database_type</span> = <span class="string">&quot;mysql&quot;</span>;</span><br><span class="line"><span class="variable">$database_default</span> = <span class="string">&quot;cacti&quot;</span>;</span><br><span class="line"><span class="variable">$database_hostname</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$database_username</span> = <span class="string">&quot;cacti&quot;</span>;</span><br><span class="line"><span class="variable">$database_password</span> = <span class="string">&quot;cacti&quot;</span>;</span><br><span class="line"><span class="variable">$database_port</span> = <span class="string">&quot;3306″;</span></span><br></pre></td></tr></table></figure>

<p>添加一个cacti的用户并添加cron任务:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">useradd cacti</span><br><span class="line">su – cacti</span><br><span class="line">crontab -e</span><br><span class="line">*<span class="regexp">/1 * * * * /u</span>sr<span class="regexp">/bin/</span>php <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti<span class="regexp">/poller.php &gt; /</span>dev/<span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>把cacti网站目录所属组改为cacti:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">su – root</span><br><span class="line">chgrp -R cacti <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti</span><br></pre></td></tr></table></figure>

<p>另外还需要两个目录的所有者修改,以便使cacti有写权限:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R cacti <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti/rra</span><br><span class="line">chown -R cacti <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti/log</span><br><span class="line">chown -R cacti <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti/poller.php</span><br></pre></td></tr></table></figure>

<p>CentOS cacti配置数据库:</p>
<p>建立好数据库.<br>访问网页安装,一直next.<br><a href="http://192.168.30.8/cacti">http://192.168.30.8/cacti</a><br>安装完成后登陆,初始默认用户名和密码为:</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line"><span class="literal">admin</span>/cacti</span><br></pre></td></tr></table></figure>

<p>创建CentOS cacti数据库:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysqladmin –<span class="keyword">user</span>=root <span class="keyword">create</span> cacti</span><br></pre></td></tr></table></figure>

<p>导入cacit.sql:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql cacti&lt; <span class="regexp">/var/</span>www<span class="regexp">/html/</span>cacti/cacti.sql给cacti用户授权</span><br><span class="line">mysql -uroot</span><br><span class="line">mysql&gt; use cacti</span><br><span class="line">mysql&gt; grant all on cacti.* to cacti@localhost identified by <span class="string">&#x27;cacti&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>下面是被监控的服务器的设置,这里只讲解linux:</p>
<p>说明:要使用Cacti监控一台Linux主机,需要在被监控的主机上安装net-snmp等相关的软件包;<br>同时需要开启防火墙UDP161端口.<br>开启防火墙UDP161端口:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables <span class="comment">#编辑防火墙配置</span></span><br><span class="line">-A INPUT -m <span class="keyword">state</span> --state NEW -m udp -p udp --dport <span class="number">161</span> -j ACCEPT</span><br><span class="line">/etc/init.d/iptables restart <span class="comment">#重启防火墙使配置生效</span></span><br></pre></td></tr></table></figure>

<p>安装net-snmp(这里使用CentOS的yum命令在线安装):</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> net-snmp</span><br><span class="line">chkconfig snmpd <span class="keyword">on</span> <span class="comment">#设置开机启动</span></span><br><span class="line">service snmpd start <span class="comment">#启动snmpd</span></span><br></pre></td></tr></table></figure>

<p>配置snmp:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>snmp<span class="regexp">/snmpd.conf /</span>etc<span class="regexp">/snmp/</span>snmpd.confbak <span class="comment">#备份配置文件</span></span><br><span class="line">vi <span class="regexp">/etc/</span>snmp/snmpd.conf <span class="comment">#编辑,修改为下面的内容</span></span><br><span class="line">com2sec notConfigUser <span class="number">192.168</span>.<span class="number">30.8</span> public <span class="comment">#监控服务器IP</span></span><br><span class="line">access notConfigGroup <span class="string">&quot;&quot;</span> any noauth exact all none none</span><br><span class="line">view all included .<span class="number">1</span> <span class="number">80</span></span><br><span class="line">netstat -nlup |grep <span class="string">&quot;:161&quot;</span> <span class="comment">#检查snmp服务器是否运行,出现类似下面输出结果,说明snmp运行正常</span></span><br><span class="line">udp <span class="number">0</span> <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">161</span> <span class="number">0.0</span>.<span class="number">0.0</span>:* <span class="number">2765</span>/snmpd</span><br></pre></td></tr></table></figure>

<p>至此,被监控的Linux主机设置完成.<br>然后访问安装好的cacti,<br>可以看到:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">You are now <span class="keyword">logged</span> <span class="keyword">into</span> Cacti. You can follow these basic steps <span class="keyword">to</span> <span class="keyword">get</span> started.</span><br><span class="line"><span class="keyword">Create</span> devices <span class="keyword">for</span> network</span><br><span class="line"><span class="keyword">Create</span> graphs <span class="keyword">for</span> your <span class="built_in">new</span> devices</span><br><span class="line"><span class="keyword">View</span> your <span class="built_in">new</span> graphs</span><br></pre></td></tr></table></figure>

<p>点击Create devices for network可以添加被监控服务器.<br>重要的是hostname 填写被监控服务器的IP.<br>SNMP Version 选择2<br>点击Create graphs for your new devices可以添加服务器监控项目.<br>最后点击左侧Graph Tree 可以把被监控服务器添加到graphs界面.<br>好了这个时候就可以点击页面顶部的graphs来查看服务器的状态了.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS 5.4使用Jailkit建立apache 的chroot环境</title>
    <url>/2016/01/31/1051/</url>
    <content><![CDATA[<p>1.下载rpmforge-release-0.5.2-2.el6.rf.i686.rpm</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">i686</span> http://packages.sw.be/rpmforge-release/rpmforge-release-<span class="number">0</span>.<span class="number">5</span>.<span class="number">2</span>-<span class="number">2</span>.el<span class="number">6</span>.rf.i<span class="number">686</span>.rpm</span><br><span class="line"><span class="attribute">x86_64</span> http://packages.sw.be/rpmforge-release/rpmforge-release-<span class="number">0</span>.<span class="number">5</span>.<span class="number">2</span>-<span class="number">2</span>.el<span class="number">6</span>.rf.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure>

<p>2.安装DAG’s GPG key</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">rpm --<span class="keyword">import</span> http:<span class="comment">//apt.sw.be/RPM-GPG-KEY.dag.txt</span></span><br></pre></td></tr></table></figure>

<p>3.安装rpmforge-release-0.5.2-2.el6.rf.i686.rpm</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -i rpmforge-release-<span class="number">0</span>.<span class="number">5</span>.<span class="number">2</span>-<span class="number">2</span>.el<span class="number">6</span>.rf.*.rpm</span><br></pre></td></tr></table></figure>

<p>4.安装Jailkit</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> Jailkit</span><br></pre></td></tr></table></figure>

<p>5.配置Jailkit</p>
<p>拷贝原始配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/etc/</span>jailkit/</span><br><span class="line">cp jk_init.ini  jk_init.ini.bak</span><br></pre></td></tr></table></figure>

<p>编辑jk_init.ini</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> jk_init.ini</span><br></pre></td></tr></table></figure>

<p>在底部增加ldconfig</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[ldconfig]</span></span><br><span class="line"><span class="attr">paths</span> = /sbin/ldconfig</span><br><span class="line"><span class="attr">regularfiles</span> = /etc/ld.so.conf</span><br></pre></td></tr></table></figure>

<p>找到[uidbasics]</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[uidbasics]</span><br><span class="line"><span class="comment"># this section probably needs adjustment on 64bit systems</span></span><br><span class="line"><span class="comment"># or non-Linux systems</span></span><br><span class="line">comment = common files <span class="keyword">for</span> all jails that need user/group information</span><br><span class="line">paths = <span class="regexp">/lib/</span>libnsl.so.<span class="number">1</span>, <span class="regexp">/lib64/</span>libnsl.so.<span class="number">1</span>, <span class="regexp">/lib/</span>libnss*.so.<span class="number">2</span>, <span class="regexp">/lib64/</span>libnss*.so.<span class="number">2</span>, <span class="regexp">/etc/</span>nsswitch.conf, <span class="regexp">/etc/</span>ld.so.conf</span><br></pre></td></tr></table></figure>

<p>去掉 <code>/etc/ld.so.conf</code>增加下面一行</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">includesections</span> = ldconfig</span><br></pre></td></tr></table></figure>

<p>找到[apache]</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[apache]</span></span><br><span class="line"><span class="attr">comment</span> = the apache webserver, very basic setup, probably too limited for you</span><br><span class="line"><span class="attr">paths</span> = /usr/sbin/apache</span><br><span class="line"><span class="attr">users</span> = root, www-data</span><br><span class="line"><span class="attr">groups</span> = root, www-data</span><br><span class="line"><span class="attr">includesections</span> = netbasics, uidbasics</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[apache]</span><br><span class="line">comment = the apache webserver, very basic setup, probably too limited <span class="keyword">for</span> you</span><br><span class="line">paths = <span class="regexp">/usr/</span>sbin<span class="regexp">/apachectl,/u</span>sr<span class="regexp">/sbin/</span>httpd,<span class="regexp">/etc/</span>php.ini,<span class="regexp">/etc/</span>localtime</span><br><span class="line">users = root, apache</span><br><span class="line">groups = root, apache</span><br><span class="line">regularfiles = <span class="regexp">/etc/mim</span>e.types</span><br><span class="line">directories = <span class="regexp">/etc/</span>httpd,<span class="regexp">/var/</span>www<span class="regexp">/html, /</span>var<span class="regexp">/lock/</span>subsys, <span class="regexp">/var/</span>log<span class="regexp">/httpd,/</span>etc<span class="regexp">/php.d,/u</span>sr<span class="regexp">/share/</span>zoneinfo,<span class="regexp">/var/</span>lib<span class="regexp">/php/</span>session</span><br><span class="line">includesections = netbasics, uidbasicsi,editors, basicshell</span><br><span class="line">devices =<span class="regexp">/dev/u</span>random, <span class="regexp">/dev/</span><span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<p>建立要chroot的apache目录</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/home/</span>apache</span><br><span class="line">chown root:root <span class="regexp">/home/</span>apache</span><br><span class="line">chmod <span class="number">0755</span> <span class="regexp">/home/</span>apache</span><br></pre></td></tr></table></figure>

<p>在apache目录放置chroot环境需要的文件依赖</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">jk_init -j <span class="regexp">/home/</span>apache apache</span><br></pre></td></tr></table></figure>

<p>启动apache</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">apachectl <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>中间会出现一些小问题,请根据实际把缺少的文件手动建立拷贝,如php.ini.<br>一个chroot环境建成.</p>
<p>2.配置apache</p>
<p>安装编译mod_chroot</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># wget http://core.segfault.pl/~hobbit/mod_chroot/dist/mod_chroot-0.5.tar.gz</span></span><br><span class="line"><span class="meta"># tar -zxvf mod_chroot-0.5.tar.gz</span></span><br><span class="line"><span class="meta"># cd mod_chroot-0.5</span></span><br><span class="line"><span class="meta"># apxs -cia mod_chroot.c</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/httpd/conf/httpd.conf</code></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">PidFile <span class="built_in">run</span>/httpd.pid</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">PidFile <span class="regexp">/var/</span>run/httpd.pid</span><br></pre></td></tr></table></figure>

<p>在后面增加</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ChrootDir <span class="regexp">/home/</span>apache</span><br></pre></td></tr></table></figure>

<p>在ServerRoot “/etc/httpd”后面增加</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">LockFile <span class="regexp">/var/</span>run/httpd.lock</span><br><span class="line">CoreDumpDirectory <span class="regexp">/var/</span>run</span><br><span class="line">ScoreBoardFile <span class="regexp">/var/</span>run/httpd.scoreboard</span><br></pre></td></tr></table></figure>

<p>加载chroot模块</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">64 </span>位:LoadModule chroot_module /<span class="keyword">usr</span>/lib64/httpd/modules/mod_chroot.so</span><br><span class="line"><span class="symbol">32 </span>位:LoadModule chroot_module /<span class="keyword">usr</span>/lib/httpd/modules/mod_chroot.so</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/init.d/httpd</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/i</span>nit.d/httpd</span><br></pre></td></tr></table></figure>

<p>在HTTPD_LANG=${HTTPD_LANG-“C”}后增加</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">ROOT=<span class="regexp">/home/</span>apache</span><br></pre></td></tr></table></figure>

<p>找到</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">stop()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="literal">-n</span> <span class="variable">$</span><span class="string">&quot;Stopping <span class="variable">$prog:</span> &quot;</span></span><br><span class="line">    killproc <span class="literal">-d</span> <span class="number">10</span><span class="variable">$httpd</span></span><br><span class="line">    RETVAL=<span class="variable">$</span>?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [<span class="variable">$RETVAL</span> = <span class="number">0</span>] &amp;&amp; <span class="built_in">rm</span> <span class="operator">-f</span> <span class="variable">$</span>&#123;lockfile&#125;<span class="variable">$</span>&#123;pidfile&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">stop()&#123;</span><br><span class="line">    <span class="regexp">/bin/</span>ln -s <span class="variable">$ROOT</span><span class="regexp">/var/</span>run<span class="regexp">/httpd.pid /</span>var<span class="regexp">/run/</span>httpd.pid</span><br><span class="line">    echo -n $<span class="string">&quot;Stopping $prog: &quot;</span></span><br><span class="line">    killproc -d <span class="number">10</span><span class="variable">$httpd</span></span><br><span class="line">    RETVAL=$?</span><br><span class="line">    echo</span><br><span class="line">    [<span class="variable">$RETVAL</span> = <span class="number">0</span>] &amp;&amp; rm -f <span class="variable">$&#123;lockfile&#125;</span><span class="variable">$&#123;pidfile&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存,重启.</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">service httpd restart.</span><br></pre></td></tr></table></figure>

<p>可看到:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">core</span> <span class="selector-tag">dump</span> <span class="selector-tag">file</span> <span class="selector-tag">size</span> <span class="selector-tag">limit</span> <span class="selector-tag">raised</span> <span class="selector-tag">to</span> <span class="selector-tag">4294967295</span> <span class="selector-tag">bytes</span></span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">SELinux</span> <span class="selector-tag">policy</span> <span class="selector-tag">enabled</span>; <span class="selector-tag">httpd</span> <span class="selector-tag">running</span> <span class="selector-tag">as</span> <span class="selector-tag">context</span> <span class="selector-tag">root</span>:<span class="selector-tag">system_r</span>:<span class="selector-tag">httpd_t</span></span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">suEXEC</span> <span class="selector-tag">mechanism</span> <span class="selector-tag">enabled</span> (<span class="attribute">wrapper</span>: /usr/sbin/suexec)</span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">Digest</span>: <span class="selector-tag">generating</span> <span class="selector-tag">secret</span> <span class="selector-tag">for</span> <span class="selector-tag">digest</span> <span class="selector-tag">authentication</span> ...</span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">Digest</span>: <span class="selector-tag">done</span></span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">mod_python</span>: <span class="selector-tag">Creating</span> <span class="selector-tag">4</span> <span class="selector-tag">session</span> <span class="selector-tag">mutexes</span> <span class="selector-tag">based</span> <span class="selector-tag">on</span> <span class="selector-tag">256</span> <span class="selector-tag">max</span> <span class="selector-tag">processes</span> <span class="selector-tag">and</span> <span class="selector-tag">0</span> <span class="selector-tag">max</span> <span class="selector-tag">threads</span>.</span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">mod_chroot</span>: <span class="selector-tag">changed</span> <span class="selector-tag">root</span> <span class="selector-tag">to</span> /<span class="selector-tag">home</span>/<span class="selector-tag">apache</span>.</span><br><span class="line"><span class="selector-attr">[Thu Jan 27 20:56:39 2011]</span> <span class="selector-attr">[notice]</span> <span class="selector-tag">Apache</span>/<span class="selector-tag">2</span><span class="selector-class">.2</span><span class="selector-class">.3</span> (CentOS) <span class="selector-tag">configured</span> <span class="selector-tag">--</span> <span class="selector-tag">resuming</span> <span class="selector-tag">normal</span> <span class="selector-tag">operations</span></span><br></pre></td></tr></table></figure>

<p>到此OK了.<br>有关session启动,请检测目录权限.</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">chown</span> -R apache:apache session/</span><br></pre></td></tr></table></figure>

<p>注意:数据库连接时localhost要改成127.0.0.1</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS 6 系统优化 Shell 脚本</title>
    <url>/2012/03/29/1053/</url>
    <content><![CDATA[<p>CentOS 已经发布了6.2版了,现在已经可以用在生产环境了,新版本的内核也能更好的利用硬件.写了一个脚本,用来初始化系统环境,现在分享出来,你可以根据自己的需要,对脚本进行相应的修改.<br>脚本的内容如下:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author suzezhi</span></span><br><span class="line"><span class="comment">#this script is only for CentOS 6</span></span><br><span class="line"><span class="comment">#check the OS</span></span><br><span class="line"></span><br><span class="line">platform=`uname -i`</span><br><span class="line"><span class="keyword">if</span> [ $platform != <span class="string">&quot;x86_64&quot;</span> ];then</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;this script is only for 64bit Operating System !&quot;</span></span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the platform is ok&quot;</span></span><br><span class="line"><span class="keyword">version</span>=`lsb_release -r |awk &#x27;&#123;print substr<span class="params">($2,1,1)</span>&#125;&#x27;`</span><br><span class="line"><span class="keyword">if</span> [ $<span class="keyword">version</span> != 6 ];then</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;this script is only for CentOS 6 !&quot;</span></span><br><span class="line">exit 1</span><br><span class="line">fi</span><br><span class="line">cat  EOF</span><br><span class="line">+<span class="params">---------------------------------------</span>+</span><br><span class="line">| your system is CentOS 6 x86_64 |</span><br><span class="line">| start optimizing.<span class="string">......</span> |</span><br><span class="line">+<span class="params">---------------------------------------</span></span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#make the 163.com as the default yum repo</span></span><br><span class="line">mv <span class="string">/etc/yum.repos.d/CentOS-Base.repo</span> <span class="string">/etc/yum.repos.d/CentOS-Base.repo.backup</span></span><br><span class="line">wget http:<span class="string">//mirrors.163.com/.help/CentOS6-Base-163.repo</span> -O <span class="string">/etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line"><span class="comment">#add the third-party repo</span></span><br><span class="line"><span class="comment">#add the epel</span></span><br><span class="line">rpm -Uvh http:<span class="string">//download.Fedora.RedHat.com/pub/epel/6/x86_64/epel-release-6-5.noarch.rpm</span></span><br><span class="line">rpm <span class="params">--import</span> <span class="string">/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span></span><br><span class="line"><span class="comment">#add the rpmforge</span></span><br><span class="line">rpm -Uvh http:<span class="string">//packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</span></span><br><span class="line">rpm <span class="params">--import</span> <span class="string">/etc/pki/rpm-gpg/RPM-GPG-KEY-rpmforge-dag</span></span><br><span class="line"><span class="comment">#update the system and set the ntp</span></span><br><span class="line">yum clean all</span><br><span class="line">yum -y update glibc*</span><br><span class="line">yum -y update yum* rpm* python*</span><br><span class="line">yum -y update</span><br><span class="line">yum -y install ntp</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;* 4 * * * /usr/sbin/ntpdate 210.72.145.44  /dev/null 2&amp;1&quot;</span>  <span class="string">/var/spool/cron/root</span></span><br><span class="line">service crond restart</span><br><span class="line"><span class="comment">#set the file limit</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ulimit -SHn 102400&quot;</span>  <span class="string">/etc/rc.local</span></span><br><span class="line">cat  <span class="string">/etc/security/limits.conf</span>  EOF</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#set the control-alt-delete to guard against the miSUSE</span></span><br><span class="line">sed -i &#x27;s<span class="comment">#exec /sbin/shutdown -r now##exec /sbin/shutdown -r now#&#x27; /etc/init/control-alt-delete.conf</span></span><br><span class="line"><span class="comment">#disable selinux</span></span><br><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; <span class="string">/etc/selinux/config</span></span><br><span class="line"><span class="comment">#set ssh</span></span><br><span class="line">sed -i &#x27;s/^GSSAPIAuthentication yes$<span class="string">/GSSAPIAuthentication</span> no/&#x27; <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line">sed -i &#x27;s/<span class="comment">#UseDNS yes/UseDNS no/&#x27; /etc/ssh/sshd_config</span></span><br><span class="line">service sshd restart</span><br><span class="line"><span class="comment">#tune kernel parametres</span></span><br><span class="line">cat  <span class="string">/etc/sysctl.conf</span>  EOF</span><br><span class="line">net.ipv4.tcp_fin_timeout = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line">net.ipv4.tcp_mem = 94500000 915000000 927000000</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line">net.core.somaxconn = 262144</span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 262144</span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">EOF</span><br><span class="line"><span class="string">/sbin/sysctl</span> -p</span><br><span class="line"><span class="comment">#define the backspace button can erase the last character typed</span></span><br><span class="line"><span class="keyword">echo</span> &#x27;stty erase ^H&#x27;  <span class="string">/etc/profile</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;syntax on&quot;</span>  <span class="string">/root/.vimrc</span></span><br><span class="line"><span class="comment">#stop some crontab</span></span><br><span class="line">mkdir <span class="string">/etc/cron.daily.bak</span></span><br><span class="line">mv <span class="string">/etc/cron.daily/makewhatis.cron</span> <span class="string">/etc/cron.daily.bak</span></span><br><span class="line">mv <span class="string">/etc/cron.daily/mlocate.cron</span> <span class="string">/etc/cron.daily.bak</span></span><br><span class="line">chkconfig bluetooth off</span><br><span class="line">chkconfig cups off</span><br><span class="line">chkconfig ip6tables off</span><br><span class="line"><span class="comment">#disable the ipv6</span></span><br><span class="line">cat  <span class="string">/etc/modprobe.d/ipv6.conf</span>  EOFI</span><br><span class="line"><span class="keyword">alias</span> net-pf-10 off</span><br><span class="line">options ipv6 disable=1</span><br><span class="line">EOFI</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NETWORKING_IPV6=off&quot;</span>  <span class="string">/etc/sysconfig/network</span></span><br><span class="line">cat  EOF</span><br><span class="line">+<span class="params">-------------------------------------------------</span>+</span><br><span class="line">| optimizer is done |</span><br><span class="line">| it&#x27;s recommond to restart this server ! |</span><br><span class="line">+<span class="params">-------------------------------------------------</span>+</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>对脚本的内容做一下说明:</p>
<p>先对系统进行判断,如果是Cent OS 64位,就继续运行.<br>先将系统的安装源设置为网易的(网易的安装源算是国内比较稳定的)<br>安装epel的源和rpmforge的源,利用第三方的源来让yum安装起来更方便<br>更新软件<br>设置为每天凌晨四点进行时间同步(跟国家授时中心的服务器进行时间同步)<br>将系统同时打开的文件个数增大<br>将ctrl ALT delete键进行屏蔽,防止误操作的时候服务器重启<br>关闭SELinux<br>禁用GSSAPI来认证,也禁用DNS反向解析,加快SSH登陆速度<br>优化一些内核参数<br>调整删除字符的按键为backspace(某些系统默认是delete)<br>打开vim的语法高亮<br>取消生成whatis数据库和locate数据库<br>关闭没用的服务<br>关闭IPv6</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS 5.5 yum 国内更新源</title>
    <url>/2018/01/03/1052/</url>
    <content><![CDATA[<p>备份yum配置文件,修改yum配置文件.</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">cp /etc/yum.repos.d/CentOS-<span class="module-access"><span class="module"><span class="identifier">Base</span>.</span></span>repo CentOS-<span class="module-access"><span class="module"><span class="identifier">Base</span>.</span></span>repo_bak</span><br><span class="line">vi /etc/yum.repo.d/CentOS-<span class="module-access"><span class="module"><span class="identifier">Base</span>.</span></span>repo</span><br></pre></td></tr></table></figure>

<p>我们使用中科大(ustc)yum源.用下面的内容覆盖CentOS-Base.repo就行了.</p>
<p>中科大(ustc)yum源,<code>http://centos.ustc.edu.cn/centos/5/</code>就是最新的,<br>也可以设置成 <code>http://centos.ustc.edu.cn/centos/5.5/</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Base</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/os/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[update]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Updates</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/updates/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#packages used/produced in the build but not released</span></span><br><span class="line">[addons]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Addons</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/addons/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Extras</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/extras/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Plus</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/centosplus/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#contrib - packages by Centos Users</span></span><br><span class="line">[contrib]</span><br><span class="line">name=CentOS-<span class="number">5</span> - Contrib</span><br><span class="line">baseurl=http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/contrib/</span><span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>中科大(ustc)yum源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="number">32</span>位: rpm --import http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/os/i</span>386/RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br><span class="line"><span class="number">64</span>位: rpm --import http:<span class="regexp">//</span>centos.ustc.edu.cn<span class="regexp">/centos/</span><span class="number">5</span><span class="regexp">/os/</span>x86_64/RPM-GPG-KEY-CentOS-<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>更新:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum update</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centOS 6下安装java</title>
    <url>/2015/09/07/1054/</url>
    <content><![CDATA[<p>centOS  默认有java的运行环境(gcj),安装sun的jdk前先卸载 gcj.</p>
<p>卸载gcj:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">$java -version <span class="meta">#查看当前gcj java的版本号(我这里得到的是 1.4.2)</span></span><br><span class="line">$yum -y remove java<span class="number">-1.4</span><span class="number">.2</span>-gcj-compat <span class="meta">#卸载gcj (y参数表示 在y/n 提问时均回答 y)</span></span><br></pre></td></tr></table></figure>

<p>卸载好了后,到 <a href="http://www.sun.com/">www.sun.com</a> 下载linux版本的 jdk.我选择的是 rpm 的版本.<br>最后:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">rpm -ivh 下载的包名<span class="string">.rpm</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS DHCP服务器配置</title>
    <url>/2013/10/23/1056/</url>
    <content><![CDATA[<p>DHCP服务的配置</p>
<p>下载最新版DHCPD:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">wget http://ftp.isc.org/isc/dhcp/dhcp-<span class="number">4.1</span><span class="number">.1b1</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压、安装、配置:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">root@localhost src</span>]<span class="meta"># tar -zxvf dhcp-4.1.1b1.tar.gz</span></span><br><span class="line">[<span class="meta">root@localhost src</span>]<span class="meta"># cd dhcp-4.1.1b1</span></span><br><span class="line">[<span class="meta">root@localhost dhcp-4.1.1b1</span>]<span class="meta"># configure</span></span><br><span class="line">[<span class="meta">root@localhost dhcp-4.1.1b1</span>]<span class="meta"># make;make install</span></span><br><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># vi /etc/dhcpd.conf</span></span><br><span class="line"></span><br><span class="line">ddns-update-style none;</span><br><span class="line">subnet <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>&#123;</span><br><span class="line">    range <span class="number">192.168</span><span class="number">.1</span><span class="number">.200</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span>;</span><br><span class="line">    ignore client-updates;</span><br><span class="line">    <span class="literal">default</span>-lease-time <span class="number">3600</span>;</span><br><span class="line">    max-lease-time <span class="number">7200</span>;</span><br><span class="line">    option routers <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>;</span><br><span class="line">    option domain-name<span class="string">&quot;qiufeng.cc&quot;</span>;</span><br><span class="line">    option domain-name-servers <span class="number">192.168</span><span class="number">.1</span><span class="number">.126</span>;</span><br><span class="line">&#125;</span><br><span class="line">host c1&#123;</span><br><span class="line">    hardware   ethernet  <span class="number">00</span>:E0:<span class="number">4</span>E:<span class="number">70</span>:<span class="number">33</span>:<span class="number">65</span>;</span><br><span class="line">    <span class="keyword">fixed</span>-address  <span class="number">192.168</span><span class="number">.1</span><span class="number">.222</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># touch /var/state/dhcp/dhcpd.leases     //新建租约文件</span></span><br><span class="line"></span><br><span class="line">[<span class="meta">root@localhost ~</span>]<span class="meta"># vi /etc/sysconfig/dhcpd      //设置DHCP守护进程的工作参数</span></span><br><span class="line"></span><br><span class="line">DHCPDARGS=eth0(设置DHCP守护进程监听网卡接口)</span><br></pre></td></tr></table></figure>

<p>下面如何启动呢、我们可以新建个启动脚本.<br>很简单修改下就行了……</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cd</span> <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span></span><br><span class="line"><span class="variable">$cp</span> atd dhcpd       <span class="regexp">//</span>我们拷贝atd为dhcpd</span><br><span class="line"><span class="variable">$vi</span> dhcpd         <span class="regexp">//</span>把里面的所有atd修改为dhcpd</span><br><span class="line"><span class="variable">$chkconfig</span> --add dhcpd  <span class="regexp">//</span>加载启动项dhcpd</span><br><span class="line"><span class="variable">$service</span> dhcpd start    <span class="regexp">//</span>启动DHCPD</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pstree|grep dhcpd</span></span><br><span class="line">     |-dhcpd</span><br><span class="line">[root@localhost ~]<span class="comment"># netstat -nlt</span></span><br><span class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">67</span>                  <span class="number">0.0</span>.<span class="number">0.0</span>:*</span><br></pre></td></tr></table></figure>

<p>启动成功…..</p>
<p>1.Linux客户端</p>
<p>设置网卡采用dhcp启动协议,自动获取ip地址信息:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-ethX(X可以<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>……)</span><br></pre></td></tr></table></figure>

<p>修改BOOTPROTO为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">BOOTPROTO</span>=dhcp</span><br></pre></td></tr></table></figure>

<p>获取IP地址:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$ifdown</span> ethX ;ifup ethX  (X可以取0,1,2,……)</span></span><br></pre></td></tr></table></figure>

<p>注意:linux系统的dhcp客户端使用dhclient脚本来获取IP地址信息.</p>
<p>2.Windows客户端</p>
<p>右击网上邻居—-属性——双击tcp/ip协议—-选择”自动获动IP地址”</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">c:</span>&gt;ipconfig/release</span><br><span class="line"><span class="symbol">c:</span>&gt;ipconfig/renew</span><br></pre></td></tr></table></figure>

<p>测试:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">C</span>:&gt;ipconfig/<span class="literal">all</span></span><br><span class="line"><span class="attribute">Windows</span> IP Configuration</span><br><span class="line"></span><br><span class="line">        <span class="attribute">Host</span> Name . . . . . . . . . . . . : <span class="number">20090315</span>-<span class="number">0851</span></span><br><span class="line">        <span class="attribute">Primary</span> Dns Suffix  . . . . . . . :</span><br><span class="line">        <span class="attribute">Node</span> Type . . . . . . . . . . . . : Unknown</span><br><span class="line">        <span class="attribute">IP</span> Routing Enabled. . . . . . . . : No</span><br><span class="line">        <span class="attribute">WINS</span> Proxy Enabled. . . . . . . . : No</span><br><span class="line">        <span class="attribute">DNS</span> Suffix Search List. . . . . . : qiufeng.cc</span><br><span class="line"></span><br><span class="line"><span class="attribute">Ethernet</span> adapter 本地连接:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">Connection</span>-specific DNS Suffix  . : qiufeng.cc</span><br><span class="line">        <span class="attribute">Description</span> . . . . . . . . . . . : Realtek RTL<span class="number">8139</span>/<span class="number">810</span>x Family Fast Eth</span><br><span class="line"><span class="attribute">ernet</span> NIC</span><br><span class="line">        <span class="attribute">Physical</span> Address. . . . . . . . . : <span class="number">00</span>-<span class="number">0</span>A-EB-<span class="number">79</span>-<span class="number">9</span>C-<span class="number">20</span></span><br><span class="line">        <span class="attribute">Dhcp</span> Enabled. . . . . . . . . . . : Yes</span><br><span class="line">        <span class="attribute">Autoconfiguration</span> Enabled . . . . : Yes</span><br><span class="line">        <span class="attribute">IP</span> Address. . . . . . . . . . . . : <span class="number">192.168.1.211</span></span><br><span class="line">        <span class="attribute">Subnet</span> Mask . . . . . . . . . . . : <span class="number">255.255.255.0</span></span><br><span class="line">        <span class="attribute">Default</span> Gateway . . . . . . . . . : <span class="number">192.168.1.1</span></span><br><span class="line">        <span class="attribute">DHCP</span> Server . . . . . . . . . . . : <span class="number">192.168.1.126</span></span><br><span class="line">        <span class="attribute">DNS</span> Servers . . . . . . . . . . . : <span class="number">192.168.1.126</span></span><br><span class="line">        <span class="attribute">Lease</span> Obtained. . . . . . . . . . : <span class="number">2009</span>年<span class="number">4</span>月<span class="number">18</span>日 星期六 <span class="number">17</span>:<span class="number">41</span>:<span class="number">41</span></span><br><span class="line">        <span class="attribute">Lease</span> Expires . . . . . . . . . . : <span class="number">2009</span>年<span class="number">4</span>月<span class="number">18</span>日 星期六 <span class="number">18</span>:<span class="number">41</span>:<span class="number">41</span></span><br></pre></td></tr></table></figure>

<p>OK成功……</p>
]]></content>
  </entry>
  <entry>
    <title>centos linux修改配置ip地址 网关 dns等信息的方法</title>
    <url>/2018/12/08/1059/</url>
    <content><![CDATA[<!--markdown-->一、CentOS 修改IP地址

<p>修改对应网卡的IP地址的配置文件:</p>
<pre><code>$ vi /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre>
<p>修改以下内容:</p>
<pre><code>DEVICE=eth0 #描述网卡对应的设备别名,例如ifcfg-eth0的文件中它为eth0
BOOTPROTO=static #设置网卡获得ip地址的方式,可能的选项为static,dhcp或bootp,分别对应静态指定的 ip地址,通过dhcp协议获得的ip地址,通过bootp协议获得的ip地址
BROADCAST=192.168.0.255 #对应的子网广播地址
HWADDR=00:07:E9:05:E8:B4 #对应的网卡物理地址
IPADDR=12.168.1.2 #如果设置网卡获得 ip地址的方式为静态指定,此字段就指定了网卡对应的ip地址
IPV6INIT=no
IPV6_AUTOCONF=no
NETMASK=255.255.255.0 #网卡对应的网络掩码
NETWORK=192.168.1.0 #网卡对应的网络地址
ONBOOT=yes #系统启动时是否设置此网络接口,设置为yes时,系统启动时激活此设备
</code></pre>
<p>二、CentOS 修改网关</p>
<p>修改对应网卡的网关的配置文件:</p>
<pre><code>[root@centos]# vi /etc/sysconfig/network
</code></pre>
<p>修改以下内容:</p>
<pre><code>NETWORKING=yes(表示系统是否使用网络,一般设置为yes.如果设为no,则不能使用网络,而且很多系统服务程序将无法启动)
HOSTNAME=centos(设置本机的主机名,这里设置的主机名要和/etc/hosts中设置的主机名对应)
GATEWAY=192.168.1.1(设置本机连接的网关的IP地址.例如,网关为10.0.0.2)
</code></pre>
<p>三、CentOS 修改DNS</p>
<p>修改对应网卡的DNS的配置文件:</p>
<pre><code>$ vi /etc/resolv.conf
</code></pre>
<p>修改以下内容:</p>
<pre><code>nameserver 8.8.8.8 #google域名服务器
nameserver 8.8.4.4 #google域名服务器
</code></pre>
<p>四、重新启动网络配置</p>
<pre><code>$ service network restart
</code></pre>
<p>或:</p>
<pre><code>$ /etc/init.d/network restart
</code></pre>
]]></content>
  </entry>
  <entry>
    <title>centos configure error Can&#39;t find ext2fs library</title>
    <url>/2017/01/14/1055/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install e<span class="number">2</span>fsprogs.x<span class="number">86</span>_<span class="number">64</span> e<span class="number">2</span>fsprogs-devel.x<span class="number">86</span>_<span class="number">64</span> e<span class="number">2</span>fsprogs-libs.x<span class="number">86</span>_<span class="number">64</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS Linux 升级内核步骤和方法</title>
    <url>/2011/03/02/1057/</url>
    <content><![CDATA[<p>当前系统为CentOS Linux release 6.0 (Final),内核版本为2.6.32-71.el6.i686.由于最近内核出现最新的漏洞(linux kernel 又爆内存提权漏洞,2.6.39 内核无一幸免,所以将内核升级至3.2.2最新版本.</p>
<p>1、查看当前系统内核</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">uname</span> -r<span class="number">2</span> <span class="number">2</span>.<span class="number">6</span>.<span class="number">32</span>-<span class="number">71</span>.el<span class="number">6</span>.i<span class="number">686</span></span><br></pre></td></tr></table></figure>

<p>2、下载linux-3.2.2内核包</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> ~</span><br><span class="line"><span class="attribute">wget</span> -c http://www.kernel.org/pub/linux/kernel/v<span class="number">3</span>.<span class="number">0</span>/linux-<span class="number">3</span>.<span class="number">2</span>.<span class="number">2</span>.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">tar</span> jxvf linux-<span class="number">3</span>.<span class="number">2</span>.<span class="number">2</span>.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">cd</span> linux-<span class="number">3</span>.<span class="number">2</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>3、配置内核并安装</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make</span> mrproper  <span class="meta">#清除环境变量,即清除配置文件</span></span><br><span class="line"><span class="built_in">make</span> menuconfig  <span class="meta">#在菜单模式下选择需要编译的内核模块</span></span><br></pre></td></tr></table></figure>

<p>找到以下选中选项并选中:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">networking support → networking options → network packet filtering framework(netfilter)</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>)Core netfilter configuration</span><br><span class="line"></span><br><span class="line">    勾中<span class="string">&quot;Netfilter connection tracking support&quot;</span> -m <span class="keyword">state</span>相关模块是依赖它的,不选则没有.</span><br><span class="line">    将netbios name service protocal support(new) 编译成模块,不然后面升级iptables后启动时会出错</span><br><span class="line">    勾中<span class="string">&quot;Netfilter Xtables support (required for ip_tables)&quot;</span></span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)IP: Netfilter Configuration</span><br><span class="line"></span><br><span class="line">    将 <span class="string">&quot;IPv4 connection tracking support (require for NAT)&quot;</span> 编译成模块.</span><br><span class="line">    勾中IP tables support (required <span class="keyword">for</span> filtering/masq/NAT) .</span><br><span class="line">    将 <span class="string">&quot;Full NAT&quot;</span> 下的 <span class="string">&quot;MASQUERADE target support&quot;</span> 和 <span class="string">&quot;REDIRECT target support&quot;</span> 编译成模块</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)其它模块可以根据自己的需要进行选择,若不懂可以参考内核配置手册.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make clean <span class="comment">#确保所有东西均保持最新状态.</span></span><br><span class="line">make bzImage <span class="comment">#生成内核文件</span></span><br><span class="line">make modules <span class="comment">#编译模块</span></span><br><span class="line">make modules_install <span class="comment">#安装模块</span></span><br><span class="line">make install <span class="comment">#安装</span></span><br></pre></td></tr></table></figure>

<p>4、编辑 <code>/etc/grub.conf</code>文件,将 default=1改为 default=0.</p>
<p>5、重启系统,并查看内核</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">uname</span> -r<span class="number">3</span>.<span class="number">2</span>.<span class="number">32</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos linux 文件误删找回工具 Extundelete</title>
    <url>/2016/10/15/1058/</url>
    <content><![CDATA[<!--markdown-->1.安装

<p>此工具依赖两个包e2fsprogs version 1.41和e2fslibs在RH/Centos系列上名字为e2fsprogs和e2fsprogs-libs.</p>
<pre><code>tar -xvf extundelete-0.2.0.tar
./configure
make &amp;&amp; make install
</code></pre>
<p>好了,安装完毕.</p>
<p>2.如何使用</p>
<p>我们使用一个分区<code>/dev/sdb1</code>挂在在<code>/backup</code>上,建立一个测试目录gnutool-delete 并建立一些文件:</p>
<pre><code>mkdir -p /backup/gnutool-delete
cd /backup/gnutool-delete
man man &gt; file1-test.txt
man man &gt; file2-test.txt
mkdir folder1; cd folder1; man man &gt; file1-test.txt
</code></pre>
<p>现在删除目录:</p>
<pre><code>rm -rf /backup/gnutool-delete
</code></pre>
<p>现在卸载文件系统或者挂载为只读:</p>
<pre><code>umount /backup or mount -o remount,ro /backup
</code></pre>
<p>3 我们现在使用extundelete来找回</p>
<p>extundelete会在当前目录创建一个”RECOVERED_FILES”来放修复的文件,使用以下命令找回所有文件.</p>
<pre><code>extundelete /dev/sdb1 –restore-all
</code></pre>
<p>也可以使用以下命令修复指定文件:</p>
<pre><code>extundelete /dev/sdb1 —-restore-directory /backup/gnutool-delete
</code></pre>
<p>4.找回/目录的文件</p>
<p>首先挂载/分区为只读,准备一个可以读写的分区,我们以/etc/passwd文件为例:</p>
<pre><code>mount -o remount,ro /
cd /secondarydrive (必须可读可写)
extundelete / —-restore-files /etc/passwd
cd RECOVERED_FILES
ls
</code></pre>
<p>好了,修复完毕.</p>
]]></content>
  </entry>
  <entry>
    <title>centos pdf阅读器</title>
    <url>/2012/08/22/1060/</url>
    <content><![CDATA[<p>centos默认的pdf阅读器就很好用,可是自己安装的gnome却没有包含这个软件,<br>经过搜索,发现这个软件叫evince,所以只要执行:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> evince</span><br></pre></td></tr></table></figure>

<p>就可以把这个软件安装回来了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos python3.4安装pip和pyaudio</title>
    <url>/2018/01/05/1062/</url>
    <content><![CDATA[<p>从官方github获取具体版本的pip:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget  https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/pypa/g</span>et-pip<span class="regexp">/master/</span><span class="number">2.6</span>/get-pip.py</span><br></pre></td></tr></table></figure>

<p>运行刚才获取的pip文件:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">python3</span>.<span class="number">4</span> <span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>

<p>然后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git clone http:<span class="regexp">//</span>people.csail.mit.edu<span class="regexp">/hubert/gi</span>t/pyaudio.git</span><br><span class="line">cd pyaudio/</span><br><span class="line">sudo yum -y install portaudio portaudio-devel</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS PPTP配置FreeRADIUS+DaloRADIUS实现高级用户控制+流量控制</title>
    <url>/2015/11/05/1061/</url>
    <content><![CDATA[<p>前提条件</p>
<p>阅读本文前,您需要搭建好PPTP,LAMP,教程本站搜索.</p>
<p>PPP:Point-to-Point Protocol,点对点协议,是工作在数据链路层的连接协议.常见的ADSL连接时使用的PPPoE便是指的以太网上的点对点协议(Point-to-Point Protocol over Ethernet).而我们创建连接VPN时也会通过PPP来进行,*nix操作系统上的pppd能够完成这一任务,其进行用户验证的默认方法便是chap-secrets文件.配置完FreeRADIUS后,我们需要把用户验证这一环节交给RADIUS服务器来完成.</p>
<p>RADIUS:Remote Authentication Dial In User Service,远程用户拨号验证服务,基于RFC2865和RFC2866.具体的工作原理挺复杂的,仔细阅读这两个RFC标准应该可以搞明白.简单的说,它是一个兼顾验证(authentication)、授权(authorization)及记账(accounting)三种服务的协议,即AAA协议.RADIUS运行在应用层,使用UDP进行传输,它被广泛用于ISP和企业用来控制Internet或内部网络、无线网络的访问.</p>
<p>FreeRADIUS:是一个实现RADIUS协议的软件,基于GPLv2开源.它是目前部署最广泛的开源RADIUS软件.<br>daloRADIUS:是一个FreeRADIUS的Web挂历程序,使用PHP编写.</p>
<p>安装配置</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install freeradius<span class="number">2</span> freeradius<span class="number">2</span>-mysql freeradius<span class="number">2</span>-utils</span><br></pre></td></tr></table></figure>

<p>安装完以后,编辑 <code>/etc/raddb/users</code>,加上:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">testing </span>Cleartext-Password := &quot;password&quot;</span><br></pre></td></tr></table></figure>

<p>打开radius的测试模式,执行radiusd -X,然后打开一个新终端,执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">radtest</span> testing password <span class="number">127.0.0.1</span> <span class="number">0</span> testing<span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>如果看到Access-Accept,说明没问题,如果没看到,返回去检查.<br>测试连接成功后,我们可以把users里临时加上去的第一行删除.</p>
<p>下载ppp源码</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget ftp:<span class="regexp">//</span>ftp.samba.org<span class="regexp">/pub/</span>ppp/ppp-<span class="number">2.4</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">tar zxvf ppp-<span class="number">2.4</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">cp -R <span class="regexp">/root/</span>ppp-<span class="number">2.4</span>.<span class="number">5</span><span class="regexp">/pppd/</span>plugins<span class="regexp">/radius/</span>etc<span class="regexp">/ /u</span>sr<span class="regexp">/local/</span>etc/radiusclient</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/usr/local/etc/radiusclient/servers</code>,加上一组服务器和密钥,本例中为”LaoxieVPN”:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">localhost LaoxieVPN</span></span><br></pre></td></tr></table></figure>

<p>编辑 <code>/usr/local/etc/radiusclient/dictionary</code>:</p>
<p>最后一行改成:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INCLUDE</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>radiusclient/dictionary.microsoft</span><br></pre></td></tr></table></figure>

<p>然后添加一行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INCLUDE</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>radiusclient/dictionary.merit</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/raddb/clients.conf</code>:</p>
<p>把client localhost段下的secret改成刚才指定的密钥.</p>
<p>编辑 <code>/etc/raddb/radiusd.conf</code>,找到:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$INCLUDE</span> sql.conf</span></span><br></pre></td></tr></table></figure>

<p>去掉前面的#;找到:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$INCLUDE</span> sql<span class="regexp">/mysql/</span>counter.conf</span><br></pre></td></tr></table></figure>

<p>去掉前面的#.</p>
<p>进入mysql,添加数据库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">create database radius;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/raddb/sql.conf</code>,配置login(用户名),password(密码),radius_db(数据库名)等字段,并找到readclients一行,设为yes并去掉注释符号#.</p>
<p>编辑 <code>/etc/raddb/sites-enabled/default</code>,根据下面的说明注释或取消注释相应的行:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">authorize段,关掉files,打开<span class="keyword">sql</span>,也可以把unix关掉</span><br><span class="line">preacct段,关掉files</span><br><span class="line">accounting段,打开<span class="keyword">sql</span>,也可以把unix关掉</span><br><span class="line"><span class="keyword">session</span>段,打开<span class="keyword">sql</span></span><br><span class="line">post-auth段,打开<span class="keyword">sql</span></span><br><span class="line">pre-proxy段,关掉files</span><br></pre></td></tr></table></figure>

<p>到这一步,我们的FreeRADIUS就算配置好了,用户信息都将保存在MySQL数据库中.至于数据库中的表,我们在后面统一导入.</p>
<p>配置DaloRADIUS</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://sourceforge.net/projects/daloradius/files/daloradius/daloradius-<span class="number">0</span>.<span class="number">9</span>-<span class="number">8</span>/daloradius-<span class="number">0</span>.<span class="number">9</span>-<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="attribute">pear</span> install DB</span><br><span class="line"><span class="attribute">mkdir</span> /usr/share/daloRadius</span><br><span class="line"><span class="attribute">tar</span> zxvf daloradius-<span class="number">0</span>.<span class="number">9</span>-<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="attribute">mv</span> daloradius-<span class="number">0</span>.<span class="number">9</span>-<span class="number">8</span>/* /usr/share/daloRadius/</span><br><span class="line"><span class="attribute">rm</span> -r daloradius-<span class="number">0</span>.<span class="number">9</span>-<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>注意,这里需要安装pear,如果bash提示找不到命令,那么请自行google安装方法.</p>
<p>下面导入数据库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p radius &lt; <span class="regexp">/usr/</span>share<span class="regexp">/daloRadius/</span>contrib<span class="regexp">/db/</span>fr2-mysql-daloradius-and-freeradius.sql</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/usr/share/daloRadius/library/daloradius.conf.php</code>,修改daloRADIUS的配置文件.首先是MySQL登录信息:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$configValues</span>[<span class="string">&#x27;CONFIG_DB_HOST&#x27;</span>] = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable">$configValues</span>[<span class="string">&#x27;CONFIG_DB_USER&#x27;</span>] = <span class="string">&#x27;radius&#x27;</span>; <span class="regexp">//</span>根据自己实际情况填写</span><br><span class="line"><span class="variable">$configValues</span>[<span class="string">&#x27;CONFIG_DB_PASS&#x27;</span>] = <span class="string">&#x27;&#x27;</span>; <span class="regexp">//</span> 设为自己的密码</span><br><span class="line"><span class="variable">$configValues</span>[<span class="string">&#x27;CONFIG_DB_NAME&#x27;</span>] = <span class="string">&#x27;radius&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>下面有一个daloRADIUS的bug,默认配置中有一个表名和我们导入的不一样,把它改过来:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$co</span>nfigValues[<span class="string">&#x27;CONFIG_DB_TBL_RADUSERGROUP&#x27;</span>] = <span class="string">&#x27;radusergroup&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>然后修改daloRADIUS的路径:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$co</span>nfigValues[<span class="string">&#x27;CONFIG_PATH_DALO_VARIABLE_DATA&#x27;</span>] = <span class="string">&#x27;/usr/share/daloRadius/var&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>网页目录下建目录链接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/apache/</span>htdocs/</span><br><span class="line">ln -s <span class="regexp">/usr/</span>share<span class="regexp">/daloRadius/</span> admin</span><br></pre></td></tr></table></figure>

<p>daloRADIUS管理页面地址就是 <a href="http://ip/admin">http://ip/admin</a> ,默认用户名administrator和密码radius登录.<br>重启mysql和apache服务:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">service httpd <span class="built_in">restart</span></span><br><span class="line">service mysqld <span class="built_in">restart</span></span><br></pre></td></tr></table></figure>

<p>daloRADIUS似乎写的不怎么样,最新稳定版已经是三年之前的了,不过作者直到现在还在更新SVN,下次有机会可以用最新的SVN版本试试看.在Management中添加一个新用户,注意密码类型选择Cleartext-Password.<br>在终端里再次启动radiusd -X,同时在另一个终端中用radtest username password localhost 0 LaoxieVPN测试一下,看看现在是不是还能正常接通,如果没问题就OK,让我们把这套系统接驳到PPP上.</p>
<p>配置Pppd</p>
<p>编辑 <code>/etc/ppp/options.pptpd</code>,里面已经有许多配置选项了,我们要保证有下面的几行,如果没有就添加上去,为了保障用户登录的安全我们限制只使用MS-CHAPv2:</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ref</span>use-pap</span><br><span class="line"><span class="built_in">ref</span>use-chap</span><br><span class="line"><span class="built_in">ref</span>use-mschap</span><br><span class="line">require-mppe<span class="number">-128</span></span><br><span class="line">require-mschap-v2</span><br></pre></td></tr></table></figure>

<p>在配置文件最后加上3行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">plugin radius.so</span><br><span class="line">plugin radattr.so</span><br><span class="line">radius-config-<span class="keyword">file</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>radiusclient/radiusclient.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/etc/</span>raddb<span class="regexp">/sql/my</span>sql/counter.conf</span><br></pre></td></tr></table></figure>

<p>在文件末尾添加下面代码:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sqlcounter monthlytrafficcounter &#123;</span><br><span class="line">    counter-<span class="type">name</span> = Monthly-Traffic</span><br><span class="line">    <span class="keyword">check</span>-<span class="type">name</span> = Max-Monthly-Traffic</span><br><span class="line">    reply-<span class="type">name</span> = Monthly-Traffic-<span class="keyword">Limit</span></span><br><span class="line">    sqlmod-inst = <span class="keyword">sql</span></span><br><span class="line">    key = <span class="keyword">User</span>-<span class="type">Name</span></span><br><span class="line">    <span class="keyword">reset</span> = monthly</span><br><span class="line">    query = &quot;SELECT SUM(acctinputoctets + acctoutputoctets) FROM radacct WHERE UserName=&#x27;%&#123;%k&#125;&#x27; AND UNIX_TIMESTAMP(AcctStartTime) &gt; &#x27;%b&#x27;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码意思是按月进行统计,从数据库的radacct表中,根据用户名(%k)将所有入站和出站流量累加.</p>
<p>时间也是可以自定义的(months、weeks、days、hours),也可以指定具体值,如三天重置一次 “reset = 3 d”.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>raddb<span class="regexp">/sites-enabled/</span><span class="keyword">default</span></span><br></pre></td></tr></table></figure>

<p>在authorize区块的末尾(205行)添加:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">monthlytrafficcounter</span></span><br></pre></td></tr></table></figure>

<p>添加字典文件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>raddb/dictionary</span><br></pre></td></tr></table></figure>

<p>在文件末尾添加下面两行:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ATTRIBUTE</span> Max-Monthly-Traffic <span class="number">3003</span> <span class="type">integer</span></span><br><span class="line"><span class="keyword">ATTRIBUTE</span> Monthly-Traffic-<span class="keyword">Limit</span> <span class="number">3004</span> <span class="type">integer</span></span><br></pre></td></tr></table></figure>

<p>流量控制服务</p>
<p>建立表格:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Auth-Type&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;Local&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Service-Type&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;Framed-User&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Framed-IP-Address&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;255.255.255.255&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Framed-IP-Netmask&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;255.255.255.0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Acct-Interim-Interval&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;600&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupreply (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Max-Monthly-Traffic&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;5368709120&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radgroupcheck (groupname,<span class="keyword">attribute</span>,op,<span class="keyword">VALUE</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;Simultaneous-Use&#x27;</span>,<span class="string">&#x27;:=&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>以上前四行不用改动,acct-interim-interval是计算流量的间隔(600秒),意味着每隔10分钟记录当前流量.倒数第二行是每月最大流量,这里是5G(单位是字节).最后一行是允许同时连接数目.</p>
<p>访问daloRADIUS,在Management中添加一个新用户,注意密码类型选择Cleartext-Password.用户组选择user.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">radiusd</span> -X</span><br><span class="line"><span class="attribute">radtest</span> username password localhost <span class="number">0</span> LaoxieVPN</span><br></pre></td></tr></table></figure>

<p>测试一下,看看现在是不是还能正常接通,如果没问题就OK.</p>
<p>如果结果中有Access-Accept就代表成功了,否则退回去检查设置.</p>
<p>测试成功的话添加在认证时检测流量的语句,打开/etc/raddb/sites-enabled/default,找到authorize一节插入:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">update request &#123;</span><br><span class="line">    Group-Name := <span class="string">&quot;%&#123;sql:SELECT groupname FROM radusergroup WHERE username=&#x27;%&#123;User-Name&#125;&#x27; ORDER BY priority&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;%&#123;sql: SELECT SUM(acctinputoctets+acctoutputoctets) FROM radacct WHERE username=&#x27;%&#123;User-Name&#125;&#x27; AND date_format(acctstarttime, &#x27;%Y-%m-%d&#x27;) &gt;= date_format(now(),&#x27;%Y-%m-01&#x27;) AND date_format(acctstoptime, &#x27;%Y-%m-%d&#x27;) &lt;= last_day(now());&#125;&quot;</span> &gt;= <span class="string">&quot;%&#123;sql: SELECT value FROM radgroupreply WHERE groupname=&#x27;%&#123;Group-Name&#125;&#x27; AND attribute=&#x27;Max-Monthly-Traffic&#x27;;&#125;&quot;</span>) &#123;</span><br><span class="line">reject</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service radiusd <span class="built_in">start</span></span><br><span class="line">chkconfig radiusd <span class="keyword">on</span></span><br><span class="line">chkconfig pptpd <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>自动断线检测脚本:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">MYSQL_PASS=XXXXXXXXXX</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysql -uroot -p<span class="variable">$MYSQL_PASS</span> -e <span class="string">&quot;UPDATE radius.radacct SET acctstoptime = acctstarttime + acctsessiontime WHERE ((UNIX_TIMESTAMP(acctstarttime) + acctsessiontime + 240 - UNIX_TIMESTAMP())&lt;0) AND acctstoptime IS NULL;&quot;</span></span><br></pre></td></tr></table></figure>

<p>至此,已经完成所有操作了!</p>
<p>常见错误</p>
<p>执行radiusd -X的时候,提示:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>raddb/sql.conf[<span class="number">22</span>]: Instantiation failed <span class="keyword">for</span> module <span class="string">&quot;sql&quot;</span></span><br><span class="line"><span class="regexp">/etc/</span>raddb<span class="regexp">/sites-enabled/</span><span class="keyword">default</span>[<span class="number">177</span>]: Failed to load module <span class="string">&quot;sql&quot;</span>.</span><br><span class="line"><span class="regexp">/etc/</span>raddb<span class="regexp">/sites-enabled/</span><span class="keyword">default</span>[<span class="number">69</span>]: Errors parsing authorize section.</span><br></pre></td></tr></table></figure>

<p>解决办法:<br>mysql&gt; ALTER TABLE <code>radius</code>.<code>nas</code> ADD COLUMN <code>server</code> VARCHAR(45) NOT NULL AFTER <code>secret</code> ;<br>service mysqld restart</p>
]]></content>
  </entry>
  <entry>
    <title>Centos yum方式安装lighttpd的web环境</title>
    <url>/2016/08/12/1063/</url>
    <content><![CDATA[<p>Lighttpd 是一款开源 Web 服务器软件.Lighttpd 安全快速,符合行业标准,适配性强并且针对高配置环境进行了优化.相对于其它的 Web 服务器而言,Lighttpd 占用内存更少;因其对 CPU 占用小和对处理速度的优化而在效率和速度方面从众多 Web 服务器中脱颖而出.而 Lighttpd 诸如 FastCGI、CGI、认证、输出压缩、URL 重写等高级功能更是那些面临性能压力的服务器的福音.</p>
<p>以下是我们在运行 Ubuntu 15.04 或 CentOS 7 Linux 发行版的机器上安装 Lighttpd Web 服务器的简要流程.</p>
<p>安装 Lighttpd:</p>
<p>使用包管理器安装.<br>这里我们通过使用包管理器这种最简单的方法来安装 Lighttpd.只需以 sudo 模式在终端或控制台中输入下面的指令即可.</p>
<p>由于 CentOS 7.0 官方仓库中并没有提供 Lighttpd,所以我们需要在系统中安装额外的软件源 epel 仓库.使用下面的 yum 指令来安装 epel.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">yum install epel-release</span><br></pre></td></tr></table></figure>

<p>然后,我们需要更新系统及为 Lighttpd 的安装做前置准备.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum update</span><br><span class="line">yum <span class="keyword">install</span> lighttpd</span><br></pre></td></tr></table></figure>

<p>在 Linux 中安装 Lighttpd Web 服务器在 Linux 中安装 Lighttpd Web 服务器.</p>
<p>从源代码安装 Lighttpd:</p>
<p>如果想从 Lighttpd 源码安装最新版本(例如 1.4.39),我们需要在本地编译源码并进行安装.首先我们要安装编译源码所需的依赖包.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/tmp/</span></span><br><span class="line">wget http:<span class="regexp">//</span>download.lighttpd.net<span class="regexp">/lighttpd/</span>releases-<span class="number">1.4</span>.x/lighttpd-<span class="number">1.4</span>.<span class="number">39</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>下载完成后,执行下面的指令解压缩.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf lighttpd-<span class="number">1</span>.<span class="number">4</span>.<span class="number">39</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>然后使用下面的指令进行编译.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> lighttpd-1.4.39</span><br><span class="line"><span class="string">./configure</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>注:在这份教程中,我们安装的是默认配置的 Lighttpd.其他拓展功能,如对 SSL 的支持,modrewrite,modredirect 等,需自行配置.</p>
<p>当编译完成后,我们就可以把它安装到系统中了.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">make <span class="keyword">install</span></span><br></pre></td></tr></table></figure>

<p>设置 Lighttpd:</p>
<p>如果有更高的需求,我们可以通过修改默认设置文件,如/etc/lighttpd/lighttpd.conf,来对 Lighttpd 进行进一步设置. 而在这份教程中我们将使用默认设置,不对设置文件进行修改.如果你曾做过修改并想检查设置文件是否出错,可以执行下面的指令.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">lighttpd -t -f <span class="regexp">/etc/</span>lighttpd/lighttpd.conf</span><br></pre></td></tr></table></figure>

<p>使用 CentOS 7 在 CentOS 7 中,我们需创建一个在 Lighttpd 默认配置文件中设置的 webroot 文件夹,例如/src/www/htdocs.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/srv/</span>www<span class="regexp">/htdocs/</span></span><br></pre></td></tr></table></figure>

<p>而后将默认欢迎页面从 <code>/var/www/lighttpd</code>复制至刚刚新建的目录中:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp -r <span class="regexp">/var/</span>www<span class="regexp">/lighttpd/</span>* <span class="regexp">/srv/</span>www<span class="regexp">/htdocs/</span></span><br></pre></td></tr></table></figure>

<p>开启服务:</p>
<p>现在,通过执行 systemctl 指令来重启 Web 服务.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> lighttpd</span><br></pre></td></tr></table></figure>

<p>然后我们将它设置为伴随系统启动自动运行.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> lighttpd</span><br></pre></td></tr></table></figure>

<p>设置防火墙:</p>
<p>如要让我们运行在 Lighttpd 上的网页或网站能在 Internet 或同一个网络内被访问,我们需要在防火墙程序中设置打开 80 端口.由于 CentOS 7 和 Ubuntu15.04 都附带 Systemd 作为默认初始化系统,所以我们默认用的都是 firewalld.如果要打开 80 端口或 http 服务,我们只需执行下面的命令:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=http</span><br><span class="line"><span class="keyword">success</span></span><br><span class="line"><span class="keyword"></span>firewall-cmd --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<p>连接至 Web 服务器:</p>
<p>在将 80 端口设置为默认端口后,我们就可以直接访问 Lighttpd 的默认欢迎页了.我们需要根据运行 Lighttpd 的设备来设置浏览器的 IP 地址和域名.在本教程中,我们令浏览器访问 <a href="http://www.shuxun.wang/">http://www.shuxun.wang/</a> ,同时将该子域名指向上述 IP 地址.如此一来,我们就可以在浏览器中看到如下的欢迎页面了.</p>
<p>在 Linux 中安装 Lighttpd Web 服务器在 Linux 中安装 Lighttpd Web 服务器.<br>此外,我们可以将网站的文件添加到 webroot 目录下,并删除 Lighttpd 的默认索引文件,使我们的静态网站可以在互联网上访问.<br>如果想在 Lighttpd Web 服务器中运行 PHP 应用,请参考下面的步骤:</p>
<p>安装 PHP5 模块:</p>
<p>在 Lighttpd 成功安装后,我们需要安装 PHP 及相关模块,以在 Lighttpd 中运行 PHP5 脚本.</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">yum install php php-cgi php-fpm php-mysql php-curl php-gd php-<span class="built_in">int</span>l php-pecl-imagick php-mcrypt php-memcache php-pear lighttpd-fastcgi</span><br></pre></td></tr></table></figure>

<p>设置 Lighttpd 的 PHP 服务:</p>
<p>如要让 PHP 与 Lighttpd 协同工作,我们只要根据所使用的发行版执行如下对应的指令即可.</p>
<p>首先要做的便是使用文件编辑器编辑 php 设置文件(例如 <code>/etc/php.ini</code>)并取消掉对cgi.fix_pathinfo=1这一行的注释.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>php.ini</span><br></pre></td></tr></table></figure>

<p>完成上面的步骤之后,我们需要把 PHP-FPM 进程的所有权从 Apache 转移至 Lighttpd.要完成这些,首先用文件编辑器打开 <code>/etc/php-fpm.d/www.conf</code>文件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>

<p>然后在文件中增加下面的语句:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">user</span> <span class="title">= lighttpd</span></span><br><span class="line"><span class="keyword">group</span> <span class="title">= lighttpd</span></span><br></pre></td></tr></table></figure>

<p>做完这些,我们保存并退出文本编辑器.然后从 <code>/etc/lighttpd/modules.conf</code>设置文件中添加 FastCGI 模块.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>lighttpd/modules.conf</span><br></pre></td></tr></table></figure>

<p>然后,去掉下面语句前面的#来取消对它的注释.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;conf.d/fastcgi.conf&quot;</span></span><br></pre></td></tr></table></figure>

<p>最后我们还需在文本编辑器设置 FastCGI 的设置文件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>lighttpd<span class="regexp">/conf.d/</span>fastcgi.conf</span><br></pre></td></tr></table></figure>

<p>在文件尾部添加以下代码:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">fastcgi.server += ( <span class="string">&quot;.php&quot;</span> =&gt;</span><br><span class="line">((</span><br><span class="line"><span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;port&quot;</span> =&gt; <span class="string">&quot;9000&quot;</span>,</span><br><span class="line"><span class="string">&quot;broken-scriptfilename&quot;</span> =&gt; <span class="string">&quot;enable&quot;</span></span><br><span class="line">))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>在编辑完成后保存并退出文本编辑器即可.<br>然后,执行下列命令来重启 Lighttpd.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">systemctl force-reload lighttpd</span></span><br></pre></td></tr></table></figure>

<p>检测PHP工作状态:</p>
<p>如需检测 PHP 是否按预期工作,我们需在 Lighttpd 的 webroot 目录下新建一个 php 文件.本教程中,CentOS下 <code>/src/www/htdocs</code>目录下使用文本编辑器创建并打开info.php.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/var/</span>www/info.php</span><br></pre></td></tr></table></figure>

<p>然后只需将下面的语句添加到文件里即可.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在编辑完成后保存并推出文本编辑器即可.</p>
<p>现在,我们需根据路径 <a href="http://www.shuxun.wang/info.php">http://www.shuxun.wang/info.php</a> 下的 info.php 文件的 IP 地址或域名,来让我们的网页浏览器指向系统上运行的 Lighttpd.如果一切都按照以上说明进行,我们将看到如下图所示的 PHP 页面信息.</p>
<p>总结:</p>
<p>至此,我们已经在 CentOS 7 和 Ubuntu 15.04 Linux 发行版上成功安装了轻巧快捷并且安全的 Lighttpd Web 服务器.现在,我们已经可以上传网站文件到网站根目录、配置虚拟主机、启用 SSL、连接数据库,在我们的 Lighttpd Web 服务器上运行 Web 应用等功能了.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos 安装 memcached</title>
    <url>/2014/04/15/1064/</url>
    <content><![CDATA[<p>memcached的安装包括:1、服务端的安装;2、客户端的安装.</p>
<p>1、服务端的安装:</p>
<p>在这里,由于用编译安装memcached服务端过于复杂,因此我选用依赖管理工具 yum 来实现 memcached 的服务端安装:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> /]<span class="variable">$ </span>yum install -y memcached</span><br><span class="line"><span class="comment">#-y 表示自动应答,即默认安装所有需要用到的依赖包</span></span><br></pre></td></tr></table></figure>

<p>在这一步之后,我们就安装完了.<br>我们尝试去启动一下memcached:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="regexp">/]$ /u</span>sr<span class="regexp">/bin/m</span>emcached -b -l <span class="number">127.0</span>.<span class="number">0.1</span> -p <span class="number">11211</span> -m <span class="number">150</span> -u root</span><br><span class="line"><span class="comment">#-b 守护进程模式(退出终端窗口之后使程序还在运行),-l 指定IP地址127.0.0.1 ,-p 指定端口号11211,-m 为memcached分配多少内存(单位:M),-u 指定使用哪个用户启动memcached</span></span><br></pre></td></tr></table></figure>

<p>查看memcached是否在运行:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># ps -ef | grep memcached</span></span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># pstree -p | grep memcached</span></span><br></pre></td></tr></table></figure>

<p>如果能够看到存在memcached进程,那就说明我们的 memcached 服务端已经安装成功了.</p>
<p>2、客户端的安装:</p>
<p>客户端的安装又分为两步:1、libmemcached 客户端库的安装;2、为PHP安装 php-memcached 扩展.<br>现在我们先来下载后面安装所需要的两个安装包.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="regexp">/]$ cd /u</span>sr<span class="regexp">/local/</span>src   <span class="comment">#我的所有源码包习惯放在该目录下</span></span><br><span class="line">[root@localhost src]$ wget https:<span class="regexp">//</span>launchpad.net<span class="regexp">/libmemcached/</span><span class="number">1.0</span><span class="regexp">/1.0.18/</span>+download/libmemcached-<span class="number">1.0</span>.<span class="number">18</span>.tar.gz  <span class="comment">#下载libmemcached源码包</span></span><br><span class="line">[root@localhost src]$ wget http:<span class="regexp">//</span>pecl.php.net<span class="regexp">/get/m</span>emcached-<span class="number">2.2</span>.<span class="number">0</span>.tgz  <span class="comment">#下载memcached源码包</span></span><br><span class="line">[root@localhost src]$ ls</span><br><span class="line">libmemcached-<span class="number">1.0</span>.<span class="number">18</span>.tar.gz  memcached-<span class="number">2.2</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p>1、libmemcached 客户端库的安装:</p>
<p>首先解压 libmemcached-1.0.18.tar.gz配置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost src]$ tar -zxvf libmemcached-<span class="number">1.0</span>.<span class="number">18</span>.tar.gz</span><br><span class="line">[root@localhost src]$ cd libmemcached-<span class="number">1.0</span>.<span class="number">18</span>/</span><br><span class="line">[root@localhost libmemcached-<span class="number">1.0</span>.<span class="number">18</span>]$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/lib/</span>libmemcached</span><br><span class="line"><span class="comment">#–prefix 指定安装目录,该目录我们后面会用到</span></span><br></pre></td></tr></table></figure>

<p>编译、安装:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> libmemcached<span class="number">-1.0</span><span class="number">.18</span>]<span class="meta"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>2、为PHP安装 php-memcached 扩展:</p>
<p>首先解压 libmemcached-1.0.18.tar.gz配置:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> libmemcached<span class="number">-1.0</span><span class="number">.18</span>]<span class="meta"># cd ..</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># tar -zxvf memcached-2.2.0.tgz</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># cd cd memcached-2.2.0</span></span><br></pre></td></tr></table></figure>

<p>到了这一步,我们要使用安装php时生成的 phpize 来生成 configure 配置文件</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@localhost memcached-<span class="number">2.2</span>.<span class="number">0</span>]# <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/phpize (或 /u</span>sr<span class="regexp">/bin/</span>phpize) </span><br><span class="line">#具体用哪个要取决于你的phpize文件所在的目录,这时你应该用 whereis phpize 来查看路径,如果php是默认安装的话,直接使用phpize即可</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">[root@localhost memcached-<span class="number">2</span><span class="variable">.2</span><span class="variable">.0</span>]# ./configure -<span class="keyword">with</span>-php-<span class="keyword">config</span>=/usr/bin/php-<span class="keyword">config</span> --<span class="keyword">with</span>-libmemcached-dir=/usr/lib/libmemcached --<span class="keyword">disable</span>-memcached-sasl</span><br><span class="line">#-<span class="keyword">with</span>-php-<span class="keyword">config</span> 指定 php-<span class="keyword">config</span>,该文件与 phpize 所在目录相同.</span><br><span class="line">#–<span class="keyword">with</span>-libmemcached-dir 指定 libmemcached 安装目录,就刚才我们 –prefix 那个目录 ,–<span class="keyword">disable</span>-memcached-sasl 说明我们系统不支持sasl<span class="variable">.h</span>.</span><br></pre></td></tr></table></figure>

<p>编译、安装:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> memcached<span class="number">-2.2</span><span class="number">.0</span>]<span class="meta"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>如果安装成功,会提示:Installing shared extension:<code>/usr/local/php/lib/extensions/no-debug-non-zts-20160524/</code> 等类信息.</p>
<p>接下来,我们编辑php配置文件php.ini,你可以用 whereis php.ini 查看所在位置(我的在 <code>/etc/php.ini</code> ),把 php-memcached 扩展加到配置文件.<br>在 php.ini 中添加以下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">extension</span>=memcached.so</span><br></pre></td></tr></table></figure>

<p>步骤二:重启apache服务器,使配置生效.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> memcached<span class="number">-2.2</span><span class="number">.0</span>]<span class="meta"># systemctl restart httpd.service</span></span><br></pre></td></tr></table></figure>

<p>重启完之后,检查是否安装完成php-memcached扩展.</p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="xml">[root@localhost memcached-2.2.0]# echo &quot;</span><span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> phpinfo() <span class="meta">?&gt;</span></span><span class="xml">&quot;&gt;&gt;/home/www/index.php(这里web目录如果没改的话是在 /var/www/html/)</span></span><br></pre></td></tr></table></figure>

<p>在浏览器地址栏输入 127.0.0.1,查看php扩展,如果有memcache,则表示安装成功.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 安装helixserver 流媒体服务器</title>
    <url>/2014/11/26/1065/</url>
    <content><![CDATA[<p>1.网盘拷贝Helix server 将其解压放到/home/helix文件夹下.</p>
<p>2.修改文件权限:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">755</span> helix-server-retail-<span class="number">11</span>.<span class="number">01</span>-rhel<span class="number">4</span>-setup.bin</span><br></pre></td></tr></table></figure>

<p>3.开始安装:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">[root@localhost helix]<span class="comment"># ./helix-server-retail-11.01-rhel4-setup.bin</span></span><br><span class="line"><span class="keyword">Extracting </span>files for Helix <span class="keyword">installation……………………</span></span><br><span class="line"><span class="keyword"></span>You have selected the following Helix Server configuration:</span><br></pre></td></tr></table></figure>

<p>中间部分省略,就是配置用户名密码 路径 端口之类的,自己输入.<br>要cdkey的地方直接回车,出现许可直接按q退出.<br>最后出现:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Copying Helix Server <span class="built_in">files</span>….</span><br><span class="line">Helix Server installation is complete.</span><br><span class="line">If <span class="keyword">at</span> <span class="keyword">any</span> <span class="built_in">time</span> you should <span class="built_in">require</span> technical</span><br><span class="line">assistance, please visit our <span class="keyword">on</span><span class="title">-line</span> <span class="title">support</span> <span class="title">area</span></span><br><span class="line"><span class="keyword">at</span> <span class="keyword">http</span>://service.real.com/.</span><br><span class="line">Cleaning up installation <span class="built_in">files</span>…</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<p>表示安装完成.</p>
<p>4.破解过程 将许可证放到 <code>/home/helix/License</code>文件夹下.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> helix]<span class="meta"># cp DistributedLicensing.lic  /home/helix/License</span></span><br></pre></td></tr></table></figure>

<p>5.汉化过程 将汉化文件夹HelixAdministrator 覆盖 <code>/home/helix/HelixAdministrator</code></p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> helix]<span class="meta">#cp -R HelixAdministrator /home/helix/HelixAdministrator</span></span><br></pre></td></tr></table></figure>

<p>6.启动helix服务器</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># cd /home/helix/</span></span><br><span class="line">[root<span class="symbol">@localhost</span> helix]<span class="meta"># ./Bin/rmserver rmserver.cfg</span></span><br></pre></td></tr></table></figure>

<p>7.配置<br>此时你的流媒体已经可以正常运行了,在局域网内可以访问并且维护了,在浏览器中输入:192.168.79.131:11111/admin/index.html会出现管理界面,登录就可以管理了.<br>PS:视频文件在helixserver的Content目录,播放器访问地址为rtsp://服务器ip/视频文件.mp4.<br>自己的mp4文件不能直接播放,需要用mp4box 执行 MP4Box admin.mp4 -hint后就可以播放了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 安装ibus输入法</title>
    <url>/2011/10/02/1066/</url>
    <content><![CDATA[<p>其实命令非常简单:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ibus ibus-pinyin</span><br></pre></td></tr></table></figure>
<p>但是刚刚安装完成是没有办法使用的,要进入system - preferences - input method 里面选择ibus 然后关闭.<br>最好注销重新登录一下.就可以使用中文输入法了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 安装mp4box</title>
    <url>/2014/11/27/1067/</url>
    <content><![CDATA[<p>首先:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum -y install freeglut</span><br><span class="line">yum -y install freeglut-devel</span><br><span class="line">wget `&lt;a href=<span class="string">&quot;http://downloads.sourceforge.net/gpac/gpac-0.4.5.tar.gz&quot;</span>&gt;`http:<span class="regexp">//</span>downloads.sourceforge.net<span class="regexp">/gpac/g</span>pac-<span class="number">0.4</span>.<span class="number">5</span>.tar.gz`&lt;/a&gt;`</span><br><span class="line">wget `&lt;a href=<span class="string">&quot;http://downloads.sourceforge.net/gpac/gpac_extra_libs-0.4.5.tar.gz&quot;</span>&gt;`http:<span class="regexp">//</span>downloads.sourceforge.net<span class="regexp">/gpac/g</span>pac_extra_libs-<span class="number">0.4</span>.<span class="number">5</span>.tar.gz`&lt;/a&gt;`</span><br><span class="line">tar zxvf gpac-<span class="number">0.4</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">tar zxvf gpac_extra_libs-<span class="number">0.4</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">cd gpac</span><br><span class="line">cp -r ..<span class="regexp">/gpac_extra_libs/</span>* extra_lib/</span><br><span class="line">chmod +x configure</span><br><span class="line">./configure</span><br><span class="line">make lib</span><br><span class="line">make apps</span><br><span class="line">make install</span><br><span class="line">cp bin<span class="regexp">/gcc/</span>libgpac.so <span class="regexp">/usr/</span>lib</span><br></pre></td></tr></table></figure>
<p>再安装完MP4Box之后同样要执行一次ldconfig命令,然后执行MP4Box -version命令后可以看到如下内容:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MP4Box -version</span></span><br><span class="line"><span class="string">MP4Box</span> <span class="string">–</span> <span class="string">GPAC</span> <span class="string">version</span> <span class="number">0.4</span><span class="number">.5</span> <span class="string">(build</span> <span class="number">33</span><span class="string">)</span></span><br><span class="line"><span class="attr">GPAC Copyright:</span> <span class="string">(c)</span> <span class="string">Jean</span> <span class="string">Le</span> <span class="string">Feuvre</span> <span class="number">2000</span><span class="number">-2005</span></span><br><span class="line"><span class="string">(c)</span> <span class="string">ENST</span> <span class="number">2005</span><span class="string">-200X</span></span><br></pre></td></tr></table></figure>

<p>这样一来所有的工作就都做完了,剩下的就是按照自己的需要写ffmpeg的转码脚本了.</p>
<p>问题解决:</p>
<p>在安装MP4Box的时候可能会出现下面的问题:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/ld: skipping incompatible /u</span>sr<span class="regexp">/lib/</span>libGL.so when searching <span class="keyword">for</span> -lGL<span class="regexp">/usr/</span>bin<span class="regexp">/ld: cannot find -lGLcollect2: ld returned 1 exit statusmake[1]: *** [libgpac.so] Error 1make[1]: Leaving directory `/</span>root<span class="regexp">/gpac/</span>src<span class="string">&#x27;make: *** [lib] Error 2</span></span><br></pre></td></tr></table></figure>

<p>原因是mesa-libGL-devel这个包可能不完整,直接使用:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> mesa-libGL-devel</span><br></pre></td></tr></table></figure>

<p>命令把这个包安装一下,然后在make的时候就正常了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 安装pptp</title>
    <url>/2013/10/25/1068/</url>
    <content><![CDATA[<p>首先,我们必须要知道自己的VPS是否支持PPTP.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/dev/</span>ppp</span><br><span class="line">cat: <span class="regexp">/dev/</span>ppp: No such device or address</span><br><span class="line">cat <span class="regexp">/dev/</span>net/tun</span><br><span class="line">cat: <span class="regexp">/dev/</span>net/tun: <span class="keyword">File</span> descriptor in bad state</span><br></pre></td></tr></table></figure>

<p>我记得有一篇如果你的结果和我上面的两个结果不一样的话,那么你是肯定无法正常使用PPTP的哦.<br>不一样的话也好办,直接去tk VPS客服基本都会给开通的,我的VPN假架设在VPSYOU的openvz上,我联系客服10分钟后开通,赞一个先.<br>如果你的结果和我一样的话,那么就继续往下看吧.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install -y ppp</span><br><span class="line">yum install -y iptables</span><br><span class="line">rpm -ivh http:<span class="regexp">//</span>acelnmp.googlecode.com<span class="regexp">/files/</span>pptpd-<span class="number">1.3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel5.<span class="number">1</span>.i386.rpm(X86)</span><br><span class="line">rpm -ivh http:<span class="regexp">//</span>acelnmp.googlecode.com<span class="regexp">/files/</span>pptpd-<span class="number">1.3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel5.<span class="number">1</span>.x86_64.rpm(X64)</span><br><span class="line"><span class="comment"># 其他版本ppp 和 pptpd http://poptop.sourceforge.net/yum/stable/packages/</span></span><br><span class="line">vi <span class="regexp">/etc/</span>pptpd.conf</span><br><span class="line"><span class="comment"># localip 192.168.0.1 -&gt; localip 192.168.0.1</span></span><br><span class="line"><span class="comment"># remoteip 192.168.0.234-238,192.168.0.245 -&gt;remoteip 192.168.0.234-238,192.168.0.245</span></span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/options.pptpd</span><br><span class="line"><span class="comment"># ms-dns 192.168.0.1 -&gt; ms-dns 8.8.8.8</span></span><br><span class="line"><span class="comment"># ms-dns 192.168.0.2 -&gt; ms-dns 8.8.4.4</span></span><br><span class="line">require-mppe-<span class="number">128</span> -&gt; <span class="comment"># require-mppe-128</span></span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/chap-secrets</span><br><span class="line">用户名 pptpd 密码 *</span><br><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span> -&gt; net.ipv4.ip_forward = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span> -&gt; <span class="comment"># net.ipv4.tcp_syncookies = 1</span></span><br><span class="line">sysctl -p</span><br><span class="line">iptables -t nat -A POSTROUTING -s <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span> -j SNAT --to-source 你的VPS的IP</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables save</span><br><span class="line">chkconfig pptpd on</span><br><span class="line">chkconfig iptables on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/pptpd restart</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>现在你已经可以使用PPTP了,如果你连接的时候出现619错误的话.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -r <span class="regexp">/dev/</span>ppp</span><br><span class="line">mknod <span class="regexp">/dev/</span>ppp c <span class="number">108</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos 安装rsync实现数据同步</title>
    <url>/2011/11/19/1070/</url>
    <content><![CDATA[<p>1、保存下面的代码为一个文件,上传到服务器端,名称为rsync.sh</p>
<p>复制代码代码如下:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#rsync Written by zhumaohai</span><br><span class="line">#<span class="keyword">For</span> more information please visit http:<span class="comment">//www.centos.bz</span></span><br><span class="line">echo <span class="string">&quot;Please input the rsync username:&quot;</span></span><br><span class="line"><span class="keyword">read</span> username</span><br><span class="line">echo <span class="string">&quot;Please input the rsync username password:&quot;</span></span><br><span class="line"><span class="keyword">read</span> password</span><br><span class="line">echo <span class="string">&quot;Please input the server ip address:&quot;</span></span><br><span class="line"><span class="keyword">read</span> serverip</span><br><span class="line">echo <span class="string">&quot;Please input the allow ip address:&quot;</span></span><br><span class="line"><span class="keyword">read</span> allowip</span><br><span class="line">echo <span class="string">&quot;Please input the path you want to rsync:&quot;</span></span><br><span class="line"><span class="keyword">read</span> rsyncpath</span><br><span class="line">echo <span class="string">&quot;==========================input all completed========================&quot;</span></span><br><span class="line">echo <span class="string">&quot;==========================install rsync========================&quot;</span></span><br><span class="line">yum -y install rsync</span><br><span class="line">useradd $username</span><br><span class="line">mkdir <span class="regexp">/etc/</span>rsyncd</span><br><span class="line">cat &gt;<span class="regexp">/etc/</span>rsyncd/rsyncd.conf&lt;&lt;eof</span><br><span class="line"># Minimal configuration <span class="keyword">file</span> <span class="keyword">for</span> rsync daemon</span><br><span class="line"># See rsync(<span class="number">1</span>) and rsyncd.conf(<span class="number">5</span>) man pages <span class="keyword">for</span> help</span><br><span class="line"># <span class="keyword">This</span> line is required by the <span class="regexp">/etc/i</span>nit.d/rsyncd script</span><br><span class="line">pid <span class="keyword">file</span> = <span class="regexp">/var/</span>run/rsyncd.pid</span><br><span class="line">port = <span class="number">873</span></span><br><span class="line">address = $serverip</span><br><span class="line">#uid = nobody</span><br><span class="line">#gid = nobody</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use chroot = yes</span><br><span class="line"><span class="keyword">read</span> only = yes</span><br><span class="line"></span><br><span class="line">#limit access to <span class="keyword">private</span> LANs</span><br><span class="line">hosts allow=<span class="number">192.168</span>.<span class="number">1.0</span><span class="regexp">/255.255.255.0 10.0.1.0/</span><span class="number">255.255</span>.<span class="number">255.0</span> $allowip</span><br><span class="line">hosts deny=*</span><br><span class="line">max connections = <span class="number">5</span></span><br><span class="line">motd <span class="keyword">file</span> = <span class="regexp">/etc/</span>rsyncd/rsyncd.motd</span><br><span class="line">#<span class="keyword">This</span> will give you a separate log <span class="keyword">file</span></span><br><span class="line">#log <span class="keyword">file</span> = <span class="regexp">/var/</span>log/rsync.log</span><br><span class="line">#<span class="keyword">This</span> will log <span class="keyword">every</span> <span class="keyword">file</span> transferred - up to <span class="number">85</span>,<span class="number">000</span>+ per user, per sync</span><br><span class="line">#transfer logging = yes</span><br><span class="line">log format = %t %a %m %f %b</span><br><span class="line">syslog facility = local3</span><br><span class="line">timeout = <span class="number">300</span></span><br><span class="line">[$username home]</span><br><span class="line">path = $rsyncpath</span><br><span class="line">list=yes</span><br><span class="line">ignore errors</span><br><span class="line">auth users = $username</span><br><span class="line">secrets <span class="keyword">file</span> = <span class="regexp">/etc/</span>rsyncd/rsyncd.secrets</span><br><span class="line">eof</span><br><span class="line">echo <span class="string">&quot;$username:$password&quot;</span> &gt; <span class="regexp">/etc/</span>rsyncd/rsyncd.secrets</span><br><span class="line">chmod <span class="number">600</span> <span class="regexp">/etc/</span>rsyncd/rsyncd.secrets</span><br><span class="line">cat &gt;<span class="regexp">/etc/</span>rsyncd/rsyncd.motd&lt;&lt;eof</span><br><span class="line">+++++++++++++++++++++++++++</span><br><span class="line">+ centos.bz rsync <span class="number">2011</span>-<span class="number">2012</span> +</span><br><span class="line">+++++++++++++++++++++++++++</span><br><span class="line">eof</span><br><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/rsync --daemon --config=/</span>etc<span class="regexp">/rsyncd/</span>rsyncd.conf</span><br><span class="line">ps -aux | <span class="keyword">grep</span> rsync</span><br></pre></td></tr></table></figure>

<p>2、赋予脚本权限</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">chmod +<span class="keyword">x</span> rsync.sh</span><br></pre></td></tr></table></figure>

<p>3、执行脚本</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./rsync.sh</span></span><br></pre></td></tr></table></figure>

<p>4、客户端同样需要安装rsync</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@linux</span> docbook]<span class="variable">$ </span> rsync <span class="symbol">rsync:</span>/<span class="regexp">/www.9812.net/netkiller</span></span><br><span class="line">[root<span class="variable">@linux</span> tmp]<span class="variable">$ </span>rsync <span class="symbol">rsync:</span>/<span class="regexp">/netkiller@www.9812.net/netkiller</span></span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line">[chen<span class="variable">@linux</span> temp]<span class="variable">$ </span> rsync -vzrtopg --progress --delete postfix<span class="variable">@www</span>.<span class="number">9812</span>.net::postfix /tmp</span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line">rsync <span class="symbol">rsync:</span>/<span class="regexp">/认证用户@主机/</span>模块</span><br><span class="line">rsync -vzrtopg --progress --delete 认证用户@主机::模块 /mirror目录</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos 安装rar</title>
    <url>/2013/02/24/1069/</url>
    <content><![CDATA[<p>到<a href="http://www.rarsoft.com/download.htm%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84rarforlinux,%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85">http://www.rarsoft.com/download.htm下载最新的rarforlinux,然后进行安装</a>:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf rarlinux-x<span class="number">64</span>-<span class="number">4</span>.<span class="number">2</span>.b<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> rar</span><br><span class="line"><span class="attribute">make</span></span><br><span class="line"><span class="attribute">make</span> install</span><br></pre></td></tr></table></figure>

<p>centos就可以解压rar了.</p>
<p>再试试rar命令:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">[root@centos rar]<span class="symbol">$</span> rar</span><br><span class="line"></span><br><span class="line">RAR <span class="number">3.91</span>   Copyright (c) <span class="number">1993</span><span class="number">-2009</span> Alexander Roshal   <span class="number">12</span> Dec <span class="number">2009</span></span><br><span class="line">Shareware version         Type RAR -? <span class="keyword">for</span> help</span><br><span class="line"></span><br><span class="line">Usage:     rar &lt;command&gt; -&lt;switch <span class="number">1</span>&gt; -&lt;switch N&gt; &lt;archive&gt; &lt;<span class="keyword">files</span>...&gt;</span><br><span class="line">&lt;@listfiles...&gt; &lt;path_to_extract&gt;</span><br><span class="line"></span><br><span class="line">&lt;Commands&gt;</span><br><span class="line">a             Add <span class="keyword">files</span> to archive</span><br><span class="line">c             Add archive comment</span><br><span class="line">cf            Add <span class="keyword">files</span> comment</span><br><span class="line">ch            Change archive <span class="keyword">parameters</span></span><br><span class="line">cw            <span class="comment">Write archive comment to file</span></span><br><span class="line">d             <span class="comment">Delete files from archive</span></span><br><span class="line">e             <span class="comment">Extract files to current directory</span></span><br><span class="line">f             <span class="comment">Freshen files in archive</span></span><br><span class="line">i[par]=&lt;str&gt; Find <span class="comment">string in archives</span></span><br><span class="line">k             <span class="comment">Lock archive</span></span><br><span class="line">l[t,b]        List <span class="comment">archive [technical, bare]</span></span><br><span class="line">m[f]          Move <span class="comment">to archive [files only]</span></span><br><span class="line">p             <span class="comment">Print file to stdout</span></span><br><span class="line">r             <span class="comment">Repair archive</span></span><br><span class="line">rc            <span class="comment">Reconstruct missing volumes</span></span><br><span class="line">rn            <span class="comment">Rename archived files</span></span><br><span class="line">rr[N]         Add <span class="comment">data recovery record</span></span><br><span class="line">rv[N]         Create <span class="comment">recovery volumes</span></span><br><span class="line">s[name|-]     Convert <span class="comment">archive to or from SFX</span></span><br><span class="line">t             <span class="comment">Test archive files</span></span><br><span class="line">u             <span class="comment">Update files in archive</span></span><br><span class="line">v[t,b]        Verbosely <span class="comment">list archive [technical,bare]</span></span><br><span class="line">x             <span class="comment">Extract files with full path</span></span><br><span class="line"></span><br><span class="line">&lt;Switches&gt;</span><br><span class="line">-             Stop <span class="comment">switches scanning</span></span><br><span class="line">ad            <span class="comment">Append archive name to destination path</span></span><br><span class="line">ag[format]    Generate <span class="comment">archive name using the current date</span></span><br><span class="line">ai            <span class="comment">Ignore file attributes</span></span><br><span class="line">ap&lt;path&gt;      <span class="keyword">Set</span> <span class="comment">path inside archive</span></span><br><span class="line">as            <span class="comment">Synchronize archive contents</span></span><br><span class="line">av            <span class="comment">Put authenticity verification (registered versions only)</span></span><br><span class="line">av-           Disable <span class="comment">authenticity verification check</span></span><br><span class="line">c-            Disable <span class="comment">comments show</span></span><br><span class="line">cfg-          Disable <span class="comment">read configuration</span></span><br><span class="line">cl            <span class="comment">Convert names to lower case</span></span><br><span class="line">cu            <span class="comment">Convert names to upper case</span></span><br><span class="line">df            <span class="comment">Delete files after archiving</span></span><br><span class="line">dh            <span class="comment">Open shared files</span></span><br><span class="line">ds            <span class="comment">Disable name sort for solid archive</span></span><br><span class="line">dw            <span class="comment">Wipe files after archiving</span></span><br><span class="line">e[+]&lt;attr&gt;    <span class="keyword">Set</span> <span class="comment">file exclude and include attributes</span></span><br><span class="line">ed            <span class="comment">Do not add empty directories</span></span><br><span class="line">en            <span class="comment">Do not put</span> <span class="comment">&#x27;end of archive&#x27;</span> <span class="comment">block</span></span><br><span class="line">ep            <span class="comment">Exclude paths from names</span></span><br><span class="line">ep1           <span class="comment">Exclude base directory from names</span></span><br><span class="line">ep3           <span class="comment">Expand paths to full including the drive letter</span></span><br><span class="line">f             <span class="comment">Freshen files</span></span><br><span class="line">hp[password] Encrypt <span class="comment">both file data and headers</span></span><br><span class="line">id[c,d,p,q]   Disable <span class="comment">messages</span></span><br><span class="line">ierr          <span class="comment">Send all messages to stderr</span></span><br><span class="line">ilog[name]    Log <span class="comment">errors to file (registered versions only)</span></span><br><span class="line">inul          <span class="comment">Disable all messages</span></span><br><span class="line">isnd          <span class="comment">Enable sound</span></span><br><span class="line">k             <span class="comment">Lock archive</span></span><br><span class="line">kb            <span class="comment">Keep broken extracted files</span></span><br><span class="line">m&lt;0..5&gt;       <span class="keyword">Set</span> <span class="comment">compression level (0-store...3-default...5-maximal)</span></span><br><span class="line">mc&lt;par&gt;       <span class="keyword">Set</span> <span class="comment">advanced compression parameters</span></span><br><span class="line">md&lt;size&gt;      Dictionary <span class="comment">size in KB (64,128,256,512,1024,2048,4096 or A-G)</span></span><br><span class="line">ms[ext;ext]   Specify <span class="keyword">file</span> types to store</span><br><span class="line">n&lt;<span class="keyword">file</span>&gt;       Include only specified <span class="keyword">file</span></span><br><span class="line">n@            Read <span class="keyword">file</span> names to include from stdin</span><br><span class="line">n@&lt;list&gt;      Include <span class="keyword">files</span> listed in specified list <span class="keyword">file</span></span><br><span class="line">o[+|-]        <span class="keyword">Set</span> the <span class="comment">overwrite mode</span></span><br><span class="line">ol            <span class="comment">Save symbolic links as the link instead of the file</span></span><br><span class="line">or            <span class="comment">Rename files automatically</span></span><br><span class="line">ow            <span class="comment">Save or restore file owner and group</span></span><br><span class="line">p[password]   <span class="keyword">Set</span> <span class="comment">password</span></span><br><span class="line">p-            Do <span class="comment">not query password</span></span><br><span class="line">r             <span class="comment">Recurse subdirectories</span></span><br><span class="line">r-            Disable <span class="comment">recursion</span></span><br><span class="line">r0            <span class="comment">Recurse subdirectories for wildcard names only</span></span><br><span class="line">rr[N]         Add <span class="comment">data recovery record</span></span><br><span class="line">rv[N]         Create <span class="comment">recovery volumes</span></span><br><span class="line">s[&lt;N&gt;,v[-],e] Create <span class="comment">solid archive</span></span><br><span class="line">s-            Disable <span class="comment">solid archiving</span></span><br><span class="line">sc&lt;chr&gt;[obj] Specify <span class="comment">the character set</span></span><br><span class="line">sfx[name]     Create <span class="comment">SFX archive</span></span><br><span class="line">si[name]      Read <span class="comment">data from standard input (stdin)</span></span><br><span class="line">sl&lt;size&gt;      Process <span class="comment">files with size less than specified</span></span><br><span class="line">sm&lt;size&gt;      Process <span class="comment">files with size more than specified</span></span><br><span class="line">t             <span class="comment">Test files after archiving</span></span><br><span class="line">ta&lt;date&gt;      Process <span class="comment">files modified after &lt;date&gt; in YYYYMMDDHHMMSS format</span></span><br><span class="line">tb&lt;date&gt;      Process <span class="comment">files modified before &lt;date&gt; in YYYYMMDDHHMMSS format</span></span><br><span class="line">tk            <span class="comment">Keep original archive time</span></span><br><span class="line">tl            <span class="comment">Set archive time to latest file</span></span><br><span class="line">tn&lt;time&gt;      Process <span class="comment">files newer than &lt;time&gt;</span></span><br><span class="line">to&lt;time&gt;      Process <span class="comment">files older than &lt;time&gt;</span></span><br><span class="line">ts&lt;m,c,a&gt;[N] Save <span class="comment">or restore file time (modification, creation, access)</span></span><br><span class="line">u             <span class="comment">Update files</span></span><br><span class="line">v             <span class="comment">Create volumes with size autodetection or list all volumes</span></span><br><span class="line">v&lt;size&gt;[k,b] Create <span class="comment">volumes with size=&lt;size&gt;*1000 [*1024, *1]</span></span><br><span class="line">ver[n]        File <span class="comment">version control</span></span><br><span class="line">vn            <span class="comment">Use the old style volume naming scheme</span></span><br><span class="line">vp            <span class="comment">Pause before each volume</span></span><br><span class="line">w&lt;path&gt;       Assign <span class="comment">work directory</span></span><br><span class="line">x&lt;file&gt;       Exclude <span class="comment">specified file</span></span><br><span class="line">x@            Read <span class="comment">file names to exclude from stdin</span></span><br><span class="line">x@&lt;list&gt;      Exclude <span class="comment">files listed in specified list file</span></span><br><span class="line">y             <span class="comment">Assume Yes on all queries</span></span><br><span class="line">z[file]       Read <span class="comment">archive comment from file</span></span><br></pre></td></tr></table></figure>

<p>好了 rarforlinux安装结束!</p>
]]></content>
  </entry>
  <entry>
    <title>centos 僵尸进程解决办法</title>
    <url>/2014/09/06/1073/</url>
    <content><![CDATA[<p>最近工作过程中,发现好几台服务器出现僵死进程.<br>使用命令找出僵死进程:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">ps -A -o <span class="keyword">stat</span>,ppid,pid,cmd | <span class="keyword">grep</span> -e <span class="string">&#x27;^[Zz]&#x27;</span></span><br></pre></td></tr></table></figure>

<p>命令注解:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="literal">-A</span> 参数列出所有进程</span><br><span class="line"><span class="literal">-o</span> 自定义输出字段 我们设定显示字段为 stat(状态),?ppid(进程父id), pid(进程id),cmd(命令)这四个参数</span><br><span class="line"></span><br><span class="line"><span class="literal">-C</span> 用来指定所执行的命令名称,你这里也就是让<span class="built_in">ps</span>仅仅显示php命令所产生的进程的信息</span><br><span class="line"><span class="built_in">ps</span> <span class="literal">-C</span> java <span class="literal">-o</span> lstart,pid,cmd <span class="comment">#不过貌似打印的不全</span></span><br><span class="line"><span class="built_in">ps</span> <span class="literal">-A</span> <span class="literal">-o</span> lstart,pid,args |grep java <span class="comment">#这个可以的</span></span><br></pre></td></tr></table></figure>

<p>因为状态为 z或者Z 的进程为僵尸进程,所以我们使用grep抓取stat状态为zZ进程.<br>这里一共出现了9个僵死进程,需要把它们都干掉,执行命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kill</span> -<span class="number">9</span> <span class="number">8310</span></span><br></pre></td></tr></table></figure>

<p>这时再执行查找僵死的进程,发现所有僵死进程都没了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 搭建 pptpd服务器</title>
    <url>/2016/02/19/1072/</url>
    <content><![CDATA[<p>VPN的英文全称是”Virtual Private Network”,翻译过来就是”虚拟专用网络”.顾名思义,虚拟专用网络我们可以把它理解成是虚拟出来的企业内部专线.它可以通过特殊的加密的通讯协议在连接在Internet上的位于不同地方的两个或多个企业内部网之间建立一条专有的通讯线路,就好比是架设了一条专线一样,但是它并不需要真正的去铺设光缆之类的物理线路.这就好比去电信局申请专线,但是不用给铺设线路的费用,也不用购买路由器等硬件设备.VPN技术原是路由器具有的重要技术之一,目前在交换机,防火墙设备或Windows 2000等软件里也都支持VPN功能,一句话,VPN的核心就是在利用公共网络建立虚拟私有网.虚拟专用网(VPN)被定义为通过一个公用网络(通常是因特网)建立一个临时的、安全的连接,是一条穿过混乱的公用网络的安全、稳定的隧道.虚拟专用网是对企业内部网的扩展.虚拟专用网可以帮助远程用户、公司分支机构、商业伙伴及供应商同公司的内部网建立可信的安全连接,并保证数据的安全传输.虚拟专用网可用于不断增长的移动用户的全球因特网接入,以实现安全连接;可用于实现企业网站之间安全通信的虚拟专用线路,用于经济有效地连接到商业伙伴和用户的安全外联网虚拟专用网.</p>
<p>PPTP 全称为 Point to Point Tunneling Protocol — 点到点隧道协议,是VPN协议中的一种.</p>
<p>安装相关软件</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install -y ppp iptables</span><br><span class="line"><span class="attribute">wget</span> http://poptop.sourceforge.net/yum/stable/packages/pptpd-<span class="number">1</span>.<span class="number">3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel<span class="number">5</span>.<span class="number">1</span>.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh pptpd-<span class="number">1</span>.<span class="number">3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel<span class="number">5</span>.<span class="number">1</span>.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>

<p>配置文件/etc/ppp/options.pptpd</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mv <span class="regexp">/etc/</span>ppp<span class="regexp">/options.pptpd /</span>etc<span class="regexp">/ppp/</span><span class="keyword">options</span>.pptpd.bak</span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/<span class="keyword">options</span>.pptpd</span><br></pre></td></tr></table></figure>

<p>输入以下内容:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#相当于身份验证时的域,一定要和/etc/ppp/chap-secrets中的内容对应</span></span><br><span class="line">name pptpd</span><br><span class="line"><span class="meta">#传输加密.ppp-2.4.2以上的版本只支持MPPE加密,内核模块为 ppp_mppe.o</span></span><br><span class="line"><span class="meta">#拒绝pap,chap身份验证</span></span><br><span class="line">refuse-pap</span><br><span class="line">refuse-chap</span><br><span class="line"><span class="meta">#拒绝mschap身份验证</span></span><br><span class="line">&lt;span id=<span class="string">&quot;more-510&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">refuse-mschap</span><br><span class="line"><span class="meta">#采用mschap-v2(Microsoft Challenge Handshake Authentication Protocol, Version 2)身份验证方式</span></span><br><span class="line">require-mschap-v2</span><br><span class="line"><span class="meta">#在采用mschap-v2身份验证方式时要使用MPPE进行加密</span></span><br><span class="line">require-mppe<span class="number">-128</span></span><br><span class="line"><span class="meta">#启动ARP代理</span></span><br><span class="line">proxyarp</span><br><span class="line">lock</span><br><span class="line">nobsdcomp</span><br><span class="line">novj</span><br><span class="line">novjccomp</span><br><span class="line">nologfd</span><br><span class="line"><span class="meta">#分配给客户的DNS,这里用的是opendns</span></span><br><span class="line">ms-dns <span class="number">208.67</span><span class="number">.222</span><span class="number">.222</span></span><br><span class="line">ms-dns <span class="number">208.67</span><span class="number">.220</span><span class="number">.220</span></span><br></pre></td></tr></table></figure>

<p>配置文件/etc/ppp/chap-secrets</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mv <span class="regexp">/etc/</span>ppp<span class="regexp">/chap-secrets /</span>etc<span class="regexp">/ppp/</span>chap-secrets.bak</span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/chap-secrets</span><br></pre></td></tr></table></figure>

<p>输入以下内容</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># Secrets for authentication using CHAP</span></span><br><span class="line"><span class="meta"># client        server  secret                  IP addresses</span></span><br><span class="line">vi                pptpd  viyin.net                   *</span><br></pre></td></tr></table></figure>

<p>用户名vi,密码viyin.net ,*表示任意ip<br>pptpd要和/etc/ppp/options.pptpd中的name 部分的pptpd匹配</p>
<p>配置文件/etc/pptpd.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mv <span class="regexp">/etc/</span>pptpd.conf <span class="regexp">/etc/</span>pptpd.conf.bak</span><br><span class="line">vi <span class="regexp">/etc/</span>pptpd.conf</span><br></pre></td></tr></table></figure>

<p>输入以下内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">option</span> /etc/ppp/options.pptpd</span><br><span class="line"><span class="attribute">logwtmp</span></span><br><span class="line"><span class="attribute">localip</span> <span class="number">10.100.1.1</span></span><br><span class="line"><span class="attribute">remoteip</span> <span class="number">10.100.1.20</span>-<span class="number">50</span></span><br></pre></td></tr></table></figure>

<p>为拨入VPN的用户动态分配IP</p>
<p>打开防火墙端口<br>1723端口和47端口打开,打开GRE协议</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">1723</span> -j ACCEPT</span><br><span class="line">/sbin/iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">47</span> -j ACCEPT</span><br><span class="line">/sbin/iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> gre -j ACCEPT</span><br><span class="line">/sbin/iptables  -<span class="selector-tag">A</span> POSTROUTING -t nat -s <span class="number">10.100</span>.<span class="number">1.0</span>/<span class="number">24</span> -o seth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>

<p>配置文件/etc/sysctl.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>修改以下内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_forward = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>开启NAT转发功能<br>保存、退出后执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/sbin/</span>sysctl -p</span><br></pre></td></tr></table></figure>

<p>启动PPTP VPN 服务器端:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/sbin/</span>service pptpd start</span><br></pre></td></tr></table></figure>

<p>检查PPP是否支持MPPE,用以下命令检查PPP是否支持MPPE:
　　</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">strings &#x27;/usr/sbin/pppd&#x27; <span class="string">|grep -i mppe | wc –lines</span></span><br></pre></td></tr></table></figure>

<p>果以上命令输出为”0”则表示不支持;输出为”30”或更大的数字就表示支持.<br>注意:<br>如果一直提示619或者800错误,查看日志.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 被入侵后的检查</title>
    <url>/2012/05/23/1071/</url>
    <content><![CDATA[<p>检查用户登录记录:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">more</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/secure</span><br><span class="line">who /<span class="keyword">var</span>/<span class="keyword">log</span>/wtmp</span><br></pre></td></tr></table></figure>

<p>root账户下输入:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su - username</span></span><br></pre></td></tr></table></figure>

<p>切换到username下输入:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">history</span></span><br></pre></td></tr></table></figure>

<p>能看到这个用户历史命令,默认最近的1000条.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos 禁用fastestMirror的方法</title>
    <url>/2016/12/30/1074/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/etc/yum</span><span class="regexp">/pluginconf.d/</span>fastestmirror.conf</span><br></pre></td></tr></table></figure>

<p>把enable 改为0.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 命令行pptpd vpn拨号</title>
    <url>/2015/04/28/1075/</url>
    <content><![CDATA[<p>软件:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ppp</span>-<span class="number">2</span>.<span class="number">4</span>.<span class="number">4</span>-<span class="number">2</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm(http://rpmfind.net)</span><br><span class="line"><span class="attribute">libpcap</span>-<span class="number">0</span>.<span class="number">9</span>.<span class="number">4</span>-<span class="number">14</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm (http://rpmfind.net)</span><br><span class="line"><span class="attribute">pptp</span>-<span class="number">1</span>.<span class="number">7</span>.<span class="number">2</span>-<span class="number">3</span>.rhel<span class="number">5</span>.i<span class="number">386</span>.rpm (http://pptpclient.sourceforge.net/)</span><br></pre></td></tr></table></figure>

<p>噢,忘记说了,我的服务器OS是centos5.2</p>
<p>安装:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh libpcap-<span class="number">0</span>.<span class="number">9</span>.<span class="number">4</span>-<span class="number">14</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh ppp-<span class="number">2</span>.<span class="number">4</span>.<span class="number">4</span>-<span class="number">2</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh pptp-<span class="number">1</span>.<span class="number">7</span>.<span class="number">2</span>-<span class="number">3</span>.rhel<span class="number">5</span>.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>

<p>运行:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">pptpsetup</span> --<span class="comment">create</span> <span class="comment">vpn</span> --<span class="comment">server</span> <span class="comment">pptpserver</span> --<span class="comment">username</span> <span class="comment">test</span> --<span class="comment">password</span> <span class="comment">test</span> --<span class="comment">encrypt</span> --<span class="comment">start</span></span><br></pre></td></tr></table></figure>

<p>OK,ppp0出来了….</p>
<p>再添加默认路由</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">route</span> add -net <span class="number">0.0.0.0</span> dev ppp<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>好了,linux命令行下的pptp客户端就到此为止,后期有变动,本文还会在第一时间调整,也希望朋友多试,多给意见!~</p>
]]></content>
  </entry>
  <entry>
    <title>centos 使用nfs同步文件</title>
    <url>/2014/06/26/1076/</url>
    <content><![CDATA[<p>今天我们来学习一下NFS的文件同步系统,首先介绍一下NFS:NFS是Network File System的简写,<br>即网络文件系统.网络文件系统是FreeBSD支持的文件系统中的一种,也被称为NFS.<br>NFS允许一个系统在网络上与他人共享目录和文件.通过使用NFS,<br>用户和程序可以像访问本地文件一样访问远端系统上的文件.</p>
<p>安装NFS:</p>
<p>服务端和客户端都需要安装.<br>只需要一条命令即可安装好nfs:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install nfs-utils nfs<span class="number">4</span>-acl-tools portmap</span><br></pre></td></tr></table></figure>

<p>配置NFS服务端:</p>
<p>nfs的主配置文件是/etc/exports,这里是配置NFS服务器开放的目录以及客户端访问的权限等.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>exports</span><br></pre></td></tr></table></figure>

<p>加入:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">/nfsdata <span class="number">192.168</span><span class="number">.1</span><span class="number">.103</span>(rw,root_squash,no_all_squash,<span class="keyword">sync</span>)</span><br></pre></td></tr></table></figure>

<p>保存设置.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">exportfs -r</span></span><br></pre></td></tr></table></figure>

<p>配置解释:</p>
<p>#配置文件每行分为段:<br>#第一段为共享的目录,使用绝对路径<br>#第二段为客户端地址及权限:<br>地址可以使用完整IP或网段,例如192.168.1.103或10.0.0.0/24,10.0.0.0/255.255.255.0当然也可以<br>地址可以使用主机名,DNS解析的和本地/etc/hosts解析的都行,支持通配符.<br>权限有:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">rw:</span>read-write,可读写<span class="comment">;</span></span><br><span class="line"><span class="symbol">ro:</span>read-only,只读<span class="comment">;</span></span><br><span class="line"><span class="symbol">sync:</span>文件同时写入硬盘和内存<span class="comment">;</span></span><br><span class="line"><span class="symbol">async:</span>文件暂存于内存,而不是直接写入内存<span class="comment">;</span></span><br><span class="line"><span class="symbol">no_root_squash:</span>NFS客户端连接服务端时如果使用的是root的话,那么对服务端分享的目录来说,也拥有root权限.显然开启这项是不安全的.</span><br><span class="line"><span class="symbol">root_squash:</span>NFS客户端连接服务端时如果使用的是root的话,那么对服务端分享的目录来说,拥有匿名用户权限,通常他将使用nobody或nfsnobody身份<span class="comment">;</span></span><br><span class="line"><span class="symbol">all_squash:</span>不论NFS客户端连接服务端时使用什么用户,对服务端分享的目录来说都是拥有匿名用户权限<span class="comment">;</span></span><br><span class="line"><span class="symbol">anonuid:</span>匿名用户的UID值,通常是nobody或nfsnobody,可以在此处自行设定<span class="comment">;</span></span><br><span class="line"><span class="symbol">anongid:</span>匿名用户的GID值.</span><br></pre></td></tr></table></figure>

<p>配置允许指定客户端连接NFS服务器:</p>
<p>注意 NFS 使用 portmap,而且新版本的 portmap 使用 hosts.deny 和 hosts.allow 文件来控制访问源,修改这2个配置文件以便 NFS 客户端能正常连接到服务器:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi /etc/hosts.deny</span></span><br><span class="line"><span class="attribute">portmap</span>:<span class="literal">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vi /etc/hosts.allow</span></span><br><span class="line"><span class="attribute">portmap</span>:<span class="number">192.168.1.103</span></span><br></pre></td></tr></table></figure>

<p>NFS服务端启动与测试:</p>
<p>先启动所依赖的postmap:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service portmap <span class="literal">start</span></span><br><span class="line">service nfs <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>显示已共享的目录信息:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">showmount -e</span></span><br></pre></td></tr></table></figure>

<p>现在建立需要共享的文件目录:</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /nfsdata</span><br><span class="line">NFS客户端连接测试</span><br><span class="line">service portmap <span class="built_in">start</span></span><br><span class="line">service nfs <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p>显示可挂载的目录:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">showmount</span> -e <span class="number">192.168.1.101</span></span><br></pre></td></tr></table></figure>

<p>挂载网络目录 <code>/nfsdata</code>到 <code>/root/nfsdata</code>(确保存在):</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">mount -t nfs <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>:<span class="regexp">/nfsdata /</span>root/nfsdata</span><br></pre></td></tr></table></figure>

<p>检查是否已经挂载好:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mount</span></span><br></pre></td></tr></table></figure>

<p>如果需要开机挂载的话别忘了在/etc/fstab中加入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/root/</span>nfsdata <span class="number">192.168</span>.<span class="number">1.101</span>:/nfsdata</span><br></pre></td></tr></table></figure>

<p>好这样一个基于nfs的文件共享系统就搭建完成了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 系统服务精简 (只适合web服务器)</title>
    <url>/2014/06/30/1078/</url>
    <content><![CDATA[<p>开机启动程序:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">crond</span>???????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">iptables</span>????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">lm_sensors</span>??? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">off</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">messagebus</span>??? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">off</span>   <span class="number">3</span>:<span class="literal">off</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">mysql</span>???????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">network</span>?????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">rawdevices</span>??? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">off</span>   <span class="number">3</span>:<span class="literal">off</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">sshd</span>????????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br><span class="line"><span class="attribute">syslog</span>??????? ???  <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">on</span>   <span class="number">3</span>:<span class="literal">on</span>   <span class="number">4</span>:<span class="literal">on</span>   <span class="number">5</span>:<span class="literal">on</span>   <span class="number">6</span>:<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>pstree结果:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">init─┬─crond</span><br><span class="line">├─mysqld_safe───mysqld───&#123;mysqld&#125;</span><br><span class="line">├─nginx───<span class="number">2</span>*<span class="selector-attr">[nginx]</span></span><br><span class="line">├─php-cgi───<span class="number">5</span>*<span class="selector-attr">[php-cgi]</span></span><br><span class="line">├─sshd───sshd───bash───pstree</span><br><span class="line">├─syslogd</span><br><span class="line">└─udevd</span><br></pre></td></tr></table></figure>

<p>udevd不知到哪里关闭,是支持即插即用的,也可以关闭.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 修改history记录数量</title>
    <url>/2017/10/13/1079/</url>
    <content><![CDATA[<p>默认情况下,Bash shell 会在文件<code>$HOME/.bash_history</code>中存在1000条命令记录,很不安全.<br>可以编辑<code>/etc/profile</code>文件,修改其中HISTSIZE值大小即可.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">HISTSIZE</span>=<span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>这样就可以了,或者直接设置成0得了,也就不存在历史命令了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 主从数据库</title>
    <url>/2018/05/12/1080/</url>
    <content><![CDATA[<p>环境:</p>
<p>主服务器:centos 5.2 mysql 5.1.35 源码 IP:192.168.1.22<br>从服务器:centos 5.2 mysql 5.1.35 源码 IP:192.168.1.33</p>
<p>配置:</p>
<p>一、主服务器</p>
<p>1.1、创建一个复制用户,具有replication slave权限</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">replication</span> slave <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;192.168.1.22&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;repl&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>1.2、编辑my.cnf文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>添加:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server-id</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>并开启log-bin二进制日志文件:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log-bin</span>=mysql-bin</span><br></pre></td></tr></table></figure>

<p>注:需要把默认的server-id=1去掉.</p>
<p>1.3、启动mysql数据库</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysqld_safe <span class="attribute">--user</span>=mysql &amp;</span><br></pre></td></tr></table></figure>

<p>1.4、设置读锁</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;flush <span class="keyword">tables</span> <span class="keyword">with</span> <span class="keyword">read</span> <span class="keyword">lock</span>;</span><br></pre></td></tr></table></figure>

<p>1.5、得到binlog日志文件名和偏移量</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt;show master status;</span><br><span class="line"></span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>------------------+</span><br><span class="line"><span class="section">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="section">| mysql-bin.0000010 | 106| | |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br></pre></td></tr></table></figure>

<p>1.6、备份要同步的数据库</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="keyword">test</span> &gt; <span class="keyword">test</span>.sql</span><br></pre></td></tr></table></figure>

<p>1.7、解锁</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt;unlock tables<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>二、从服务器</p>
<p>2.1、编辑my.cnf文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>添加:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server-id</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>注:需要把默认的server-id=1去掉.</p>
<p>2.2、启动从数据库</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysqld_safe <span class="attribute">--user</span>=mysql &amp;</span><br></pre></td></tr></table></figure>

<p>2.3、对从数据库进行相应设置</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">change master to master_host</span>=<span class="string">&#x27;173.252.192.205&#x27;</span>,master_user=<span class="string">&#x27;root&#x27;</span>,master_password=<span class="string">&#x27;Fuck_24_25&#x27;</span>,master_log_file=<span class="string">&#x27;mysql-bin.000029&#x27;</span>,master_log_pos=257;</span><br></pre></td></tr></table></figure>

<p>2.4、启动从服务器slave线程</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="literal">start</span> <span class="literal">slave</span>;</span><br></pre></td></tr></table></figure>

<p>执行show processlist命令显示以下进程:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">mysql&gt;show processlistG</span><br><span class="line"></span><br><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 2. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Id: 2</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">User: system user</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Host:</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">db: NULL</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Command: Connect</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Time: 2579</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">State: Has read all relay log; waiting for the slave I/O thread to update it</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Info: NULL</span></span></span></span></span><br></pre></td></tr></table></figure>

<p>表示slave已经连接上master,开始接受并执行日志.</p>
<p>2.5、查看slave线程状态</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mysql&gt;show</span> <span class="string">slave</span> <span class="string">status;</span></span><br><span class="line"></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line"><span class="attr">Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line"><span class="attr">Master_Host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.22</span></span><br><span class="line"><span class="attr">Master_User:</span> <span class="string">repl</span></span><br><span class="line"><span class="attr">Master_Port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">Connect_Retry:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">Master_Log_File:</span> <span class="string">mysql-bin.0000010</span></span><br><span class="line"><span class="attr">Read_Master_Log_Pos:</span> <span class="number">106</span></span><br><span class="line"><span class="attr">Relay_Log_File:</span> <span class="string">centos-relay-bin.000002</span></span><br><span class="line"><span class="attr">Relay_Log_Pos:</span> <span class="number">529</span></span><br><span class="line"><span class="attr">Relay_Master_Log_File:</span> <span class="string">mysql-bin.0000010</span></span><br><span class="line"><span class="attr">Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Slave_SQL_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Replicate_Do_DB:</span></span><br><span class="line"><span class="attr">Replicate_Ignore_DB:</span></span><br><span class="line"><span class="attr">Replicate_Do_Table:</span></span><br><span class="line"><span class="attr">Replicate_Ignore_Table:</span></span><br><span class="line"><span class="attr">Replicate_Wild_Do_Table:</span></span><br><span class="line"><span class="attr">Replicate_Wild_Ignore_Table:</span></span><br><span class="line"><span class="attr">Last_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_Error:</span></span><br><span class="line"><span class="attr">Skip_Counter:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Exec_Master_Log_Pos:</span> <span class="number">106</span></span><br><span class="line"><span class="attr">Relay_Log_Space:</span> <span class="number">830</span></span><br><span class="line"><span class="attr">Until_Condition:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">Until_Log_File:</span></span><br><span class="line"><span class="attr">Until_Log_Pos:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Master_SSL_Allowed:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Master_SSL_CA_File:</span></span><br><span class="line"><span class="attr">Master_SSL_CA_Path:</span></span><br><span class="line"><span class="attr">Master_SSL_Cert:</span></span><br><span class="line"><span class="attr">Master_SSL_Cipher:</span></span><br><span class="line"><span class="attr">Master_SSL_Key:</span></span><br><span class="line"><span class="attr">Seconds_Behind_Master:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Master_SSL_Verify_Server_Cert:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Last_IO_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_IO_Error:</span></span><br><span class="line"><span class="attr">Last_SQL_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_SQL_Error:</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure>

<p>验证是否配置正确.<br>在从服务器上执行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">show <span class="literal">slave</span> statusG;</span><br><span class="line"></span><br><span class="line">Waiting for <span class="keyword">master</span> <span class="title">to</span> send event</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<p>如以上二行同时为Yes 说明配置成功.</p>
<p>测试:</p>
<p>1、在主服务器test数据库中创建user表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>use test;</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(id <span class="type">int</span>);</span><br></pre></td></tr></table></figure>

<p>2、在从服务器中查看user表</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt;use test;</span><br><span class="line">mysql&gt; show tables like <span class="emphasis">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="code">+----------------------+</span></span><br><span class="line"><span class="section">| Tables_in_test(user) |</span></span><br><span class="line"><span class="section">+----------------------+</span></span><br><span class="line"><span class="section">| user |</span></span><br><span class="line"><span class="section">+----------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>说明主从数据同步成功.</p>
<p>如果需要多个从数据库的话,可以一直重复从数据库 的操作,但是my.cnf里面的server-id必须不能相同,使用不同的数字就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS 最新版使用Jailkit建立apache 的chroot环境</title>
    <url>/2018/09/19/1081/</url>
    <content><![CDATA[<p>环境:</p>
<p>主服务器:centos 5.2 mysql 5.1.35 源码 IP:192.168.1.22<br>从服务器:centos 5.2 mysql 5.1.35 源码 IP:192.168.1.33</p>
<p>配置:</p>
<p>一、主服务器</p>
<p>1.1、创建一个复制用户,具有replication slave权限</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">replication</span> slave <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;192.168.1.22&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;repl&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>1.2、编辑my.cnf文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>添加:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server-id</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>并开启log-bin二进制日志文件:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log-bin</span>=mysql-bin</span><br></pre></td></tr></table></figure>

<p>注:需要把默认的server-id=1去掉.</p>
<p>1.3、启动mysql数据库</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysqld_safe <span class="attribute">--user</span>=mysql &amp;</span><br></pre></td></tr></table></figure>

<p>1.4、设置读锁</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;flush <span class="keyword">tables</span> <span class="keyword">with</span> <span class="keyword">read</span> <span class="keyword">lock</span>;</span><br></pre></td></tr></table></figure>

<p>1.5、得到binlog日志文件名和偏移量</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt;show master status;</span><br><span class="line"></span><br><span class="line"><span class="code">+------------------+</span>----------<span class="code">+--------------+</span>------------------+</span><br><span class="line"><span class="section">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="section">| mysql-bin.0000010 | 106| | |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br></pre></td></tr></table></figure>

<p>1.6、备份要同步的数据库</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="keyword">test</span> &gt; <span class="keyword">test</span>.sql</span><br></pre></td></tr></table></figure>

<p>1.7、解锁</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt;unlock tables<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>二、从服务器</p>
<p>2.1、编辑my.cnf文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>添加:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server-id</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>注:需要把默认的server-id=1去掉.</p>
<p>2.2、启动从数据库</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysqld_safe <span class="attribute">--user</span>=mysql &amp;</span><br></pre></td></tr></table></figure>

<p>2.3、对从数据库进行相应设置</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">change master to master_host</span>=<span class="string">&#x27;173.252.192.205&#x27;</span>,master_user=<span class="string">&#x27;root&#x27;</span>,master_password=<span class="string">&#x27;Fuck_24_25&#x27;</span>,master_log_file=<span class="string">&#x27;mysql-bin.000029&#x27;</span>,master_log_pos=257;</span><br></pre></td></tr></table></figure>

<p>2.4、启动从服务器slave线程</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="literal">start</span> <span class="literal">slave</span>;</span><br></pre></td></tr></table></figure>

<p>执行show processlist命令显示以下进程:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">mysql&gt;show processlistG</span><br><span class="line"></span><br><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 2. row <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Id: 2</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">User: system user</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Host:</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">db: NULL</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Command: Connect</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Time: 2579</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">State: Has read all relay log; waiting for the slave I/O thread to update it</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">Info: NULL</span></span></span></span></span><br></pre></td></tr></table></figure>

<p>表示slave已经连接上master,开始接受并执行日志.</p>
<p>2.5、查看slave线程状态</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mysql&gt;show</span> <span class="string">slave</span> <span class="string">status;</span></span><br><span class="line"></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line"><span class="attr">Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line"><span class="attr">Master_Host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.22</span></span><br><span class="line"><span class="attr">Master_User:</span> <span class="string">repl</span></span><br><span class="line"><span class="attr">Master_Port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">Connect_Retry:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">Master_Log_File:</span> <span class="string">mysql-bin.0000010</span></span><br><span class="line"><span class="attr">Read_Master_Log_Pos:</span> <span class="number">106</span></span><br><span class="line"><span class="attr">Relay_Log_File:</span> <span class="string">centos-relay-bin.000002</span></span><br><span class="line"><span class="attr">Relay_Log_Pos:</span> <span class="number">529</span></span><br><span class="line"><span class="attr">Relay_Master_Log_File:</span> <span class="string">mysql-bin.0000010</span></span><br><span class="line"><span class="attr">Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Slave_SQL_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Replicate_Do_DB:</span></span><br><span class="line"><span class="attr">Replicate_Ignore_DB:</span></span><br><span class="line"><span class="attr">Replicate_Do_Table:</span></span><br><span class="line"><span class="attr">Replicate_Ignore_Table:</span></span><br><span class="line"><span class="attr">Replicate_Wild_Do_Table:</span></span><br><span class="line"><span class="attr">Replicate_Wild_Ignore_Table:</span></span><br><span class="line"><span class="attr">Last_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_Error:</span></span><br><span class="line"><span class="attr">Skip_Counter:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Exec_Master_Log_Pos:</span> <span class="number">106</span></span><br><span class="line"><span class="attr">Relay_Log_Space:</span> <span class="number">830</span></span><br><span class="line"><span class="attr">Until_Condition:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">Until_Log_File:</span></span><br><span class="line"><span class="attr">Until_Log_Pos:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Master_SSL_Allowed:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Master_SSL_CA_File:</span></span><br><span class="line"><span class="attr">Master_SSL_CA_Path:</span></span><br><span class="line"><span class="attr">Master_SSL_Cert:</span></span><br><span class="line"><span class="attr">Master_SSL_Cipher:</span></span><br><span class="line"><span class="attr">Master_SSL_Key:</span></span><br><span class="line"><span class="attr">Seconds_Behind_Master:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Master_SSL_Verify_Server_Cert:</span> <span class="literal">No</span></span><br><span class="line"><span class="attr">Last_IO_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_IO_Error:</span></span><br><span class="line"><span class="attr">Last_SQL_Errno:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">Last_SQL_Error:</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure>

<p>验证是否配置正确.<br>在从服务器上执行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">show <span class="literal">slave</span> statusG;</span><br><span class="line"></span><br><span class="line">Waiting for <span class="keyword">master</span> <span class="title">to</span> send event</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<p>如以上二行同时为Yes 说明配置成功.</p>
<p>测试:</p>
<p>1、在主服务器test数据库中创建user表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>use test;</span><br><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(id <span class="type">int</span>);</span><br></pre></td></tr></table></figure>

<p>2、在从服务器中查看user表</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt;use test;</span><br><span class="line">mysql&gt; show tables like <span class="emphasis">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="code">+----------------------+</span></span><br><span class="line"><span class="section">| Tables_in_test(user) |</span></span><br><span class="line"><span class="section">+----------------------+</span></span><br><span class="line"><span class="section">| user |</span></span><br><span class="line"><span class="section">+----------------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>说明主从数据同步成功.</p>
<p>如果需要多个从数据库的话,可以一直重复从数据库 的操作,但是my.cnf里面的server-id必须不能相同,使用不同的数字就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos 通过MFS实现分布式存储</title>
    <url>/2015/06/03/1077/</url>
    <content><![CDATA[<p>今天来搞一个分布式的存储系统MFS,这个不论是原理还是搭建使用都不太好理解,所以大家可以先去搜索一些相关资料了解一下MFS的工作原理再来尝试搭建.</p>
<p>1、元数据服务器.在整个体系中负责管理管理文件系统.<br>2、元数据日志服务器.负责备份master 服务器的变化日志文件,文件类型为changelog_ml.*.mfs ,以便于在元数据服务器出问题的时候接替其进行工作.<br>3、数据存储服务器chunkserver.真正存储用户数据的服务器.存储文件时,首先把文件分成块,然后这些块在数据服务器chunkserver之间复 制(复制份数可以手工指定,建议设置副本数为3).数据服务器可以是多个,并且数量越多,可使用的”磁盘空间”越大,可靠性也越高.<br>4、客户端.使用MFS文件系统来存储和访问的主机称为MFS的客户端,成功挂接MFS文件系统以后,就可以像以前使用NFS一样共享这个虚拟性的存储了.</p>
<p>一、环境描述:</p>
<p>· 主控服务器Master server: 119.147.146.246<br>· 主控备份服务器Metalogger server: 119.147.146.248<br>· 存储块服务器Chunk servers: 119.147.146.249<br>· 客户端主机 (clients): 119.147.146.242、10.20.220.26</p>
<p>二、主控服务器Master的安装</p>
<p>1.安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ useradd mfs -s <span class="regexp">/sbin/</span>nologin</span><br><span class="line">$ wget http:<span class="regexp">//</span>www.moosefs.org<span class="regexp">/tl_files/m</span>fscode/mfs-<span class="number">1.6</span>.<span class="number">20</span>-<span class="number">2</span>.tar.gz<span class="variable">$tar</span> zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ tar -zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ cd mfs-<span class="number">1.6</span>.<span class="number">11</span></span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/m</span>fs --with-default-user=mfs --with- default-group=mfs --disable-mfschunkserver --disable-mfsmount</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>2.copy配置文件</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> /usr/local/mfs/etc/</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cp</span> mfsmaster.cfg.dist mfsmaster.cfg</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cp</span> mfsexports.cfg.dist mfsexports.cfg</span><br></pre></td></tr></table></figure>

<p>3.mfsmaster.cfg文件详解</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ cat /usr/local/mfs/etc/mfsmaster.cfg</span><br><span class="line"><span class="meta"># WORKING_USER = mfs #运行master server的用户</span></span><br><span class="line"><span class="meta"># WORKING_GROUP = mfs #运行master server的的组</span></span><br><span class="line"><span class="meta"># SYSLOG_IDENT = mfsmaster #是master server在syslog中的标志</span></span><br><span class="line"><span class="meta"># LOCK_MEMORY = 0#是否执行mlockall()以避免mfsmaster进程溢出(默认为0)</span></span><br><span class="line"><span class="meta"># NICE_LEVEL = -19 #运行的优先级</span></span><br><span class="line"><span class="meta"># EXPORTS_FILENAME = /usr/local/mfs/etc/mfsexports.cfg #被挂载目录及权限控制文件的存放位置</span></span><br><span class="line"><span class="meta"># DATA_PATH = /usr/local/mfs/var/mfs #数据存放路径</span></span><br><span class="line"><span class="meta"># BACK_LOGS = 50 #元数据的改变日志文件数量(默认50)</span></span><br><span class="line"><span class="meta"># REPLICATIONS_DELAY_INIT = 300 #延迟复制的时间(默认300s)</span></span><br><span class="line"><span class="meta"># REPLICATIONS_DELAY_DISCONNECT = 3600 #CHUNK SERVER断开复制的延迟</span></span><br><span class="line"><span class="meta"># MATOML_LISTEN_HOST = * #元数据日志服务器监听的IP地址(默认*,代表任何)</span></span><br><span class="line"><span class="meta"># MATOML_LISTEN_PORT = 9419 #元数据日志服务器监听的端口(默认9419)</span></span><br><span class="line"><span class="meta"># MATOCS_LISTEN_HOST = * #用于CHUNK SERVER 连接的IP(默认*,任何IP)</span></span><br><span class="line"><span class="meta"># MATOCS_LISTEN_PORT = 9420 #用于CHUNK SERVER连接的端口(默认9420)</span></span><br><span class="line"><span class="meta"># MATOCU_LISTEN_HOST = * #用于客户端挂载连接的IP(默认*.代表任何IP)</span></span><br><span class="line"><span class="meta"># MATOCU_LISTEN_PORT = 9421#用户客户端挂载连接的端口(默认9421)</span></span><br><span class="line"><span class="meta"># CHUNKS_LOOP_TIME = 300 #chunks的回环频率(默认300s)</span></span><br><span class="line"><span class="meta"># CHUNKS_DEL_LIMIT = 100 #表示在一个loop设备中可以删除chunks的最大数(默认100)</span></span><br><span class="line"><span class="meta"># CHUNKS_WRITE_REP_LIMIT = 1 #在一个循环里复制一个CHUNK SERVER的最大chunks数目(默认1)</span></span><br><span class="line"><span class="meta"># CHUNKS_READ_REP_LIMIT = 5 #在一个循环里从一个CHUNK SERVER 中复制最大chunks数目(默认5)</span></span><br><span class="line"><span class="meta"># REJECT_OLD_CLIENTS = 0 弹出低于1.6.0的客户端挂接(0或1,默认0)</span></span><br><span class="line"><span class="meta"># deprecated, to be removed in MooseFS 1.7</span></span><br><span class="line"><span class="meta"># LOCK_FILE = /var/run/mfs/mfsmaster.lock</span></span><br></pre></td></tr></table></figure>

<p>注意:<br>如果我们打算更改这些配置文件中的某些项目的值,则需要打开特定配置文件相关文本行前的注释,然后修改跟随其后的值.因为被注释掉的行,即是MooseFS内置的缺省值,在这里我们暂时不打算对其进行修改.</p>
<p>4.mfsexports.cfg文件详解</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ cat <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>etc/mfsexports.cfg</span><br><span class="line"><span class="comment">#* / ro</span></span><br><span class="line"><span class="comment">#192.168.1.0/24 / rw</span></span><br><span class="line"><span class="comment">#192.168.1.0/24 / rw,alldirs,maproot=0,password=passcode</span></span><br><span class="line"><span class="comment">#10.0.0.0-10.0.0.5 /test rw,maproot=nobody,password=test</span></span><br><span class="line"><span class="comment">#* . rw</span></span><br><span class="line"><span class="comment">#* / rw,alldirs,maproot=0</span></span><br><span class="line"><span class="comment">#192.168.1.0/24 / rw,alldirs,maproot=0,password=passcode</span></span><br><span class="line"><span class="number">119.147</span>.<span class="number">146.248</span><span class="regexp">/24 /</span> rw,alldirs,maproot=<span class="number">0</span></span><br><span class="line"><span class="number">119.147</span>.<span class="number">146.242</span><span class="regexp">/24 /</span>data rw,alldirs,maproot=<span class="number">0</span>,password=<span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>mfsexports.cfg文件每一条由三部分组成,第一部分表示客户端的IP地址,第二部分表示被挂接的目录,第三部分表示客户端拥有的权限,下面对三给部分进行解释:</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">a.客户端IP地址</span><br><span class="line">* 所有IP地址</span><br><span class="line"><span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span> 单个IP地址</span><br><span class="line"><span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span>.<span class="keyword">x</span>/m.m.m.m IP网络地址/子网掩码</span><br><span class="line">f.f.f.f-t.t.t.t IP段</span><br><span class="line">b.被挂载的目录</span><br><span class="line">/ 表示MooseFS的根</span><br><span class="line">. 表示MFSMETA文件系统</span><br><span class="line"><span class="keyword">c</span>.客户端拥有的权限</span><br><span class="line">ro 只读</span><br><span class="line">rw 读写</span><br><span class="line">alldirs 允许挂载任何指定的子目录</span><br><span class="line">maproot 映射为root用户还是指定的用户</span><br><span class="line">password 指定客户端密码</span><br></pre></td></tr></table></figure>

<p>5.首次安装master时,会自动生成一个名为metadata.mfs.empty的元数据文件metadata,该文件是空的.MooseFS master运必须有文件metadata.mfs</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cp</span> <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>var<span class="regexp">/mfs/m</span>etadata.mfs.empty <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>var<span class="regexp">/mfs/m</span>etadata.mfs</span><br></pre></td></tr></table></figure>

<p>6.启动master</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>sbin/mfsmaster start</span><br></pre></td></tr></table></figure>

<p>7.开机启动</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>echo <span class="string">&quot;/usr/local/mfs/sbin/mfscgiserv&quot;</span> &gt;&gt;<span class="regexp">/etc/rc</span>.local</span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>echo <span class="string">&quot;/usr/local/mfs/sbin/mfsmaster&quot;</span> &gt;&gt; <span class="regexp">/etc/rc</span>.local</span><br></pre></td></tr></table></figure>

<p>查看mfs是否运行</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ps</span> -ef | grep mfs</span><br><span class="line">mfs <span class="number">23920</span> <span class="number">1</span> <span class="number">0</span> <span class="number">01</span>:<span class="number">34</span> ? <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>sbin/mfsmaster start</span><br></pre></td></tr></table></figure>

<p>三、安装主控备份服务器Metalogger server</p>
<p>1.安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ useradd mfs -s <span class="regexp">/sbin/</span>nologin</span><br><span class="line">$ wget http:<span class="regexp">//</span>www.moosefs.org<span class="regexp">/tl_files/m</span>fscode/mfs-<span class="number">1.6</span>.<span class="number">20</span>-<span class="number">2</span>.tar.gz<span class="variable">$tar</span> zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ tar -zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ cd mfs-<span class="number">1.6</span>.<span class="number">11</span></span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/m</span>fs --with-default-user=mfs --with- default-group=mfs --disable-mfschunkserver --disable-mfsmount</span><br><span class="line"><span class="variable">$make</span></span><br><span class="line"><span class="variable">$make</span> install</span><br></pre></td></tr></table></figure>

<p>2.copy配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>etc</span><br><span class="line">$ cp mfsmetalogger.cfg.dist mfsmetalogger.cfg</span><br></pre></td></tr></table></figure>

<p>3.mfsmetalogger.cfg文件详解</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">[root@localhost etc]$ cat mfsmetalogger.cfg</span><br><span class="line"><span class="meta"># WORKING_USER = mfs</span></span><br><span class="line"><span class="meta"># WORKING_GROUP = mfs</span></span><br><span class="line"><span class="meta"># SYSLOG_IDENT = mfsmetalogger</span></span><br><span class="line"><span class="meta"># LOCK_MEMORY = 0</span></span><br><span class="line"><span class="meta"># NICE_LEVEL = -19</span></span><br><span class="line"><span class="meta"># DATA_PATH = /usr/local/mfs/var/mfs</span></span><br><span class="line"><span class="meta"># BACK_LOGS = 50</span></span><br><span class="line"><span class="meta"># META_DOWNLOAD_FREQ = 24</span></span><br><span class="line"><span class="meta"># MASTER_RECONNECTION_DELAY = 5</span></span><br><span class="line">MASTER_HOST = <span class="number">119.147</span><span class="number">.146</span><span class="number">.246</span></span><br><span class="line"><span class="meta"># MASTER_PORT = 9419</span></span><br><span class="line"><span class="meta"># MASTER_TIMEOUT = 60</span></span><br><span class="line"><span class="meta"># deprecated, to be removed in MooseFS 1.7</span></span><br><span class="line"><span class="meta"># LOCK_FILE = /var/run/mfs/mfsmetalogger.lock</span></span><br></pre></td></tr></table></figure>

<p>META_DOWNLOAD_FREQ,元数据备份文件下载请求频率,默认24H,即每隔一天从元数据服务器上下载一个metadata.mfs.back文件.当元数据服务器关闭或者出故障时,metadata.mfs.back文件将消失,此时要恢复整个MFS,需要从元数据日志服务器中取的该文件.注意,这个文件和日志文件共同使用才可以恢复整个被损毁的分布式文件系统.</p>
<p>MASTER_HOST,这个文件中需要修改的是MASTER_HOST变量,这个变量的值是MASTER SERVER 的IP地址</p>
<p>4.启动元数据日志服务器</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>sbin/mfsmetalogger start</span><br><span class="line">working directory: <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>var/mfs</span><br><span class="line">lockfile created and locked</span><br><span class="line">initializing mfsmetalogger modules ...</span><br><span class="line">mfsmetalogger daemon initialized properly</span><br></pre></td></tr></table></figure>

<p>5.开机启动</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;/usr/local/mfs/sbin/mfsmetalogger&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>rc.local</span><br></pre></td></tr></table></figure>

<p>查看MFS进程</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ ps -ef | <span class="keyword">grep</span> mfs</span><br><span class="line">mfs <span class="number">16373</span> <span class="number">1</span> <span class="number">0</span> <span class="number">19</span>:<span class="number">55</span> ? <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>sbin/mfsmetalogger start</span><br></pre></td></tr></table></figure>

<p>查看MFS通讯端口是否打开</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ lsof -i:<span class="number">9419</span></span><br><span class="line">COMMAND PID <span class="keyword">USER</span> <span class="title">FD</span> <span class="keyword">TYPE</span> DEVICE SIZE <span class="keyword">NODE</span> <span class="title">NAME</span></span><br><span class="line">mfsmetalo <span class="number">16373</span> mfs <span class="number">7</span>u IPv4 <span class="number">119836</span> TCP <span class="number">119.147</span>.<span class="number">146.248</span>:<span class="number">42981</span>-&gt;<span class="number">119.147</span>.<span class="number">146.246</span>:<span class="number">9419</span> (ESTABLISHED)</span><br></pre></td></tr></table></figure>

<p>四、安装存储块服务器Chunk servers</p>
<p>1.安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ useradd mfs -s <span class="regexp">/sbin/</span>nologin</span><br><span class="line">$ wget http:<span class="regexp">//</span>www.moosefs.org<span class="regexp">/tl_files/m</span>fscode/mfs-<span class="number">1.6</span>.<span class="number">20</span>-<span class="number">2</span>.tar.gz<span class="variable">$tar</span> zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ tar -zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ cd mfs-<span class="number">1.6</span>.<span class="number">11</span></span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/m</span>fs --with-default-user=mfs --with-default-group=mfs --disable-mfsmaster</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>2.copy配置文件</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">$ cd /usr/local/mfs/etc/</span><br><span class="line">$ cp mfschunkserver.cfg.dist mfschunkserver.cfg #主配置文件</span><br><span class="line">$ cp mfshdd.cfg.dist mfshdd.cfg #指定服务器分配给MFS使用的空间</span><br><span class="line"></span><br><span class="line">[root@localhost etc]$ cat mfschunkserver.cfg</span><br><span class="line"><span class="meta"># WORKING_USER = mfs</span></span><br><span class="line"><span class="meta"># WORKING_GROUP = mfs</span></span><br><span class="line"><span class="meta"># SYSLOG_IDENT = mfschunkserver</span></span><br><span class="line"><span class="meta"># LOCK_MEMORY = 0</span></span><br><span class="line"><span class="meta"># NICE_LEVEL = -19</span></span><br><span class="line"><span class="meta"># DATA_PATH = /usr/local/mfs/var/mfs</span></span><br><span class="line"><span class="meta"># MASTER_RECONNECTION_DELAY = 5</span></span><br><span class="line">MASTER_HOST = <span class="number">119.147</span><span class="number">.146</span><span class="number">.246</span> #元数据服务器的名称或地址(主机名或者IP)</span><br><span class="line">MASTER_PORT = <span class="number">9420</span></span><br><span class="line"><span class="meta"># MASTER_TIMEOUT = 60</span></span><br><span class="line"><span class="meta"># CSSERV_LISTEN_HOST = *</span></span><br><span class="line"><span class="meta"># CSSERV_LISTEN_PORT = 9422 #这个监听端口用于与其他数据储存服务器间的连接,通常是数据复制.</span></span><br><span class="line"><span class="meta"># CSSERV_TIMEOUT = 5</span></span><br><span class="line"><span class="meta"># HDD_CONF_FILENAME = /usr/local/mfs/etc/mfshdd.cfg #分配给MFS使用的磁盘空间配置文件的位置</span></span><br><span class="line"><span class="meta"># HDD_TEST_FREQ = 10</span></span><br><span class="line"><span class="meta"># deprecated, to be removed in MooseFS 1.7</span></span><br><span class="line"><span class="meta"># LOCK_FILE = /var/run/mfs/mfschunkserver.lock</span></span><br><span class="line"><span class="meta"># BACK_LOGS = 50</span></span><br><span class="line">[root@localhost etc]$ cat mfshdd.cfg</span><br><span class="line"><span class="meta">#/mnt/hd1</span></span><br><span class="line"><span class="meta">#/mnt/hd2</span></span><br><span class="line">/data #MFS的分区,客户端挂载的目录</span><br></pre></td></tr></table></figure>

<p>改变/data的属主</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>chown -R <span class="symbol">mfs:</span>mfs /data</span><br></pre></td></tr></table></figure>

<p>3.启动数据储存服务器</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost etc]$ <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>sbin/mfschunkserver start</span><br></pre></td></tr></table></figure>

<p>4.开机启动</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>echo <span class="string">&quot;/usr/local/mfs/sbin/mfschunkserver&quot;</span> &gt;&gt; <span class="regexp">/etc/rc</span>.local</span><br></pre></td></tr></table></figure>

<p>五、MFS客户端的安装配置</p>
<p>为了挂接基于MooseFS分布式文件,客户端主机必须安装FUSE软件包( fuse版本号至少2.6,推荐使用版本号大于2.7.2的fuse).如果系统没有安装fuse,你必须手动对其进行安装.一种常见的安装方式是从源码进行编译安装-我们可以从<a href="http://sourceforge.net/projects/fuse/%E5%8F%96%E5%BE%97%E5%AE%89%E8%A3%85%E6%BA%90%E7%A0%81">http://sourceforge.net/projects/fuse/取得安装源码</a>:</p>
<p>1.安装fuse-2.8.1.tar.gz</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> tar <span class="literal">-zxvf</span> f<span class="built_in">use-2</span>.<span class="number">8.1</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> f<span class="built_in">use-2</span>.<span class="number">8.1</span></span><br><span class="line"><span class="variable">$</span> ./configure</span><br><span class="line"><span class="variable">$</span> make</span><br><span class="line"><span class="variable">$</span> make install</span><br></pre></td></tr></table></figure>

<p>2.安装mfs-1.6.11.tar.gz</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ useradd mfs -s <span class="regexp">/sbin/</span>nologin</span><br><span class="line">$ tar -zxvf mfs-<span class="number">1.6</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">$ cd mfs-<span class="number">1.6</span>.<span class="number">11</span></span><br><span class="line">$ export PKG_CONFIG_PATH=<span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>pkgconfig:$PKG_CONFIG_PATH</span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/m</span>fs --with-<span class="keyword">default</span>-user=mfs --with-<span class="keyword">default</span>-<span class="keyword">group</span>=mfs --enable-mfsmount --disable-mfsmaster --disable-mfschunkserver</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>3.加载fuse模块到内核</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>modprobe fuse</span><br></pre></td></tr></table></figure>

<p>4.创建挂载点</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ mkdir <span class="regexp">/mnt/m</span>fs</span><br></pre></td></tr></table></figure>

<p>5.挂载MFS</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>bin<span class="regexp">/mfsmount /m</span>nt/mfs -H <span class="number">119.147</span>.<span class="number">146.246</span> -p</span><br></pre></td></tr></table></figure>

<p>输入密码就可以了,所有的MFS都挂载的是同一个元数据服务器的IP,而不是其他数据储存服务器的IP<br>6.开机自动挂载</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;/usr/local/mfs/bin/mfsmount /mnt/mfs -H 119.147.146.246 -p&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>rc.local</span><br></pre></td></tr></table></figure>

<p>7.查看挂载情况</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ df -h</span><br><span class="line">Filesystem <span class="keyword">Size</span> Used Avail Use% Mounted on</span><br><span class="line"><span class="regexp">/dev/m</span>apper/VolGroupRoot-LogVolRoot</span><br><span class="line"><span class="number">16</span>G <span class="number">2.6</span>G <span class="number">13</span>G <span class="number">18</span>% /</span><br><span class="line"><span class="regexp">/dev/</span>cciss<span class="regexp">/c0d0p1 99M 27M 68M 29% /</span>boot</span><br><span class="line">tmpfs <span class="number">5.9</span>G <span class="number">0</span> <span class="number">5.9</span>G <span class="number">0</span>% <span class="regexp">/dev/</span>shm</span><br><span class="line"><span class="regexp">/dev/m</span>apper/VolGroupData-LogVolData</span><br><span class="line"><span class="number">246</span>G <span class="number">13</span>G <span class="number">221</span>G <span class="number">6</span>% /data</span><br><span class="line"><span class="regexp">/dev/m</span>apper/VolGroupData-LogVolLog</span><br><span class="line"><span class="number">9.7</span>G <span class="number">2.3</span>G <span class="number">7.0</span>G <span class="number">25</span>% <span class="regexp">/data/</span>logs</span><br><span class="line"><span class="number">119.147</span>.<span class="number">146.246</span>:<span class="number">9421</span> <span class="number">11</span>G <span class="number">112</span>M <span class="number">11</span>G <span class="number">2</span>% <span class="regexp">/mnt/m</span>fs</span><br></pre></td></tr></table></figure>

<p>利用mount查看</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span>$ mount</span><br><span class="line"><span class="number">119.147.146.246:9421</span> on /mnt/mfs type fuse.mfs (rw,nosuid,nodev,allow_other,default_permissions)</span><br></pre></td></tr></table></figure>

<p>最后说明一下:chunkserver和client都是可以无限添加的.其他部分的服务器也可以通过keepalived或者heartbeat实现高可用.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS5.3下安装 VHCS2教程</title>
    <url>/2014/01/23/1082/</url>
    <content><![CDATA[<p>在你安装VHCS2前请确认你注意到以下问题:</p>
<p>(1)请确认您使用的是CentOS 5.3<br>(2)你的服务器必须配置有完全合法的域名,或者这个域名可以被网络上的其他计算机识别.<br>(3)服务器的安装,请见教程:开源主机安装装备篇之——CentOS5.3的安装<br>(4)服务器的IP、子网掩码等设置,以(3)中的教程设置为范例,您可以自行修改成你的设置.CentOS 5.2/5.3的安装可以参考本站的开源主机安装装备篇之——CentOS5.3的安装.</p>
<p>注意:服务器安装完成后,必须关闭防火墙和SELinux,设置后必须重启一次.本教程仅做测试研究之用,由于VHCS2对CentOS5的兼容性不是太好,不建议用做工业用途.</p>
<p>一、调整 <code>/etc/hosts</code>:</p>
<p>编辑 <code>/etc/hosts</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">host:~$ vi <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>

<p>内容如下:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"># Do not remove the following line, or various programs</span><br><span class="line"># that require network functionality will fail.</span><br><span class="line"><span class="number">127.0.0.1</span> localhost.localdomain localhost</span><br><span class="line"><span class="number">192.168.0.200</span> server.ispcpcn.com server</span><br><span class="line">::<span class="number">1</span> localhost6.localdomain6 localhost6</span><br></pre></td></tr></table></figure>

<p>二、系统的初始化配置安装过后,要进行系统的初始化配置.具体配置方法见本站的:</p>
<p>CentOS安装过后的几个初始化配置.</p>
<p>三、使用root帐号登录系统,升级系统,建立一个专用文件夹,下载VHCS2最新版压缩包并解压:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">host</span>:~$ mkdir downloads</span><br><span class="line"><span class="attribute">host</span>:~$ cd downloads</span><br><span class="line"><span class="attribute">host</span>:~$ wget http://server<span class="number">5</span>.moll-newmedia.de/vhcs-<span class="number">2</span>.<span class="number">4</span>.<span class="number">8</span>.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">host</span>:~$ tar -xjvf vhcs-<span class="number">2</span>.<span class="number">4</span>.<span class="number">8</span>.tar.bz<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>四、设置补充更新源,并更新系统:</p>
<p>在VHCS2中,某些模块在官方的更新源中是没有的,就需要引用一些其他的源来安装.安装这个模块,就可以方便得使用yum install来安装一些官方没有的功能模块.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">host</span>:~$ wget http://www.ispcpcn.com/Soft/ispCP/rpmforge-release-<span class="number">0</span>.<span class="number">3</span>.<span class="number">6</span>-<span class="number">1</span>.el<span class="number">5</span>.rf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ rpm -Uhv rpmforge-release-<span class="number">0</span>.<span class="number">3</span>.<span class="number">6</span>-<span class="number">1</span>.el<span class="number">5</span>.rf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ rm -f rpmforge-release-<span class="number">0</span>.<span class="number">3</span>.<span class="number">6</span>-<span class="number">1</span>.el<span class="number">5</span>.rf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ yum update</span><br></pre></td></tr></table></figure>

<p>五、切换到VHCS2解压缩主目录,建立软件安装文件列表:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">host:</span>~<span class="meta"># cd $HOME/downloads/vhcs*</span></span><br><span class="line"><span class="symbol">host:</span>~<span class="meta"># vi ./docs/centos-packages</span></span><br></pre></td></tr></table></figure>

<p>centos5-packages内容如下:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">yum install awstats bind bind-chroot bind-libs bind-utils bzip2</span><br><span class="line">caching-nameserver chkrootkit clamav clamd clamav-db courier-authlib</span><br><span class="line">courier-authlib-userdb courier-<span class="keyword">imap</span> cyrus-sasl cyrus-sasl-gssapi</span><br><span class="line">cyrus-sasl-plain cyrus-sasl-md5 cyrus-sasl-ntlm expect gcc httpd</span><br><span class="line">iptables libdbi-dbd-mysql libmcrypt libtool-ltdl redhat-lsb mod_perl</span><br><span class="line">mod_ssl mod_auth_mysql mysql mysql-server net-snmp-<span class="keyword">perl</span> patch <span class="keyword">perl</span>-</span><br><span class="line">Archive-Tar <span class="keyword">perl</span>-Archive-Zip <span class="keyword">perl</span>-BerkeleyDB <span class="keyword">perl</span>-Bit-Vector <span class="keyword">perl</span>-</span><br><span class="line">Carp-Clan <span class="keyword">perl</span>-Compress-Zlib <span class="keyword">perl</span>-Convert-TNEF <span class="keyword">perl</span>-Convert-UUlib</span><br><span class="line"><span class="keyword">perl</span>-Crypt-Blowfish <span class="keyword">perl</span>-Crypt-CBC <span class="keyword">perl</span>-Crypt-DH <span class="keyword">perl</span>-Crypt-</span><br><span class="line">PasswdMD5 <span class="keyword">perl</span>-Date-Calc <span class="keyword">perl</span>-DateManip <span class="keyword">perl</span>-DBD-MySQL <span class="keyword">perl</span>-Digest-</span><br><span class="line">HMAC <span class="keyword">perl</span>-HTML-Parser <span class="keyword">perl</span>-HTML-Tagset <span class="keyword">perl</span>-MIME-tools <span class="keyword">perl</span>-IO-</span><br><span class="line">stringy <span class="keyword">perl</span>-libwww-<span class="keyword">perl</span> <span class="keyword">perl</span>-MailTools <span class="keyword">perl</span>-Net-CIDR-Lite <span class="keyword">perl</span>-Net</span><br><span class="line">-DNS <span class="keyword">perl</span>-Net-IP <span class="keyword">perl</span>-Net-LibIDN <span class="keyword">perl</span>-Net-Netmask <span class="keyword">perl</span>-Net-Server</span><br><span class="line"><span class="keyword">perl</span>-suidperl <span class="keyword">perl</span>-TermReadKey <span class="keyword">perl</span>-TimeDate <span class="keyword">perl</span>-URI <span class="keyword">perl</span>-Unix-</span><br><span class="line">Syslog <span class="keyword">perl</span>-MailTools php php-bcmath php-dba php-gd php-ldap hp-</span><br><span class="line">mbstring php-mcrypt php-mysql php-odbc php-pear php-snmp php-xml</span><br><span class="line">postfix proftpd proftpd-mysql rkhunter spamassassin <span class="built_in">system</span>-config-</span><br><span class="line">bind tar unixODBC unzip wget</span><br></pre></td></tr></table></figure>

<p>六、通过yum安装必须的软件包.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">host:~$ cd <span class="variable">$HOME</span><span class="regexp">/downloads/</span>vhcs*</span><br><span class="line">host:~$ yum install `cat .<span class="regexp">/docs/</span>centos-packages`</span><br></pre></td></tr></table></figure>

<p>七、通过CPAN安装一些不能通过yum 安装的模块:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">host:</span>~$ cpan</span><br></pre></td></tr></table></figure>

<p>进入cpan会出现如下提示,请输入no回车:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Are</span> you ready for manual configuration? [<span class="literal">yes</span>] <span class="literal">no</span> &lt;--这里输入<span class="literal">no</span>然后回车确认</span><br></pre></td></tr></table></figure>

<p>安装:MIME::Entity:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">cpan&gt; install MIME::Entity</span><br></pre></td></tr></table></figure>

<p>安装过程出现如下提示:</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="params">(<span class="number">1</span>)</span>--&gt;</span>Auto-install the <span class="number">1</span> mandatory <span class="built_in">module</span>(s) <span class="keyword">from</span> CPAN? [y] &lt;--输入y回车</span><br><span class="line">(<span class="number">2</span>)Shall I follow them <span class="keyword">and</span> prepend them <span class="keyword">to</span> the queue <span class="keyword">of</span> modules we are processing right now? [<span class="literal">yes</span>] &lt;--输入<span class="literal">yes</span>回车</span><br></pre></td></tr></table></figure>

<p>安装Term::ReadPassword:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">cpan&gt; install Term::ReadPassword</span><br></pre></td></tr></table></figure>

<p>退出cpan:</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">cpan&gt; <span class="keyword">quit</span></span><br></pre></td></tr></table></figure>

<p>八、卸载 sendmail,同时安装redhat-lsb,避免sendmail影响postfix的运行.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">hos<span class="variable">t:</span>~$ yum <span class="built_in">remove</span> sendmail</span><br><span class="line">hos<span class="variable">t:</span>~$ yum install redhat-lsb</span><br></pre></td></tr></table></figure>

<p>九、安装courier-imap,courier-authlib-userdb和courier-authlib.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">host</span>:~$ wget http://www.ispcpcn.com/Soft/ispCP/courier-authlib-<span class="number">0</span>.<span class="number">62</span>.<span class="number">2</span>-<span class="number">1</span>.el<span class="number">5</span>.mf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ wget http://www.ispcpcn.com/Soft/ispCP/courier-authlib-userdb-<span class="number">0</span>.<span class="number">62</span>.<span class="number">2</span>-<span class="number">1</span>.el<span class="number">5</span>.mf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ wget http://www.ispcpcn.com/Soft/ispCP/courier-imap-<span class="number">4</span>.<span class="number">4</span>.<span class="number">1</span>-<span class="number">1</span>.el<span class="number">5</span>.mf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">host</span>:~$ rpm -ivh courier-authlib-*.rpm courier-authlib-userdb-*.rpm courier-imap-*.rpm</span><br></pre></td></tr></table></figure>

<p>十、更新系统并更新php和mysql.</p>
<p>更新最新PHP和MYSQL的方法见:CentOS通过yum升级php到5.2.9版本的方法.</p>
<p>十一、为courier建立用户和用户组,当我们建立用户组的时候可能会提示已经建立了,如果有这个提示,可以忽略,跳过.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">host:~$ groupadd courier -g <span class="number">3000</span></span><br><span class="line">host:~$ useradd -u <span class="number">3000</span> -c <span class="string">&#x27;Courier Mail Server&#x27;</span> -d <span class="regexp">/dev/</span><span class="keyword">null</span> -g courier -s <span class="regexp">/bin/</span><span class="keyword">false</span> courier</span><br></pre></td></tr></table></figure>

<p>十二、设置mysql数据库:<br>(1)启动mysql服务器:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">host:~<span class="variable">$</span> service mysqld <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p>(2)进行MySQL设置:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">host:~$ mysql_secure_installation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="symbol">Enter</span> current password for root (enter for none):</span><br><span class="line">在这里输入root用户的密码,如果您没设置密码,请直接回车.</span><br><span class="line"><span class="symbol">Change</span> the root password? [<span class="symbol">Y</span>/n]</span><br><span class="line">是否更改root的密码,如果更改,就输入<span class="string">&quot;y&quot;</span>,如果不更改,就输入 <span class="string">&quot;n&quot;</span>,更改root密码需要连续两次输入密码.</span><br><span class="line"><span class="symbol">Remove</span> anonymous users? [<span class="symbol">Y</span>/n]</span><br><span class="line">是否删除mysql的匿名用户,删除选择<span class="string">&quot;y&quot;</span>,不删除选择<span class="string">&quot;n&quot;</span>,为了安全,建议删除匿名帐号.</span><br><span class="line"><span class="symbol">Disallow</span> root login remotely? [<span class="symbol">Y</span>/n]</span><br><span class="line">是否允许root帐号远程登录,允许输入<span class="string">&quot;y&quot;</span>,不允许输入<span class="string">&quot;n&quot;</span>,建议不允许root远程登录.</span><br><span class="line"><span class="symbol">Remove</span> test database and access to it? [<span class="symbol">Y</span>/n]</span><br><span class="line">是否删除测试数据库及对测试数据库的访问许可.建议输入<span class="string">&quot;y&quot;</span>删除测试数据库.</span><br><span class="line"><span class="symbol">Reload</span> privilege tables now? [<span class="symbol">Y</span>/n]</span><br></pre></td></tr></table></figure>

<p>重置数据表的权限,建议输入”y”执行本步.</p>
<p>十三、建立三个文件和文件夹,解决VHCS2对CentOS兼容性差的问题!</p>
<p>(1)建立/etc/proftpd文件夹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">host:~$ mkdir <span class="regexp">/etc/</span>proftpd</span><br></pre></td></tr></table></figure>

<p>(2)建立/etc/proftpd/proftpd.conf文件,内容随便写:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">hos<span class="variable">t:</span>~$ <span class="keyword">vi</span> /etc/proftpd/proftpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>(3)建立/etc/named.conf,内容随便写:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">hos<span class="variable">t:</span>~$ <span class="keyword">vi</span> /etc/named.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>(4)建立/var/mail/virtual文件夹:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">host:~$ mkdir /var/mail/<span class="keyword">virtual</span></span><br></pre></td></tr></table></figure>

<p>十四、编译VHCS2安装文件:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">host:~<span class="variable">$</span> <span class="built_in">cd</span> <span class="variable">$HOME</span>/downloads/vhcs*</span><br><span class="line">host:~<span class="variable">$</span> make <span class="operator">-f</span> Makefile.centos5 install</span><br></pre></td></tr></table></figure>

<p>十五、拷贝编译好的文件进系统:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">host:~$ cp -RLf <span class="regexp">/tmp/</span>vhcs-<span class="number">2.4</span>.<span class="number">8</span><span class="regexp">/* /</span>   询问是否覆盖,请输入<span class="string">&quot;y&quot;</span>回车确认覆盖.</span><br></pre></td></tr></table></figure>

<p>十六、切换进入VHCS2安装目录,安装VHCS2,并根据提示问题进行输入和确认:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">host:~$ cd /var/www/vhcs2/engine/setup/</span><br><span class="line">host:~$ ./vhcs2-setup</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>)Please enter <span class="keyword">system</span> hostname (Enter <span class="keyword">for</span> defaults) [<span class="keyword">server</span>]: <span class="comment">--&gt;输入完整的主机名回车确认,这里vhcs2对centos有bug,主机名不是完整的.</span></span><br><span class="line">(<span class="number">2</span>)Please enter <span class="keyword">system</span> network address (Enter <span class="keyword">for</span> defaults) [<span class="number">192.168</span><span class="number">.0</span><span class="number">.200</span>]: <span class="comment">--&gt;直接回车</span></span><br><span class="line">(<span class="number">3</span>)Please enter <span class="keyword">SQL</span> <span class="keyword">server</span> host (Enter <span class="keyword">for</span> defaults) [localhost]: <span class="comment">--&gt;直接回车</span></span><br><span class="line">(<span class="number">4</span>)Please enter <span class="keyword">system</span> <span class="keyword">SQL</span> <span class="keyword">database</span> (Enter <span class="keyword">for</span> defaults) [vhcs2]: <span class="comment">--&gt;直接回车</span></span><br><span class="line">(<span class="number">5</span>)Please enter <span class="keyword">system</span> <span class="keyword">SQL</span> <span class="keyword">user</span> (Enter <span class="keyword">for</span> defaults) [root]: <span class="comment">--&gt;直接回车</span></span><br><span class="line">(<span class="number">6</span>)Please enter <span class="keyword">system</span> <span class="keyword">SQL</span> <span class="keyword">password</span> (Enter <span class="keyword">for</span> defaults) [<span class="keyword">none</span>]: <span class="comment">--&gt;输入MySQL的root用户的密码</span></span><br><span class="line">(<span class="number">7</span>)Please repeat <span class="keyword">system</span> <span class="keyword">SQL</span> <span class="keyword">password</span>: <span class="comment">--&gt;重复输入密码,进行确认</span></span><br><span class="line">(<span class="number">8</span>)Please enter VHCS ftp <span class="keyword">SQL</span> <span class="keyword">user</span> (Enter <span class="keyword">for</span> defaults) [vftp]: <span class="comment">--&gt;FTP的数据库连接用户,保持默认直接回车</span></span><br><span class="line">(<span class="number">9</span>)Please enter VHCS ftp <span class="keyword">SQL</span> <span class="keyword">user</span> <span class="keyword">password</span> (Enter <span class="keyword">for</span> defaults) [<span class="keyword">none</span>]:输入FTP的数据库连接密码</span><br><span class="line">(<span class="number">10</span>)Please repeat VHCS ftp <span class="keyword">SQL</span> <span class="keyword">user</span> <span class="keyword">password</span>: <span class="comment">--&gt;重复输入FTP的数据库连接密码</span></span><br><span class="line">(<span class="number">11</span>)Please enter administration <span class="keyword">login</span> <span class="type">name</span> (Enter <span class="keyword">for</span> defaults) [<span class="keyword">admin</span>]: <span class="comment">--&gt;输入VHCS管理员的用户名</span></span><br><span class="line">(<span class="number">12</span>)Please enter administrator <span class="keyword">password</span>: <span class="comment">--&gt;输入VHCS管理员的密码</span></span><br><span class="line">(<span class="number">13</span>)Please repeat administrator <span class="keyword">password</span>: <span class="comment">--&gt;重复输入VHCS管理员的密码,进行确认</span></span><br><span class="line">(<span class="number">14</span>)Please enter administrator email address: <span class="comment">--&gt;输入管理员的电子邮件地址</span></span><br></pre></td></tr></table></figure>

<p>然后开始正式安装了,耐心等候,等待安装结束.</p>
<p>十七、重新编辑 <code>/etc/hosts</code>配置文件:</p>
<p>编辑 <code>/etc/hosts</code>:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">host:~$ vi <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>

<p>内容如下:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"># Do not remove the following line, or various programs</span><br><span class="line"># that require network functionality will fail.</span><br><span class="line"><span class="number">127.0.0.1</span> localhost.localdomain localhost</span><br><span class="line"><span class="number">192.168.0.200</span> server.ispcpcn.com server</span><br><span class="line">::<span class="number">1</span> localhost6.localdomain6 localhost6</span><br></pre></td></tr></table></figure>

<p>十八、修改proftpd的配置:</p>
<p>VHCS2对proftpd的配置是错误的,这里需要纠正过来.<br>删除原来的proftpd.conf配置文件:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">host:~<span class="variable">$</span> <span class="built_in">rm</span> <span class="operator">-f</span> /etc/proftpd.conf</span><br></pre></td></tr></table></figure>

<p>建立新的proftpd.conf文件:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">hos<span class="variable">t:</span>~$ <span class="keyword">vi</span> /etc/proftpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>内容如下:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">LoadModule mod_sql.c</span><br><span class="line">LoadModule mod_sql_mysql.c</span><br><span class="line">LoadModule mod_quotatab.c</span><br><span class="line">LoadModule mod_quotatab_file.c</span><br><span class="line">LoadModule mod_quotatab_sql.c</span><br><span class="line">UseIPv6 <span class="keyword">off</span></span><br><span class="line">ServerName &quot;host.hqtcn.me&quot;</span><br><span class="line">ServerType standalone</span><br><span class="line">DeferWelcome <span class="keyword">off</span></span><br><span class="line">MultilineRFC2228 <span class="keyword">on</span></span><br><span class="line">DefaultServer <span class="keyword">on</span></span><br><span class="line">ShowSymlinks <span class="keyword">on</span></span><br><span class="line">AllowOverwrite <span class="keyword">on</span></span><br><span class="line">UseReverseDNS <span class="keyword">off</span></span><br><span class="line">IdentLookups <span class="keyword">off</span></span><br><span class="line">AllowStoreRestart <span class="keyword">on</span></span><br><span class="line">AllowForeignAddress <span class="keyword">on</span></span><br><span class="line">LogFormat traff &quot;%b %u&quot;</span><br><span class="line">TimeoutLogin <span class="number">120</span></span><br><span class="line">TimeoutNoTransfer <span class="number">600</span></span><br><span class="line">TimeoutStalled <span class="number">600</span></span><br><span class="line">TimeoutIdle <span class="number">1200</span></span><br><span class="line">DisplayLogin welcome.msg</span><br><span class="line">DisplayChdir .message</span><br><span class="line">ListOptions &quot;-l&quot;</span><br><span class="line">DenyFilter *.*/</span><br><span class="line">DefaultRoot ~</span><br><span class="line">Port <span class="number">21</span></span><br><span class="line">MaxInstances <span class="number">30</span></span><br><span class="line"><span class="keyword">User</span> nobody</span><br><span class="line"><span class="keyword">Group</span> nobody</span><br><span class="line">Umask <span class="number">022</span> <span class="number">022</span></span><br><span class="line">AllowOverwrite <span class="keyword">on</span></span><br><span class="line">HideNoAccess <span class="keyword">on</span></span><br><span class="line">IgnoreHidden <span class="keyword">on</span></span><br><span class="line">RootLogin <span class="keyword">off</span></span><br><span class="line">TransferLog /var/<span class="keyword">log</span>/proftpd/xferlog</span><br><span class="line">ExtendedLog /var/<span class="keyword">log</span>/proftpd/ftp_traff.<span class="keyword">log</span> <span class="keyword">read</span>,<span class="keyword">write</span> traff</span><br><span class="line">PathDenyFilter &quot;.quota$&quot;</span><br><span class="line">QuotaEngine <span class="keyword">on</span></span><br><span class="line">QuotaShowQuotas <span class="keyword">on</span></span><br><span class="line">QuotaDisplayUnits Mb</span><br><span class="line">SQLNamedQuery <span class="keyword">get</span>-quota-<span class="keyword">limit</span> <span class="keyword">SELECT</span> &quot;name, quota_type, per_session, limit_type, bytes_in_avail, bytes_out_avail, bytes_xfer_avail, files_in_avail, files_out_avail, files_xfer_avail FROM quotalimits WHERE name = &#x27;%&#123;0&#125;&#x27; AND quota_type = &#x27;%&#123;1&#125;&#x27;&quot;</span><br><span class="line">SQLNamedQuery <span class="keyword">get</span>-quota-tally <span class="keyword">SELECT</span> &quot;name, quota_type, bytes_in_used, bytes_out_used, bytes_xfer_used, files_in_used, files_out_used, files_xfer_used FROM quotatallies WHERE name = &#x27;%&#123;0&#125;&#x27; AND quota_type = &#x27;%&#123;1&#125;&#x27;&quot;</span><br><span class="line">SQLNamedQuery <span class="keyword">update</span>-quota-tally <span class="keyword">UPDATE</span> &quot;bytes_in_used = bytes_in_used + %&#123;0&#125;, bytes_out_used = bytes_out_used + %&#123;1&#125;, bytes_xfer_used = bytes_xfer_used + %&#123;2&#125;, files_in_used = files_in_used + %&#123;3&#125;, files_out_used = files_out_used + %&#123;4&#125;, files_xfer_used = files_xfer_used + %&#123;5&#125; WHERE name = &#x27;%&#123;6&#125;&#x27; AND quota_type = &#x27;%&#123;7&#125;&#x27;&quot; quotatallies</span><br><span class="line">SQLNamedQuery <span class="keyword">insert</span>-quota-tally <span class="keyword">INSERT</span> &quot;%&#123;0&#125;, %&#123;1&#125;, %&#123;2&#125;, %&#123;3&#125;, %&#123;4&#125;, %&#123;5&#125;, %&#123;6&#125;, %&#123;7&#125;&quot; quotatallies</span><br><span class="line">QuotaLock /var/run/proftpd/tally.<span class="keyword">lock</span></span><br><span class="line">QuotaLimitTable <span class="keyword">sql</span>:/<span class="keyword">get</span>-quota-<span class="keyword">limit</span></span><br><span class="line">QuotaTallyTable <span class="keyword">sql</span>:/<span class="keyword">get</span>-quota-tally/<span class="keyword">update</span>-quota-tally/<span class="keyword">insert</span>-quota-tally</span><br><span class="line">Ratios <span class="keyword">on</span></span><br><span class="line">DelayEngine <span class="keyword">on</span></span><br><span class="line">ControlsEngine <span class="keyword">on</span></span><br><span class="line">ControlsMaxClients <span class="number">2</span></span><br><span class="line">ControlsLog /var/<span class="keyword">log</span>/proftpd/controls.<span class="keyword">log</span></span><br><span class="line">ControlsInterval <span class="number">5</span></span><br><span class="line">ControlsSocket /var/run/proftpd/proftpd.sock</span><br><span class="line">AdminControlsEngine <span class="keyword">on</span></span><br><span class="line">AuthPAMConfig proftpd</span><br><span class="line">AuthOrder mod_sql.c</span><br><span class="line">SQLBackend mysql</span><br><span class="line">SQLAuthTypes Crypt</span><br><span class="line">SQLAuthenticate <span class="keyword">on</span></span><br><span class="line">SQLConnectInfo vhcs2@localhost vftp <span class="number">111111111</span></span><br><span class="line">SQLUserInfo ftp_users userid passwd uid gid homedir shell</span><br><span class="line">SQLGroupInfo ftp_group groupname gid members</span><br><span class="line">SQLMinUserUID <span class="number">2000</span></span><br><span class="line">SQLMinUserGID <span class="number">2000</span></span><br></pre></td></tr></table></figure>

<p>如上面的内容有点乱,如果您复制后无法启动proftpd.conf,请下载我改好的配置文件:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">host:~<span class="variable">$</span> <span class="built_in">cd</span> /etc/</span><br><span class="line">host:~<span class="variable">$</span> <span class="built_in">rm</span> <span class="operator">-f</span> proftpd.conf</span><br><span class="line">host:~<span class="variable">$</span> <span class="built_in">wget</span> http://www.ispcpcn.com/Soft/vhcs2/proftpd.conf</span><br></pre></td></tr></table></figure>

<p>然后对 <code>/etc/proftpd.conf</code>进行编辑(无论是是新建的还是下载的proftpd.conf文件都需要再编辑):</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">hos<span class="variable">t:</span>~$ <span class="keyword">vi</span> /etc/proftpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>需要编辑的内容如下:</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="meta">[</span><span class="params">...</span><span class="params">...</span><span class="meta">]</span></span><br><span class="line">ServerName &quot;host.hqtcn.me&quot; &lt;--这里把host.hqtcn.me替换成您的主机名</span><br><span class="line"><span class="meta">[</span><span class="params">...</span><span class="params">...</span><span class="meta">]</span></span><br><span class="line">SQLConnectInfo vhcs2@localhost vftp 111111 &lt;-- 这里vhcs2是您的VHCS2数据库名,如果您默认不是vhcs2,修改成您的,vftp是您的ftp连接数据库的用户名,改成您的设置,后面的 111111是您的vftp连接数据库的密码.</span><br><span class="line"><span class="meta">[</span><span class="params">...</span><span class="params">...</span><span class="meta">]</span></span><br></pre></td></tr></table></figure>

<p>十九、设置 VHCS2必须的启动项:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">host</span>:~$ chkconfig --add vhcs<span class="number">2</span>_daemon</span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">345</span> vhcs<span class="number">2</span>_daemon <span class="literal">on</span></span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">235</span> httpd <span class="literal">on</span></span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">235</span> mysqld <span class="literal">on</span></span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">235</span> saslauthd <span class="literal">on</span></span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">235</span> proftpd <span class="literal">on</span></span><br><span class="line"><span class="attribute">host</span>:~$ chkconfig --levels <span class="number">235</span> named <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>二十、重启服务器:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">host:~$ shutdown -r now</span><br></pre></td></tr></table></figure>

<p>二十一、控制面板的汉化:</p>
<p>界面的汉化请参看Debian5下安装VHCS2最新版(2.4.8) 中的第十二步.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos5.5下lvs+keepalived集群</title>
    <url>/2014/09/02/1083/</url>
    <content><![CDATA[<p>第一步、环境准备:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lvs</span>-master:<span class="number">10.80.11.245</span></span><br><span class="line"><span class="attribute">lvs</span>-backup:<span class="number">10.80.11.246</span></span><br><span class="line"><span class="attribute">vip</span>:<span class="number">10.80.11.240</span></span><br><span class="line"><span class="attribute">web1</span>:<span class="number">10.80.11.243</span></span><br><span class="line"><span class="attribute">web2</span>:<span class="number">10.80.11.244</span></span><br><span class="line"><span class="attribute">netmask</span>:<span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">gateway</span>:<span class="number">10.80.11.1</span></span><br></pre></td></tr></table></figure>

<p>接下来关掉一些不必要的系统服务:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">chkconfig bluetooth <span class="keyword">off</span></span><br><span class="line">chkconfig firstboot <span class="keyword">off</span></span><br><span class="line">chkconfig cups <span class="keyword">off</span></span><br><span class="line">chkconfig ip6tables <span class="keyword">off</span></span><br><span class="line">chkconfig iptables <span class="keyword">off</span></span><br><span class="line">chkconfig isdn <span class="keyword">off</span></span><br><span class="line">chkconfig kudzu <span class="keyword">off</span></span><br><span class="line">chkconfig sendmail <span class="keyword">off</span></span><br><span class="line">chkconfig smartd <span class="keyword">off</span></span><br><span class="line">chkconfig autofs <span class="keyword">off</span></span><br><span class="line">service bluetooth <span class="keyword">stop</span></span><br><span class="line">service firstboot <span class="keyword">stop</span></span><br><span class="line">service cups <span class="keyword">stop</span></span><br><span class="line">service ip6tables <span class="keyword">stop</span></span><br><span class="line">service iptables <span class="keyword">stop</span></span><br><span class="line">service isdn <span class="keyword">stop</span></span><br><span class="line">service kudzu <span class="keyword">stop</span></span><br><span class="line">service sendmail <span class="keyword">stop</span></span><br><span class="line">service smartd <span class="keyword">stop</span></span><br><span class="line">service autofs <span class="keyword">stop</span></span><br></pre></td></tr></table></figure>

<p>服务器时间校对:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>crontab -e</span><br></pre></td></tr></table></figure>

<p>加入一行:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">3</span> * * * /<span class="keyword">usr</span>/sbin/ntpdate <span class="number">210.72</span>.<span class="number">145.44</span> &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>第二步、安装软件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cd</span> <span class="regexp">/usr/</span>local/src</span><br><span class="line"><span class="variable">$wget</span> http:<span class="regexp">//</span>www.linuxvirtualserver.org<span class="regexp">/software/</span>kernel-<span class="number">2.6</span>/ipvsadm-<span class="number">1.24</span>.tar.gz</span><br><span class="line"><span class="variable">$wget</span> http:<span class="regexp">//</span>www.keepalived.org<span class="regexp">/software/</span>keepalived-<span class="number">1.1</span>.<span class="number">15</span>.tar.gz</span><br><span class="line"><span class="variable">$ln</span> -s <span class="regexp">/usr/</span>src<span class="regexp">/kernels/</span><span class="number">2.6</span>.<span class="number">18</span>-<span class="number">194</span>.el5-i686<span class="regexp">/ /u</span>sr<span class="regexp">/src/</span>linux</span><br><span class="line"><span class="variable">$tar</span> -zxvf ipvsadm-<span class="number">1.24</span>.tar.gz</span><br><span class="line"><span class="variable">$cd</span> ipvsadm-<span class="number">1.24</span></span><br><span class="line"><span class="variable">$make</span> &amp;&amp; make install</span><br><span class="line"><span class="variable">$cd</span> ..</span><br><span class="line"><span class="variable">$tar</span> -zxvf keepalived-<span class="number">1.1</span>.<span class="number">15</span>.tar.gz</span><br><span class="line">$ cd keepalived-<span class="number">1.1</span>.<span class="number">15</span></span><br><span class="line">$./configure</span><br><span class="line">configure: error:</span><br><span class="line">  !!! OpenSSL is not properly installed on your system. !!!</span><br><span class="line">  !!! Can not include OpenSSL headers files.</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ yum -y <span class="keyword">install</span> openssl-devel</span><br><span class="line">$ ./configure &amp;&amp; make &amp;&amp; make <span class="keyword">install</span></span><br></pre></td></tr></table></figure>

<p>编译的时候出现这个提示,说明keepalived和内核结合了,如果不是这样的,需要加上这个参数./configure –with-kernel-dir=/kernel/path.</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">Keepalived configuration</span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line">Keepalived version       : 1.1.15</span><br><span class="line">Compiler                 : <span class="type">gcc</span></span><br><span class="line">Compiler flags           : -<span class="type">g</span> -O2</span><br><span class="line">Extra Lib                : -<span class="type">lpopt</span> -lssl -lcrypto</span><br><span class="line"><span class="keyword">Use</span> IPVS Framework       : <span class="type">Yes</span></span><br><span class="line">IPVS sync daemon support : <span class="type">Yes</span></span><br><span class="line"><span class="keyword">Use</span> VRRP Framework       : <span class="type">Yes</span></span><br><span class="line"><span class="keyword">Use</span> LinkWatch            : <span class="type">No</span></span><br><span class="line"><span class="keyword">Use</span> Debug flags          : <span class="type">No</span></span><br></pre></td></tr></table></figure>

<p>下面设置keepalived以服务方式启动.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cp</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>keepalived <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span></span><br><span class="line"><span class="variable">$cp</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>sysconfig<span class="regexp">/keepalived /</span>etc<span class="regexp">/sysconfig/</span></span><br><span class="line"><span class="variable">$mkdir</span> <span class="regexp">/etc/</span>keepalived</span><br><span class="line"><span class="variable">$cp</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>keepalived<span class="regexp">/keepalived.conf /</span>etc<span class="regexp">/keepalived/</span></span><br><span class="line"><span class="variable">$cp</span> <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>keepalived <span class="regexp">/usr/</span>sbin/</span><br><span class="line"><span class="variable">$service</span> keepalived start|stop</span><br></pre></td></tr></table></figure>

<p>第三步、配置keepalived:</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">$vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">          <span class="symbol">yhl5555@</span><span class="number">126.</span>com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from <span class="symbol">yhl5555@</span><span class="number">126.</span>com</span><br><span class="line">    smtp_server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">   $ smtp_connect_timeout <span class="number">30</span></span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ VIP1</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">     state MASTER</span><br><span class="line">     <span class="keyword">interface</span> <span class="symbol">eth0</span></span><br><span class="line">     <span class="symbol">virtual_router_id</span> <span class="symbol">51</span></span><br><span class="line">     <span class="symbol">priority</span> <span class="symbol">100</span></span><br><span class="line">     <span class="symbol">advert_int</span> <span class="symbol">1</span></span><br><span class="line">     <span class="symbol">authentication</span> &#123;</span><br><span class="line">         auth_type PASS</span><br><span class="line">         auth_pass <span class="number">1111</span></span><br><span class="line">     &#125;</span><br><span class="line">     virtual_ipaddress &#123;</span><br><span class="line">         <span class="number">10.80</span><span class="number">.11</span><span class="number">.240</span>  </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server <span class="number">10.80</span><span class="number">.11</span><span class="number">.240</span> <span class="number">80</span> &#123;</span><br><span class="line">     delay_loop <span class="number">6</span></span><br><span class="line">     lb_algo wrr</span><br><span class="line">     lb_kind DR</span><br><span class="line">     $persistence_timeout <span class="number">5</span></span><br><span class="line">     protocol TCP</span><br><span class="line">     real_server <span class="number">10.80</span><span class="number">.11</span><span class="number">.243</span> <span class="number">80</span> &#123;</span><br><span class="line">         weight <span class="number">3</span>           </span><br><span class="line">         TCP_CHECK &#123;</span><br><span class="line">         connect_timeout <span class="number">10</span>    </span><br><span class="line">         nb_get_retry <span class="number">3</span></span><br><span class="line">         delay_before_retry <span class="number">3</span></span><br><span class="line">         connect_port <span class="number">80</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     real_server <span class="number">10.80</span><span class="number">.11</span><span class="number">.244</span> <span class="number">80</span> &#123;</span><br><span class="line">         weight <span class="number">3</span></span><br><span class="line">         TCP_CHECK &#123;</span><br><span class="line">         connect_timeout <span class="number">10</span></span><br><span class="line">         nb_get_retry <span class="number">3</span></span><br><span class="line">         delay_before_retry <span class="number">3</span></span><br><span class="line">         connect_port <span class="number">80</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lvs-master的优先级设置为100,状态为MASTER,在lvs-backup上优先级为99,状态为BACKUP,这是2台LVS的唯一区别.<br>persistence_timeout 5这是在5S内连接到同一台web服务器,注释掉就轮训.<br>至此,lvs-master配置已经完成,lvs-backup对照lvs-backup安装相应软件,注意keepalive.conf有细微区别.</p>
<p>第四步、web服务器的配置:</p>
<p>在2台web服务器上添加一下脚本:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vim</span> <span class="regexp">/etc/i</span>nit.d/realserver.sh</span><br><span class="line">$!<span class="regexp">/bin/</span>bash</span><br><span class="line">SNS_VIP=<span class="number">10.80</span>.<span class="number">11.240</span></span><br><span class="line">. <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>functions</span><br><span class="line">case <span class="string">&quot;$1&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">       ifconfig lo:<span class="number">0</span> <span class="variable">$SNS_VIP</span> netmask <span class="number">255.255</span>.<span class="number">255.255</span> broadcast <span class="variable">$SNS_VIP</span></span><br><span class="line">       <span class="regexp">/sbin/</span>route add -host <span class="variable">$SNS_VIP</span> dev lo:<span class="number">0</span></span><br><span class="line">       echo <span class="string">&quot;1&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_ignore</span><br><span class="line">       echo <span class="string">&quot;2&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_announce</span><br><span class="line">       echo <span class="string">&quot;1&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_ignore</span><br><span class="line">       echo <span class="string">&quot;2&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_announce</span><br><span class="line">       sysctl -p &gt;<span class="regexp">/dev/</span>null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">       echo <span class="string">&quot;RealServer Start OK&quot;</span></span><br><span class="line">       ;;</span><br><span class="line">stop)</span><br><span class="line">       ifconfig lo:<span class="number">0</span> down</span><br><span class="line">       route del <span class="variable">$SNS_VIP</span> &gt;<span class="regexp">/dev/</span>null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">       echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_ignore</span><br><span class="line">       echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_announce</span><br><span class="line">       echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_ignore</span><br><span class="line">       echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_announce</span><br><span class="line">       echo <span class="string">&quot;RealServer Stoped&quot;</span></span><br><span class="line">       ;;</span><br><span class="line">*)</span><br><span class="line">       echo <span class="string">&quot;Usage: $0 &#123;start|stop&#125;&quot;</span></span><br><span class="line">       <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">esac</span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>红色部分为VIP地址.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$chmod</span> <span class="number">755</span> <span class="regexp">/etc/i</span>nit.d/realserver.sh</span><br><span class="line"><span class="variable">$sh</span> <span class="regexp">/etc/i</span>nit.d/realserver.sh start</span><br></pre></td></tr></table></figure>

<p>同时加入自启动.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vim</span> <span class="regexp">/etc/</span>rc.local</span><br><span class="line">$<span class="regexp">/etc/i</span>nit.d/realserver.sh start</span><br></pre></td></tr></table></figure>

<p>两台web服务器都需要这样设置.</p>
<p>第五步、测试:</p>
<p>分别启动2台lvs的服务:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$service</span> keepalived start</span></span><br></pre></td></tr></table></figure>

<p>然后在客户机上输入<a href="http://10.80.11.240进行访问/">http://10.80.11.240进行访问</a>.<br>停掉lvs-master,然后测试.<br>停掉web1,然后测试.<br>如果需要把lvs加入开机自启动,执行以下命令.</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$chkconfig</span> --add keepalived</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$chkconfig</span> keepalived on</span></span><br></pre></td></tr></table></figure>

<p>至此,LVS+KEEPALIVED高可靠性配置已经完成.</p>
]]></content>
  </entry>
  <entry>
    <title>CENTOS6.0 iptables开放端口及保存防火墙规则</title>
    <url>/2014/01/06/1086/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/sbin/i</span>ptables -I INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT</span><br><span class="line">$<span class="regexp">/sbin/i</span>ptables -I INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line">$<span class="regexp">/sbin/i</span>ptables -I INPUT -p tcp --dport <span class="number">3306</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>然后保存:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/i</span>ptables save</span><br></pre></td></tr></table></figure>

<p>查看打开的端口:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/etc/i</span>nit.d/iptables status</span><br></pre></td></tr></table></figure>

<p>补充说明:</p>
<p>关闭防火墙:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables stop</span><br></pre></td></tr></table></figure>

<p>查看防火墙信息:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables status</span><br></pre></td></tr></table></figure>

<p>开放端口80808:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">8080</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>重启防火墙以便改动生效:(或者直接重启系统):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>将更改进行保存:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/i</span>ptables save</span><br></pre></td></tr></table></figure>

<p>另外直接在 <code>/etc/sysconfig/iptables</code>中增加一行:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m state-state <span class="keyword">NEW</span> -m tcp -p tcp -dport <span class="number">8080</span> -j <span class="keyword">ACCEPT</span>#永久关闭防火墙</span><br><span class="line">chkconfig <span class="comment">--level 35 iptables off</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos6.2 使用yum快速安装nginx</title>
    <url>/2019/01/07/1087/</url>
    <content><![CDATA[<p>To add nginx yum repository, create a file named <code>/etc/yum.repos.d/nginx.repo</code> and paste one of the configurations below:<br>CentOS:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[nginx]</span></span><br><span class="line"><span class="attr">name</span>=nginx repo</span><br><span class="line"><span class="attr">baseurl</span>=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>After this:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nginx</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS6 安装gnutls</title>
    <url>/2011/02/19/1085/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>download.savannah.gnu.org<span class="regexp">/releases/</span>lzip/lzip-<span class="number">1.20</span>.tar.gz</span><br><span class="line">tar zxvf lzip-<span class="number">1.20</span>.tar.gz</span><br><span class="line">cd lzip-<span class="number">1.20</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>官网:<a href="https://gmplib.org/">https://gmplib.org/</a></p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">wget https://gmplib.org/download/gmp/gmp-6.1.2.tar.lz</span><br><span class="line">lzip -d gmp-6.1.2.tar.lz</span><br><span class="line">tar xvf gmp-6.1.2.tar</span><br><span class="line">cd gmp-6.1.2</span><br><span class="line"><span class="keyword">.</span>/configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wget https://ftp.gnu.org/gnu/nettle/nettle-3.4.tar.gz</span><br><span class="line">tar zxvf nettle-3.4.tar.gz</span><br><span class="line">cd nettle-3.4</span><br><span class="line"><span class="keyword">.</span>/configure</span><br><span class="line">make</span><br><span class="line">make<span class="built_in"> check </span><span class="comment">#测试一下</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>官网:<a href="https://www.gnutls.org/download.html">https://www.gnutls.org/download.html</a></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> ftp://ftp.gnutls.org/gcrypt/gnutls/v<span class="number">3</span>.<span class="number">5</span>/gnutls-<span class="number">3</span>.<span class="number">5</span>.<span class="number">9</span>.tar.xz</span><br><span class="line"><span class="attribute">xz</span> -d gnutls-<span class="number">3</span>.<span class="number">5</span>.<span class="number">9</span>.tar.xz</span><br><span class="line"><span class="attribute">tar</span> xvf gnutls-<span class="number">3</span>.<span class="number">5</span>.<span class="number">9</span>.tar</span><br><span class="line"><span class="attribute">cd</span> gnutls-<span class="number">3</span>.<span class="number">5</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">PKG_CONFIG_PATH</span>=/usr/local/lib<span class="number">64</span>/pkgconfig ./configure --with-included-libtasn<span class="number">1</span> --with-included-unistring --without-p<span class="number">11</span>-kit</span><br><span class="line"><span class="attribute">make</span></span><br><span class="line"><span class="attribute">make</span> install</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS-5安装配置ExtMail Web邮件收发系统</title>
    <url>/2018/01/08/1084/</url>
    <content><![CDATA[<p>1、制作YUM源</p>
<p>编译CentOS-Base.repo文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure>

<p>加入如下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># EMOS-Base.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Created by ExtMail Dev Team: http://www.extmail.org/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># $Id$</span></span><br><span class="line"></span><br><span class="line"><span class="section">[EMOS-base]</span></span><br><span class="line"><span class="attr">name</span>=EMOS-Base</span><br><span class="line"><span class="attr">baseurl</span>=http://mirror.extmail.org/yum/emos/<span class="number">1.5</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">priority</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">protect</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[EMOS-update]</span></span><br><span class="line"><span class="attr">name</span>=EMOS-Updates</span><br><span class="line"><span class="attr">baseurl</span>=http://mirror.extmail.org/yum/emos/<span class="number">1.5</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">priority</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">protect</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>保存后,然后尝试执行一下yum list 等操作,看看是否已经成功.</p>
<p>2、配置mta-postfix</p>
<p>安装postfix：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> postfix</span><br><span class="line">yum <span class="keyword">remove</span> sendmail</span><br></pre></td></tr></table></figure>

<p>配置postfix：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">postconf -n &gt; <span class="regexp">/etc/</span>postfix/main2.cf</span><br><span class="line">mv <span class="regexp">/etc/</span>postfix<span class="regexp">/main.cf /</span>etc<span class="regexp">/postfix/m</span>ain.cf.old</span><br><span class="line">mv <span class="regexp">/etc/</span>postfix<span class="regexp">/main2.cf /</span>etc<span class="regexp">/postfix/m</span>ain.cf</span><br></pre></td></tr></table></figure>

<p>编辑main.cf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>postfix/main.cf</span><br></pre></td></tr></table></figure>

<p>增加如下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hostname</span></span><br><span class="line"><span class="attr">mynetworks</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">myhostname</span> = mail.centos.bz</span><br><span class="line"><span class="attr">mydestination</span> = <span class="variable">$mynetworks</span> <span class="variable">$myhostname</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># banner</span></span><br><span class="line"><span class="attr">mail_name</span> = Postfix - by extmail.org</span><br><span class="line"><span class="attr">smtpd_banner</span> = <span class="variable">$myhostname</span> ESMTP <span class="variable">$mail_name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># response immediately</span></span><br><span class="line"><span class="attr">smtpd_error_sleep_time</span> = <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Message and return coolcode control</span></span><br><span class="line"><span class="attr">message_size_limit</span> = <span class="number">5242880</span></span><br><span class="line"><span class="attr">mailbox_size_limit</span> = <span class="number">5242880</span></span><br><span class="line"><span class="attr">show_user_unknown_table_name</span> = <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Queue lifetime control</span></span><br><span class="line"><span class="attr">bounce_queue_lifetime</span> = <span class="number">1</span>d</span><br><span class="line"><span class="attr">maximal_queue_lifetime</span> = <span class="number">1</span>d</span><br></pre></td></tr></table></figure>

<p>注:myhostname改为自己的.<br>设置postfix开机自启:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> postfix <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>3、配置courier-authlib</p>
<p>安装Courier-Authlib：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> courier-authlib</span><br><span class="line">yum -y <span class="keyword">install</span> courier-authlib-mysql</span><br></pre></td></tr></table></figure>

<p>删除并编辑 <code>/etc/authlib/authmysqlrc</code>文件:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/dev/</span><span class="keyword">null</span> &gt;<span class="regexp">/etc/</span>authlib/authmysqlrc</span><br><span class="line">vi <span class="regexp">/etc/</span>authlib/authmysqlrc</span><br></pre></td></tr></table></figure>

<p>增加如下内容:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">MYSQL_SERVER            localhost</span><br><span class="line">MYSQL_USERNAME          extmail</span><br><span class="line">MYSQL_PASSWORD          extmail</span><br><span class="line">MYSQL_SOCKET            /var/lib/mysql/mysql.sock</span><br><span class="line">MYSQL_PORT              <span class="number">3306</span></span><br><span class="line">MYSQL_OPT               <span class="number">0</span></span><br><span class="line">MYSQL_DATABASE          extmail</span><br><span class="line">MYSQL_USER_TABLE        mailbox</span><br><span class="line">MYSQL_CRYPT_PWFIELD     <span class="keyword">password</span></span><br><span class="line">MYSQL_UID_FIELD         uidnumber</span><br><span class="line">MYSQL_GID_FIELD         gidnumber</span><br><span class="line">MYSQL_LOGIN_FIELD       username</span><br><span class="line">MYSQL_HOME_FIELD        homedir</span><br><span class="line">MYSQL_NAME_FIELD        <span class="type">name</span></span><br><span class="line">MYSQL_MAILDIR_FIELD     maildir</span><br><span class="line">MYSQL_QUOTA_FIELD       quota</span><br><span class="line">MYSQL_SELECT_CLAUSE     <span class="keyword">SELECT</span> username,<span class="keyword">password</span>,&quot;&quot;,uidnumber,gidnumber,</span><br><span class="line">                        CONCAT(<span class="string">&#x27;/home/domains/&#x27;</span>,homedir),</span><br><span class="line">                        CONCAT(<span class="string">&#x27;/home/domains/&#x27;</span>,maildir),</span><br><span class="line">                        quota,</span><br><span class="line">                        <span class="type">name</span></span><br><span class="line">                        <span class="keyword">FROM</span> mailbox</span><br><span class="line">                        <span class="keyword">WHERE</span> username = <span class="string">&#x27;$(local_part)@$(domain)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>修改authdaemonrc文件：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>authlib/authdaemonrc</span><br></pre></td></tr></table></figure>

<p>修改如下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">authmodulelist</span>=<span class="string">&quot;authmysql&quot;</span></span><br><span class="line"><span class="attr">authmodulelistorig</span>=<span class="string">&quot;authmysql&quot;</span></span><br></pre></td></tr></table></figure>

<p>或者使用如下命令直接修改:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/authmodulelist=.*<span class="string">/authmodulelist=</span><span class="string">&quot;authmysql&quot;</span><span class="string">/g</span>&#x27; <span class="string">/etc/authlib/authdaemonrc</span></span><br><span class="line">sed -i &#x27;s/authmodulelistorig=.*<span class="string">/authmodulelistorig=</span><span class="string">&quot;authmysql&quot;</span><span class="string">/g</span>&#x27; <span class="string">/etc/authlib/authdaemonrc</span></span><br></pre></td></tr></table></figure>

<p>启动courier-authlib:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service courier-authlib <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>修改authdaemon socket目录权限：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">755</span> <span class="regexp">/var/</span>spool<span class="regexp">/authdaemon/</span></span><br></pre></td></tr></table></figure>

<p>4、配置maildrop</p>
<p>安装maildrop：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> maildrop</span><br></pre></td></tr></table></figure>

<p>配置master.cf 为了使Postfix支持Maildrop,必须修改/etc/postfix/master.cf文件,注释掉原来的maildrop的配置内容,并改为:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">maildrop   unix        -       n        n        -        -        pipe</span><br><span class="line">  <span class="attribute">flags</span>=DRhu <span class="attribute">user</span>=vuser <span class="attribute">argv</span>=maildrop -w 90 -d <span class="variable">$&#123;user&#125;</span>@<span class="variable">$&#123;nexthop&#125;</span> <span class="variable">$&#123;recipient&#125;</span> <span class="variable">$&#123;user&#125;</span> <span class="variable">$&#123;extension&#125;</span> &#123;nexthop&#125;</span><br></pre></td></tr></table></figure>

<p>注意:flags前面有”两个空格”.</p>
<p>配置main.cf 由于maildrop不支持一次接收多个收件人,因此必须在main.cf里增加如下参数:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>postfix/main.cf</span><br><span class="line">maildrop_destination_recipient_limit = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>测试maildrop对authlib支持:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">maildrop -v</span></span><br></pre></td></tr></table></figure>

<p>看是否出现以下内容:</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><span class="line">maildrop <span class="number">2.1</span>.<span class="number">0</span> Copyright <span class="number">1998</span>-<span class="number">2005</span> Double Precision, Inc.</span><br><span class="line">GDBM/DB extensions enabled.</span><br><span class="line">Courier Authentication Library extension enabled.</span><br><span class="line">Maildir quota extension enabled.</span><br><span class="line">This program <span class="keyword">is</span> distributed under the terms of the GNU General Public</span><br><span class="line">License. See COPYING for additional information.</span><br></pre></td></tr></table></figure>

<p>5、配置apache</p>
<p>安装httpd:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> httpd</span><br></pre></td></tr></table></figure>

<p>虚拟主机设置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf</span><br></pre></td></tr></table></figure>

<p>在最后一行加上:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">NameVirtualHost *:80</span><br><span class="line"><span class="keyword">Include</span> <span class="keyword">conf</span>/vhost_*.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>编辑 vhost_extmail.conf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>vhost_extmail.conf</span><br></pre></td></tr></table></figure>

<p>里面定义虚拟主机的相关内容:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># VirtualHost for ExtMail Solution</span></span><br><span class="line">&lt;virtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">ServerName mail.centos.bz</span><br><span class="line">DocumentRoot <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extmail<span class="regexp">/html/</span></span><br><span class="line"></span><br><span class="line">ScriptAlias <span class="regexp">/extmail/</span>cgi<span class="regexp">/ /</span>var<span class="regexp">/www/</span>extsuite<span class="regexp">/extmail/</span>cgi/</span><br><span class="line">Alias <span class="regexp">/extmail /</span>var<span class="regexp">/www/</span>extsuite<span class="regexp">/extmail/</span>html/</span><br><span class="line"></span><br><span class="line">ScriptAlias <span class="regexp">/extman/</span>cgi<span class="regexp">/ /</span>var<span class="regexp">/www/</span>extsuite<span class="regexp">/extman/</span>cgi/</span><br><span class="line">Alias <span class="regexp">/extman /</span>var<span class="regexp">/www/</span>extsuite<span class="regexp">/extman/</span>html/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Suexec config</span></span><br><span class="line">SuexecUserGroup vuser vgroup</span><br><span class="line">&lt;/virtualHost&gt;</span><br></pre></td></tr></table></figure>

<p>注意:把ServerName修改成自己的.<br>设置apache开机启动并重启apache.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> httpd <span class="literal">on</span></span><br><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>

<p>6、配置webmail-extmail</p>
<p>安装ExtMail:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> extsuite-webmail</span><br></pre></td></tr></table></figure>

<p>编辑webmail.cf:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> /var/www/extsuite/extmail</span><br><span class="line"><span class="keyword">cp</span> webmail.<span class="keyword">cf</span>.default webmail.<span class="keyword">cf</span></span><br><span class="line"><span class="keyword">vi</span> webmail.<span class="keyword">cf</span></span><br></pre></td></tr></table></figure>

<p>主要变动的内容见下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">SYS_MYSQL_USER</span> = extmail</span><br><span class="line"><span class="attr">SYS_MYSQL_PASS</span> = extmail</span><br><span class="line"><span class="attr">SYS_MYSQL_DB</span> = extmail</span><br></pre></td></tr></table></figure>

<p>更新cgi目录权限 由于SuEXEC的需要,必须将extmail的cgi目录修改成vuser:vgroup权限:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R vuser:vgroup <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extmail<span class="regexp">/cgi/</span></span><br></pre></td></tr></table></figure>

<p>7、配置管理后台-extman</p>
<p>yum安装ExtMan:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> extsuite-webman</span><br></pre></td></tr></table></figure>

<p>更新cgi目录权限 由于SuEXEC的需要,必须将extman的cgi目录修改成vuser:vgroup权限:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R vuser:vgroup <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman<span class="regexp">/cgi/</span></span><br></pre></td></tr></table></figure>

<p>链接基本库到Extmail:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/tmp/</span>extman</span><br><span class="line">chown -R vuser:vgroup <span class="regexp">/tmp/</span>extman</span><br></pre></td></tr></table></figure>

<p>注意事项:</p>
<p>由于RedHat发行版中包含了一个叫tmpwatch的工具,该工具会定期扫描/tmp/下的文件,如果这些文件很久都没被使用,将被删除,因此如果后台长期不使用,/tmp/extman目录有可能被tmpwatch删除,所以要么定期登陆后台,要么修改 webman.cf将临时目录修改到另一个地方.此处暂以/tmp/extman默认值为例.</p>
<p>安装mysql数据库:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">yum -y install mysql mysql-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>数据库初始化:</p>
<p>启动Mysql:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service mysqld <span class="built_in">start</span></span><br><span class="line">chkconfig mysqld <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>导入mysql数据库结构及初始化数据,root密码默认为空.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql -u root -p &lt; <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman<span class="regexp">/docs/</span>extmail.sql</span><br><span class="line">mysql -u root -p &lt; <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman<span class="regexp">/docs/i</span>nit.sql</span><br></pre></td></tr></table></figure>

<p>注意事项:<br>上述导入初始化SQL时,默认的uidnumber/gidnumber都是1000,这和vuser:vgroup 的uid/gid一致,是因为maildrop投递时会从数据库里取uidnumber/gidnumber,而在master.cf里已经定义好了投递时的运行身份(vuser:vgroup),所以这两个字段的内容必须为1000,否则将出现投递错误,例如报0×06等错误.</p>
<p>设置虚拟域和虚拟用户的配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman/docs</span><br><span class="line">cp mysql_virtual_alias_maps.cf <span class="regexp">/etc/</span>postfix/</span><br><span class="line">cp mysql_virtual_domains_maps.cf <span class="regexp">/etc/</span>postfix/</span><br><span class="line">cp mysql_virtual_mailbox_maps.cf <span class="regexp">/etc/</span>postfix/</span><br><span class="line">cp mysql_virtual_sender_maps.cf <span class="regexp">/etc/</span>postfix/</span><br></pre></td></tr></table></figure>

<p>配置main.cf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>postfix/main.cf</span><br></pre></td></tr></table></figure>

<p>增加以下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># extmail config here</span></span><br><span class="line"><span class="attr">virtual_alias_maps</span> = mysql:/etc/postfix/mysql_virtual_alias_maps.cf</span><br><span class="line"><span class="attr">virtual_mailbox_domains</span> = mysql:/etc/postfix/mysql_virtual_domains_maps.cf</span><br><span class="line"><span class="attr">virtual_mailbox_maps</span> = mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf</span><br><span class="line"><span class="attr">virtual_transport</span> = maildrop:</span><br></pre></td></tr></table></figure>

<p>重启postfix :</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">service <span class="built_in">postfix</span> <span class="built_in">restart</span></span><br></pre></td></tr></table></figure>

<p>测试authlib:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>sbin/authtest -s login postmaster@extmail.org extmail</span><br></pre></td></tr></table></figure>

<p>结果如下:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Authentication succeeded.</span><br><span class="line"></span><br><span class="line">Authenticated: postmaster@extmail.org (uid <span class="number">1000</span>, gid <span class="number">1000</span>)</span><br><span class="line">Home Directory: /home/domains/extmail.org/postmaster</span><br><span class="line">Maildir: /home/domains/extmail.org/postmaster/Maildir/</span><br><span class="line">Quota: <span class="number">104857600</span>S</span><br><span class="line"><span class="keyword">Encrypted</span> <span class="keyword">Password</span>: <span class="meta">$1</span>$phz1mRrj$<span class="pgsql"><span class="number">3</span>ok6BjeaoJYWDBsEPZb5C0</span></span><br><span class="line"><span class="pgsql">Cleartext <span class="keyword">Password</span>: extmail</span></span><br><span class="line"><span class="pgsql"><span class="keyword">Options</span>: (<span class="keyword">none</span>)</span></span><br></pre></td></tr></table></figure>

<p>这样表明ExtMan的正确安装,数据库也正确导入,courier-authlib能正确连接到mysql数据库.</p>
<p>最后访问 <code>http://mail.centos.bz/extmail/</code>,如无意外,将看到webmail的登陆页,不过此时还没有加正式的用户,所以不能登陆,包括<a href="mailto:&#x70;&#111;&#115;&#116;&#109;&#x61;&#x73;&#116;&#x65;&#114;&#64;&#101;&#x78;&#116;&#109;&#97;&#105;&#x6c;&#x2e;&#x6f;&#114;&#x67;">&#x70;&#111;&#115;&#116;&#109;&#x61;&#x73;&#116;&#x65;&#114;&#64;&#101;&#x78;&#116;&#109;&#97;&#105;&#x6c;&#x2e;&#x6f;&#114;&#x67;</a>也不行.必须要登陆到 <code>http://mail.centos.bz/extman/</code> 里增加一个新帐户才能登陆.</p>
<p>ExtMan的默认超级管理员帐户:<a href="mailto:&#114;&#111;&#x6f;&#116;&#x40;&#101;&#x78;&#x74;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#111;&#114;&#103;">&#114;&#111;&#x6f;&#116;&#x40;&#101;&#x78;&#x74;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#111;&#114;&#103;</a>,初始密码:extmail<em>123</em>,登陆成功后,建议将密码修改,以确保安全.</p>
<p>配置图形化日志:</p>
<p>启动mailgraph_ext:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mailgraph_ext/m</span>ailgraph-init start</span><br></pre></td></tr></table></figure>

<p>启动cmdserver(在后台显示系统信息):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman<span class="regexp">/daemon/</span>cmdserver --daemon</span><br></pre></td></tr></table></figure>

<p>加入开机自启动:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;/usr/local/mailgraph_ext/mailgraph-init start&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>rc.d/rc.local</span><br><span class="line">echo <span class="string">&quot;/var/www/extsuite/extman/daemon/cmdserver -v -d&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>使用方法: 等待大约15分钟左右,如果邮件系统有一定的流量,即可登陆到extman里,点”图形日志”即可看到图形化的日志.具体每天,周,月,年的则点击相应的图片进入即可.</p>
<p>8、配置cyrus-sasl</p>
<p>安装cyrus-sasl:</p>
<p>删除系统的cyrus-sasl:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">rpm -e cyrus-sasl <span class="comment">--nodeps</span></span><br></pre></td></tr></table></figure>

<p>安装新的支持authdaemon的软件包:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> cyrus-sasl cyrus-sasl-plain</span><br></pre></td></tr></table></figure>

<p>配置main.cf文件:</p>
<p>Postfix的SMTP认证需要透过Cyrus-SASL,连接到authdaemon获取认证信息.</p>
<p>编辑main.cf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>postfix/main.cf</span><br></pre></td></tr></table></figure>

<p>增加如下内容:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># smtpd related config</span></span><br><span class="line"><span class="attr">smtpd_recipient_restrictions</span> =<span class="string"></span></span><br><span class="line">        <span class="attr">permit_mynetworks,</span></span><br><span class="line">        <span class="attr">permit_sasl_authenticated,</span></span><br><span class="line">        <span class="attr">reject_non_fqdn_hostname,</span></span><br><span class="line">        <span class="attr">reject_non_fqdn_sender,</span></span><br><span class="line">        <span class="attr">reject_non_fqdn_recipient,</span></span><br><span class="line">        <span class="attr">reject_unauth_destination,</span></span><br><span class="line">        <span class="attr">reject_unauth_pipelining,</span></span><br><span class="line">        <span class="attr">reject_invalid_hostname,</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># SMTP sender login matching config</span></span><br><span class="line"><span class="attr">smtpd_sender_restrictions</span> =<span class="string"></span></span><br><span class="line">        <span class="attr">permit_mynetworks,</span></span><br><span class="line">        <span class="attr">reject_sender_login_mismatch,</span></span><br><span class="line">        <span class="attr">reject_authenticated_sender_login_mismatch,</span></span><br><span class="line">        <span class="attr">reject_unauthenticated_sender_login_mismatch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">smtpd_sender_login_maps</span> =<span class="string"></span></span><br><span class="line">        <span class="attr">mysql</span>:<span class="string">/etc/postfix/mysql_virtual_sender_maps.cf,</span></span><br><span class="line">        <span class="attr">mysql</span>:<span class="string">/etc/postfix/mysql_virtual_alias_maps.cf</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># SMTP AUTH config here</span></span><br><span class="line"><span class="attr">broken_sasl_auth_clients</span> = <span class="string">yes</span></span><br><span class="line"><span class="attr">smtpd_sasl_auth_enable</span> = <span class="string">yes</span></span><br><span class="line"><span class="attr">smtpd_sasl_local_domain</span> = <span class="string">$myhostname</span></span><br><span class="line"><span class="attr">smtpd_sasl_security_options</span> = <span class="string">noanonymous</span></span><br></pre></td></tr></table></figure>

<p>编辑smtpd.conf文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>lib<span class="regexp">/sasl2/</span>smtpd.conf</span><br></pre></td></tr></table></figure>

<p>确保其内容为:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">pwcheck_method:</span> authdaemond</span><br><span class="line"><span class="symbol">log_level:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">mech_list:</span> PLAIN LOGIN</span><br><span class="line"><span class="symbol">authdaemond_path:</span><span class="meta-keyword">/var/</span>spool<span class="meta-keyword">/authdaemon/</span>socket</span><br></pre></td></tr></table></figure>

<p>重新启动postfix:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">service <span class="built_in">postfix</span> <span class="built_in">restart</span></span><br></pre></td></tr></table></figure>

<p>测试SMTP认证:</p>
<p>通过以下命令获得<a href="mailto:&#112;&#111;&#115;&#116;&#109;&#x61;&#115;&#x74;&#101;&#x72;&#64;&#x65;&#120;&#116;&#109;&#97;&#x69;&#x6c;&#x2e;&#x6f;&#x72;&#103;">&#112;&#111;&#115;&#116;&#109;&#x61;&#115;&#x74;&#101;&#x72;&#64;&#x65;&#120;&#116;&#109;&#97;&#x69;&#x6c;&#x2e;&#x6f;&#x72;&#103;</a>的用户名及密码的BASE64编码:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">perl</span> -e &#x27;use MIME::Base<span class="number">64</span>; print encode_base<span class="number">64</span>(<span class="string">&quot;postmaster@extmail.org&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>内容如下:</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">c<span class="name">G9</span>zd<span class="name">G1</span>hc<span class="number">3</span>RlckBleHRtYWlsL<span class="name">m9</span>yZw==</span><br><span class="line"></span><br><span class="line">perl -e <span class="string">&#x27;use MIME::Base64; print encode_base64(&quot;extmail&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p>内容如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ZXh0bWFpbA</span>==</span><br></pre></td></tr></table></figure>

<p>然后本机测试:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">telnet</span> localhost <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>其过程如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Trying</span> <span class="number">127.0.0.1</span>…</span><br><span class="line"><span class="attribute">Connected</span> to localhost.localdomain (<span class="number">127.0.0.1</span>).</span><br><span class="line"><span class="attribute">Escape</span> character is &#x27;^]&#x27;.</span><br><span class="line"><span class="attribute">220</span> mail.extmail.org ESMTP Postfix – by extmail.org</span><br><span class="line"><span class="attribute">ehlo</span> demo.domain.tld &lt;&lt; 输入内容</span><br><span class="line"><span class="attribute">250</span>-mail.extmail.org</span><br><span class="line"><span class="attribute">250</span>-PIPELINING</span><br><span class="line"><span class="attribute">250</span>-SIZE <span class="number">10240000</span></span><br><span class="line"><span class="attribute">250</span>-VRFY</span><br><span class="line"><span class="attribute">250</span>-ETRN</span><br><span class="line"><span class="attribute">250</span>-AUTH LOGIN PLAIN</span><br><span class="line"><span class="attribute">250</span>-AUTH=LOGIN PLAIN</span><br><span class="line"><span class="attribute">250</span>-ENHANCEDSTATUScoolcodeS</span><br><span class="line"><span class="attribute">250</span>-<span class="number">8</span>BITMIME</span><br><span class="line"><span class="attribute">250</span> DSN</span><br><span class="line"><span class="attribute">auth</span> login &lt;&lt; 输入内容</span><br><span class="line"><span class="attribute">334</span> VXNlcm<span class="number">5</span>hbWU<span class="number">6</span></span><br><span class="line"><span class="attribute">cG9zdG1hc3RlckBleHRtYWlsLm9yZw</span>== &lt;&lt; 输入内容</span><br><span class="line"><span class="attribute">334</span> UGFzc<span class="number">3</span>dvcmQ<span class="number">6</span></span><br><span class="line"><span class="attribute">ZXh0bWFpbA</span>== &lt;&lt; 输入内容</span><br><span class="line"><span class="attribute">235</span> <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span> Authentication successful</span><br><span class="line"><span class="attribute">quit</span> &lt;&lt; 输入内容</span><br><span class="line"><span class="attribute">221</span> <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span> Bye</span><br></pre></td></tr></table></figure>

<p>最后出现235 Authentication Successful 表明认证成功了.</p>
<p>9、配置courier-imap</p>
<p>安装Courier-imap:</p>
<p>默认的courier-authlib及courier-imap都会增加系统自启动设置,因此下一次服务器启动将自动启动相应的authlib及POP3服务.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> courier-imap</span><br></pre></td></tr></table></figure>

<p>10、配置courier-imap</p>
<p>由于Courier-imap的IMAP目录是按UTF-7编码的,ExtMail目前还没有正式支持IMAP目录,因此需要屏蔽IMAP,只提供 pop3服务.而就目前的使用情况来看,IMAP使用的非常少,绝大部分OutLook/Foxmail用户都习惯使用POP3而非IMAP.<br>编辑文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>lib<span class="regexp">/courier-imap/</span>etc/imapd</span><br></pre></td></tr></table></figure>

<p>修改内容如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">IMAPDSTART</span>=<span class="literal">NO</span></span><br></pre></td></tr></table></figure>

<p>编辑文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>lib<span class="regexp">/courier-imap/</span>etc/imapd-ssl</span><br></pre></td></tr></table></figure>

<p>修改内容如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">IMAPDSSLSTART</span>=<span class="literal">NO</span></span><br></pre></td></tr></table></figure>

<p>然后重新启动courier-imap:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service courier-imap <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>测试POP3 请按如下步骤输入pop3命令测试其是否正常工作,注意蓝色的信息是我们输入到POP3服务器的(请首先登录extman自行建立<a href="mailto:&#x74;&#101;&#x73;&#116;&#64;&#x65;&#120;&#116;&#x6d;&#x61;&#105;&#108;&#46;&#111;&#114;&#103;">&#x74;&#101;&#x73;&#116;&#64;&#x65;&#120;&#116;&#x6d;&#x61;&#105;&#108;&#46;&#111;&#114;&#103;</a>用户,密码:extmail).</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">telnet</span> localhost <span class="number">110</span></span><br></pre></td></tr></table></figure>

<p>其过程如下:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Trying <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>…</span><br><span class="line">Connected <span class="keyword">to</span> localhost.localdomain (<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>).</span><br><span class="line"><span class="keyword">Escape</span> <span class="type">character</span> <span class="keyword">is</span> <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">+OK Hello there.</span><br><span class="line"><span class="keyword">user</span> test@extmail.org &lt;&lt; 输入内容</span><br><span class="line">+OK <span class="keyword">Password</span> required.</span><br><span class="line">pass extmail &lt;&lt; 输入内容</span><br><span class="line">+OK <span class="keyword">logged</span> <span class="keyword">in</span>.</span><br><span class="line">list &lt;&lt; 输入内容</span><br><span class="line">+OK POP3 clients that break here, they violate STD53.</span><br><span class="line">.</span><br><span class="line">quit &lt;&lt; 输入内容</span><br><span class="line">+OK Bye-bye.</span><br><span class="line"><span class="keyword">Connection</span> closed <span class="keyword">by</span> <span class="keyword">foreign</span> host.</span><br></pre></td></tr></table></figure>

<p>11、最后说明</p>
<p>至此,ExtMail的安装配置基本完成,如想配置内容,病毒过滤请到官方网站学习配置.登录extmail系统后台后,请及时修改密码或者用户名.最后需要确认的是,是否已经设置好邮件域名的MX记录或者A记录,这样才能正常收取邮件.</p>
<p>域名解析实例:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line">主机名  	网络  	优先级  	对应<span class="type">MAIL</span>主机名</span><br><span class="line">空	默认 	<span class="number">6</span> 	mail.dovao.com                           &lt;-<span class="comment">--mail解析</span></span><br><span class="line"></span><br><span class="line">主机名  	网络  	<span class="type">IP</span>地址</span><br><span class="line"><span class="title">mail</span>  	默认  	<span class="number">173.44</span><span class="number">.135</span><span class="number">.19</span>                            &lt;-<span class="comment">--A记录解析</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Centos6.5 安装 RabbitMQ3.6.1</title>
    <url>/2017/06/14/1089/</url>
    <content><![CDATA[<p>安装编译工具:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">yum -<span class="keyword">y</span> install <span class="keyword">make</span> gcc gcc-<span class="keyword">c</span>++ kernel-devel m4 ncurses-devel openssl-devel <span class="keyword">perl</span></span><br></pre></td></tr></table></figure>

<p>安装Erlang:</p>
<p>1.下载erlang</p>
<p>官方下载地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>erlang.org<span class="regexp">/download/</span>otp_src_18.<span class="number">3</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>2.安装</p>
<p>解压:<br>tar xvf otp_src_18.3.tar.gz<br>cd otp_src_18.3</p>
<p>配置 ‘–prefix’指定的安装目录:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="keyword">local</span>/erlang --with-ssl -<span class="keyword">enable</span>-threads -<span class="keyword">enable</span>-smmp-support -<span class="keyword">enable</span>-kernel-poll --<span class="keyword">enable</span>-hipe --without-javac</span><br></pre></td></tr></table></figure>

<p>安装:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make</span> &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>

<p>3.配置erlang环境变量</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>在文件末尾添加下面代码 ‘ERLANG_HOME’等于上一步’–prefix’指定的目录:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ERLANG_HOME</span>=/usr/local/erlang</span><br><span class="line"><span class="attribute">PATH</span>=<span class="variable">$ERLANG_HOME</span>/bin:$PATH</span><br><span class="line"><span class="builtin-name">export</span> ERLANG_HOME</span><br><span class="line"><span class="builtin-name">export</span> PATH</span><br></pre></td></tr></table></figure>

<p>使环境变量生效:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>输入命令检验是否安装成功:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">erl</span></span><br></pre></td></tr></table></figure>

<p>有输出表示安装成功.</p>
<p>安装RabbitMQ</p>
<p>1.下载RabbitMQ</p>
<p>官方下载地址:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://www.rabbitmq.com/releases/rabbitmq-server/v<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span>/rabbitmq-server-generic-unix-<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span>.tar.xz</span><br></pre></td></tr></table></figure>

<p>2.安装</p>
<p>RabbitMQ3.6版本无需make、make install 解压就可以用.<br>解压rabbitmq,官方给的包是xz压缩包,所以需要使用xz命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">xz</span> -d rabbitmq-server-generic-unix-<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span>.tar.xz</span><br></pre></td></tr></table></figure>

<p>xz解压后得到.tar包,再用tar命令解压:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -xvf rabbitmq-server-generic-unix-<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span>.tar</span><br></pre></td></tr></table></figure>

<p>移动目录 看个人喜好:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp -rf .<span class="regexp">/rabbitmq_server-3.6.1 /u</span>sr<span class="regexp">/local/</span></span><br><span class="line">cd <span class="regexp">/usr/</span>local/</span><br></pre></td></tr></table></figure>

<p>修改文件夹名:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mv</span> rabbitmq_server-<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span> rabbitmq-<span class="number">3</span>.<span class="number">6</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>开启管理页面插件:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">./rabbitmq-3.6.1/sbin/</span></span><br><span class="line"><span class="string">./rabbitmq-plugins</span> enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>3.启动</p>
<p>启动命令,该命令ctrl+c后会关闭服务:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">./rabbitmq-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>在后台启动Rabbit:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">./rabbitmq-<span class="keyword">server</span> -detached</span><br></pre></td></tr></table></figure>

<p>关闭服务:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">./rabbitmqctl stop</span><br></pre></td></tr></table></figure>

<p>关闭服务(kill) 找到rabbitmq服务的pid   [不推荐]</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">ps -ef|<span class="keyword">grep</span> rabbitmq</span><br><span class="line"><span class="keyword">kill</span> -<span class="number">9</span> ****</span><br></pre></td></tr></table></figure>

<p>4.添加管理员账号</p>
<p>进入RabbitMQ安装目录:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/rabbitmq-3.6.1/</span>sbin</span><br></pre></td></tr></table></figure>

<p>添加用户:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment">#rabbitmqctl add_user Username Password</span></span><br><span class="line"><span class="string">./rabbitmqctl</span> add_user rabbitadmin 123456</span><br></pre></td></tr></table></figure>

<p>分配用户标签:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment">#rabbitmqctl set_user_tags User Tag</span></span><br><span class="line"><span class="comment">#[administrator]:管理员标签</span></span><br><span class="line"><span class="string">./rabbitmqctl</span> <span class="keyword">set</span>_user_tags rabbitadmin administrator</span><br></pre></td></tr></table></figure>

<p>5.登录管理界面</p>
<p>浏览器输入地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>服务器IP地址:<span class="number">15672</span>/</span><br></pre></td></tr></table></figure>

<p>输入第4部添加的账号密码登录.</p>
<p>其他问题</p>
<p>1.访问不了</p>
<p>安装完成之后如果机器有iptables,需要开放端口</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment">#RabbitMQ</span></span><br><span class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">15672</span> -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">25672</span> -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">5672</span> -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">4369</span> -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">5671</span> -j ACCEPT</span><br><span class="line"><span class="comment">#RabbitMQ</span></span><br></pre></td></tr></table></figure>

<p>RabbitMQ常用端口(摘自网络)</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">4369 </span>(epmd), </span><br><span class="line"><span class="symbol">25672 </span>(Erlang distribution) </span><br><span class="line"><span class="number">5672</span>, <span class="number">5671</span> (AMQP <span class="number">0</span>-<span class="number">9</span>-<span class="number">1</span> without <span class="keyword">and</span> with TLS) </span><br><span class="line"><span class="symbol">15672 </span>(<span class="keyword">if</span> management plugin is enabled) </span><br><span class="line"><span class="number">61613</span>, <span class="number">61614</span> (<span class="keyword">if</span> STOMP is enabled) </span><br><span class="line"><span class="number">1883</span>, <span class="number">8883</span> (<span class="keyword">if</span> MQTT is enabled)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos6.8 可用yum源</title>
    <url>/2019/05/29/1090/</url>
    <content><![CDATA[<p>亲测可用的网易源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="number">6</span> - Base - <span class="number">163</span>.com</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/centos/</span><span class="number">6</span><span class="regexp">/os/</span><span class="variable">$basearch</span>/</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=6&amp;arch=$basearch&amp;repo=os</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">6</span></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="number">6</span> - Updates - <span class="number">163</span>.com</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/centos/</span><span class="number">6</span><span class="regexp">/updates/</span><span class="variable">$basearch</span>/</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=6&amp;arch=$basearch&amp;repo=updates</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">6</span></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="number">6</span> - Extras - <span class="number">163</span>.com</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/centos/</span><span class="number">6</span><span class="regexp">/extras/</span><span class="variable">$basearch</span>/</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=6&amp;arch=$basearch&amp;repo=extras</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">6</span></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="number">6</span> - Plus - <span class="number">163</span>.com</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/centos/</span><span class="number">6</span><span class="regexp">/centosplus/</span><span class="variable">$basearch</span>/</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=6&amp;arch=$basearch&amp;repo=centosplus</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">6</span></span><br><span class="line"><span class="comment">#contrib - packages by Centos Users</span></span><br><span class="line">[contrib]</span><br><span class="line">name=CentOS-<span class="number">6</span> - Contrib - <span class="number">163</span>.com</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/centos/</span><span class="number">6</span><span class="regexp">/contrib/</span><span class="variable">$basearch</span>/</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=6&amp;arch=$basearch&amp;repo=contrib</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rror.centos.org<span class="regexp">/centos/</span>RPM-GPG-KEY-CentOS-<span class="number">6</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos6安装和配置Xen</title>
    <url>/2019/04/27/1093/</url>
    <content><![CDATA[<p>centos 6安装xen并不像centos 5那样轻松,因为在centos 6中,官方源已经去除了xen的rpm包,只能使用第三方源或自行编译,这里推荐使用第三方源,编译安装要解决的问题比较多.还有一个包libvirt,这个是管理xen的api,官方的这个包已经不支持xen,并且是0.9版的需要更高版本的iptables支持,所以libvirt需要编译安装.<br>下面是在CentOS 6 64位系统进行安装配置Xen.</p>
<p>1、安装Xen及内核</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -Uvh http://www.crc.id.au/repo/x<span class="number">86</span>_<span class="number">64</span>/kernel-xen-release-<span class="number">6</span>-<span class="number">3</span>.noarch.rpm //导入第三方源安装Xen</span><br><span class="line"><span class="attribute">yum</span> install bridge-utils //安装网桥设置工具</span><br><span class="line"><span class="attribute">yum</span> install kernel-xen xen //安装xen及内核</span><br></pre></td></tr></table></figure>

<p>2、配置grub引导xen内核</p>
<p>xen内核安装后,会自动插入引导xen内核代码到 <code>/boot/grub/grub.conf</code>文件,但还需要进行相应的修改.<br>修改后引导xen内核的代码如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">title</span> CentOS (<span class="number">2.6.32.56</span>-<span class="number">1</span>.el<span class="number">6</span>xen.x<span class="number">86</span>_<span class="number">64</span>)</span><br><span class="line"><span class="attribute">root</span> (hd<span class="number">0</span>,<span class="number">7</span>)</span><br><span class="line"><span class="attribute">kernel</span> /xen.gz dom<span class="number">0</span>_mem=<span class="number">1024</span>M loglvl=<span class="literal">all</span> guest_loglvl=<span class="literal">all</span></span><br><span class="line"><span class="attribute">module</span> /vmlinuz-<span class="number">2.6.32.56</span>-<span class="number">1</span>.el<span class="number">6</span>xen.x<span class="number">86</span>_<span class="number">64</span> ro root=/dev/mapper/VolGroup-LogVol<span class="number">00</span> rd_LVM_LV=VolGroup/LogVol<span class="number">00</span> nomodeset</span><br><span class="line"><span class="attribute">module</span> /initramfs-<span class="number">2.6.32.56</span>-<span class="number">1</span>.el<span class="number">6</span>xen.x<span class="number">86</span>_<span class="number">64</span>.img</span><br></pre></td></tr></table></figure>
<p>这段代码仅够参考,不一定适用于你的配置.</p>
<p>3、关闭selinux</p>
<p>这是必须关闭的,要不会因为selinux的安全机制导致xen无法正常工作.<br>编辑selinux配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/selinux</span><br></pre></td></tr></table></figure>

<p>修改为如下:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="meta"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="meta"># enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="meta"># permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="meta"># disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"><span class="meta"># SELINUXTYPE= can take one of these two values:</span></span><br><span class="line"><span class="meta"># targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="meta"># mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure>

<p>还有一点配置也很重要,就是禁止netmanager接管网络,因为这个工具不支持网桥管理.<br>在 <code>/etc/sysconfig/network-script/ifcfg-eth0</code>中加入:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">NM_CONTROLLED</span>=<span class="literal">no</span></span><br></pre></td></tr></table></figure>

<p>4、重启引导进入xen内核</p>
<p>引导后执行xm info测试:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@localhost</span> <span class="string">~</span>]<span class="comment"># xm info</span></span><br><span class="line"><span class="attr">host :</span> <span class="string">localhost.localdomain</span></span><br><span class="line"><span class="attr">release :</span> <span class="number">2.6</span><span class="number">.32</span><span class="number">.56</span><span class="number">-1.</span><span class="string">el6xen.x86_64</span></span><br><span class="line"><span class="attr">version :</span> <span class="comment">#1 SMP Mon Feb 20 13:03:03 EST 2012</span></span><br><span class="line"><span class="attr">machine :</span> <span class="string">x86_64</span></span><br><span class="line"><span class="attr">nr_cpus :</span> <span class="number">4</span></span><br><span class="line"><span class="attr">nr_nodes :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">cores_per_socket :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">threads_per_core :</span> <span class="number">2</span></span><br><span class="line"><span class="attr">cpu_mhz :</span> <span class="number">2394</span></span><br><span class="line"><span class="attr">hw_caps :</span> <span class="string">bfebfbff:28100800:00000000:00003f40:009ae3bd:00000000:00000001:00000000</span></span><br><span class="line"><span class="attr">virt_caps :</span> <span class="string">hvm</span></span><br><span class="line"><span class="attr">total_memory :</span> <span class="number">1972</span></span><br><span class="line"><span class="attr">free_memory :</span> <span class="number">412</span></span><br><span class="line"><span class="attr">free_cpus :</span> <span class="number">0</span></span><br><span class="line"><span class="attr">xen_major :</span> <span class="number">4</span></span><br><span class="line"><span class="attr">xen_minor :</span> <span class="number">1</span></span><br><span class="line"><span class="attr">xen_extra :</span> <span class="number">.2</span></span><br><span class="line"><span class="attr">xen_caps :</span> <span class="string">xen-3.0-x86_64</span> <span class="string">xen-3.0-x86_32p</span> <span class="string">hvm-3.0-x86_32</span> <span class="string">hvm-3.0-x86_32p</span> <span class="string">hvm-3.0-x86_64</span></span><br><span class="line"><span class="attr">xen_scheduler :</span> <span class="string">credit</span></span><br><span class="line"><span class="attr">xen_pagesize :</span> <span class="number">4096</span></span><br><span class="line"><span class="attr">platform_params :</span> <span class="string">virt_start=0xffff800000000000</span></span><br><span class="line"><span class="attr">xen_changeset :</span> <span class="string">unavailable</span></span><br><span class="line"><span class="attr">xen_commandline :</span> <span class="string">dom0_mem=1024M</span> <span class="string">loglvl=all</span> <span class="string">guest_loglvl=all</span></span><br><span class="line"><span class="attr">cc_compiler :</span> <span class="string">gcc</span> <span class="string">version</span> <span class="number">4.4</span><span class="number">.6</span> <span class="number">20110731</span> <span class="string">(Red</span> <span class="string">Hat</span> <span class="number">4.4</span><span class="number">.6</span><span class="number">-3</span><span class="string">)</span> <span class="string">(GCC)</span></span><br><span class="line"><span class="attr">cc_compile_by :</span> <span class="string">mockbuild</span></span><br><span class="line"><span class="attr">cc_compile_domain :</span> <span class="string">crc.id.au</span></span><br><span class="line"><span class="attr">cc_compile_date :</span> <span class="string">Mon</span> <span class="string">Feb</span> <span class="number">20</span> <span class="number">12</span><span class="string">:52:37</span> <span class="string">EST</span> <span class="number">2012</span></span><br><span class="line"><span class="attr">xend_config_format :</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>5、安装api管理工具</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> virt-<span class="keyword">install</span> virt-viewer</span><br></pre></td></tr></table></figure>

<p>6、编译安装libvirt</p>
<p>因为rpm安装的libvirt不支持xen连接,所以我们使用编译安装.还有版本也不能选择高的,不然可能会因为iptables的版本低而不能使用libvirt.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">yum install gcc xen-devel libxml2-devel gnutls-devel device-mapper-devel libnl-devel make</span><br><span class="line"><span class="keyword">cd</span> <span class="string">/tmp</span></span><br><span class="line">wget http:<span class="string">//libvirt.org/sources/libvirt-0.8.1.tar.gz</span></span><br><span class="line">tar xzf libvirt-0.8.1.tar.gz</span><br><span class="line"><span class="keyword">cd</span> libvirt-0.8.1</span><br><span class="line"><span class="string">./configure</span> <span class="params">--with-xen</span> <span class="params">--with-xen-inotify</span> <span class="params">--with-libvirtd</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>然后打开 <code>/usr/local/etc/libvirt/libvirtd.conf</code>文件,删除 <code>unix_sock_dir = &quot;/var/run/libvirt&quot;</code>前面的注释,并创建 <code>/var/run/libvirt</code>目录.<br>之后启动libvirtd,并设置开机启动</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">libvirtd -d</span><br><span class="line">echo <span class="string">&quot;/usr/local/sbin/libvirtd -d&quot;</span> &gt;&gt;<span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>7、安装xen guest</p>
<p>我们这里使用virt-install工具进行guest的安装,当然你也可以使用xm命令安装,不过相对麻烦点.<br>可以执行 <code>virt-install –help</code>学习这工具的使用方法.<br>下面是安装guest的示例</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">virt</span>-install -n CentOSVM<span class="number">1</span> -r <span class="number">512</span> -f /xen/CentOSVM<span class="number">1</span>.img -l http://www/ –network=network:default -s <span class="number">10</span> –nographics –vcpus=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>或者使用交互式安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">virt-install --prompt</span><br><span class="line"></span><br><span class="line">-n CentOSVM1 设置虚拟服务器名称</span><br><span class="line">-r <span class="number">512</span> 设置内存大小</span><br><span class="line">-f <span class="regexp">/xen/</span>CentOSVM1.img 虚拟磁盘文件的保存路径,如果有重名可以使用–force参数强制重建.</span><br><span class="line">-l http:<span class="regexp">//</span>www<span class="regexp">/ 安装文件的访问方式,支持nfs http ftp smb等多种方式.如果你对你的带宽比较自信,可以使用http:/</span><span class="regexp">/mirrors.163.com/</span>centos<span class="regexp">/5.5/</span>os<span class="regexp">/i386/</span>网易的镜像站</span><br><span class="line">–network=network:default 网络连接方式,我选择的是route中的default</span><br><span class="line">-s <span class="number">10</span>磁盘文件的大小,单位是G</span><br><span class="line">–nographics 不使用图形界面,可以不加此参数,然后加–vnc看看图形效果</span><br><span class="line">–vcpus=<span class="number">2</span> 虚拟CPU的个数</span><br></pre></td></tr></table></figure>

<p>在执行virt-install命令安装系统之前,先确定你的安装源,支持nfs http ftp smb等多种方式,宽带大的话,可以使用http直接连接远程安装源,比如mirror.163.com.<br>我这里adsl上网的,本地已经下载有iso文件了,所以在本地架设个http服务器进行安装.</p>
<p>1、挂载iso文件到/iso目录,这个目录必须存在.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mount</span> -o loop CentOS-<span class="number">6</span>.<span class="number">2</span>-x<span class="number">86</span>_<span class="number">64</span>-minimal.iso /iso</span><br></pre></td></tr></table></figure>

<p>2、安装httpd服务器,我这里安装apache.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> httpd</span><br><span class="line">service httpd start</span><br></pre></td></tr></table></figure>

<p>3、创建软链接或直接复制文件到apache根目录 <code>/var/www/html</code>,如果你的centos 6.2是完整版,只需要做个软链接,如果下载的是精简版,也就是minimal,需要复制全部文件到根目录,因为.treeinfo这个文件需要相应的修改.</p>
<p>centos 6.2完整版:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/iso /</span>var<span class="regexp">/www/</span>html</span><br></pre></td></tr></table></figure>

<p>centos 6.2精简版:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp -R <span class="regexp">/iso /</span>var<span class="regexp">/www/</span>html</span><br></pre></td></tr></table></figure>

<p>修改.treeinfo文件,如:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[general]</span></span><br><span class="line"><span class="attr">family</span> = CentOS</span><br><span class="line"><span class="attr">timestamp</span> = <span class="number">1323560005.81</span></span><br><span class="line"><span class="attr">variant</span> =</span><br><span class="line"><span class="attr">totaldiscs</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">version</span> = <span class="number">6.2</span></span><br><span class="line"><span class="attr">discnum</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">packagedir</span> =</span><br><span class="line"><span class="attr">arch</span> = x<span class="number">86_64</span></span><br><span class="line"><span class="section">[images-x86_64]</span></span><br><span class="line"><span class="attr">kernel</span> = isolinux/vmlinuz</span><br><span class="line"><span class="attr">initrd</span> = isolinux/initrd.img</span><br><span class="line"><span class="section">[images-xen]</span></span><br><span class="line"><span class="attr">kernel</span> = isolinux/vmlinuz</span><br><span class="line"><span class="attr">initrd</span> = isolinux/initrd.img  </span><br><span class="line"><span class="section">[stage2]</span></span><br><span class="line"><span class="attr">mainimage</span> = images/install.img</span><br></pre></td></tr></table></figure>

<p>4、在安装之前,需要暂时关闭iptables,否则安装过程中会无法取得相应文件.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure>

<p>5、开始使用virt-install安装</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">virt</span>-install -n centos<span class="number">6</span> -r <span class="number">512</span> -f /xen/CentOSVM<span class="number">1</span>.img -l http://<span class="number">192.168.1.100</span>/iso --network=network:default -s <span class="number">4</span> --vcpus=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>之后会自动调用virt-viewer工具显示安装界面.</p>
<p>6、启动guest centos6</p>
<p>安装完成后会要求重启,这时guest关闭之后不会自动启动,需要使用xm start命令启动:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">xm</span> start centos<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>开启iptables.<br>之前为了连接安装源,暂时关闭了iptables,现在需要启动iptables,否则guest无法连接外网.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service iptables <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>8、使用virt-viewer管理guest</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">virt</span>-viewer centos<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>执行这条命令即可连接虚拟机centos6进行管理了,当然也可以直接使用ssh连接更简单.<br>另外,我安装过virt-manager来安装guest,但到创建域时就出现KeyError错误,不知道如何解决,有懂的告诉一声.</p>
]]></content>
  </entry>
  <entry>
    <title>centos6.4更新163源</title>
    <url>/2014/01/02/1088/</url>
    <content><![CDATA[<p>1.备份现在的源文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mv <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/CentOS-Base.repo /</span>etc<span class="regexp">/yum.repos.d/</span>CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure>

<p>2.下载163源</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/etc/yum</span>.repos.d/</span><br><span class="line">wget http:<span class="regexp">//mi</span>rrors.<span class="number">163</span>.com<span class="regexp">/.help/</span>CentOS6-Base-<span class="number">163</span>.repo</span><br></pre></td></tr></table></figure>

<p>3.把下载文件改成源文件</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mv</span> CentOS<span class="number">6</span>-Base-<span class="number">163</span>.repo CentOS-Base.repo</span><br></pre></td></tr></table></figure>

<p>4.更新列表</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum makecache</span></span><br></pre></td></tr></table></figure>

<p>5.更新系统</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum update</span> </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Centos6.8搭建Git服务(git版本可选)</title>
    <url>/2011/12/30/1091/</url>
    <content><![CDATA[<p>搭建Git服务器需要准备一台运行Linux的机器,本文以Centos6.8纯净版系统为例搭建自己的Git服务.<br>准备工作:以root用户登陆自己的Linux服务器.</p>
<p>第一步安装依赖库:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> yum install <span class="built_in">curl</span><span class="literal">-devel</span> expat<span class="literal">-devel</span> gettext<span class="literal">-devel</span> openssl<span class="literal">-devel</span> zlib<span class="literal">-devel</span></span><br><span class="line"><span class="variable">$</span> yum install  gcc perl<span class="literal">-ExtUtils</span><span class="literal">-MakeMaker</span></span><br></pre></td></tr></table></figure>

<p>第二步卸载旧版git:</p>
<p>加入原先有用yum安装过git,则需要先卸载一下:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">$ yum <span class="builtin-name">remove</span> git</span><br></pre></td></tr></table></figure>

<p>第三步下载源码:</p>
<p>下载git-2.10.0.tar.gz到 <code>/usr/local/src</code>.<br>(查找git版本可以到<a href="https://www.kernel.org/pub/software/scm/git/">https://www.kernel.org/pub/software/scm/git/</a> 下查看git的版本号自行选择下载)</p>
<p>查看版本方法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ wget -v https:<span class="regexp">//</span>www.kernel.org<span class="regexp">/pub/</span>software<span class="regexp">/scm/gi</span>t/</span><br><span class="line">$ vi index.html</span><br></pre></td></tr></table></figure>

<p>复制想下载的版本 –&gt; Esc –&gt; :q! –&gt;  回车!<br>这里我选择下载git-2.10.0.tar.gz</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/usr/</span>local/src</span><br><span class="line">$ wget https:<span class="regexp">//</span>www.kernel.org<span class="regexp">/pub/</span>software<span class="regexp">/scm/gi</span>t/git-<span class="number">2.10</span>.<span class="number">0</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>第四步解压、编译和安装:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zvxf git-2.10.0.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> git-2.10.0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make prefix=/usr/<span class="built_in">local</span>/git all</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make prefix=/usr/<span class="built_in">local</span>/git install</span></span><br></pre></td></tr></table></figure>

<p>make prefix=/usr/local/git all编译的时候出现了错误:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"> LINK git-credential-store</span><br><span class="line">libgit.a(utf8.o): <span class="keyword">In</span> <span class="keyword">function</span> `reencode_string_iconv<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">/usr/src/git-2.8.3/utf8.c:463: undefined reference to `libiconv&#x27;</span></span><br><span class="line">libgit.a(utf8.o): <span class="keyword">In</span> <span class="keyword">function</span> `reencode_string_len<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">/usr/src/git-2.8.3/utf8.c:502: undefined reference to `libiconv_open&#x27;</span></span><br><span class="line">/usr/src/git<span class="number">-2.8</span><span class="number">.3</span>/utf8.c:<span class="number">521</span>: undefined reference <span class="keyword">to</span> `libiconv_clos<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">/usr/src/git-2.8.3/utf8.c:515: undefined reference to `libiconv_open&#x27;</span></span><br><span class="line">collect2: ld returned <span class="number">1</span> <span class="keyword">exit</span> status</span><br><span class="line">make: *** [git-credential-store] Error <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>一.安装libiconv:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/usr/</span>local/src</span><br><span class="line">$ wget http:<span class="regexp">//</span>ftp.gnu.org<span class="regexp">/pub/g</span>nu<span class="regexp">/libiconv/</span>libiconv-<span class="number">1.14</span>.tar.gz</span><br><span class="line">$ tar -zxvf libiconv-<span class="number">1.14</span>.tar.gz</span><br><span class="line">$ cd libiconv-<span class="number">1.14</span></span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>libiconv  &amp;&amp;  make  &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>二.创建一个软链接到 <code>/usr/lib</code>:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libiconv.so <span class="regexp">/usr/</span>lib</span><br><span class="line">$ ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libiconv.so.<span class="number">2</span> <span class="regexp">/usr/</span>lib</span><br></pre></td></tr></table></figure>

<p>三.然后回到git目录继续编译:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/usr/</span>local<span class="regexp">/scr/gi</span>t-<span class="number">2.8</span>.<span class="number">3</span></span><br><span class="line">$ make configure</span><br><span class="line">$ .<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/gi</span>t --with-iconv=<span class="regexp">/usr/</span>local/libiconv</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>第五步将git目录加入PATH:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ echo <span class="string">&#x27;export PATH=$PATH:/usr/local/git/bin&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>bashrc</span><br><span class="line">$ <span class="keyword">source</span> <span class="regexp">/etc/</span>bashrc</span><br></pre></td></tr></table></figure>

<p>安装成功后就可以查看到git版本了.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ git <span class="comment">--version</span></span><br><span class="line">git <span class="built_in">version</span> <span class="number">2.10</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<p>第六步创建git账号并设置密码:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">$ useradd -m git</span><br><span class="line">$ passwd git               </span><br><span class="line">Changing password <span class="keyword">for</span> user git.</span><br><span class="line"><span class="keyword">New</span> password: </span><br><span class="line">BAD PASSWORD: <span class="keyword">is</span> too simple</span><br><span class="line">Retype <span class="keyword">new</span> password: </span><br><span class="line">passwd: <span class="keyword">all</span> authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>

<p>第七步创建git仓库并初始化:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ mkdir -p <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>test.git</span><br><span class="line">$ cd <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>test.git</span><br><span class="line">[root@localhost test.git]$ git --bare init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>test.git/</span><br></pre></td></tr></table></figure>

<p>第八步给git仓库目录设置用户和用户组并设置权限:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@localhost test.git]$ chown -R git:git <span class="regexp">/home/gi</span>t/<span class="keyword">repositories</span></span><br><span class="line">[root@localhost test.git]$ chmod <span class="number">755</span> <span class="regexp">/home/gi</span>t/<span class="keyword">repositories</span></span><br></pre></td></tr></table></figure>

<p>第九步限制git账号的ssh连接:</p>
<p>查找git-shell所在目录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ whereis git-shell</span><br><span class="line">git-shell: <span class="regexp">/usr/</span>src<span class="regexp">/git-2.10.0/gi</span>t-shell</span><br></pre></td></tr></table></figure>

<p>编辑passwd文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure>

<p>找到这一行:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">git:</span><span class="symbol">x:</span><span class="number">500</span><span class="symbol">:</span><span class="number">500</span><span class="symbol">:</span><span class="symbol">:/home/git</span><span class="symbol">:/bin/bash</span> </span><br></pre></td></tr></table></figure>

<p>将最后的/bin/bash改为:git-shell的目录 <code>/usr/src/git-2.10.0/git-shell</code>,如下:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">git:</span><span class="symbol">x:</span><span class="number">500</span><span class="symbol">:</span><span class="number">500</span><span class="symbol">:</span><span class="symbol">:/home/git</span><span class="symbol">:/usr/src/git-</span><span class="number">2.10</span>.<span class="number">0</span>/git-shell</span><br><span class="line">Esc --&gt; <span class="symbol">:wq!</span> --&gt;  回车!</span><br></pre></td></tr></table></figure>

<p>完成搭建,去克隆提交试试吧!</p>
<p>clone地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ssh:<span class="regexp">//gi</span>t@服务器ip地址:端口<span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>test.git</span><br></pre></td></tr></table></figure>

<p>附加:以后每次新建仓库时,只需执行上面第七、八步即可!</p>
]]></content>
  </entry>
  <entry>
    <title>centos6安装vsftpd</title>
    <url>/2017/12/10/1092/</url>
    <content><![CDATA[<p>第一步:安装vsftpd</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> vsftpd</span><br></pre></td></tr></table></figure>

<p>没什么问题就直接安装好啦.</p>
<p>第二步:编辑vsftpd的配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>第三步:清空文件, 然后添加如下内容</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">listen</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">background</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">local_umask</span>=<span class="number">022</span></span><br><span class="line"><span class="attr">anon_upload_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">anon_mkdir_write_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">dirmessage_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">xferlog_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">connect_from_port_20</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">chown_uploads</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">xferlog_file</span>=/var/log/vsftpd.log</span><br><span class="line"><span class="attr">xferlog_std_format</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">async_abor_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ascii_upload_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ascii_download_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ftpd_banner</span>=Welcome to hao32 FTP servers</span><br><span class="line"><span class="attr">pam_service_name</span>=vsftpd</span><br><span class="line"><span class="attr">chroot_local_user</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">chroot_list_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">chroot_list_file</span>=/etc/vsftpd/vsftpd.chroot_list</span><br></pre></td></tr></table></figure>

<p>第四步:终端运行下面命令</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">touch <span class="regexp">/etc/</span>vsftpd/vsftpd.chroot_list</span><br><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure>

<p>如果出现下面这句话:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Starting</span> vsftpd for vsftpd:<span class="meta"> [ OK ]</span></span><br></pre></td></tr></table></figure>

<p>则表示成功,如果不行则用这个语句:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>xinetd restart</span><br></pre></td></tr></table></figure>

<p>ftp默认我们使用系统用户, 现在我们来添加用户ftptest, 指向目录/home/ftptest , 权限是nologin, 就是没给shell权限, 不影响ftp的.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">useradd ftptest -d <span class="regexp">/home/</span>ftptest -s /sbogin</span><br></pre></td></tr></table></figure>

<p>如果显示:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">useradd: warning: <span class="keyword">the</span> home <span class="built_in">directory</span> already exists.</span><br><span class="line">Not copying <span class="keyword">any</span> <span class="built_in">file</span> <span class="built_in">from</span> skel <span class="built_in">directory</span> <span class="keyword">into</span> <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure>

<p>不用理会, 只是告诉你, 你指向的目录已经存在了, 这不影响设置目录及其文件的属组, 你也可以使用别的分组方式.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R ftptest . ftptest <span class="regexp">/home/</span>ftptest</span><br></pre></td></tr></table></figure>

<p>设置一下用户hao32的密码, 自定义啦.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">passwd ftptest</span></span><br></pre></td></tr></table></figure>

<p>把用户 ftptest 加到/etc/vsftpd/vsftpd.chroot_list里, 这样用户就可以正常登陆并且不能跳出自己的目录.</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&#x27;ftptest&#x27;</span> &gt;&gt; <span class="regexp">/etc/</span>vsftpd/vsftpd.chroot_list</span><br><span class="line">service vsftpd restart</span><br></pre></td></tr></table></figure>

<p>测试登陆:</p>
<p>ftp主机: 服务器IP地址<br>ftp用户: ftptest<br>ftp密码: ftptest</p>
<p>如果这个时候遇到:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cannot change directory <span class="regexp">/home/</span>ftptest</span><br></pre></td></tr></table></figure>

<p>请输入以下命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">setsebool</span> -P allow_ftpd_full_access <span class="number">1</span></span><br><span class="line"><span class="attribute">service</span> vsftpd restart</span><br></pre></td></tr></table></figure>

<p>这个时候如果再遇到 java.net.SocketTimeoutException: Read timed out.</p>
<p>解决方法:</p>
<p>在服务端配置被动模式就可以从根源上解决这问题.</p>
<p>1、编辑 Vsftpd 配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>2、在最下面添加以下信息</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">pasv_enable</span>=<span class="literal">YES</span> <span class="comment">#开启被动模式</span></span><br><span class="line"><span class="attr">pasv_min_port</span>=<span class="number">4000</span> <span class="comment">#随机最小端口</span></span><br><span class="line"><span class="attr">pasv_max_port</span>=<span class="number">5000</span> <span class="comment">#随机最大端口</span></span><br></pre></td></tr></table></figure>

<p>3、加载内核 ip_conntrack_ftp 和 ip_nat_ftp(终端执行)</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">modprobe ip<span class="emphasis">_conntrack_ftp</span></span><br><span class="line"><span class="emphasis">modprobe ip_nat_</span>ftp</span><br></pre></td></tr></table></figure>

<p>4、配置 iptables 开放 4000 到 5000 端口</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables 在*filter下加入下</span><br><span class="line">-<span class="keyword">A</span> OUTPUT -p tcp --sport <span class="number">4000:5000</span> -j ACCEPT</span><br><span class="line">-<span class="keyword">A</span> INPUT -p tcp --dport <span class="number">4000:5000</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>5、加载 iptables 配置</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">iptables-restore &lt; <span class="regexp">/etc/</span>sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>6、重启 Vsftpd</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service vsftpd restart</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Centos7安装erlang</title>
    <url>/2019/08/09/1095/</url>
    <content><![CDATA[<p>安装依赖环境:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> -y install make gcc gcc-c++ kernel-devel m<span class="number">4</span> ncurses-devel　openssl-devel unixODBC-devel</span><br></pre></td></tr></table></figure>

<p>下载erlang源代码包:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.erlang.org<span class="regexp">/download/</span>otp_src_R16B03.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压软件包:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxf otp_src_R<span class="number">16</span>B<span class="number">03</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>进入目录:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> otp_src_R<span class="number">16</span>B<span class="number">03</span></span><br></pre></td></tr></table></figure>

<p>开始编译:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>erl</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>创建erlang的软连接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/erl/</span>bin<span class="regexp">/erl /u</span>sr<span class="regexp">/bin/</span>erl</span><br></pre></td></tr></table></figure>

<p>不做软连接也可以设置环境变量:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>末尾添加:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/erl/bin</span></span><br></pre></td></tr></table></figure>

<p>验证erlang安装成功:</p>
<p>输入:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">erl</span></span><br></pre></td></tr></table></figure>

<p>出现:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Erlang</span>/<span class="selector-tag">OTP</span> <span class="selector-tag">20</span> <span class="selector-attr">[erts-9.0]</span> <span class="selector-attr">[source]</span> <span class="selector-attr">[64-bit]</span> <span class="selector-attr">[smp:1:1]</span> <span class="selector-attr">[ds:1:1:10]</span> <span class="selector-attr">[async-threads:10]</span> <span class="selector-attr">[kernel-poll:false]</span> </span><br><span class="line"><span class="selector-tag">Eshell</span> <span class="selector-tag">V9</span><span class="selector-class">.0</span> (abort with ^G)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Centos7 部署kubernetes+docker+flannel+dashboard集群环境</title>
    <url>/2019/08/21/1094/</url>
    <content><![CDATA[<p>一、Kubernetes简介</p>
<p>Kubernetes(简称K8S)是开源的容器集群管理系统,可以实现容器集群的自动化部署、自动扩缩容、维护等功能.它既是一款容器编排工具,也是全新的基于容器技术的分布式架构领先方案.在Docker技术的基础上,为容器化的应用提供部署运行、资源调度、服务发现和动态伸缩等功能,提高了大规模容器集群管理的便捷性.</p>
<p>K8S集群中有管理节点与工作节点两种类型.管理节点主要负责K8S集群管理,集群中各节点间的信息交互、任务调度,还负责容器、Pod、NameSpaces、PV等生命周期的管理.工作节点主要为容器和Pod提供计算资源,Pod及容器全部运行在工作节点上,工作节点通过kubelet服务与管理节点通信以管理容器的生命周期,并与集群其他节点进行通信.</p>
<p>二、安装环境配置(下步骤在所有主机上都需执行)</p>
<p>1.在安装之前,需要先做如下准备.三台CentOS 7主机:</p>
<p>在各自主机上设置主机名:</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">hostnamectl</span> <span class="built_in">set-hostname</span> <span class="string">k8s-1</span> <span class="comment"># 根据不同主机设置主机名</span></span><br></pre></td></tr></table></figure>

<p>或者修改配置文件永久修改自己的主机名,通过下面的步骤修改文件.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/sysconfig/network &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">hostname=k8s-1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>2.编辑 /etc/hosts 文件,添加域名解析.</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt;/etc/hosts</span><br><span class="line"><span class="number">192.168.2.87</span> k8s-<span class="number">1</span></span><br><span class="line"><span class="number">192.168.2.91</span> k8s-<span class="number">2</span></span><br><span class="line"><span class="number">192.168.2.92</span> k8s-<span class="number">3</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>3.关闭防火墙、selinux和swap.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=enforcing/SELINUX=disabled/g&quot;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line">swapoff -a</span><br><span class="line">sed -i <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> <span class="regexp">/etc/</span>fstab</span><br></pre></td></tr></table></figure>

<p>4.第一次安装打开路由转发功能,很多文档上没有写,但是我安装的时候确实报错了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;1&quot;</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/ip_forward</span><br></pre></td></tr></table></figure>

<p>5.配置内核参数,将桥接的IPv4流量传递到iptables的链:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/k8s<span class="selector-class">.conf</span> &lt;&lt;EOF</span><br><span class="line">net<span class="selector-class">.bridge</span><span class="selector-class">.bridge-nf-call-ip6tables</span> = <span class="number">1</span></span><br><span class="line">net<span class="selector-class">.bridge</span><span class="selector-class">.bridge-nf-call-iptables</span> = <span class="number">1</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>使其生效:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">sysctl <span class="comment">--system</span></span><br></pre></td></tr></table></figure>

<p>6.配置国内yum源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install -y wget</span><br><span class="line">mkdir <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/bak &amp;&amp; mv /</span>etc<span class="regexp">/yum.repos.d/</span>*.repo <span class="regexp">/etc/yum</span>.repos.d/bak</span><br><span class="line">wget -O <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/CentOS-Base.repo http:/</span><span class="regexp">/mirrors.cloud.tencent.com/</span>repo/centos7_base.repo</span><br><span class="line">wget -O <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/epel.repo http:/</span><span class="regexp">/mirrors.cloud.tencent.com/</span>repo/epel-<span class="number">7</span>.repo</span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure>

<p>配置国内Kubernetes源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; <span class="regexp">/etc/yum</span>.repos.d/kubernetes.repo</span><br><span class="line"></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/repos/</span>kubernetes-el7-x86_64/</span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">repo_gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/yum</span>-key.gpg https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/</span>rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>配置 docker 源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/docker-ce/</span>linux<span class="regexp">/centos/</span>docker-ce.repo -O <span class="regexp">/etc/yum</span>.repos.d/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>三、master部署</p>
<p>master节点需要安装以下组件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">etcd</span></span><br><span class="line"><span class="attribute">flannel</span></span><br><span class="line"><span class="attribute">kubernets</span></span><br></pre></td></tr></table></figure>

<p>1.etcd安装</p>
<p>安装命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> etcd -y</span><br></pre></td></tr></table></figure>

<p>编辑etcd的默认配置文件:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">vi /etc/etcd/etcd.conf</span><br><span class="line"></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://0.0.0.0:2379&quot;</span> <span class="comment"># 127.0.0.1改成0.0.0.0</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;default&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://0.0.0.0:2379&quot;</span> <span class="comment"># 127.0.0.1改成0.0.0.0</span></span><br></pre></td></tr></table></figure>

<p>注:整个etcd.conf文件有许多选项用”#”注释掉了,我们这里不再一一列出,etcd可以用多台配置成集群,有兴趣的朋友可以自行百度,参考文章很多.我们用单台实现基本功能.</p>
<p>启动etcd并验证:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> etcd</span><br></pre></td></tr></table></figure>

<p>验证etcd工作状态:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">etcdctl</span> -C http://<span class="number">192.168.2.87:2379</span> cluster-health</span><br><span class="line"></span><br><span class="line"><span class="attribute">member</span> <span class="number">8</span>e<span class="number">9</span>e<span class="number">05</span>c<span class="number">52164694</span>d is healthy: got healthy result from http://<span class="number">0.0.0.0:2379</span></span><br><span class="line"><span class="attribute">cluster</span> is healthy</span><br></pre></td></tr></table></figure>

<p>2.flannel安装</p>
<p>安装命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> flannel</span><br></pre></td></tr></table></figure>

<p>配置flannel:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/flanneld</span><br><span class="line"></span><br><span class="line"># Flanneld <span class="keyword">configuration</span> <span class="keyword">options</span> </span><br><span class="line"></span><br><span class="line"># etcd url <span class="keyword">location</span>. <span class="type">Point</span> this <span class="keyword">to</span> the <span class="keyword">server</span> <span class="keyword">where</span> etcd runs</span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=&quot;http://192.168.2.87:2379&quot; #这里ip改为master服务器ip</span><br><span class="line"></span><br><span class="line"># etcd config key. This <span class="keyword">is</span> the <span class="keyword">configuration</span> key that flannel queries </span><br><span class="line"># <span class="keyword">For</span> address range assignment </span><br><span class="line">FLANNEL_ETCD_KEY=&quot;/coreos.com/network&quot; # 注意要修改coreos.com和FLANNEL_ETCD_KEY(不是FLANNEL_ETCD_PREFIX)</span><br><span class="line"><span class="meta">#FLANNEL_ETCD_PREFIX=&quot;/atomic.io/network&quot; </span></span><br><span class="line"><span class="meta">#FLANNEL_OPTIONS=&quot;--etcd-endpoints=http://192.168.2.87:2379 --ip-masq=true&quot; </span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">Any</span> additional <span class="keyword">options</span> that you want <span class="keyword">to</span> pass #FLANNEL_OPTIONS=&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>配置etcd中关于flannel的key:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">etcdctl <span class="keyword">set</span> <span class="string">/coreos.com/network/config</span> &#x27;&#123; <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;172.17.0.0/16&quot;</span> &#125;&#x27;</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;172.17.0.0/16&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>启动flannel并设置开机自启:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> flanneld.service</span><br><span class="line">systemctl <span class="keyword">enable</span> flanneld.service</span><br></pre></td></tr></table></figure>

<p>3.kubernets安装</p>
<p>k8s的安装命令很简单,执行:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> kubernetes</span><br></pre></td></tr></table></figure>

<p>master上需要运行以下组件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kube-apiserver</span></span><br><span class="line"><span class="attribute">kube-scheduler</span></span><br><span class="line"><span class="attribute">kube-controller-manager</span></span><br></pre></td></tr></table></figure>

<p>下面详细阐述:</p>
<p>配置 <code>/etc/kubernetes/apiserver</code>文件:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">vi /etc/kubernetes/apiserver </span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># kubernetes system config</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following values are used to configure the kube-apiserver</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The address on the local server to listen to.</span></span><br><span class="line">KUBE_API_ADDRESS=<span class="string">&quot;--insecure-bind-address=0.0.0.0&quot;</span> <span class="comment"># ip修改为0.0.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The port on the local server to listen on.</span></span><br><span class="line">KUBE_API_PORT=<span class="string">&quot;--port=8080&quot;</span> <span class="comment"># 这行取消注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Port minions listen on</span></span><br><span class="line">KUBELET_PORT=<span class="string">&quot;--kubelet-port=10250&quot;</span> <span class="comment"># 这行取消注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Comma separated list of nodes in the etcd cluster</span></span><br><span class="line">KUBE_ETCD_SERVERS=<span class="string">&quot;--etcd-servers=http://192.168.2.87:2379&quot;</span> <span class="comment"># ip修改为master服务器ip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Address range to use for services</span></span><br><span class="line">KUBE_SERVICE_ADDRESSES=<span class="string">&quot;--service-cluster-ip-range=10.254.0.0/16&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default admission control policies</span></span><br><span class="line"><span class="comment">#KUBE_ADMISSION_CONTROL=&quot;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&quot;</span></span><br><span class="line">KUBE_ADMISSION_CONTROL=<span class="string">&quot;NamespaceExists,LimitRanger,ResourceQuota&quot;</span> <span class="comment"># 注意这行只是修改了上面一行,是必须存在的.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add your own!</span></span><br><span class="line">KUBE_API_ARGS=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置 <code>/etc/kubernetes/config</code>文件:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">vi /etc/kubernetes/config</span><br><span class="line"></span><br><span class="line"><span class="meta">###</span></span><br><span class="line"><span class="meta"># kubernetes system config</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The following values are used to configure various aspects of all</span></span><br><span class="line"><span class="meta"># kubernetes services, including</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#   kube-apiserver.service</span></span><br><span class="line"><span class="meta">#   kube-controller-manager.service</span></span><br><span class="line"><span class="meta">#   kube-scheduler.service</span></span><br><span class="line"><span class="meta">#   kubelet.service</span></span><br><span class="line"><span class="meta">#   kube-proxy.service</span></span><br><span class="line"><span class="meta"># Comma seperated list of nodes in the etcd cluster  </span></span><br><span class="line"><span class="meta">#KUBE_ETCD_SERVERS=&quot;--etcd_servers=http://192.168.2.87:2379&quot;  </span></span><br><span class="line"></span><br><span class="line"><span class="meta"># logging to stderr means we get it in the systemd journal</span></span><br><span class="line">KUBE_LOGTOSTDERR=<span class="string">&quot;--logtostderr=true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># journal message level, 0 is debug</span></span><br><span class="line">KUBE_LOG_LEVEL=<span class="string">&quot;--v=0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Should this cluster be allowed to run privileged docker containers</span></span><br><span class="line">KUBE_ALLOW_PRIV=<span class="string">&quot;--allow-privileged=false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># How the controller-manager, scheduler, and proxy find the apiserver</span></span><br><span class="line">KUBE_MASTER=<span class="string">&quot;--master=http://192.168.2.87:8080&quot;</span> # 修改ip为master服务器ip</span><br></pre></td></tr></table></figure>

<p>启动k8s各个组件:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> kube-apiserver.service </span><br><span class="line">systemctl <span class="literal">start</span> kube-controller-manager.service </span><br><span class="line">systemctl <span class="literal">start</span> kube-scheduler.service</span><br></pre></td></tr></table></figure>

<p>设置k8s各组件开机启动:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> kube-apiserver.service </span><br><span class="line">systemctl <span class="builtin-name">enable</span> kube-controller-manager.service </span><br><span class="line">systemctl <span class="builtin-name">enable</span> kube-scheduler.service</span><br></pre></td></tr></table></figure>

<p>四、部署Slave节点</p>
<p>slave节点需要安装以下组件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">flannel</span></span><br><span class="line"><span class="attribute">docker</span></span><br><span class="line"><span class="attribute">kubernetes</span></span><br></pre></td></tr></table></figure>

<p>下面按顺序阐述:</p>
<p>1.flannel安装</p>
<p>安装命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> flannel</span><br></pre></td></tr></table></figure>

<p>配置flannel:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/flanneld</span><br><span class="line"></span><br><span class="line"># Flanneld <span class="keyword">configuration</span> <span class="keyword">options</span>  </span><br><span class="line"></span><br><span class="line"># etcd url <span class="keyword">location</span>.  <span class="type">Point</span> this <span class="keyword">to</span> the <span class="keyword">server</span> <span class="keyword">where</span> etcd runs</span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=&quot;http://192.168.2.87:2379&quot; # ip修改为master服务器ip</span><br><span class="line"></span><br><span class="line"># etcd config key.  This <span class="keyword">is</span> the <span class="keyword">configuration</span> key that flannel queries</span><br><span class="line"># <span class="keyword">For</span> address range assignment</span><br><span class="line">FLANNEL_ETCD_KEY=&quot;/coreos.com/network&quot; # 注意要修改coreos.com和FLANNEL_ETCD_KEY(不是FLANNEL_ETCD_PREFIX)</span><br><span class="line"><span class="meta">#FLANNEL_ETCD_PREFIX=&quot;/atomic.io/network&quot;</span></span><br><span class="line"><span class="meta">#FLANNEL_OPTIONS=&quot;--etcd-endpoints=http://192.168.2.87:2379  --ip-masq=true&quot;</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">Any</span> additional <span class="keyword">options</span> that you want <span class="keyword">to</span> pass</span><br><span class="line"><span class="meta">#FLANNEL_OPTIONS=&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>启动flannel并设置开机自启:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> flanneld.service </span><br><span class="line">systemctl <span class="keyword">enable</span> flanneld.service</span><br></pre></td></tr></table></figure>

<p>2.kubernetes安装</p>
<p>安装命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> kubernetes</span><br></pre></td></tr></table></figure>

<p>不同于master节点,slave节点上需要运行kubernetes的如下组件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kubelet</span></span><br><span class="line"><span class="attribute">kubernets-proxy</span></span><br></pre></td></tr></table></figure>

<p>下面详细阐述要配置的东西:</p>
<p>配置 <code>/etc/kubernetes/config</code>文件:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">vi /etc/kubernetes/config</span><br><span class="line"></span><br><span class="line"><span class="meta">###</span></span><br><span class="line"><span class="meta"># kubernetes system config</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The following values are used to configure various aspects of all</span></span><br><span class="line"><span class="meta"># kubernetes services, including</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#   kube-apiserver.service</span></span><br><span class="line"><span class="meta">#   kube-controller-manager.service</span></span><br><span class="line"><span class="meta">#   kube-scheduler.service</span></span><br><span class="line"><span class="meta">#   kubelet.service</span></span><br><span class="line"><span class="meta">#   kube-proxy.service</span></span><br><span class="line"><span class="meta"># logging to stderr means we get it in the systemd journal</span></span><br><span class="line">KUBE_LOGTOSTDERR=<span class="string">&quot;--logtostderr=true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># journal message level, 0 is debug</span></span><br><span class="line">KUBE_LOG_LEVEL=<span class="string">&quot;--v=0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Should this cluster be allowed to run privileged docker containers</span></span><br><span class="line">KUBE_ALLOW_PRIV=<span class="string">&quot;--allow-privileged=false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># How the controller-manager, scheduler, and proxy find the apiserver</span></span><br><span class="line">KUBE_MASTER=<span class="string">&quot;--master=http://192.168.2.87:8080&quot;</span> # ip修改为master服务器ip</span><br></pre></td></tr></table></figure>

<p>配置 <code>/etc/kubernetes/kubelet</code>文件:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">vi /etc/kubernetes/config</span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># kubernetes kubelet (minion) config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The address for the info server to serve on (set to 0.0.0.0 or &quot;&quot; for all interfaces)</span></span><br><span class="line">KUBELET_ADDRESS=<span class="string">&quot;--address=0.0.0.0&quot;</span> <span class="comment"># 修改ip为0.0.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The port for the info server to serve on</span></span><br><span class="line"><span class="comment"># KUBELET_PORT=&quot;--port=10250&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You may leave this blank to use the actual hostname</span></span><br><span class="line">KUBELET_HOSTNAME=<span class="string">&quot;--hostname-override=192.168.2.91&quot;</span> <span class="comment"># 修改ip为本机ip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># location of the api-server</span></span><br><span class="line">KUBELET_API_SERVER=<span class="string">&quot;--api-servers=http://192.168.2.87:8080&quot;</span> <span class="comment"># 修改ip为master服务器ip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pod infrastructure container</span></span><br><span class="line">KUBELET_POD_INFRA_CONTAINER=<span class="string">&quot;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&quot;</span> <span class="comment"># 成功部署后node节点会拉取这个容器,如果拉取不到修改这里的容器地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add your own!</span></span><br><span class="line">KUBELET_ARGS=<span class="string">&quot;--cluster-dns=192.168.2.87 --cluster-domain=playcrab-inc.com&quot;</span> <span class="comment"># 增加这样一句,作用未知</span></span><br></pre></td></tr></table></figure>

<p>启动kube服务:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> kubelet.service </span><br><span class="line">systemctl <span class="literal">start</span> kube-proxy.service</span><br></pre></td></tr></table></figure>

<p>设置k8s组件开机自启:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> kubelet.service </span><br><span class="line">systemctl <span class="builtin-name">enable</span> kube-proxy.service</span><br></pre></td></tr></table></figure>

<p>至此为止,k8s集群的搭建过程就完成了,下面来验证一下集群是否搭建成功了.</p>
<p>验证集群状态:</p>
<p>查看端点信息:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kubectl</span> get endpoints</span><br><span class="line"></span><br><span class="line"><span class="attribute">NAME</span>            ENDPOINTS           AGE</span><br><span class="line"><span class="attribute">kubernetes</span>      <span class="number">192.168.2.87:6443</span>   <span class="number">8</span>d</span><br></pre></td></tr></table></figure>

<p>查看集群信息:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">kubectl <span class="keyword">cluster</span>-<span class="keyword">info</span></span><br><span class="line"></span><br><span class="line">Kubernetes master <span class="keyword">is</span> running at http://localhost:<span class="number">8080</span></span><br><span class="line"><span class="keyword">To</span> further <span class="keyword">debug</span> <span class="keyword">and</span> diagnose <span class="keyword">cluster</span> problems, use <span class="string">&#x27;kubectl cluster-info dump&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>获取集群中的节点状态:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line">NAME           STATUS    AGE</span><br><span class="line"><span class="number">192.168.2.91</span>   Ready     8d</span><br><span class="line"><span class="number">192.168.2.92</span>   Ready     8d</span><br></pre></td></tr></table></figure>

<p>五、配置dashboard服务</p>
<p>dashboard本质上就是webui连接master的api接口,通过api获取k8s集群的相关信息,然后在web上展示出来,对用户来说比较友好一些,实际用处并不是很大.</p>
<p>1.yaml文件</p>
<p>编辑dashboard.yaml,注意或更改以下红色部分:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">dashboard.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="comment"># Keep the name in sync with image version and</span></span><br><span class="line"><span class="comment"># gce/coreos/kube-manifests/addons/dashboard counterparts</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard-latest</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">latest</span></span><br><span class="line">        <span class="attr">kubernetes.io/cluster-service:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/siriuszg/kubernetes-dashboard-amd64:v1.5.1</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="comment"># keep request = limit to keep this container in guaranteed class</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">50Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">50Mi</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9090</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">         <span class="bullet">-</span>  <span class="string">--apiserver-host=http://192.168.2.87:8080</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># image后面地址是kubernetes-dashboard容器地址,如无法拉取可在此处修改.</span></span><br><span class="line"><span class="comment"># apiserver-host后面要修改为master服务器ip</span></span><br></pre></td></tr></table></figure>

<p>编辑dashboardsvc.yaml文件:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">dashboardsvc.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">    <span class="attr">kubernetes.io/cluster-service:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure>

<p>2.启动</p>
<p>在master执行如下命令:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">kubectl <span class="keyword">create</span> -f dashboard.yaml</span><br><span class="line">kubectl <span class="keyword">create</span> -f dashboardsvc.yaml</span><br></pre></td></tr></table></figure>

<p>如果出现错误需要删除重新修改执行:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">kubectl deldete <span class="operator">-f</span> dashboard.yaml</span><br><span class="line">kubectl deldete <span class="operator">-f</span> dashboardsvc.yaml</span><br></pre></td></tr></table></figure>

<p>之后,dashboard搭建完成.</p>
<p>4.验证</p>
<p>命令验证,master上执行如下命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kubectl</span> get deployment --<span class="literal">all</span>-namespaces</span><br><span class="line"></span><br><span class="line"><span class="attribute">NAMESPACE</span>     NAME                          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line"><span class="attribute">kube</span>-system   kubernetes-dashboard-latest   <span class="number">1</span>         <span class="number">1</span>         <span class="number">1</span>            <span class="number">1</span>           <span class="number">1</span>h</span><br><span class="line"></span><br><span class="line"><span class="attribute">kubectl</span> get svc --<span class="literal">all</span>-namespaces </span><br><span class="line"></span><br><span class="line"><span class="attribute">NAMESPACE</span>     NAME                   CLUSTER-IP        EXTERNAL-IP   PORT(S)            AGE</span><br><span class="line"><span class="attribute">default</span>       frontend               <span class="number">10.254.190.16</span>     <span class="number">80</span>:<span class="number">30001</span>/TCP                     <span class="number">1</span>d</span><br><span class="line"><span class="attribute">default</span>       kubernetes             <span class="number">10.254.0.1</span>        <span class="number">443</span>/TCP                          <span class="number">10</span>d</span><br><span class="line"><span class="attribute">default</span>       redis-master           <span class="number">10.254.166.81</span>     <span class="number">6379</span>/TCP                         <span class="number">1</span>d</span><br><span class="line"><span class="attribute">default</span>       redis-slave            <span class="number">10.254.140.100</span>    <span class="number">6379</span>/TCP                         <span class="number">1</span>d</span><br><span class="line"><span class="attribute">kube</span>-system   kubernetes-dashboard   <span class="number">10.254.84.123</span>     <span class="number">80</span>/TCP                           <span class="number">1</span>h</span><br></pre></td></tr></table></figure>

<p>界面验证,浏览器访问:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">2.87</span>:<span class="number">8080</span>/ui</span><br></pre></td></tr></table></figure>

<p>5.销毁应用</p>
<p>在master上执行:</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">kubectl <span class="keyword">delete</span> deployment kubernetes-dashboard-latest --<span class="keyword">namespace</span>=kube-<span class="keyword">system</span></span><br><span class="line">kubectl <span class="keyword">delete</span> svc  kubernetes-dashboard --<span class="keyword">namespace</span>=kube-<span class="keyword">system</span></span><br></pre></td></tr></table></figure>

<p>六、遇到的错误</p>
<p>1.无法访问dashboard,提示超时,master服务器无法ping通node节点容器的ip.</p>
<p>node服务器iptables问题,使用iptables -nL命令查看,果然,Forward的策略还是drop,执行:</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><span class="line">iptables -<span class="keyword">P</span> FORWARD <span class="keyword">ACC</span>EPT</span><br></pre></td></tr></table></figure>

<p>问题解决.</p>
<p>2.报错:details: (open /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt: no such file or directory)</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install *rhsm* </span><br><span class="line"><span class="attribute">wget</span> http://mirror.centos.org/centos/<span class="number">7</span>/os/x<span class="number">86</span>_<span class="number">64</span>/Packages/python-rhsm-certificates-<span class="number">1</span>.<span class="number">19</span>.<span class="number">10</span>-<span class="number">1</span>.el<span class="number">7</span>_<span class="number">4</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br><span class="line"><span class="attribute">rpm2cpio</span> python-rhsm-certificates-<span class="number">1</span>.<span class="number">19</span>.<span class="number">10</span>-<span class="number">1</span>.el<span class="number">7</span>_<span class="number">4</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm | cpio -iv --to-stdout ./etc/rhsm/ca/redhat-uep.pem | tee /etc/rhsm/ca/redhat-uep.pem</span><br></pre></td></tr></table></figure>

<p>完成后,执行一下docker pull registry.access.redhat.com/rhel7/pod-infrastructure:latest,发现可以正常拉取容器.</p>
<p>3.在创建Dashborad时,查看状态总是ContainerCreating.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kubectl</span> get pod --namespace=kube-system</span><br><span class="line"></span><br><span class="line"><span class="attribute">NAME</span>                                    READY     STATUS              RESTARTS   AGE</span><br><span class="line"><span class="attribute">kubernetes</span>-dashboard-<span class="number">2094756401</span>-kzhnx   <span class="number">0</span>/<span class="number">1</span>       ContainerCreating   <span class="number">0</span>          <span class="number">10</span>m</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> dashboard.yaml</span><br><span class="line"></span><br><span class="line"><span class="attribute">image</span>: docker.io/siriuszg/kubernetes-dashboard-amd<span class="number">64</span>:v<span class="number">1</span>.<span class="number">5</span>.<span class="number">1</span> # 这个容器地址一定要是服务器可以正常拉取的</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS7中编译安装redis5.0</title>
    <url>/2019/08/09/1097/</url>
    <content><![CDATA[<p>1.环境介绍</p>
<p>CentOS7</p>
<p>2.下载Redis5.0-rc3</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> -O redis-<span class="number">5</span>.<span class="number">0</span>-rc<span class="number">3</span>.tar.gz https://github.com/antirez/redis/archive/<span class="number">5</span>.<span class="number">0</span>-rc<span class="number">3</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>3.解压redis</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf redis-<span class="number">5</span>.<span class="number">0</span>-rc<span class="number">3</span>.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>

<p>4.编译并安装</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /usr/local/redis-<span class="number">5</span>.<span class="number">0</span>-rc<span class="number">3</span></span><br><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>

<p>出现如下即编译成功:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Hint</span>: It&#x27;s a good idea to run &#x27;make test&#x27; </span><br><span class="line"><span class="attribute">make</span>[<span class="number">1</span>]: Leaving directory `/usr/local/redis-<span class="number">5</span>.<span class="number">0</span>-rc<span class="number">3</span>/src&#x27;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>/usr/local/redis-5.0-rc3/src</code>中执行安装命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/redis-5.0-rc3/</span>src</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>会出现如下日志信息:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">Hint: It&#x27;s a good idea to run &#x27;make <span class="keyword">test</span>&#x27; </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSTALL</span> <span class="keyword">install</span></span><br><span class="line"><span class="keyword">INSTALL</span> <span class="keyword">install</span></span><br><span class="line"><span class="keyword">INSTALL</span> <span class="keyword">install</span></span><br><span class="line"><span class="keyword">INSTALL</span> <span class="keyword">install</span></span><br><span class="line"><span class="keyword">INSTALL</span> <span class="keyword">install</span></span><br></pre></td></tr></table></figure>

<p>5.修改redis.conf配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/redis-5.0-rc3/</span>redis.conf</span><br></pre></td></tr></table></figure>

<p>只需要调整如下几个即可:</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">protected-mode <span class="literal">no</span> <span class="comment"># 关闭保护模式</span></span><br><span class="line">daemonize <span class="literal">yes</span>     <span class="comment"># 守护进程模式开启</span></span><br></pre></td></tr></table></figure>

<p>6.启动redis5.0</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/redis-5.0-rc3/</span>src<span class="regexp">/redis-server /u</span>sr<span class="regexp">/local/</span>redis-<span class="number">5.0</span>-rc3/redis.conf</span><br></pre></td></tr></table></figure>

<p>检查端口:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">netstat -ltnp <span class="string">|grep 6379</span></span><br></pre></td></tr></table></figure>

<p>如果有端口监听,说明redis已经启动成功.</p>
]]></content>
  </entry>
  <entry>
    <title>centos7安装jenkins</title>
    <url>/2019/10/09/1096/</url>
    <content><![CDATA[<p>1.查看服务器版本</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cat</span> /etc/redhat-release</span><br><span class="line"></span><br><span class="line"><span class="attribute">CentOS</span> Linux release <span class="number">7</span>.<span class="number">2</span>.<span class="number">1511</span> (Core)</span><br></pre></td></tr></table></figure>

<p>2.安装java</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install java-<span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>-openjdk</span><br></pre></td></tr></table></figure>

<p>3.查看java版本</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">java</span> -version</span><br><span class="line"></span><br><span class="line"><span class="attribute">openjdk</span> version <span class="string">&quot;1.8.0_102&quot;</span></span><br><span class="line"><span class="attribute">OpenJDK</span> Runtime Environment (build <span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>_<span class="number">102</span>-b<span class="number">14</span>)</span><br><span class="line"><span class="attribute">OpenJDK</span> <span class="number">64</span>-Bit Server VM (build <span class="number">25</span>.<span class="number">102</span>-b<span class="number">14</span>, mixed mode)</span><br></pre></td></tr></table></figure>

<p>4.安装jenkins</p>
<p>拉取库的配置到本地对应文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo wget -O <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/jenkins.repo http:/</span><span class="regexp">/pkg.jenkins-ci.org/</span>redhat/jenkins.repo</span><br></pre></td></tr></table></figure>

<p>jenkins.repo内容是这样:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[jenkins]</span></span><br><span class="line"><span class="attr">name</span>=Jenkins-stable</span><br><span class="line"><span class="attr">baseurl</span>=http://pkg.jenkins.io/redhat-stable</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>导入公钥:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo rpm --import https:<span class="regexp">//</span>jenkins-ci.org<span class="regexp">/redhat/</span>jenkins-ci.org.key</span><br></pre></td></tr></table></figure>

<p>安装jenkins:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo yum -y <span class="keyword">install</span> jenkins</span><br></pre></td></tr></table></figure>

<p>基本安装完成.</p>
<p>更新jenkins:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum update jenkins</span></span><br></pre></td></tr></table></figure>

<p>5.熟悉jenkins配置</p>
<p>系统配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/etc/</span>sysconfig/jenkins | more</span><br></pre></td></tr></table></figure>

<p>可以获得几个重要配置项目信息:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">JENKINS_HOME</span>=<span class="string">&quot;/var/lib/jenkins&quot;</span> <span class="comment"># 存放jenkins 配置及工作文件</span></span><br><span class="line"><span class="attr">JENKINS_PORT</span>=<span class="string">&quot;8080&quot;</span> <span class="comment"># jenkins默认8080端口</span></span><br></pre></td></tr></table></figure>

<p>配置文件夹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ls <span class="regexp">/var/</span>lib/jenkins</span><br></pre></td></tr></table></figure>

<p>有jobs、logs、plugins等文件夹及文件若干.勿乱删.<br>这次主要看了看plugins文件夹,所有插件都在里面,如插件ssh-slaves,会有一个ssh-slaves文件夹及ssh-slaves.jpi.<br>当某个插件未安装成功时,会有一个以.tmp结尾的文件.</p>
<p>日志:</p>
<p><code>/var/lib/jenkins/logs</code>有logs # 暂时看来没记录啥,以后再追.<br><code>/var/log/jenkins/jenkins.log</code> # 记录了插件安装等日志,失败信息原因等很清晰,重要.</p>
<p>6.启动&amp;配置</p>
<p>启动服务:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service jenkins <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>浏览器访问:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">IP</span>地址:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>获取管理员密码:</p>
<p>按提示,去 <code>/var/lib/jenkins/secrets/initialAdminPassword</code>,复制贴进去,continue.</p>
<p>选择安装方式:</p>
<p>默认推荐吧,左边的.第二个自定义插件,如果知道需要什么插件,插件都是干嘛的,再选custom吧.</p>
<p>手动安装异常插件:</p>
<p>系统管理 -&gt; 管理插件 -&gt; 可选插件,表格右上异步过滤,插件打勾,直接安装.安装插件就在这里安装.</p>
<p>注意:</p>
<p>异常插件处理的时候,这里需要注意插件之间的依赖关系,A插件依赖的B插件没安装成功,安装A之前先安装B,管理插件里的异常列表写的很清楚.</p>
<p>7.卸载jenkins</p>
<p>在某次自动安装插件时异常了一大片,刷新也没出现下一步,等待许久无果,删了重装.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm -e jenkins</span></span><br></pre></td></tr></table></figure>

<p>会有一些残留的文件分散在各地:</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -iname jenkins | xargs -<span class="built_in">n</span> <span class="number">1000</span> rm -rf</span><br></pre></td></tr></table></figure>

<p>完成.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS安装Bind</title>
    <url>/2017/01/28/1099/</url>
    <content><![CDATA[<p>本文所说方法为yum安装,使用name caching方式.其他方法后续有机会再补完吧.</p>
<p>01、首先使用yum方式安装所需的程序包</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install </span><span class="keyword">bind </span><span class="keyword">bind-chroot </span>caching-nameserver -y</span><br></pre></td></tr></table></figure>

<p>02、进入bind的目录,并复制控制文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>etc;</span><br><span class="line">cp named.caching-nameserver.conf named.conf</span><br></pre></td></tr></table></figure>

<p>03、编辑named.conf文件:vi named.conf</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">options</span> &#123;</span><br><span class="line">    listen-on port <span class="number">53</span> &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">	listen-on-v6 port <span class="number">53</span> &#123; ::<span class="number">1</span>; &#125;;</span><br><span class="line">	directory 	<span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">	<span class="keyword">dump</span>-<span class="keyword">file</span> 	<span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">        statistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">        memstatistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">        forwarders &#123; <span class="number">8.8</span>.<span class="number">8.8</span>; <span class="number">202.106</span>.<span class="number">0.20</span>; &#125;; </span><br><span class="line">	<span class="comment">// Those options should be used carefully because they disable port</span></span><br><span class="line">	<span class="comment">// randomization</span></span><br><span class="line">	<span class="comment">// query-source    port 53;</span></span><br><span class="line">	<span class="comment">// query-source-v6 port 53;</span></span><br><span class="line"></span><br><span class="line">        allow-query &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">        allow-query-cache &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                <span class="keyword">file</span> <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view localhost_resolver &#123;</span><br><span class="line">        match-clients &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">        match-destinations &#123; <span class="keyword">any</span>; &#125;;</span><br><span class="line">        recursion yes;</span><br><span class="line">	<span class="keyword">include</span> <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>04、编辑vi named.rfc1912.zones</p>
<p>如果是主DNS:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">zone <span class="string">&quot;abc.com&quot;</span> &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;abc.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-transfer&#123;<span class="number">192.168</span>.<span class="number">1.2</span><span class="comment">;&#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line">zone <span class="string">&quot;33.22.11.in-addr.arpa&quot;</span> &#123;</span><br><span class="line">        type master<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;11.22.33.rev&quot;</span><span class="comment">;</span></span><br><span class="line">        allow-transfer&#123;<span class="number">192.168</span>.<span class="number">1.2</span><span class="comment">;&#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>如果是辅DNS:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">zone <span class="string">&quot;abc.com&quot;</span> &#123;</span><br><span class="line">        type slave<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;abc.com.zone&quot;</span><span class="comment">;</span></span><br><span class="line">        Masters&#123;<span class="number">192.168</span>.<span class="number">1.1</span><span class="comment">;&#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line">zone <span class="string">&quot;33.22.11.in-addr.arpa&quot;</span> &#123;</span><br><span class="line">        type slave<span class="comment">;</span></span><br><span class="line">        file <span class="string">&quot;11.22.33.rev&quot;</span><span class="comment">;</span></span><br><span class="line">        Masters&#123;<span class="number">192.168</span>.<span class="number">1.1</span><span class="comment">;&#125;;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>05、编辑上面配置文件中提到的abc.com.zone文件</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">cd /var/named/chroot/var/named</span><br><span class="line">vi abc.com.zone</span><br><span class="line"></span><br><span class="line"><span class="meta">$TTL</span>    <span class="number">86400</span></span><br><span class="line">@       <span class="keyword">IN</span>      <span class="keyword">SOA</span>     localhost. root.localhost.  (</span><br><span class="line">                                      <span class="number">20110312</span>   <span class="comment">; Serial</span></span><br><span class="line">                                      <span class="number">28800</span>      <span class="comment">; Refresh</span></span><br><span class="line">                                      <span class="number">14400</span>      <span class="comment">; Retry</span></span><br><span class="line">                                      <span class="number">3600000</span>    <span class="comment">; Expire</span></span><br><span class="line">                                      <span class="number">86400</span> )    <span class="comment">; Minimum</span></span><br><span class="line"><span class="meta">$ORIGIN</span> abc.com.</span><br><span class="line">                <span class="keyword">IN</span> <span class="keyword">NS</span>           dns.abc.com.</span><br><span class="line">dns           <span class="keyword">IN</span> <span class="keyword">A</span>             <span class="number">192.168.1.1</span></span><br><span class="line">www         <span class="keyword">IN</span> <span class="keyword">A</span>             <span class="number">192.168.1.1</span></span><br></pre></td></tr></table></figure>

<p>06、启动服务</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service named <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>07、将服务设置为开机自启</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">[root@<span class="keyword">test</span> ～]chkconfig --<span class="keyword">list</span> named</span><br><span class="line">named          	<span class="number">0</span>:<span class="keyword">off</span>	<span class="number">1</span>:<span class="keyword">off</span>	<span class="number">2</span>:<span class="keyword">off</span>	<span class="number">3</span>:<span class="keyword">off</span>	<span class="number">4</span>:<span class="keyword">off</span>	<span class="number">5</span>:<span class="keyword">off</span>	<span class="number">6</span>:<span class="keyword">off</span></span><br><span class="line">[root@<span class="keyword">test</span> ～]chkconfig --level <span class="number">345</span> named <span class="keyword">on</span></span><br><span class="line">[root@<span class="keyword">test</span> ～]chkconfig --<span class="keyword">list</span> named</span><br><span class="line">named          	<span class="number">0</span>:<span class="keyword">off</span>	<span class="number">1</span>:<span class="keyword">off</span>	<span class="number">2</span>:<span class="keyword">off</span>	<span class="number">3</span>:<span class="keyword">on</span>	<span class="number">4</span>:<span class="keyword">on</span>	<span class="number">5</span>:<span class="keyword">on</span>	<span class="number">6</span>:<span class="keyword">off</span></span><br></pre></td></tr></table></figure>

<p>至此域名服务器基本搭建完成了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装 samba实现共享</title>
    <url>/2011/08/02/1098/</url>
    <content><![CDATA[<p>samba是一个工具套件,在Unix上实现SMB(Server Message Block)协议,或者称之为NETBIOS/LanManager协议.SMB协议通常是被windows系列用来实现磁盘和打印机共享.需要注意的是,NetBIOS是基于以太网广播机制的,没有透明网桥是不能跨越网段的,也许用WINS和LMHOSTS可以,但我没试过.</p>
<p>安装更新最新的samba包,轻松访问安装了Samba的UNIX/LINUX服务器:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> samba</span><br></pre></td></tr></table></figure>

<p>1.安装centos时在防火墙中开启文档共享服务,并选择安装文档共享服务器.</p>
<p>2.启动 Samba 服务.</p>
<p>命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ chkconfig smb <span class="keyword">on</span>　 ← 配置 Samba 自启动</span><br><span class="line">$ service smb <span class="keyword">start</span>    ← 启动Samba服务</span><br><span class="line">Starting SMB services:　　　　　　 [ OK ]</span><br><span class="line">Starting NMB services:　　　　　　 [ OK ]</span><br><span class="line">$ smbpasswd -a root　 ← 将系统用户 root 加入到 Samba 用户数据库</span><br><span class="line"><span class="built_in">New</span> SMB <span class="keyword">password</span>:　 ← 输入该用户用于登录 Samba 的密码</span><br><span class="line">Retype <span class="built_in">new</span> SMB <span class="keyword">password</span>:　 ← 再次确认输入该密码</span><br><span class="line">Added <span class="keyword">user</span> centospub.</span><br></pre></td></tr></table></figure>

<p>3.配置Samba</p>
<p>通过编辑 <code>/etc/samba/smb.conf</code> 让将要被共享的目录拥有充分的读写权限属性.<br>在smb.conf文档最后加入下面内容:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">all</span> file]</span><br><span class="line"><span class="keyword">comment</span> = centos <span class="keyword">all</span> file</span><br><span class="line"><span class="type">path</span> = /</span><br><span class="line"><span class="keyword">valid</span> users = root</span><br><span class="line"><span class="built_in">public</span> = <span class="keyword">no</span></span><br><span class="line">writable = yes</span><br><span class="line">printable = <span class="keyword">no</span></span><br><span class="line"><span class="keyword">create</span> mask = <span class="number">0777</span></span><br><span class="line">directory mask = <span class="number">0777</span></span><br></pre></td></tr></table></figure>

<p>还有需要设置workgroup为当前局域网内一样.<br>这样在window里的网上邻居 就可以访问到centos下的所有文件了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装ganglia</title>
    <url>/2012/10/11/1100/</url>
    <content><![CDATA[<p>一、安装A.M.P环境</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">yum install -y httpd mysql mysql-server php php-mysql <span class="built_in">net</span>-snmp <span class="built_in">net</span>-snmp-utils</span><br></pre></td></tr></table></figure>

<p>二、编译安装基本环境</p>
<p>源码安装rrdtool没成功,依赖太多了,下面进行yum 安装rrdtool,首先加入dag的yum.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost]$ cd <span class="regexp">/etc/yum</span>.repos.d/</span><br><span class="line">[root@localhost]$ vim dag.repo</span><br><span class="line"></span><br><span class="line">[dag]</span><br><span class="line">name=Dag RPM Repository <span class="keyword">for</span> Red Hat Enterprise Linux</span><br><span class="line">baseurl=http:<span class="regexp">//</span>apt.sw.be<span class="regexp">/redhat/</span>el<span class="variable">$releasever</span><span class="regexp">/en/</span><span class="variable">$basearch</span>/dag</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//</span>dag.wieers.com<span class="regexp">/rpm/</span>packages/RPM-GPG-KEY.dag.txt</span><br><span class="line">enabled=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>安装相关依赖:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost]</span><span class="meta">#yum -y install apr-devel apr-util check-devel cairo-devel pango-devel libxml2-devel </span></span><br><span class="line">rpmbuild glib2-devel dbus-devel freetype-devel fontconfig-devel gcc-c++ expat-devel </span><br><span class="line">python-devel libXrender-devel zlib libpng freetype libjpeg fontconfig gd libxml2 </span><br><span class="line">pcre pcre-devel libpcre libconfuse libart_lgpl-devel</span><br><span class="line">[root<span class="symbol">@localhost]</span><span class="meta"># yum install -y rrdtool perl-rrdtool rrdtool-devel</span></span><br></pre></td></tr></table></figure>

<p>不安装rrdtool-devel在编译ganglia时总是有错误</p>
<p>三、安装ganglia</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>download.fedora.redhat.com<span class="regexp">/pub/</span>epel<span class="regexp">/5/</span>x86_64/libconfuse-<span class="number">2.5</span>-<span class="number">4</span>.el5.x86_64.rpm(yum可以安装)</span><br><span class="line">wget http:<span class="regexp">//</span>download.fedora.redhat.com<span class="regexp">/pub/</span>epel<span class="regexp">/5/</span>x86_64/libconfuse-devel-<span class="number">2.5</span>-<span class="number">4</span>.el5.x86_64.rpm(yum可以安装)</span><br><span class="line"></span><br><span class="line">rpm -ivh libconfuse-<span class="number">2.5</span>-<span class="number">4</span>.el5.x86_64.rpm</span><br><span class="line">rpm -ivh libconfuse-devel-<span class="number">2.5</span>-<span class="number">4</span>.el5.x86_64.rpm</span><br><span class="line"></span><br><span class="line">wget http:<span class="regexp">//</span>cdnetworks-kr-<span class="number">1</span>.dl.sourceforge.net<span class="regexp">/project/g</span>anglia<span class="regexp">/ganglia%20monitoring%20core/</span><span class="number">3.1</span>.<span class="number">7</span><span class="regexp">/ganglia-3.1.7.tar.gz(http:/</span><span class="regexp">/ganglia.info/</span>下载)</span><br><span class="line"></span><br><span class="line">tar zxvf ganglia-<span class="number">3.1</span>.<span class="number">7</span>.tar.gz</span><br><span class="line">cd ganglia-<span class="number">3.1</span>.<span class="number">7</span></span><br><span class="line">.<span class="regexp">/configure --with-gmetad --sysconfdir=/</span>etc/ganglia</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">cd ganglia-<span class="number">3.1</span>.<span class="number">7</span></span><br><span class="line">mkdir -p <span class="regexp">/var/</span>www<span class="regexp">/html/g</span>anglia/</span><br><span class="line">cp -a web<span class="regexp">/* /</span>var<span class="regexp">/www/</span>html<span class="regexp">/ganglia/</span></span><br><span class="line">cp gmetad<span class="regexp">/gmetad.init /</span>etc<span class="regexp">/rc.d/i</span>nit.d/gmetad</span><br><span class="line">cp gmond<span class="regexp">/gmond.init /</span>etc<span class="regexp">/rc.d/i</span>nit.d/gmond</span><br><span class="line">gmond -t | tee <span class="regexp">/etc/g</span>anglia/gmond.conf</span><br><span class="line">mkdir -p <span class="regexp">/var/</span>lib<span class="regexp">/ganglia/</span>rrds</span><br><span class="line">chmod -R <span class="number">777</span> <span class="regexp">/var/</span>lib<span class="regexp">/ganglia/</span>rrds</span><br><span class="line">chkconfig --add gmetad</span><br><span class="line">chkconfig --add gmond</span><br></pre></td></tr></table></figure>

<p>测试:</p>
<p>启动ganglia:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">service gmond <span class="built_in">restart</span></span><br><span class="line">service gmetad <span class="built_in">restart</span></span><br><span class="line">service httpd <span class="built_in">restart</span></span><br></pre></td></tr></table></figure>

<p>网页访问<a href="http://ip/ganglia">http://ip/ganglia</a></p>
<p>编写一个主机地址文件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi mynodes</span></span><br></pre></td></tr></table></figure>

<p>添加你的主机名或服务器ip到该文件,我这里只写了5台主机.</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.10.1</span></span><br><span class="line"><span class="number">192.168.10.2</span></span><br><span class="line"><span class="number">192.168.10.3</span></span><br><span class="line"><span class="number">192.168.10.4</span></span><br><span class="line"><span class="number">192.168.10.5</span></span><br></pre></td></tr></table></figure>

<p>编写脚本实现服务的发布:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vi</span> ganglia.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p>使用以下内容,这里使用的是64位OS,如果是32位OS,将下面的lib64改为lib:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat mynodes`;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">scp <span class="regexp">/usr/</span>bin<span class="regexp">/gmetric $i:/u</span>sr/bin</span><br><span class="line">scp <span class="regexp">/usr/</span>sbin<span class="regexp">/gmond $i:/u</span>sr<span class="regexp">/sbin/gm</span>ond</span><br><span class="line">ssh <span class="variable">$i</span> mkdir -p <span class="regexp">/etc/g</span>anglia/</span><br><span class="line">scp <span class="regexp">/etc/g</span>anglia<span class="regexp">/gmond.conf $i:/</span>etc<span class="regexp">/ganglia/</span></span><br><span class="line">scp <span class="regexp">/etc/i</span>nit.d<span class="regexp">/gmond $i:/</span>etc<span class="regexp">/init.d/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libganglia-3.1.7.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/lib64/</span>libexpat.so.<span class="number">1</span> <span class="variable">$i</span>:<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libconfuse.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libapr-1.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp -r <span class="regexp">/usr/</span>lib64<span class="regexp">/ganglia $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">ssh <span class="variable">$i</span> service gmond startdone</span><br></pre></td></tr></table></figure>

<p>网页就可以看到这台服务器了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装GD库</title>
    <url>/2012/02/01/1101/</url>
    <content><![CDATA[<figure class="highlight plaintext"><figcaption><span>-y install php-gd</span></figcaption><table><tr><td class="code"><pre><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS安装L2TP VPN笔记</title>
    <url>/2013/09/17/1103/</url>
    <content><![CDATA[<p>换了个新vps,之前一直用pptp和openvpn,这次准备尝试下l2tp,记录下安装过程.<br>ip里也就能通过NCSetting快速启动vpn了,openvpn没有在NCSetting里的设置.<br>首先需要卸载已安装的openswan,我因为yum install安装的openswan版本有bug,导致我折腾一天也没连接成功,所以建议直接下载指定版本的源码.</p>
<p>安装ipsec:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> remove -y openswan</span><br><span class="line"><span class="attribute">wget</span> https://download.openswan.org/openswan//old/openswan-<span class="number">2</span>.<span class="number">6</span>/openswan-<span class="number">2</span>.<span class="number">6</span>.<span class="number">24</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> zxvf openswan-<span class="number">2</span>.<span class="number">6</span>.<span class="number">24</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> openswan-<span class="number">2</span>.<span class="number">6</span>.<span class="number">24</span></span><br><span class="line"><span class="attribute">make</span> programs install</span><br></pre></td></tr></table></figure>

<p>安装必须的模块:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ppp iptables libpcap-devel</span><br></pre></td></tr></table></figure>

<p>配置ipsec:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/ipsec.conf</span><br><span class="line">touch /etc/ipsec.conf</span><br><span class="line">cat &gt;&gt;/etc/ipsec.conf&lt;&lt;EOF<span class="built_in"></span></span><br><span class="line"><span class="built_in">config </span>setup</span><br><span class="line"><span class="attribute">nat_traversal</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">virtual_private</span>=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12</span><br><span class="line"><span class="attribute">oe</span>=off</span><br><span class="line"><span class="attribute">protostack</span>=netkey</span><br><span class="line">conn L2TP-PSK-NAT</span><br><span class="line"><span class="attribute">rightsubnet</span>=vhost:%priv</span><br><span class="line"><span class="attribute">also</span>=L2TP-PSK-noNAT</span><br><span class="line">conn L2TP-PSK-noNAT</span><br><span class="line"><span class="attribute">authby</span>=secret</span><br><span class="line"><span class="attribute">pfs</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">auto</span>=add</span><br><span class="line"><span class="attribute">keyingtries</span>=3</span><br><span class="line"><span class="attribute">rekey</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">ikelifetime</span>=8h</span><br><span class="line"><span class="attribute">keylife</span>=1h</span><br><span class="line"><span class="attribute">type</span>=transport</span><br><span class="line"><span class="attribute">left</span>=<span class="variable">$ip</span> #替换成vps的ip</span><br><span class="line"><span class="attribute">leftprotoport</span>=17/1701</span><br><span class="line"><span class="attribute">right</span>=%any</span><br><span class="line"><span class="attribute">rightprotoport</span>=17/%any</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>配置密钥,替换vipip和key:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/i</span>psec.secrets</span><br><span class="line"><span class="variable">$your_vps_ip</span> %any: PSK <span class="string">&quot;$your_key&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置转发:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g&#x27;</span> <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> in <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">echo <span class="number">0</span> &gt; $<span class="keyword">each</span>/accept_redirects</span><br><span class="line">echo <span class="number">0</span> &gt; $<span class="keyword">each</span>/send_redirects</span><br><span class="line">done</span><br><span class="line">iptables -t nat -A POSTROUTING -j MASQUERADE</span><br></pre></td></tr></table></figure>

<p>验证ipsec配置:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">/etc/init.d/ipsec restart</span><br><span class="line">ipsec verify</span><br><span class="line">Checking your system to see <span class="keyword">if</span> IPsec got installed and started correctly:</span><br><span class="line">Version check and ipsec on-path <span class="selector-attr">[OK]</span></span><br><span class="line">Linux Openswan U2.<span class="number">6.24</span>/K2.<span class="number">6.32</span>-<span class="number">71.29</span>.<span class="number">1</span><span class="selector-class">.el6</span><span class="selector-class">.i686</span> (netkey)</span><br><span class="line">Checking <span class="keyword">for</span> IPsec support <span class="keyword">in</span> kernel <span class="selector-attr">[OK]</span></span><br><span class="line">NETKEY detected, testing <span class="keyword">for</span> disabled ICMP send_redirects <span class="selector-attr">[OK]</span></span><br><span class="line">NETKEY detected, testing <span class="keyword">for</span> disabled ICMP accept_redirects <span class="selector-attr">[OK]</span></span><br><span class="line">Checking <span class="keyword">for</span> RSA private key (/etc/ipsec.secrets) <span class="selector-attr">[OK]</span></span><br><span class="line">Checking that pluto is running <span class="selector-attr">[OK]</span></span><br><span class="line">Pluto listening <span class="keyword">for</span> IKE on udp <span class="number">500</span> <span class="selector-attr">[OK]</span></span><br><span class="line">Pluto listening <span class="keyword">for</span> NAT-T on udp <span class="number">4500</span> <span class="selector-attr">[OK]</span></span><br><span class="line">Two or more interfaces found, checking IP forwarding <span class="selector-attr">[OK]</span></span><br><span class="line">Checking NAT and MASQUERADEing <span class="selector-attr">[N/A]</span></span><br><span class="line">Checking <span class="keyword">for</span> <span class="string">&#x27;ip&#x27;</span> command <span class="selector-attr">[OK]</span></span><br><span class="line">Checking <span class="keyword">for</span> <span class="string">&#x27;iptables&#x27;</span> command <span class="selector-attr">[OK]</span></span><br><span class="line">Opportunistic Encryption Support <span class="selector-attr">[DISABLED]</span></span><br></pre></td></tr></table></figure>

<p>安装x2ltpd:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.xelerance.com<span class="regexp">/wp-content/u</span>ploads<span class="regexp">/software/</span>xl2tpd/xl2tpd-<span class="number">1.3</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">tar xvf xl2tpd-<span class="number">1.3</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">make install</span><br><span class="line">mkdir <span class="regexp">/var/</span>run/xl2tpd</span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>l2tp-control <span class="regexp">/var/</span>run<span class="regexp">/xl2tpd/</span>l2tp-control</span><br><span class="line">mkdir <span class="regexp">/etc/</span>xl2tpd</span><br></pre></td></tr></table></figure>

<p>配置xl2tpd:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> /etc/xl2tpd/xl2tpd.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">listen-addr = $your_vps_ip <span class="comment">#替换成你的vpsip</span></span><br><span class="line">ipsec saref = <span class="literal">yes</span></span><br><span class="line">[lns default]</span><br><span class="line">ip range = <span class="number">192.168.30.10</span>-<span class="number">192.168.30.20</span></span><br><span class="line">local ip = <span class="number">192.168.30.1</span></span><br><span class="line">require chap = <span class="literal">yes</span></span><br><span class="line">refuse pap = <span class="literal">yes</span></span><br><span class="line">require authentication = <span class="literal">yes</span></span><br><span class="line">ppp <span class="literal">debug</span> = <span class="literal">yes</span></span><br><span class="line">pppoptfile = /etc/ppp/options.xl2tpd</span><br><span class="line">length bit = <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi /etc/ppp/options.xl2tpd</span><br><span class="line"></span><br><span class="line">require-mschap-v2</span><br><span class="line">ipcp-accept-local</span><br><span class="line">ipcp-accept-remote</span><br><span class="line">ms-dns <span class="number">8.8.8.8</span></span><br><span class="line">ms-dns <span class="number">8.8.4.4</span></span><br><span class="line">asyncmap <span class="number">0</span></span><br><span class="line">noccp</span><br><span class="line">auth</span><br><span class="line">crtscts</span><br><span class="line">hide-password</span><br><span class="line"><span class="literal">debug</span></span><br><span class="line">modem</span><br><span class="line">lock</span><br><span class="line">proxyarp</span><br><span class="line">name l2tpd</span><br><span class="line"><span class="comment">#lcp-echo-interval 30</span></span><br><span class="line"><span class="comment">#lcp-echo-failure 4</span></span><br></pre></td></tr></table></figure>

<p>配置用户和密码:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ppp/chap-secrets</span><br><span class="line"></span><br><span class="line"><span class="comment"># Secrets for authentication using CHAP</span></span><br><span class="line"><span class="comment"># client server secret IP addresses</span></span><br><span class="line">name * password *</span><br></pre></td></tr></table></figure>

<p>配置转发规则:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -t nat -A POSTROUTING -s <span class="number">192.168.30.0</span>/<span class="number">24</span> -o eth<span class="number">0</span> -j MASQUERADE</span><br><span class="line"><span class="attribute">iptables</span> -t nat -A POSTROUTING -s <span class="number">192.168.30.0</span>/<span class="number">24</span> -j SNAT --to-source $your_vps_ip</span><br></pre></td></tr></table></figure>

<p>启动xl2tp:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">xl2tpd -D <span class="meta">&amp;</span></span><br></pre></td></tr></table></figure>

<p>现在应该已经正常运行了,可以在你的手机或者电脑上新建一个l2tp连接测试.<br>自启动配置:<br>为了保证每次vps重启后都正常启动l2tp服务,我们还需做下面操作:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">iptables-save &gt; <span class="string">/etc/iptables</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;iptables-restore /etc/iptables&quot;</span> &gt;&gt; <span class="string">/etc/rc.local</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;/usr/local/sbin/xl2tpd -D &amp;&quot;</span> &gt;&gt; <span class="string">/etc/rc.local</span></span><br><span class="line">chkconfig <span class="params">--add</span> ipsec</span><br><span class="line">chkconfig <span class="params">--level</span> 2345 ipsec on</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装mysql</title>
    <url>/2016/12/29/1104/</url>
    <content><![CDATA[<p>直接运行:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> mysql</span><br></pre></td></tr></table></figure>
<p>不行还要运行:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">yum install mysql-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装nagios</title>
    <url>/2019/01/17/1105/</url>
    <content><![CDATA[<p>1.安装开始</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh http://download.fedoraproject.org/pub/epel/<span class="number">6</span>/i<span class="number">386</span>/epel-release-<span class="number">6</span>-<span class="number">8</span>.noarch.rpm</span><br><span class="line"><span class="attribute">yum</span> install nagios nagios-plugins nagios-plugins-<span class="literal">all</span> nagios-plugins-nrpe nrpe rrdtool* pnp<span class="number">4</span>nagios httpd php php-gd</span><br></pre></td></tr></table></figure>

<p>2、修改nagios.cfg</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vim</span> nagios.cfg</span><br></pre></td></tr></table></figure>

<p>修改如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">process_performance_data</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">service_perfdata_command</span>=process-service-perfdata</span><br><span class="line"><span class="attr">host_perfdata_command</span>=process-host-perfdata</span><br></pre></td></tr></table></figure>

<p>3、修改nagios command配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc/objects</span><br><span class="line">vim commands.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#在文件末尾追加如下几行</span></span><br><span class="line"></span><br><span class="line">define command &#123;</span><br><span class="line">command_name process-service-perfdata</span><br><span class="line">command_line <span class="regexp">/usr/</span>bin<span class="regexp">/perl /u</span>sr<span class="regexp">/local/</span>pnp4nagios<span class="regexp">/libexec/</span>process_perfdata.pl</span><br><span class="line">&#125;</span><br><span class="line">define command &#123;</span><br><span class="line">command_name process-host-perfdata</span><br><span class="line">command_line <span class="regexp">/usr/</span>bin<span class="regexp">/perl /u</span>sr<span class="regexp">/local/</span>pnp4nagios<span class="regexp">/libexec/</span>process_perfdata.pl -d HOSTPERFDATA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、修改nagios template 配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim templates.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment">#在文件末尾追加如下几行</span></span><br><span class="line"></span><br><span class="line">define host &#123;</span><br><span class="line">    name host-pnp</span><br><span class="line">    action_url <span class="regexp">/pnp4nagios/i</span>ndex.php/graph?host=<span class="variable">$HOSTNAME</span>$&amp;srv=_HOST_</span><br><span class="line">    register <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">define service &#123;</span><br><span class="line">    name srv-pnp</span><br><span class="line">    action_url <span class="regexp">/pnp4nagios/i</span>ndex.php/graph?host=<span class="variable">$HOSTNAME</span>$&amp;srv=<span class="variable">$SERVICEDESC</span>$</span><br><span class="line">    register <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、修改 hosts.cfg 和 services.cfg</p>
<p>这两个文件默认是不存在的,是用来定义你要监控的主机和服务,需要你手工创建.</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">vim hosts.cfg</span><br><span class="line"></span><br><span class="line">define host&#123;</span><br><span class="line">    use linux-server,host-pnp</span><br><span class="line">    host_name web01</span><br><span class="line">    alias pub_web01</span><br><span class="line">    address <span class="number">192.168</span><span class="number">.0</span><span class="number">.51</span></span><br><span class="line">&#125;</span><br><span class="line">define host&#123;</span><br><span class="line">    use linux-server,host-pnp</span><br><span class="line">    host_name oracle</span><br><span class="line">    alias pub_oracle</span><br><span class="line">    address <span class="number">192.168</span><span class="number">.0</span><span class="number">.180</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vim services.cfg</span><br><span class="line"></span><br><span class="line">##################### pub web01 #####################</span><br><span class="line">define service&#123;</span><br><span class="line">    use local-service,srv-pnp</span><br><span class="line">    host_name web01</span><br><span class="line">    service_description PING</span><br><span class="line">    check_command check_ping!<span class="number">100.0</span>,<span class="number">20</span>%!<span class="number">500.0</span>,<span class="number">60</span>%</span><br><span class="line">&#125;</span><br><span class="line">define service&#123;</span><br><span class="line">    use local-service,srv-pnp</span><br><span class="line">    host_name web01</span><br><span class="line">    service_description SSH</span><br><span class="line">    check_command check_ssh</span><br><span class="line">&#125;</span><br><span class="line">define service&#123;</span><br><span class="line">    use local-service,srv-pnp</span><br><span class="line">    host_name web01</span><br><span class="line">    service_description http</span><br><span class="line">    check_command check_http</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、验证配置文件,重启服务</p>
<p>2、验证nagios配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>bin<span class="regexp">/nagios -v /u</span>sr<span class="regexp">/local/</span>nagios<span class="regexp">/etc/</span>nagios.cfg</span><br></pre></td></tr></table></figure>

<p>3、重启</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">/etc/init.d/nagios restart</span><br><span class="line"></span><br><span class="line">Running configuration check...done.</span><br><span class="line">Stopping nagios: done.</span><br><span class="line">Starting nagios: done.</span><br><span class="line"></span><br><span class="line">/etc/init.d/npcd restart</span><br><span class="line"></span><br><span class="line">Stopping npcd: done.</span><br><span class="line">Starting npcd: done.</span><br></pre></td></tr></table></figure>

<p>遇到错误:<br>Please check the documentation for information about the following error.perfdata directory “/usr/local/pnp4nagios/var/perfdata/“ is empty. Please check your Nagios config. Read FAQ online</p>
<p>改pnp4nagios模式为 “Bulk-mode”.</p>
<p>编辑 <code>/usr/local/nagios/etc/nagios.cfg</code>末尾添加:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Bulk / NPCD mode</span></span><br><span class="line"><span class="attr">process_performance_data</span>=<span class="number">1</span></span><br><span class="line"><span class="comment"># *** the template definition differs from the one in the original nagios.cfg</span></span><br><span class="line"><span class="attr">service_perfdata_file</span>=/usr/local/pnp4nagios/var/service-perfdata</span><br><span class="line"><span class="attr">service_perfdata_file_template</span>=DATATYPE::SERVICEPERFDATAtTIMET::<span class="variable">$TIMET</span><span class="variable">$tHOSTNAME</span>::<span class="variable">$HOSTNAME</span><span class="variable">$tSERVICEDESC</span>::<span class="variable">$SERVICEDESC</span><span class="variable">$tSERVICEPERFDATA</span>::<span class="variable">$SERVICEPERFDATA</span><span class="variable">$tSERVICECHECKCOMMAND</span>::<span class="variable">$SERVICECHECKCOMMAND</span><span class="variable">$tHOSTSTATE</span>::<span class="variable">$HOSTSTATE</span><span class="variable">$tHOSTSTATETYPE</span>::<span class="variable">$HOSTSTATETYPE</span><span class="variable">$tSERVICESTATE</span>::<span class="variable">$SERVICESTATE</span><span class="variable">$tSERVICESTATETYPE</span>::<span class="variable">$SERVICESTATETYPE</span>$</span><br><span class="line"><span class="attr">service_perfdata_file_mode</span>=a</span><br><span class="line"><span class="attr">service_perfdata_file_processing_interval</span>=<span class="number">15</span></span><br><span class="line"><span class="attr">service_perfdata_file_processing_command</span>=process-service-perfdata-file</span><br><span class="line"><span class="comment"># *** the template definition differs from the one in the original nagios.cfg</span></span><br><span class="line"><span class="attr">host_perfdata_file</span>=/usr/local/pnp4nagios/var/host-perfdata</span><br><span class="line"><span class="attr">host_perfdata_file_template</span>=DATATYPE::HOSTPERFDATAtTIMET::<span class="variable">$TIMET</span><span class="variable">$tHOSTNAME</span>::<span class="variable">$HOSTNAME</span><span class="variable">$tHOSTPERFDATA</span>::<span class="variable">$HOSTPERFDATA</span><span class="variable">$tHOSTCHECKCOMMAND</span>::<span class="variable">$HOSTCHECKCOMMAND</span><span class="variable">$tHOSTSTATE</span>::<span class="variable">$HOSTSTATE</span><span class="variable">$tHOSTSTATETYPE</span>::<span class="variable">$HOSTSTATETYPE</span>$</span><br><span class="line"><span class="attr">host_perfdata_file_mode</span>=a</span><br><span class="line"><span class="attr">host_perfdata_file_processing_interval</span>=<span class="number">15</span></span><br><span class="line"><span class="attr">host_perfdata_file_processing_command</span>=process-host-perfdata-file</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/usr/local/nagios/etc/objects/commands.cfg</code>. 最后添加一下内容:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Bulk with NPCD mode</span></span><br><span class="line">define command &#123;</span><br><span class="line">    command_name process-service-perfdata-file</span><br><span class="line">    command_line <span class="regexp">/bin/m</span>v <span class="regexp">/usr/</span>local<span class="regexp">/pnp4nagios/</span>var<span class="regexp">/service-perfdata /u</span>sr<span class="regexp">/local/</span>pnp4nagios<span class="regexp">/var/</span>spool/service-perfdata.<span class="variable">$TIMET</span>$</span><br><span class="line">&#125;</span><br><span class="line">define command &#123;</span><br><span class="line">    command_name process-host-perfdata-file</span><br><span class="line">    command_line <span class="regexp">/bin/m</span>v <span class="regexp">/usr/</span>local<span class="regexp">/pnp4nagios/</span>var<span class="regexp">/host-perfdata /u</span>sr<span class="regexp">/local/</span>pnp4nagios<span class="regexp">/var/</span>spool/host-perfdata.<span class="variable">$TIMET</span>$</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启 npcd and nagios:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">service npcd <span class="built_in">restart</span> &amp;&amp; service nagios <span class="built_in">restart</span></span><br></pre></td></tr></table></figure>

<p>正常.</p>
<p>nrpe监控安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nagios-plugins-nrpe nrpe</span><br></pre></td></tr></table></figure>

<p>修改nrpe配置文件,加入允许的IP:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi<span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc/nrpe.cfg</span><br><span class="line">allowed_hosts=<span class="number">127.0</span>.<span class="number">0.1</span>,<span class="number">192.169</span>.<span class="number">0.201</span></span><br></pre></td></tr></table></figure>

<p>启动nrpe:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>bin<span class="regexp">/nrpe -c/u</span>sr<span class="regexp">/local/</span>nagios<span class="regexp">/etc/</span>nrpe.cfg –d</span><br></pre></td></tr></table></figure>

<p>在监控主机(200)上执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>libexec/check_nrpe-H <span class="number">192.168</span>.<span class="number">30.150</span> <span class="comment">#安装nrpe的被监控主机</span></span><br></pre></td></tr></table></figure>

<p>如果成功会显示:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NRPE</span> v<span class="number">2</span>.<span class="number">13</span></span><br></pre></td></tr></table></figure>

<p>编写测试代码(监控150负载均衡)</p>
<p>在监控主机上(200)编辑 <code>/usr/local/nagios/etc/objects/commands.cfg</code>,加入如下命令:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &#x27;check_nrp&#x27; command definition</span></span><br><span class="line">define command&#123;</span><br><span class="line">    command_name check_nrpe</span><br><span class="line">    command_line <span class="variable">$USER1</span><span class="variable">$/</span>check_nrpe -H <span class="variable">$HOSTADDRESS</span><span class="variable">$ </span>-c <span class="variable">$ARG1</span><span class="variable">$</span></span><br><span class="line"><span class="variable"></span>&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>/usr/local/nagios/etc/objects</code>中添加文件150.cfg,对于每一台机器可以添加一个文件:</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">define host&#123;</span><br><span class="line">    use generic-host</span><br><span class="line">    host_name 150</span><br><span class="line">    alias 150</span><br><span class="line">    address 192.168.30.150 ;被测试机ip</span><br><span class="line">    max_check_attempts 10</span><br><span class="line">    check_command<span class="built_in"> check-host-alive </span>; Default command to<span class="built_in"> check </span>if servers are <span class="string">&quot;alive&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">define service&#123;</span><br><span class="line">    use generic-service</span><br><span class="line">    host_name 150</span><br><span class="line">    service_description nrpe_load</span><br><span class="line">    check_command check_nrpe!check_load</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>检测配置是否正确后,重启nagios.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>bin<span class="regexp">/nagios -v /u</span>sr<span class="regexp">/local/</span>nagios<span class="regexp">/etc/</span>nagios.cfg</span><br><span class="line">service nagios restart</span><br></pre></td></tr></table></figure>

<p>报错NRPE: Unable to read output解决办法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc/nrpe.cfg</span><br><span class="line"></span><br><span class="line">command[check_mysql_myisam_lock]=<span class="regexp">/usr/</span>bin<span class="regexp">/sudo /u</span>sr<span class="regexp">/local/</span>nagios<span class="regexp">/libexe/</span>check_mysql_myisam_lock.sh -w <span class="number">1</span> -c <span class="number">1</span> <span class="comment"># 修正命令路径 参数</span></span><br></pre></td></tr></table></figure>

<p>主监控端 commend里面的commond-line命令要正确.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装keepalived</title>
    <url>/2013/12/25/1102/</url>
    <content><![CDATA[<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> keepalived</span><br></pre></td></tr></table></figure>

<p>编辑keepalived.conf</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">vi /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id bj_ifc_ngix</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    <span class="keyword">interface</span> <span class="symbol">eth0</span></span><br><span class="line">    <span class="symbol">virtual_router_id</span> <span class="symbol">50</span></span><br><span class="line">    <span class="symbol">priority</span> <span class="symbol">90</span></span><br><span class="line">    <span class="symbol">advert_int</span> <span class="symbol">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">authentication</span> &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass <span class="number">314159</span></span><br><span class="line">&#125;</span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.253</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>state 2个都写成backup 让2台机器通过priority的优先级去抢主 ,优先级高的是主,最下面的IP我设定的是和eth0IP一个网段的,通过service keepalived start 启动服务,直接ping 253,如果通,那证明虚拟IP成功.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS安装Nagios网络监视工具</title>
    <url>/2017/05/02/1106/</url>
    <content><![CDATA[<p>Nagios是一款开源的免费网络监视工具,能有效监控Windows、Linux和Unix的主机状态,交换机路由器等网络设置,打印机等.在系统或服务状态异常时发出邮件或短信报警第一时间通知网站运维人员,在状态恢复后发出正常的邮件或短信通知.下面学习如何在CentOS上安装此软件.<br>安装完成后的一些情况<br># Nagios以及插件将安装在 <code>/usr/local/nagios</code>目录<br># Nagios会配置监控本地机器几个方面(CPU负载,磁盘使用率等)<br>Nagios可以通过<a href="http://localhost/nagios/">http://localhost/nagios/</a> 访问</p>
<p>准备工作</p>
<p>需要以root身份安装Nagios.<br>确保在CentOS安装了下面几个软件包:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># Apache</span></span><br><span class="line"><span class="meta"># PHP</span></span><br><span class="line"><span class="meta"># GCC compiler</span></span><br><span class="line"><span class="meta"># GD development libraries</span></span><br></pre></td></tr></table></figure>

<p>你可以通过yum完成这些安装工作:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> httpd php</span><br><span class="line">yum <span class="keyword">install</span> gcc glibc glibc-common</span><br><span class="line">yum <span class="keyword">install</span> gd gd-devel</span><br></pre></td></tr></table></figure>

<p>开始安装Nagios<br>创建帐号<br>创建 nagios用户并设置密码:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>sbin/useradd -m nagios</span><br><span class="line">passwd nagios</span><br></pre></td></tr></table></figure>

<p>创建nagcmd用户组以执行来自web接口的命令,并添加nagios和apache用户到此用户组.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>sbin/groupadd nagcmd</span><br><span class="line"><span class="regexp">/usr/</span>sbin/usermod -a -G nagcmd nagios</span><br><span class="line"><span class="regexp">/usr/</span>sbin/usermod -a -G nagcmd apache</span><br></pre></td></tr></table></figure>

<p>下载Nagios和插件</p>
<p>创建下载存储目录:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mkdir ~<span class="string">/downloads</span></span><br><span class="line"><span class="keyword">cd</span> ~<span class="string">/downloads</span></span><br></pre></td></tr></table></figure>

<p>从网站<a href="http://www.nagios.org/download/">http://www.nagios.org/download/</a> 下载Nagios以及插件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>prdownloads.sourceforge.net<span class="regexp">/sourceforge/</span>nagios/nagios-<span class="number">3.3</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">wget http:<span class="regexp">//</span>prdownloads.sourceforge.net<span class="regexp">/sourceforge/</span>nagiosplug/nagios-plugins-<span class="number">1.4</span>.<span class="number">15</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>编译安装Nagios</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> ~/downloads</span><br><span class="line"><span class="attribute">tar</span> xzf nagios-<span class="number">3</span>.<span class="number">3</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> nagios</span><br></pre></td></tr></table></figure>

<p>运行Nagios配置脚本,并把nagcmd更改为之前所创建的组.</p>
<figure class="highlight capnproto"><table><tr><td class="code"><pre><span class="line">./configure --<span class="keyword">with</span>-command-<span class="keyword">group</span>=nagcmd</span><br></pre></td></tr></table></figure>

<p>编译源码:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">make</span> <span class="keyword">all</span></span><br></pre></td></tr></table></figure>

<p>安装二进制,init脚本,sample配置文件和设置外部命令目录权限.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">make <span class="keyword">install</span></span><br><span class="line">make <span class="keyword">install</span>-init</span><br><span class="line">make <span class="keyword">install</span>-config</span><br><span class="line">make <span class="keyword">install</span>-commandmode</span><br></pre></td></tr></table></figure>

<p>不要现在执行nagios,下面还有一些需要配置.<br>定制配置</p>
<p>样式配置文件已经安装在 <code>/usr/local/nagios/etc</code>目录,你仅仅需要更改email地址.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc<span class="regexp">/objects/</span>contacts.cfg</span><br></pre></td></tr></table></figure>

<p>配置web接口</p>
<p>安装Nagios Web配置文件在Apache的conf.d目录:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">make <span class="keyword">install</span>-webconf</span><br></pre></td></tr></table></figure>

<p>为登录Nagios Web接口创建nagiosadmin帐号.记住下面你设置的密码,之后登录用到.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">htpasswd -c <span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc/htpasswd.users nagiosadmin</span><br></pre></td></tr></table></figure>

<p>重启Apache使新配置生效.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service httpd restart</span></span><br></pre></td></tr></table></figure>

<p>编译安装Nagios插件</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> ~/downloads</span><br><span class="line"><span class="attribute">tar</span> xzf nagios-plugins-<span class="number">1</span>.<span class="number">4</span>.<span class="number">15</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> nagios-plugins-<span class="number">1</span>.<span class="number">4</span>.<span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>编译安装Nagios插件:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">./configure <span class="attribute">--with-nagios-user</span>=nagios <span class="attribute">--with-nagios-group</span>=nagios</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>启动Nagios</p>
<p>设置开机启动:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">chkconfig <span class="comment">--add nagios</span></span><br><span class="line">chkconfig nagios <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>测试配置文件是否有错误:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>bin<span class="regexp">/nagios -v /u</span>sr<span class="regexp">/local/</span>nagios<span class="regexp">/etc/</span>nagios.cfg</span><br></pre></td></tr></table></figure>

<p>如果没有,立即启动Nagios</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service nagios <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>登录Nagios</p>
<p>安装已经完成,你可以使用nagiosadmin用户以及之前设置的密码通过<a href="http://localhost/nagios/">http://localhost/nagios/</a> 地址登录Nagios后台.下次学习Nagios的使用.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装nfs</title>
    <url>/2012/12/31/1107/</url>
    <content><![CDATA[<p>NFS服务器:</p>
<p>操作系统:CentOS 5.5<br>IP:192.168.21.160<br>nfs网络文件服务器共享目录:<code>/data/osyunwei</code></p>
<p>NFS客户端:<br>操作系统:CentOS 5.5<br>IP:192.168.21.169<br>把NFS服务器上的目录 <code>/data/osyunwei</code>挂载到本地目录 <code>/data/osyunwei</code>中.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/data/</span>osyunwei</span><br></pre></td></tr></table></figure>

<p>安装NFS服务器:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -q nfs-utils portmap <span class="comment">#检查是否安装,注意:在CentOS 6.x中portmap的名称变为rpcbind</span></span><br></pre></td></tr></table></figure>

<p>出现下面的提示说明安装成功,备注:CentOS默认已经安装了nfs服务.</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">yum install nfs-utils rpcbind <span class="comment">#安装</span></span><br><span class="line"></span><br><span class="line">vi /etc/sysconfig/nfs <span class="comment">#编辑配置文件</span></span><br><span class="line"></span><br><span class="line">RQUOTAD_PORT=875 <span class="comment">#取消前面的注释</span></span><br><span class="line">LOCKD_TCPPORT=32803 <span class="comment">#取消前面的注释</span></span><br><span class="line">LOCKD_UDPPORT=32769 <span class="comment">#取消前面的注释</span></span><br><span class="line">MOUNTD_PORT=892 <span class="comment">#取消前面的注释</span></span><br><span class="line">STATD_PORT=1001 <span class="comment">#取消前面的注释,端口修改为1001</span></span><br><span class="line">STATD_OUTGOING_PORT=1004 <span class="comment">#取消前面的注释,端口修改为1004</span></span><br><span class="line"></span><br><span class="line">:wq! <span class="comment">#保存退出</span></span><br></pre></td></tr></table></figure>

<p>配置nfs:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>exports <span class="comment">#编辑配置文件,添加以下内容</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/test/</span> <span class="number">192.168</span>.<span class="number">1.226</span>(insecure,rw,no_root_squash,no_all_squash,sync)</span><br><span class="line"></span><br><span class="line">:x保存退出;</span><br></pre></td></tr></table></figure>

<p>使配置生效:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@centos2</span> /]<span class="variable">$ </span>exportfs -r</span><br></pre></td></tr></table></figure>

<p>注:配置文件说明:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/test/</span> 为共享的目录,使用绝对路径.</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.226</span>(rw,no_root_squash,no_all_squash,sync) 为客户端的地址及权限,地址可以是一个网段,一个IP地址或者是一个域名,域名支持通配符,如:*.youxia.com,地址与权限中间没有空格,权限说明:</span><br><span class="line"><span class="symbol">rw:</span>read-write,可读写;</span><br><span class="line"><span class="symbol">ro:</span>read-only,只读;</span><br><span class="line"><span class="symbol">sync:</span>文件同时写入硬盘和内存;</span><br><span class="line"><span class="symbol">async:</span>文件暂存于内存,而不是直接写入内存;</span><br><span class="line"><span class="symbol">no_root_squash:</span>NFS客户端连接服务端时如果使用的是root的话,那么对服务端分享的目录来说,也拥有root权限.显然开启这项是不安全的.</span><br><span class="line"><span class="symbol">root_squash:</span>NFS客户端连接服务端时如果使用的是root的话,那么对服务端分享的目录来说,拥有匿名用户权限,通常他将使用nobody或nfsnobody身份;</span><br><span class="line"><span class="symbol">all_squash:</span>不论NFS客户端连接服务端时使用什么用户,对服务端分享的目录来说都是拥有匿名用户权限;</span><br><span class="line"><span class="symbol">anonuid:</span>匿名用户的UID值,通常是nobody或nfsnobody,可以在此处自行设定;</span><br><span class="line"><span class="symbol">anongid:</span>匿名用户的GID值.</span><br></pre></td></tr></table></figure>

<p>启动服务(注意顺序不能错)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>rpcbind start</span><br><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>nfslock start</span><br><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>nfs start</span><br><span class="line">chkconfig rpcbind on <span class="comment">#设置开机启动</span></span><br><span class="line">chkconfig nfslock on <span class="comment">#设置开机启动,开启此服务保持数据一致</span></span><br><span class="line">chkconfig nfs on <span class="comment">#设置开机启动</span></span><br></pre></td></tr></table></figure>

<p>要停止服务,执行下面的命令(注意顺序不能错)</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">service nfslock stop</span><br><span class="line">service nfs stop</span><br><span class="line">service rpcbind stop</span><br></pre></td></tr></table></figure>

<p>配置NFS客户端:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -q nfs-utils portmap <span class="comment">#检查是否安装,注意:在CentOS 6.x中portmap的名称变为rpcbind</span></span><br></pre></td></tr></table></figure>

<p>出现下面的提示说明安装成功:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nfs</span>-utils-<span class="number">1</span>.<span class="number">0</span>.<span class="number">9</span>-<span class="number">60</span>.el<span class="number">5</span></span><br><span class="line"><span class="attribute">portmap</span>-<span class="number">4</span>.<span class="number">0</span>-<span class="number">65.2.2.1</span></span><br></pre></td></tr></table></figure>

<p>备注:CentOS默认已经安装了nfs服务,如果没有安装,执行下面的命令.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nfs-utils portmap <span class="comment">#安装</span></span><br></pre></td></tr></table></figure>

<p>启动服务(注意顺序不能错):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>rpcbind start</span><br><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>nfslock start</span><br><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>nfs start</span><br><span class="line">chkconfig rpcbind on <span class="comment">#设置开机启动</span></span><br><span class="line">chkconfig nfslock on <span class="comment">#设置开机启动,开启此服务保持数据一致</span></span><br><span class="line">chkconfig nfs on <span class="comment">#设置开机启动</span></span><br></pre></td></tr></table></figure>

<p>要停止服务,执行下面的命令(注意顺序不能错):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">service nfslock stop</span><br><span class="line">service nfs stop</span><br><span class="line">service rpcbind stop</span><br><span class="line">showmount -e <span class="number">192.168</span>.<span class="number">21.160</span> <span class="comment">#显示server上面共享的目录,会出现下面的提示</span></span><br><span class="line">Export list <span class="keyword">for</span> <span class="number">192.168</span>.<span class="number">21.160</span>:</span><br><span class="line"><span class="regexp">/data/</span>osyunwei <span class="number">192.168</span>.<span class="number">21.0</span>/<span class="number">24</span></span><br><span class="line">mount -t nfs <span class="number">192.168</span>.<span class="number">21.160</span>:<span class="regexp">/data/</span>osyunwei <span class="regexp">/data/</span>osyunwei</span><br><span class="line"><span class="comment">#客户端挂载NFS服务器共享目录,第一个目录是nfs服务器共享目录,第二个目录是客户端本地目录</span></span><br></pre></td></tr></table></figure>

<p>如果要卸载目录,执行下面命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">umount <span class="regexp">/data/</span>osyunwei <span class="comment">#卸载目录挂载</span></span><br></pre></td></tr></table></figure>

<p>至此,CentOS配置NFS服务器教程完成.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装nginx的web环境</title>
    <url>/2013/07/22/1108/</url>
    <content><![CDATA[<p>为什么要用nginx呢,apache处理动态页面确实不错,但是它占用资源确实是太大了.<br>而lighttpd据说存在大并发的时候内存溢出,所以综合考虑nginx是个不错的选择.<br>编译安装太麻烦,用一键安装包又慢的要死要死的.这里使用的yum安装,很方便.</p>
<p>1、导入外部软件库</p>
<p>centos-5 32位:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http:<span class="regexp">//</span>dl.iuscommunity.org<span class="regexp">/pub/iu</span>s<span class="regexp">/stable/</span>Redhat<span class="regexp">/5/i</span>386/epel-release-<span class="number">5</span>-<span class="number">4</span>.noarch.rpm</span><br><span class="line">rpm -Uvh http:<span class="regexp">//</span>dl.iuscommunity.org<span class="regexp">/pub/iu</span>s<span class="regexp">/stable/</span>Redhat<span class="regexp">/5/i</span>386/ius-release-<span class="number">1.0</span>-<span class="number">10</span>.ius.el5.noarch.rpm</span><br><span class="line">rpm -Uvh http:<span class="regexp">//</span>nginx.org<span class="regexp">/packages/</span>centos<span class="regexp">/5/</span>noarch<span class="regexp">/RPMS/</span>nginx-release-centos-<span class="number">5</span>-<span class="number">0</span>.el5.ngx.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>centos-5 64位:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http:<span class="regexp">//</span>dl.iuscommunity.org<span class="regexp">/pub/iu</span>s<span class="regexp">/stable/</span>Redhat<span class="regexp">/5/</span>x86_64/epel-release-<span class="number">5</span>-<span class="number">4</span>.noarch.rpm</span><br><span class="line">rpm -Uvh http:<span class="regexp">//</span>dl.iuscommunity.org<span class="regexp">/pub/iu</span>s<span class="regexp">/stable/</span>Redhat<span class="regexp">/5/</span>x86_64/ius-release-<span class="number">1.0</span>-<span class="number">10</span>.ius.el5.noarch.rpm</span><br><span class="line">rpm -Uvh http:<span class="regexp">//</span>nginx.org<span class="regexp">/packages/</span>centos<span class="regexp">/5/</span>noarch<span class="regexp">/RPMS/</span>nginx-release-centos-<span class="number">5</span>-<span class="number">0</span>.el5.ngx.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/yum.repos.d/ius.repo</code>,注释以下行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mirrorlist=http:<span class="regexp">//</span>dmirr.iuscommunity.org/mirrorlist?repo=ius-el5&amp;arch=<span class="variable">$basearch</span></span><br></pre></td></tr></table></figure>

<p>删除注释以下行:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#baseurl=http:<span class="comment">//dl.iuscommunity.org/pub/ius/stable/Redhat/5/$basearch</span></span></span><br></pre></td></tr></table></figure>

<p>2、yum安装lnmp</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install mysql<span class="number">55</span>-server mysql<span class="number">55</span> php<span class="number">53</span>u-fpm php<span class="number">53</span>u-mysql nginx</span><br></pre></td></tr></table></figure>

<p>3、配置lnmp</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/conf.d/</span><span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure>

<p>修改为:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ .php$</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /usr/share/nginx/html$fastcgi_script_name;</span><br><span class="line">    <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、启动lnmp</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">chkconfig php-fpm <span class="keyword">on</span></span><br><span class="line">chkconfig nginx <span class="keyword">on</span></span><br><span class="line">chkconfig mysqld <span class="keyword">on</span></span><br><span class="line">service php-fpm <span class="built_in">start</span></span><br><span class="line">service nginx <span class="built_in">start</span></span><br><span class="line">service mysqld <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p>这样基于nginx的web环境就搭建好了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装sersync</title>
    <url>/2018/06/14/1111/</url>
    <content><![CDATA[<p>在同步服务器上开启sersync,将监控路径中的文件同步到目标服务器,因此需要在同步服务器配置sersync,在同步目标服务器配置rsync.</p>
<p>一、同步目标服务器配置rsync</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">rpm -qa |grep rsync</span><br><span class="line">rsync-2.6.8-3.1</span><br><span class="line">rpm -<span class="keyword">e</span> rsync-2.6.8-3.1</span><br><span class="line">#unistall系统自带安装的rsync,安装3.0版的rsync</span><br><span class="line">wget -c http:<span class="comment">//rsync.samba.org/ftp/rsync/rsync-3.0.8.tar.gz</span></span><br><span class="line">tar xf rsync-3.0.8.tar.gz</span><br><span class="line">./configure --prefix=/usr &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi /etc/rsyncd.<span class="keyword">conf</span></span><br><span class="line">#添加下面的代码到rsyncd.<span class="keyword">conf</span>中</span><br><span class="line"></span><br><span class="line">uid = nobody</span><br><span class="line">gid = nobody</span><br><span class="line"><span class="keyword">use</span> chroot = <span class="keyword">no</span></span><br><span class="line">strict modes = yes</span><br><span class="line">max connections = 200</span><br><span class="line">pid <span class="keyword">file</span> = /<span class="keyword">var</span>/<span class="keyword">run</span>/rsyncd.pid</span><br><span class="line">lock <span class="keyword">file</span> = /<span class="keyword">var</span>/<span class="keyword">run</span>/rsync.lock</span><br><span class="line"><span class="keyword">log</span> <span class="keyword">file</span> = /<span class="keyword">var</span>/<span class="keyword">log</span>/rsyncd.<span class="keyword">log</span></span><br><span class="line">[<span class="keyword">test</span>]</span><br><span class="line">path = /home/</span><br><span class="line">comment = <span class="keyword">test</span></span><br><span class="line"><span class="keyword">read</span> only = <span class="keyword">no</span></span><br><span class="line">write only = <span class="keyword">no</span></span><br><span class="line">ignore errors = yes</span><br><span class="line"><span class="keyword">list</span> = yes</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br></pre></td></tr></table></figure>

<p>启动rsync服务:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">rsync <span class="comment">--daemon</span></span><br></pre></td></tr></table></figure>

<p>二、配置sersync2</p>
<p>sersync2是金山逍遥网技术支持部平台组周洋童鞋,开发的一款基于 inotify + rsync 的大量文件的多服务器自动同步程序,目前已开源,开源协议为 New BSD License,项目的下载地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>code.google.com<span class="regexp">/p/</span>sersync/</span><br></pre></td></tr></table></figure>

<p>这个配置超简单的,下载文件,解压即可.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> -c http://sersync.googlecode.com/files/sersync<span class="number">2</span>.<span class="number">5</span>_<span class="number">64</span>bit_binary_stable_final.tar.gz</span><br><span class="line"><span class="attribute">tar</span> xf sersync<span class="number">2</span>.<span class="number">5</span>_<span class="number">64</span>bit_binary_stable_final.tar.gz</span><br><span class="line"><span class="attribute">cd</span> GNU-Linux-x<span class="number">86</span></span><br><span class="line"><span class="attribute">mkdir</span> /etc/sersync<span class="number">2</span></span><br><span class="line"><span class="attribute">cp</span> confxml.xml /etc/sersync<span class="number">2</span></span><br><span class="line"><span class="attribute">cp</span> sersync<span class="number">2</span> /usr/bin</span><br></pre></td></tr></table></figure>

<p>配置sersync2:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sersync</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localpath</span> <span class="attr">watch</span>=<span class="string">&quot;/data/bb&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">remote</span> <span class="attr">ip</span>=<span class="string">&quot;192.168.1.4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">remote</span> <span class="attr">ip</span>=<span class="string">&quot;192.168.1.6&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;remote ip=&quot;192.168.8.40&quot; name=&quot;tongbu&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">localpath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rsync</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">commonParams</span> <span class="attr">params</span>=<span class="string">&quot;-artuz&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">auth</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span> <span class="attr">users</span>=<span class="string">&quot;root&quot;</span> <span class="attr">passwordfile</span>=<span class="string">&quot;/etc/rsync.pas&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">userDefinedPort</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span> <span class="attr">port</span>=<span class="string">&quot;874&quot;</span>/&gt;</span><span class="comment">&lt;!-- port=874 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">timeout</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span> <span class="attr">time</span>=<span class="string">&quot;100&quot;</span>/&gt;</span><span class="comment">&lt;!-- timeout=100 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ssh</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rsync</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">failLog</span> <span class="attr">path</span>=<span class="string">&quot;/var/log/rsync_fail.log&quot;</span> <span class="attr">timeToExecute</span>=<span class="string">&quot;60&quot;</span>/&gt;</span><span class="comment">&lt;!--default every 60mins execute once--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">crontab</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span> <span class="attr">schedule</span>=<span class="string">&quot;600&quot;</span>&gt;</span><span class="comment">&lt;!--600mins--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">crontabfilter</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span> <span class="attr">expression</span>=<span class="string">&quot;*.php&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span> <span class="attr">expression</span>=<span class="string">&quot;info/*&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">crontabfilter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">crontab</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">start</span>=<span class="string">&quot;false&quot;</span> <span class="attr">name</span>=<span class="string">&quot;command&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sersync</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>表明要将同步服务器上本地的/data/bb 路径下的文件,同步到远程服务器 192.168.1.4 与 192.168.1.6上的test 模块下.<br>接下来,运行sersync2：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sersync2 -r -o <span class="regexp">/etc/</span>sersync2/confxml.xml</span><br><span class="line"><span class="comment">#-r 在开启实时监控之前对同步服务器目录与远程目标机目录进行一次整体同步</span></span><br></pre></td></tr></table></figure>

<p>运行完了输出：</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> the system param</span><br><span class="line">execute:echo <span class="number">50000000</span> &gt; /<span class="keyword">proc</span>/sys/fs/inotify/max_user_watches<span class="title"></span></span><br><span class="line"><span class="title">execute:echo</span> 327679 &gt; /<span class="keyword">proc</span>/sys/fs/inotify/max_queued_events<span class="title"></span></span><br><span class="line"><span class="title">parse</span> the<span class="title"> command</span> param<span class="title"></span></span><br><span class="line"><span class="title">option:</span> -r<span class="title"> rsync</span> all<span class="title"> the</span> local<span class="title"> files</span> to<span class="title"> the</span> remote<span class="title"> servers</span> before<span class="title"> the</span> sersync<span class="title"> work</span></span><br><span class="line">option: -d<span class="title"> run</span> as<span class="title"> a</span> daemon<span class="title"></span></span><br><span class="line"><span class="title">option:</span> -o<span class="title"> config</span> xml<span class="title"> name:</span> /etc/sersync2/confxml.xml<span class="title"></span></span><br><span class="line"><span class="title">daemon</span> thread<span class="title"> num:</span> 10<span class="title"></span></span><br><span class="line"><span class="title">parse</span> xml<span class="title"> config</span> file<span class="title"></span></span><br><span class="line"><span class="title">host</span> ip :<span class="title"> localhost</span> host<span class="title"> port:</span> 8008<span class="title"></span></span><br><span class="line"><span class="title">daemon</span> start,sersync<span class="title"> run</span> behind<span class="title"> the</span> console<span class="title"></span></span><br><span class="line"><span class="title">config</span> xml<span class="title"> parse</span> success<span class="title"></span></span><br><span class="line"><span class="title">please</span> set /etc/rsyncd.conf<span class="title"> max</span> connections=0<span class="title"> Manually</span></span><br><span class="line">sersync<span class="title"> working</span> thread 112 = 1(primary<span class="title"> thread)</span> + 1(fail<span class="title"> retry</span> thread) + 10(daemon<span class="title"> sub</span> threads)<span class="title"></span></span><br><span class="line"><span class="title">Max</span> threads<span class="title"> numbers</span> is: 32 = 12(Thread<span class="title"> pool</span> nums) + 20(Sub<span class="title"> threads)</span></span><br><span class="line">please<span class="title"> according</span> your<span class="title"> cpu</span> ,use -n<span class="title"> param</span> to<span class="title"> adjust</span> the<span class="title"> cpu</span> rate<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">rsync</span> the<span class="title"> directory</span> recursivly<span class="title"> to</span> the<span class="title"> remote</span> servers<span class="title"> once</span></span><br><span class="line">working<span class="title"> please</span> wait...<span class="title"></span></span><br><span class="line"><span class="title">execute</span> command:<span class="title"> cd</span> /data/bb &amp;&amp;<span class="title"> rsync</span> -artuz -R --delete ./ 192.168.1.4::test &gt;/dev/null 2&gt;&amp;1<span class="title"></span></span><br><span class="line"><span class="title">run</span> the<span class="title"> sersync:</span></span><br><span class="line">watch<span class="title"> path</span> is: /data/bb<span class="title"></span></span><br><span class="line"><span class="title">sersync2的参数</span></span><br><span class="line">sersync2 -h<span class="title"></span></span><br><span class="line"><span class="title">set</span> the<span class="title"> system</span> param<span class="title"></span></span><br><span class="line"><span class="title">execute:echo</span> 50000000 &gt; /<span class="keyword">proc</span>/sys/fs/inotify/max_user_watches<span class="title"></span></span><br><span class="line"><span class="title">execute:echo</span> 327679 &gt; /<span class="keyword">proc</span>/sys/fs/inotify/max_queued_events<span class="title"></span></span><br><span class="line"><span class="title">parse</span> the<span class="title"> command</span> param</span><br></pre></td></tr></table></figure>

<p>参数含义:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#参数-d:启用守护进程模式</span></span><br><span class="line"><span class="meta">#参数-r:在监控前,将监控目录与远程主机用rsync命令推送一遍</span></span><br><span class="line"><span class="meta">#参数-n: 指定开启守护线程的数量,默认为10个</span></span><br><span class="line"><span class="meta">#参数-o:指定配置文件,默认使用confxml.xml文件</span></span><br><span class="line"><span class="meta">#参数-m:单独启用其他模块,使用 -m refreshCDN 开启刷新CDN模块</span></span><br><span class="line"><span class="meta">#参数-m:单独启用其他模块,使用 -m socket 开启socket模块</span></span><br><span class="line"><span class="meta">#参数-m:单独启用其他模块,使用 -m http 开启http模块</span></span><br><span class="line"><span class="meta">#不加-m参数,则默认执行同步程序</span></span><br></pre></td></tr></table></figure>

<p>索性一次性运行：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sersync2 -r -d -o <span class="regexp">/etc/</span>sersync2/confxml.xml</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装opensips网络电话</title>
    <url>/2012/03/01/1109/</url>
    <content><![CDATA[<p>1.mysql安装(因opensips添加鉴权用户需使用mysql存储)</p>
<p>下载资源文件都放在 <code>/usr/src/</code>为例.</p>
<p>命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://dev.mysql.com/get/mysql-community-release-el<span class="number">7</span>-<span class="number">5</span>.noarch.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh mysql-community-release-el<span class="number">7</span>-<span class="number">5</span>.noarch.rpm</span><br><span class="line"><span class="attribute">yum</span> install mysql-community-server</span><br></pre></td></tr></table></figure>

<p>安装后启动:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service mysqld restart</span></span><br></pre></td></tr></table></figure>

<p>登陆mysql:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql -u root</span> </span><br></pre></td></tr></table></figure>

<p>修改密码:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> <span class="keyword">for</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> =<span class="keyword">password</span>(<span class="string">&#x27;password***&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>注:最好不要修改mysql端口.</p>
<p>2.安装opensips</p>
<p>安装依赖库:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install </span>mysql mysql-server mysql-libs mysql-devel</span><br><span class="line">yum <span class="keyword">install </span>gcc make</span><br><span class="line">yum <span class="keyword">install </span>flex <span class="keyword">bison </span>ncurses libncurses-dev ncurses-devel</span><br></pre></td></tr></table></figure>

<p>下载并解压opensips的源码(最新版本2.4.3,如果发现版本已更新可以去官网查看最新版本路径):</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /usr/src</span><br><span class="line"><span class="attribute">wget</span> http://opensips.org/pub/opensips/latest/opensips-<span class="number">2</span>.<span class="number">4</span>.<span class="number">3</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> zxvf opensips-<span class="number">2</span>.<span class="number">4</span>.<span class="number">3</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> opensips-<span class="number">2</span>.<span class="number">4</span>.<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>切换到root用户:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su</span></span><br></pre></td></tr></table></figure>

<p>启动配置菜单:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">make menuconfig</span></span><br></pre></td></tr></table></figure>

<p>重点:很多教程都没表明这个选择步骤:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">Configure Compile <span class="keyword">Options</span> -&gt; Configure Excluded <span class="keyword">Modules</span> -&gt; db_mysql</span><br></pre></td></tr></table></figure>

<p>按照此顺序选择db_mysql  (空格键为选择键方向键为前进后退和确定)<br>选择db_mysql后一定要save.<br>最后选择”Compile And Install Opensips” 等待安装完毕.<br>安装完成后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>opensips/</span><br><span class="line">vi opensipsctlrc</span><br></pre></td></tr></table></figure>

<p>编辑配置数据库信息:(需要修改的要按照自己情况修改比如 host password等)</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">SIP_DOMAIN</span>= YOUR_PC_IP   //此处写本机地址,如果有代理填写proxy地址</span><br><span class="line"><span class="comment">#数据库 MYSQL ORACLE PGSQL DB_BERKELEY DBTEXT均可</span></span><br><span class="line"><span class="attr">DBENGINE</span>=MYSQL</span><br><span class="line"><span class="comment">#数据库所在服务器主机名/IP均可</span></span><br><span class="line"><span class="attr">DBHOST</span>=localhost</span><br><span class="line"><span class="comment">#数据库名称,默认使用opensips,可配置其它名称</span></span><br><span class="line"><span class="attr">DBNAME</span>=opensips</span><br><span class="line"><span class="comment">#数据库访问用户,主要用于数据的读写,请在mysql添加用户</span></span><br><span class="line"><span class="attr">DBWUSER</span>=opensips</span><br><span class="line"><span class="comment">#数据库访问密码,密码必须为DBWUSER对应用户的密码</span></span><br><span class="line"><span class="attr">DBWPW</span>=<span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="comment">#数据库管理用户,用于数据库、表创建与数据读写等,默认使用root,如有需要可以自行配置mysql用户权限</span></span><br><span class="line"><span class="attr">DBROOTUSER</span>=<span class="string">&quot;root&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置opensips:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span></span><br><span class="line">osipsconfig</span><br></pre></td></tr></table></figure>

<p>依次选择–&gt; Generate OpenSIPS Script –&gt; Residential Script–&gt; Configure Residential Script<br>选中(选择键为空格键)</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="string">[*]</span> USE_AUTH</span><br><span class="line"><span class="string">[*]</span> USE_DBACC</span><br><span class="line"><span class="string">[*]</span> USE_DBUSERLOC</span><br><span class="line"><span class="string">[*]</span> USE_DIALOG</span><br></pre></td></tr></table></figure>

<p>返回,选择 –&gt; Generate Residential Script 回车,生成新的配置文件(在 <code>/usr/local/etc/opensips/</code>目录下)<br>拷贝和替换原有配置文件:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /usr/local/etc/opensips/</span><br><span class="line"><span class="attribute">mv</span> opensips.cfg opensips.cfg.old</span><br><span class="line"><span class="attribute">mv</span> opensips_residential_<span class="number">2018</span>-<span class="number">5</span>-<span class="number">3</span>_<span class="number">1</span>\:<span class="number">13</span>\:<span class="number">3</span>.cfg opensips.cfg</span><br></pre></td></tr></table></figure>

<p>修改opensips.cfg:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> opensips.cfg</span><br><span class="line"></span><br><span class="line"><span class="attribute"><span class="nomarkup">listen</span></span>=udp:<span class="number">127.0.0.1:5060</span></span><br></pre></td></tr></table></figure>

<p>修改为:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">listen</span></span>=udp:本机ip:<span class="number">5060</span></span><br></pre></td></tr></table></figure>

<p>修改完数据库配置后使用opensipsdbctl新建数据库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local/sbin</span><br><span class="line">opensipsdbctl create</span><br></pre></td></tr></table></figure>

<p>增加用户(add后第一个是用户名第二个是密码):</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">opensipsctl</span> add <span class="number">101</span> <span class="number">101</span></span><br><span class="line"><span class="attribute">opensipsctl</span> add <span class="number">102</span> <span class="number">102</span></span><br></pre></td></tr></table></figure>

<p>启动opensipsctl:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">opensipsctl <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>此时可以使用sip客户端检查下server运行情况.</p>
<p>opensipsdbctl create 时出现:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>could not load the script in /usr/local//lib64/opensips/opensipsctl/opensipsdbctl.mysql for database engine MYSQL</span><br><span class="line"><span class="keyword">ERROR: </span>database engine not loaded - tried &#x27;MYSQL&#x27;</span><br></pre></td></tr></table></figure>

<p>因为没有在配置make menuconfig时选择db_mysql可以使用以下命令或者重新做一次配置.<br>cd /usr/local/lib/opensips/opensipsctl/<br>cp 你的opensips目录/scrips/opensipsdbctrl.mysql  ./<br>mkdir mysql<br>cp  你的opensips目录/scrips/mysql/*.sql ./</p>
<p>启动opensips后抓包发现服务器返回sip 408 Request Timeout.<br>修改:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>opensips/</span><br><span class="line">vi opensipsctlrc</span><br></pre></td></tr></table></figure>

<p>编辑配置数据库信息:(需要修改的要按照自己情况修改比如 host password等)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">SIP_DOMAIN= YOUR_PC_IP   <span class="regexp">//</span>此处写本机地址</span><br></pre></td></tr></table></figure>

<p>启动时候出现</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>PID file /var/run/opensips.pid does not exist -- OpenSIPS start failed</span><br></pre></td></tr></table></figure>

<p>检查 <code>/var/log/messages</code>:<br>具体的指令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tail -<span class="number">100</span> <span class="regexp">/var/</span>log/messages</span><br></pre></td></tr></table></figure>

<p>错误信息:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: NOTICE:core:main: version: opensips <span class="number">2</span>.<span class="number">4</span>.<span class="number">3</span> (x<span class="number">86</span>_<span class="number">64</span>/linux)</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:main: using <span class="number">32</span> Mb of shared memory</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:main: using <span class="number">2</span> Mb of private process memory</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:init_reactor_size: reactor size <span class="number">1024</span> (using up to <span class="number">0</span>.<span class="number">03</span>Mb of memory per process)</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:evi_publish_event: Registered event &lt;E_CORE_THRESHOLD(<span class="number">0</span>)&gt;</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:evi_publish_event: Registered event &lt;E_CORE_SHM_THRESHOLD(<span class="number">1</span>)&gt;</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:evi_publish_event: Registered event &lt;E_CORE_PKG_THRESHOLD(<span class="number">2</span>)&gt;</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:tm:mod_init: TM - initializing...</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:sl:mod_init: Initializing StateLess engine</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: NOTICE:signaling:mod_init: initializing module ...</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:rr:mod_init: rr - initializing</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:maxfwd:mod_init: initializing...</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:sipmsgops:mod_init: initializing...</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:evi_publish_event: Registered event &lt;E_MYSQL_CONNECTION(<span class="number">3</span>)&gt;</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:db_mysql:db_mysql_connect: driver error(<span class="number">1045</span>): Access denied for user &#x27;opensips&#x27;@&#x27;localhost&#x27; (using password: YES)</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:db_mysql:db_mysql_new_connection: initial connect failed</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:core:db_do_init: could not add connection to the pool</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:uri:mod_init: Could not connect to database</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:core:init_mod: failed to initialize module uri</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: ERROR:core:main: error while initializing modules</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: INFO:core:cleanup: cleanup</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost /usr/local/sbin/opensips[<span class="number">22770</span>]: NOTICE:core:main: Exiting....</span><br><span class="line"><span class="attribute">Nov</span> <span class="number">16</span> <span class="number">14</span>:<span class="number">09</span>:<span class="number">42</span> localhost opensips: INFO:core:daemonize: pre-daemon process exiting with -<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>打开mysql:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; <span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> opensips.* <span class="keyword">to</span> opensips@localhost identified <span class="keyword">by</span> <span class="string">&#x27;opensipsrw&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush <span class="keyword">privileges</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>重新启动OpenSIPS:</p>
<p>目录(cd <code>/usr/local/sbin</code>)</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">opensipsctl <span class="literal">start</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装openvpn及其配置</title>
    <url>/2019/02/10/1110/</url>
    <content><![CDATA[<p>OpenVPN是一个用于创建虚拟专用网络加密通道的软件包,允许参与建立VPN的单点使用公开密钥、电子证书、或者用户名/密码来进行身份验 证,能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows上运行,並包含了许多安全性的功能.本文一步一步介绍了在CentOS 5.5上安装openvpn的过程.</p>
<p>一、下载软件包</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd /opt</span><br><span class="line">$ wget http:<span class="regexp">//</span>www.oberhumer.com<span class="regexp">/opensource/</span>lzo<span class="regexp">/download/</span>lzo-<span class="number">2.04</span>.tar.gz</span><br><span class="line">$ wget http:<span class="regexp">//</span>openvpn.net<span class="regexp">/release/</span>openvpn-<span class="number">2.1</span>_rc22.tar.gz</span><br></pre></td></tr></table></figure>

<p>二、解压及安装</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>tar zxvf lzo*</span><br><span class="line"><span class="variable">$ </span>tar zxvf openvpn*</span><br></pre></td></tr></table></figure>

<p>进入相应文件夹下,执行以下命令编译安装:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">$ ./configure &amp;&amp; <span class="built_in">make</span> &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>

<p>三、服务器端设置:</p>
<p>1.用easy-rsa生成服务器证书客户端证书</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cp <span class="regexp">/opt/</span>openvpn-<span class="number">2.1</span>_rc22<span class="regexp">/easy-rsa/</span><span class="number">2.0</span> -r <span class="regexp">/etc/</span>openvpn</span><br><span class="line">$ cd <span class="regexp">/etc/</span>openvpn/<span class="number">2.0</span></span><br></pre></td></tr></table></figure>

<p>编辑所需的参数再调用之:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim vars</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ./vars</span></span><br></pre></td></tr></table></figure>

<p>下面这个命令在第一次安装时可以运行,以后在添加客户端时千万别运行,这个命令会清除所有已经生成的证书密钥.</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> ./clean-<span class="keyword">all</span></span><br></pre></td></tr></table></figure>

<p>生成服务器端ca证书:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> ./<span class="built_in">build-ca</span></span><br></pre></td></tr></table></figure>

<p>生成服务器端密钥证书, 后面这个server-name就是服务器名,可以自定义.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ ./build-<span class="keyword">server</span>-key <span class="keyword">server</span>-<span class="type">name</span></span><br></pre></td></tr></table></figure>

<p>一路Enter之后证书生成.</p>
<p>再依次生成所需客户端证书密钥文件:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">$ ./<span class="keyword">build</span>-<span class="keyword">key</span> client-name1</span><br><span class="line">$ ./<span class="keyword">build</span>-<span class="keyword">key</span> client-name2</span><br></pre></td></tr></table></figure>

<p>再生成 diffie hellman 参数:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> ./<span class="built_in">build-dh</span></span><br></pre></td></tr></table></figure>

<p>创建并编辑服务器端配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/opt/</span>openvpn-<span class="number">2.1</span>_rc22<span class="regexp">/sample-config-files/</span>server.conf <span class="regexp">/etc/</span>openvpn/</span><br><span class="line">vi <span class="regexp">/etc/</span>openvpn/server.conf</span><br></pre></td></tr></table></figure>

<p>编辑成下面的内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">port</span> <span class="number">1494</span></span><br><span class="line"><span class="attribute">proto</span> udp</span><br><span class="line"><span class="attribute">dev</span> tun</span><br><span class="line"><span class="attribute">ca</span> ca.crt</span><br><span class="line"><span class="attribute">cert</span> server.crt</span><br><span class="line"><span class="attribute">key</span> server.key</span><br><span class="line"><span class="attribute">dh</span> dh<span class="number">1024</span>.pem</span><br><span class="line"><span class="attribute">server</span> <span class="number">10.1.0.0</span> <span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">push</span> <span class="string">&quot;route 10.1.0.0 255.255.255.0&quot;</span></span><br><span class="line"><span class="attribute">push</span> <span class="string">&quot;route 10.1.1.0 255.255.255.0&quot;</span></span><br><span class="line"><span class="attribute">client</span>-config-dir /etc/vpn/ccd</span><br><span class="line"><span class="attribute">route</span> <span class="number">10.1.1.0</span> <span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">client</span>-to-client</span><br><span class="line"><span class="attribute">keepalive</span> <span class="number">10</span> <span class="number">120</span></span><br><span class="line"><span class="attribute">user</span> nobody</span><br><span class="line"><span class="attribute">group</span> nobody</span><br><span class="line"><span class="attribute">persist</span>-key</span><br><span class="line"><span class="attribute">persist</span>-tun</span><br><span class="line"><span class="attribute">log</span>-append openvpn.log</span><br><span class="line"><span class="attribute">verb</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>其中 ca.crt, server.key,server.crt 可以用以前贴出的 ca 工具创建,dh1024.pem 用 OpenVPN 自带的工具创建.<br>这个配置文件创建了两个网段:10.1.0.* 和 10.1.1.*,VPN 服务器将从这两个网段中给 Client 分配 IP 地址.VPN Server 自身 IP 将是 10.0.0.1.<br>“client- config-dir”指明 Client 的专有配置文件目录.在这个目录下可以针对特定用户建立配置文件.例如,要为用户 abc 指定一个 IP 地址(如10.1.1.5)而不是让 VPN Server 自动分配,可以在配置目录 <code>/etc/vpn/ccd</code>下建立一个 abc 文件,内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span>-push <span class="number">10.1.1.5</span> <span class="number">10.1.1.6</span></span><br></pre></td></tr></table></figure>

<p>那么 VPN Server 就会自动给 abc 用户分配 10.1.1.5 这个地址.注意第一个IP地址 的最后一个数字(这里是 5)必须是 4*n + 1 的数.<br>问题是,VPN Server 怎么知道哪个用户是 abc 呢?它是 Client 数字证书中的 Common Name 域来判断的.就是说,在连接协商时如果 Client 端数字证书的 Common Name 是 abc,那么 VPN Server 就找配置目录下 abc 这个文件.<br>修改完成之后,到VPN目录下执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>openvpn --config <span class="regexp">/etc/</span>openvpn/server.conf;</span><br></pre></td></tr></table></figure>

<p>每次都运行上面这个命令有点麻烦,这里有一个script,把它复制到 <code>/etc/init.d</code> 文件夹下,可以实现启动,状态查询,重启等.该文件适应于CentOS 5.5, 如果密钥及配置文件位置不一样,也许要作一些小的修改.<br>再在rcX.d文件夹下作几个软链接就可以实现开机自动启动了.<br>也可以修改 <code>/etc/rc.local</code>文件实现开机启动.</p>
<p>密钥分发:</p>
<p>把ca.crt 及相应client 的三个密钥证书文件一共四个分别分发出去就可以了.注意不需要将ca.key分发出去,<br>ca.key应该保密.</p>
<p>四、客户端配置</p>
<p>1.Linux</p>
<p>相应比较简单,安装好openvpn后,把收到的ca及lient文件放到相应的位置,配置好client.conf就可以了.</p>
<p>2.Windows</p>
<p>到openvpn官方网站下载windows安装包进行安装,在安装文件夹下有下个config文件夹,把你的ca及client文件放到该文件夹下,从sample-config下拷贝一个client.ovpn并作相应修改即可.</p>
<p>五、固定IP地址分配</p>
<p>在服务器端配置文件(server.conf)里取消下面行的注释:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="comment">;client-config-dir ccd</span></span><br><span class="line"><span class="comment">;route 10.8.0.0 255.255.255.252</span></span><br></pre></td></tr></table></figure>

<p>在 <code>/etc/openvpn</code>文件夹下新建名为ccd文件夹,在ccd 文件夹里以客户名为名新建文件,内容格式如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span>-push <span class="number">10.8.0.20</span> <span class="number">10.8.0.120</span></span><br></pre></td></tr></table></figure>

<p>客户端启动后即获得IP地: 10.8.0.20.<br>但要注意上面格式只对linux有效,如果客户端为windows,则客户端会连接不成功.因为openvpn在windows下时,<br>其local IP 与 remote IP 必须在网址掩码为255.255.255.252的同一网段内,而且不能取头尾两端的IP,因此一个openvpn连接在windows下最少要占用4个ip地址.<br>windows 下的 客户端IP配置必须为如下形式:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span>-push <span class="number">10.8.0.30</span> <span class="number">10.8.0.29</span></span><br></pre></td></tr></table></figure>

<p>因为10.8.0.28/30网段包含以下IP: 10.8.0.28-31, 去除头尾,只有29与30可用.其他类推.</p>
<p>六、访问外网设置</p>
<p>开启服务器端路由转发功能:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/ip_forward</span><br></pre></td></tr></table></figure>

<p>为了使CentOS重启后仍然开启路由转发功能我们需要再执行下列命令:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">$ sysctl -w net.ipv4.<span class="attribute">ip_forward</span>=1</span><br></pre></td></tr></table></figure>

<p>添加iptables转发规则:</p>
<p>因为我的CentOS是ADSL拨号上网,所以把出口设置成ppp0,请根据实际情况设置, 如eth0:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -t nat -A POSTROUTING -s <span class="number">10.8.0.0</span>/<span class="number">24</span> -o ppp<span class="number">0</span> -j MASQUERADE</span><br></pre></td></tr></table></figure>

<p>必须保证server.conf配置中,有下面三个配置:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">push</span> <span class="string">&quot;dhcp-option DNS 10.8.0.1&quot;</span></span><br><span class="line"><span class="keyword">push</span> <span class="string">&quot;dhcp-option DNS 202.103.44.150&quot;</span> <span class="meta">#客户端获得的DNS地址</span></span><br><span class="line"><span class="keyword">push</span> <span class="string">&quot;dhcp-option DNS 202.103.24.68&quot;</span> <span class="meta">#客户端获得的DNS地址.</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装setup系统管理小工具</title>
    <url>/2018/11/25/1112/</url>
    <content><![CDATA[<p>Centos运行不了setup? 那安装setuptool吧,可以节省很多系统管理的时间.<br>安装setuptool:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> setuptool</span><br></pre></td></tr></table></figure>

<p>可以发现执行setup后不全,再安装一个用于系统服务管理:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ntsysv</span><br></pre></td></tr></table></figure>

<p>再安装个防火墙,以及setup中配套的防火墙设置、网络设置:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> iptables</span><br></pre></td></tr></table></figure>

<p>安装setup中配套的防火墙设置:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install </span>system-<span class="built_in">config</span>-securitylevel-tui</span><br></pre></td></tr></table></figure>

<p>安装setup中配套的网络设置:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install </span>system-<span class="built_in">config</span>-network-tui</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装svn</title>
    <url>/2011/10/20/1113/</url>
    <content><![CDATA[<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> subversion</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos安装zpanel虚拟主机管理面板</title>
    <url>/2018/07/01/1115/</url>
    <content><![CDATA[<p>国外免费的虚拟主机管理系统还是很多的,今天给大家介绍一下zpanel的安装.<br>官方主页是:<code>http://www.zpanelcp.com/</code><br>大家可以自己去下载最新的程序,然后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>sourceforge.net<span class="regexp">/projects/</span>zpanelcp<span class="regexp">/files/</span>releases<span class="regexp">/6.1.1/</span>zpanel-<span class="number">6.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">mkdir <span class="regexp">/etc/</span>zpanel</span><br><span class="line">tar -zxvf zpanel-<span class="number">6.1</span>.<span class="number">1</span>.tar.gz -C <span class="regexp">/etc/</span>zpanel/</span><br><span class="line">chmod +x <span class="regexp">/etc/</span>zpanel<span class="regexp">/lib/</span>dev/zpinstall_centos.sh</span><br><span class="line"><span class="regexp">/etc/</span>zpanel<span class="regexp">/lib/</span>dev/zpinstall_centos.sh</span><br></pre></td></tr></table></figure>

<p>就可以安装好zpanel了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装tripwire保障服务器安全</title>
    <url>/2014/09/07/1114/</url>
    <content><![CDATA[<p>安装:</p>
<p>到<a href="http://sourceforge.net/projects/tripwire/%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84tripwire">http://sourceforge.net/projects/tripwire/下载最新版本的tripwire</a>.<br>目前是tripwire-2.4.2.2-src.tar.bz2 ,<br>安装非常简单,</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -jxvf tripwire-<span class="number">2.4.2.2</span>-src.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">cd</span> tripwire-<span class="number">2.4.2.2</span>-src</span><br></pre></td></tr></table></figure>

<p>解压后进入目录:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>tripwire</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">Continue with installation  [y/n] y <span class="comment">#键入y继续安装</span></span><br></pre></td></tr></table></figure>

<p>然后需要输入几个口令就安装完成了.<br>就安装好了.</p>
<p>设置tripwire:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>tripwire/twcfg.txt <span class="comment">#修改文本格式的Tripwire配置文件</span></span><br><span class="line">LOOSEDIRECTORYCHECKING =false <span class="comment">#找到这一个行,将false的值变为true(不监测所属目录的数据完整性)</span></span><br><span class="line">LOOSEDIRECTORYCHECKING =true <span class="comment">#变为此状态</span></span><br><span class="line">REPORTLEVEL =<span class="number">3</span> <span class="comment">#找到这一行,将3变为4(改变监测结果报告的等级)</span></span><br><span class="line">REPORTLEVEL =<span class="number">4</span> <span class="comment">#变为此状态</span></span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/tripwire/</span>sbin/twadmin --create-cfgfile -S site.key twcfg.txt <span class="comment">#从文本配置文件建立加密格式配置文件.</span></span><br><span class="line">Please enter your site passphrase: <span class="comment">#输入&quot;site keyfile&quot;口令</span></span><br><span class="line">Wrote configuration file: <span class="regexp">/usr/</span>local<span class="regexp">/tripwire/</span>etc/tw.cfg</span><br></pre></td></tr></table></figure>

<p>编辑twpol.txt来控制对哪些目录进行检查,把不需要扫描的路径注释或删除即可.<br>修改完成后保存twpool.txt文件.</p>
<p>初始化数据库:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">$/usr/local/tripwire/sbin/tripwire --init</span><br><span class="line">Please enter your local passphrase: #输入&quot;local keyfile&quot;口令</span><br><span class="line">Parsing policy file: /usr/local/tripwire/etc/tw.pol</span><br><span class="line">Generating the database...</span><br><span class="line"><span class="bullet">*** </span>Processing Unix File System <span class="strong">***</span></span><br><span class="line"><span class="section">The object: &quot;/sys&quot; is on a different file system...ignoring.</span></span><br><span class="line"><span class="section">-------------------</span></span><br><span class="line">------过程---------</span><br><span class="line"><span class="section">------省略---------</span></span><br><span class="line"><span class="section">-------------------</span></span><br><span class="line">Wrote database file: /usr/local/tripwire/lib/tripwire/localhost.localdomain.twd</span><br><span class="line">The database was successfully generated.</span><br></pre></td></tr></table></figure>

<p>更新数据库:<br>当你更新了twpol.txt后需用此命令更新数据库:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local/tripwire</span><br><span class="line">$.<span class="regexp">/sbin/</span>tripwire --update-policy --secure-mode low <span class="regexp">/usr/</span>local<span class="regexp">/tripwire/</span>etc/twpol.txt</span><br><span class="line">Parsing policy <span class="keyword">file</span>: <span class="regexp">/usr/</span>local<span class="regexp">/tripwire/</span>etc/twpol.txt</span><br><span class="line">Please enter your local passphrase:#输入<span class="string">&quot;local keyfile&quot;</span>口令</span><br><span class="line">Please enter your site passphrase:#输入<span class="string">&quot;site keyfile&quot;</span>口令</span><br><span class="line">======== Policy Update: Processing section Unix <span class="keyword">File</span> System.</span><br><span class="line">======== <span class="keyword">Step</span> <span class="number">1</span>: Gathering information <span class="keyword">for</span> the <span class="keyword">new</span> policy.</span><br><span class="line">The object: <span class="string">&quot;/sys&quot;</span> is on a different <span class="keyword">file</span> system...ignoring.</span><br><span class="line">-------------------</span><br><span class="line">------过程---------</span><br><span class="line">------省略---------</span><br><span class="line">-------------------</span><br><span class="line">### Continuing...</span><br><span class="line">Wrote database <span class="keyword">file</span>: <span class="regexp">/usr/</span>local<span class="regexp">/tripwire/</span>lib<span class="regexp">/tripwire/</span>localhost.localdomain.twd</span><br><span class="line">The database was successfully generated.</span><br></pre></td></tr></table></figure>

<p>检查文件异动:<br>安装完tripwire后你可以定期检查文件是否存在异动.<br>加上interactive在当前显示结果.</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">./sbin/tripwire --check --interactive</span><br><span class="line">Parsing policy file: /usr/local/tripwire/etc/tw.pol</span><br><span class="line"><span class="section">*** Processing Unix File System ***</span></span><br><span class="line"><span class="section">-------------------</span></span><br><span class="line">------过程---------</span><br><span class="line"><span class="section">------省略---------</span></span><br><span class="line"><span class="section">-------------------</span></span><br></pre></td></tr></table></figure>

<p>查看报告:<br>所有tripwire的报告以.twr后缀保存在lib/tripwire目录下,需要使用twprint命令来转化成文本格式.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/sbin/</span>twprint --print-report --twrfile <span class="regexp">/lib/</span>tripwire<span class="regexp">/report/</span>localhost.localdomain-<span class="number">20100225</span>-<span class="number">164220</span>.twr&gt;<span class="regexp">/tmp/</span>tripwire_readable.txt</span><br><span class="line"><span class="variable">$cat</span> <span class="regexp">/tmp/</span>tripwire_readable.txt</span><br></pre></td></tr></table></figure>

<p>修改环境变量:<br>需要注意的是,一般情况下,这仅仅对于普通用户适用,避免修改根用户的环境定义文件,因为那样可能会造成潜在的危险.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">$vi .bash_profile <span class="meta">#修改环境变量定义文件</span></span><br></pre></td></tr></table></figure>

<p>然后编辑你的PATH声明,其格式为:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/tripwire/sbin/</span></span><br><span class="line">执行命令使其立刻生效.</span><br><span class="line"><span class="variable">$source</span> .bash_profile</span><br></pre></td></tr></table></figure>

<p>Tripwire的使用和维护都比较简单.但要实现对系统的监控,关键还是需要依靠管理员定制完整的策略和检查周期,以便及时发现问题.另外,Tripwire只能告诉您那些文件被修改,以及修改的属性.但判断和维护是依赖管理员操作的,Tripwire是一个”事后诸葛亮”的工具.</p>
<p>最后贴一个报告:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"><span class="symbol">Section:</span> Unix File System</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Rule Name                       Severity Level    <span class="keyword">Added </span>   Removed  Modified</span><br><span class="line">---------                       --------------    -----    -------  --------</span><br><span class="line">Tripwire Data Files             <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">Monitor Filesystems             <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">User <span class="keyword">Binaries </span><span class="keyword">and </span>Libraries     <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">Tripwire <span class="keyword">Binaries </span>              <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">OS <span class="keyword">Binaries </span><span class="keyword">and </span>Libraries       <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">Temporary <span class="keyword">Directories </span>          <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">Global Configuration Files      <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">System <span class="keyword">Boot </span>Changes             <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">RPM Checksum Files              <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">OS Devices <span class="keyword">and </span>Misc <span class="keyword">Directories </span><span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">OS <span class="keyword">Boot </span>Files <span class="keyword">and </span>Mount Points  <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line">Root <span class="keyword">Directory </span><span class="keyword">and </span>Files        <span class="number">0</span>                 <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Total objects <span class="keyword">scanned: </span> <span class="number">48224</span></span><br><span class="line">Total violations found:  <span class="number">0</span></span><br><span class="line"></span><br><span class="line">===============================================================================</span><br></pre></td></tr></table></figure>

<p>额 我的系统没有做过修改!好了 今天教程到此结束.</p>
]]></content>
  </entry>
  <entry>
    <title>centos安装并启动monit</title>
    <url>/2018/01/31/1116/</url>
    <content><![CDATA[<p>想安装monit,但是看了网上的教程没有一个能成功,根本就没有启动的那个文件.<br>后来我是去rpmsearch找了个monit的rpm包,安装后能用了.<br>关于monit的配置,本站有,烦劳大家搜索一下吧.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS磁盘配额</title>
    <url>/2014/03/03/1117/</url>
    <content><![CDATA[<p>磁盘配额可以限制指定账户能够使用的磁盘空间,这样可以避免因某个用户的过度使用磁盘空间造成其他用户无法正常工作甚至影响系统运行.<br>在Centos6中默认的ext系列的文件系统没有挂载磁盘配额,需要我们手动来挂载.<br>挂载选项:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">usrquota   对用户进行管理</span><br><span class="line">grpquota   对组进行管理</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6.<span class="number">9</span> ~]$ mount -o defaults,usrquota,grpquota <span class="regexp">/dev/</span>sdb1 <span class="regexp">/test/</span>  </span><br><span class="line">#-o后面跟的是挂载选项,把sdb1挂载到<span class="regexp">/test/</span>目录.defaults是默认的挂载选项</span><br></pre></td></tr></table></figure>

<p>上面是分区没有挂载的情况,如果分区已经挂载可以用这种方法:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">[root@centos6.9 ~]#vim /etc/fstab        #fstab文件是挂载的配置文件,每行定义都一个要挂载的文件系统</span><br><span class="line"></span><br><span class="line">UUID=80f63701<span class="string">-5</span>c1b<span class="string">-4</span>dc1<span class="string">-9864</span><span class="string">-7</span>c1247ed8561 /                       ext4    defaults        1 1</span><br><span class="line">UUID=87c9aa50<span class="string">-7</span>b7a<span class="string">-459</span>e-babc<span class="string">-87</span>bfaf5b49f2 /boot                   ext4    defaults        1 2</span><br><span class="line">UUID=2f7f0957<span class="string">-6978</span><span class="string">-4028</span>-ac0d<span class="string">-966</span>fb8d486e5 swap                    swap    defaults        0 0</span><br><span class="line">sysfs                   /sys                    sysfs   defaults        0 0</span><br><span class="line">proc                    /proc                   proc    defaults        0 0</span><br><span class="line">UUID=a30c64e6-fd9c<span class="string">-4886</span><span class="string">-926</span>c<span class="string">-2</span>cb13c7c2225  /test ext4   defaults        0 0</span><br></pre></td></tr></table></figure>

<p>在文件里面追加一行格式是:设备文件可以写设备文件的名字、LABEL、UUID系统默认用的是UUID,然后是要挂载到的文件、文件系统的类型、挂载选项:默认是defaults,后面的两个数字第一个表示转储频率:0不做备份、1每天转储、2每隔一天转储、第二个表示自检次序:0不自检、1首先自检,这个两个数字都写0就可以了.</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">UUID<span class="operator">=</span>a<span class="number">30</span><span class="keyword">c</span><span class="number">64e6</span>-fd<span class="number">9</span><span class="keyword">c</span><span class="number">-4886</span><span class="number">-926</span><span class="keyword">c</span><span class="number">-2</span>cb<span class="number">13</span><span class="keyword">c</span><span class="number">7</span><span class="keyword">c</span><span class="number">2225</span>  /test ext<span class="number">4</span>   defaults<span class="punctuation">,</span>usrquota<span class="punctuation">,</span>grpquota <span class="number">0</span> <span class="number">0</span>  #我们在defaults的后面加上usrquota grpquota这两个选项<span class="punctuation">,</span>用<span class="punctuation">,</span>号分隔<span class="punctuation">,</span>然后保存退出</span><br><span class="line"></span><br><span class="line">[root<span class="title">@centos6.9</span> ~]#mount -o remount /dev/sdb<span class="number">1</span> /test/   #用remount选项重新挂载分区</span><br></pre></td></tr></table></figure>

<p>注:mount命令只能临时挂载分区重启之后就会失效,想要永久挂载需要写在fstab文件中.所以第一种方法想要保存的话,还要需要把配置写进fstab文件.</p>
<p>挂载之后可以用mount命令来查看有没有生效:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">root@centos6.9 ~]#mount</span><br><span class="line">/dev/sda2 <span class="keyword">on</span> / <span class="keyword">type</span> ext4 (rw) #因为有点多,所以我这里删除了几个挂载</span><br><span class="line">proc <span class="keyword">on</span> /proc <span class="keyword">type</span> proc (rw)</span><br><span class="line">sysfs <span class="keyword">on</span> /sys <span class="keyword">type</span> sysfs (rw)</span><br><span class="line">tmpfs <span class="keyword">on</span> /dev/shm <span class="keyword">type</span> tmpfs (rw,rootcontext=<span class="string">&quot;system_u:object_r:tmpfs_t:s0&quot;</span>)</span><br><span class="line">/dev/sda1 <span class="keyword">on</span> /<span class="keyword">boot</span> <span class="keyword">type</span> ext4 (rw) fuse.gvfs-fuse-daemon (rw,nosuid,nodev)</span><br><span class="line">/dev/sdb1 <span class="keyword">on</span> /<span class="keyword">test</span> <span class="keyword">type</span> ext4 (rw,usrquota,grpquota)  #()里的是挂载项rw表示这个分区可以读写,可以看到我们刚才添加的选项已经生效了</span><br></pre></td></tr></table></figure>

<p>配置分区的配额:</p>
<p>初始化数据库:quotacheck:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">quotacheck [-gucbfinvdmMR] [-F &lt;quota-format&gt;] filesystem|-a      <span class="comment">#格式</span></span><br><span class="line"><span class="comment">#quotacheck的一些选项</span></span><br><span class="line">-u, <span class="params">--user</span>                检查用户文件</span><br><span class="line">-g, <span class="params">--group</span>               检查组文件</span><br><span class="line">-c, <span class="params">--create-files</span>        创建新的配额文件</span><br><span class="line">-b, <span class="params">--backup</span>              创建旧配额文件的备份</span><br><span class="line">-f, <span class="params">--force</span>               即使启用了配额,也强制强制检查</span><br><span class="line">-i, <span class="params">--interactive</span>         交互方式</span><br><span class="line">-n, <span class="params">--use-first-dquot</span>     使用重复结构的第一个副本</span><br><span class="line">-v, <span class="params">--verbose</span>             执行过程的详细信息</span><br><span class="line">-d, <span class="params">--debug</span>               更详细的信息</span><br><span class="line">-m, <span class="params">--no-remount</span>          不重新安装文件系统只读</span><br><span class="line">-M, <span class="params">--try-remount</span>         尝试重新安装文件系统的只读的,即使失败也要继续</span><br><span class="line">-R, <span class="params">--exclude-root</span>        检查所有文件系统时排除root</span><br><span class="line">-F, <span class="params">--format=formatname</span>   检查特定格式的配额文件</span><br><span class="line">-a, <span class="params">--all</span>                 检查所有</span><br><span class="line">-h, <span class="params">--help</span>                帮助</span><br><span class="line">[root@centos6.9 test]<span class="comment">#quotacheck -cug /test/  #初始化,创建用户和组的配置文件</span></span><br><span class="line">[root@centos6.9 test]<span class="comment">#ll</span></span><br><span class="line">-rw<span class="params">-------</span>. 1 root root  6144 Jun 19 04<span class="function">:19</span> aquota.group   <span class="comment">#这个是组的配置文件</span></span><br><span class="line">-rw<span class="params">-------</span>. 1 root root  6144 Jun 19 04<span class="function">:19</span> aquota.user   <span class="comment">#这个是用户的配置文件</span></span><br><span class="line">drwx<span class="params">------</span>. 2 root root 16384 Jun 19 03<span class="function">:08</span> lost+found</span><br></pre></td></tr></table></figure>

<p>注:如果提示不能创建文件、权限不足,有很大的可能是SELinux安全机制引起的,用setenforce 0命令把它关闭就行了,用getenforce检查SELinux的状态</p>
<p>开启磁盘配额:quotaon:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">quotaon [-guvp] [-F quotaformat] [-x <span class="keyword">state</span>] -a</span><br><span class="line">quotaon [-guvp] [-F quotaformat] [-x <span class="keyword">state</span>] filesys    <span class="comment">#命令格式 </span></span><br><span class="line">-a, --all                为所有文件系统启用配额</span><br><span class="line">-f, --off                关闭配额</span><br><span class="line">-u, --user               对用户配额进行操作</span><br><span class="line">-g, --group              对组配额进行操作</span><br><span class="line">-p, --print-state        查看分区配额状态</span><br><span class="line">-x, --xfs-command=cmd    对xfs分区进行操作</span><br><span class="line">-F, --format=formatname  按照具体配额格式操作</span><br><span class="line">-v, --verbose            详细信息</span><br><span class="line">-h, --help               帮助</span><br><span class="line">[root@centos6.<span class="number">9</span> test]<span class="comment">#quotaon /test/ #开启/test/的配额功能</span></span><br><span class="line">[root@centos6.<span class="number">9</span> test]<span class="comment">#quotaon -p /test/     #检查状态</span></span><br><span class="line"><span class="keyword">group</span> quota <span class="keyword">on</span> /test (/dev/sdb1) is <span class="keyword">on</span>      <span class="comment">#已经开启</span></span><br><span class="line"><span class="keyword">user</span> quota <span class="keyword">on</span> /test (/dev/sdb1) is <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>关闭磁盘配额:quotaoff 参数和quotaon的一样:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">[root@centos6.<span class="number">9</span> <span class="keyword">test</span>]<span class="comment">#quotaoff -p /test/        #检查状态</span></span><br><span class="line">group quota <span class="keyword">on</span> /<span class="keyword">test</span> (/dev/sdb1) is <span class="keyword">off</span>         <span class="comment">#关闭状态</span></span><br><span class="line">user quota <span class="keyword">on</span> /<span class="keyword">test</span> (/dev/sdb1) is <span class="keyword">off</span></span><br></pre></td></tr></table></figure>

<p>编辑配额 edquota:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">[root@centos6<span class="number">.9</span> test]#edquota -h        #查看帮助</span><br><span class="line">edquota [-rm] [-u] [-<span class="symbol">F</span> formatname] [-p username] [-f filesystem] username ...</span><br><span class="line">edquota [-rm] -g [-<span class="symbol">F</span> formatname] [-p groupname] [-f filesystem] groupname ...</span><br><span class="line">edquota [-u|g] [-<span class="symbol">F</span> formatname] [-f filesystem] -t</span><br><span class="line">edquota [-u|g] [-<span class="symbol">F</span> formatname] [-f filesystem] -<span class="symbol">T</span> username|groupname ...</span><br><span class="line">#选项</span><br><span class="line">-u, --user                    编辑用户</span><br><span class="line">-g, --group                   编辑组</span><br><span class="line">-r, --remote                  通过<span class="symbol">RPC</span>编辑远程配额</span><br><span class="line">-m, --no-mixed-pathnames      从<span class="symbol">NFSv4</span>挂载点修剪主斜线</span><br><span class="line">-<span class="symbol">F</span>, --format=formatname       编辑具体格式的配额</span><br><span class="line">-p, --prototype=name          复制其他用户或组的配置</span><br><span class="line">    --always-resolve          总是尝试解析名称,即使它只是由数字组成</span><br><span class="line">-f, --filesystem=filesystem   仅在特定文件系统上编辑数据</span><br><span class="line">-t, --edit-period             编辑宽限期</span><br><span class="line">-<span class="symbol">T</span>, --edit-times              编辑单个用户或组的宽限时间</span><br><span class="line">-h, --help                    查看帮助</span><br><span class="line">-<span class="symbol">V</span>, --version                 查看版本信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6<span class="number">.9</span> ~]#edquota admin   #编辑admin用户</span><br><span class="line"><span class="symbol">Disk</span> quotas for user admin (uid <span class="number">500</span>):</span><br><span class="line">  <span class="symbol">Filesystem</span>       blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1           <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>          <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>直接修改数字就可以配置配额了,可以用M、G:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">Filesystem</span>:<span class="string">文件系统名</span></span><br><span class="line"><span class="attr">blocks</span>    :<span class="string">已经使用的块数,一块等于1K</span></span><br><span class="line"><span class="attr">soft</span>      :<span class="string">数据块的软限制,0表示禁用</span></span><br><span class="line"><span class="attr">hard</span>      :<span class="string">数据块的硬限制,0表示禁用,可用</span></span><br><span class="line"><span class="attr">inodes</span>    :<span class="string">已经创建的文件个数,如果有*表示超出软限制</span></span><br><span class="line"><span class="attr">soft</span>      :<span class="string">创建的文件个数的软限制,0表示禁用</span></span><br><span class="line"><span class="attr">hard</span>      :<span class="string">创建的文件个数的硬限制,0表示禁用</span></span><br><span class="line"><span class="attr">Disk</span> <span class="string">quotas for user admin (uid 500):</span></span><br><span class="line">  <span class="attr">Filesystem</span>                   <span class="string">blocks       soft       hard     inodes     soft     hard</span></span><br><span class="line">  <span class="meta">/dev/sdb1</span>                         <span class="string">0         800      1M           0        8       10</span></span><br><span class="line"><span class="comment">#因为是测试所以只给了1M空间,和10文件,软限制给了800k和8个文件</span></span><br></pre></td></tr></table></figure>

<p>实验文件大小限制:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">[admin@centos6.9 test]<span class="variable">$dd</span> <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/test/1 <span class="attribute">bs</span>=1M <span class="attribute">count</span>=1  #创建1个1M的文件</span><br><span class="line">sdb1: warning,<span class="built_in"> user </span>block quota exceeded.</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes (1.0 MB) copied, 0.00242046 s, 433 MB/s #创建成功</span><br><span class="line">[admin@centos6.9 test]<span class="variable">$ll</span> -h  #查看/test目录下的文件详细信息</span><br><span class="line">-rw-rw-r--. 1 admin admin 1.0M Jun 19 06:09 1 #刚刚创建的文件</span><br><span class="line">-rw-------. 1 root  root  7.0K Jun 19 06:08 aquota.group</span><br><span class="line">-rw-------. 1 root  root  7.0K Jun 19 06:13 aquota.user</span><br><span class="line">drwx------. 2 root  root   16K Jun 19 03:08 lost+found</span><br><span class="line"></span><br><span class="line">[admin@centos6.9 test]<span class="variable">$dd</span> <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/test/2 <span class="attribute">bs</span>=1M <span class="attribute">count</span>=1 #在创建1个文件2</span><br><span class="line">sdb1: write failed,<span class="built_in"> user </span>block limit reached.</span><br><span class="line">dd: writing `/test/2<span class="string">&#x27;: Disk quota exceeded #提示超过了磁盘配额</span></span><br><span class="line"><span class="string">1+0 records in</span></span><br><span class="line"><span class="string">0+0 records out</span></span><br><span class="line"><span class="string">0 bytes (0 B) copied, 0.00140152 s, 0.0 kB/s #创建失败</span></span><br></pre></td></tr></table></figure>

<p>验证创建文件个数的限制:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">[admin@centos6.9 test]$touch &#123;1..8&#125; <span class="comment">#创建8个文件</span></span><br><span class="line">[admin@centos6.9 test]$ll</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26<span class="number"> 1 </span></span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 2</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 3</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 4</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 5</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 6</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 7</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:29 8</span><br><span class="line">-rw-------.<span class="number"> 1 </span>root  root  <span class="number"> 7168 </span>Jun<span class="number"> 19 </span>06:26 aquota.group</span><br><span class="line">-rw-------.<span class="number"> 1 </span>root  root  <span class="number"> 7168 </span>Jun<span class="number"> 19 </span>06:26 aquota.user</span><br><span class="line">drwx------.<span class="number"> 2 </span>root  root <span class="number"> 16384 </span>Jun<span class="number"> 19 </span>03:08 lost+found</span><br><span class="line">[admin@centos6.9 test]$touch<span class="number"> 9 </span><span class="comment">#创建第九个文件</span></span><br><span class="line">sdb1: warning, user file quota exceeded. <span class="comment">#触发了软限制,提示将超出用户文件配额.</span></span><br><span class="line">[admin@centos6.9 test]$ll <span class="comment">#查看文件</span></span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 1</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 2</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 3</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 4</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 5</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 6</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:26 7</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:29 8</span><br><span class="line">-rw-rw-r--.<span class="number"> 1 </span>admin admin    <span class="number"> 0 </span>Jun<span class="number"> 19 </span>06:29<span class="number"> 9 </span><span class="comment">#但是还是创建成功了</span></span><br><span class="line">[admin@centos6.9 test]$touch<span class="number"> 10 </span><span class="comment">#创建第十个文件</span></span><br><span class="line">[admin@centos6.9 test]$touch<span class="number"> 11 </span><span class="comment">#创建第十一个文件</span></span><br><span class="line">sdb1: write failed, user file limit reached.</span><br><span class="line">touch: cannot touch `11&#x27;: Disk quota exceeded <span class="comment">#报警,不能创建,超过了磁盘配额</span></span><br></pre></td></tr></table></figure>

<p>直接在shell中编辑配额:setquota, 它和quotaon只有两个不同选项:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">-b, --batch <span class="comment">#从标准输入读取限制</span></span><br><span class="line">-c, --continue-batch <span class="comment">#在出现错误的情况下继续输入处理</span></span><br><span class="line"></span><br><span class="line">Disk quotas for user admin (uid 500):</span><br><span class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1                     <span class="number"> 1024 </span>      <span class="number"> 800 </span>     <span class="number"> 1024 </span>       <span class="number"> 10 </span>      <span class="number"> 8 </span>      10</span><br><span class="line">[root@centos6.9 ~]<span class="comment">#setquota admin 1M 2M 10 20 /test/    #设置软限制1M,硬限制2M.文件软10个,硬限制20个</span></span><br><span class="line">[root@centos6.9 ~]<span class="comment">#edquota admin 查看</span></span><br><span class="line">Disk quotas for user admin (uid 500):</span><br><span class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1                     <span class="number"> 1024 </span>     <span class="number"> 1024 </span>     <span class="number"> 2048 </span>       <span class="number"> 10 </span>     <span class="number"> 10 </span>      20</span><br><span class="line"><span class="comment">#配额设置被更改了 </span></span><br></pre></td></tr></table></figure>

<p>用一个用户的权限来为另一个用户创建配额权限:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">[root@centos6.9 ~]<span class="comment">#useradd test1 #创建一个yoghurt</span></span><br><span class="line">[root@centos6.9 ~]<span class="comment">#edquota -p admin test1 #复制admin的权限给test1</span></span><br><span class="line">[root@centos6.9 ~]<span class="comment">#quota test1  #查看test1用户的权限</span></span><br><span class="line">Disk quotas for user test1 (uid 501):</span><br><span class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1                        <span class="number"> 0 </span>     <span class="number"> 1024 </span>     <span class="number"> 2048 </span>        <span class="number"> 0 </span>     <span class="number"> 10 </span>      20</span><br></pre></td></tr></table></figure>

<p>查看用户权限,除了进入配置文件还可以用quota 用户名来查看:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">admin</span>@centos6<span class="number">.9</span> test]$quota <span class="keyword">admin</span></span><br><span class="line">Disk quotas <span class="keyword">for</span> <span class="keyword">user</span> <span class="keyword">admin</span> (uid <span class="number">500</span>): </span><br><span class="line">     Filesystem  blocks   quota   <span class="keyword">limit</span>   grace   files   quota   <span class="keyword">limit</span>   grace</span><br><span class="line">      /dev/sdb1       <span class="number">0</span>    <span class="number">1024</span>    <span class="number">2048</span>              <span class="number">10</span>*      <span class="number">8</span>      <span class="number">10</span>   <span class="number">6</span>days</span><br></pre></td></tr></table></figure>

<p>注:上面可以看到已创建文件的后面的*号,表示超过的软限制.软限制:用户可以在超过,一般用来提示用户即将超过限制,但是软限制是有宽限期,如果过了宽限期用户也是不能创建文件的.宽限期管理员可以用edquota的t和T选项来设置.</p>
]]></content>
  </entry>
  <entry>
    <title>centos服务器安装avast杀毒软件</title>
    <url>/2018/07/23/1122/</url>
    <content><![CDATA[<p>avast下载地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>www.avast.com<span class="regexp">/zh-cn/</span>linux-home-edition</span><br></pre></td></tr></table></figure>

<p>我们是centos 所以下载rpm包.<br>然后运行:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh **<span class="regexp">*.rpm</span></span><br></pre></td></tr></table></figure>

<p>avast就安装好了.<br>然后运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">avast -h</span></span><br></pre></td></tr></table></figure>

<p>这里会提示需要激活码,获取地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>www.avast.com<span class="regexp">/zh-cn/</span>resend-license-free-antivirus.php</span><br></pre></td></tr></table></figure>

<p>软件使用方法:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-_, <span class="comment">--console :工作在STDIN/STDOUT模式下.</span></span><br><span class="line">-a, <span class="comment">--testall :测试所有文件.</span></span><br><span class="line">-b, <span class="comment">--blockdevices :扫描块设备文件.</span></span><br><span class="line">-c, <span class="comment">--testfull :扫描所有文件.</span></span><br><span class="line">-d, <span class="comment">--directory :说明目录,不包括子目录.</span></span><br><span class="line">-i, <span class="comment">--ignoretype :忽略病毒报警信息.</span></span><br><span class="line">-n, <span class="comment">--nostats :不统计病毒数量.</span></span><br><span class="line">-p, <span class="comment">--continue=1234 :根据设定处理病毒文件,</span></span><br><span class="line"><span class="meta">#1:删除, 2:没有设置2选项, 3:修复, 4:停止扫描工作</span></span><br><span class="line">-r, <span class="comment">--report=[*]file 建立一个报告文件.</span></span><br><span class="line">-t, <span class="comment">--archivetype[=ZGBTIJRXOQHFVPYD6UWAN] 扫描文件后缀类型:</span></span><br><span class="line">Z:ZIP(<span class="keyword">default</span>),G:GZ(<span class="keyword">default</span>), B:BZIP2(<span class="keyword">default</span>), T:TAR(<span class="keyword">default</span>),</span><br><span class="line">I:MIME, J:ARJ, R:RAR, X:Exec(<span class="keyword">default</span>), O:ZOO,</span><br><span class="line">Q:ARC, H:LHA, F:TNEF, V:CPIO, K:CHM, P:RPM, Y:ISO,</span><br><span class="line">D:DBX, <span class="number">6</span>:SIS, U:OLE(<span class="keyword">default</span>), <span class="number">1</span>:INSTALL(<span class="keyword">default</span>),</span><br><span class="line">W:WINEXEC(<span class="keyword">default</span>), A:<span class="keyword">All</span>, N:<span class="keyword">None</span></span><br><span class="line">-v, <span class="comment">--viruslist=mask 显示所有病毒列表</span></span><br><span class="line">-h, <span class="comment">--help 显示帮助</span></span><br><span class="line"><span class="comment">--usage</span></span><br><span class="line">-V, <span class="comment">--version 打印版本信息</span></span><br></pre></td></tr></table></figure>

<p>升级的命令要补充一下 <code>avat-update</code> 这个命令没有任何参数.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS搭建DNS服务器反向解析详细步骤</title>
    <url>/2019/05/06/1118/</url>
    <content><![CDATA[<p>以下是基于CentOS系统的反向解析(IP192.168.1.2域名为shuxun.wang)为保证建设成功请不要错过任何一个步骤,以下所写 是详细步骤挨个执行命令也能保证成功!如果已做好正向解析(详细参考上篇文章)并通过测试的情况下课直接从第三步开始.</p>
<p>一.安装相关软件包:为保证顺利进行请按步骤先删除再重新安装所有软件包:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ rpm -qa | grep bind <span class="regexp">//</span>查看bind相关软件包</span><br><span class="line">$ rpm -e `rpm -qa | grep bind` --nodeps <span class="regexp">//</span>删除相关软件包</span><br><span class="line">$ mount <span class="regexp">/dev/</span>cdrom <span class="regexp">/media/</span> <span class="regexp">//</span>将系统光盘挂载到<span class="regexp">/media/</span></span><br><span class="line">$ cd <span class="regexp">/media/</span>Server<span class="regexp">/ /</span><span class="regexp">/进入/m</span>edia<span class="regexp">/Server/</span>目录(如果是CentOS系统则进入<span class="regexp">/media/</span>CentOS/目录)</span><br><span class="line">$ rpm -vih bind-* <span class="regexp">//</span>再次安装相关软件包</span><br><span class="line">$ rpm -vih caching-nameserver-<span class="number">9.3</span>.<span class="number">3</span>-<span class="number">7</span>.el5.i386.rpm <span class="regexp">//</span>在CentOS中软件包名称有所不一样所以要巧用Tab补全</span><br><span class="line">$ service named start <span class="regexp">//</span>重启named服务</span><br></pre></td></tr></table></figure>

<p>二.修改主配置文件:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>etc<span class="regexp">/ /</span><span class="regexp">/进入/</span>var<span class="regexp">/named/</span>chroot<span class="regexp">/etc/</span>目录</span><br><span class="line">$ vim named.caching-nameserver.conf <span class="comment">//修改主配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">options</span> &#123;</span><br><span class="line">    listen-on port <span class="number">53</span> &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    listen-on-v6 port <span class="number">53</span> &#123; ::<span class="number">1</span>; &#125;;</span><br><span class="line">    directory <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">    <span class="keyword">dump</span>-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">    query-<span class="keyword">source</span> port <span class="number">53</span>;</span><br><span class="line">    query-<span class="keyword">source</span>-v6 port <span class="number">53</span>;</span><br><span class="line">    allow-query &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;</span><br><span class="line">    channel default_debug &#123;</span><br><span class="line">    <span class="keyword">file</span> <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">    severity dynamic;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view localhost_resolver &#123;</span><br><span class="line">    match-clients &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    match-destinations &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    recursion yes;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果前面已经做好正向解析那么我们可以直接从这里开始.</p>
<p>三.修改主机配置文件的扩展文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>etc<span class="regexp">/ /</span><span class="regexp">/进入/</span>var<span class="regexp">/named/</span>chroot<span class="regexp">/etc/</span>目录</span><br><span class="line">$ vim named.rfc1912.zones <span class="regexp">//</span>修改主机配置文件的扩展名;在最后一行添加如下</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;1.168.192.in-addr.arpa&quot;</span> IN &#123; <span class="regexp">//</span>将你的主机IP地址前三位反写</span><br><span class="line">    type master;</span><br><span class="line">    file <span class="string">&quot;192.168.1.rev&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>四.建立192.168.1.rev的域配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>var<span class="regexp">/named/</span> <span class="regexp">//</span>进入<span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>var<span class="regexp">/named/</span>目录</span><br><span class="line">$ cp named.local <span class="number">192.168</span>.<span class="number">1</span>.rev <span class="regexp">//</span>拷贝域配置文件<span class="number">192.168</span>.<span class="number">1</span>.rev</span><br><span class="line">$ vim <span class="number">192.168</span>.<span class="number">1</span>.rev</span><br><span class="line"></span><br><span class="line"><span class="variable">$TTL</span> <span class="number">86400</span></span><br><span class="line">@ IN SOA localhost. root.localhost. (</span><br><span class="line"><span class="number">1997022700</span> ; Serial</span><br><span class="line"><span class="number">28800</span> ; Refresh</span><br><span class="line"><span class="number">14400</span> ; Retry</span><br><span class="line"><span class="number">3600000</span> ; Expire</span><br><span class="line"><span class="number">86400</span> ) ; Minimum</span><br><span class="line">IN NS localhost.</span><br><span class="line"><span class="number">2</span> IN PTR shuxun.wang. <span class="regexp">//</span>修改最后一行为(我的IP为<span class="number">192.168</span>.<span class="number">1.2</span>域名为shuxun.wang)</span><br><span class="line"></span><br><span class="line">$ bind-chroot-admin -s <span class="regexp">//</span>自动完成组和权限设置(在CentOS中可能会提示<span class="regexp">/usr/</span>bin<span class="regexp">/find: /</span>var<span class="regexp">/log/</span>named.log: 没有那个文件或目录)</span><br><span class="line">$ service named restart <span class="regexp">//</span>重启named服务</span><br></pre></td></tr></table></figure>

<p>五.测试验证:</p>
<p>为了验证成功最好修改本地DNS,将服务器改为自己的IP.</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">vi /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">nameserver <span class="number">192.168.1.2</span></span><br><span class="line">:wq //保存退出</span><br><span class="line"></span><br><span class="line">$ host <span class="number">192.168.1.2</span> //在本机验证解析成功</span><br><span class="line"></span><br><span class="line"><span class="number">192.168.1.2</span>.in-addr.arpa domain name pointer shuxun.wang.</span><br><span class="line"></span><br><span class="line">C:/Documents and Settings/Administrator&gt;nslookup //远端验证解析成功</span><br><span class="line"></span><br><span class="line">*** Can&#x27;t find server name for address <span class="number">219.244.93.2</span>: Non-existent domain</span><br><span class="line">*** Default servers are not available</span><br><span class="line">Default Server: UnKnown</span><br><span class="line">Address: <span class="number">219.244.93.2</span> //本来我的DNS为<span class="number">219.244.93.2</span></span><br><span class="line"></span><br><span class="line">&gt; server <span class="number">192.168.1.2</span> //更改解析主机</span><br><span class="line"></span><br><span class="line">Default Server: [<span class="number">192.168.1.2</span>]</span><br><span class="line">Address: <span class="number">192.168.1.2</span></span><br><span class="line"></span><br><span class="line">&gt; shuxun.wang</span><br><span class="line"></span><br><span class="line">Server: [<span class="number">192.168.1.2</span>]</span><br><span class="line">Address: <span class="number">192.168.1.2</span></span><br><span class="line"></span><br><span class="line">Name: shuxun.wang</span><br><span class="line">Address: <span class="number">192.168.1.2</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS搭建samba服务器</title>
    <url>/2010/12/11/1119/</url>
    <content><![CDATA[<p>熟悉Linux的用户可能常常在Linux上安装Samba服务来实现与Windows系统的文件共享和打印机共享,<br>他们之间的数据传输使用 SMB(Service Message Block)协议.这是一个在传输层之上的协议,<br>所以他可以支持很多不同异构系统的网络互联(比如,Linux,Solaris,Windows 等),<br>Samba之所以能够工作,因为SMB协议模仿了Windows内核的文件和打印共享协议.<br>微软已经将SMB改名为公共因特网文件系统(CIFS,Common Internet File System ),<br>并打算把它设计为Internet的标准协议.这在一定程度上是由于它想与最初的基于NetBIOS的SMB保持一定的距离.<br>NetBIOS是 Windows 网络的一个伟大的工具,Microsoft使用NetBIOS实现了一个网络文件/打印服务系统,<br>但是为LAN设计的它却注定了不能路由. Samba执行了SMB/CIFS的一个版本,这个版本在很大程度上与大多数的Windows版本兼容.<br>我们可以通过Windows的网络邻居来轻松访问安装了Samba的UNIX/LINUX服务器.<br>1.安装centos时在防火墙中开启文件共享服务,并选择安装文件共享服务器<br>2.启动 Samba 服务.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># chkconfig smb on　 ← 设置 Samba 自启动</span></span><br><span class="line"><span class="comment"># service smb start ← 启动Samba服务</span></span><br><span class="line">Starting<span class="built_in"> SMB </span>services:　　　　　　 [ OK ]</span><br><span class="line">Starting NMB services:　　　　　　 [ OK ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># smbpasswd -a root　 ← 将系统用户 root 加入到 Samba 用户数据库</span></span><br><span class="line">New<span class="built_in"> SMB </span>password:　 ← 输入该用户用于登录 Samba 的密码</span><br><span class="line">Retype new<span class="built_in"> SMB </span>password:　 ← 再次确认输入该密码</span><br><span class="line">Added<span class="built_in"> user </span>centospub.</span><br></pre></td></tr></table></figure>

<p>3.配置Samba<br>通过编辑 <code>/etc/samba/smb.conf</code> 让将要被共享的目录拥有充分的读写权限属性.</p>
<p>在smb.conf文件最后加入下面内容</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">all</span> file]</span><br><span class="line"><span class="keyword">comment</span> = centos <span class="keyword">all</span> file</span><br><span class="line"><span class="type">path</span> = /</span><br><span class="line"><span class="keyword">valid</span> users = root</span><br><span class="line"><span class="built_in">public</span> = <span class="keyword">no</span></span><br><span class="line">writable = yes</span><br><span class="line">printable = <span class="keyword">no</span></span><br><span class="line"><span class="keyword">create</span> mask = <span class="number">0777</span></span><br><span class="line">directory mask = <span class="number">0777</span></span><br><span class="line"></span><br><span class="line"># [<span class="keyword">all</span> file] 是共享名</span><br><span class="line"><span class="meta">#comment = centos all file是注释</span></span><br><span class="line"># <span class="type">path</span> = / 分享资源的完整路径名称,除了路径要正确外,目录的权限也要设对,我设置了共享/所有文件</span><br><span class="line"><span class="meta">#valid users = root valid users 说明:指定共享资源的有效用户,即允许访问该资源的用户</span></span><br><span class="line"># <span class="built_in">public</span> = <span class="keyword">no</span> 设置<span class="built_in">public</span>=<span class="keyword">no</span> 表示在网上邻居看见但不能进入</span><br><span class="line"># writable = yes writable = yes表示可写,writable = <span class="keyword">no</span>表示只读</span><br><span class="line"># printable<span class="comment">-------是yes/否no允许打印</span></span><br><span class="line"><span class="meta">#create mask-----建立文件时所给的权限</span></span><br><span class="line"><span class="meta">#directory mask--建立目录时所给的权限</span></span><br></pre></td></tr></table></figure>

<p>修改完smb.conf文件后一定要重启sam服务</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"># servcie smb <span class="keyword">restart</span> <span class="comment">---重启smb服务</span></span><br></pre></td></tr></table></figure>

<p>以上是我开启samba服务的过程</p>
<p>4、访问共享资源<br>在windows的桌面上打开”网上邻居”,并点击”查看工作组计算机”选项;<br>就出现 Samba 服务端的连接了,用户和密码就是你设置的.</p>
<p>============================================================<br>smb.conf手册</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">服务名:smb</span><br><span class="line">配置目录:/etc/sabma/</span><br><span class="line">主配置文件:/etc/sabma/smb.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#====================== Global Settings =====================</span></span><br><span class="line">17行workgroup</span><br><span class="line">语法 workgtoup = &lt;工作组群&gt;;</span><br><span class="line">预设 workgroup = MYGROUP</span><br><span class="line">说明 设定 Samba<span class="built_in"> Server </span>的工作组</span><br><span class="line">例 workgroup = workgroup 和WIN2000S设为一个组,可在网上邻居可中看到共享</span><br><span class="line"></span><br><span class="line">21行server string</span><br><span class="line">语法<span class="built_in"> server </span>string = &lt;说明&gt;;</span><br><span class="line">预设 sarver string = Samba<span class="built_in"> Server</span></span><br><span class="line"><span class="built_in"></span>说明 设定 Samba<span class="built_in"> Server </span>的注释</span><br><span class="line">其他 支持变量 t%-访问时间 I%-客户端IP m%-客户端主机名 M%-客户端域名 S%-客户端用户名</span><br><span class="line">例<span class="built_in"> server </span>string = this is a Samba<span class="built_in"> Server </span>设定出现在Windows网上邻居的 Samba<span class="built_in"> Server </span>注释为 this is a Samba<span class="built_in"> Server</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line">28行hosts allow</span><br><span class="line">语法 hosts aoolw = ; <span class="built_in">..</span>.</span><br><span class="line">预设 ; host allow = 192.168.1. 192.168.2. 127.</span><br><span class="line">说明 限制允许连接到 Samba<span class="built_in"> Server </span>的机器,多个参数以空格隔开.表示方法可以为</span><br><span class="line">完整的IP地址,如 192.168.0.1</span><br><span class="line">网段,如 192.168.0.</span><br><span class="line">例 hosts allow = 192.168.1. 192.168.0.1 表示允许192.168.1 网段的机器 网址为192.168.0.1 的机器 连接到自己的samba<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line">32行printcap name</span><br><span class="line">语法 printcap name = &lt;打印机配置文件&gt;;</span><br><span class="line">预设 printcap name = /etc/printcap</span><br><span class="line">说明 设定 samba srever 打印机的配置文件</span><br><span class="line">例 printcap name = /etc/printcap 设定 samba srever 参考 /etc/printcap 档的打印机设定</span><br><span class="line"></span><br><span class="line">33行load printers</span><br><span class="line">语法 load printers = ;</span><br><span class="line">预设 load printers = <span class="literal">yes</span></span><br><span class="line">说明 是否在开启 samba<span class="built_in"> server </span>时即共享打印机</span><br><span class="line"></span><br><span class="line">38行printing</span><br><span class="line">语法 printing = &lt;打印机类型&gt;;</span><br><span class="line">预设 printing = lprng</span><br><span class="line">说明 设定 samba<span class="built_in"> server </span>打印机所使用的类型,37行为目前所支持的类型</span><br><span class="line"></span><br><span class="line">42行guest account</span><br><span class="line">语法 guert account = &lt;帐户名称&gt;;</span><br><span class="line">预设 guert account = pcguest</span><br><span class="line">说明 设定访问 samba<span class="built_in"> server </span>的来宾帐户(即访问时不用输入用户名和密码的帐户),若设为pcguest的话则为默认为<span class="string">&quot;nobody&quot;</span>用户</span><br><span class="line">例 guert account = andy 设定设定访问 samba<span class="built_in"> server </span>的来宾帐户以andy用户登陆,则此登陆帐户享有andy用户的所有权限</span><br><span class="line"></span><br><span class="line">46行log file</span><br><span class="line">语法 log file = &lt;日志文件&gt;;</span><br><span class="line">预设 log file = /var/log/samba/%m.log</span><br><span class="line">说明 设定 samba<span class="built_in"> server </span>日志文件的储存位置和文件名(%m代表客户端主机名)</span><br><span class="line"></span><br><span class="line">49行max log size</span><br><span class="line">语法 max log size = ;</span><br><span class="line">预设 max log size = 0</span><br><span class="line">说明 设定日子文件的最大容量,单位KB 这里的预设值0代表不做限制</span><br><span class="line"></span><br><span class="line">53行security</span><br><span class="line">语法 security = &lt;等级&gt;;</span><br><span class="line">预设 security =<span class="built_in"> user</span></span><br><span class="line"><span class="built_in"></span>说明 设定访问 samba<span class="built_in"> server </span>的安全级别 共有四种</span><br><span class="line">share---不需要提供用户名和密码</span><br><span class="line">user----需要提供用户名和密码,而且身份验证由 samba<span class="built_in"> server </span>负责</span><br><span class="line">server--需要提供用户名和密码,可指定其他机器(winNT/2000/XP)或另一台 samba server作身份验证</span><br><span class="line">domain--需要提供用户名和密码,指定winNT/2000/XP域服务器作身份验证</span><br><span class="line"></span><br><span class="line">60行password<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>语法 password<span class="built_in"> server </span>= ;</span><br><span class="line">预设 password<span class="built_in"> server </span>= ;</span><br><span class="line">说明 指定某台服务器(包括windows 和 linux)的密码,作为用户登入时验证的密码</span><br><span class="line">其他 此项需配合 security = server时,才可设定本参数</span><br><span class="line"></span><br><span class="line">64行password level</span><br><span class="line"></span><br><span class="line">65行username level</span><br><span class="line">语法 password level = &lt;位数&gt;;</span><br><span class="line">username level = &lt;位数&gt;;</span><br><span class="line">预设 password level = 8</span><br><span class="line">username level = 8</span><br><span class="line">说明 设定用户名和密码的位数,预设为8位字符</span><br><span class="line"></span><br><span class="line">70行encrypt passwords</span><br><span class="line">语法 encrypt passwords = ;</span><br><span class="line">预设 encrypt passwords = yse</span><br><span class="line">说明 设定是否对samba的密码加密</span><br><span class="line"></span><br><span class="line">71行smb passwd file</span><br><span class="line">语法<span class="built_in"> smb </span>passwd file = &lt;密码文件&gt;;</span><br><span class="line">预设<span class="built_in"> smb </span>passwd file = /etc/samba/smbpasswd</span><br><span class="line">说明 设定samba的密码文件</span><br><span class="line"></span><br><span class="line">130行local master</span><br><span class="line">语法 local master = ;</span><br><span class="line">预设 local master = <span class="literal">no</span></span><br><span class="line">说明 设定 samba<span class="built_in"> server </span>是否要担当LMB角色(LMB负责收集本地网络的Browse List资源),通常无特殊原因设为<span class="literal">no</span></span><br><span class="line"></span><br><span class="line">134行os level = 33</span><br><span class="line">语法 os level = &lt;数字&gt;;</span><br><span class="line">预设 os level = 33</span><br><span class="line">说明 设定 samba server的os level. os level从 0 到 255 . winNT的os level为33, win95/98的os level 是 1 .</span><br><span class="line">若要拿samba<span class="built_in"> server </span>当LMB或DMB则它的os level至少要大于NT的33以上</span><br><span class="line"></span><br><span class="line">139行domain master</span><br><span class="line">语法 domain master = ;</span><br><span class="line">预设 domain master = <span class="literal">yes</span></span><br><span class="line">说明 设定 samba<span class="built_in"> server </span>是否要担当DMB角色(DMB会负责收集其他子网的Browse List资源),通常无特殊原因设为<span class="literal">no</span></span><br><span class="line"></span><br><span class="line">143行preferred master</span><br><span class="line">语法 preferred master = ;</span><br><span class="line">预设 preferred master = <span class="literal">yes</span></span><br><span class="line">说明 设定 samba<span class="built_in"> server </span>是否要担当PDC角色(PDC会负责追踪网络帐户进行的一切变更),通常无特殊原因设为<span class="literal">no</span>.</span><br><span class="line">(同一网段不可有两个PDC,他们会每5分钟抢主控权一次)</span><br><span class="line"></span><br><span class="line">163行wins support</span><br><span class="line">语法 wins support = ;</span><br><span class="line">预设 wins support = <span class="literal">yes</span></span><br><span class="line">说明 设定samba<span class="built_in"> server </span>是否想网络提供WINS服务,通常无特殊原因设为<span class="literal">no</span>.</span><br><span class="line">除非所处网络上没有主机提供WINS服务且需要此台samba server提供WINS服务是才设<span class="literal">yes</span></span><br><span class="line">其他 wins support 和 wins<span class="built_in"> server </span>只能选择一个</span><br><span class="line"></span><br><span class="line">167行wins<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>语法 wins<span class="built_in"> server </span>= ;</span><br><span class="line">预设 wins<span class="built_in"> server </span>= w.x.y.z</span><br><span class="line">说明 设定samba<span class="built_in"> server </span>是否要使用别台主机提供的WINS服务.通常无特殊原因设为<span class="literal">no</span>.除非所处网络上有一台主机提供WINS服务才要设<span class="literal">yes</span></span><br><span class="line">其他 wins support 和 wins<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>例 wins<span class="built_in"> server </span>= 192.168.0.1 表示samba server要使用192.168.0.1提供的WINS服务</span><br><span class="line"></span><br><span class="line"><span class="comment">#=============Share Definitions ================</span></span><br><span class="line"></span><br><span class="line">[homes]</span><br><span class="line">comment = Home Directories</span><br><span class="line">browseable = <span class="literal">no</span></span><br><span class="line">writable = <span class="literal">yes</span></span><br><span class="line">valid<span class="built_in"> users </span>= %S</span><br><span class="line"></span><br><span class="line">使用者本身的<span class="string">&quot;家&quot;</span>目录,当使用者以samba使用者身份登入samba<span class="built_in"> server </span>后,</span><br><span class="line">samba<span class="built_in"> server </span>底下会看到自己的家目录,目录名称是使用者自己的帐号</span><br><span class="line"></span><br><span class="line">[分享的资源名称]</span><br><span class="line">&lt;指令1&gt;; = (参数)</span><br><span class="line">&lt;指令2&gt;; = (参数)</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"></span><br><span class="line">要提供分享资源时,须先把欲分享的资源以 [ ] 符号括住,底下通常会带指令和参数来表示此资源的设定和存取权限等,详情如下</span><br><span class="line"></span><br><span class="line">comment---------注释说明</span><br><span class="line">path------------分享资源的完整路径名称,除了路径要正确外,目录的权限也要设对</span><br><span class="line">browseable------是<span class="literal">yes</span>/否<span class="literal">no</span>在浏览资源中显示共享目录,若为否则必须指定共享路径才能存取</span><br><span class="line">printable-------是<span class="literal">yes</span>/否<span class="literal">no</span>允许打印</span><br><span class="line">hide dot ftles--是<span class="literal">yes</span>/否<span class="literal">no</span>隐藏隐藏文件</span><br><span class="line">public----------是<span class="literal">yes</span>/否<span class="literal">no</span>公开共享,若为否则进行身份验证(只有当security = share 时此项才起作用)</span><br><span class="line">guest ok--------是<span class="literal">yes</span>/否<span class="literal">no</span>公开共享,若为否则进行身份验证(只有当security = share 时此项才起作用)</span><br><span class="line">read only-------是<span class="literal">yes</span>/否<span class="literal">no</span>以只读方式共享当与writable发生冲突时也writable为准</span><br><span class="line">writable--------是<span class="literal">yes</span>/否<span class="literal">no</span>不以只读方式共享当与read only发生冲突时,无视read only</span><br><span class="line">vaild users-----设定只有此名单内的用户才能访问共享资源(拒绝优先)(用户名/@组名)</span><br><span class="line">invalid users---设定只有此名单内的用户不能访问共享资源(拒绝优先)(用户名/@组名)</span><br><span class="line">read list-------设定此名单内的成员为只读(用户名/@组名)</span><br><span class="line">write list------若设定为只读时,则只有此设定的名单内的成员才可作写入动作(用户名/@组名)</span><br><span class="line">create mask-----建立文件时所给的权限</span><br><span class="line">directory mask--建立目录时所给的权限</span><br><span class="line">force group-----指定存取资源时须以此设定的群组使用者进入才能存取(用户名/@组名)</span><br><span class="line">force user------指定存取资源时须以此设定的使用者进入才能存取(用户名/@组名)</span><br><span class="line">allow hosts-----设定只有此网段/IP的用户才能访问共享资源</span><br><span class="line">allwo hosts = 网段 except<span class="built_in"> IP</span></span><br><span class="line"><span class="built_in"></span>deny hosts------设定只有此网段/IP的用户不能访问共享资源</span><br><span class="line">allow <span class="attribute">hosts</span>=本网段指定IP指定IP</span><br><span class="line">deny <span class="attribute">hosts</span>=指定IP本网段指定IP</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos-防火墙只允许80-22-端口访问</title>
    <url>/2016/11/11/1120/</url>
    <content><![CDATA[<p>这个教程比较有意思,让服务器除了网站和ssh能链接就不能做任何事情了,<br>就连在服务器yum安装软件,ping 百度都无法实现.<br>这样就保证了服务器的安全.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -F <span class="comment">/* 清除所有规则 */</span></span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">22</span> -j ACCEPT <span class="comment">/*允许包从22端口进入*/</span></span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> tcp --sport <span class="number">22</span> -m state --state ESTABLISHED -j ACCEPT <span class="comment">/*允许从22端口进入的包返回*/</span></span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -s <span class="number">127.0</span>.<span class="number">0.1</span> -d <span class="number">127.0</span>.<span class="number">0.1</span> -j ACCEPT <span class="comment">/*允许本机访问本机*/</span></span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -s <span class="number">127.0</span>.<span class="number">0.1</span> -d <span class="number">127.0</span>.<span class="number">0.1</span> -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp -s <span class="number">0</span>/<span class="number">0</span> --dport <span class="number">80</span> -j ACCEPT <span class="comment">/*允许所有IP访问80端口*/</span></span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> tcp --sport <span class="number">80</span> -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">P</span> <span class="selector-tag">INPUT</span> DROP</span><br><span class="line">iptables -<span class="selector-tag">P</span> FORWARD DROP</span><br><span class="line">iptables -<span class="selector-tag">P</span> OUTPUT DROP</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables <span class="comment">/*保存配置*/</span></span><br><span class="line">iptables -L <span class="comment">/* 显示iptables列表 */</span></span><br></pre></td></tr></table></figure>

<p>如果需要在服务器安装软件,或者下载文件则需要运行:</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><span class="line">iptables -<span class="keyword">P</span> INPUT <span class="keyword">ACC</span>EPT</span><br><span class="line">iptables -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br></pre></td></tr></table></figure>

<p>这样就可以让服务器访问外网了,不过使用网络结束,需要重新拒绝访问.</p>
<p>如果需要集群间的计算机互相访问则可以再拒绝所有之前添加如下规则.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -A FORWARD -s <span class="number">10.0.0.0</span>/<span class="number">24</span> -j ACCEPT /*允许局域网发送数据包*/</span><br><span class="line"><span class="attribute">iptables</span> -A FORWARD -d <span class="number">10.0.0.0</span>/<span class="number">24</span> -j ACCEPT /*允许局域网接收数据包*/</span><br></pre></td></tr></table></figure>

<p>允许某台计算机访问服务器的某个端口.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -A INPUT -p tcp -s <span class="number">192.168.0.10</span> --dport <span class="number">80</span> -j ACCEPT /*允许<span class="number">192.168.0.10</span>访问<span class="number">80</span>端口*/</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos服务器安装tomcat</title>
    <url>/2019/02/18/1123/</url>
    <content><![CDATA[<p>我简单介绍一些tomcat服务器吧,它可以运行jsp文件,servlet都没有问题.<br>一些小的jsp网站或者个人学习jsp是不错的选择.<br>比较大一点的jsp服务器软件 Jboss , weblogic 等等.<br>下面我们在 CentOS 5.3 Linux 服务器系统安装 apache-tomcat-6.0.18.<br>apache-tomcat-6.0.18.tar.gz 文件你可以去 <a href="http://www.apache.org/">http://www.apache.org</a> 上面进行下载,<br>而且有多种版本选择, 我选择了目前最新的版本.<br>下载好了 传送到服务器上面.<br>解压:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>tar zxvf apache-tomcat<span class="number">-6.0</span>.<span class="number">18</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压完成就可以把解压出来的文件夹移动到 <code>/usr/local</code>下面并且改名.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ mv apache-tomcat-<span class="number">6.0</span>.<span class="number">18</span> <span class="regexp">/usr/</span>local/tomcat</span><br></pre></td></tr></table></figure>

<p>这样就安装完成,呵呵,是因为tomcat直接解压就可以用,不需要安装.</p>
<p>下面设置 tomcat 相关的环境变量:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vi ~/.bash_profile	<span class="comment">#加入 tomcat 环境参数</span></span><br><span class="line"></span><br><span class="line">TOMCAT_HOME=/usr/<span class="built_in">local</span>/tomcat</span><br><span class="line"><span class="built_in">export</span> PATH JAVA_HOME CLASSPATH TOMCAT_HOME</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile , 让环境变量生效</span><br></pre></td></tr></table></figure>

<p>下面就可以启动 tomcat 服务器了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>bin/startup.sh</span><br><span class="line"></span><br><span class="line">Using CATALINA_BASE:   <span class="regexp">/usr/</span>local/tomcat</span><br><span class="line">Using CATALINA_HOME:   <span class="regexp">/usr/</span>local/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: <span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>temp</span><br><span class="line">Using JRE_HOME:       <span class="regexp">/usr/</span>java/jdk1.<span class="number">7.0</span></span><br></pre></td></tr></table></figure>

<p>没有其他信息,表示正常启动了,你也可以查看 tomcat 端口是否打开.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>netstat -tnl 		查看 <span class="number">8080</span>  <span class="number">8009</span> 这<span class="number">2</span>个端口,如果打开了,证明tomcat正常运行.</span><br><span class="line">tcp        0      0 ::<span class="symbol">:</span><span class="number">8009</span>        ::<span class="symbol">:*</span>             LISTEN</span><br><span class="line">tcp        0      0 ::<span class="symbol">:</span><span class="number">8080</span>        ::<span class="symbol">:*</span>             LISTEN</span><br></pre></td></tr></table></figure>

<p>下面进行测试:</p>
<p>可以在xp系统,作为局域网访问 刚刚做好的Tomcat服务器.</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">$ ifconfig 	#查看服务器 ip地址.</span><br><span class="line">inet addr:<span class="number">192.168.138.128</span>  Bcast:<span class="number">192.168.138.255</span>  Mask:<span class="number">255.255.255.0</span></span><br></pre></td></tr></table></figure>

<p>所以在局域网中,xp 访问地址是 <a href="http://192.168.138.128:8080/">http://192.168.138.128:8080</a>.<br>注意要写上 8080 端口.<br>发现不能打开 tomcat 默认页面,是因为 CentOS 5.3 操作系统中 默认 iptables 防火墙设置的原因,没有允许 8080 端口.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> iptables <span class="operator">-F</span> 这个命令可以清除 CentOS5.<span class="number">3</span> 中 iptables 自带防火墙默认规则</span><br></pre></td></tr></table></figure>

<p>清除完毕 再进行访问.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">If yo<span class="string">u&#x27;re seeing this page via a web browser,</span></span><br><span class="line"><span class="string">it means you&#x27;</span>ve setup Tomcat successfully. Congratulations!</span><br></pre></td></tr></table></figure>

<p>正常显示出来了.<br>下面 查看 tomcat 运行时环境的 内存大小情况.<br>在 tomcat 默认的网站路径编写一个 test.jsp 文件,下面就是网页内容.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>webapps/ROOT   这个就是网站的物理地址,看我演示吧.</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">Runtime</span> lRuntime = <span class="keyword">Runtime</span>.getRuntime();</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;\*\*\* BEGIN MEMORY STATISTICS \*\*\*&lt;br/&gt;&quot;</span>);</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;Free  Memory: &quot;</span>+lRuntime.freeMemory()<span class="regexp">/1024/</span><span class="number">1024</span>+<span class="string">&quot;M&lt;br/&gt;&quot;</span>);</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;Max   Memory: &quot;</span>+lRuntime.maxMemory()<span class="regexp">/1024/</span><span class="number">1024</span>+<span class="string">&quot;M&lt;br/&gt;&quot;</span>);</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;Total Memory: &quot;</span>+lRuntime.totalMemory()<span class="regexp">/1024/</span><span class="number">1024</span>+<span class="string">&quot;M&lt;br/&gt;&quot;</span>);</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;Available Processors : &quot;</span>+lRuntime.availableProcessors()+<span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">out.<span class="keyword">println</span>(<span class="string">&quot;\*\*\* END MEMORY STATISTICS \*\*\*&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>保存文件, 就可以访问了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>shuxun.wang:<span class="number">8080</span>/test.jsp</span><br></pre></td></tr></table></figure>

<p>你也可以写另外的 jsp 文件进行学习.<br>是吧, 很简单的一个 jsp 页面:</p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">&lt;<span class="comment">%</span></span><br><span class="line">    out.println( <span class="string">&quot;Hello, shuxun.wang&quot;</span> );</span><br><span class="line"><span class="comment">%&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体进一步学习 jsp 网页编程这里不多说,需要一定的java语言基础.<br>Linux 下 tomcat 运行内存设置大小:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">vi ~<span class="string">/.bash_profile</span></span><br><span class="line">JAVA_OPTS=<span class="string">&quot;-Xms256m -Xmx512m&quot;</span> <span class="comment"># 本行为新加内容</span></span><br></pre></td></tr></table></figure>

<p>保存, 退出.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ~/.bash_profile   <span class="comment"># 使环境变量设置 生效</span></span></span><br></pre></td></tr></table></figure>

<p>最后就是让服务器 启动时候自动 运行 tomcat 了.<br>我们最简单的方法就是通过startup.sh来自动启动Tomcat,编辑:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>文件最后增加内容(假设JDK目录是 <code>/usr/java</code>,Tomcat目录是 <code>/usr/local/tomcat</code>)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">export JDK_HOME=<span class="regexp">/usr/</span>java/jdk1.<span class="number">7.0</span></span><br><span class="line">export JAVA_HOME=<span class="regexp">/usr/</span>java/jdk1.<span class="number">7.0</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>bin/startup.sh</span><br></pre></td></tr></table></figure>

<p>保存退出.</p>
<p>最后当然是 重启服务器 看看是否自动启动啦, 呵呵.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure>

<p>启动比较慢..查看端口 8080 自动打开了.说明没有问题.<br>再用浏览器访问, 发现不能访问, 应该是 iptables 防火墙问题了,<br>我忘记 保存, 修改iptables 的设置了.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> iptables <span class="operator">-F</span></span><br><span class="line"><span class="variable">$</span> service iptables save</span><br><span class="line">Saving firewall rules to /etc/sysconfig/iptables:          [  <span class="type">OK</span>  ]</span><br></pre></td></tr></table></figure>

<p>要这2条命令 一起执行才可以, 这样才会保存到配置文件中,下次开机就直接可以访问jsp网页了.</p>
]]></content>
  </entry>
  <entry>
    <title>centos解压.7z文件</title>
    <url>/2012/12/02/1124/</url>
    <content><![CDATA[<p>网址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>p7zip.sourceforge.net/</span><br></pre></td></tr></table></figure>

<p>安装:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -jxvf p<span class="number">7</span>zip_<span class="number">9</span>.<span class="number">13</span>_src_all.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">cd</span> p<span class="number">7</span>zip_<span class="number">9</span>.<span class="number">13</span></span><br><span class="line"><span class="attribute">make</span></span><br><span class="line"><span class="attribute">make</span> install</span><br></pre></td></tr></table></figure>

<p>命令行方式:</p>
<p>压缩:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7za</span> a -t<span class="number">7</span>z -mx=<span class="number">9</span> test.<span class="number">7</span>z test-dir</span><br></pre></td></tr></table></figure>

<p>参数解释:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">a          添加一个归档文件</span><br><span class="line"></span><br><span class="line">-t7z       表明这是一个7z的文件</span><br><span class="line"></span><br><span class="line">-mx=9      表明我们需要极限的压缩比.默认为5</span><br><span class="line"></span><br><span class="line"><span class="keyword">test</span>.7z    压缩为<span class="keyword">test</span>.7z文件</span><br><span class="line"></span><br><span class="line"><span class="keyword">test</span>-<span class="keyword">dir</span>   压缩的文件夹为<span class="keyword">test</span>-<span class="keyword">dir</span></span><br></pre></td></tr></table></figure>

<p>解压缩:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7za</span> X test.<span class="number">7</span>z</span><br></pre></td></tr></table></figure>

<p>值得指出的是:解压缩最好使用X参数,而不是 e 7za X test.7z.使用参数e有可能丢失目录结构.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS服务器安全与优化</title>
    <url>/2011/02/07/1121/</url>
    <content><![CDATA[<p>第一:停止ipv6<br>CentOS默认的状态下,ipv6是被启用的状态.因为我们不使用ipv6,所以,停止ipv6,以最大限度保证安全和快速.<br>如上图所示:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sit0</span>      Link encap:IPv<span class="number">6</span>-in-IPv<span class="number">4</span></span><br><span class="line">          <span class="attribute">NOARP</span>  MTU:<span class="number">1480</span>  Metric:<span class="number">1</span></span><br><span class="line">          <span class="attribute">RX</span> packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          <span class="attribute">TX</span> packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          <span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          <span class="attribute">RX</span> bytes:<span class="number">0</span> (<span class="number">0</span>.<span class="number">0</span> b)  TX bytes:<span class="number">0</span> (<span class="number">0</span>.<span class="number">0</span> b)</span><br></pre></td></tr></table></figure>

<p>这表明,IPV6功能是被启动的状态.</p>
<p>解决方法:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">vi <span class="string">/etc/modprobe.conf</span> <span class="comment"># 修改相应配置文件,添加如下行到文尾:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alias</span> net-pf-10 off</span><br><span class="line"><span class="keyword">alias</span> ipv6 off</span><br><span class="line"></span><br><span class="line"><span class="keyword">shutdown</span> -r now <span class="comment"># 重新启动系统,使设置生效(我试过重启网卡不生效)</span></span><br></pre></td></tr></table></figure>

<p>第二:停止打印服务</p>
<p>系统默认被设置为自动启动的打印服务,这个需要不需要要看你们具体情况了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>cups stop <span class="comment"># 停止打印服务</span></span><br><span class="line"></span><br><span class="line">停止 cups: 　　　　　　 　　　　[ 确定 ]　 　                 <span class="comment"># 停止服务成功,出现&quot;确定&quot;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chkconfig cups off                    # 禁止打印服务自动启动</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chkconfig --list cups                 # 确认打印服务自启动设置状态</span></span><br><span class="line"></span><br><span class="line">cups <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭  <span class="comment"># 0-6都为off的状态就OK</span></span><br></pre></td></tr></table></figure>

<p>第三:防止别人ping</p>
<p>1)命令提示符下打</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">echo <span class="number">1</span>　&gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/icmp_ignore_all</span><br></pre></td></tr></table></figure>

<p>2)用防火墙禁止(或丢弃) icmp 包</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> icmp -j DROP</span><br></pre></td></tr></table></figure>

<p>第四:更改SSH端口,如改为5000</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>默认port是22,我改为5000,保存退出.</p>
<p>第五:修改命令history记录数</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>找到 HISTSIZE=1000 改为 HISTSIZE=30(举例)</p>
<p>第六:打开SYN Cookie功能,该功能可以防止部分SYN攻击</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&#x27;net.ipv4.tcp_syncookies = 1&#x27;</span> &gt;&gt; /etc/sysctl<span class="selector-class">.conf</span></span><br><span class="line">sysctl -<span class="selector-tag">p</span></span><br><span class="line"></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.ip_forward</span> = <span class="number">0</span>                        #如果为网关或路由器应设置为<span class="number">1</span></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.conf</span><span class="selector-class">.default</span><span class="selector-class">.rp_filter</span> = <span class="number">1</span>            #提供 IP Spoofing 保护</span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.conf</span><span class="selector-class">.default</span><span class="selector-class">.accept_source_route</span> = <span class="number">0</span>  #禁止 IP源路由功能</span><br><span class="line">kernel<span class="selector-class">.sysrq</span> = <span class="number">0</span></span><br><span class="line">kernel<span class="selector-class">.core_uses_pid</span> = <span class="number">1</span></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_syncookies</span> = <span class="number">1</span>                    #提供 TCP SYN 泛滥保护</span><br><span class="line">kernel<span class="selector-class">.msgmnb</span> = <span class="number">65536</span></span><br><span class="line">kernel<span class="selector-class">.msgmax</span> = <span class="number">65536</span></span><br><span class="line">kernel<span class="selector-class">.shmmax</span> = <span class="number">4294967295</span></span><br><span class="line">kernel<span class="selector-class">.shmall</span> = <span class="number">268435456</span></span><br></pre></td></tr></table></figure>

<p>第七:资源限制 (本设置只对登录到系统中的用户有效)</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">    <span class="number"> 42 </span><span class="comment">#*                      soft    core          0      #表示禁止创建core文件</span></span><br><span class="line">    <span class="number"> 43 </span><span class="comment">#*                      hard    rss           10000  #其他用户最多使用10000M内存.</span></span><br><span class="line">    <span class="number"> 44 </span><span class="comment">#@student               hard    nproc         20     #表示最多把进程数限制在20</span></span><br><span class="line">    <span class="number"> 45 </span><span class="comment">#@faculty               soft    nproc         20</span></span><br><span class="line">    <span class="number"> 46 </span><span class="comment">#@faculty               hard    nproc         50</span></span><br><span class="line">    <span class="number"> 47 </span><span class="comment">#ftp                    hard    nproc         0</span></span><br></pre></td></tr></table></figure>

<p>第八:使ctrl+alt+del关机键无效</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/i</span>nittab</span><br></pre></td></tr></table></figure>

<p>查找:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">ca::ctrlaltdel:<span class="regexp">/sbin/</span>shutdown -t3 -r now</span><br></pre></td></tr></table></figure>

<p>在这句前面加”#”注释掉即可.</p>
<p>/sbin/init q # 使上面设置生效</p>
]]></content>
  </entry>
  <entry>
    <title>centos解压.tar.xz 文件的方法</title>
    <url>/2019/08/09/1125/</url>
    <content><![CDATA[<p>需要进行两步操作:</p>
<p>1.执行:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">xz -d node<span class="selector-class">.tar</span><span class="selector-class">.xz</span> </span><br></pre></td></tr></table></figure>
<p>此时该目录下会产生一个node.tar 文件.</p>
<p>2.执行解压操作:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -xvf node.tar</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos禁止ip段和禁止icmp 包</title>
    <url>/2016/08/11/1126/</url>
    <content><![CDATA[<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -F</span><br><span class="line">iptables -<span class="selector-tag">P</span> <span class="selector-tag">INPUT</span> ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">P</span> OUTPUT ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">P</span> FORWARD ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> FORWARD -s <span class="number">124.115</span>.<span class="number">0.0</span>/<span class="number">24</span> -j DROP</span><br><span class="line">iptables -<span class="selector-tag">I</span> FORWARD -d <span class="number">202.96</span>.<span class="number">170.164</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>补充:</p>
<p>单个IP的命令是:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -s <span class="number">124.115</span>.<span class="number">0.199</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封IP段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">124.115.0.0</span>/<span class="number">16</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">124.115.3.0</span>/<span class="number">16</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">124.115.4.0</span>/<span class="number">16</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封整个段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">124.115.0.0</span>/<span class="number">8</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封几个段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">61.37.80.0</span>/<span class="number">24</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">61.37.81.0</span>/<span class="number">24</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>用iptables禁止一个ＩＰ地址范围:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span>   -A   FORWARD   -s   <span class="number">10.0.0.1</span>-<span class="number">255</span>   -j   DROP</span><br></pre></td></tr></table></figure>

<p>用防火墙禁止(或丢弃) icmp 包:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> icmp -j DROP</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos禁止别人ping</title>
    <url>/2016/06/10/1127/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure>

<p>修改里面的内容为1(1是不允许别人ping 0是允许).</p>
]]></content>
  </entry>
  <entry>
    <title>centos精简服务</title>
    <url>/2016/01/17/1128/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NetworkManager</span>  <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">acpid</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">anacron</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">apmd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">atd</span>             <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">auditd</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">autofs</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">avahi</span>-daemon    <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">avahi</span>-dnsconfd  <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">bluetooth</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">capi</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">conman</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">cpuspeed</span>        <span class="number">0</span>:关闭  <span class="number">1</span>:启用  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">crond</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">cups</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">dnsmasq</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">dund</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">firstboot</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:关闭  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">gpm</span>             <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">haldaemon</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">hidd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">httpd</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">ibmasm</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">ip6tables</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">iptables</span>        <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">irda</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">irqbalance</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">isdn</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">kudzu</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">lisa</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">lm_sensors</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">lvm2</span>-monitor    <span class="number">0</span>:关闭  <span class="number">1</span>:启用  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">mcstrans</span>        <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">mdmonitor</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">mdmpd</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">messagebus</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">microcode_ctl</span>   <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">multipathd</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">mysqld</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">netconsole</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">netfs</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">netplugd</span>        <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">network</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">nfs</span>             <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">nfslock</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">nscd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">ntpd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">oddjobd</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">pand</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">pcscd</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">portmap</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">psacct</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">rawdevices</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">rdisc</span>           <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">readahead_early</span> <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">readahead_later</span> <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">restorecond</span>     <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">rpcgssd</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">rpcidmapd</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">rpcsvcgssd</span>      <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">saslauthd</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">sendmail</span>        <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">smartd</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">sshd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">syslog</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">tcsd</span>            <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">vncserver</span>       <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">vsftpd</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">wdaemon</span>         <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">wpa_supplicant</span>  <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">xfs</span>             <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">ypbind</span>          <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:关闭  <span class="number">3</span>:关闭  <span class="number">4</span>:关闭  <span class="number">5</span>:关闭  <span class="number">6</span>:关闭</span><br><span class="line"><span class="attribute">yum</span>-updatesd    <span class="number">0</span>:关闭  <span class="number">1</span>:关闭  <span class="number">2</span>:启用  <span class="number">3</span>:启用  <span class="number">4</span>:启用  <span class="number">5</span>:启用  <span class="number">6</span>:关闭</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos开启nginx的gzip压缩</title>
    <url>/2012/03/27/1129/</url>
    <content><![CDATA[<p>我们安装apache第一件事情就是开启apache的gzip的压缩,现在我们来开启nginx的gzip压缩.<br>zip压缩用的是http_gzip_module模块.这个模块支持在线实时压缩输出数据流,使用范例:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gzip</span>                 <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span>      <span class="number">1000</span>;</span><br><span class="line"><span class="attribute">gzip_proxied</span>         expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private auth;</span><br><span class="line"><span class="attribute">gzip_types</span>           text/plain application/x-javascript text/css text/html application/xml;</span><br><span class="line"></span><br><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>|<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>开启或者关闭gzip模块:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>设置允许压缩的页面最小字节数,页面字节数从header头中的Content-Length中进行获取.<br>默认值是0,不管页面多大都压缩.<br>建议设置成大于1k的字节数,小于1k可能会越压越大. 即:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1024</span></span><br><span class="line">gzip_proxied expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private auth;</span><br></pre></td></tr></table></figure>

<p>Nginx作为反向代理的时候启用,开启或者关闭后端服务器返回的结果,匹配的前提是后端服务器必须要返回包含”Via”的 header头.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">gzip_types <span class="built_in">text</span>/plain <span class="built_in">application</span>/xml;</span><br></pre></td></tr></table></figure>

<p>匹配MIME类型进行压缩,(无论是否指定)”text/html”类型总是会被压缩的.<br>好了,让我们一起享受nginx的gzip带来的速度上的快感吧.</p>
]]></content>
  </entry>
  <entry>
    <title>centos开远程桌面访问windows</title>
    <url>/2014/09/10/1130/</url>
    <content><![CDATA[<p>安装rdesktop:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> rdesktop</span><br></pre></td></tr></table></figure>

<p>命令行中可用rdesktop -h得到命令帮助.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rdesktop</span> -g <span class="number">1024</span>x<span class="number">768</span> -d <span class="number">24</span>hostname</span><br></pre></td></tr></table></figure>

<p>其中 “g 1024×768”设置分辨率为1024×768,”d 24”设置真彩24 位,hostname为 Windows 机器的主机名或者IP 地址.在输入了Windows XP的用户名和密码后,就可以登录并操作远程的Windows系统.</p>
]]></content>
  </entry>
  <entry>
    <title>centos上布置postfix邮件服务器</title>
    <url>/2016/12/13/1132/</url>
    <content><![CDATA[<p>系统自带的sandmail会和postfix冲突.</p>
<p>第一步卸载sandmail.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">yum <span class="builtin-name">remove</span> sandmail</span><br></pre></td></tr></table></figure>

<p>第二步:安装postfix ,dovecot,cyrus-sasl.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> devecot</span><br><span class="line">yum -y <span class="keyword">install</span> postfix</span><br><span class="line">yum -y <span class="keyword">install</span> cyrus-sasl</span><br></pre></td></tr></table></figure>

<p>三、修改postfix的配置文件.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[root@ser ~]</span><span class="comment"># vim /etc/postfix/main.cf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">myhostname</span> = mail.shuxun.wang</span><br><span class="line"><span class="attr">mydomain</span> = shuxun.wang</span><br><span class="line"><span class="attr">myorigin</span> = shuxun.wang</span><br><span class="line"><span class="attr">inet_interfaces</span> =all</span><br><span class="line"><span class="attr">mynetworks</span> = <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">240</span></span><br><span class="line"><span class="attr">relay_domains</span> = shuxun.wang, <span class="variable">$mydomain</span></span><br><span class="line"><span class="attr">mydestination</span> = <span class="variable">$myhostname</span>, localhost.<span class="variable">$mydomain</span>, localhost, <span class="variable">$mydomain</span>,       mail.<span class="variable">$mydomain</span>, www.<span class="variable">$mydomain</span>, ftp.<span class="variable">$mydomain</span></span><br></pre></td></tr></table></figure>

<p>重启　postfix 服务.</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">[root<span class="meta">@ser</span> <span class="operator">~</span>]# service <span class="keyword">postfix</span> restart</span><br><span class="line"><span class="type">Shutting</span> down <span class="keyword">postfix</span>:                                     [  <span class="type">OK</span>  ]</span><br><span class="line"><span class="type">Starting</span> <span class="keyword">postfix</span>:                                          [  <span class="type">OK</span>  ]</span><br><span class="line">[root<span class="meta">@ser</span> <span class="operator">~</span>]# chkconfig  <span class="keyword">postfix</span> on</span><br><span class="line">[root<span class="meta">@ser</span> <span class="operator">~</span>]# chkconfig  dovecot on</span><br></pre></td></tr></table></figure>

<p>修改dovecot的配置文件.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vim</span> /etc/dovecot.conf</span><br><span class="line"></span><br><span class="line"><span class="attribute">protocols</span> = imap imaps  pop<span class="number">3</span> pop<span class="number">3</span>s(在后面启动dovecot时,说端口已经被使用,lsof -i tcp:端口,是pop<span class="number">3</span>s占用了,如果出现这样的情况,把这里的pop<span class="number">3</span>s去掉.)</span><br><span class="line"><span class="attribute"><span class="nomarkup">listen</span></span> = *</span><br></pre></td></tr></table></figure>

<p>在iptables　里开放25,110,143端口.</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment"># vim /etc/sysconfig/iptables</span></span><br><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">110</span> -j ACCEPT</span><br><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">25</span> -j ACCEPT</span><br><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">143</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>重启iptables.</p>
<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment"># service iptables restart</span></span><br><span class="line"><span class="attribute">Flushing firewall rules</span>:                               [  OK  ]</span><br><span class="line"><span class="attribute">Setting chains to policy ACCEPT</span>: filter                [  OK  ]</span><br><span class="line"><span class="attribute">Unloading iptables modules</span>:                            [  OK</span><br><span class="line"><span class="attribute">Applying iptables firewall rules</span>:                     [  OK  ]</span><br><span class="line"><span class="attribute">Loading additional iptables modules</span>: ip_conntrack_netbios_n[  OK  ]ntrack_ftp</span><br><span class="line">[root@ser ~]<span class="comment"># chkconfig  saslauthd on</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/sysconfig/saslauthd</code>.</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment"># vim /etc/sysconfig/saslauthd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory in which to place saslauthd&#x27;s listening socket, pid file, and so</span></span><br><span class="line"><span class="comment"># on.  This directory must already exist.</span></span><br><span class="line">SOCKETDIR=/var/run/saslauthd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mechanism to use when checking passwords.  Run &quot;saslauthd -v&quot; to get a list</span></span><br><span class="line"><span class="comment"># of which mechanism your installation was compiled with the ablity to use.</span></span><br><span class="line">MECH=shadow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Additional flags to pass to saslauthd on the command line.  See saslauthd(8)</span></span><br><span class="line"><span class="comment"># for the list of accepted flags.</span></span><br><span class="line">FLAGS=</span><br></pre></td></tr></table></figure>

<p>修改 <code>/usr/lib/sasl2/smtpd.conf</code>.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@ser ~]# vim <span class="regexp">/usr/</span>lib64<span class="regexp">/sasl2/</span>smtpd.conf</span><br><span class="line">pwcheck_method: saslauthd</span><br></pre></td></tr></table></figure>

<p>测试 saslauthd.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@ser</span> ~]<span class="meta"># service saslauthd  restart</span></span><br><span class="line">[root<span class="symbol">@ser</span> ~]<span class="meta"># testsaslautd  -u yjw -p <span class="string">&#x27;020304&#x27;</span></span></span><br><span class="line"><span class="number">0</span>: OK <span class="string">&quot;Success.&quot;</span></span><br></pre></td></tr></table></figure>

<p>在postfix 的配置文件中,添加以下内容,使其支持SMTP认证.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[root@ser ~]</span><span class="comment">#  vim /etc/postfix/main.cf</span></span><br><span class="line"><span class="attr">message_size_limit</span> = <span class="number">1073741824</span>   <span class="comment"># 邮件的大小为10M</span></span><br><span class="line"><span class="attr">default_process_limit</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">default_destination_concurrency_limit</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">smtpd_sasl_auth_enable</span> = <span class="literal">yes</span></span><br><span class="line"><span class="attr">smtpd_sasl_local_domain</span> =  <span class="variable">$myhostname</span></span><br><span class="line"></span><br><span class="line"><span class="attr">smtpd_sasl_application_name</span> = smtpd</span><br><span class="line"></span><br><span class="line"><span class="attr">broken_sasl_auth_clients</span> = <span class="literal">yes</span></span><br><span class="line"><span class="attr">smtpd_recipient_restrictions</span> = permit_mynetworks, permit_sasl_authenticated,reject_unauth_destination</span><br><span class="line"><span class="attr">smtpd_client_restrictions</span> = permit_sasl_authenticated</span><br><span class="line"><span class="attr">smtpd_sasl_security_options</span> = noanonymous</span><br></pre></td></tr></table></figure>

<p>测试 25端口.</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment">#  telnet mail.shuxun.wang 25</span></span><br><span class="line">Trying <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">2</span>...</span><br><span class="line">Connected to mail.<span class="keyword">shuxun.wang </span>(<span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">2</span>).</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line"><span class="number">220</span> mail.<span class="keyword">shuxun.wang </span>ESMTP Postfix</span><br><span class="line">EHLO  <span class="number">163</span>.com</span><br><span class="line"><span class="number">250</span>-mail.<span class="keyword">shuxun.wang</span></span><br><span class="line"><span class="keyword"></span><span class="number">250</span>-PIPELINING</span><br><span class="line"><span class="number">250</span>-SIZE <span class="number">10240000</span></span><br><span class="line"><span class="number">250</span>-VRFY</span><br><span class="line"><span class="number">250</span>-ETRN</span><br><span class="line"><span class="number">250</span>-AUTH LOGIN PLAIN</span><br><span class="line"><span class="number">250</span>-AUTH=LOGIN PLAIN</span><br><span class="line"><span class="number">250</span>-ENHANCEDSTATUSCODES</span><br><span class="line"><span class="number">250</span><span class="number">-8</span>BITMIME</span><br><span class="line"><span class="number">250</span> DSN</span><br><span class="line">quit</span><br><span class="line"><span class="number">221</span> <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span> <span class="keyword">Bye</span></span><br><span class="line"><span class="keyword"></span>Connection <span class="keyword">closed </span><span class="keyword">by </span>foreign host.</span><br></pre></td></tr></table></figure>

<p>现在可以测试一下给root发一封邮件.</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;this is a test mail !&quot;</span><span class="string">|mail -s mailname root</span></span><br></pre></td></tr></table></figure>

<p>输入mail查看是否成功.也可给给QQ邮箱发,将root修改成QQ邮箱地址就可以了.</p>
<p>四、安装openwebmail.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment"># vim /etc/yum.repos.d/openwebmail.repo</span></span><br><span class="line">[openwebmail]</span><br><span class="line"><span class="comment">## Thomas Chung</span></span><br><span class="line"><span class="comment">## 2008.05.29</span></span><br><span class="line">name=Openwebmail <span class="keyword">for</span> Fedora or Enterprise Linux</span><br><span class="line">baseurl=http:<span class="regexp">//</span>openwebmail.org<span class="regexp">/openwebmail/</span>download<span class="regexp">/redhat/</span>rpm<span class="regexp">/release/</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//</span>openwebmail.org<span class="regexp">/openwebmail/</span>download<span class="regexp">/redhat/</span>rpm<span class="regexp">/release/</span>RPM-GPG-KEY-openwebmail</span><br><span class="line"><span class="comment">#metadata_expire=0</span></span><br></pre></td></tr></table></figure>

<p>若这样安装不成功,先安装 perl-Text-Iconv-1.4-1.2.el4.rf.i386.rpm.</p>
<p>下载地址:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//rpm</span>.pbone.net/index.php3?<span class="keyword">stat</span>=<span class="number">26</span>&amp;dist=<span class="number">42</span>&amp;size=<span class="number">19383</span>&amp;name=perl-Text-Iconv-<span class="number">1.4</span>-<span class="number">1.2</span>.el4.rf.i386.rpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ser ~]<span class="comment">#  yum -y  install openwebmail</span></span><br><span class="line">[root@ser ~]<span class="comment"># cd /var/www/cgi-bin/openwebmail/</span></span><br><span class="line">[root@ser openwebmail]<span class="comment"># ./openwebmail-tool.pl  --init  #出现Y/N时 ,按N.</span></span><br></pre></td></tr></table></figure>

<p>修改openwebmail 的一些配置文件.</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">[root@<span class="keyword">ser</span> etc]<span class="meta"># vim dbm.conf</span></span><br><span class="line">dbm_ext                 <span class="meta">.db</span></span><br><span class="line">dbmopen_ext             <span class="meta">.db</span></span><br><span class="line">dbmopen_haslock         no</span><br><span class="line">[root@<span class="keyword">ser</span> etc]]<span class="meta"># cd defaults/</span></span><br><span class="line">[root@<span class="keyword">ser</span> defaults]<span class="meta">#  vim dbm.conf</span></span><br><span class="line">dbm_ext                 <span class="meta">.db</span></span><br><span class="line">dbmopen_ext             <span class="meta">.db</span></span><br><span class="line">dbmopen_haslock         yes</span><br><span class="line">smtpserver  <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">[root@<span class="keyword">ser</span> defaults]<span class="meta">#  vim openwebmail.conf</span></span><br><span class="line">domainnames             shuxun.wang</span><br><span class="line">smtpserver              <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">authpop3_server         <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>再次初始化openwebmail.</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">[root@ser defaults]<span class="meta"># cd  http:<span class="comment">//www.cnblogs.com/openwebmail-tool.pl  --init</span></span></span><br><span class="line">出现Y/N 时,按Y.</span><br></pre></td></tr></table></figure>

<p>把Postfix+Dovecot+Openwebmail 三者个格式统一下就行了.<br>1.postfix 配置 main.cf</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">mail_spool_directory = <span class="regexp">/var/</span>spool/mail</span><br></pre></td></tr></table></figure>

<p>2.Dovecot 配置 Dovecot.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mail_location = mbox:~<span class="regexp">/mail:INBOX=/</span>var<span class="regexp">/spool/m</span>ail/%u</span><br></pre></td></tr></table></figure>

<p>3.Openwebmail.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mailspooldir <span class="regexp">/var/</span>spool/mail</span><br></pre></td></tr></table></figure>

<p>修改apache配置</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">[root@ser ~]<span class="comment"># vim /etc/httpd/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">ServerAdmin</span><br><span class="line">root@<span class="keyword">shuxun.wang</span></span><br><span class="line"><span class="keyword"></span>ServerName  mail.<span class="keyword">shuxun.wang:80</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">AddHandler </span>cgi-<span class="keyword">script </span>.cgi .pl</span><br></pre></td></tr></table></figure>

<p>五、登陆openwebmail<br>在IE 中输入</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mail.shuxun.wang<span class="regexp">/cgi-bin/</span>openwebmail/openwebmail.pl</span><br></pre></td></tr></table></figure>

<p>这个地址是不是很长,那么我们来点短点的<br>在  httpd的 配置文件中添加 下面 内容:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ScriptAlias  <span class="regexp">/mail    /</span>var<span class="regexp">/www/</span>cgi-bin<span class="regexp">/openwebmail/</span>openwebmail.pl</span><br></pre></td></tr></table></figure>

<p>这样在IE 中直接输入</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">mail<span class="selector-class">.shuxun</span>.wang/mail</span><br></pre></td></tr></table></figure>

<p>如果出现了下面的问题</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Couldn&#x27;t create <span class="keyword">File</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/openwebmail.<span class="keyword">log</span>! (Permission denied)</span><br></pre></td></tr></table></figure>

<p>在网上找到解决办法了:如下方面 运行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">touch <span class="regexp">/var/</span>log/openwebmail.log</span><br><span class="line">chcon -u system_u <span class="regexp">/var/</span>log/openwebmail.log</span><br><span class="line">chcon -t httpd_sys_script_rw_t <span class="regexp">/var/</span>log/openwebmail.log</span><br><span class="line">chcon -t httpd_unconfined_script_exec_t <span class="regexp">/var/</span>www<span class="regexp">/cgi-bin/</span>openwebmail/openwebmail*</span><br></pre></td></tr></table></figure>

<p>然后刷新了一下 OK ,很漂亮的界面出现了.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos快速安装heartbeat</title>
    <url>/2019/03/22/1131/</url>
    <content><![CDATA[<p>最近研究集群,看了很多网上的教程,可是heartbeat这个软件始终安装不上,<br>后来发现源里是有这个软件的.<br>安装命令为:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> heartbeat*</span><br></pre></td></tr></table></figure>
<p>这样就完成了全部全部的heartbeat的安装了.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos升级jdk到1.8</title>
    <url>/2019/05/09/1133/</url>
    <content><![CDATA[<p>1.下载jdk1.8</p>
<p>链接地址:<code>http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</code><br>下载成功之后放到 <code>/usr/local/</code>目录下并且解压:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cp</span> jdk-<span class="number">8</span>u<span class="number">181</span>-linux-x<span class="number">64</span>.tar.gz /usr/local/</span><br><span class="line"><span class="attribute">cd</span> /usr/local/</span><br><span class="line"><span class="attribute">tar</span> -zxvf jdk-<span class="number">8</span>u<span class="number">181</span>-linux-x<span class="number">64</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>2.配置系统环境变量</p>
<p>在 <code>/etc/profile</code>文件末尾加入以下关于jdk1.8的配置:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#java</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/java/jdk1.8.0_181</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$JAVA_HOME</span>/bin:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib</span><br></pre></td></tr></table></figure>

<p>3.环境变量生效</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>4.测试</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure>

<p>输出版本信息为1.8.0_131为升级成功.</p>
]]></content>
  </entry>
  <entry>
    <title>centos使用Mldonkey实现离线下载</title>
    <url>/2017/05/12/1135/</url>
    <content><![CDATA[<p>首先更新一些环境:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> zlib</span><br><span class="line">yum <span class="keyword">install</span> zlib-devel</span><br><span class="line">yum <span class="keyword">install</span> m4</span><br></pre></td></tr></table></figure>

<p>然后下载:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>sourceforge.net<span class="regexp">/projects/m</span>ldonkey<span class="regexp">/files/m</span>ldonkey<span class="regexp">/3.1.2/m</span>ldonkey-<span class="number">3.1</span>.<span class="number">2</span>.tar.bz2/download</span><br><span class="line">mv mldonkey-<span class="number">3.1</span>.<span class="number">2</span>.tar.bz2 <span class="regexp">/usr/</span>src</span><br><span class="line">cd <span class="regexp">/usr/</span>src</span><br><span class="line">tar -xvf mldonkey-<span class="number">3.1</span>.<span class="number">2</span>.tar.bz2</span><br><span class="line">cd mldonkey-<span class="number">3.1</span>.<span class="number">2</span></span><br><span class="line">vim mldonkey-<span class="number">3.1</span>.<span class="number">2</span><span class="regexp">/src/u</span>tils<span class="regexp">/lib/</span>charsetstubs.c</span><br><span class="line"><span class="keyword">if</span> (!str)</span><br><span class="line">raise_error ();</span><br><span class="line">return (copy_string ((char*)?str));&#125;</span><br><span class="line"><span class="comment">#在其中加入</span></span><br><span class="line">str=<span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">(大概在<span class="number">1379</span>行上下),加入后如下显示:</span><br><span class="line"><span class="keyword">if</span> (!str)</span><br><span class="line">raise_error ();</span><br><span class="line">str=<span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">return (copy_string ((char*) str));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开始编译:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--enable-donkey</span> <span class="params">--enable-filetp</span> <span class="params">--enable-bittorrent</span> <span class="params">--enable-batch</span> <span class="params">--enable-gd</span> <span class="params">--enable-upnp-natpmp</span> <span class="params">--enable-force-upnp-natpmp</span></span><br><span class="line">make</span><br><span class="line">cp mlnet <span class="string">/usr/bin</span> <span class="string">/usr/bin/mlnet</span></span><br></pre></td></tr></table></figure>

<p>结束进程</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/root/</span>.mldonkey</span><br><span class="line">vi downloads.ini</span><br><span class="line"><span class="comment">#修改 allowed_ips 后面增加 0.0.0.0/0,表示允许所有IP登陆管理http页</span></span><br><span class="line">allowed_ips = [</span><br><span class="line"><span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="string">&quot;0.0.0.0/0&quot;</span>;]</span><br></pre></td></tr></table></figure>

<p>修改服务器防火墙IP规则,或者关闭防火墙,在浏览器中输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//m</span>ldonkey所在服务器IP:<span class="number">4080</span></span><br></pre></td></tr></table></figure>

<p>mldonkey的使用:<br>在上端输入框中直接输入文件下载地址,点击input,即可实现下载,如果是种子文件,则直接输入?”dllink 种子文件路径”,点击input开始下载.<br>下载目录:<br>默认在</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.mldonkey<span class="regexp">/incoming/</span>files [单个文件下载目录]</span><br><span class="line">.mldonkey<span class="regexp">/incoming/</span>directories [文件夹下载目录]</span><br></pre></td></tr></table></figure>

<p>找到shared_directories,并修改下载路径:</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="attr">shared_directories</span> = [</span><br><span class="line">&#123; <span class="attr">dirname</span> = shared</span><br><span class="line"><span class="attr">strategy</span> = all_files</span><br><span class="line"><span class="attr">priority</span> = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line">&#123; <span class="attr">dirname</span> = <span class="string">&quot;/home/emule&quot;</span></span><br><span class="line"><span class="attr">strategy</span> = incoming_files</span><br><span class="line"><span class="attr">priority</span> = <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line">&#123; <span class="attr">dirname</span> = <span class="string">&quot;/home/emule&quot;</span></span><br><span class="line"><span class="attr">strategy</span> = incoming_directories</span><br><span class="line"><span class="attr">priority</span> = <span class="number">0</span></span><br><span class="line">&#125;;]</span><br></pre></td></tr></table></figure>

<p>建立下载目录:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">mkdir /home/emule</span><br></pre></td></tr></table></figure>

<p>执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mldonkey/m</span>lnet</span><br></pre></td></tr></table></figure>

<p>访问MLDonkey自带的webgui界面 <a href="http://ip:4080/">http://IP:4080</a><br>访问时提示:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SECURITY</span> <span class="built_in">WARNING</span>: <span class="keyword">user</span> <span class="keyword">admin</span> has an empty <span class="keyword">password</span>, use command: useradd <span class="keyword">admin</span> <span class="keyword">password</span></span><br></pre></td></tr></table></figure>

<p>意思是MLDonkey有个默认用户admin密码为空需要设置一个秘密.(PS:删除了这个admin用户MLDonkey会启动不了)<br>为admin设置一个复杂的密码,在Webgui页面的命令栏输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">useradd admin xxxxxx <span class="regexp">//</span>xxxxxx为admin的密码</span><br></pre></td></tr></table></figure>

<p>点击后面的input按钮.<br>使用admin用户登陆,可以再添加一个自己的用户,比如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">useradd</span> mlnetadmin <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>添加一个mlnetadmin用户,密码是123456.<br>清除浏览器记录,刷新页面,输入这个用户名密码登陆.使mlnet后台运行可以在vps里开个screen放到后台.<br>搜索资源方法:选择search,在keywords框里输入关键字,点击search按钮,点击search results查看结果.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos是用中文man</title>
    <url>/2017/11/03/1136/</url>
    <content><![CDATA[<p>1.首先下载中文man压缩包</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//m</span>anpages-zh.googlecode.com<span class="regexp">/files/m</span>anpages-zh-<span class="number">1.5</span>.<span class="number">1</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>2.解压缩并安装,指令如下:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">tar zxvf manpages-zh-<span class="number">1.5</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="keyword">cd</span> manpages-zh-<span class="number">1.5</span>.<span class="number">1</span></span><br><span class="line">./configure</span><br><span class="line"><span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>

<p>3.测试中文是否正常</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">man</span> <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p>如果看到中文,可以不用进行以下步骤了!如果中文乱马,请见查当前环境 LC<em>设置是否正确,检查在当前终端窗口的编码是否与LC</em>相符如果不相符,请同意改成zh_CN.UTF-8,如果相符,按照如下步骤修改.</p>
<p>修改 <code>/etc/man.config</code>文件:</p>
<p>替换:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">NROFF <span class="regexp">/usr/</span>bin<span class="regexp">/nroff -c --legacy NROFF_OLD_CHARSET -mandoc 2&gt;/</span>dev/<span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<p>修改为:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">NROFF <span class="regexp">/usr/</span>bin/groff -Tutf8i -mandoc</span><br></pre></td></tr></table></figure>

<p>然后man ls ,哈哈这回中文了吧!很爽,对于想学习linux的新手非常合适.</p>
]]></content>
  </entry>
  <entry>
    <title>centos实时查看网卡流量</title>
    <url>/2019/02/20/1134/</url>
    <content><![CDATA[<p>iftop 主要用来显示本机网络流量情况及各相互通信的流量集合,如单独同那台机器间的流量大小,非常适合于代理服务器和iptables服务器使用.</p>
<p>1、安装依赖</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libpcap-devel ncurses-devel</span><br></pre></td></tr></table></figure>

<p>2、开始安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.ex-parrot.com<span class="regexp">/pdw/i</span>ftop<span class="regexp">/download/i</span>ftop-<span class="number">0.17</span>.tar.gz</span><br><span class="line">tar xzf iftop-<span class="number">0.17</span>.tar.gz</span><br><span class="line">cd iftop-<span class="number">0.17</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>如何使用:</p>
<p>直接执行iftop即可运行查看流量情况.<br>执行iftop -h得到帮助信息:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">[root@www ~]#iftop -<span class="keyword">h</span></span><br><span class="line">iftop: <span class="keyword">display</span> bandwidth usage <span class="keyword">on</span> <span class="keyword">an</span> interface <span class="keyword">by</span> host</span><br><span class="line">Synopsis: iftop -<span class="keyword">h</span> | [-npbBP] [-i interface] [-f filter coolcode] [-<span class="keyword">N</span> <span class="keyword">net</span>/mask]</span><br><span class="line">    -<span class="keyword">h</span>                  <span class="keyword">display</span> this message</span><br><span class="line">    -<span class="keyword">n</span>                  don&#x27;t <span class="keyword">do</span> hostname lookups</span><br><span class="line">    -<span class="keyword">N</span>                  don&#x27;t convert port numbers to services</span><br><span class="line">    -p                  <span class="keyword">run</span> <span class="keyword">in</span> promiscuous mode (show traffic between other</span><br><span class="line">                        hosts <span class="keyword">on</span> the same network segment)</span><br><span class="line">    -b                  don&#x27;t <span class="keyword">display</span> a bar <span class="keyword">graph</span> of traffic</span><br><span class="line">    -B                  <span class="keyword">Display</span> bandwidth <span class="keyword">in</span> bytes</span><br><span class="line">    -i interface        listen <span class="keyword">on</span> named interface</span><br><span class="line">    -f filter coolcode      <span class="keyword">use</span> filter coolcode to select packets to <span class="keyword">count</span></span><br><span class="line">                        (default: none, but only IP packets are counted)</span><br><span class="line">    -F <span class="keyword">net</span>/mask         show traffic flows <span class="keyword">in</span>/<span class="keyword">out</span> of network</span><br><span class="line">    -P                  show ports <span class="keyword">as</span> well <span class="keyword">as</span> hosts</span><br><span class="line">    -<span class="keyword">m</span> limit            sets the upper limit <span class="keyword">for</span> the bandwidth scale</span><br><span class="line">    -c config <span class="keyword">file</span>      specifies <span class="keyword">an</span> alternative configuration <span class="keyword">file</span></span><br></pre></td></tr></table></figure>

<p>监控某网卡:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iftop</span> -i eth<span class="number">0</span> -n</span><br></pre></td></tr></table></figure>

<p>同时显示是什么服务:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iftop -<span class="selector-tag">i</span> eth0 -n -<span class="selector-tag">P</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos手动编译lighttpd</title>
    <url>/2015/08/21/1137/</url>
    <content><![CDATA[<p>安装必要的软件:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install </span>glib2-devel openssl-devel pcre-devel <span class="keyword">bzip2-devel </span>gzip-devel</span><br><span class="line">yum -y <span class="keyword">install </span>gamin</span><br><span class="line">yum -y <span class="keyword">install </span>gamin-devel</span><br><span class="line">yum -y <span class="keyword">install </span>gcc gcc-c++</span><br></pre></td></tr></table></figure>

<p>安装Lighttpd:</p>
<p>到<a href="http://www.lighttpd.net/%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%89%88,%E7%8E%B0%E5%9C%A8%E6%9C%80%E6%96%B0%E7%89%88%E6%98%AF1.4.28">http://www.lighttpd.net/下载最新版,现在最新版是1.4.28</a>.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local/src</span><br><span class="line">wget http:<span class="regexp">//</span>download.lighttpd.net<span class="regexp">/lighttpd/</span>releases-<span class="number">1.4</span>.x/lighttpd-<span class="number">1.4</span>.<span class="number">28</span>.tar.gz</span><br><span class="line">tar -zxvf lighttpd-<span class="number">1.4</span>.<span class="number">28</span>.tar.gz</span><br><span class="line">cd lighttpd-<span class="number">1.4</span>.<span class="number">28</span></span><br><span class="line">make clean &amp;&amp; make distclean</span><br><span class="line">./configure --with-fam</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>配置Lighttpd:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/FOO/lighttpd/g&#x27;</span> doc<span class="regexp">/rc.lighttpd.redhat &gt; /</span>etc<span class="regexp">/init.d/</span>lighttpd</span><br><span class="line">chmod <span class="number">755</span> <span class="regexp">/etc/i</span>nit.d/lighttpd</span><br><span class="line">echo <span class="string">&quot;LIGHTTPD_CONF_PATH=/etc/lighttpd/lighttpd.conf&quot;</span> &gt; <span class="regexp">/etc/</span>sysconfig/lighttpd</span><br><span class="line">install -Dp .<span class="regexp">/doc/</span>lighttpd.conf <span class="regexp">/etc/</span>lighttpd/lighttpd.conf</span><br><span class="line">chkconfig lighttpd on</span><br></pre></td></tr></table></figure>

<p>创建符号链接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>lighttpd <span class="regexp">/usr/</span>sbin/lighttpd</span><br></pre></td></tr></table></figure>

<p>为Lighttpd建立用户和用户组:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">groupadd lighttpd</span><br><span class="line">adduser -m -g lighttpd -d <span class="regexp">/var/</span>www -s <span class="regexp">/sbin/</span>nologin lighttpd</span><br></pre></td></tr></table></figure>

<p>为Lighttpd建立文件夹和设置所有权:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">var</span>/<span class="built_in">log</span>/lighttpd</span><br><span class="line">chown lighttpd:lighttpd /<span class="built_in">var</span>/<span class="built_in">log</span>/lighttpd</span><br></pre></td></tr></table></figure>

<p>修改配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>lighttpd/lighttpd.conf</span><br></pre></td></tr></table></figure>

<p>启动Lighttpd:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service lighttpd <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>设置根目录文件夹:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.document-root</span>        = <span class="string">&quot;/srv/www/htdocs/&quot;</span></span><br></pre></td></tr></table></figure>

<p>设置用户名和组:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">perl -<span class="selector-tag">i</span> -<span class="selector-tag">p</span> -e <span class="string">&#x27;s/#server.username            = &quot;wwwrun&quot;/server.username            = &quot;lighttpd&quot;/g;&#x27;</span> /etc/lighttpd/lighttpd<span class="selector-class">.conf</span></span><br><span class="line">perl -<span class="selector-tag">i</span> -<span class="selector-tag">p</span> -e <span class="string">&#x27;s/#server.groupname           = &quot;wwwrun&quot;/server.groupname           = &quot;lighttpd&quot;/g;&#x27;</span> /etc/lighttpd/lighttpd.conf</span><br></pre></td></tr></table></figure>

<p>设置pid文件:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.pid-file</span>            = <span class="string">&quot;/var/run/lighttpd.pid&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos网络配置</title>
    <url>/2013/02/14/1139/</url>
    <content><![CDATA[<p>2019年8月19日更新:<br>其实只需要留下一下内容,网卡就可以正常工作了.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">1.25</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br></pre></td></tr></table></figure>

<p>历史内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">BROADCAST</span>=<span class="number">192.168</span>.<span class="number">1.255</span></span><br><span class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">12</span>:<span class="number">34</span>:<span class="number">56</span>:<span class="number">78</span>:<span class="number">4</span>C</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">1.25</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">1.254</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos-通过rsync实现文件同步</title>
    <url>/2017/10/05/1138/</url>
    <content><![CDATA[<p>一、服务器端配置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum -y install xinetd rsync</span><br><span class="line">vi <span class="regexp">/etc/</span>xinetd.d/rsync</span><br></pre></td></tr></table></figure>

<p>将如下代码:</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">service rsync</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">disable</span> = yes</span><br><span class="line">    <span class="attr">socket_type</span> = stream</span><br><span class="line">    <span class="attr">wait</span> = no</span><br><span class="line">    <span class="attr">user</span> = root</span><br><span class="line">    <span class="attr">server</span> = /usr/bin/rsync</span><br><span class="line">    <span class="attr">server_args</span> = –daemon</span><br><span class="line">    log_on_failure += USERID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中的 <code>disable = yes</code> 改成 <code>disable = no</code>.<br>然后启动 xinetd:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/xinetd start</span><br></pre></td></tr></table></figure>

<p>注意:如果服务器上装有防火墙记得要打开端口,默认端口是873.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">telnet</span> <span class="number">127.0.0.1</span> <span class="number">873</span></span><br><span class="line"><span class="attribute">Trying</span> <span class="number">127.0.0.1</span>...</span><br><span class="line"><span class="attribute">telnet</span>: connect to address <span class="number">127.0.0.1</span>: Connection refused</span><br></pre></td></tr></table></figure>

<p>设置防火墙规则:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -s <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span> -<span class="selector-tag">p</span> tcp -m tcp --dport <span class="number">873</span> -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp -m tcp --dport <span class="number">873</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>编辑配置文件:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rsyncd.conf (这个文件如果不存在自己创建)</span><br><span class="line"></span><br><span class="line">#Global Settings</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use chroot = no</span><br><span class="line">max connections = <span class="number">20</span></span><br><span class="line">log <span class="keyword">file</span> = <span class="regexp">/var/</span>log/rsyncd.log</span><br><span class="line">pid <span class="keyword">file</span> = <span class="regexp">/var/</span>run/rsyncd.pid</span><br><span class="line">lock <span class="keyword">file</span> = <span class="regexp">/var/</span>run/rsync.lock</span><br><span class="line">comment = hello world</span><br><span class="line">#motd <span class="keyword">file</span> = <span class="regexp">/etc/</span>rsyncd.motd</span><br><span class="line">[backup]</span><br><span class="line">path = <span class="regexp">/titan24/</span>www/repos</span><br><span class="line">auth users = rsync</span><br><span class="line">secrets <span class="keyword">file</span> = <span class="regexp">/etc/</span>rsyncd.secrets</span><br><span class="line"><span class="keyword">read</span> only = no</span><br><span class="line">hosts allow = <span class="number">192.168</span>.<span class="number">3.128</span></span><br><span class="line">hosts deny = *</span><br><span class="line">list = <span class="keyword">true</span></span><br><span class="line">#ignore errors</span><br><span class="line">#<span class="keyword">exclude</span> = cache<span class="regexp">/111/</span> cache<span class="regexp">/222/</span></span><br></pre></td></tr></table></figure>

<p>修改:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rsyncd.secrets</span><br><span class="line"></span><br><span class="line">rsync:<span class="number">111111</span></span><br></pre></td></tr></table></figure>

<p>给文件正确的权限</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown root:root <span class="regexp">/etc/</span>rsyncd.secrets</span><br><span class="line">chmod <span class="number">600</span> <span class="regexp">/etc/</span>rsyncd.secrets</span><br></pre></td></tr></table></figure>

<p>二、client 端进行同步</p>
<p>客户端默认好像已经装了rsync,没有的话装下:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> rsync</span><br></pre></td></tr></table></figure>

<p>执行异步同步操作:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/rsync -avz --progress rsync@192.168.3.191::backup /</span>www</span><br><span class="line">crontab -e <span class="comment">#(可以定时每三分钟同步一次文件)</span></span><br><span class="line">*<span class="regexp">/3 * * * * rsync -avz --progress rsync@192.168.3.191::backup /</span>www</span><br></pre></td></tr></table></figure>

<p>下面这个命令完整一点:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rsyncd.pas</span><br></pre></td></tr></table></figure>

<p>加入密码:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rsyncofpass</span></span><br></pre></td></tr></table></figure>

<p>注意,客户端的密码文件只需要密码,而不需要用户名!</p>
<p>更改文件权限:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">0600</span> <span class="regexp">/etc/</span>rsyncd.pas</span><br><span class="line">rsync -vzrtopgu --progress --<span class="keyword">delete</span> --password-<span class="keyword">file</span>=<span class="regexp">/etc/</span>rsyncd.pas rsync_user@<span class="number">192.168</span>.<span class="number">0.2</span>::rsync_module_name1 <span class="regexp">/www/</span></span><br></pre></td></tr></table></figure>

<p>这个命令行中-vzrtopg里的v是verbose.</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">z是压缩传输,</span><br><span class="line">r是recursive,</span><br><span class="line">topg都是保持文件原有属性如属主、时间的参数.</span><br><span class="line">u是只同步已经更新的文件,避免没有更新的文件被重复更新一次,不过要注意两者机器的时钟的同步.</span><br><span class="line">–progress是指显示出详细的进度情况,</span><br><span class="line">–delete是指如果服务器端删除了这一文件,那么客户端也相应把文件删除,保持真正的一致.</span><br></pre></td></tr></table></figure>

<p>后面的<a href="mailto:&#x72;&#x73;&#121;&#x6e;&#99;&#x5f;&#117;&#115;&#101;&#114;&#x40;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#x2e;&#48;&#46;&#50;">&#x72;&#x73;&#121;&#x6e;&#99;&#x5f;&#117;&#115;&#101;&#114;&#x40;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#x2e;&#48;&#46;&#50;</a>::rsync_module_name1中,之后的rsync_module_name1是模块名, 也就是在 <code>/etc/rsyncd.conf</code>中自定义的名称,rsync_user是指定模块中指定的可以同步的用户名.<br>最后的/www是备份到本地的目录名.<br>在这里面,还可以用-e ssh的参数建立起加密的连接.<br>可以用–password-file=/password/path/file来指定密码文件,这样就可以在脚本中使用而无需交互式地输入验证密码了,这里需要注意的是这份密码文件权限属性要设得只有属主可读.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/rsync/</span>bin<span class="regexp">/rsync -vzrtopg –progress –delete rsync_user@192.168.0.2::rsync_module_name1 /</span>tmp/</span><br></pre></td></tr></table></figure>

<p>或者你也可以制定password文件.<br>由于需要系统crontab执行,所以这里采用读入密码文件的方式,这个时候就成功了.</p>
]]></content>
  </entry>
  <entry>
    <title>Centos系统yum安装Memcache</title>
    <url>/2011/04/08/1140/</url>
    <content><![CDATA[<p>标准的Centos的软件库里没有Memcache相应的包,所以,要导入第三方软件库,这里推荐的是Dag Wieers库,(现在叫RPMForge了),安装方法如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://dag.wieers.com/rpm/packages/rpmforge-release/rpmforge-release-<span class="number">0</span>.<span class="number">3</span>.<span class="number">6</span>-<span class="number">1</span>.el<span class="number">5</span>.rf.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh rpmforge-release-<span class="number">0</span>.<span class="number">3</span>.<span class="number">6</span>-<span class="number">1</span>.el<span class="number">5</span>.rf.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>

<p>查看相关软件包:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum search memcached</span></span><br></pre></td></tr></table></figure>

<p>有了,可以进行安装了:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> memcached</span><br></pre></td></tr></table></figure>

<p>memcache关联php:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> php-pecl-memcache</span><br></pre></td></tr></table></figure>

<p>验证安装结果:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">memcached -h</span><br><span class="line">php -m <span class="string">| grep memcache</span></span><br></pre></td></tr></table></figure>

<p>memcache的基本设置:<br>启动memcache的服务端:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">memcached</span> -d -m <span class="number">100</span> -u root -l <span class="number">222</span>.<span class="number">186</span>.xx.xxx -p <span class="number">11211</span> -c <span class="number">512</span> -P /tmp/memcached.pid</span><br></pre></td></tr></table></figure>

<p>参数说明:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-d选项是启动一个守护进程;</span></span><br><span class="line"><span class="deletion">-m是分配给Memcache使用的内存数量,单位是MB,我这里是100MB;</span></span><br><span class="line"><span class="deletion">-u是运行Memcache的用户,我这里是root;</span></span><br><span class="line"><span class="deletion">-l是监听的服务器IP地址我这里指定了服务器的IP地址222.186.xx.xxx;</span></span><br><span class="line"><span class="deletion">-p是设置Memcache监听的端口,我这里设置了11211,最好是1024以上的端口;</span></span><br><span class="line"><span class="deletion">-c选项是最大运行的并发连接数,默认是1024,我这里设置了512,按照你服务器的负载量来设定;</span></span><br><span class="line"><span class="deletion">-P是设置保存Memcache的pid文件,我这里是保存在 /tmp/memcached.pid;</span></span><br></pre></td></tr></table></figure>

<p>检查memcached是否启动:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">netstat</span> -an | more</span><br><span class="line"><span class="attribute">tcp</span>        <span class="number">0</span>      <span class="number">0</span> <span class="number">222</span>.<span class="number">186</span>.xx.xxx:<span class="number">11211</span>       <span class="number">0.0.0.0</span>:*                   LIST</span><br></pre></td></tr></table></figure>

<p>设置开机启动:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> memcached <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>启动和停止:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service memcached <span class="literal">start</span> | <span class="literal">stop</span></span><br><span class="line"><span class="keyword">or</span> /etc/init.d/memcached <span class="literal">start</span> | <span class="literal">stop</span></span><br></pre></td></tr></table></figure>

<p>重启centos:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shutdown </span>-r now</span><br><span class="line"><span class="keyword">or </span>reboot</span><br></pre></td></tr></table></figure>

<p>memcached环境测试:<br>运行以下的php文件,如果有输出this is a test!,就表示环境搭建成功,开始你的memcache之旅吧!</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$mem</span> = <span class="keyword">new</span> Memcache;</span><br><span class="line"><span class="variable">$mem</span>-&gt;connect(<span class="string">&quot;222.186.xx.xxx&quot;</span>, <span class="number">11211</span>);</span><br><span class="line"><span class="variable">$mem</span>-&gt;set(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;This is a test!&#x27;</span>, <span class="number">0</span>, <span class="number">60</span>);</span><br><span class="line"><span class="variable">$val</span> = <span class="variable">$mem</span>-&gt;get(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$val</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS下shell脚本实现windows的回收站功能</title>
    <url>/2016/05/14/1143/</url>
    <content><![CDATA[<p>1、在用户执行rm命令时,将文件移动/dump-file/ ,被移动到dump-file 目录下的文件、文件夹以原文件名+删除除的日期格式存放,如 rm.sh 在删除后就会被自动移动到/dump-file/ 下并命名为rm.sh_2011-05-17_11:18:21.bak .</p>
<p>2、此命令在执行时会检测文件或目录的大小,如果文件或目录超过2GB,将不会再将文件移动到回收站,而会直接删除,此功能是为了避免回收站过大而对系统造成影响.</p>
<p>安装方法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp -rp <span class="regexp">/bin/</span>rm <span class="regexp">/bin/</span>rm.bak</span><br><span class="line"><span class="regexp">//</span>将系统原有rm 命令改成rm.bak,记住 一定要改成rm.bak,因为回收站脚本需要调用 rm.bak这个命令.</span><br><span class="line">cp -rp rm.sh <span class="regexp">/bin/</span>rm</span><br><span class="line"><span class="regexp">//</span>将你的脚本文件rm.sh 覆盖成<span class="regexp">/bin/</span>rm文件</span><br><span class="line">chmod +x <span class="regexp">/bin/</span>rm</span><br><span class="line"><span class="regexp">//</span>赋予<span class="regexp">/bin/</span>rm可执行权限</span><br><span class="line">echo <span class="string">&quot;0 8  * * 6   /bin/sh  /fmnp/soft/clean-dump.sh &quot;</span> &gt;&gt;<span class="regexp">/var/</span>spool<span class="regexp">/cron/</span>tabs/root</span><br><span class="line"><span class="regexp">//</span>为了防止 /dump-file目录过大,采取每周进行一次删除操作,脚本如下:</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="regexp">/bin/</span>rm.bak -rf <span class="regexp">/dump-file/</span>*</span><br><span class="line"><span class="regexp">/bin/</span>rm.bak -rf <span class="regexp">/tmp/</span>*.rm-dump</span><br></pre></td></tr></table></figure>

<p>保存退出.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/dump-file &amp;&amp; chmod -R 777 /</span><span class="keyword">dump</span>-<span class="keyword">file</span></span><br><span class="line"><span class="comment">//创建/dump-file 目录并给予所有用户可写的权限.</span></span><br></pre></td></tr></table></figure>

<p>脚本如下:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">DumpFile=/dump-file/</span><br><span class="line">File=`<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">aa=$(<span class="built_in">echo</span> <span class="variable">$1</span>|grep <span class="string">&quot;^-&quot;</span>)</span><br><span class="line">DumpLog=<span class="string">&quot;`whoami`-`date +%m-%d-%H-%M`.rm-dump&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">TestDir</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    Test_Dir=$(<span class="built_in">echo</span> <span class="variable">$line</span>|grep <span class="string">&quot;/&quot;</span>) <span class="comment">#test if is a directory.</span></span><br><span class="line">    Test_Dir2=$(<span class="built_in">echo</span> <span class="variable">$line</span> |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|grep <span class="string">&quot;^/&quot;</span>) <span class="comment"># Test if the prameter starts with &quot;/&quot;.</span></span><br><span class="line">    Test_Dir3=$(<span class="built_in">echo</span> <span class="variable">$line</span> |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|grep <span class="string">&quot;^/tmp&quot;</span>) <span class="comment">#</span></span><br><span class="line">    Dir2=$(<span class="built_in">echo</span> <span class="variable">$line</span> |awk -F/ <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>) <span class="comment">#Extract the prameter after the first &quot;/&quot;.</span></span><br><span class="line">    Dir=$(<span class="built_in">echo</span> <span class="variable">$line</span> |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|awk -F/ <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>) <span class="comment">##Extract the prameter before the first &quot;/&quot;.</span></span><br><span class="line">    D1=`date +%F_%H:%M:%S.bak`</span><br><span class="line">    Date=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2 &quot;_&quot; D1&#125;&#x27;</span> D1=<span class="variable">$D1</span>`</span><br><span class="line">    DumpLog=<span class="string">&quot;`whoami`-`date +%m-%d-%H-%M`.rm-dump&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$Test_Dir</span> != <span class="string">&quot;&quot;</span> ]] ;<span class="keyword">then</span> <span class="comment">#If parameters include directory</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$Test_Dir2</span> != <span class="string">&quot;&quot;</span> ]] ;<span class="keyword">then</span> <span class="comment">#If parameter starts with &quot;/&quot;,as formate /a/b/c/</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$Test_Dir3</span> != <span class="string">&quot;&quot;</span> ]];<span class="keyword">then</span> <span class="comment"># this test is for to repaire less command&#x27;s error.</span></span><br><span class="line">                rm.bak -rf `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">#echo $line &quot;start with /&quot;</span></span><br><span class="line">                mkdir $DumpFile<span class="variable">$Dir2</span><span class="string">&quot;_&quot;</span><span class="variable">$D1</span> 2&gt;/tmp/<span class="variable">$DumpLog</span> <span class="comment"># Create directory as format /dump-file/(first directory after &quot;/&quot;)</span></span><br><span class="line"></span><br><span class="line">                mv `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>` $DumpFile<span class="variable">$Dir2</span><span class="string">&quot;_&quot;</span><span class="variable">$D1</span></span><br><span class="line">                <span class="built_in">echo</span> $DumpFile<span class="variable">$Dir2</span><span class="string">&quot;_&quot;</span><span class="variable">$D1</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span> <span class="comment">#Means that parameter starts without &quot;/&quot; ,as format a/b/c</span></span><br><span class="line">            mkdir $DumpFile$Dir<span class="variable">$D1</span> <span class="comment">#Create directory as format /dump-file/(first directory before &quot;/&quot;)</span></span><br><span class="line">            mv `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>` $DumpFile$Dir<span class="variable">$D1</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$line</span> <span class="string">&quot;starts before /&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Date=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2 &quot;_&quot; D1&#125;&#x27;</span> D1=<span class="variable">$D1</span>`</span><br><span class="line">        mv `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>` $DumpFile<span class="variable">$Date</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]] ;<span class="keyword">then</span> <span class="comment">#If the frist parameter is not empty.</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$aa</span> != <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]];<span class="keyword">then</span> <span class="comment">#If the first parameter not start with &quot;-&quot;.</span></span><br><span class="line">        du -s <span class="string">&quot;<span class="variable">$@</span>&quot;</span> 2&gt;/tmp/<span class="variable">$DumpLog</span> |<span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            size=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;$1 &gt;2000000&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$size</span>&quot;</span> &gt; <span class="string">&quot;1900000&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                <span class="comment">#echo &quot;Lager than 2Mb&quot;</span></span><br><span class="line">                rm.bak -rf `<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                TestDir</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> != <span class="string">&quot;&quot;</span>  ]]; <span class="keyword">then</span></span><br><span class="line">            until [ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> == <span class="string">&quot;&quot;</span>  ]</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">                 <span class="comment">#echo &quot;function is running&quot;</span></span><br><span class="line">                 du -s <span class="variable">$2</span> 2&gt; /tmp/<span class="variable">$DumpLog</span> |<span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line">                 <span class="keyword">do</span></span><br><span class="line">                    size=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;$1 &gt;2000000&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">                    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$size</span>&quot;</span> &gt; <span class="string">&quot;1900000&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">                        <span class="comment">#echo &quot;Lager than 2Mb&quot;</span></span><br><span class="line">                        rm.bak -rf <span class="variable">$2</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        TestDir</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">                    <span class="built_in">shift</span></span><br><span class="line">                 <span class="keyword">done</span></span><br><span class="line">                 <span class="built_in">shift</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;No file detected./nTry &#x27;rm --help&#x27; for more information. &quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;rm: missing operand /nTry &#x27;rm --help&#x27; for more information.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos下drbd的编译安装与配置</title>
    <url>/2013/07/14/1141/</url>
    <content><![CDATA[<p>首先说明一点,如果你使用的是centos的操作系统的话,必须使用5.几的系统,如果是6.几的会失败的很彻底,直接无法开机.</p>
<p>DRBD介绍</p>
<p>DRBD是一个用软件实现的、无共享的、服务器之间镜像块设备内容的存储复制解决方案. DRBD Logo数据镜像:实时、透明、同步(所有服务器都成功后返回)、异步(本地服务器成功后返回).DBRD的核心功能通过Linux的内核实现,最接近系统的IO栈,但它不能神奇地添加上层的功能比如检测到EXT3文件系统的崩溃.DBRD的位置处于文件系统以下,比文件系统更加靠近操作系统内核及IO栈.</p>
<p>DRBD编译安装</p>
<p>安装所需依赖:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> gcc kernel-devel kernel-headers flex</span><br></pre></td></tr></table></figure>

<p>开始安装drbd,下载地址:<a href="http://oss.linbit.com/drbd/">http://oss.linbit.com/drbd/</a><br>安装用户空间工具:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget http:<span class="regexp">//</span>oss.linbit.com<span class="regexp">/drbd/</span><span class="number">8.4</span>/drbd-<span class="number">8.4</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar xzf drbd-<span class="number">8.4</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">cd drbd-<span class="number">8.4</span>.<span class="number">1</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>drbd --with-km</span><br><span class="line">make KDIR=<span class="regexp">/usr/</span>src<span class="regexp">/kernels/</span><span class="number">2.6</span>.<span class="number">18</span>-<span class="number">274.18</span>.<span class="number">1</span>.el5-i686/</span><br><span class="line">make install</span><br><span class="line">mkdir -p <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>var<span class="regexp">/run/</span>drbd</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc<span class="regexp">/rc.d/i</span>nit.d<span class="regexp">/drbd /</span>etc<span class="regexp">/rc.d/i</span>nit.d</span><br><span class="line">chkconfig --add drbd</span><br><span class="line">chkconfig drbd on</span><br></pre></td></tr></table></figure>

<p>安装drbd模块:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd drbd</span><br><span class="line">make clean</span><br><span class="line">make KDIR=<span class="regexp">/usr/</span>src<span class="regexp">/kernels/</span><span class="number">2.6</span>.<span class="number">18</span>-<span class="number">274.18</span>.<span class="number">1</span>.el5-i686/</span><br><span class="line">cp drbd.ko <span class="regexp">/lib/m</span>odules<span class="regexp">/`uname -r`/</span>kernel<span class="regexp">/lib/</span></span><br><span class="line">depmod</span><br></pre></td></tr></table></figure>

<p>注:usr/src/kernels/2.6.18-274.18.1.el5-i686/这个内核源码树路径需要根据自己的系统修改.</p>
<p>DRBD配置</p>
<p>建立分区</p>
<p>假如现在有第二块硬盘hdb,两个node都要分区.</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">#fdisk /dev/hdb <span class="comment">//准备为 hdb 建立分区</span></span><br><span class="line">The number <span class="keyword">of</span> cylinders <span class="keyword">for</span> this disk <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">20805</span>.</span><br><span class="line">There <span class="keyword">is</span> nothing wrong <span class="keyword">with</span> that, but this <span class="keyword">is</span> larger than <span class="number">1024</span>,</span><br><span class="line"><span class="keyword">and</span> could <span class="keyword">in</span> certain setups cause problems <span class="keyword">with</span>:</span><br><span class="line"><span class="number">1</span>) software that runs at boot time (e.g., <span class="keyword">old</span> versions <span class="keyword">of</span> LILO)</span><br><span class="line"><span class="number">2</span>) booting <span class="keyword">and</span> partitioning software <span class="keyword">from</span> other OSs</span><br><span class="line">(e.g., DOS FDISK, OS/<span class="number">2</span> FDISK)</span><br><span class="line">Command (m <span class="keyword">for</span> help): n <span class="comment">//键入 n 表示要建立分区</span></span><br><span class="line">Command action</span><br><span class="line">e extended</span><br><span class="line">p primary partition (<span class="number">1</span>-<span class="number">4</span>)</span><br><span class="line">p <span class="comment">//键入 p 表示建立主要分区</span></span><br><span class="line">Partition number (<span class="number">1</span>-<span class="number">4</span>): <span class="number">1</span> <span class="comment">//键入 1 为此主要分区代号</span></span><br><span class="line">First cylinder (<span class="number">1</span>-<span class="number">20805</span>, <span class="keyword">default</span> <span class="number">1</span>): <span class="comment">//开始磁柱值,按下 enter 即可</span></span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> value <span class="number">1</span></span><br><span class="line">Last cylinder <span class="keyword">or</span> +size <span class="keyword">or</span> +sizeM <span class="keyword">or</span> +sizeK (<span class="number">1</span>-<span class="number">20805</span>, <span class="keyword">default</span> <span class="number">20805</span>): <span class="comment">//结束磁柱值,按下 enter 即可</span></span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> value <span class="number">20805</span></span><br><span class="line">Command (m <span class="keyword">for</span> help): w <span class="comment">//键入 w 表示确定执行刚才设定</span></span><br><span class="line">The partition table <span class="keyword">has</span> been altered!</span><br><span class="line">Calling ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@node1 yum.repos.d]# partprobe <span class="comment">//使刚才的 partition table 变更生效</span></span><br></pre></td></tr></table></figure>

<p>建立分区完成后使用指令 fdisk -l 确定 partition talbe 状态:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line"><span class="comment">#fdisk -l</span></span><br><span class="line">Disk /dev/hda: 21.4 GB,<span class="number"> 21474754560 </span>bytes</span><br><span class="line">255 heads,<span class="number"> 63 </span>sectors/track,<span class="number"> 2610 </span>cylinders</span><br><span class="line">Units = cylinders of<span class="number"> 16065 </span>*<span class="number"> 512 </span>=<span class="number"> 8225280 </span>bytes</span><br><span class="line">Device Boot Start End Blocks Id System</span><br><span class="line">/dev/hda1 *<span class="number"> 1 </span>13<span class="number"> 104391 </span>83 Linux</span><br><span class="line">/dev/hda2<span class="number"> 14 </span>2610 20860402+ 8e Linux LVM</span><br><span class="line">Disk /dev/hdb: 10.7 GB,<span class="number"> 10737377280 </span>bytes</span><br><span class="line">16 heads,<span class="number"> 63 </span>sectors/track,<span class="number"> 20805 </span>cylinders</span><br><span class="line">Units = cylinders of<span class="number"> 1008 </span>*<span class="number"> 512 </span>=<span class="number"> 516096 </span>bytes</span><br><span class="line">Device Boot Start End Blocks Id System</span><br><span class="line">/dev/hdb1<span class="number"> 1 </span>20805 10485688+<span class="number"> 83 </span>Linux</span><br></pre></td></tr></table></figure>

<p>建立分区完成后请建立 /db 目录. (Node1 及 Node2 都必须建立):</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">mkdir</span> /<span class="keyword">db</span></span><br></pre></td></tr></table></figure>

<p>建立drbd配置文件:<br>主要定义两块global和resource.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc/drbd.conf</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;drbd.d/global_common.conf&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;drbd.d/*.res&quot;</span>;</span><br><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc<span class="regexp">/drbd.d/g</span>lobal_common.conf</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">global &#123;</span><br><span class="line">    usage-<span class="keyword">count</span> yes;</span><br><span class="line">&#125;</span><br><span class="line">common &#123;</span><br><span class="line">    net &#123;</span><br><span class="line">        protocol C;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc<span class="regexp">/drbd.d/</span>r0.res</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">resource r0 &#123;</span><br><span class="line">    on node1 &#123;</span><br><span class="line">        device <span class="regexp">/dev/</span>drbd1;</span><br><span class="line">        disk <span class="regexp">/dev/</span>hdb1;</span><br><span class="line">        address <span class="number">192.168</span>.<span class="number">1.101</span>:<span class="number">7789</span>;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">    on node2 &#123;</span><br><span class="line">        device <span class="regexp">/dev/</span>drbd1;</span><br><span class="line">        disk <span class="regexp">/dev/</span>hdb1;</span><br><span class="line">        address <span class="number">192.168</span>.<span class="number">1.103</span>:<span class="number">7789</span>;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置hostname</p>
<p>根据上面的resource配置文件,需要对192.168.1.101和192.168.1.103分别设置hostname为node1和node2,设置方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/network</span><br></pre></td></tr></table></figure>

<p>修改HOSTNAME为node1.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>

<p>填入:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.1.101</span> node1</span><br><span class="line"><span class="number">192.168.1.103</span> node2</span><br></pre></td></tr></table></figure>

<p>使node1 hostnmae临时生效.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hostname</span> node<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>node2机器设置类似.</p>
<p>设置resource</p>
<p>以下操作需要在node1和node2操作.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#modprobe drbd <span class="comment">//载入 drbd 模块</span></span><br><span class="line">#lsmod|<span class="keyword">grep</span> drbd <span class="comment">//确认 drbd 模块是否载入</span></span><br><span class="line">drbd <span class="number">228528</span> <span class="number">0</span></span><br><span class="line">#dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero of=<span class="regexp">/dev/</span>hdb1 bs=<span class="number">1</span>M <span class="keyword">count</span>=<span class="number">100</span> <span class="comment">//把一些资料塞到 hdb 內 (否则 create-md 时有可能会出现错误)</span></span><br><span class="line">#drbdadm create-md r0 <span class="comment">//建立 drbd resource</span></span><br><span class="line">#drbdadm up r0 <span class="comment">//启动 resource r0</span></span><br></pre></td></tr></table></figure>

<p>查看node1和node2的状态应该类似下面的:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cat</span> /proc/drbd</span><br><span class="line"><span class="attribute">version</span>: <span class="number">8</span>.<span class="number">4</span>.<span class="number">1</span> (api:<span class="number">1</span>/proto:<span class="number">86</span>-<span class="number">100</span>)</span><br><span class="line"><span class="attribute">GIT</span>-hash: <span class="number">91</span>b<span class="number">4</span>c<span class="number">048</span>c<span class="number">1</span>a<span class="number">0</span>e<span class="number">06777</span>b<span class="number">5</span>f<span class="number">65</span>d<span class="number">312</span>b<span class="number">38</span>d<span class="number">47</span>abaea<span class="number">80</span> build by root@localhost.localdomain, <span class="number">2012</span>-<span class="number">02</span>-<span class="number">12</span> <span class="number">06</span>:<span class="number">05</span>:<span class="number">36</span></span><br><span class="line"><span class="attribute">m</span>:res cs ro ds p mounted fstype</span><br><span class="line"><span class="attribute">0</span>:r<span class="number">0</span> Connected Secondary/Secondary Inconsistent/Inconsistent C</span><br></pre></td></tr></table></figure>

<p>表明现在已经启动服务,但还没有设置同步(即需要设置Primary Node).</p>
<p>设置Primary Node</p>
<p>以下操作仅在node1执行.<br>设置node1为primary node:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">drbdadm</span> primary –force r<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>再次查看node1的状态:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cat</span> /proc/drbd</span><br><span class="line"><span class="attribute">version</span>: <span class="number">8</span>.<span class="number">4</span>.<span class="number">1</span> (api:<span class="number">1</span>/proto:<span class="number">86</span>-<span class="number">100</span>)</span><br><span class="line"><span class="attribute">GIT</span>-hash: <span class="number">91</span>b<span class="number">4</span>c<span class="number">048</span>c<span class="number">1</span>a<span class="number">0</span>e<span class="number">06777</span>b<span class="number">5</span>f<span class="number">65</span>d<span class="number">312</span>b<span class="number">38</span>d<span class="number">47</span>abaea<span class="number">80</span> build by root@localhost.localdomain, <span class="number">2012</span>-<span class="number">02</span>-<span class="number">12</span> <span class="number">06</span>:<span class="number">47</span>:<span class="number">37</span></span><br><span class="line"><span class="attribute">1</span>: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----</span><br><span class="line"><span class="attribute">ns</span>:<span class="number">52892</span> nr:<span class="number">0</span> dw:<span class="number">0</span> dr:<span class="number">52892</span> al:<span class="number">0</span> bm:<span class="number">10</span> lo:<span class="number">0</span> pe:<span class="number">0</span> ua:<span class="number">0</span> ap:<span class="number">0</span> ep:<span class="number">1</span> wo:b oos:<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>我们看到状态已经变成Primary/Secondary,即设置primary node成功.</p>
<p>创建DRBD文件系统</p>
<p>以下操作仅在node1执行.<br>上面已经完成了 <code>/dev/drbd1</code>的初始化,现在来把/dev/drbd1格式化成ext3格式的文件系统.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mkfs</span>.ext3 <span class="regexp">/dev/</span>drbd1</span><br></pre></td></tr></table></figure>

<p>然后将/dev/drbd1挂载到之前创建的/db目录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mount</span> <span class="regexp">/dev/</span>drbd1 /db</span><br></pre></td></tr></table></figure>

<p>现在你只要把数据写入/db目录,drbd即会立刻把数据同步到备机192.168.1.103的/dev/hdb1分区上.</p>
<p>drbd同步测试</p>
<p>当在备机node2启动drbd时,它是无法挂载/dev/hdb1分区的,我们可以尝试写些数据到node1的目录/db上,然后停止node2的drbd.</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">drbdadm <span class="meta">down</span> <span class="built_in">r0</span></span><br></pre></td></tr></table></figure>

<p>之后就可以把node2的/dev/hdb1挂载到目录/db.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mount</span> -t ext<span class="number">3</span> /dev/hdb<span class="number">1</span> /db</span><br></pre></td></tr></table></figure>

<p>我们就可以查看node2的/db目录是否有node1的数据.</p>
<p>手动切换主备机</p>
<p>我们可以把node1改变为备机,而node2改变为主机.<br>在node1上操作:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">umount</span> /dev/drbd<span class="number">1</span></span><br><span class="line"><span class="attribute">drbdadm</span> secondary r<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>在node2上操作:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">drbdadm</span> primary r<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>此时应该已经切换成功.</p>
]]></content>
  </entry>
  <entry>
    <title>centos下yum升级php到5.3 升级mysql到5.5</title>
    <url>/2017/08/17/1144/</url>
    <content><![CDATA[<p>不保证本文链接永久有效,如果失效请去rpm search 下载对应软件包.</p>
<p>1、运行以下命令</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>download.fedora.redhat.com<span class="regexp">/pub/</span>epel<span class="regexp">/5/i</span>386/epel-release-<span class="number">5</span>-<span class="number">4</span>.noarch.rpm</span><br><span class="line">wget http:<span class="regexp">//</span>rpms.famillecollet.com<span class="regexp">/enterprise/</span><span class="number">5</span><span class="regexp">/remi/i</span>386/remi-release-<span class="number">5</span>-<span class="number">7</span>.el5.remi.noarch.rpm</span><br><span class="line">rpm -Uvh remi-release-<span class="number">5</span>*.rpm epel-release-<span class="number">5</span>*.rpm</span><br></pre></td></tr></table></figure>

<p>2、编辑 <code>/etc/yum.repos.d/remi.repo</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/remi.repo</span><br></pre></td></tr></table></figure>

<p>在这个文件的最后增加一行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">priority</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>保存退出.</p>
<p><code>/etc/yum.repos.d/epel.repo和/etc/yum.repos.d/epel-testing.repo</code>这两个文件也按照上面的方法进行编辑!</p>
<p>3、使用下面的命令进行升级,如果单独升级php将提示失败,只有联同mysql一起升级才可以,所我们必须执行以下命令才能升级php到5.3版本:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">yum <span class="attribute">--enablerepo</span>=remi update php* mysql*</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CentOS下NTP安装配置</title>
    <url>/2011/12/03/1142/</url>
    <content><![CDATA[<p>安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ntp</span><br></pre></td></tr></table></figure>

<p>配置文件 <code>/etc/ntp.conf</code>:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">restrict</span> default kod nomodify</span><br><span class="line"><span class="attribute">notrap</span> nopeer noquery</span><br><span class="line"><span class="attribute">restrict</span>?-<span class="number">6</span> default kod nomodify notrap nopeer noquery</span><br><span class="line"><span class="attribute">restrict</span> <span class="number">127.0.0.1</span></span><br><span class="line"><span class="attribute">restrict</span>?-<span class="number">6</span>?::<span class="number">1</span></span><br><span class="line"><span class="comment">#?用restrict控管权限</span></span><br><span class="line"><span class="comment">#?nomodify?-?用户端不能更改ntp服务器的时间参数</span></span><br><span class="line"><span class="comment">#?noquery?-?用户端不能使用ntpq,ntpc等命令来查询ntp服务器</span></span><br><span class="line"><span class="comment">#?notrap?-?不提供trap远端登陆</span></span><br><span class="line"><span class="attribute">restrict</span> <span class="number">192.168.0.0</span> mask <span class="number">255.255.0.0</span> nomodify notrap</span><br><span class="line"><span class="comment">#?以下是两个ntp服务器</span></span><br><span class="line"><span class="attribute">restrict</span> cn.pool.ntp.org</span><br><span class="line"><span class="attribute">restrict</span> <span class="number">164.67.62.194</span></span><br><span class="line"><span class="comment">#?用server设定上层ntp服务器,&quot;prefer&quot;表示优先</span></span><br><span class="line"><span class="attribute">server</span> cn.pool.ntp.org prefer</span><br><span class="line"><span class="attribute">server</span> <span class="number">164.67.62.194</span></span><br><span class="line"><span class="attribute">server</span> <span class="number">127.127.1.0</span>?#?local clock</span><br><span class="line"><span class="attribute">fudge</span> <span class="number">127.127.1.0</span> stratum <span class="number">10</span></span><br><span class="line"><span class="comment">#?系统时间与bios事件的偏差记录</span></span><br><span class="line"><span class="attribute">driftfile</span>?/var/lib/ntp/drift</span><br><span class="line"><span class="attribute">keys</span>?/etc/ntp/keys</span><br><span class="line"><span class="comment">#?日志</span></span><br><span class="line"><span class="attribute">logfile</span>?/var/log/ntp.log</span><br><span class="line"><span class="attribute">broadcastdelay</span> <span class="number">0</span>.<span class="number">008</span></span><br></pre></td></tr></table></figure>

<p>一个说明:</p>
<p>我在vmware下搭建的ntp服务器,别人可以同步它,它自己的时间却不对.照理是它同步上层,下层同步它呀.后来找了蛮久的资料,发现这个文件:<code>/etc/ntp/step-tickers</code>,说是ntp服务器无法主动同步上层服务器,所以将地址写入该文件中即可.<br>我在物理机里暂时没发现这个问题,也许是物理机本来自己的时间就正确,就难以发现它有没有主动同步上层服务器.</p>
<p>运行ntp:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">service ntpd <span class="built_in">start</span>/<span class="built_in">stop</span>/restart</span><br><span class="line">chkconfig ntpd <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>查看ntp的端口,应该看到123端口:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">netstat?-unlnp</span><br></pre></td></tr></table></figure>

<p>查看ntp服务器有无和上层连通:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">[root@S5?~]<span class="comment">#?ntpstat</span></span><br><span class="line">synchronised <span class="keyword">to</span> NTP server?()?<span class="keyword">at</span> stratum <span class="number">2</span></span><br><span class="line"><span class="built_in">time</span> correct <span class="keyword">to</span> within <span class="number">74</span> ms</span><br><span class="line">polling server <span class="keyword">every</span> <span class="number">128</span> s</span><br></pre></td></tr></table></figure>

<p>注意:此命令出现上述synchronised结果比较慢,我的用了大概5分钟.<br>查看ntp服务器与上层间的联系:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="string">[root@S5?~]</span>#?ntptrace?-n <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1</span>:?stratum <span class="number">2</span>,?offset <span class="number">0</span>.<span class="number">064524</span>,?synch distance <span class="number">0</span>.<span class="number">121167</span></span><br><span class="line"><span class="number">210.72.145.44</span>:?timed out,?nothing received***Request timed out</span><br></pre></td></tr></table></figure>

<p>查看ntp服务器与上层ntp服务器的状态:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@S5</span>?~]<span class="meta">#?ntpq?-p</span></span><br></pre></td></tr></table></figure>

<p>其中,</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">remote?-<span class="string">?本</span>机和上层ntp的ip或主机名,<span class="string">&quot;+&quot;</span>表示优先,<span class="string">&quot;*&quot;</span>表示次优先</span><br><span class="line">refid?-<span class="string">?参</span>考上一层ntp主机地址</span><br><span class="line">st?-<span class="string">?s</span>tratum阶层</span><br><span class="line"><span class="keyword">when</span>?-<span class="string">?多</span>少秒前曾经同步过时间</span><br><span class="line">poll?-<span class="string">?下</span>次更新在多少秒后</span><br><span class="line">reach?-<span class="string">?已</span>经向上层ntp服务器要求更新的次数</span><br><span class="line">delay?-<span class="string">?网</span>络延迟</span><br><span class="line">offset?-<span class="string">?时</span>间补偿</span><br><span class="line">jitter?-<span class="string">?系</span>统时间与bios时间差</span><br></pre></td></tr></table></figure>

<p>客户端同步时间的方法:</p>
<p>方法一:使用 ntpdate</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ntpdate?<span class="selector-attr">[IP_Address]</span></span><br></pre></td></tr></table></figure>

<p>看下面的例子,其中192.168.1.5是我在内网搭建的ntp服务器:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@zy18</span>0?~]<span class="comment">#?date</span></span><br><span class="line">Thu Sep <span class="number">25</span> <span class="number">13</span><span class="symbol">:</span><span class="number">04</span><span class="symbol">:</span><span class="number">17</span> CST <span class="number">2008</span></span><br><span class="line">[root<span class="variable">@zy18</span>0?~]<span class="comment">#?ntpdate 192.168.1.5</span></span><br><span class="line"><span class="number">25</span> Sep <span class="number">14</span><span class="symbol">:</span><span class="number">33</span><span class="symbol">:</span><span class="number">13</span> ntpdate[<span class="number">10302</span>]<span class="symbol">:<span class="string">?s</span>tep</span> time server <span class="number">192.168</span>.<span class="number">1.5</span> offset <span class="number">5327.700798</span> sec</span><br><span class="line">[root<span class="variable">@zy18</span>0?~]<span class="comment">#?date</span></span><br><span class="line">Thu Sep <span class="number">25</span> <span class="number">14</span><span class="symbol">:</span><span class="number">33</span><span class="symbol">:</span><span class="number">18</span> CST <span class="number">2008</span></span><br></pre></td></tr></table></figure>

<p>ntpdate 的特点:</p>
<p>1,ntpdate只运行一次就结束,即只同步一次.所以要使用ntpdate同步时间的话要将该命令写入cron中.</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">vi?<span class="regexp">/etc/crontab</span></span><br><span class="line">*<span class="string">?*</span><span class="string">?*</span><span class="string">?*</span><span class="string">?*</span><span class="string">?r</span>oot ntpdate <span class="number">192.168</span>.<span class="number">1.5</span>?&amp;&amp;<span class="string">?h</span>wclock?-w</span><br></pre></td></tr></table></figure>

<p>之所以使用hwclock?-w命令稍后再说.</p>
<p>2,ntpdate同步时间是跳跃的,如上面的显示,时间立即就同步了,这将可能导致文件时间标记、监控数据的紊乱.</p>
<p>方法二:使用ntpd服务</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">step1:</span><span class="meta-keyword">/etc/</span>ntpd.conf 写入 server?[IP_Address]</span><br><span class="line"><span class="symbol">step2:</span>chkconfig ntpd on</span><br><span class="line"><span class="symbol">step3:</span>service ntpd start</span><br></pre></td></tr></table></figure>

<p>大概过一刻钟开始起作用.</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">FAQ:系统报错?-?Sep 25 11:59:39 localhost kernel:?set_rtc_mmss:?can&#x27;t <span class="keyword">update</span> <span class="keyword">from</span> <span class="number">7</span> <span class="keyword">to</span> <span class="number">59</span></span><br><span class="line">==================================网上查得源码==========================================</span><br><span class="line"><span class="keyword">if</span>?(<span class="built_in">abs</span>(real_minutes?-?cmos_minutes)?&lt;?<span class="number">30</span>)?&#123;?update_cmos()?&#125;?<span class="keyword">else</span>?&#123;?printk(<span class="string">&quot;set_rtc_mmss:?can&#x27;t update from?%d to?%dn&quot;</span>,?cmos_minutes,?real_minutes);?&#125;?========================================================================================</span><br></pre></td></tr></table></figure>

<p>bios时间与系统时间差异超过30分钟,就会报上述错误,只要修改bios时间或系统时间即可.</p>
<p>虚拟机下个人体验:</p>
<p>我的vm客户端用ntpd同步服务器后,慢慢变成标准时间,可接着又比标准时间越来越慢,然后出现上述报错.所以我觉得ntpd的同步频率比我的vm时钟频率跑得慢.</p>
<p>ntpd 的特点:</p>
<p>1,ntpd服务始终运行,定期同步时间.<br>2,ntpd服务是慢慢改变时间直至标准时间.<br>3,如果系统时间与bios时间差异超过30分钟,ntpd就会报错.</p>
<p>总结:<br>1,推荐使用 ntpd 服务.</p>
<p>2,ntpd开启后,无法使用ntpdate,看如下例子:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@zy18</span>0?~]<span class="comment">#?service ntpd start</span></span><br><span class="line">Starting <span class="symbol">ntpd:</span><span class="string">?[</span><span class="string">?O</span>K?]</span><br><span class="line">[root<span class="variable">@zy18</span>0?~]<span class="comment">#?ntpdate 192.168.1.5</span></span><br><span class="line"><span class="number">25</span> Sep <span class="number">15</span><span class="symbol">:</span><span class="number">25</span><span class="symbol">:</span><span class="number">22</span> ntpdate[<span class="number">12334</span>]<span class="symbol">:<span class="string">?t</span>he</span> NTP socket is <span class="keyword">in</span> use,<span class="string">?e</span>xiting</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos下安装3proxy</title>
    <url>/2012/07/07/1145/</url>
    <content><![CDATA[<p>1.安装epel</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http:<span class="regexp">//mi</span>rrors.sohu.com<span class="regexp">/fedora-epel/</span><span class="number">5</span>Server<span class="regexp">/x86_64/</span>epel-release-<span class="number">5</span>-<span class="number">4</span>.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>2.安装3proxy</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install <span class="number">3</span>proxy -y</span><br></pre></td></tr></table></figure>

<p>3.修改配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span><span class="number">3</span>proxy.cfg</span><br></pre></td></tr></table></figure>

<p>替换以下内容:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">users test:CL:test</span><br><span class="line">nscache <span class="number">65536</span></span><br><span class="line">daemon</span><br><span class="line"><span class="keyword">log</span> /var/<span class="keyword">log</span>/<span class="number">3</span>proxy/<span class="number">3</span>proxy.log D</span><br><span class="line">logformat <span class="string">&quot;%d-%m-%Y %H:%M:%S %U %C:%c %R:%r %O %I %T&quot;</span></span><br><span class="line">archiver gz /bin/gzip %F</span><br><span class="line">rotate <span class="number">50</span></span><br><span class="line">maxconn <span class="number">50</span></span><br><span class="line">auth strong</span><br><span class="line">allow * * * <span class="number">80</span> HTTP</span><br><span class="line">allow * * * <span class="number">443</span> HTTPS</span><br><span class="line">proxy -a -p2323</span><br></pre></td></tr></table></figure>

<p>4.启动</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span><span class="number">3</span>proxy restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos下编译安装Heartbeat</title>
    <url>/2016/10/15/1147/</url>
    <content><![CDATA[<p>安装heartbeat之前需要安装glue:<br>yum install autoconf automake libtool glib2-devel libxml2-devel bzip2-devel e2fsprogs-devel libxslt-devel<br>groupadd haclient<br>useradd -g haclient hacluster<br>cd /tmp<br>wget <a href="http://hg.linux-ha.org/glue/archive/glue-1.0.9.tar.bz2">http://hg.linux-ha.org/glue/archive/glue-1.0.9.tar.bz2</a><br>tar xjf glue-1.0.9.tar.bz2<br>cd Reusable-Cluster-Components-glue–glue-1.0.9<br>./autogen.sh<br>./configure –prefix=/usr/local/heartbeat<br>make &amp;&amp; make install</p>
<p>安装Resource Agents:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget --no-check-certificate https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ClusterLabs/</span>resource-agents<span class="regexp">/tarball/</span>v3.<span class="number">9.2</span></span><br><span class="line">tar xzf v3.<span class="number">9.2</span></span><br><span class="line">cd ClusterLabs-resource-agents-b735277/</span><br><span class="line">./autogen.sh</span><br><span class="line">export CFLAGS=<span class="string">&quot;$CFLAGS -I/usr/local/heartbeat/include -L/usr/local/heartbeat/lib&quot;</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>heartbeat</span><br><span class="line">ln -s  <span class="regexp">/usr/</span>local<span class="regexp">/heartbeat/</span>lib<span class="regexp">/* /</span>lib/</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>安装Heartbeat:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget http:<span class="regexp">//</span>hg.linux-ha.org<span class="regexp">/heartbeat-STABLE_3_0/</span>archive/<span class="number">7</span>e3a82377fa8.tar.bz2</span><br><span class="line">tar xjf <span class="number">7</span>e3a82377fa8.tar.bz2</span><br><span class="line">cd Heartbeat-<span class="number">3</span>-<span class="number">0</span>-<span class="number">7</span>e3a82377fa8/</span><br><span class="line">./bootstrap</span><br><span class="line">export CFLAGS=<span class="string">&quot;$CFLAGS -I/usr/local/heartbeat/include -L/usr/local/heartbeat/lib&quot;</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>heartbeat</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cp doc<span class="regexp">/ha.cf /u</span>sr<span class="regexp">/local/</span>heartbeat<span class="regexp">/etc/</span>ha.d/</span><br><span class="line">cp doc<span class="regexp">/haresources /u</span>sr<span class="regexp">/local/</span>heartbeat<span class="regexp">/etc/</span>ha.d/</span><br><span class="line">cp doc<span class="regexp">/authkeys /u</span>sr<span class="regexp">/local/</span>heartbeat<span class="regexp">/etc/</span>ha.d/</span><br><span class="line">cp heartbeat<span class="regexp">/init.d/</span>heartbeat <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span></span><br><span class="line">chkconfig --add heartbeat</span><br><span class="line">chkconfig heartbeat on</span><br><span class="line">chmod <span class="number">600</span> <span class="regexp">/usr/</span>local<span class="regexp">/heartbeat/</span>etc<span class="regexp">/ha.d/</span>authkeys</span><br><span class="line">sed -i <span class="string">&#x27;s#/usr/lib/ocf#/usr/local/heartbeat/usr/lib/ocf#g&#x27;</span> <span class="regexp">/usr/</span>local<span class="regexp">/heartbeat/</span>etc<span class="regexp">/ha.d/</span>shellfuncs</span><br><span class="line">sed -i <span class="string">&#x27;s#/usr/lib/ocf#/usr/local/heartbeat/usr/lib/ocf#g&#x27;</span> <span class="regexp">/usr/</span>local<span class="regexp">/heartbeat/u</span>sr<span class="regexp">/lib/</span>ocf<span class="regexp">/lib/</span><span class="regexp">/heartbeat/</span>ocf-shellfuncs</span><br><span class="line">sed -i <span class="string">&#x27;s#/usr/lib/ocf#/usr/local/heartbeat/usr/lib/ocf#g&#x27;</span> <span class="regexp">/usr/</span>local<span class="regexp">/heartbeat/</span>etc<span class="regexp">/ha.d/</span>resource.d<span class="regexp">//</span>hto-mapfuncs</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos下搭建分布式存储系统(MFS)</title>
    <url>/2015/10/01/1148/</url>
    <content><![CDATA[<p>实在懒得翻译了,大家讲究这看吧,也就那几个命令,如果有什么问题何以随时联系站长 QQ:53273291</p>
<p>Moosefs-1.6.10 INSTALL</p>
<p>Use software:</p>
<p>1 fuse-2.7.4.tar.gz<br>2 mfs-1.6.10.tar.gz</p>
<p>Master install and running steps:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#add mfs user:</span></span><br><span class="line"></span><br><span class="line">useradd mfs –s <span class="regexp">/sbin/</span>nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#install mfs:</span></span><br><span class="line"></span><br><span class="line">tar zxvf mfs-<span class="number">1.6</span>.<span class="number">10</span>.tar.gz</span><br><span class="line">cd mfs-<span class="number">1.6</span>.<span class="number">10</span></span><br><span class="line">.<span class="regexp">/configure –prefix=/u</span>sr<span class="regexp">/local/m</span>fs –with-default-user=mfs –with-default-group=mfs</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#produce and modify configuration file:</span></span><br><span class="line"></span><br><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>etc</span><br><span class="line">cp mfsmaster.cfg.dist mfsmaster.cfg</span><br><span class="line">cp mfsmetalogger.cfg.dist mfsmetalogger.cfg</span><br><span class="line">vi mfsmetalogger.cfg –&gt; MASTER_HOST = <span class="number">192.168</span>.<span class="number">0.19</span></span><br><span class="line">mkdir <span class="regexp">/var/</span>run/mfs</span><br><span class="line">chown –R mfs:mfs <span class="regexp">/var/</span>run/mfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#running mfsmaster:</span></span><br><span class="line"></span><br><span class="line">cd <span class="regexp">/usr/</span>local/mfs</span><br><span class="line">sbin/mfsmaster start</span><br><span class="line">sbin/mfsmetalogger start</span><br><span class="line"><span class="comment">#check process: </span></span><br><span class="line">ps aux | grep mfsmaster </span><br><span class="line"><span class="comment">#check system log:</span></span><br><span class="line">tail –f <span class="regexp">/var/</span>log/messages </span><br><span class="line"><span class="comment">#check network status:</span></span><br><span class="line">netstat –an | grep tcp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tcp4       <span class="number">0</span>     <span class="number">52</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">22</span>        <span class="number">192.168</span>.<span class="number">1.252</span>.<span class="number">49020</span>    ESTABLISHEDtcp4       <span class="number">0</span>      <span class="number">0</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">9420</span>      <span class="number">192.168</span>.<span class="number">0.75</span>.<span class="number">16178</span>     ESTABLISHED</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">9420</span>      <span class="number">192.168</span>.<span class="number">0.72</span>.<span class="number">42870</span>     ESTABLISHED</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">9420</span>      <span class="number">192.168</span>.<span class="number">0.71</span>.<span class="number">2740</span>      ESTABLISHED</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">9420</span>      <span class="number">192.168</span>.<span class="number">0.73</span>.<span class="number">38114</span>     ESTABLISHED</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">9419</span>      <span class="number">192.168</span>.<span class="number">0.19</span>.<span class="number">25712</span>     ESTABLISHED</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  *.<span class="number">9421</span>                 *.*                    LISTEN</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  *.<span class="number">9420</span>                 *.*                    LISTEN</span><br><span class="line">tcp4       <span class="number">0</span>      <span class="number">0</span>  *.<span class="number">9419</span>                 *.*                    LISTEN</span><br></pre></td></tr></table></figure>

<p>Everything seems to be fine!!!!!</p>
<p>Chunkserver install and running steps:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#add mfs user :</span></span><br><span class="line"></span><br><span class="line">useradd mfs –s <span class="regexp">/sbin/</span>nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#install mfs</span></span><br><span class="line"></span><br><span class="line">tar zxvf mfs-<span class="number">1.6</span>.<span class="number">10</span>.tar.gz</span><br><span class="line">cd mfs-<span class="number">1.6</span>.<span class="number">10</span></span><br><span class="line">.<span class="regexp">/configure –prefix=/u</span>sr<span class="regexp">/local/m</span>fs –with-default-user=mfs –with-default-group=mfs</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="comment">#produce and modify configuration file:</span></span><br><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>etc</span><br><span class="line">cp mfschunkserver.cfg.dist mfschunkser.cfg</span><br><span class="line">cp mfshdd.cfg.dist  mfshdd.cfg</span><br><span class="line">vi mfschunkserver.cfg –&gt; MASTER_HOST = <span class="number">192.168</span>.<span class="number">0.19</span></span><br><span class="line">vi mfshdd.cfg –&gt; /data (It is a separate partition)</span><br><span class="line">mkdir <span class="regexp">/var/</span>run/mfs</span><br><span class="line">chown –R mfs:mfs <span class="regexp">/var/</span>run/mfs</span><br><span class="line">chown –R mfs:mfs /data</span><br><span class="line"></span><br><span class="line"><span class="comment">#running mfsmaster:</span></span><br><span class="line"></span><br><span class="line">cd <span class="regexp">/usr/</span>local/mfs</span><br><span class="line">sbin/mfschunkserver start</span><br><span class="line"></span><br><span class="line"><span class="comment">#check process:</span></span><br><span class="line"></span><br><span class="line">ps aux | grep mfsmaster</span><br><span class="line"></span><br><span class="line"><span class="comment">#check system log:</span></span><br><span class="line"></span><br><span class="line">tail –f <span class="regexp">/var/</span>log/messages</span><br><span class="line"></span><br><span class="line"><span class="comment">#check network status:</span></span><br><span class="line"></span><br><span class="line">netstat –an | grep tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#check directory /data , Observed the existence of a file or directory:</span></span><br><span class="line"></span><br><span class="line">ls –al /data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mfs-<span class="number">1</span> etc]<span class="comment"># ls -al /data/total 1036</span></span><br><span class="line"></span><br><span class="line">drwxr-xr-x <span class="number">258</span> mfs  mfs  <span class="number">4096</span> Dec <span class="number">23</span> <span class="number">11</span>:<span class="number">59</span> .</span><br><span class="line">drwxr-xr-x  <span class="number">24</span> root root <span class="number">4096</span> Dec <span class="number">22</span> <span class="number">10</span>:<span class="number">17</span> ..</span><br><span class="line">drwxr-x—   <span class="number">2</span> mfs  mfs  <span class="number">4096</span> Dec <span class="number">23</span> <span class="number">11</span>:<span class="number">59</span> <span class="number">00</span></span><br><span class="line">drwxr-x—   <span class="number">2</span> mfs  mfs  <span class="number">4096</span> Dec <span class="number">23</span> <span class="number">11</span>:<span class="number">59</span> <span class="number">01</span></span><br><span class="line">drwxr-x—   <span class="number">2</span> mfs  mfs  <span class="number">4096</span> Dec <span class="number">23</span> <span class="number">11</span>:<span class="number">59</span> <span class="number">02</span></span><br><span class="line">drwxr-x—   <span class="number">2</span> mfs  mfs  <span class="number">4096</span> Dec <span class="number">23</span> <span class="number">11</span>:<span class="number">59</span> <span class="number">03</span></span><br></pre></td></tr></table></figure>

<p>Everything seems to be fine!!!!!</p>
<p>Mfs client install and mount operation steps:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="meta">#add mfs user :</span></span><br><span class="line"></span><br><span class="line">useradd mfs –s /sbin/<span class="keyword">nologin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#install mfs: </span></span><br><span class="line"></span><br><span class="line">tar zxvf mfs<span class="number">-1.6</span><span class="number">.10</span>.tar.gz</span><br><span class="line">cd mfs<span class="number">-1.6</span><span class="number">.10</span></span><br><span class="line">./configure –prefix=/usr/<span class="keyword">local</span>/mfs –<span class="keyword">with</span>-<span class="keyword">default</span>-<span class="keyword">user</span>=mfs –<span class="keyword">with</span>-<span class="keyword">default</span>-<span class="keyword">group</span>=mfs –<span class="keyword">enable</span>-mfsmount</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>mount mfs:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#when os is freebsd:</span></span><br><span class="line"></span><br><span class="line">mkdir <span class="regexp">/mnt/m</span>fs</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>bin/mfsmount -h <span class="number">192.168</span>.<span class="number">0.19</span></span><br><span class="line">df –h Output is as follows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shoucang5<span class="comment"># df -h Filesystem                        Size    Used   Avail Capacity  Mounted on</span></span><br><span class="line"></span><br><span class="line">           <span class="regexp">/dev/</span>ad4s1a                          <span class="number">19</span>G    <span class="number">1.8</span>G     <span class="number">16</span>G    <span class="number">10</span>%    /</span><br><span class="line">           devfs                               <span class="number">1.0</span>K    <span class="number">1.0</span>K      <span class="number">0</span>B   <span class="number">100</span>%    /dev</span><br><span class="line">           <span class="regexp">/dev/</span>fuse0                          <span class="number">7.1</span>T      <span class="number">0</span>B    <span class="number">7.1</span>T     <span class="number">0</span>%    <span class="regexp">/mnt/m</span>fs</span><br><span class="line"></span><br><span class="line"><span class="comment">#when os is centos:</span></span><br><span class="line"></span><br><span class="line">mkdir <span class="regexp">/mnt/m</span>fs</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mfs/</span>bin<span class="regexp">/mfsmount -H 192.168.0.19 /m</span>nt Output is as follows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@dl-src mfs]<span class="comment"># bin/mfsmount -H 192.168.0.19 /mntmfsmaster register error: Permission denied</span></span><br></pre></td></tr></table></figure>

<p>It is not fine!!!!!!!</p>
<p>Note:If found not fuse , you can perform command in unix shell .</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:<span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>pkgconfig</span><br></pre></td></tr></table></figure>

<p>But when I use mfs-1.5.12 as mfsclient installing to mount master(version1.6.10),It is ok!</p>
]]></content>
  </entry>
  <entry>
    <title>centos下手动安装ispconfig</title>
    <url>/2017/06/18/1149/</url>
    <content><![CDATA[<p>英文的官方文档,别告诉我你看不懂英语,centos最新版是没有办法安装的 所以用5.5是个不错的选择.</p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>It is recommended to use a clean (fresh) CentOS 5.4 install. Then follow the steps below to setup your server with ISPConfig 3:<br>Installation of some basic requirements:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">rpm --<span class="keyword">import</span> <span class="regexp">/etc/</span>pki<span class="regexp">/rpm-gpg/</span>RPM-GPG-KEY*</span><br></pre></td></tr></table></figure>

<p>enable the contrib and centosplus repositories.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure>

<p>Edit the file <code>/etc/yum.repos.d/CentOS-Base.repo</code> and edit the lines below.</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[base]</span></span><br><span class="line">exclude=postfix</span><br><span class="line"><span class="selector-attr">[update]</span></span><br><span class="line">exclude=postfix</span><br><span class="line"><span class="selector-attr">[centosplus]</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">includepkgs=postfix</span><br><span class="line"><span class="selector-attr">[contrib]</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rpm --import http:<span class="comment">//dag.wieers.com/rpm/packages/RPM-GPG-KEY.dag.txt</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /tmp</span><br><span class="line">wget http:<span class="comment">//packages.sw.be/rpmforge-release/rpmforge-release-0.5.1-1.el5.rf.i386.rpm</span></span><br><span class="line">rpm -<span class="selector-tag">i</span> rpmforge-release-<span class="number">0.5</span>.<span class="number">1</span>-<span class="number">1</span><span class="selector-class">.el5</span><span class="selector-class">.rf</span><span class="selector-class">.i386</span><span class="selector-class">.rpm</span></span><br><span class="line">yum update</span><br></pre></td></tr></table></figure>

<p>You should disable selinux now, as some programs will not start when selinux is enabled:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">system-config-securitylevel-tui</span><br></pre></td></tr></table></figure>

<p>then reboot the server.<br>Then remove the postfix without mysql support.</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">yum <span class="built_in">remove</span> <span class="built_in">postfix</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>Install Postfix fron centosplus with mysql support, Dovecot, MySQL, phpMyAdmin with the following command line (on one line!)</p>
<p>yum install ntp httpd mysql-server php php-mysql php-mbstring phpMyAdmin postfix getmail</p>
</li>
</ol>
<p>For 32Bit systems:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -i http://dl.atrpms.net/<span class="literal">all</span>/dovecot-<span class="number">1</span>.<span class="number">2</span>.<span class="number">11</span>-<span class="number">3</span>_<span class="number">108</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -i http://dl.atrpms.net/<span class="literal">all</span>/dovecot-sieve-<span class="number">0</span>.<span class="number">1</span>.<span class="number">15</span>-<span class="number">4</span>.el<span class="number">5</span>.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>

<p>For 64Bit Systems:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -ivh http:<span class="regexp">//</span>dl.atrpms.net<span class="regexp">/all/</span>dovecot-<span class="number">1.2</span>.<span class="number">11</span>-<span class="number">3</span>_108.el5.x86_64.rpm</span><br><span class="line">rpm -ivh http:<span class="regexp">//</span>dl.atrpms.net<span class="regexp">/all/</span>dovecot-sieve-<span class="number">0.1</span>.<span class="number">15</span>-<span class="number">4</span>.el5.x86_64.rpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chkconfig --levels <span class="number">235</span> mysqld on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/mysqld start</span><br><span class="line">chkconfig --levels <span class="number">235</span> httpd on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/httpd start</span><br><span class="line">chkconfig --levels <span class="number">235</span> dovecot on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/dovecot start</span><br><span class="line">chkconfig --levels <span class="number">235</span> sendmail off</span><br><span class="line">chkconfig --levels <span class="number">235</span> postfix on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/sendmail stop</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/postfix start</span><br></pre></td></tr></table></figure>

<p>Set the mysql database password:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin/mysql_secure_installation</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Install Amavisd-new, Spamassassin and Clamav (1 line!)</p>
<p>yum install amavisd-new spamassassin clamav clamd unzip bzip2 unrar</p>
<p>sa-update<br>chkconfig –levels 235 amavisd on<br>chkconfig –levels 235 clamd on<br>/usr/bin/freshclam<br>/etc/init.d/amavisd start<br>/etc/init.d/clamd start</p>
</li>
</ol>
<p>If you use the amavisd from rpmforge (as we do in this guide) and not the one from centos, you will have to do these additional steps:</p>
<p>add the following line in /<code>etc/sysconfig/amavisd</code>:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">CONFIG_FILE=<span class="string">&quot;/etc/amavisd/amavisd.conf</span></span><br></pre></td></tr></table></figure>

<p>run:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/var/</span>run<span class="regexp">/amavisd /</span>var<span class="regexp">/spool/</span>amavisd <span class="regexp">/var/</span>spool<span class="regexp">/amavisd/</span>tmp <span class="regexp">/var/</span>spool<span class="regexp">/amavisd/</span>db</span><br><span class="line">chown amavis <span class="regexp">/var/</span>run<span class="regexp">/amavisd /</span>var<span class="regexp">/spool/</span>amavisd <span class="regexp">/var/</span>spool<span class="regexp">/amavisd/</span>tmp <span class="regexp">/var/</span>spool<span class="regexp">/amavisd/</span>db</span><br><span class="line">ln -s <span class="regexp">/var/</span>run<span class="regexp">/clamav/</span>clamd.sock <span class="regexp">/var/</span>spool<span class="regexp">/amavisd/</span>clamd.sock</span><br><span class="line">yum install perl-DBD-mysql</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>Install apache, PHP5 and phpmyadmin (1 line!)</p>
<p>yum install php php-devel php-gd php-imap php-ldap php-mysql php-odbc php-pear php-xml php-xmlrpc php-eaccelerator php-mbstring php-mcrypt php-mhash php-mssql php-snmp php-soap php-tidy curl curl-devel perl-libwww-perl ImageMagick libxml2 libxml2-devel phpmyadmin</p>
</li>
<li><p>Install pure-ftpd and quota</p>
<p>yum install pure-ftpd quota</p>
<p>chkconfig –levels 235 pure-ftpd on<br>/etc/init.d/pure-ftpd start</p>
</li>
<li><p>Install bind dns server</p>
<p>yum install bind-chroot</p>
<p>chmod 755 /var/named/<br>chmod 775 /var/named/chroot/<br>chmod 775 /var/named/chroot/var/<br>chmod 775 /var/named/chroot/var/named/<br>chmod 775 /var/named/chroot/var/run/<br>chmod 777 /var/named/chroot/var/run/named/<br>cd /var/named/chroot/var/named/<br>ln -s ../../ chroot<br>cp /usr/share/doc/bind-9.3.6/sample/var/named/named.local /var/named/chroot/var/named/named.local<br>cp /usr/share/doc/bind-9.3.6/sample/var/named/named.root /var/named/chroot/var/named/named.root<br>touch /var/named/chroot/etc/named.conf<br>touch /var/named/chroot/etc/named.conf.local</p>
<p>vi /var/named/chroot/etc/named.conf</p>
<p>//<br>// named.conf<br>//<br>// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS<br>// server as a caching only nameserver (as a localhost DNS resolver only).<br>//<br>// See /usr/share/doc/bind*/sample/ for example named configuration files.<br>//</p>
<p>options {<br>listen-on port 53 { 127.0.0.1; };<br>listen-on-v6 port 53 { ::1; };<br>directory?????? “/var/named/chroot/var/named”;<br>dump-file?????? “/var/named/chroot/var/named/data/cache_dump.db”;<br>statistics-file “/var/named/chroot/var/named/data/named_stats.txt”;<br>memstatistics-file “/var/named/chroot/var/named/data/named_mem_stats.txt”;<br>allow-query???? { localhost; };<br>recursion yes;<br>};</p>
<p>logging {<br>channel default_debug {<br>file “data/named.run”;<br>severity dynamic;<br>};<br>};</p>
<p>zone “.” IN {<br>type hint;<br>file “named.root”;<br>};</p>
<p>include “/var/named/chroot/etc/named.conf.local”;</p>
<p>chkconfig –levels 235 named on<br>/etc/init.d/named start</p>
</li>
<li><p>Install vlogger dependencies and webalizer</p>
<p>yum install webalizer perl-DateTime-Format-HTTP perl-DateTime-Format-Builder</p>
</li>
</ol>
<p>Installing Jailkit:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line"></span><br><span class="line"><span class="keyword">cd</span> <span class="string">/tmp</span></span><br><span class="line">wget http:<span class="string">//olivier.sessink.nl/jailkit/jailkit-2.11.tar.gz</span></span><br><span class="line">tar xvfz jailkit-2.11.tar.gz</span><br><span class="line"><span class="keyword">cd</span> jailkit-2.11</span><br><span class="line"><span class="string">./configure</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">rm -rf jailkit-2.11*</span><br></pre></td></tr></table></figure>

<p>Edit the file <code>/etc/sudoers</code>:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">vi /etc/sudoers</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> change <span class="keyword">the</span> <span class="built_in">line</span>:</span><br><span class="line">Defaults??? requiretty</span><br><span class="line"><span class="built_in">to</span>:</span><br><span class="line"><span class="comment"># Defaults??? requiretty</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>Install ISPConfig 3</p>
<p>cd /tmp<br>wget <a href="http://www.ispconfig.org/downloads/ISPConfig-3.0.2.tar.gz">http://www.ispconfig.org/downloads/ISPConfig-3.0.2.tar.gz</a><br>tar xvfz ISPConfig-3.0.2.tar.gz<br>cd ispconfig3_install/install/</p>
</li>
</ol>
<p>Now start the installation process by executing:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">php -q <span class="keyword">install</span>.php</span><br></pre></td></tr></table></figure>

<p>The installer will configure all services like postfix, sasl, courier, etc. for you. A manual setup as required for ISPConfig 2 (perfect setup guides) is not necessary. To login to the ISPConfig controlpanel, open the following URL in your browser (replace the IP to match your settings!):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">0.100</span>:<span class="number">8080</span>/</span><br></pre></td></tr></table></figure>

<p>the default login is:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">user</span>: <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">password</span>: <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>

<p>In case you get a permission denied error from apache, please restart the apache webserver process.</p>
<p>Optional:<br>Install a webbased Email Client<br>yum install squirrelmail</p>
]]></content>
  </entry>
  <entry>
    <title>centos证书登录</title>
    <url>/2018/01/25/1150/</url>
    <content><![CDATA[<p>生成证书:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh-keygen -t dsa</span></span><br></pre></td></tr></table></figure>

<p>一直回车,然后:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> ~<span class="string">/.ssh</span></span><br><span class="line">cat id_dsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>

<p>#2019年5月20日 修改更新:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">chmod 644 authorized_keys</span><br><span class="line"><span class="keyword">cd</span> <span class="string">..</span></span><br><span class="line">chmod 700 <span class="string">.ssh</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">..</span></span><br><span class="line">chown root<span class="function">:root</span> root</span><br></pre></td></tr></table></figure>

<p>测试:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh localhost</span></span><br></pre></td></tr></table></figure>

<p>可发送authorized_keys到要登陆的机器.</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS下安装PortSentry防止恶意扫描</title>
    <url>/2019/03/30/1146/</url>
    <content><![CDATA[<p>我在检查一台Centos5.5服务器的安全环境时,发现很多IP在恶意扫描此服务器的端口,本来想部署snort防入侵环境的,后来发现snort环境部署非常复杂,而以上的恶意扫描完全可以用PortSentry来实现.PortSentry是入侵检测工具中配置最简单、效果最直接的工具之一.PortSentry是Abacus工程的一个组成部分.Abacus工程的目标是建立一个基于主机的网络入侵检测系统,可以从<a href="http://www.psonic.com/">http://www.psonic.com</a> 得到关于Abacus工程更为详细的信息.虽然PortSentry被cisco收购后不再开发,但丝毫不影响此软件的强大功能.PortSentry可以实时检测几乎所有类型的网络扫描,并对扫描行为做出反应.一旦发现可疑的行为,PortSentry可以采取如下一些特定措施来加强防范:<br>给出虚假的路由信息,把所有的信息流都重定向到一个不存在的主机;<br>自动将对服务器进行端口扫描的主机加到TCP-Wrappers的 <code>/etc/hosts.deny</code>文件中去,我个人比较喜欢这种方式,因为线上许多环境并非都能打开iptables,这个选项也是PortSentry默认的功能;<br>利用Netfilter机制,用包过滤程序,比如iptables和ipchain等,把所有非法数据包(来自对服务器进行端口扫描的主机)都过滤掉;<br>通过syslog()函数给出一个目志消息,甚至可以返回给扫描者一段警告信息.</p>
<p>一、PortSentry的安装</p>
<p>下面详细介绍PortSentry工具的安装和配置方法.<br>从<a href="http://sourceforge.net/projects/sentrytools/">http://sourceforge.net/projects/sentrytools/</a> 下载软件的最新版 portsentry-1.2.tar.gz,用root用户执行如下命令进行安装:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> tar zxvf portsentry<span class="literal">-1</span>.<span class="number">2</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> portsentry<span class="literal">-1</span>.<span class="number">2</span>_beta</span><br><span class="line"><span class="variable">$</span> make</span><br><span class="line"><span class="variable">$</span> make install</span><br></pre></td></tr></table></figure>

<p>进行到这步时发现报错,系统生成不了protsentry执行文件,<br>我们查看Makefile文件时发现,make后面根据操作系统的不同有许多选项.<br>所以我们重新执行此步操作,将目录删除重新解压缩.<br>然后我们执行make linux,发现系统仍然报错,如下:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">SYSTYPE=linux</span><br><span class="line">Making</span><br><span class="line"><span class="keyword">cc</span> -O -Wall -DLINUX -DSUPPORT_STEALTH -<span class="keyword">o</span> ./portsentry ./portsentry.<span class="keyword">c</span></span><br><span class="line">./portsentry_io.<span class="keyword">c</span> ./portsentry_util.<span class="keyword">c</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>: In <span class="function"><span class="keyword">function</span> ?.<span class="title">ortSentryModeTCP</span>?.</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1187</span>: warnin<span class="variable">g:</span> pointer targets in passing <span class="keyword">argument</span> <span class="number">3</span> of ?.ccept?.differ in signedness</span><br><span class="line">./portsentry.<span class="keyword">c</span>: In <span class="function"><span class="keyword">function</span> ?.<span class="title">ortSentryModeUDP</span>?.</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1384</span>: warnin<span class="variable">g:</span> pointer targets in passing <span class="keyword">argument</span> <span class="number">6</span> of ?.ecvfrom?.differ in signedness</span><br><span class="line">./portsentry.<span class="keyword">c</span>: In <span class="function"><span class="keyword">function</span> ?.<span class="title">sage</span>?.</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1584</span>: error: missing terminating <span class="comment">&quot; character</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: ?.ourceforget?.undeclared (<span class="keyword">first</span> use in this <span class="function"><span class="keyword">function</span>)</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: (Each undeclared identifier <span class="keyword">is</span> reported <span class="keyword">only</span> once</span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: <span class="keyword">for</span> each <span class="function"><span class="keyword">function</span> <span class="title">it</span> <span class="title">appears</span> <span class="title">in</span>.)</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: expected ?.?.before ?.ot?</span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: stray ?.?.in program</span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1585</span>: error: missing terminating <span class="comment">&quot; character</span></span><br><span class="line">./portsentry.<span class="keyword">c</span>:<span class="number">1595</span>: error: expected ?.?.before ?.?.token</span><br><span class="line"><span class="keyword">make</span>: *** [linux] Error <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>我们打开portsentry.c文件,在1590行左右,我们将带有Copyright 1997-2003字样的那行调整为一行即可,<br>调整后我们再执行make linux&amp;&amp; make install后,PortSentry顺利安装成功,其安装路径为 <code>/usr/local/psionic/portsentry</code>,如下所示表示成功安装此软件:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">Edit /usr/local/psionic/portsentry/portsentry.conf and change</span><br><span class="line">your settings if you haven&#x27;t already. (route, etc)</span><br><span class="line"><span class="symbol">WARNING: </span>This version and above now use a new</span><br><span class="line">directory structure for storing the program</span><br><span class="line">and config files (/usr/local/psionic/portsentry).</span><br><span class="line">Please make sure you delete the old files when</span><br><span class="line">the testing of this install is complete.</span><br></pre></td></tr></table></figure>

<p>二、PortSentry的配置</p>
<p>1．修改配置文件portsentry.conf</p>
<p>通过PortSentry进行入侵检测,首先需要为它定制一份需要监视的端口清单,以及相应的阻止对策.然后启动后台进程对这些端口进行检测,一旦发现有人扫描这些端口,就启动相应的对策进行阻拦.</p>
<p>(1)设置端口清单</p>
<p>下面给出portsentry.conf中关于端口的默认配置情况:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">$ Un-comment these if you are really anal<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">#TCP_PORTS=&quot;<span class="number">1,7,9,11</span>,<span class="number">15,70,79,80</span>,<span class="number">109,110,111,119</span>,<span class="number">138,139,143</span>,<span class="number">512,513</span>,<span class="number">514,515</span>,<span class="number">540,636</span>,<span class="number">1080,1424</span>,<span class="number">2000,2001</span>,[..]</span><br><span class="line">#UDP_PORTS=&quot;<span class="number">1,7,9,66</span>,<span class="number">67,68,69,111</span>,<span class="number">137,138,161,162</span>,<span class="number">474,513</span>,<span class="number">517,518</span>,<span class="number">635,640</span>,<span class="number">641,666</span>,<span class="number">700,2049</span>,<span class="number">31335,27444</span>,<span class="number">34555</span>,[..]</span><br><span class="line">#Use these if you just want to be aware:</span><br><span class="line">TCP_PORTS=&quot;<span class="number">1,11,15,79</span>,<span class="number">111,119,143</span>,<span class="number">540,635</span>,<span class="number">1080,1524</span>,<span class="number">2000,5742</span>,<span class="number">6667,12345</span>,<span class="number">12346,20034</span>,<span class="number">27665,31337</span>,<span class="number">32771,32772</span>,[..]</span><br><span class="line">UDP_PORTS=&quot;<span class="number">1,7,9,69</span>,<span class="number">161,162,513</span>,<span class="number">635,640</span>,<span class="number">641,700</span>,<span class="number">37444,34555</span>,<span class="number">31335,32770</span>,<span class="number">32771,32772</span>,<span class="number">32773,32774</span>,<span class="number">31337,54321</span>&quot;</span><br><span class="line">#Use these for juse bare-bones</span><br><span class="line">#TCP_PORTS=&quot;<span class="number">1,11,15,110</span>,<span class="number">111,143,540</span>,<span class="number">635,180</span>,<span class="number">1524,2000</span>,<span class="number">12345,12346</span>,<span class="number">20034,32771</span>,<span class="number">32772,32773</span>,<span class="number">32774,49724</span>,<span class="number">54320</span>&quot;</span><br><span class="line">#UDP_PORTS=&quot;<span class="number">1,7,9,69</span>,<span class="number">161,162,513</span>,<span class="number">640,700</span>,<span class="number">32770,32771</span>,<span class="number">32772,32773</span>,<span class="number">32774,31337</span>,<span class="number">54321</span>&quot;</span><br></pre></td></tr></table></figure>

<p>可以有选择地去掉前面的注释来启用默认配置,也可以根据自己的实际情况定制一份新的清单,格式和原来的一样即可.端口列表要根据具体情况而定,假如服务器为Web服务器,那么Web端口就不需要监视.反之,如果是FTP服务器,那么监视Web端口也是有必要的.</p>
<p>(2)portsentry.conf里的相关文件</p>
<p>在portsentry.conf中自动配置了许多文件,我们看下它们有哪些用途:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#此文件记录允许合法扫描服务器的主机地址</span></span><br><span class="line"><span class="attr">IGNORE_FILE</span>=<span class="string">&quot;/usr/local/psionic/portsentry/portsentry.ignore&quot;</span></span><br><span class="line"><span class="comment">#此文件中保留了以往所有入侵主机的IP历史记录</span></span><br><span class="line"><span class="attr">HISTROY_FILE</span>=<span class="string">&quot;/usr/local/psionic/portsentry/portsentry.history&quot;</span></span><br><span class="line"><span class="comment">#此文件中是已经被阻止连接的主机IP记录</span></span><br><span class="line"><span class="attr">BLOCKED_FILE</span>=<span class="string">&quot;/usr/local/psionic/portsentry/portsentry.blocked&quot;</span></span><br></pre></td></tr></table></figure>

<p>(3)设置路由重定向</p>
<p>通过配置portsentry.conf文件,可以设置一条虚拟路由记录,把数据包重定向到一个未知的主机．使之无法获取信息.相应配置代码如下:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#Generic</span></span><br><span class="line"><span class="meta">#KILL_ROUTE=&quot;/sbin/route add $TARGET$ 333.444.555.666&quot;</span></span><br><span class="line"><span class="meta">#Generic Linux</span></span><br><span class="line">KILL_ROUTE=<span class="string">&quot;/sbin/route add -host $TARGET$ gw 333.444.555.666</span></span><br></pre></td></tr></table></figure>

<p>针对不同的平台有不同的路由命令,在配置文件中选择适台自己平台的命令即可.我的服务器是Centos5.5 x86_64,以上语法适合Linux平台的机器;PortSentry非常人性化,下面都有系统对应的配置文件,我们只需要依样操作即可.</p>
<p>(4)我们还可以利用Linux中的iptables命令,可以切断攻击主机的连接:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">KILL_ROUTE</span>=<span class="string">&quot;/usr/local/sbin/iptables -I INPUT -s $TARGET$ -j DROP&quot;</span></span><br></pre></td></tr></table></figure>

<p>也可以直接把攻击者的IP记录到/etc/hosts.deny文件中,利用TCP_Wrappers保护机制来防止攻击:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">KILL_HOSTS_DENY</span>=<span class="string">&quot;ALL:$TARGET$ # Portsentry blocked&quot;</span></span><br></pre></td></tr></table></figure>

<p>系统默认是利用TCP_Wrappers来切断与主机之间的连接.</p>
<p>(5)定制警告信息</p>
<p>我们也可以定制一条警告信息,警告攻击者.不过,手册上建议不要使用该选项,因为这样做可能会暴露主机的IDS系统.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">PORT_BANNER</span>=<span class="string">&quot;** UNAUTHORIZED ACCESS PROHIBITED *** YOUR CONNECTION ATTEMPT HAS BEEN LOGGED. GO AWAY.&quot;</span></span><br></pre></td></tr></table></figure>

<p>修改完毕后,改变文件的权限．以保证其安全性:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">600</span> <span class="regexp">/usr/</span>local<span class="regexp">/psionic/</span>portsentry/portsentry.conf</span><br></pre></td></tr></table></figure>

<p>2．配置portsentry.ignore文件</p>
<p><code>/usr/psionic/portsentry/portsentry.ignore</code>文件中设置了希望PortSentry忽略的主机IP,即允许合法扫描的主机地址下面是配置情况:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">#Put hosts in here you never want blocked,This includes the IP addresses</span><br><span class="line">#of all local interfaces on the protected host(i.e virtual host,mult-home)</span><br><span class="line">#keep <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> and <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> to keep people from playing games.</span><br><span class="line"><span class="number">127.0.0.1</span>/<span class="number">32</span></span><br><span class="line"><span class="number">0.0.0.0</span></span><br><span class="line">#Exclude all local interfaces</span><br><span class="line"><span class="number">192.168.1.103</span></span><br><span class="line"><span class="number">192.168.1.102</span></span><br><span class="line"><span class="number">127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>记得带上本机地址,以防万一.<br>修改完成后同样需要改变文件默认的权限:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">600</span> <span class="regexp">/usr/</span>local<span class="regexp">/psionic/</span>portsentry/portsentry.ignore</span><br></pre></td></tr></table></figure>

<p>三、启动检测模式</p>
<p>最后介绍一下PortSentry的启动检测模式.对应TCP和UDF两种协议方式．分别有三种启动模式,即基本、秘密和高级秘密扫描检测模式.</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line">portsentry-tcp,TCP的基本端口绑定模式;</span><br><span class="line">portsentry-udp,UDP的基本端口绑定模式;</span><br><span class="line">portsentry-stcp,TCP的秘密扫描检测模式;</span><br><span class="line">portsentry-sudp,UDP的秘密扫描检测模式;</span><br><span class="line">portsentry-atcp,TCP的高级秘密扫描检测模式;</span><br><span class="line">portsentry-audp,UDP的高级秘密扫描检测模式.</span><br></pre></td></tr></table></figure>

<p>一般情况下,建议使用秘密扫描检测模式或高级秘密扫描检测模式.<br>使用高级秘密扫描检测模式(Advanced Stealth Scan Detection Mode),PortSentry会自动检查服务器上正在运行的端口, 然后把这些端口从配置文件中移去, 只监控其它的端口.这样会加快对端口扫描的反应速度,并且只占用很少的CPU时间,这种模式非常智能,我比较喜欢用.<br>启动PortSentry的命令如下:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#<span class="regexp">/usr/</span>local<span class="regexp">/psionic/</span>portsentry/portsentry -atcp</span><br></pre></td></tr></table></figure>

<p>可以把启动命令加到 <code>/etc/rc.d/rc.local</code> 脚本文件中,果想让它和其它后台进程一样可以随时启动、停止并查看进程状态, 可以去这样当重新启动计算机的时候PortSentry就会自动运行.</p>
<p>四、测试</p>
<p>我们在192.168.1.102上启动PortSentry后,我们先暂时清掉portsentry.ignore里的文件,我们在另一台192.168.1.104的机器上启动扫描命令nmap -sS 192.168.1.102,稍等片刻我们就会发现/etc/hosts.deny里会出现ALL:192.168.1.104的字样,证明此软件配置都是生效的.<br>为了证明其有效性,我拿自己的线上的一台LVS机器布署了portsentry1.2,查看日志发现:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost portsentry_beta]# tail /var/<span class="built_in">log</span>/<span class="keyword">messages</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">07</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> TCP SYN/Normal scan from hos<span class="variable">t:</span> adsl-<span class="number">65</span>-<span class="number">9</span>-<span class="number">251</span>-<span class="number">89</span>.mia.bellsouth.net/<span class="number">65.9</span>.<span class="number">251.89</span> <span class="keyword">to</span> TCP por<span class="variable">t:</span> <span class="number">80</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">07</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> Host <span class="number">65.9</span>.<span class="number">251.89</span> <span class="built_in">has</span> been blocked via wrappers with strin<span class="variable">g:</span> <span class="string">&quot;ALL: 65.9.251.89&quot;</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">07</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> TCP SYN/Normal scan from hos<span class="variable">t:</span> adsl-<span class="number">65</span>-<span class="number">9</span>-<span class="number">251</span>-<span class="number">89</span>.mia.bellsouth.net/<span class="number">65.9</span>.<span class="number">251.89</span> <span class="keyword">to</span> TCP por<span class="variable">t:</span> <span class="number">80</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">07</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> Hos<span class="variable">t:</span> adsl-<span class="number">65</span>-<span class="number">9</span>-<span class="number">251</span>-<span class="number">89</span>.mia.bellsouth.net/<span class="number">65.9</span>.<span class="number">251.89</span> <span class="keyword">is</span> already blocked Ignoring</span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">08</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> TCP SYN/Normal scan from hos<span class="variable">t:</span> adsl-<span class="number">65</span>-<span class="number">9</span>-<span class="number">251</span>-<span class="number">89</span>.mia.bellsouth.net/<span class="number">65.9</span>.<span class="number">251.89</span> <span class="keyword">to</span> TCP por<span class="variable">t:</span> <span class="number">80</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">08</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> Hos<span class="variable">t:</span> adsl-<span class="number">65</span>-<span class="number">9</span>-<span class="number">251</span>-<span class="number">89</span>.mia.bellsouth.net/<span class="number">65.9</span>.<span class="number">251.89</span> <span class="keyword">is</span> already blocked Ignoring</span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">19</span>:<span class="number">57</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> TCP SYN/Normal scan from hos<span class="variable">t:</span> ns38534.ovh.net/<span class="number">91.121</span>.<span class="number">14.153</span> <span class="keyword">to</span> TCP por<span class="variable">t:</span> <span class="number">80</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">19</span>:<span class="number">57</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> Host <span class="number">91.121</span>.<span class="number">14.153</span> <span class="built_in">has</span> been blocked via wrappers with strin<span class="variable">g:</span> <span class="string">&quot;ALL: 91.121.14.153&quot;</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">35</span>:<span class="number">44</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> TCP SYN/Normal scan from hos<span class="variable">t:</span> <span class="number">61.156</span>.<span class="number">31.43</span>/<span class="number">61.156</span>.<span class="number">31.43</span> <span class="keyword">to</span> TCP por<span class="variable">t:</span> <span class="number">80</span></span><br><span class="line">Jun  <span class="number">6</span> <span class="number">13</span>:<span class="number">35</span>:<span class="number">44</span> localhost portsentry[<span class="number">2555</span>]: attackaler<span class="variable">t:</span> Host <span class="number">61.156</span>.<span class="number">31.43</span> <span class="built_in">has</span> been blocked via wrappers with strin<span class="variable">g:</span> <span class="string">&quot;ALL: 61.156.31.43&quot;</span></span><br></pre></td></tr></table></figure>

<p>检查了下/etc/hosts.deny,发现如下恶意IP:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALL</span>: <span class="number">113.57</span>.<span class="number">224.3</span></span><br><span class="line"><span class="keyword">ALL</span>: <span class="number">124.238</span>.<span class="number">249.246</span></span><br><span class="line"><span class="keyword">ALL</span>: <span class="number">65.9</span>.<span class="number">251.89</span></span><br><span class="line"><span class="keyword">ALL</span>: <span class="number">91.121</span>.<span class="number">14.153</span></span><br><span class="line"><span class="keyword">ALL</span>: <span class="number">61.156</span>.<span class="number">31.43</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>chattr命令详解</title>
    <url>/2014/06/08/1153/</url>
    <content><![CDATA[<p>CHATTR<br>NAME(名称)chattr - 修改文件在Linux第二扩展文件系统(E2fs)上的特有属性 SYNOPSIS(总览)chattr [ -RV ] [ -v version ] [ mode ] files… DESCRIPTION(描述)chattr 修改文件在Linux第二扩展文件系统(E2fs)上的特有属性<br>符号模式有+-=[ASacdisu]几种格式.<br>操作符’+’用来在文件已有属性的基础上增加选定的属性; ‘-‘用来去掉文件上的选定的属性;而’=’用来指定该文件的唯一属性.<br>字符’ASacdisu’用作文件新属性的选项: 不更新atime(A),同步更新(S),只能添加(a), 压缩(c),不可变(i),不可转移(d),删除保护(s)以及不可删除(u). OPTIONS(选项)<br>-R 递归地修改目录以及其下内容的属性. 如果在递归目录时遇到了符号链接,遍历将跳过. -V 详尽地给出chattr的输出信息并打印出程序的版本. -v version 设置文件系统的版本.<br>ATTRIBUTES(属性)当修改设置了’A’属性的文件时,它的atime记录不会改变. 这可以在笔记本电脑系统中避免某些磁盘I/O处理.<br>设置了’a’属性的文件只能在添加模式下打开用于写入. 只有超级用户可以设置或清除该属性.<br>设置了’c’属性的文件在磁盘上由内核自动进行压缩处理. 从该文件读取时返回的是未压缩的数据. 对该文件的一次写入会在保存它们到磁盘之前进行数据压缩.<br>设置了’d’属性的文件不能对其运行 dump(8) 程序进行备份.<br>设置了’i’属性的文件不能进行修改:你既不能删除它, 也不能给它重新命名,你不能对该文件创建链接, 而且也不能对该文件写入任何数据. 只有超级用户可以设置或清除该属性.<br>当删除设置了’s’属性的文件时,将对其数据块清零并写回到磁盘上.<br>当修改设置了’S’属性的文件时, 修改会同步写入到磁盘上;这与应用到文件子系统上的’sync’挂载选项有相同的效果.</p>
<p>当删除设置了’u’属性的文件时, 将会保存其内容. 这使得用户可以请求恢复被删除的文件.<br>BUGS AND LIMITATIONS(BUGS和局限性)对于ext2 fs 0.5a来说,’c’和’u’属性是不被内核代码所承认的. 对于Linux 2.0内核而言,’A’属性也是不被内核代码所支持的. (noatime代码仍在测试中.)</p>
]]></content>
  </entry>
  <entry>
    <title>CentOS中快速搭建ftp服务器</title>
    <url>/2013/02/02/1151/</url>
    <content><![CDATA[<p>既然强调快速, 我们就马上开始,环境是centos5安装vsftpd.</p>
<p>第一步:安装vsftpd,在终端允许:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ yum -y <span class="keyword">install</span> vsftpd</span><br></pre></td></tr></table></figure>

<p>没什么问题就直接安装好啦.</p>
<p>第二步:编辑vsftpd的配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>第三步:清空文件, 然后添加如下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">listen</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">background</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">local_umask</span>=<span class="number">022</span></span><br><span class="line"><span class="attr">anon_upload_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">anon_mkdir_write_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">dirmessage_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">xferlog_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">connect_from_port_20</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">chown_uploads</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">xferlog_file</span>=/var/log/vsftpd.log</span><br><span class="line"><span class="attr">xferlog_std_format</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">async_abor_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ascii_upload_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ascii_download_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ftpd_banner</span>=Welcome to hao32 FTP servers</span><br><span class="line"><span class="attr">pam_service_name</span>=vsftpd</span><br><span class="line"><span class="attr">chroot_local_user</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">chroot_list_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">chroot_list_file</span>=/etc/vsftpd/vsftpd.chroot_list</span><br></pre></td></tr></table></figure>

<p>第四步:终端运行下面命令:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> touch /etc/vsftpd/vsftpd.chroot_list</span><br><span class="line"><span class="variable">$</span> service vsftpd <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p>如果出现下面这句话:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Starting</span> vsftpd for vsftpd:<span class="meta"> [ OK ]</span></span><br></pre></td></tr></table></figure>

<p>则表示成功,如果不行则用这个语句:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>xinetd restart</span><br></pre></td></tr></table></figure>

<p>ftp默认我们使用系统用户, 现在我们来添加用户hao32, 指向目录 <code>/home/hao32</code>, 权限是nologin, 就是没给shell权限, 不影响ftp的.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ useradd hao32 -d <span class="regexp">/home/</span>hao32 -s <span class="regexp">/sbin/</span>nologin</span><br></pre></td></tr></table></figure>

<p>如果显示:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">useradd: warning: <span class="keyword">the</span> home <span class="built_in">directory</span> already exists.</span><br><span class="line">Not copying <span class="keyword">any</span> <span class="built_in">file</span> <span class="built_in">from</span> skel <span class="built_in">directory</span> <span class="keyword">into</span> <span class="keyword">it</span>.</span><br></pre></td></tr></table></figure>

<p>不用理会, 只是告诉你, 你指向的目录已经存在了, 这不影响.</p>
<p>设置目录及其文件的属组, 你也可以使用别的分组方式:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ chown -R hao32.hao32 <span class="regexp">/home/</span>hao32</span><br></pre></td></tr></table></figure>

<p>设置一下用户hao32的密码, 自定义啦.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>passwd hao32</span><br></pre></td></tr></table></figure>

<p>把用户hao32加到 <code>/etc/vsftpd/vsftpd.chroot_list</code>里, 这样用户就可以正常登陆并且不能跳出自己的目录.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;hao32&#x27;</span> &gt;&gt; /etc/vsftpd/vsftpd.chroot_list</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> service vsftpd restart</span></span><br></pre></td></tr></table></figure>

<p>完毕! 测试登陆吧.</p>
<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ftp主机</span>: 服务器IP地址</span><br><span class="line"><span class="attribute">ftp用户</span>: hao32</span><br><span class="line"><span class="attribute">ftp密码</span>: 你自己刚才设置的</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>centos阻挡洪水攻击</title>
    <url>/2015/05/23/1152/</url>
    <content><![CDATA[<p>缩短SYN- Timeout时间:</p>
<figure class="highlight hsp"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -p tcp –syn -m <span class="keyword">limit</span> –<span class="keyword">limit</span> <span class="number">1</span>/s -j ACCEPT</span><br><span class="line">iptables -A <span class="keyword">INPUT</span> -i eth0 -m <span class="keyword">limit</span> –<span class="keyword">limit</span> <span class="number">1</span>/sec –<span class="keyword">limit</span>-burst <span class="number">5</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>每秒 最多3个 syn 封包 进入 表达为:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -N syn-flood</span><br><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp –syn -j syn-flood</span><br><span class="line">iptables -<span class="selector-tag">A</span> syn-flood -<span class="selector-tag">p</span> tcp –syn -m limit –limit <span class="number">1</span>/s –limit-burst <span class="number">3</span> -j RETURN</span><br><span class="line">iptables -<span class="selector-tag">A</span> syn-flood -j REJECT</span><br></pre></td></tr></table></figure>

<p>设置syncookies:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.tcp_syncookies=<span class="number">1</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.tcp_max_syn_backlog=<span class="number">3072</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.tcp_synack_retries=<span class="number">0</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.tcp_syn_retries=<span class="number">0</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.conf.<span class="literal">all</span>.send_redirects=<span class="number">0</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.conf.<span class="literal">all</span>.accept_redirects=<span class="number">0</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.conf.<span class="literal">all</span>.forwarding=<span class="number">0</span></span><br><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.icmp_echo_ignore_broadcasts=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>防止PING:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sysctl</span> -w net.ipv<span class="number">4</span>.icmp_echo_ignore_all=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>拦截具体IP范围:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -A INPUT -s <span class="number">10.0.0.0</span>/<span class="number">8</span> -i eth<span class="number">0</span> -j Drop</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>comm、diff命令详解</title>
    <url>/2014/10/23/1154/</url>
    <content><![CDATA[<p>comm命令用来对两个己排序文件进行逐行比较.comm命令对两个已经排好序的文件进行比较.其中,filel和fileZ是已经排好序的文件.comm从这两个文件中读取正文行,进行比较,最后生成三列输出:仅在filel中出现的行,仅在file2中出现的行,在两个文件中都存在的行.如果文件名为”-“则表示从标准输入读取.</p>
<p>一般格式:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">comm <span class="selector-attr">[-123]</span> file1 file2</span><br></pre></td></tr></table></figure>

<p>选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-123 选项1,2和3分别表示不显示comm输出中的第一列、第二列和第三列.</span></span><br></pre></td></tr></table></figure>

<p>示例:</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">$ comm <span class="number">-12</span> <span class="name">m1</span> <span class="name">m2</span> <span class="comment">(比较文件ml和m2,并且只显示它们共有的行)</span></span><br></pre></td></tr></table></figure>

<p>diff命令比较两个文本文件,并找出它们的不同.它比comm命令完成更复杂的检查,并且不要求两个文件预先排好序.该命令逐行比较两个文件,列出它们的不同之处,并且告诉用户,为了使两个文件一致,需要修改它们的哪些行.如果两个文件完全一样,则该命令不显示任何输出.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">一般格式<span class="symbol">:diff</span> [选项] file1 file2</span><br></pre></td></tr></table></figure>

<p>该命令输出的一般形式如下:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">n1</span> <span class="selector-tag">a</span> <span class="selector-tag">n3</span>, <span class="selector-tag">n4</span> (表示把文件<span class="number">1</span>的n1行附加到文件<span class="number">2</span>的n3~n4行后,则二者相同)</span><br><span class="line"><span class="selector-tag">nl</span>,<span class="selector-tag">n2</span> <span class="selector-tag">d</span> <span class="selector-tag">n3</span> (表示删除文件<span class="number">1</span>的nl~n2行及文件<span class="number">2</span>的n3行,则二者相同)</span><br><span class="line"><span class="selector-tag">nl</span>,<span class="selector-tag">n2</span> <span class="selector-tag">cn3</span>, <span class="selector-tag">n4</span> (表示把文件l的nl~n2行改为文件<span class="number">2</span>的n3~n4行,则二者相同)</span><br><span class="line">这些行类似<span class="selector-tag">ed</span>命令把文件<span class="selector-tag">file1</span>转换成文件<span class="selector-tag">file2</span>.字母(a, d和c)之前的行号(n1,n2)是针对文件<span class="selector-tag">file1</span>的,其后面的行号(n3,n4)是针对文件<span class="selector-tag">file2</span>的.字母<span class="selector-tag">a</span>表示附加,字母<span class="selector-tag">d</span>表示删除,字母<span class="selector-tag">c</span>表示修改.</span><br></pre></td></tr></table></figure>

<p>在上述形式的每一行的后面跟随受到影响的若干行,以”&lt;”打头的行属于文件file1,以”&gt;”打头的行属于文件file2.diff命令能区分块特别文件、字符特别文件及FIFO(管道文件),不会把它们与普通文件进行比较.</p>
<p>选项:</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">b 忽略空格造成的差别.例如,<span class="string">&quot;How    are you&quot;</span>与<span class="string">&quot;How are you    &quot;</span>被看做是相同的字符串.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">c 输出格式是带上下文的三行格式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">Cn 输出格式是有上下文的n行格式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">e 输出一个合法的ed脚本.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">i 忽略字母大小写的区别.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">r 当文件file1和文件file2都是目录时,递归比较找到的各子目录.</span></span><br></pre></td></tr></table></figure>

<p>注意:如果用”一”表示文件flle1或文件file2,则意味着标准输入.如果file1或file2是目录,那么 diff将使用该目录中的同名文件进行比较.如果file1和file2都是目录,则diff会产生很多信息.如果一个目录中只有一个文件,则产生一条信息,指出该目录路径名和其中的文件名.</p>
]]></content>
  </entry>
  <entry>
    <title>configure error C++ compiler cannot create executables</title>
    <url>/2016/09/17/1156/</url>
    <content><![CDATA[<p>You don’t have a C++ compiler on there. You need to install the gcc-c++ package (while you’re at it, install gcc as well if you haven’t already). This can probably be done with apt-get, but I’m not sure how you use it.</p>
<p>解决方法:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">yum</span> <span class="comment">install</span> <span class="comment">gcc</span><span class="literal">-</span><span class="comment">c</span>++</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>compmgmt.msc打不开解决办法</title>
    <url>/2011/09/07/1155/</url>
    <content><![CDATA[<p>进入服务器的时候,右键点击”我的电脑”-“管理”的时候,出现一个对话框:MMC 不能打开文件. <code>C:/WINDOWS/system32/compmgmt.msc</code>.这可能是由于文件不存在,不是一个MMC控制台,或者用后来版本的MMC创建.也可能是由于您没有访问此文件的足够权限.”</p>
<p>下面就是它的解决办法:</p>
<p>首先检查系统中devmgmt.msc文件是否被破坏或丢失:即进入<code>C:/WINDOWS/system32</code>目录中,查看是否存在 devmgmt.msc文件,如果找不到该文件,或者点击后出现文件破坏信息,则点击”开始”菜单的”运行”,输入:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sfc <span class="string">/scannow</span></span><br></pre></td></tr></table></figure>
<p>系统会检查是否有系统文件被破坏,并修复系统文件,此过程中需要放入Windows XP安装光盘,检查完毕后重启即可;另外也可以尝试从别的相同操作系统的电脑中,拷贝出此文件放入对应目录,看看能否解决.如果还是不行,还可以尝试使用 Windows XP安装光盘修复系统.</p>
<p>由于后缀名为MSC的文件实际上是XML格式的文件,它需要msxml parser程序的编译以便系统识别,因此出现此问题时,也可以尝试重新注册一下msxml parser看是否能解决问题,方法是:在”运行”对话框中输入:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">regsvr32</span> C:/Windows/system<span class="number">32</span>/msxml<span class="number">3</span>.dll</span><br></pre></td></tr></table></figure>
<p>然后回车即可.</p>
<p>说明:Windows的system32目录下还有很多这种系统应用程序文件,例如dfrg.msc是系统自带的磁盘碎片整理工具,secpol.msc是调用系统的本地安全策略,compmgmt.msc为系统的计算机管理.如果出现类似”MMC不能打开***文件.这可能是由于文件不存在,不是一个MMC控制台……”信息,都可以使用系统自带的系统文件检查器的Windows文件保护功能检查修复.</p>
<p>注意:出现这种问题,可能是系统感染了病毒(对应错误信息:文件不存在,不是一个MMC控制台)或者木马(对应错误信息:您没有访问此文件的足够权限).建议用最新版本的杀毒软件全面检查系统,防止病毒再次破坏或删除该文件.</p>
]]></content>
  </entry>
  <entry>
    <title>configure error no acceptable cc found in $PATH</title>
    <url>/2014/08/26/1157/</url>
    <content><![CDATA[<p>出现错误:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">loading cache ./config.cache</span><br><span class="line"><span class="function"><span class="title">checking</span></span> host <span class="keyword">system</span> type... i686-pc-linux-gnu</span><br><span class="line"><span class="function"><span class="title">checking</span></span> target <span class="keyword">system</span> type... i686-pc-linux-gnu</span><br><span class="line"><span class="function"><span class="title">checking</span></span> build <span class="keyword">system</span> type... i686-pc-linux-gnu</span><br><span class="line"><span class="function"><span class="title">checking</span></span> <span class="keyword">for</span> a BSD compatible install... /usr/bin/install -c</span><br><span class="line"><span class="function"><span class="title">checking</span></span> whether ln works... <span class="keyword">yes</span></span><br><span class="line"><span class="function"><span class="title">checking</span></span> whether ln -s works... <span class="keyword">yes</span></span><br><span class="line"><span class="function"><span class="title">checking</span></span> <span class="keyword">for</span> gcc... <span class="keyword">no</span></span><br><span class="line"><span class="function"><span class="title">checking</span></span> <span class="keyword">for</span> cc... <span class="keyword">no</span></span><br><span class="line">configure: error: <span class="keyword">no</span> acceptable cc found in <span class="symbol">$</span>PATH</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>conky配置文件备份</title>
    <url>/2019/09/05/1159/</url>
    <content><![CDATA[<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">background <span class="literal">yes</span></span><br><span class="line">double_buffer <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">alignment top_right</span><br><span class="line">border_width 1</span><br><span class="line">cpu_avg_samples 2</span><br><span class="line">default_color white</span><br><span class="line">default_outline_color white</span><br><span class="line">default_shade_color white</span><br><span class="line">draw_borders <span class="literal">no</span></span><br><span class="line">draw_graph_borders <span class="literal">yes</span></span><br><span class="line">draw_outline <span class="literal">no</span></span><br><span class="line">draw_shades <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">gap_x 0</span><br><span class="line">gap_y 0</span><br><span class="line">net_avg_samples 2</span><br><span class="line">no_buffers <span class="literal">yes</span></span><br><span class="line">out_to_console <span class="literal">no</span></span><br><span class="line">out_to_stderr <span class="literal">no</span></span><br><span class="line">extra_newline <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">own_window <span class="literal">yes</span></span><br><span class="line">own_window_type normal</span><br><span class="line">own_window_transparent <span class="literal">yes</span></span><br><span class="line">own_window_colour 000000</span><br><span class="line">own_window_argb_visual <span class="literal">yes</span></span><br><span class="line">own_window_argb_value 0</span><br><span class="line">own_window_hints undecorated,below,sticky,skip_taskbar,skip_pager</span><br><span class="line"></span><br><span class="line">minimum_size 200 0</span><br><span class="line">stippled_borders 0</span><br><span class="line">update_interval 2.0</span><br><span class="line">uppercase <span class="literal">no</span></span><br><span class="line">use_spacer none</span><br><span class="line"></span><br><span class="line">use_xft <span class="literal">yes</span></span><br><span class="line">xftalpha 0.1</span><br><span class="line">xftfont  Technical CE:<span class="attribute">size</span>=10</span><br><span class="line">color0 white</span><br><span class="line">color1 EAEAEA</span><br><span class="line">color2 06FF1C</span><br><span class="line">color3 D9DFDA</span><br><span class="line">color4 0478FF   </span><br><span class="line">color5 A40810</span><br><span class="line"></span><br><span class="line">TEXT</span><br><span class="line"><span class="variable">$&#123;image ~/.conky/logo-arch.png -p 60 60&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#systemlab</span></span><br><span class="line"><span class="variable">$&#123;voffset 15&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>SYSTEM<span class="variable">$&#123;hr 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span></span><br><span class="line">OS: <span class="variable">$&#123;execi 10800 cat /etc/issue.net2&#125;</span></span><br><span class="line">Kernel: <span class="variable">$&#123;kernel&#125;</span></span><br><span class="line">Hostname: <span class="variable">$&#123;nodename&#125;</span></span><br><span class="line">Uptime: <span class="variable">$&#123;uptime&#125;</span></span><br><span class="line">Processes: <span class="variable">$&#123;processes&#125;</span> (<span class="variable">$running_processes</span> running)</span><br><span class="line">Updates: <span class="variable">$&#123;execi 360 aptitude search &quot;~U&quot; | wc -l | tail&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>DISCS <span class="variable">$&#123;hr 3&#125;</span><span class="variable">$&#123;font&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset 5&#125;</span><span class="variable">$&#123;goto 80&#125;</span>FREE:<span class="variable">$&#123;goto 150&#125;</span>TOTAL:<span class="variable">$&#123;color1&#125;</span><span class="variable">$&#123;voffset 5&#125;</span></span><br><span class="line">Home<span class="variable">$&#123;goto 80&#125;</span><span class="variable">$&#123;fs_free /home&#125;</span><span class="variable">$&#123;goto 150&#125;</span><span class="variable">$&#123;fs_size /home&#125;</span></span><br><span class="line">Root<span class="variable">$&#123;goto 80&#125;</span><span class="variable">$&#123;fs_free /&#125;</span><span class="variable">$&#123;goto 150&#125;</span><span class="variable">$&#123;fs_size /&#125;</span></span><br><span class="line">EX2<span class="variable">$&#123;goto 80&#125;</span><span class="variable">$&#123;fs_free /mnt/EX2&#125;</span><span class="variable">$&#123;goto 150&#125;</span><span class="variable">$&#123;fs_size /mnt/EX2&#125;</span></span><br><span class="line">EX2home<span class="variable">$&#123;goto 80&#125;</span><span class="variable">$&#123;fs_free /mnt/EX2home&#125;</span><span class="variable">$&#123;goto 150&#125;</span><span class="variable">$&#123;fs_size /mnt/EX2home&#125;</span></span><br><span class="line">Storage<span class="variable">$&#123;goto 80&#125;</span><span class="variable">$&#123;fs_free /media/Storage&#125;</span><span class="variable">$&#123;goto 150&#125;</span><span class="variable">$&#123;fs_size /media/Storage&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#processlab</span></span><br><span class="line"><span class="variable">$&#123;voffset -30&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>CPU PROCESSES <span class="variable">$&#123;hr 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>CPU 0<span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;cpu cpu0&#125;</span> %<span class="variable">$&#123;color5&#125;</span></span><br><span class="line"><span class="variable">$&#123;cpubar cpu0&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -18&#125;</span><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;execbar echo 0&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>CPU 1<span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;cpu cpu1&#125;</span> %<span class="variable">$&#123;color5&#125;</span></span><br><span class="line"><span class="variable">$&#123;cpubar cpu1&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -18&#125;</span><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;execbar echo 0&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>CPU 2<span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;cpu cpu2&#125;</span> %<span class="variable">$&#123;color5&#125;</span></span><br><span class="line"><span class="variable">$&#123;cpubar cpu2&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -18&#125;</span><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;execbar echo 0&#125;</span><span class="variable">$&#123;color2&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>CPU 3<span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;cpu cpu3&#125;</span> %<span class="variable">$&#123;color5&#125;</span></span><br><span class="line"><span class="variable">$&#123;cpubar cpu3&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -18&#125;</span><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;execbar echo 0&#125;</span></span><br><span class="line"><span class="variable">$&#123;top name 1&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top cpu 1&#125;</span> %</span><br><span class="line"><span class="variable">$&#123;top name 2&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top cpu 2&#125;</span> %</span><br><span class="line"><span class="variable">$&#123;top name 3&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top cpu 3&#125;</span> %</span><br><span class="line"><span class="variable">$&#123;top name 4&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top cpu 4&#125;</span> %</span><br><span class="line"><span class="variable">$&#123;top name 5&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top cpu 5&#125;</span> %</span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span><span class="variable">$&#123;color4&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>RAM <span class="variable">$&#123;hr 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span></span><br><span class="line"><span class="variable">$&#123;membar&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -18&#125;</span><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;execbar echo 0&#125;</span></span><br><span class="line"><span class="variable">$&#123;top_mem name 1&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top_mem mem_res 1&#125;</span></span><br><span class="line"><span class="variable">$&#123;top_mem name 2&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top_mem mem_res 2&#125;</span></span><br><span class="line"><span class="variable">$&#123;top_mem name 3&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top_mem mem_res 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;top_mem name 4&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top_mem mem_res 4&#125;</span></span><br><span class="line"><span class="variable">$&#123;top_mem name 5&#125;</span> <span class="variable">$alignr</span> <span class="variable">$&#123;top_mem mem_res 5&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span></span><br><span class="line">totalmem<span class="variable">$&#123;color4&#125;</span><span class="variable">$alignr</span><span class="variable">$&#123;mem&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#networklab</span></span><br><span class="line"><span class="comment"># Change the network interface from bond0 to whatever your system calls it</span></span><br><span class="line"><span class="comment"># It could be enp2s0, eth0, eth1, ppp0, ppp1, etc.</span></span><br><span class="line"><span class="variable">$&#123;voffset -30&#125;</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>NETWORK <span class="variable">$&#123;hr 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;voffset -10&#125;</span></span><br><span class="line"><span class="variable">$&#123;color2&#125;</span>DOWNLOAD SPEED<span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;downspeed wlx30b49e4dab86&#125;</span></span><br><span class="line"><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;downspeedgraph wlx30b49e4dab86 50,200 06FF1C 06FF1C s&#125;</span><span class="variable">$&#123;voffset -8&#125;</span></span><br><span class="line"><span class="variable">$&#123;color5&#125;</span>UPLOAD SPEED <span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;alignr&#125;</span><span class="variable">$&#123;upspeed wlx30b49e4dab86&#125;</span></span><br><span class="line"><span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;upspeedgraph wlx30b49e4dab86 50,200 A40810 A40810 s&#125;</span><span class="variable">$&#123;color2&#125;</span><span class="variable">$&#123;voffset -8&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#temperaturelab</span></span><br><span class="line"><span class="variable">$&#123;color4&#125;</span>TEMPERATURE <span class="variable">$&#123;hr 3&#125;</span></span><br><span class="line"><span class="variable">$&#123;color0&#125;</span>CPU:   <span class="variable">$&#123;color0&#125;</span><span class="variable">$&#123;exec sensors -A | grep 1|grep &#x27;high&#x27;| awk -F&#x27;+&#x27; &#x27;&#123;print $2&#125;</span><span class="string">&#x27; | awk -F&#x27;</span>.<span class="string">&#x27; &#x27;</span>&#123;<span class="builtin-name">print</span> <span class="variable">$1</span>&#125;<span class="string">&#x27;&#125; °C $&#123;color0&#125;$&#123;alignr&#125;GPU:   $&#123;color0&#125;$&#123;exec sensors -A | grep 1|grep &#x27;</span>crit<span class="string">&#x27;| awk -F&#x27;</span>+<span class="string">&#x27; &#x27;</span>&#123;<span class="builtin-name">print</span> <span class="variable">$2</span>&#125;<span class="string">&#x27; | awk -F&#x27;</span>.<span class="string">&#x27; &#x27;</span>&#123;<span class="builtin-name">print</span> <span class="variable">$1</span>&#125;<span class="string">&#x27;&#125; °C</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Could not get the storage format of the medium</title>
    <url>/2017/06/02/1160/</url>
    <content><![CDATA[<p>virtualbox出现上述错误,原因一半是下载的系统压缩包有问题,重新下载一个试试就知道了.</p>
]]></content>
  </entry>
  <entry>
    <title>configure时出现C preprocessor libcpp fails sanity check</title>
    <url>/2013/10/31/1158/</url>
    <content><![CDATA[<p>安装ruby ./configure时出现错误:</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="built_in">C</span> <span class="variable">preprocessor</span> <span class="string">&quot;/lib/cpp&quot;</span> <span class="variable">fails</span> <span class="variable">sanity</span> <span class="variable">check</span></span><br></pre></td></tr></table></figure>

<p>原因:<br>缺少包安装linux-kernel-headers.</p>
<p>解决:<br>有桌面系统进入yast2 搜索linux-kernel-headers安装.<br>没有桌面系统去<a href="http://rpm.pbone.net/%E6%90%9C%E7%B4%A2%E4%B8%8B%E8%BD%BDrpm%E5%AE%89%E8%A3%85">http://rpm.pbone.net/搜索下载rpm安装</a>.<br>下载地址:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> ftp://ftp.pbone.net/mirror/ftp.opensuse.org/distribution/<span class="number">11</span>.<span class="number">2</span>/repo/oss/suse/noarch/linux-kernel-headers-<span class="number">2</span>.<span class="number">6</span>.<span class="number">31</span>-<span class="number">3</span>.<span class="number">4</span>.noarch.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh linux-kernel-headers-<span class="number">2</span>.<span class="number">6</span>.<span class="number">31</span>-<span class="number">3</span>.<span class="number">4</span>.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>成功安装.</p>
]]></content>
  </entry>
  <entry>
    <title>Could not reliably determine the server&#39;s fully qualified domain name, using 127.0.0.1 for ServerName</title>
    <url>/2012/11/05/1161/</url>
    <content><![CDATA[<p>在 <code>httpd.conf</code> 第一行添加:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">ServerName</span></span> localhost:<span class="number">82</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>cp omitting directory 的解决办法</title>
    <url>/2019/01/24/1162/</url>
    <content><![CDATA[<p>linux下面执行cp命令时提示如下信息:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">cp:</span> omitting directory</span><br></pre></td></tr></table></figure>
<p>可以用下面的办法来解决:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cp</span> -r orginal_file new_file</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Curl development headers with SSL support... not found.</title>
    <url>/2011/04/19/1163/</url>
    <content><![CDATA[<p>I’m trying to install phusion passenger nginx module, but it fails:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">passenger-install-nginx-<span class="keyword">module</span></span><br></pre></td></tr></table></figure>

<p>error:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line">* <span class="type">Curl</span> development headers with <span class="type">SSL</span> sup<span class="keyword">port</span>... not found</span><br></pre></td></tr></table></figure>

<p>The installer is hiding useful error messages. I was getting the same error on CentOS 5.3 with curl and curl-devel 7.15.5 installed.<br>I solved this problem by installing:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install zlib-devel e<span class="number">2</span>fsprogs-devel krb<span class="number">5</span>-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Curl development headers with SSL support... not found</title>
    <url>/2014/03/10/1164/</url>
    <content><![CDATA[<p>I’m trying to install phusion passenger nginx module, but it fails:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="type">Curl</span> development headers with <span class="type">SSL</span> sup<span class="keyword">port</span>... not found</span><br></pre></td></tr></table></figure>
<p>I solved this problem by installing:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install zlib-devel e<span class="number">2</span>fsprogs-devel krb<span class="number">5</span>-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>debian系统的美国VPS推荐系统源</title>
    <url>/2011/04/22/1166/</url>
    <content><![CDATA[<p>站长最近折腾debain系统,这里备份一下找到的最快的源,这个是美国VPS用的,国内的直接163吧,用这个估计会哭～</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">deb http:<span class="regexp">//mi</span>rror.peer1.net<span class="regexp">/debian/</span> stable main <span class="comment">#contrib non-free</span></span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rror.peer1.net<span class="regexp">/debian/</span> stable main <span class="comment">#contrib non-free</span></span><br><span class="line">deb http:<span class="regexp">//</span>security.debian.org<span class="regexp">/ stable/u</span>pdates main</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>ddos解决办法</title>
    <url>/2011/09/16/1165/</url>
    <content><![CDATA[<p>1)统计80端口连接数:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -nat|<span class="type">grep</span> -i <span class="string">&quot;80&quot;</span>|<span class="type">wc</span> -l</span><br></pre></td></tr></table></figure>

<p>2)统计httpd协议连接数:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">ps -ef|<span class="type">grep</span> httpd|<span class="type">wc</span> -l</span><br></pre></td></tr></table></figure>

<p>3)统计已连接上的,状态为”established:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -na|<span class="type">grep</span> ESTABLISHED|<span class="type">wc</span> -l</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>查看连接数最多的ip:</p>
<p>netstat -anlp|grep 80|grep tcp|awk ‘{print $5}’|awk -F: ‘{print $1}’|sort|uniq -c|sort -nr|head -n20 | netstat -ant |awk ‘/:80/{split($5,ip,”:”);++A[ip[1]]}END{for(i in A) print A[i],i}’ |sort -rn|head -n20</p>
</li>
</ol>
<p>5)开始封禁IP,具体可以看我下面运行的命令.本文主要是采用iptables进行封禁:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">174.127.94.0</span>/<span class="number">16</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>6)查看连接数最多的ip:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -ntu | <span class="type">awk</span> &#x27;&#123;print $<span class="number">5</span>&#125;&#x27; | <span class="type">cut</span> -d: -f1 | <span class="type">sort</span> | <span class="type">uniq</span> -c | <span class="type">sort</span> -n</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Discuz论坛头像保存过程中发生网络错误,请重试</title>
    <url>/2012/03/20/1167/</url>
    <content><![CDATA[<p>运行命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod -R <span class="number">777</span> <span class="regexp">/var/</span>www<span class="regexp">/html/</span>htdocs<span class="regexp">/dovao_bbs/u</span>center/upload</span><br></pre></td></tr></table></figure>
<p>完美解决.</p>
]]></content>
  </entry>
  <entry>
    <title>docker更换国内源</title>
    <url>/2019/05/28/1168/</url>
    <content><![CDATA[<p>从网上找了几个速度比较快的镜像地址:</p>
<p>Docker 官方中国区:<br><a href="https://registry.docker-cn.com/">https://registry.docker-cn.com</a><br>网易:<br><a href="http://hub-mirror.c.163.com/">http://hub-mirror.c.163.com</a><br>ustc:<br><a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn</a></p>
<p>修改方法:</p>
<p>直接设置 –registry-mirror 参数,仅对当前的命令有效:<br>docker run hello-world –registry-mirror=<a href="https://docker.mirrors.ustc.edu.cn/">https://docker.mirrors.ustc.edu.cn</a></p>
<p>修改 <code>/etc/default/docker</code>,加入 DOCKER_OPTS=”镜像地址”,可以有多个:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DOCKER_OPTS</span>=<span class="string">&quot;--registry-mirror=https://docker.mirrors.ustc.edu.cn&quot;</span></span><br></pre></td></tr></table></figure>

<p>支持 systemctl 的系统,通过:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo systemctl <span class="builtin-name">edit</span> docker.service</span><br></pre></td></tr></table></figure>

<p>会生成:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>docker.service.d/override.conf</span><br></pre></td></tr></table></figure>

<p>覆盖默认的参数,在该文件中加入如下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Service]</span> </span><br><span class="line"><span class="attr">ExecStart</span>= </span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/docker -d -H fd:// --registry-mirror=https://docker.mirrors.ustc.edu.cn</span><br></pre></td></tr></table></figure>

<p>新版的 Docker 推荐使用 json 配置文件的方式,默认为 <code>/etc/docker/daemon.json</code>,非默认路径需要修改 dockerd 的 –config-file,在该文件中加入如下内容:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123; </span><br><span class="line"><span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ecshop常见错误的处理方法</title>
    <url>/2011/05/06/1171/</url>
    <content><![CDATA[<p>1、安装第二步提示:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">gd_<span class="keyword">version</span><span class="params">()</span> <span class="comment"># 相关的错误</span></span><br></pre></td></tr></table></figure>

<p>解决方法:把ecshp安装目录下的 <code>/upload/install/includes/lib_installer.php</code>中第31行:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">return cls_image::<span class="built_in">gd_version</span>();</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> cls_image();</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$p</span>-&gt;gd_version();</span><br></pre></td></tr></table></figure>

<p>2、首页出现错误:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">Only variables should be passed by reference in F:<span class="symbol">\w</span>amp<span class="symbol">\w</span>ww<span class="symbol">\E</span>CShop<span class="symbol">\u</span>pload<span class="symbol">\i</span>ncludes<span class="symbol">\c</span>ls_template.php on line 422</span><br></pre></td></tr></table></figure>

<p>解决方法:按提示的路径找到/upload/includes/cls_tmplate.php中的第422行:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">$tag_sel = <span class="built_in">array</span><span class="constructor">_shift(<span class="params">explode</span>(&#x27; &#x27;, $<span class="params">tag</span>)</span>);</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$tag</span>_arr = explode(<span class="string">&#x27; &#x27;</span>, <span class="symbol">$tag</span>);</span><br><span class="line"><span class="symbol">$tag</span>_sel = array_shift(<span class="symbol">$tag</span>_arr);</span><br></pre></td></tr></table></figure>

<p>然后删掉ecshp安装目录下的/tmp/cache下的所有缓存文件.</p>
<p>3、后台首页出现:</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">Non-<span class="keyword">static</span> <span class="function"><span class="keyword">method</span> <span class="title">cls_image</span>:</span>:gd_version() should <span class="keyword">not</span> be called statically <span class="keyword">in</span> F:\wamp\www\ECShop\upload\includes\lib_base.php <span class="keyword">on</span> line <span class="number">346</span></span><br></pre></td></tr></table></figure>

<p>解决方法:找到ecshop安装目录下的 <code>/upload/includes/cls_image.php</code> 中第678行:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">gd_version</span>();</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">gd_version</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>4、安装后首页出现:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">Strict standards: Only variables should be passed by reference in F:<span class="symbol">\w</span>amp<span class="symbol">\w</span>ww<span class="symbol">\E</span>CShop<span class="symbol">\u</span>pload<span class="symbol">\i</span>ncludes<span class="symbol">\l</span>ib_main.php on line 1329</span><br></pre></td></tr></table></figure>

<p>解决方法:找到ecshop安装目录下的 <code>/upload/includes/lib_main.php</code> 中第1329行:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ext</span> = <span class="keyword">end</span>(explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$tmp</span>));</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ext</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"><span class="variable">$ext</span> = <span class="keyword">end</span>(<span class="variable">$ext</span>);</span><br></pre></td></tr></table></figure>

<p>5、后台出现:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">mktime() <span class="meta"># 相关错误</span></span><br></pre></td></tr></table></figure>

<p>解决方法:找到提示的行,把mktime()改为time().</p>
<p>6、后台出现:</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">Redefining already defined <span class="function"><span class="keyword">constructor</span> <span class="title">for</span> <span class="title">class</span> <span class="title">alipay</span> <span class="title">in</span> <span class="title">F</span>:</span>\wamp\www\ECShop\uploades\modules\payment\alipay.php <span class="keyword">on</span> line <span class="number">85</span></span><br></pre></td></tr></table></figure>

<p>解决方法:找到提示的行,在alipay这个类中加入:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tenpayc2c</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>再把alipay这个类中:</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">functions __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;alipay();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">functions __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;tenpayc2c();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>7、后台支付方式管理页面出现:</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Strict</span> standards: Redefining already defined <span class="function"><span class="keyword">constructor</span> <span class="title">for</span> <span class="title">class</span> <span class="title">post</span></span></span><br></pre></td></tr></table></figure>

<p>提示,意思是重新定义了函数,这是因为类中与类同名的函数和构造函数冲突的问题造成的,<br>解决方法:找到提示的文件,在那个类中,那与类名同名的函数注释掉就可以了.</p>
<p>8、后台站点地图页面出现:</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Deprecated</span>: Assigning the return value <span class="keyword">of</span> <span class="keyword">new</span> <span class="keyword">by</span> <span class="keyword">reference</span> <span class="keyword">is</span> <span class="keyword">deprecated</span></span><br></pre></td></tr></table></figure>

<p>解决方法:找到相应的行,去掉等号后面的&amp;即可.</p>
<p>9、后台会员整合中出现:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">Strict standards: Declaration of ucenter<span class="number">::</span>set_cookie() should be compatible withintegrat<span class="number">e::</span>set_cookie</span><br></pre></td></tr></table></figure>

<p>意思是这个文件中的函数的参数和integrate.php中的相同函数的参数个数不一样,一般是少了一个$remember参数.<br>解决方法:找到出错的文件中出错的函数,然后打开相同目录下的integrate.php文件,找到相应的函数,把缺少的参数直接复制过来.</p>
<p>10、数据库备份页面出现:</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Strict</span> standards: Non-<span class="keyword">static</span> <span class="function"><span class="keyword">method</span> <span class="title">cls_sql_dump</span>:</span>:get_random_name() should <span class="keyword">not</span> becalled statically <span class="keyword">in</span> F:\wamp\www\ECShop\upload\admin\database.php <span class="keyword">on</span> line <span class="number">64</span></span><br></pre></td></tr></table></figure>

<p>解决方法:打开 <code>/ecshop/upload/admin/includes/cls_sql_dump.php</code>:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_name</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_random_name</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>eAccelerator 配置参数详解</title>
    <url>/2014/01/11/1169/</url>
    <content><![CDATA[<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.shm_size</span>=<span class="string">&quot;32&quot;</span></span><br></pre></td></tr></table></figure>

<p>eAccelerator 可以使用的共享内存的数量 (以兆为单位) . “0” 是指操作系统的默认值. 默认值是 “0”.可根据服务器的实际情况来调整,16,32,64,128都是可以的.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.cache_dir</span>=<span class="string">&quot;/home/php/tmp&quot;</span></span><br></pre></td></tr></table></figure>

<p>这个目录是给磁盘缓存使用. eAccelerator 在这里储存预先编译好的代码, 进程数据, 内容以及用户的自定义内容. 同样的数据也能被储存在共享内存中 (这样可以提高访问速度). 默认的设置是 “/tmp/eaccelerator”.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.enable</span>=<span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>开启或关闭 eAccelerator.”1” 为开启,”0” 为关闭.默认值为 “1”.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.optimizer</span>=<span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>启或关闭内部优化器,可以提升代码执行速度.”1” 为开启,”0” 为关闭.默认值为 “1”.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.check_mtime</span>=<span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>打开或者关闭 PHP 的文件修改检查. “1” 是指打开, “0” 是指关闭. 如果您在修改以后重新编译 PHP 的文件,那么您应当设置为 “1”. 默认值是 “1”.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.debug</span>=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<p>开启或关闭调试日志记录.”1” 为开启,”0” 为关闭.默认值为 “0”.会将缓存命中得记录写入日志.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.filter</span>=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>判断哪些 PHP 文件必须缓存.您可以指定缓存和不缓存的文件类型(如 “*.php *.phtml”等)<br>如果参数以 “!” 开头,则匹配这些参数的文件被忽略缓存.默认值为 “”,即,所有 PHP 文件都将被缓存.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.shm_max</span>=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<p>当使用 “ eaccelerator_put() “ 函数时禁止其向共享内存中存储过大的文件.该参数指定允许存储的最大值,单位:字节 (10240, 10K, 1M).”0” 为不限制.默认值为 “0”.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.shm_ttl</span>=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<p>当 eAccelerator 获取新脚本的共享内存大小失败时,它将从共享内存中删除所有在最后 “shm_ttl” 秒内没有存取的脚本缓存.默认值为 “0”,即:不从共享内春中删除任何缓存文件.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.shm_prune_period</span>=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<p>当 eAccelerator 获取新脚本的共享内存大小失败时,他将试图从共享内存中删除早于”shm_prune_period” 秒的缓存脚本.默认值为 “0”,即:不从共享内春中删除任何缓存文件.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.shm_only</span>=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>

<p>允许或禁止将已编译脚本缓存在磁盘上.该选项对 session 数据和内容缓存无效.默认值为 “0”,即:使用磁盘和共享内存进行缓存.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.compress</span>=<span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>允许或禁止压缩内容缓存.默认值为 “1”,即:允许压缩.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.compress_level</span>=<span class="string">&quot;9&quot;</span></span><br></pre></td></tr></table></figure>

<p>指定内容缓存的压缩等级.默认值为 “9”,为最高等级.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">eaccelerator.keys</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.session</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.content</span> = <span class="string">&quot;disk_only&quot;</span></span><br></pre></td></tr></table></figure>

<p>设置内容缓存的存放的地方,可以设置为:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shm_and_disk </span>在共享缓存和硬盘(默认值)</span><br><span class="line"><span class="keyword">shm默认存在共享内存,如果共享内存已满或大小超过 </span><span class="string">&quot;eaccelerator.shm_max&quot;</span> 的值,就存到硬盘</span><br><span class="line"><span class="keyword">shm_only只存放在共享内存</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">disk_only只存放在硬盘</span></span><br><span class="line"><span class="keyword"></span>none不缓存数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eaccelerator.allowed_admin_path = <span class="string">&quot;/var/www/html/21andy.com/eaccelerator&quot;</span></span><br></pre></td></tr></table></figure>

<p>这是控制面板的地址.<br>安装包里有个control.php,你把它复制到网站的任意目录,可以用它查看和管理,这个必须指定,否则查看缓存内容的时候会出错.</p>
<p>最后,来看一下我的 eAccelerator 设置:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">; eaccelerator</span></span><br><span class="line"><span class="section">[eaccelerator]</span></span><br><span class="line"><span class="attr">zend_extension</span>=<span class="string">&quot;/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/eaccelerator.so&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_size</span>=<span class="string">&quot;128&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.cache_dir</span>=<span class="string">&quot;/tmp/eaccelerator&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.enable</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.optimizer</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.check_mtime</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.debug</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.filter</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_max</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_ttl</span>=<span class="string">&quot;3600&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_prune_period</span>=<span class="string">&quot;3600&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_only</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress_level</span>=<span class="string">&quot;9&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.keys</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.sessions</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.content</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.allowed_admin_path</span> = <span class="string">&quot;/var/www/html/21andy.com/eaccelerator&quot;</span></span><br></pre></td></tr></table></figure>

<p>另外,再说下 eAccelerator 的安装:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ wget http:<span class="regexp">//</span>bart.eaccelerator.net<span class="regexp">/source/</span><span class="number">0.9</span>.<span class="number">6</span>/eaccelerator-<span class="number">0.9</span>.<span class="number">6</span>.tar.bz2</span><br><span class="line">$ tar -jxvf eaccelerator-<span class="number">0.9</span>.<span class="number">6</span>.tar.bz2</span><br><span class="line">$ cd eaccelerator-<span class="number">0.9</span>.<span class="number">6</span></span><br><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin/phpize</span><br><span class="line">$ .<span class="regexp">/configure --enable-eaccelerator=shared --with-php-config=/u</span>sr<span class="regexp">/local/</span>php<span class="regexp">/bin/</span>php-config</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>epel源错误</title>
    <url>/2015/05/22/1172/</url>
    <content><![CDATA[<p>今天在测试环境使用yum安装,遇到一个问题:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Error: </span>Cannot retrieve metalink for repository: epel. Please verify its path and try again</span><br></pre></td></tr></table></figure>

<p>处理很简单,修改文件 <code>/etc/yum.repos.d/epel.repo</code>, 将baseurl的注释取消, mirrorlist注释掉.即可.</p>
]]></content>
  </entry>
  <entry>
    <title>error macro free_alloca requires 2 arguments, but only 1 given</title>
    <url>/2019/04/30/1174/</url>
    <content><![CDATA[<p>php版本和eaccelerator版本不兼容,</p>
<p>换5.2.*的php,或换用v0.9.6.1的eaccelerator.</p>
]]></content>
  </entry>
  <entry>
    <title>echo命令知多少</title>
    <url>/2013/06/15/1170/</url>
    <content><![CDATA[<p>echo 是一个非常简单、直接的命令:<br>将 argument 送出至标准输出(STDOUT),通常就是在监视器(monitor)上输出.<br>为了更好理解,不如先让我们先跑一下 echo 命令好了:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span></span></span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>

<p>你会发现只有一个空白行,然后又回到 shell prompt 上了. 这是因为 echo 在预设上,在显示完 argument 之后,还会送出一个换行符号(new-line charactor).但是上面的 command 并没任何的 argument ,那结果就只剩一个换行符号了…<br>若你要取消这个换行符号,可利用 echo 的 -n option :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> -n</span></span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>

<p>不妨让我们回到 command line 的概念上来讨论上例的 echo 命令好了:<br>command line 只有 command_name(echo) 及 option(-n),并没有任何 argument .<br>要想看看 echo 的 argument ,那还不简单﹗接下来,你可试试如下的输入:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">echo</span> <span class="keyword">first</span> <span class="built_in">line</span></span><br><span class="line"><span class="keyword">first</span> <span class="built_in">line</span></span><br><span class="line">$ <span class="keyword">echo</span> -n <span class="keyword">first</span> <span class="built_in">line</span></span><br><span class="line"><span class="keyword">first</span> <span class="built_in">line</span> $</span><br></pre></td></tr></table></figure>

<p>从上两个 echo 命令中,你会发现 argument 的部份显示在你的荧幕,而换行符号则视 -n option 的有无而别. 很明显的,第二个 echo 由于换行符号被取消了,接下来的 shell prompt 就接在输出结果同一行了…<br>事实上,echo 除了 -n options 之外,常用选项还有:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-e :启用反斜线控制字符的转换(参考下表)</span></span><br><span class="line"><span class="deletion">-E:关闭反斜线控制字符的转换(预设如此)</span></span><br><span class="line"><span class="deletion">-n :取消行末之换行符号(与 -e 选项下的 c 字符同意)</span></span><br></pre></td></tr></table></figure>

<p>关于 echo 命令所支持的反斜线控制字符如下表:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">a:</span>ALERT / BELL (从系统喇叭送出铃声)</span><br><span class="line"><span class="symbol">b:</span>BACKSPACE ,也就是向左删除键</span><br><span class="line"><span class="symbol">c:</span>取消行末之换行符号</span><br><span class="line"><span class="symbol">E:</span>ESCAPE,跳脱键</span><br><span class="line"><span class="symbol">f:</span>FORMFEED,换页字符</span><br><span class="line"><span class="symbol">n:</span>NEWLINE,换行字符</span><br><span class="line"><span class="symbol">r:</span><span class="keyword">RETURN</span>,回车键</span><br><span class="line"><span class="symbol">t:</span>TAB,表格跳位键</span><br><span class="line"><span class="symbol">v:</span>VERTICAL TAB,垂直表格跳位键</span><br><span class="line"><span class="symbol">n:</span>ASCII 八进位编码(以 x 开首为十六进制) :反斜线本身</span><br><span class="line"></span><br><span class="line">(表格资料来自 O<span class="comment">&#x27;Reilly 出版社之 Learning the Bash Shell, 2nd Ed.)</span></span><br></pre></td></tr></table></figure>

<p>或许,我们可以透过实例来了解 echo 的选项及控制字符:</p>
<p>例一:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> -e <span class="string">&quot;atbtcndtetf&quot;</span></span></span><br><span class="line">a       b       c</span><br><span class="line">d       e       f</span><br></pre></td></tr></table></figure>

<p>上例运用 t 来区隔 abc 还有 def ,及用n 将 def 换至下一行.</p>
<p>例二:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">$ echo -e &quot;<span class="symbol">\1</span>41<span class="symbol">\0</span>11<span class="symbol">\1</span>42<span class="symbol">\0</span>11<span class="symbol">\1</span>43<span class="symbol">\0</span>12<span class="symbol">\1</span>44<span class="symbol">\0</span>11<span class="symbol">\1</span>45<span class="symbol">\0</span>11<span class="symbol">\1</span>46&quot;</span><br><span class="line">a       b       c</span><br><span class="line">d       e       f</span><br></pre></td></tr></table></figure>

<p>与例一的结果一样,只是使用 ASCII 八进位编码.</p>
<p>例三:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> -e <span class="string">&quot;x61x09x62x09x63x0ax64x09x65x09x66&quot;</span></span></span><br><span class="line">a       b       c</span><br><span class="line">d       e       f</span><br></pre></td></tr></table></figure>

<p>与例二差不多,只是这次换用 ASCII 十六进制编码.</p>
<p>例四:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> echo -<span class="keyword">ne</span> <span class="string">&quot;atbtcndtebfa&quot;</span></span><br><span class="line">a       b       c</span><br><span class="line">d       f <span class="symbol">$</span></span><br></pre></td></tr></table></figure>

<p>因为 e 字母后面是删除键(b),因此输出结果就没有 e 了. 在结束时听到一声铃向,那是 a 的杰作﹗ 由于同时使用了 -n 选项,因此 shell prompt 紧接在第二行之后. 若你不用 -n 的话,那你在 a 后再加个 c ,也是同样的效果.<br>事实上,在日后的 shell 操作及 shell script 设计上,echo 命令是最常被使用的命令之一. 比方说,用 echo 来检查变量值:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> A=B</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$A</span></span></span><br><span class="line">B</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>(注:关于变量概念,我们留到下两章才跟大家说明.)<br>好了,更多的关于 command line 的格式,以及 echo 命令的选项,就请您自行多加练习、运用了…</p>
]]></content>
  </entry>
  <entry>
    <title>Error Connection activation failed Device not managed by NetworkManager</title>
    <url>/2011/01/25/1173/</url>
    <content><![CDATA[<p>在虚拟机中,启动eth0 网卡时报错:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Error: </span>Connection activation failed: Device not managed by NetworkManager</span><br></pre></td></tr></table></figure>

<p>于是在网上找了解决方法:<br>Remove Network Manager from startup Services.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> NetworkManager <span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>Add Default Net Manager.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> network <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>Stop NetworkManager first.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">service NetworkManager stop</span><br></pre></td></tr></table></figure>

<p>and then start Default Manager.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service network <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>or you can change it easy:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">system-config-network</span><br></pre></td></tr></table></figure>

<p>uncheck the box that sets the eth0 as managed by NetworkManager and set IP info from there.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">system-config-services</span><br></pre></td></tr></table></figure>

<p>stop and disable NetworkManager , start and enable network.<br>you have problem because both of NetworkManager and Network using same Network driver and default network blocking access for NetworkManager. if you disable NetworkManager your problem will disappeared after restart.</p>
<p>结果还是有错:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service network <span class="literal">Start</span></span><br></pre></td></tr></table></figure>

<p>报错:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">*出环回接口: [确定]</span><br><span class="line">*出界面 eth0:</span><br><span class="line">正在决定 eth0 的 IP 信息...失败了.</span><br><span class="line">[失败]</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br><span class="line">RTNETLINK answers: <span class="built_in">File</span> exists</span><br></pre></td></tr></table></figure>

<p>于是在restart network一下,就OK了,不知道什么原理.</p>
]]></content>
  </entry>
  <entry>
    <title>ERROR Unable to load SQL-Dump into database table.</title>
    <url>/2018/11/16/1175/</url>
    <content><![CDATA[<p>拆卸旧的ispconfig 重新安装 结果出现:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>Unable to load SQL-Dump into database table.</span><br></pre></td></tr></table></figure>

<p>只要重启数据库就好了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/mysqld restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>error while loading shared libraries libinotifytools.so.0 cannot open shared object file No such file or directory</title>
    <url>/2011/09/22/1176/</url>
    <content><![CDATA[<p>做个软链接:<br>32位系统:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libinotifytools.so.<span class="number">0</span> <span class="regexp">/usr/</span>lib/libinotifytools.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>64位系统:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libinotifytools.so.<span class="number">0</span> <span class="regexp">/usr/</span>lib64/libinotifytools.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>error xml2-config not found. Please check your libxml2 installation.</title>
    <url>/2018/02/20/1177/</url>
    <content><![CDATA[<p>在执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --with-mysql=/u</span>sr<span class="regexp">/lib/my</span>sql --with-apxs2=<span class="regexp">/usr/</span>local<span class="regexp">/apache/</span>bin<span class="regexp">/apxs --prefix=/u</span>sr<span class="regexp">/local/</span>php</span><br></pre></td></tr></table></figure>

<p>的时候得到错误信息:</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">configure: error: xml2-config<span class="built_in"> not </span>found. Please<span class="built_in"> check </span>your libxml2 installation.</span><br></pre></td></tr></table></figure>

<p>解决:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install libxml<span class="number">2</span>-<span class="number">2</span>.<span class="number">6</span>.<span class="number">26</span>-<span class="number">2.1.2.1</span>.i<span class="number">386</span>.rpm libxml<span class="number">2</span>-python-<span class="number">2</span>.<span class="number">6</span>.<span class="number">26</span>-<span class="number">2.1.2.1</span>.i<span class="number">386</span>.rpm libxml<span class="number">2</span>-devel-<span class="number">2</span>.<span class="number">6</span>.<span class="number">26</span>-<span class="number">2.1.2.1</span>.i<span class="number">386</span>.rpm perl-libxml-perl-<span class="number">0</span>.<span class="number">08</span>-<span class="number">1</span>.<span class="number">2</span>.<span class="number">1</span>.noarch.rpm</span><br><span class="line"><span class="attribute">yum</span> search libxml</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Eth0 does not seem to be present</title>
    <url>/2012/12/21/1178/</url>
    <content><![CDATA[<p>这个错误的原因是因为我们克隆虚拟机以后,<br>eth0网卡的mac地址发生了改变导致的.<br>解决办法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/u</span>dev<span class="regexp">/rules.d/</span><span class="number">70</span>-persistent-net.rules</span><br></pre></td></tr></table></figure>

<p>我们会发现类似:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># PCI device 0x8086:0x100f (e1000)</span></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>==&quot;net&quot;, <span class="attribute">ACTION</span>==&quot;add&quot;, <span class="attribute">DRIVERS</span>==&quot;?*&quot;, ATTR&#123;address&#125;==<span class="string">&quot;00:0c:29:7b:60:38&quot;</span>, ATTR&#123;type&#125;==<span class="string">&quot;1&quot;</span>, <span class="attribute">KERNEL</span>==&quot;eth*&quot;, <span class="attribute">NAME</span>=<span class="string">&quot;eth0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PCI device 0x8086:0x100f (e1000)</span></span><br><span class="line"><span class="attribute">SUBSYSTEM</span>==&quot;net&quot;, <span class="attribute">ACTION</span>==&quot;add&quot;, <span class="attribute">DRIVERS</span>==&quot;?*&quot;, ATTR&#123;address&#125;==<span class="string">&quot;00:0c:29:3b:50:12&quot;</span>, ATTR&#123;type&#125;==<span class="string">&quot;1&quot;</span>, <span class="attribute">KERNEL</span>==&quot;eth*&quot;, <span class="attribute">NAME</span>=<span class="string">&quot;eth1&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样的文字,我们删除和eth0相关的哪一行,也就是第一行.<br>然后修改eth1为eth0,<br>最好重启一下,然后修改 <code>/etc/sysconfig/network-script/ifcfg-eth0</code>,将上面那个文件里的mac地址写入这个文件里面,替换原来的mac地址.保存.<br>然后 service network restart 搞定.</p>
]]></content>
  </entry>
  <entry>
    <title>fdisk命令详解</title>
    <url>/2016/04/03/1179/</url>
    <content><![CDATA[<p>之前我写过关于分区的博客,但是具体如何给硬盘分区,今天我就简单介绍一下Linux下强大的分区工具fdisk吧!<br>首先,要查看当前电脑的分区,可以用命令fdisk -l查看,而且命令fdisk只有root有权限使用,普通用户无法使用.</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 250.1 GB,<span class="number"> 250059350016 </span>bytes</span><br><span class="line">255 heads,<span class="number"> 63 </span>sectors/track,<span class="number"> 30401 </span>cylinders</span><br><span class="line">Units = cylinders of<span class="number"> 16065 </span>*<span class="number"> 512 </span>=<span class="number"> 8225280 </span>bytes</span><br><span class="line">Sector size (logical/physical):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</span><br><span class="line">I/O size (minimum/optimal):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</span><br><span class="line">Disk identifier: 0xc27bc27b</span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *          <span class="number"> 1 </span>      <span class="number"> 3917 </span>  <span class="number"> 31463271 </span>  <span class="number"> 7 </span> HPFS/NTFS</span><br><span class="line">/dev/sda2           <span class="number"> 3918 </span>     <span class="number"> 27268 </span> <span class="number"> 187563099 </span>   f  W95 Ext&#x27;d (LBA)</span><br><span class="line">/dev/sda3          <span class="number"> 27268 </span>     <span class="number"> 30402 </span>  <span class="number"> 25171968 </span> <span class="number"> 83 </span> Linux</span><br><span class="line">/dev/sda5           <span class="number"> 3918 </span>     <span class="number"> 14361 </span>   83891398+  <span class="number"> 7 </span> HPFS/NTFS</span><br><span class="line">/dev/sda6          <span class="number"> 14362 </span>     <span class="number"> 23499 </span>   73400953+  <span class="number"> 7 </span> HPFS/NTFS</span><br><span class="line">/dev/sda7          <span class="number"> 23500 </span>     <span class="number"> 27146 </span>  <span class="number"> 29294496 </span>   b  W95 FAT32</span><br><span class="line">/dev/sda8          <span class="number"> 27147 </span>     <span class="number"> 27268 </span>    <span class="number"> 975872 </span> <span class="number"> 82 </span> Linux swap / Solaris</span><br></pre></td></tr></table></figure>

<p>我们可以看到硬盘分区的细节,共六列,依次表示设备文件名,起始扇区,结束扇区,容量大小,文件系统ID,文件系统类型.<br>这个只是查看分区,要是针对硬盘分区,需要在fdisk后边加上硬盘设备文件名,而不能加上分区名!</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">fdisk <span class="regexp">/dev/</span>sda</span><br></pre></td></tr></table></figure>

<p>可以看到如下提示:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>):</span><br></pre></td></tr></table></figure>

<p>我们不许要死记硬背fdisk的用法,此时按一下m即可很清晰的命令介绍:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">Command action</span><br><span class="line">a   toggle a bootable flag</span><br><span class="line">b   edit bsd disklabel</span><br><span class="line">c   toggle the dos compatibility flag</span><br><span class="line">d   <span class="built_in">delete</span> a <span class="built_in">partition</span></span><br><span class="line">l   list known <span class="built_in">partition</span> types</span><br><span class="line">m   <span class="built_in">print</span> this menu</span><br><span class="line">n   add a <span class="built_in">new</span> <span class="built_in">partition</span></span><br><span class="line">o   create a <span class="built_in">new</span> empty DOS <span class="built_in">partition</span> table</span><br><span class="line">p   <span class="built_in">print</span> the <span class="built_in">partition</span> table</span><br><span class="line">q   <span class="built_in">quit</span> without <span class="built_in">saving</span> changes</span><br><span class="line">s   create a <span class="built_in">new</span> empty Sun disklabel</span><br><span class="line">t   change a <span class="built_in">partition</span>&#x27;s <span class="built_in">system</span> id</span><br><span class="line">u   change <span class="built_in">display</span>/entry <span class="built_in">units</span></span><br><span class="line">v   verify the <span class="built_in">partition</span> table</span><br><span class="line">w   write table to disk <span class="keyword">and</span> exit</span><br><span class="line">x   extra functionality (experts only)</span><br></pre></td></tr></table></figure>

<p>英文都写的很清楚,使用习惯了我们就会记住常用的命令:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">p:</span>显示分区表</span><br><span class="line"><span class="symbol">n:</span>新增一个分区</span><br><span class="line"><span class="symbol">d:</span>删除一个分区</span><br><span class="line"><span class="symbol">w:</span>将之前的操作写入分区表,保存退出</span><br><span class="line"><span class="symbol">q:</span>退出,不保存之前的操作</span><br></pre></td></tr></table></figure>

<p>在操作前后做好都按p查看一下分区表,一边考虑如何操作和检验操作结果是否正确!如果我们只是做练习,就不许要w保存了,否则它将会变成一条及其危险的命令.</p>
<p>但是保存之后的分区能不能使用呢?答案是不能!用fdisk时有个l命令,可以查看各种文件系统的ID,我们也可以看到默认的ID是83,表示Linux的ext2/3/4文件系统(这么说我也不知道对不对),这个ID只是表示文件系统表示应该是什么,但不是非要搞成这种文件系统不成,我们要改变文件系统的ID,可以使用t命令,然后写上ID即可.比如83,但83并不代表文件系统就是ext3或者ext4,他只是表示这个分区最后应该格式化成ext2/3/4文件系统.也就是说,我们用fdisk分好区后文件系统不能立即使用,需要格式化为相应的文件系统才行.如果真的对硬盘进行分区的话,我们执行w命令后会发现有提示说需要重启才能使用.其实我们也可以用命令partprobe让内核读入分区表,这样就可以直接格式化文件系统而不需要重启系统了.</p>
<p>至于格式化文件系统的命令,我将会在后面的文章里写出来……</p>
]]></content>
  </entry>
  <entry>
    <title>ftplib中遇到中文路径错误问题</title>
    <url>/2019/07/09/1180/</url>
    <content><![CDATA[<p>查阅了很多网上的资料,发现在python自带的模块ftplib.py中定义了编码模式.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/python3/</span>lib<span class="regexp">/python3.6/</span>ftplib.py</span><br></pre></td></tr></table></figure>

<p>初始的编码模式是:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">coding</span> = <span class="string">&#x27;latin-1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>后来笔者把他改成了:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">coding</span> = <span class="string">&#x27;utf-8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>但是问题并不能解决.</p>
<p>最后笔者狠下心来把他改成了:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">encoding</span> = <span class="string">&quot;GB2312&quot;</span></span><br></pre></td></tr></table></figure>

<p>问题迎刃而解.<br>这里的重点应该是了解FTP服务器究竟是搭建在什么机子上,然后需要把ftplib.py中的编码模式改成对应的编码模式.</p>
]]></content>
  </entry>
  <entry>
    <title>gcr.io和quay.io拉取镜像失败</title>
    <url>/2019/08/21/1181/</url>
    <content><![CDATA[<p>k8s在使用编排(manifest)工具进行yaml文件启动pod时,会遇到官方所给例子中spec.containers.image包含:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">quay.io<span class="regexp">/coreos/</span>example_</span><br><span class="line">gcr.io<span class="regexp">/google_containers/</span>example_</span><br></pre></td></tr></table></figure>

<p>也就是说,从quay.io和gcr.io进行镜像拉取,我们知道,国内访问外网是被屏蔽了的.可以将其替换为:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">quay-mirror<span class="selector-class">.qiniu</span><span class="selector-class">.com</span></span><br><span class="line">registry<span class="selector-class">.aliyuncs</span>.com</span><br></pre></td></tr></table></figure>

<p>例如:</p>
<p>下拉镜像:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">quay</span>.io/coreos/flannel:v<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>-s<span class="number">390</span>x</span><br></pre></td></tr></table></figure>

<p>如果拉取较慢,可以改为:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">quay</span>-mirror.qiniu.com/coreos/flannel:v<span class="number">0</span>.<span class="number">10</span>.<span class="number">0</span>-s<span class="number">390</span>x</span><br></pre></td></tr></table></figure>

<p>下拉镜像:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gcr.io<span class="regexp">/google_containers/</span>kube-proxy</span><br></pre></td></tr></table></figure>

<p>可以改为:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">registry.aliyuncs.com<span class="regexp">/google_containers/</span>kube-proxy</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>gem install mysql错误解决</title>
    <url>/2011/01/19/1182/</url>
    <content><![CDATA[<p>执行如下命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">gem <span class="keyword">install</span> mysql</span><br></pre></td></tr></table></figure>

<p>第一种情况:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">$ sudo gem install mysql</span><br><span class="line"></span><br><span class="line">Building native extensions.  This could take a while.<span class="string">..</span></span><br><span class="line">ERROR:  Error installing mysql:</span><br><span class="line">ERROR: Failed to build gem native extension.</span><br><span class="line"><span class="string">/usr/local/bin/ruby</span> extconf.rb install mysql</span><br><span class="line">checking for mysql_query<span class="params">()</span> in -lmysqlclient.<span class="string">..</span> no</span><br><span class="line">checking for main<span class="params">()</span> in -lm.<span class="string">..</span> yes</span><br><span class="line">checking for mysql_query<span class="params">()</span> in -lmysqlclient.<span class="string">..</span> no</span><br><span class="line">checking for main<span class="params">()</span> in -lz.<span class="string">..</span> yes</span><br><span class="line">checking for mysql_query<span class="params">()</span> in -lmysqlclient.<span class="string">..</span> no</span><br><span class="line">checking for main<span class="params">()</span> in -lsocket.<span class="string">..</span> no</span><br><span class="line">checking for mysql_query<span class="params">()</span> in -lmysqlclient.<span class="string">..</span> no</span><br><span class="line">checking for main<span class="params">()</span> in -lnsl.<span class="string">..</span> yes</span><br><span class="line">checking for mysql_query<span class="params">()</span> in -lmysqlclient.<span class="string">..</span> no</span><br><span class="line">*** extconf.rb failed ***</span><br><span class="line">Could not create Makefile due to some reason, probably lack of</span><br><span class="line">necessary libraries and/or headers.  Check the mkmf.log file for more</span><br><span class="line">details.  You may need configuration options.</span><br><span class="line">Provided configuration options:</span><br><span class="line"><span class="params">--with-opt-dir</span></span><br><span class="line"><span class="params">--without-opt-dir</span></span><br><span class="line"><span class="params">--with-opt-include</span></span><br><span class="line"><span class="params">--without-opt-include=</span>$&#123;opt-dir&#125;<span class="string">/include</span></span><br><span class="line"><span class="params">--with-opt-lib</span></span><br><span class="line"><span class="params">--without-opt-lib=</span>$&#123;opt-dir&#125;<span class="string">/lib</span></span><br><span class="line"><span class="params">--with-make-prog</span></span><br><span class="line"><span class="params">--without-make-prog</span></span><br><span class="line"><span class="params">--srcdir=</span>.</span><br><span class="line"><span class="params">--curdir</span></span><br><span class="line"><span class="params">--ruby=/usr/local/bin/ruby</span></span><br><span class="line"><span class="params">--with-mysql-config</span></span><br><span class="line"><span class="params">--without-mysql-config</span></span><br><span class="line"><span class="params">--with-mysql-dir</span></span><br><span class="line"><span class="params">--without-mysql-dir</span></span><br><span class="line"><span class="params">--with-mysql-include</span></span><br><span class="line"><span class="params">--without-mysql-include=</span>$&#123;mysql-dir&#125;<span class="string">/include</span></span><br><span class="line"><span class="params">--with-mysql-lib</span></span><br><span class="line"><span class="params">--without-mysql-lib=</span>$&#123;mysql-dir&#125;<span class="string">/lib</span></span><br><span class="line"><span class="params">--with-mysqlclientlib</span></span><br><span class="line"><span class="params">--without-mysqlclientlib</span></span><br><span class="line"><span class="params">--with-mlib</span></span><br><span class="line"><span class="params">--without-mlib</span></span><br><span class="line"><span class="params">--with-mysqlclientlib</span></span><br><span class="line"><span class="params">--without-mysqlclientlib</span></span><br><span class="line"><span class="params">--with-zlib</span></span><br><span class="line"><span class="params">--without-zlib</span></span><br><span class="line"><span class="params">--with-mysqlclientlib</span></span><br><span class="line"><span class="params">--without-mysqlclientlib</span></span><br><span class="line"><span class="params">--with-socketlib</span></span><br><span class="line"><span class="params">--without-socketlib</span></span><br><span class="line"><span class="params">--with-mysqlclientlib</span></span><br><span class="line"><span class="params">--without-mysqlclientlib</span></span><br><span class="line"><span class="params">--with-nsllib</span></span><br><span class="line"><span class="params">--without-nsllib</span></span><br><span class="line"><span class="params">--with-mysqlclientlib</span></span><br><span class="line"><span class="params">--without-mysqlclientlib</span></span><br><span class="line">Gem files will remain installed in <span class="string">/usr/local/lib/ruby/gems/1.8/gems/mysql-2.7</span> for inspection.</span><br><span class="line">Results logged to <span class="string">/usr/local/lib/ruby/gems/1.8/gems/mysql-2.7/gem_make.out</span></span><br></pre></td></tr></table></figure>

<p>原因:mysql_config的路径指向问题.</p>
<p>解决:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">sudo gem install mysql -- --<span class="keyword">with</span>-mysql-config=<span class="regexp">/usr/</span>bin/mysql_config</span><br></pre></td></tr></table></figure>

<p>第二种情况:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ sudo gem install mysql --with-mysql-config=<span class="regexp">/usr/</span>bin/mysql_config</span><br><span class="line"></span><br><span class="line">Building <span class="keyword">native</span> extensions.  <span class="keyword">This</span> could take a <span class="keyword">while</span>...</span><br><span class="line">ERROR:  Error installing mysql:</span><br><span class="line">ERROR: Failed to build gem <span class="keyword">native</span> extension.</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>ruby extconf.rb install mysql -- --with-mysql-config=<span class="regexp">/usr/</span>bin/mysql_config</span><br><span class="line">checking <span class="keyword">for</span> mysql_ssl_set()... no</span><br><span class="line">checking <span class="keyword">for</span> mysql.h... no</span><br><span class="line">checking <span class="keyword">for</span> mysql/mysql.h... no</span><br><span class="line">*** extconf.rb failed ***</span><br><span class="line">Could not create Makefile due to some reason, probably lack of</span><br><span class="line">necessary libraries and/or headers.  Check the mkmf.log <span class="keyword">file</span> <span class="keyword">for</span> more</span><br><span class="line">details.  You may need configuration <span class="keyword">options</span>.</span><br><span class="line">Provided configuration <span class="keyword">options</span>:</span><br><span class="line">--with-opt-dir</span><br><span class="line">--without-opt-dir</span><br><span class="line">--with-opt-<span class="keyword">include</span></span><br><span class="line">--without-opt-<span class="keyword">include</span>=$&#123;opt-dir&#125;/<span class="keyword">include</span></span><br><span class="line">--with-opt-lib</span><br><span class="line">--without-opt-lib=$&#123;opt-dir&#125;/lib</span><br><span class="line">--with-make-prog</span><br><span class="line">--without-make-prog</span><br><span class="line">--srcdir=.</span><br><span class="line">--curdir</span><br><span class="line">--ruby=<span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>ruby</span><br><span class="line">--with-mysql-config</span><br><span class="line">Gem files will remain installed in <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>ruby<span class="regexp">/gems/</span><span class="number">1.8</span><span class="regexp">/gems/my</span>sql-<span class="number">2.7</span> <span class="keyword">for</span> inspection.</span><br><span class="line">Results logged to <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>ruby<span class="regexp">/gems/</span><span class="number">1.8</span><span class="regexp">/gems/my</span>sql-<span class="number">2.7</span>/gem_make.out</span><br></pre></td></tr></table></figure>

<p>原因:缺少mysql-devel.<br>解决:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">$ sudo yum install mysql-devel</span><br><span class="line"></span><br><span class="line">Loaded plugins: refresh-packagekit</span><br><span class="line">Setting up Install Process</span><br><span class="line">Parsing package install arguments</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package mysql-devel.i386 0:5.0.51a-1.fc9 set to be updated</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"><span class="section">Dependencies Resolved</span></span><br><span class="line"><span class="section">=============================================================================</span></span><br><span class="line"><span class="section">Package                 Arch       Version          Repository        Size</span></span><br><span class="line"><span class="section">=============================================================================</span></span><br><span class="line">Installing:</span><br><span class="line">mysql-devel             i386       5.0.51a-1.fc9    fedora            2.4 M</span><br><span class="line"><span class="section">Transaction Summary</span></span><br><span class="line"><span class="section">=============================================================================</span></span><br><span class="line">Install      1 Package(s)</span><br><span class="line">Update       0 Package(s)</span><br><span class="line">Remove       0 Package(s)</span><br><span class="line">Total download size: 2.4 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/1): mysql-devel-5.0.51a-1.fc9.i386.rpm                 | 2.4 MB      00:00</span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Finished Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">Installing     : mysql-devel                                            [1/1]</span><br><span class="line">Installed: mysql-devel.i386 0:5.0.51a-1.fc9</span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<p>重新执行命令:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">sudo gem install mysql -- --with-mysql-config=<span class="regexp">/usr/</span>bin/mysql_config</span><br><span class="line"></span><br><span class="line">Building <span class="keyword">native</span> extensions.  <span class="keyword">This</span> could take a <span class="keyword">while</span>...</span><br><span class="line">Successfully installed mysql-<span class="number">2.7</span></span><br><span class="line"><span class="number">1</span> gem installed</span><br></pre></td></tr></table></figure>

<p>成功!!!</p>
]]></content>
  </entry>
  <entry>
    <title>Gem中mysql错误</title>
    <url>/2019/01/23/1183/</url>
    <content><![CDATA[<p>Gem使用中遇到错误:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">henry@henry-laptop:~/Soft/Ruby/RubyGem/rubygems<span class="string">-0</span>.9.0$ sudo gem update --system     Updating RubyGems...</span><br><span class="line">Bulk updating Gem source index for: http://gems.rubyforge.org</span><br><span class="line">Attempting remote update of rubygems-update</span><br><span class="line"><span class="keyword">ERROR:  </span>While executing gem ... (Errno::ENOENT)</span><br><span class="line">No such file or directory - getcwd</span><br><span class="line">henry@henry-laptop:~/Soft/Ruby/RubyGem/rubygems<span class="string">-0</span>.9.0$ sudo gem update rails</span><br><span class="line">sudo: cannot get working directory</span><br><span class="line">Updating installed gems...</span><br><span class="line">Attempting remote update of rails</span><br><span class="line">Install required dependency rake? [Yn]  y</span><br><span class="line"><span class="keyword">ERROR:  </span>While executing gem ... (Errno::ENOENT)</span><br><span class="line">No such file or directory - getcwd</span><br><span class="line">henry@henry-laptop:~/Soft/Ruby/RubyGem/rubygems<span class="string">-0</span>.9.0$ cd ~</span><br><span class="line">henry@henry-laptop:~$ sudo gem update --system</span><br></pre></td></tr></table></figure>

<p>后面运行正常,看来Gem还会挑剔目录～</p>
]]></content>
  </entry>
  <entry>
    <title>git 克隆报错 fatal ssh variant &#39;simple&#39; does not support setting port</title>
    <url>/2019/05/27/1184/</url>
    <content><![CDATA[<p>原因是git和小乌龟版本低导致的.<br>升级tortoisegit到至少2.5.7版本,可以自动识别ssh格式链接.<br>如果是低版本的tortoisegit,需要将环境变量git-ssh-uvariant设置为ssh,<br>或者使用<code>git config--globalssh.variantsh</code>在git设置中配置它.</p>
]]></content>
  </entry>
  <entry>
    <title>git安装</title>
    <url>/2018/02/28/1185/</url>
    <content><![CDATA[<p>1.安装git</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> –y git</span><br></pre></td></tr></table></figure>

<p>2.服务器创建git账户</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">groupadd git</span><br><span class="line"><span class="built_in">id</span> git</span><br></pre></td></tr></table></figure>

<p>如果没有git账户:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">useradd git</span></span><br><span class="line"><span class="attribute">passwd git</span></span><br><span class="line"><span class="attribute">git</span></span><br></pre></td></tr></table></figure>

<p>3.服务器git打开RSA认证</p>
<p>进入 <code>/etc/ssh</code>目录,编辑sshd_config,打开以下三个配置的注释,如无则添加:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">RSAAuthentication</span> <span class="literal">yes</span></span><br><span class="line">PubkeyAuthentication <span class="literal">yes</span></span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>保存并重启sshd服务.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>sshd restart</span><br></pre></td></tr></table></figure>

<p>4.在 <code>/home/git</code>下创建目录.ssh</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/home/git</span></span><br><span class="line">mkdir <span class="string">.ssh</span></span><br></pre></td></tr></table></figure>

<p>然后更改.ssh的所有者和用户组为git:</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">chown –R g<span class="symbol">it:gi</span><span class="built_in">t</span> .ssh</span><br></pre></td></tr></table></figure>

<p>5.将客户端公钥导入服务器端 <code>/home/git/.ssh/authorized_keys</code>文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/home/gi</span>t/.ssh</span><br><span class="line">touch authorized_keys</span><br><span class="line">vi authorized_keys</span><br></pre></td></tr></table></figure>

<p>把客户端公钥粘贴到这个文件.<br>保存退出.</p>
]]></content>
  </entry>
  <entry>
    <title>grep、sort、uniq命令详解</title>
    <url>/2013/10/14/1186/</url>
    <content><![CDATA[<p>grep命令:该命令用来在文本文件中查找指定模式的词或短语,并在标准输出上显示包括给定字符串模式的所有行.该命令组包含三个命令:grep,egrep 和 fgrep 命令.grep命令一次只能搜索一个指定的模式;egrep命令等同于grep -E,可以使用扩展的字符串模式进行搜索;fgrep命令等同于grep -F,是快速搜索命令,它检索固定字符串,但不识别正则表达式.</p>
<p>一般格式:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">grep <span class="selector-attr">[选项]</span> 查找模式<span class="selector-attr">[文件名1,文件名2,…]</span></span><br><span class="line">grep<span class="selector-attr">[选项]</span> <span class="selector-attr">[-e查找模式| -f 文件]</span><span class="selector-attr">[文件名1,文件名2,…]</span></span><br></pre></td></tr></table></figure>

<p>说明:这组命令在指定文件中搜索特定模式及定位特定主题等方面用途很大.要搜索的模式被看做是一些关键词,查看指定的文件中是否包含这些关键词.这三个命令的功能类似,但由于可以搜索的模式不同,因此在功能强弱上有所差别.</p>
<p>如果没有指定文件,它们就从标准输入中读取.在正常情况下,每个匹配的行被显示到标准输出上.如果要搜索的文件不止一个,则在每一行输出之前加上文件名.</p>
<p>常用选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-E 将查找模式解释成扩展的正则表达式.</span></span><br><span class="line"><span class="deletion">-F 将查找模式解释成单纯的字符串.</span></span><br><span class="line"><span class="deletion">-b,--byte-offset 在输出的每一行前面显示包含匹配字符串的行在文件中的位置,用字节偏移量来表示.</span></span><br><span class="line"><span class="deletion">-c,--count 只显示文件中包含匹配字符串的行的总数.</span></span><br><span class="line"><span class="deletion">-f FILE 从文件FILE中获取模式,每行一个.空文件不含模式,因此,不做匹配.</span></span><br><span class="line"><span class="deletion">-i 匹配比较时不区分字母的大小写.</span></span><br><span class="line"><span class="deletion">-r 以递归方式查询目录下的所有子目录中的文件.</span></span><br><span class="line"><span class="deletion">-n 在输出包含匹配模式的行之前,加上该行的行号(文件首行的行号为1).</span></span><br><span class="line"><span class="deletion">-v 只显示不包含匹配字符串的文本行.</span></span><br><span class="line"><span class="deletion">-x 只显示整个行都严格匹配的行.</span></span><br></pre></td></tr></table></figure>

<p>注意事项:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">在命令名之后先输入搜索的模式,然后是要搜索的文件.</span><br><span class="line">在文件名列表中可以使用通配符,如<span class="string">&quot;*&quot;</span>等.</span><br><span class="line">要查找目录的子目录中的文件,应使用<span class="string">&quot;-r&quot;</span>选项.</span><br><span class="line">如果在搜索模式的字符串中包含空格,应用单引号把模式字符串括起来.</span><br><span class="line">利用选项<span class="string">&quot;-f&quot;</span>可以大批地在文件中搜索字符串.</span><br></pre></td></tr></table></figure>

<p>示例:<br>在密码文件 <code>/etc/passwd</code>中查找包含”mengqc”的所有行:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">grep -F mengqc /etc/passwd</span><br><span class="line"><span class="symbol">mengqc:</span><span class="symbol">x:</span><span class="number">500</span><span class="symbol">:</span><span class="number">100</span><span class="symbol">:mengqc</span><span class="symbol">:/home/mengqc</span><span class="symbol">:/bin/bash</span></span><br></pre></td></tr></table></figure>

<p>在mengqc目录和子目录下的所有文件中查找字符串”print”出现的次数:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grep</span> –r <span class="string">&#x27;print&#x27;</span> mengqc</span><br></pre></td></tr></table></figure>

<p>在文件f1和f2中查找包含”main”或者”printf”的所有行,不管首字母的大小写:</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">grep</span> –E <span class="string">&#x27;[Mm]ain | [Pp]rintf&#x27;</span> <span class="built_in">f1</span> <span class="built_in">f2</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">grep</span> –i &#x27;main | printf&#x27; f<span class="number">1</span> f<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>sort命令:命令用来对文本文件的各行进行排序.</p>
<p>一般格式:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sort <span class="selector-attr">[选项]</span> 文件列表</span><br></pre></td></tr></table></figure>

<p>说明:sort命令将逐行对指定文件中的所有行进行排序,并将结果显示在标准输出上.如果不指定文件或者使用”一”表示文件,则排序内容来自标准输入.排序比较是依据从输入文件的每一行中提取的一个或多个排序关键字进行的.排序关键字定义了用来排序的最小的字符序列.在默认情况下,排序关键字的顺序由系统使用的字符集决定.</p>
<p>选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-m 对己经排好序的文件统一进行合并,但不做排序.</span></span><br><span class="line"><span class="deletion">-c 检查给定的文件是否己排好序,若没有,则显示出错消息,不做排序.</span></span><br><span class="line"><span class="deletion">-u与-c 选项一起用,严格地按顺序检查;否则,对排序后的重复行只输出第一行.</span></span><br><span class="line"><span class="deletion">-o 文件名 将排序输出放到该文件名所指定的文件中.如果该文件不存在,则创建一个新文件.</span></span><br></pre></td></tr></table></figure>

<p>改变排序规则的选项主要有:</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">-d 按字典顺序排序,比较时仅考虑空白符和字母数字符.</span><br><span class="line">-f 忽略字母的大小写.</span><br><span class="line">-i 忽略非打印字符.</span><br><span class="line">-M 规定月份的比较次序是<span class="comment">(未知)</span>&lt;<span class="string">&quot;JAN&quot;</span>&lt;<span class="string">&quot;FEB&quot;</span>&lt;…&lt;<span class="string">&quot;DEC&quot;</span>.</span><br><span class="line">-r 按逆序排序.默认排序输出是按升序排序的.</span><br><span class="line">-k <span class="symbol">n1</span>[,<span class="symbol">n2</span>] 指定从文本行的第<span class="symbol">n1</span>字段开始至第<span class="symbol">n2</span>字段<span class="comment">(不包括第n2字段)</span>中间的内容作为排序关键字.如果没有<span class="symbol">n2</span>,则关键字是从第<span class="symbol">n1</span>个字段到行尾的所有字段.<span class="symbol">n1</span>和<span class="symbol">n2</span>可以是小数形式.如<span class="string">&quot;x.y&quot;</span>,x表示第x字段,y表示第x字段中的第y个字符.字段和字符的文职都是从<span class="number">1</span>开始算起的.</span><br><span class="line">-b 比较关键字时忽略前导的空白符<span class="comment">(空格或制表符)</span>.</span><br><span class="line">-t 字符将指定的<span class="string">&quot;字符&quot;</span>作为字段间的分隔符.</span><br></pre></td></tr></table></figure>

<p>示例:<br>对more_h10文件排序:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">head</span> mfile&gt;more_h<span class="number">10</span> (将文件mfile的前<span class="number">10</span>行定向到文件moreeeh<span class="number">10</span>中)</span><br><span class="line"><span class="attribute">sort</span> more_h<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>以第3个字段作为排序关键字,对文件more_h10排序:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sort</span> –k<span class="number">2</span>,<span class="number">3</span> more_h<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>uniq命令:该命令从排好序的文件中去除重复行.</p>
<p>一般格式:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">uni<span class="string">q [选项]</span> 文件</span><br></pre></td></tr></table></figure>

<p>说明:uniq命令读取输入文件,并比较相邻的行,去掉重复的行一行.该命令加工后的结果写到输出文件中.输入文件和输出文件必须不同.用”一”表示,则从标准输入上读取.</p>
<p>选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-c 显示输出时,在每行的行首加上该行在文件中出现的次数.</span></span><br><span class="line"><span class="deletion">-d 只显示重复行.</span></span><br><span class="line"><span class="deletion">-f --skip-fields=N  忽略比较前N个字段.</span></span><br><span class="line"><span class="deletion">-s --skip-chars=N 忽略比较前N个字段.</span></span><br><span class="line"><span class="deletion">-u 只显示文件中不重复的行.</span></span><br></pre></td></tr></table></figure>

<p>实例:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">uniq</span> –u ex<span class="number">3</span>  (显示文件ex<span class="number">3</span>中不重复的行)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>grep常见用法</title>
    <url>/2013/06/26/1187/</url>
    <content><![CDATA[<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">[root@www ~]# grep [-acinv] [--color=auto] <span class="string">&#x27;搜寻字符串&#x27;</span> filename</span><br></pre></td></tr></table></figure>

<p>选项与参数:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">-a :将 binary 文件以 text 文件的方式搜寻数据</span><br><span class="line">-c :计算找到 <span class="string">&#x27;搜寻字符串&#x27;</span> 的次数</span><br><span class="line">-i :忽略大小写的不同,所以大小写视为相同</span><br><span class="line">-n :顺便输出行号</span><br><span class="line">-v :反向选择,亦即显示出没有 <span class="string">&#x27;搜寻字符串&#x27;</span> 内容的那一行!</span><br><span class="line"><span class="attribute">--color</span>=auto :可以将找到的关键词部分加上颜色的显示喔!在关键字的显示方面,grep 可以使用 <span class="attribute">--color</span>=auto 来将关键字部分使用颜色显示. 这可是个很不错的功能啊!但是如果每次使用 grep 都得要自行加上 <span class="attribute">--color</span>=auto 又显的很麻烦～ 此时那个好用的 alias 就得来处理一下啦!你可以在 ~/.bashrc 内加上这行:『alias <span class="attribute">grep</span>=<span class="string">&#x27;grep --color=auto&#x27;</span>』再以『 source ~/.bashrc 』来立即生效即可喔! 这样每次运行 grep 他都会自动帮你加上颜色显示啦</span><br></pre></td></tr></table></figure>

<p>1.将 <code>/etc/passwd</code>,有出现 root 的行取出来</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># grep root /etc/passwd</span></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span>0<span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | grep root </span></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span>0<span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>2.将 <code>/etc/passwd</code>,有出现 root 的行取出来,同时显示这些行在 <code>/etc/passwd</code>的行号</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># grep -n root /etc/passwd</span></span><br><span class="line"><span class="number">1</span><span class="symbol">:root</span><span class="symbol">:x</span><span class="symbol">:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="number">30</span><span class="symbol">:operator</span><span class="symbol">:x</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span>0<span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>3.将 <code>/etc/passwd</code>,将没有出现 root 的行取出来</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># grep -v root /etc/passwd</span></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span>0<span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>4.将 <code>/etc/passwd</code>,将没有出现 root 和nologin的行取出来</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="comment"># grep -v root /etc/passwd | grep -v nologin</span></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span>0<span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>5.用dmesg 列出核心信息,再以 grep 找出内含 eth 那行,要将捉到的关键字显色,且加上行号来表示</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@www</span> ~]<span class="comment"># dmesg | grep -n --color=auto &#x27;eth&#x27;</span></span><br><span class="line"><span class="number">247</span><span class="symbol">:eth0</span>: RealTek RTL8139 at <span class="number">0xee846000</span>, 00<span class="symbol">:</span><span class="number">90</span><span class="symbol">:cc</span><span class="symbol">:a6</span><span class="symbol">:</span><span class="number">34</span><span class="symbol">:</span><span class="number">84</span>, IRQ <span class="number">10</span></span><br><span class="line"><span class="number">248</span><span class="symbol">:eth0</span>: Identified <span class="number">8139</span> chip type <span class="string">&#x27;RTL-8139C&#x27;</span></span><br><span class="line"><span class="number">294</span><span class="symbol">:eth0</span>: link up, <span class="number">100</span>Mbps, full-duplex, lpa <span class="number">0xC5E1</span></span><br><span class="line"><span class="number">305</span><span class="symbol">:eth0</span>: no IPv6 routers present</span><br><span class="line"></span><br><span class="line"><span class="comment"># 你会发现除了 eth 会有特殊颜色来表示之外,最前面还有行号喔!</span></span><br></pre></td></tr></table></figure>

<p>6.用dmesg 列出核心信息,再以 grep 找出内含 eth 那行,在关键字所在行的前两行与后三行也一起捉出来显示</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@www</span> <span class="string">~</span>]<span class="comment"># dmesg | grep -n -A3 -B2 --color=auto &#x27;eth&#x27;</span></span><br><span class="line"><span class="attr">245-PCI:</span> <span class="string">setting</span> <span class="string">IRQ</span> <span class="number">10</span> <span class="string">as</span> <span class="string">level-triggered</span></span><br><span class="line"><span class="attr">246-ACPI:</span> <span class="string">PCI</span> <span class="string">Interrupt</span> <span class="number">0000</span><span class="string">:00:0e.0[A]</span> <span class="string">-&gt;</span> <span class="string">Link</span> [<span class="string">LNKB</span>] <span class="string">...</span></span><br><span class="line"><span class="attr">247:eth0:</span> <span class="string">RealTek</span> <span class="string">RTL8139</span> <span class="string">at</span> <span class="number">0xee846000</span><span class="string">,</span> <span class="number">00</span><span class="string">:90:cc:a6:34:84,</span> <span class="string">IRQ</span> <span class="number">10</span></span><br><span class="line"><span class="attr">248:eth0:</span> <span class="string">Identified</span> <span class="number">8139 </span><span class="string">chip</span> <span class="string">type</span> <span class="string">&#x27;RTL-8139C&#x27;</span></span><br><span class="line"><span class="attr">249-input:</span> <span class="string">PC</span> <span class="string">Speaker</span> <span class="string">as</span> <span class="string">/class/input/input2</span></span><br><span class="line"><span class="attr">250-ACPI:</span> <span class="string">PCI</span> <span class="string">Interrupt</span> <span class="number">0000</span><span class="string">:00:01.4[B]</span> <span class="string">-&gt;</span> <span class="string">Link</span> [<span class="string">LNKB</span>] <span class="string">...</span></span><br><span class="line"><span class="attr">251-hdb:</span> <span class="string">ATAPI</span> <span class="string">48X</span> <span class="string">DVD-ROM</span> <span class="string">DVD-R-RAM</span> <span class="string">CD-R/RW</span> <span class="string">drive,</span> <span class="string">2048kB</span> <span class="string">Cache,</span> <span class="string">UDMA(66)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如上所示,你会发现关键字 247 所在的前两行及 248 后三行也都被显示出来!</span></span><br><span class="line"><span class="comment"># 这样可以让你将关键字前后数据捉出来进行分析啦!</span></span><br></pre></td></tr></table></figure>

<p>7.根据文件内容递归查找目录</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"># grep <span class="string">&#x27;energywise&#x27;</span> *         #在当前目录搜索带<span class="string">&#x27;energywise&#x27;</span>行的文件</span><br><span class="line"># grep -r <span class="string">&#x27;energywise&#x27;</span> *      #在当前目录及其子目录下搜索<span class="string">&#x27;energywise&#x27;</span>行的文件</span><br><span class="line"># grep -l -r <span class="string">&#x27;energywise&#x27;</span> *   #在当前目录及其子目录下搜索<span class="string">&#x27;energywise&#x27;</span>行的文件,但是不显示匹配的行,只显示匹配的文件</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Grub磁盘分区表示方法</title>
    <url>/2011/01/24/1189/</url>
    <content><![CDATA[<p>Grub指定分区的方法和Linux、Windows等系统不一样,它的主要特点为:</p>
<p>Grub在表示方式上并不区分普通的IDE硬盘、当下流行的SATA硬盘和SCSI硬盘等,在Grub中,硬盘会被识别为hd#,#是从0开始的硬盘编号,而软盘被类似地识别为fd#.<br>Grub的硬盘编号和分区编号都是从0开始的,这一点linux不同.</p>
<p>按照以上两个特点,假设有一块硬盘(hd0),那么(hd0,0) (hd0,1) (hd0,2) (hd0,3)依次表示它的四个主分区,而随后的(hd0,4)…则是逻辑分区.</p>
<p>通常情况下,装有Windows的硬盘中,通常是按照一个主分区(hd0,0),一个扩展分区(hd0,1)该扩展分区下是若干逻辑分区.这样(hd0,0)对应C盘,(hd0,4)对应D盘,依此类推.</p>
<p>如果您还不能确定你需要的那个分区,可以在输入过程中按下Tab键实现命令补全.比如你在输入一条root语句:</p>
<p>root (hd0,</p>
<p>此时按下Tab键,grub将列出可用的分区编号和分区类型(grub还不能识别ntfs分区,显示为不知道类型的分区).你可以依照这个提示来完成命令的输入.</p>
<p>如果不能确定ISO文件的位置,可使用find 文件名.iso(find debian-40r2-i386-CD-1.iso)</p>
]]></content>
  </entry>
  <entry>
    <title>IIS常见问题和错误及其解决方案</title>
    <url>/2013/04/14/1192/</url>
    <content><![CDATA[<p>我整理了一些问题的解决方法写出来供大家参考:</p>
<p>Q:为什么我的ASP页面到windows2003后就不能执行了,执行ASPX正常.<br>A:windows2003中默认没有启用ASP支持,在IIS的Web  Service  Extensions里找到Active  Server  Pages,将ALLOW选上,就可以了.</p>
<p>Q:我的IIS只要asp文件有错,就显示HTTP500错误,但是却不显示出错的详细信息.以前能够显示究竟是那个文件的那一行出错,但现在却不显示.<br>A:在IE的Internet选项中选高级,选中”显示友好的HTTP错误”即可.</p>
<p>Q:在Windows  XP家庭版如何安装IIS?<br>A:windows XP家庭版不能安装IIS,请升级到专业版.</p>
<p>Q:为何我访问本机地址要求输入用户和密码?<br>A:将IIS设置中匿名帐号权限打开.再则检查所在目录的NTFS权限.</p>
<p>Q:我的ASP文件包含文件的时候提示Active Server Pages 错误 ‘ASP 0131’不允许的父路径,如何解决?<br>A:在站点属性中选择主目录－配置－应用程序选项,将”启用父目录”选上.</p>
<p>Q:为何我的IIS老是当机?<br>A:1、检查你设置的脚本超时时间,不能过长.2、检查你的程序是否有对象和连接没有关闭.3、依次停止各个用户的服务,看看是不是有耗大资源的用户程序.</p>
<p>Q:win200 server+iis,为什么在网页上,有的中文htm链接路径可以显示,有的不行?<br>A:’转换双字节字符为合法的URL传输字串.</p>
<p>Q:IIS 所有的exe文件从上面的目录都不能下载,显示404 文件找不到  是什么原因?还是哪里设置错误?<br>A:设置一下http头–MIME类型,新建一个类型扩展名为EXE,类型为:application/octet-stream.</p>
<p>Q:在管理工具中找不到IIS了.<br>A:在C:WINDOWSsystem32inetsrv中找到快捷方式重新建立.</p>
<p>Q:IIS无法支持ASP了,重启N次都不行.<br>A:在应用程序程序配置中检查.asp文件是不是已经映射到C:WINDOWSsystem32inetsrvasp.dll.若无,则添加.</p>
]]></content>
  </entry>
  <entry>
    <title>httpd Could not reliably determine the server&#39;s fully qualified domain name</title>
    <url>/2015/03/10/1190/</url>
    <content><![CDATA[<p>解决方案:<br>进入apache的安装目录:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Windows : D:<span class="regexp">/Program Files/</span>Apache Software Foundation/Apache2.<span class="number">2</span>conf</span><br><span class="line">linux : <span class="regexp">/usr/</span>local<span class="regexp">/apache/</span>conf</span><br></pre></td></tr></table></figure>

<p>用记事本打开httpd.conf<br>将里面的:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#ServerName localhost:80</span></span><br></pre></td></tr></table></figure>

<p>注释去掉即可.<br>再执行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service httpd <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>然后可以通过浏览器访问<a href="http://localhost:80,如果页面显示&quot;It">http://localhost:80,如果页面显示&quot;It</a> works!”,即表示apache已安装并启动成功.</p>
]]></content>
  </entry>
  <entry>
    <title>grep命令介绍</title>
    <url>/2012/12/18/1188/</url>
    <content><![CDATA[<p>Linux grep 命令用于查找文件里符合条件的字符串.</p>
<p>grep 指令用于查找内容包含指定的范本样式的文件,如果发现某文件的内容符合所指定的范本样式,预设 grep 指令会把含有范本样式的那一列显示出来.若不指定任何文件名称,或是所给予的文件名为 -,则 grep 指令会从标准输入设备读取数据.</p>
<p>语法:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">grep <span class="selector-attr">[-abcEFGhHilLnqrsvVwxy]</span><span class="selector-attr">[-A&lt;显示列数&gt;]</span><span class="selector-attr">[-B&lt;显示列数&gt;]</span><span class="selector-attr">[-C&lt;显示列数&gt;]</span><span class="selector-attr">[-d&lt;进行动作&gt;]</span><span class="selector-attr">[-e&lt;范本样式&gt;]</span><span class="selector-attr">[-f&lt;范本文件&gt;]</span><span class="selector-attr">[--help]</span><span class="selector-attr">[范本样式]</span><span class="selector-attr">[文件或目录...]</span></span><br></pre></td></tr></table></figure>

<p>参数:</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">a 或 --text : 不要忽略二进制的数据.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">A&lt;显示行数&gt; 或 --after-context=&lt;显示行数&gt; : 除了显示符合范本样式的那一列之外,并显示该行之后的内容.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">b 或 --byte-offset : 在显示符合样式的那一行之前,标示出该行第一个字符的编号.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">B&lt;显示行数&gt; 或 --before-context=&lt;显示行数&gt; : 除了显示符合样式的那一行之外,并显示该行之前的内容.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">c 或 --count : 计算符合样式的列数.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">C&lt;显示行数&gt; 或 --context=&lt;显示行数&gt;或-&lt;显示行数&gt; : 除了显示符合样式的那一行之外,并显示该行之前后的内容.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">d &lt;动作&gt; 或 --directories=&lt;动作&gt; : 当指定要查找的是目录而非文件时,必须使用这项参数,否则grep指令将回报信息并停止动作.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">e&lt;范本样式&gt; 或 --regexp=&lt;范本样式&gt; : 指定字符串做为查找文件内容的样式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">E 或 --extended-regexp : 将样式为延伸的普通表示法来使用.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">f&lt;规则文件&gt; 或 --file=&lt;规则文件&gt; : 指定规则文件,其内容含有一个或多个规则样式,让grep查找符合规则条件的文件内容,格式为每行一个规则样式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">F 或 --fixed-regexp : 将样式视为固定字符串的列表.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">G 或 --basic-regexp : 将样式视为普通的表示法来使用.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">h 或 --no-filename : 在显示符合样式的那一行之前,不标示该行所属的文件名称.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">H 或 --with-filename : 在显示符合样式的那一行之前,表示该行所属的文件名称.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">i 或 --ignore-<span class="keyword">case</span> : 忽略字符大小写的差别.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">l 或 --file-with-matches : 列出文件内容符合指定的样式的文件名称.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">L 或 --files-without-match : 列出文件内容不符合指定的样式的文件名称.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">n 或 --line-number : 在显示符合样式的那一行之前,标示出该行的列数编号.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">o 或 --only-matching : 只显示匹配PATTERN 部分.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">q 或 --quiet或--silent : 不显示任何信息.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">r 或 --recursive : 此参数的效果和指定<span class="string">&quot;-d recurse&quot;</span>参数相同.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">s 或 --no-messages : 不显示错误信息.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">v 或 --revert-match : 显示不包含匹配文本的所有行.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">V 或 --version : 显示版本信息.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">w 或 --word-regexp : 只显示全字符合的列.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">x --line-regexp : 只显示全列符合的列.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">y : 此参数的效果和指定<span class="string">&quot;-i&quot;</span>参数相同. </span></span><br></pre></td></tr></table></figure>

<p>实例:</p>
<p>1、在当前目录中,查找后缀有 file 字样的文件中包含 test 字符串的文件,并打印出该字符串的行.此时,可以使用如下命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">grep <span class="keyword">test</span> *<span class="keyword">file</span> </span><br></pre></td></tr></table></figure>

<p>结果如下所示:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">$ grep test test* <span class="meta">#查找前缀有<span class="string">&quot;test&quot;</span>的文件包含<span class="string">&quot;test&quot;</span>字符串的文件  </span></span><br><span class="line"><span class="symbol">testfile1:</span>This a Linux testfile! <span class="meta">#列出testfile1 文件中包含test字符的行  </span></span><br><span class="line"><span class="symbol">testfile_2:</span>This is a linux testfile! <span class="meta">#列出testfile_2 文件中包含test字符的行  </span></span><br><span class="line"><span class="symbol">testfile_2:</span>Linux test <span class="meta">#列出testfile_2 文件中包含test字符的行 </span></span><br></pre></td></tr></table></figure>

<p>2、以递归的方式查找符合条件的文件.例如,查找指定目录/etc/acpi 及其子目录(如果存在子目录的话)下所有文件中包含字符串”update”的文件,并打印出该字符串所在行的内容,使用的命令为:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grep</span> -r update <span class="regexp">/etc/</span>acpi </span><br></pre></td></tr></table></figure>

<p>输出结果如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ grep -r update <span class="regexp">/etc/</span>acpi <span class="comment">#以递归的方式查找&quot;etc/acpi&quot;  </span></span><br><span class="line"><span class="comment">#下包含&quot;update&quot;的文件  </span></span><br><span class="line"><span class="regexp">/etc/</span>acpi<span class="regexp">/ac.d/</span><span class="number">85</span>-anacron.sh:<span class="comment"># (Things like the slocate updatedb cause a lot of IO.)  </span></span><br><span class="line">Rather than  </span><br><span class="line"><span class="regexp">/etc/</span>acpi<span class="regexp">/resume.d/</span><span class="number">85</span>-anacron.sh:<span class="comment"># (Things like the slocate updatedb cause a lot of  </span></span><br><span class="line">IO.) Rather than  </span><br><span class="line"><span class="regexp">/etc/</span>acpi<span class="regexp">/events/</span>thinkpad-cmos:action=<span class="regexp">/usr/</span>sbin/thinkpad-keys--update </span><br></pre></td></tr></table></figure>

<p>3、反向查找.前面各个例子是查找并打印出符合条件的行,通过”-v”参数可以打印出不符合条件行的内容.</p>
<p>查找文件名中包含 test 的文件中不包含test 的行,此时,使用的命令为:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -v <span class="built_in">test</span> *<span class="built_in">test</span>*</span><br></pre></td></tr></table></figure>

<p>结果如下所示:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">$ grep-v test* #查找文件名中包含test 的文件中不包含test 的行</span><br><span class="line">testfile1:helLinux!  </span><br><span class="line">testfile1:Linis a free Unix-<span class="keyword">type</span> <span class="type">operating </span>system.</span><br><span class="line">testfile1:Lin  </span><br><span class="line">testfile_1:HELLO LINUX!  </span><br><span class="line">testfile_1:LINUX <span class="keyword">IS</span> A FREE UNIX-<span class="keyword">TYPE</span> <span class="type">OPTERATING </span>SYSTEM.</span><br><span class="line">testfile_1:THIS <span class="keyword">IS</span> A LINUX TESTFILE!  </span><br><span class="line">testfile_2:HELLO LINUX!  </span><br><span class="line">testfile_2:Linux <span class="keyword">is</span> a free unix-<span class="keyword">type</span> <span class="type">opterating </span>system. </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>IIS7伪静态化URL Rewrite模块</title>
    <url>/2012/03/10/1191/</url>
    <content><![CDATA[<p>在Win7安装了IIS7.5之后,搭建一些网站或者博客,但是IIS7.5本身没有URL Rewrite功能,也就是无法实现网址的伪静态化.<br>从网上找了一下,原来微软IIS官方网站给IIS7及以后续版本提供了个URL重写组件.<br>下载地址:<a href="http://www.iis.net/download/URLRewrite">http://www.iis.net/download/URLRewrite</a><br>首先,打开上面网址,到IIS官方网站下载模块.<br>根据需要,点击右侧的下载链接(操作系统是64位的,就下载x64版本;32位的系统,就下载x86版本)<br>下载完成之后,安装重写模块.<br>下载的是本地msi包(rewrite_2.0_rtw_x64.msi或者rewrite_2.0_rtw_x86.msi),双击安装即可(安装之前最好先停止IIS服务,如果IIS服务没停的话,安装完成后会要求重启系统.)<br>安装完成后,打开”Internet 信息服务(IIS)管理器”,就可以看见模块中多了一个Url Rewrite 模块.<br>进入需要设置的站点,双击 Url Rewrite 图标,进入设置界面.<br>点击Add Rule(s)输入Rewrite重写规则.<br>确认无误后,点击右栏的”应用”按钮,大功告成.</p>
]]></content>
  </entry>
  <entry>
    <title>iis无法打开svc文件提示404的解决办法</title>
    <url>/2019/05/23/1193/</url>
    <content><![CDATA[<p>打开服务器管理器,选择添加角色和功能.<br>在功能标签页之前全部默认下一步.<br>在功能标签页.NET Framework 4.5功能下拉,全选WCF服务里的所有内容.<br>然后安装,就解决了这个问题.</p>
]]></content>
  </entry>
  <entry>
    <title>iptables(防火墙)允许和拒绝某个IP的命令</title>
    <url>/2017/04/26/1194/</url>
    <content><![CDATA[<p>第一个是拒绝某个IP:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -s <span class="number">173.252</span>.<span class="number">192.205</span> -j DROP</span><br></pre></td></tr></table></figure>
<p>第二个是允许某个IP:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -s <span class="number">173.252</span>.<span class="number">192.205</span> -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>本站之前写了如何删除以创建的防火墙规则大家可以一起使用.</p>
]]></content>
  </entry>
  <entry>
    <title>ISPConfig 3.0.4.X 中文语言包下载(原创)</title>
    <url>/2014/08/03/1196/</url>
    <content><![CDATA[<p>2019年8月16日更新:<br>该文件已经丢失了,大家关了这个网页吧.</p>
<p>ISPConfig 是Linux的一款开源的虚拟主机管理程序,带Web控制面板,可通过Web控制面板管理虚拟主机、开设网站、开设邮箱、开设和管理mysql数据库、支 持DNS解析和监控服务器运行状况等功能.支持中文.<br>最新闲来无事做了ispconfig 3.0.4.1的中文汉化包,喜欢的自己下载使用吧,使用方法我之前写过,这里不再说了,大家自己搜索一下吧.</p>
<p><a href="http://shuxun.wang/download/ispconfig3.0.4.1%E6%B1%89%E5%8C%96%E5%8C%85.zip">http://shuxun.wang/download/ispconfig3.0.4.1汉化包.zip</a></p>
]]></content>
  </entry>
  <entry>
    <title>ispconfig安装中文包的方法</title>
    <url>/2016/06/15/1197/</url>
    <content><![CDATA[<p>由于面板更新频繁,中文包这里不提供下载.</p>
<p>点击system-import-select language file后面浏览到网上下载的中文包.<br>点击import the selected language file就可以导入中文包了.<br>然后进入tool-password and language里面的language里面就可以修改系统语言了.</p>
]]></content>
  </entry>
  <entry>
    <title>iptables规则</title>
    <url>/2017/08/31/1195/</url>
    <content><![CDATA[<p>1、关闭所有的 INPUT FORWARD OUTPUT 只对某些端口开放</p>
<p>下面是命令实现:</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">iptables -P <span class="meta">INPUT</span> <span class="meta">DROP</span></span><br><span class="line">iptables -P FORWARD <span class="meta">DROP</span></span><br><span class="line">iptables -P <span class="meta">OUTPUT</span> <span class="meta">DROP</span></span><br></pre></td></tr></table></figure>

<p>再用命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables -L -n</span></span><br></pre></td></tr></table></figure>

<p>查看 是否设置好, 好看到全部 DROP 了.<br>这样的设置好了,我们只是临时的, 重启服务器还是会恢复原来没有设置的状态.<br>还要使用:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service iptables save</span></span><br></pre></td></tr></table></figure>

<p>进行保存.<br>看到信息 firewall rules 防火墙的规则 其实就是保存在 <code>/etc/sysconfig/iptables</code>.<br>可以打开文件查看.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>2、下面我只打开22端口,看我是如何操作的,就是下面2个语句</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> tcp --sport <span class="number">22</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>再查看下 <code>iptables -L -n</code> 是否添加上去, 看到添加了.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Chain</span> INPUT (policy DROP)</span><br><span class="line"><span class="attribute">target</span> prot opt source destination</span><br><span class="line"><span class="attribute">ACCEPT</span> tcp -- <span class="number">0.0.0.0</span>/<span class="number">0</span> <span class="number">0.0.0.0</span>/<span class="number">0</span> tcp dpt:<span class="number">22</span></span><br><span class="line"><span class="attribute">Chain</span> FORWARD (policy DROP)</span><br><span class="line"><span class="attribute">target</span> prot opt source destination</span><br><span class="line"><span class="attribute">Chain</span> OUTPUT (policy DROP)</span><br><span class="line"><span class="attribute">target</span> prot opt source destination</span><br><span class="line"><span class="attribute">ACCEPT</span> tcp -- <span class="number">0.0.0.0</span>/<span class="number">0</span> <span class="number">0.0.0.0</span>/<span class="number">0</span> tcp spt:<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>现在Linux服务器只打开了22端口,用putty.exe测试一下是否可以链接上去.<br>可以链接上去了,说明没有问题.<br>最后别忘记了保存 对防火墙的设置.<br>通过命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service iptables save</span></span><br></pre></td></tr></table></figure>

<p>进行保存.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> tcp --sport <span class="number">22</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>针对这2条命令进行一些讲解吧:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-A 参数就看成是添加一条 <span class="keyword">INPUT</span> 的规则</span><br><span class="line">-p 指定是什么协议 我们常用的tcp 协议,当然也有udp 例如<span class="number">53</span>端口的DNS</span><br><span class="line">到时我们要配置DNS用到<span class="number">53</span>端口 大家就会发现使用udp协议的</span><br><span class="line">而 <span class="comment">--dport 就是目标端口 当数据从外部进入服务器为目标端口</span></span><br><span class="line">反之 数据从服务器出去 则为数据源端口 使用 <span class="comment">--sport</span></span><br><span class="line">-j 就是指定是 ACCEPT 接收 或者 <span class="keyword">DROP</span> 不接收</span><br></pre></td></tr></table></figure>

<p>3、禁止某个IP访问</p>
<p>1台Linux服务器,2台windows xp 操作系统进行访问.<br>Linux服务器ip 192.168.1.99<br>xp1 ip: 192.168.1.2<br>xp2 ip: 192.168.1.8<br>下面看看我2台xp 都可以访问的.<br>192.168.1.2 这是 xp1 可以访问的,<br>192.168.1.8 xp2 也是可以正常访问的.<br>那么现在我要禁止 192.168.1.2 xp1 访问, xp2 正常访问,<br>下面看看演示:<br>通过命令:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp -s <span class="number">192.168</span>.<span class="number">1.2</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>这里意思就是 -A 就是添加新的规则, 怎样的规则呢? 由于我们访问网站使用tcp的,<br>我们就用 -p tcp , 如果是 udp 就写udp,这里就用tcp了, -s就是 来源的意思,<br>ip来源于 192.168.1.2 ,-j 怎么做 我们拒绝它 这里应该是 DROP.<br>好,看看效果.好添加成功.下面进行验证 一下是否生效.<br>一直出现等待状态 最后 该页无法显示 ,这是 192.168.1.2 xp1 的访问被拒绝了.<br>再看看另外一台 xp 是否可以访问, 是可以正常访问的 192.168.1.8 是可以正常访问的.</p>
<p>4、如何删除规则</p>
<p>首先我们要知道 这条规则的编号,每条规则都有一个编号.<br>通过:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">iptables -L -n --<span class="built_in">line</span>-<span class="keyword">number</span></span><br></pre></td></tr></table></figure>

<p>可以显示规则和相对应的编号.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">num</span> target prot opt source destination</span><br><span class="line"><span class="attribute">1</span> DROP tcp -- <span class="number">0.0.0.0</span>/<span class="number">0</span> <span class="number">0.0.0.0</span>/<span class="number">0</span> tcp dpt:<span class="number">3306</span></span><br><span class="line"><span class="attribute">2</span> DROP tcp -- <span class="number">0.0.0.0</span>/<span class="number">0</span> <span class="number">0.0.0.0</span>/<span class="number">0</span> tcp dpt:<span class="number">21</span></span><br><span class="line"><span class="attribute">3</span> DROP tcp -- <span class="number">0.0.0.0</span>/<span class="number">0</span> <span class="number">0.0.0.0</span>/<span class="number">0</span> tcp dpt:<span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>多了 num 这一列, 这样我们就可以 看到刚才的规则对应的是 编号2.<br>那么我们就可以进行删除了.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -D INPUT <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>删除INPUT链编号为2的规则.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables -L -n</span></span><br></pre></td></tr></table></figure>

<p>查看一下 已经被清除了.</p>
<p>5、过滤无效的数据包</p>
<p>假设有人进入了服务器,或者有病毒木马程序,它可以通过22,80端口像服务器外传送数据.<br>它的这种方式就和我们正常访问22,80端口区别.它发向外发的数据不是我们通过访问网页请求<br>而回应的数据包.<br>下面我们要禁止这些没有通过请求回应的数据包,统统把它们堵住掉.<br>iptables 提供了一个参数 是检查状态的,下面我们来配置下 22 和 80 端口,防止无效的数据包.</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp --sport <span class="number">22</span> -m <span class="keyword">state</span> --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>可以看到和我们以前使用的:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> tcp --sport <span class="number">22</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>多了一个状态判断.<br>同样80端口也一样, 现在删掉原来的2条规则,</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">iptables -L -n --<span class="built_in">line</span>-<span class="keyword">number</span> </span><br></pre></td></tr></table></figure>

<p>这个是查看规则而且带上编号.我们看到编号就可以删除对应的规则了.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -D OUTPUT <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>这里的1表示第一条规则.<br>当你删除了前面的规则, 编号也会随之改变.看到了吧.<br>好,我们删除了前面2个规则,22端口还可以正常使用,说明没问题了.<br>下面进行保存,别忘记了,不然的话重启就会还原到原来的样子.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service iptables save</span></span><br></pre></td></tr></table></figure>

<p>进行保存.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Saving firewall rules to <span class="regexp">/etc/</span>sysconfig/iptables: [ OK ]</span><br></pre></td></tr></table></figure>

<p>其实就是把刚才设置的规则写入到 <code>/etc/sysconfig/iptables</code> 文件中.</p>
<p>6、DNS端口53设置</p>
<p>下面我们来看看如何设置iptables来打开DNS端口,DNS端口对应的是53.<br>大家看到我现在的情况了吧,只开放22和80端口, 我现在看看能不能解析域名.<br>host<a href="http://www.google.com/">www.google.com</a> 输入这个命令后,一直等待,说明DNS不通.<br>出现下面提示 :</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">;; <span class="keyword">connection</span> timed <span class="keyword">out</span>; <span class="keyword">no</span> servers could be reached</span><br></pre></td></tr></table></figure>

<p>ping 一下域名也是不通.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost ~pingwww.google.<span class="keyword">com</span></span><br><span class="line">pin<span class="variable">g:</span> unknown hostwww.google.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>

<p>我这里的原因就是 iptables 限制了53端口.<br>有些服务器,特别是Web服务器减慢,DNS其实也有关系的,无法发送包到DNS服务器导致的.<br>下面演示下如何使用 iptables 来设置DNS 53这个端口,如果你不知道 域名服务端口号,你<br>可以用命令 :</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">grep domain <span class="regexp">/etc/</span>services</span><br><span class="line">[root@localhost ~grep domain <span class="regexp">/etc/</span>services</span><br><span class="line">domain <span class="number">53</span>/tcp <span class="comment"># name-domain server</span></span><br><span class="line">domain <span class="number">53</span>/udp</span><br><span class="line">domaintime <span class="number">9909</span>/tcp <span class="comment"># domaintime</span></span><br><span class="line">domaintime <span class="number">9909</span>/udp <span class="comment"># domaintime</span></span><br></pre></td></tr></table></figure>

<p>看到了吧, 我们一般使用 udp 协议.<br>好了, 开始设置…</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> udp --dport <span class="number">53</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>这是我们 ping 一个域名,数据就是从本机出去,所以我们先设置 OUTPUT,<br>我们按照ping这个流程来设置.<br>然后 DNS 服务器收到我们发出去的包,就回应一个回来.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> udp --sport <span class="number">53</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>同时还要设置:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">A</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> udp --dport <span class="number">53</span> -j ACCEPT</span><br><span class="line">iptables -<span class="selector-tag">A</span> OUTPUT -<span class="selector-tag">p</span> udp --sport <span class="number">53</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>好了, 下面开始测试下, 可以用 iptables -L -n 查看设置情况,确定没有问题就可以测试了.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost ~iptables -L -n</span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">dp</span><span class="variable">t:22</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">dp</span><span class="variable">t:80</span></span><br><span class="line">ACCEPT udp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> udp <span class="keyword">sp</span><span class="variable">t:53</span></span><br><span class="line">ACCEPT udp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> udp <span class="keyword">dp</span><span class="variable">t:53</span></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">Chain OUTPUT (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">sp</span><span class="variable">t:22</span> state ESTABLISHED</span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">sp</span><span class="variable">t:80</span> state ESTABLISHED</span><br><span class="line">ACCEPT udp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> udp <span class="keyword">dp</span><span class="variable">t:53</span></span><br><span class="line">ACCEPT udp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> udp <span class="keyword">sp</span><span class="variable">t:53</span></span><br></pre></td></tr></table></figure>

<p>可以测试一下 是否 DNS 可以通过iptables 了.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost ~hostwww.google.<span class="keyword">com</span></span><br><span class="line">www.google.comis <span class="keyword">an</span> alias forwww.<span class="keyword">l</span>.google.<span class="keyword">com</span>.</span><br><span class="line">www.<span class="keyword">l</span>.google.comis <span class="keyword">an</span> alias <span class="keyword">for</span> www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span>.</span><br><span class="line">www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span> <span class="built_in">has</span> address <span class="number">64.233</span>.<span class="number">189.104</span></span><br><span class="line">www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span> <span class="built_in">has</span> address <span class="number">64.233</span>.<span class="number">189.147</span></span><br><span class="line">www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span> <span class="built_in">has</span> address <span class="number">64.233</span>.<span class="number">189.99</span></span><br></pre></td></tr></table></figure>

<p>正常可以解析 google 域名.<br>ping 方面可能还要设置些东西.<br>用 nslookup 看看吧.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost ~nslookup</span><br><span class="line">&gt;www.google.<span class="keyword">com</span></span><br><span class="line">Server: <span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line">Addres<span class="variable">s:</span> <span class="number">192.168</span>.<span class="number">1.1</span>#<span class="number">53</span></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">www.google.comcanonical name =www.<span class="keyword">l</span>.google.<span class="keyword">com</span>.</span><br><span class="line">www.<span class="keyword">l</span>.google.<span class="keyword">com</span> canonical name = www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span>.</span><br><span class="line">Name: www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span></span><br><span class="line">Addres<span class="variable">s:</span> <span class="number">64.233</span>.<span class="number">189.147</span></span><br><span class="line">Name: www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span></span><br><span class="line">Addres<span class="variable">s:</span> <span class="number">64.233</span>.<span class="number">189.99</span></span><br><span class="line">Name: www-china.<span class="keyword">l</span>.google.<span class="keyword">com</span></span><br><span class="line">Addres<span class="variable">s:</span> <span class="number">64.233</span>.<span class="number">189.104</span></span><br></pre></td></tr></table></figure>

<p>说明本机DNS正常, iptables 允许53这个端口的访问.</p>
<p>7、iptables对ftp的设置</p>
<p>现在我开始对ftp端口的设置,按照我们以前的视频,添加需要开放的端口.<br>ftp连接端口有2个 21 和 20 端口,我现在添加对应的规则.</p>
<figure class="highlight moonscript"><table><tr><td class="code"><pre><span class="line">[root@localhost rootiptables -A INPUT -p tcp <span class="comment">--dport 21 -j ACCEPT</span></span><br><span class="line">[root@localhost rootiptables -A INPUT -p tcp <span class="comment">--dport 20 -j ACCEPT</span></span><br><span class="line">[root@localhost rootiptables -A OUTPUT -p tcp <span class="comment">--sport 21 -j ACCEPT</span></span><br><span class="line">[root@localhost rootiptables -A OUTPUT -p tcp <span class="comment">--sport 20 -j ACCEPT</span></span><br></pre></td></tr></table></figure>

<p>好,这样就添加完了,我们用浏览器访问一下ftp,出现超时.<br>所以我刚才说 ftp 是比较特殊的端口,它还有一些端口是 数据传输端口,<br>例如目录列表, 上传 ,下载 文件都要用到这些端口.<br>而这些端口是 任意 端口… 这个 任意 真的比较特殊.<br>如果不指定什么一个端口范围, iptables 很难对任意端口开放的,<br>如果iptables允许任意端口访问, 那和不设置防火墙没什么区别,所以不现实的.<br>那么我们的解决办法就是 指定这个数据传输端口的一个范围.<br>下面我们修改一下ftp配置文件.<br>我这里使用vsftpd来修改演示,其他ftp我不知道哪里修改,大家可以找找资料.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost rootvi <span class="regexp">/etc/</span>vsftpd.conf</span><br></pre></td></tr></table></figure>

<p>在配置文件的最下面 加入:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">pasv_min_port</span>=<span class="number">30001</span></span><br><span class="line"><span class="attr">pasv_max_port</span>=<span class="number">31000</span></span><br></pre></td></tr></table></figure>

<p>然后保存退出.<br>这两句话的意思告诉vsftpd, 要传输数据的端口范围就在30001到31000 这个范围内传送.<br>这样我们使用 iptables 就好办多了,我们就打开 30001到31000 这些端口.</p>
<figure class="highlight moonscript"><table><tr><td class="code"><pre><span class="line">[root@localhost rootiptables -A INPUT -p tcp <span class="comment">--dport 30001:31000 -j ACCEPT</span></span><br><span class="line">[root@localhost rootiptables -A OUTPUT -p tcp <span class="comment">--sport 30001:31000 -j ACCEPT</span></span><br><span class="line">[root@localhost rootservice iptables save</span><br></pre></td></tr></table></figure>

<p>最后进行保存, 然后我们再用浏览器范围下 ftp.可以正常访问.<br>用个账号登陆上去,也没有问题,上传一些文件上去看看.<br>看到了吧,上传和下载都正常.. 再查看下 iptables 的设置.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@localhost rootiptables -L -n</span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">dp</span><span class="variable">t:22</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">dp</span><span class="variable">t:21</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">dp</span><span class="variable">t:20</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp dpt<span class="variable">s:30001</span>:<span class="number">31000</span></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">Chain OUTPUT (policy DROP)</span><br><span class="line">target prot <span class="keyword">opt</span> <span class="keyword">source</span> destination</span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">sp</span><span class="variable">t:22</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">sp</span><span class="variable">t:21</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp <span class="keyword">sp</span><span class="variable">t:20</span></span><br><span class="line">ACCEPT tcp -- <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span> tcp spt<span class="variable">s:30001</span>:<span class="number">31000</span></span><br></pre></td></tr></table></figure>

<p>这是我为了演示ftp特殊端口做的简单规则,大家可以添加一些对数据包的验证.<br>例如 <code>-m state --state ESTABLISHED,RELATED</code> 等等要求更加高的验证.</p>
]]></content>
  </entry>
  <entry>
    <title>jakarta-tomcat-connectors下载地址</title>
    <url>/2019/05/10/1198/</url>
    <content><![CDATA[<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span>//tomcat.apache<span class="meta">.org</span>/download-connectors.cgi</span><br></pre></td></tr></table></figure>

<p>官方下载页面.</p>
]]></content>
  </entry>
  <entry>
    <title>lamp+ispconfig一键安装</title>
    <url>/2015/10/18/1200/</url>
    <content><![CDATA[<p>ISPconfig这个面板一直在保持更新,界面也简洁.但安装过程还是比较繁琐的,因此我在07年写的lamp半自动安装脚本基础上做了修改:<br>更新了软件,自动修改配置文件,汉化了安装界面,加入了ISPconfig面板,对dovecot的启动错误进行了修复.<br>这是CentOS版.</p>
<p>包含的软件:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="type">BIND9</span> (chrooted)</span><br><span class="line"><span class="type">Apache</span> with <span class="type">SSL</span> sup<span class="keyword">port</span></span><br><span class="line"><span class="type">PHP</span></span><br><span class="line"><span class="type">Python</span></span><br><span class="line"><span class="type">MySQL</span></span><br><span class="line"><span class="title">proftpd</span></span><br><span class="line"><span class="title">postfix</span></span><br><span class="line"><span class="title">dovecot</span></span><br><span class="line"><span class="type">Webalizer</span></span><br><span class="line"><span class="type">ISPconfig</span></span><br></pre></td></tr></table></figure>

<p>安装方法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>)首先请设置你的ssh软件支持UTF8编码,要不然可能会出现乱码.</span><br><span class="line"><span class="number">2</span>)用文本编辑器打开lampi.sh,自定义mySQL密码和其他一些参数.</span><br><span class="line">(在文件头部,打开后一下就能看到了,当然你也可以不修改,采取默认设置.).</span><br><span class="line"><span class="number">3</span>)上传lampi.sh和proftpd文件.</span><br><span class="line"><span class="number">4</span>)修改权限</span><br><span class="line">chmod <span class="number">777</span> lampi.sh</span><br><span class="line"><span class="number">5</span>)运行脚本</span><br><span class="line">./lampi.sh</span><br><span class="line"><span class="number">6</span>)按中文提示操作即可.但在安装ISPconfig时提示是英文的,需要输入sql密码,你的地址,邮箱之类的信息.</span><br><span class="line"><span class="number">7</span>)完成安装</span><br><span class="line"></span><br><span class="line"><span class="comment">#默认mySQL用户名root,密码123456</span></span><br><span class="line"><span class="comment">#面板在http://ip:8080,用户名admin,密码admin.</span></span><br><span class="line"><span class="comment">#默认设置下的网络安装:</span></span><br><span class="line"></span><br><span class="line">wget http:<span class="regexp">//</span>www.kudouzi.com<span class="regexp">/download/</span>lampi.sh</span><br><span class="line">wget http:<span class="regexp">//</span>www.kudouzi.com<span class="regexp">/download/</span>proftpd</span><br><span class="line">chmod <span class="number">777</span> lampi.sh</span><br><span class="line">./lampi.sh</span><br></pre></td></tr></table></figure>

<p>官方演示地址:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">http://demo3.ispconfig.org/</span></span><br><span class="line"></span><br><span class="line">管理员面板</span><br><span class="line"><span class="section">用户名: admin</span></span><br><span class="line"><span class="section">密码: demo</span></span><br><span class="line"></span><br><span class="line">Reseller面板</span><br><span class="line"><span class="section">用户名: reseller</span></span><br><span class="line"><span class="section">密码: demo</span></span><br><span class="line"></span><br><span class="line">客户面板</span><br><span class="line"><span class="section">用户名: client</span></span><br><span class="line"><span class="section">密码: demo</span></span><br></pre></td></tr></table></figure>

<p>其他:</p>
<p>在DS4刀机器上测试安装成功,没优化的情况下重启后的初始内存消耗略小于200MB,其中DNS和邮件服务占了85MB,还有个叫brcm_iscsiuio(这是干嘛的?SCSI磁盘服务?)的进程占了20MB.<br>中文语言包网上有,请google.</p>
]]></content>
  </entry>
  <entry>
    <title>lastlog命令详解</title>
    <url>/2019/01/02/1201/</url>
    <content><![CDATA[<p>lastlog文件在每次有用户登录时被查询.可以使用lastlog命令检查某特定用户上次登录的时间,并格式化输出上次登录日志 <code>/var/log/lastlog</code>的内容.它根据UID排序显示登录名、端口号(tty)和上次登录时间.如果一个用户从未登录过,lastlog显示**Never logged**.注意需要以root身份运行该命令.运行该命令如下所示:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">$ lastlog</span><br><span class="line"></span><br><span class="line">用户名     最后登陆时间</span><br><span class="line">root      <span class="strong">**从未登录过**</span></span><br><span class="line">bin       <span class="strong">**从未登录过**</span></span><br><span class="line">daemon    <span class="strong">**从未登录过**</span></span><br><span class="line">adm       <span class="strong">**从未登录过**</span></span><br><span class="line">lp        <span class="strong">**从未登录过**</span></span><br><span class="line">sync      <span class="strong">**从未登录过**</span></span><br><span class="line">shutdown  <span class="strong">**从未登录过**</span></span><br><span class="line">halt      <span class="strong">**从未登录过**</span></span><br><span class="line">mail      <span class="strong">**从未登录过**</span></span><br><span class="line">news      <span class="strong">**从未登录过**</span></span><br><span class="line">uucp      <span class="strong">**从未登录过**</span></span><br><span class="line">operator  <span class="strong">**从未登录过**</span></span><br><span class="line">games     <span class="strong">**从未登录过**</span></span><br><span class="line">gopher    <span class="strong">**从未登录过**</span></span><br><span class="line">ftp       <span class="strong">**从未登录过**</span></span><br><span class="line">nobody    <span class="strong">**从未登录过**</span></span><br><span class="line">rpm       <span class="strong">**从未登录过**</span></span><br><span class="line">dbus      <span class="strong">**从未登录过**</span></span><br><span class="line">avahi     <span class="strong">**从未登录过**</span></span><br><span class="line">mailnull  <span class="strong">**从未登录过**</span></span><br><span class="line">smmsp     <span class="strong">**从未登录过**</span></span><br><span class="line">nscd      <span class="strong">**从未登录过**</span></span><br><span class="line">vcsa      <span class="strong">**从未登录过**</span></span><br><span class="line">haldaemon <span class="strong">**从未登录过**</span></span><br><span class="line">rpc       <span class="strong">**从未登录过**</span></span><br><span class="line">rpcuser   <span class="strong">**从未登录过**</span></span><br><span class="line">sshd      <span class="strong">**从未登录过**</span></span><br><span class="line">pcap      <span class="strong">**从未登录过**</span></span><br><span class="line">ntp       <span class="strong">**从未登录过**</span></span><br><span class="line">gdm       <span class="strong">**从未登录过**</span></span><br><span class="line">apache    <span class="strong">**从未登录过**</span></span><br><span class="line">distcache <span class="strong">**从未登录过**</span></span><br><span class="line">postgres  <span class="strong">**从未登录过**</span></span><br><span class="line">mysql     <span class="strong">**从未登录过**</span></span><br><span class="line">dovecot   <span class="strong">**从未登录过**</span></span><br><span class="line">webalizer <span class="strong">**从未登录过**</span></span><br><span class="line">squid     <span class="strong">**从未登录过**</span></span><br><span class="line">named     <span class="strong">**从未登录过**</span></span><br><span class="line">xfs       <span class="strong">**从未登录过**</span></span><br><span class="line">sabayon   <span class="strong">**从未登录过**</span></span><br><span class="line">postfix   <span class="strong">**从未登录过**</span></span><br><span class="line">amanda    <span class="strong">**从未登录过**</span></span><br><span class="line">cyrus     <span class="strong">**从未登录过**</span></span><br><span class="line">mailman   <span class="strong">**从未登录过**</span></span><br><span class="line">radiusd   <span class="strong">**从未登录过**</span></span><br><span class="line">exim      <span class="strong">**从未登录过**</span></span><br><span class="line">privoxy   <span class="strong">**从未登录过**</span></span><br><span class="line">quagga    <span class="strong">**从未登录过**</span></span><br><span class="line">radvd     <span class="strong">**从未登录过**</span></span><br><span class="line">ldap      <span class="strong">**从未登录过**</span></span><br><span class="line">tomcat    <span class="strong">**从未登录过**</span></span><br><span class="line">pegasus   <span class="strong">**从未登录过**</span></span><br><span class="line">liyang    <span class="strong">**从未登录过**</span></span><br><span class="line">google    <span class="strong">**从未登录过**</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>jinterface  No Java compiler found</title>
    <url>/2015/06/29/1199/</url>
    <content><![CDATA[<p>没有java编译器?其实这里我们可以选择用gcc等其他方式来编译erlang.<br>如果你安装了gcc,这里就用不上java编译了,因此可以在configure时增加:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">–<span class="keyword">without</span>-javac</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux crontab 用法</title>
    <url>/2013/03/19/1202/</url>
    <content><![CDATA[<p>安装crontab:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@CentOS</span> ~]<span class="variable">$ </span>yum install vixie-cron</span><br><span class="line">[root<span class="variable">@CentOS</span> ~]<span class="variable">$ </span>yum install crontabs</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">vixie-cron软件包是cron的主程序.</span><br><span class="line">crontabs软件包是用来安装、卸装、或列举用来驱动 cron 守护进程的表格的程序.</span><br><span class="line">cron 是linux的内置服务,但它不自动起来,可以用以下的方法启动、关闭这个服务:</span><br></pre></td></tr></table></figure>

<p>基本命令:</p>
<p>服务的启动和关闭:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/sbin/</span>service crond start <span class="regexp">//</span>启动服务</span><br><span class="line"><span class="regexp">/sbin/</span>service crond stop <span class="regexp">//</span>关闭服务</span><br><span class="line"><span class="regexp">/sbin/</span>service crond restart <span class="regexp">//</span>重启服务</span><br><span class="line"><span class="regexp">/sbin/</span>service crond reload <span class="regexp">//</span>重新载入配置</span><br></pre></td></tr></table></figure>

<p>查看crontab服务状态:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service crond status</span></span><br></pre></td></tr></table></figure>

<p>手动启动crontab服务:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service crond <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>查看crontab服务是否已设置为开机启动,执行命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ntsysv</span></span><br></pre></td></tr></table></figure>

<p>加入开机自动启动:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> --level <span class="number">35</span> crond <span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p>crontab命令:</p>
<p>功能说明:设置计时器.</p>
<p>语法:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">crontab <span class="selector-attr">[-u &lt;用户名称&gt;]</span><span class="selector-attr">[配置文件]</span> 或 crontab <span class="selector-attr">[-u &lt;用户名称&gt;]</span><span class="selector-attr">[-elr]</span></span><br></pre></td></tr></table></figure>

<p>补充说明:cron是一个常驻服务,它提供计时器的功能,让用户在特定的时间得以执行预设的指令或程序.只要用户会编辑计时器的配置文件,就可以使用计时器的功能.其配置文件格式如下:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Minute</span> <span class="built_in">Hour</span> <span class="built_in">Day</span> <span class="built_in">Month</span> DayOFWeek Command</span><br></pre></td></tr></table></figure>

<p>参数:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-e 　         编辑该用户的计时器设置.</span></span><br><span class="line"><span class="deletion">-l 　         列出该用户的计时器设置.</span></span><br><span class="line"><span class="deletion">-r 　         删除该用户的计时器设置.</span></span><br><span class="line"><span class="deletion">-u&lt;用户名称&gt; 　指定要设定计时器的用户名称.</span></span><br></pre></td></tr></table></figure>

<p>crontab 格式:</p>
<p>基本格式 :</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">*</span> <span class="emphasis">*　 *</span>　 <span class="emphasis">*　 *</span>　　command</span><br><span class="line">分　时　日　月　周　 命令</span><br><span class="line">第1列表示分钟1～59 每分钟用<span class="emphasis">*或者 *</span>/1表示</span><br><span class="line">第2列表示小时1～23(0表示0点)</span><br><span class="line">第3列表示日期1～31</span><br><span class="line">第4列表示月份1～12</span><br><span class="line">第5列标识号星期0～6(0表示星期天)</span><br><span class="line">第6列要运行的命令</span><br></pre></td></tr></table></figure>

<p>crontab文件的一些例子:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="number">30</span> <span class="number">21</span> * * * <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每晚的<span class="number">21</span>:<span class="number">30</span>重启apache.</span><br><span class="line"></span><br><span class="line"><span class="number">45</span> <span class="number">4</span> <span class="number">1</span>,<span class="number">10</span>,<span class="number">22</span> * * <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每月<span class="number">1</span>、<span class="number">10</span>、<span class="number">22</span>日的<span class="number">4</span> : <span class="number">45</span>重启apache.</span><br><span class="line"></span><br><span class="line"><span class="number">10</span> <span class="number">1</span> * * <span class="number">6</span>,<span class="number">0</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每周六、周日的<span class="number">1</span> : <span class="number">10</span>重启apache.</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>,<span class="number">30</span> <span class="number">18</span>-<span class="number">23</span> * * * <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">上面的例子表示在每天<span class="number">18</span> : <span class="number">00</span>至<span class="number">23</span> : <span class="number">00</span>之间每隔<span class="number">30</span>分钟重启apache.</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">23</span> * * <span class="number">6</span> <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每星期六的<span class="number">11</span> : <span class="number">00</span> pm重启apache.</span><br><span class="line"></span><br><span class="line">* *<span class="regexp">/1 * * * /u</span>sr<span class="regexp">/local/</span>etc<span class="regexp">/rc.d/</span>lighttpd restart</span><br><span class="line">每一小时重启apache</span><br><span class="line"></span><br><span class="line">* <span class="number">23</span>-<span class="number">7</span><span class="regexp">/1 * * * /u</span>sr<span class="regexp">/local/</span>etc<span class="regexp">/rc.d/</span>lighttpd restart</span><br><span class="line">晚上<span class="number">11</span>点到早上<span class="number">7</span>点之间,每隔一小时重启apache</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">11</span> <span class="number">4</span> * mon-wed <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">每月的<span class="number">4</span>号与每周一到周三的<span class="number">11</span>点重启apache</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">4</span> <span class="number">1</span> jan * <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d/lighttpd restart</span><br><span class="line">一月一号的<span class="number">4</span>点重启apache</span><br><span class="line"></span><br><span class="line">*<span class="regexp">/30 * * * * /u</span>sr<span class="regexp">/sbin/</span>ntpdate <span class="number">210.72</span>.<span class="number">145.44</span></span><br><span class="line">每半小时同步一下时间</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux 如何禁止用户登录</title>
    <url>/2012/09/07/1206/</url>
    <content><![CDATA[<p>在Linux上,有多种方式让不安份的用户无法登录.</p>
<p>1.修改用户配置文件 <code>/etc/shadow</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>shadow</span><br></pre></td></tr></table></figure>

<p>将第二栏设置为”*“,如下.那么该用户就无法登录.但是使用这种方式会导致该用户的密码丢失,也就是当你再次允许他登录的时候,你还得让他重新设置密码.[再次启用这个帐号的方法是把”*”去掉就可以了.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">dduyoung</span>:*:<span class="number">14245</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br></pre></td></tr></table></figure>

<p>2.使用命令usermod</p>
<p>这个方式简单又实用,而且没有1中的副作用.</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">usermod -L dduyoung ##Lock 帐号dduyoung</span><br><span class="line">usermod -U dduyoung ##Unlock 帐号dduyoung</span><br></pre></td></tr></table></figure>

<p>3.通过修改shell类型</p>
<p>这种方式会更加人性化一点,因为你不仅可以禁止用户登录,还可以告诉他你这么做的原因.如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chsh dduyoung -s <span class="regexp">/sbin/</span>nologin <span class="comment">#将用户dduyoung的shell进行更改</span></span><br></pre></td></tr></table></figure>

<p>修改/etc/nologin.txt(没有就新建一个):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nologin.txt</span><br></pre></td></tr></table></figure>

<p>在里面添加给被禁止用户的提示.<br>解禁用户的方式就是把shell改为他原有的就可以了.</p>
<p>4.禁止所有的用户登录</p>
<p>当你(如果你是系统管理员)不想让所有用户登录时(比如你要维护系统升级什么的),如果按上面的方式,一个一个地去禁止用户登录,这将是很……无聊的事.而且还容易出错.下面有一种简洁有效的方式:<br>在 <code>/etc</code>目录下建立一个nologin文档.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">touch <span class="regexp">/etc/</span>nologin <span class="comment">##如果该文件存在,那么Linux上的所有用户(除了root以外)都无法登录</span></span><br></pre></td></tr></table></figure>

<p>在 <code>/etc/nologin</code>(注意:这可不是3中的nologin.txt啊!)写点什么,告诉用户为何无法登录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/etc/</span>nologin</span><br></pre></td></tr></table></figure>

<p>9:00－10:00 系统升级,所有用户都禁止登录!<br>解禁帐号也简单,直接将/etc/nologin删除就行了!</p>
]]></content>
  </entry>
  <entry>
    <title>Linux php.ini的安全优化配置</title>
    <url>/2018/02/24/1203/</url>
    <content><![CDATA[<p>1、PHP函数禁用找到</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">disable_functions</span> =</span><br></pre></td></tr></table></figure>

<p>该选项可以设置哪些PHP函数是禁止使用的,PHP中有一些函数的风险性还是相当大的,可以直接执行一些CentOS系统级脚本命令,如果允许这些函数执行,当PHP 程序出现漏洞时,损失是非常严重的!以下我们给出推荐的禁用函数设置:</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">disable_functions = phpinfo,passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,<span class="keyword">popen</span>,chroot,escapeshellcmd,escapeshellarg,shell_exec,proc_open,proc_get_status</span><br></pre></td></tr></table></figure>

<p>需注意:如果您的服务器中含有一些CentOS系统状态检测的PHP程序,则不要禁用shell_exec,proc_open,proc_get_status等函数.</p>
<p>2、PHP脚本执行时间找到</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">max_execution_time</span> = <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>该选项设定PHP程序的最大执行时间,如果一个PHP脚本被请求,且该PHP脚本在max_execution_time时间内没能执行完毕,则PHP不再继续执行,直接给客户端返回超时错误.没有特殊需要该选项可保持默认设置30秒,如果您的PHP脚本确实需要长执行时间则可以适当增大该时间设置.</p>
<p>3、PHP脚本处理内存占用找到</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">memory_limit</span> = <span class="number">8</span>M</span><br></pre></td></tr></table></figure>

<p>该选项指定PHP脚本处理所能占用的最大内存,默认为8MB,如果您的服务器内存为1GB以上,则该选项可以设置为12MB以获得更快的PHP脚本处理效率.</p>
<p>4、PHP全局函数声明找到</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">register_globals</span> = <span class="literal">Off</span></span><br></pre></td></tr></table></figure>

<p>网络上很多关于PHP设置的文章都推荐将该选项设置为On,其实这是一种及其危险的设置方法,很可能引起严重的安全性问题.如果没有特殊的需要,强烈推荐保留默认设置!</p>
<p>5、PHP上传文件大小限制找到</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">upload_max_filesize</span> = <span class="number">2</span>M</span><br></pre></td></tr></table></figure>

<p>该选项设定PHP所能允许最大上传文件大小,默认为2MB.根据实际应用需求,可以适当增大该设置.</p>
<p>6、几个地方的检查</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">查找:display_errors</span><br><span class="line">如果是<span class="keyword">On</span>的话改成<span class="keyword">Off</span></span><br><span class="line">查找:magic_quotes_gpc</span><br><span class="line">如果是<span class="keyword">Off</span>的话改成<span class="keyword">On</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux 发送邮件</title>
    <url>/2013/07/26/1205/</url>
    <content><![CDATA[<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mail</span> -s <span class="string">&quot;Title&quot;</span> root</span><br></pre></td></tr></table></figure>

<p>回车后输入邮件内容,内容输完后,按两次ctrl+D键,就发送了.</p>
<p>或者,事先写好邮件保存在mail.txt中.</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">cat mail.txt | mail -s <span class="string">&quot;Title&quot;</span><span class="built_in"> root</span></span><br><span class="line">mail -s <span class="string">&quot;Title&quot;</span><span class="built_in"> root</span> &lt; mail.txt</span><br></pre></td></tr></table></figure>

<p>再或者:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">cat mail.txt | <span class="regexp">/usr/</span>sbin/sendmail -i root</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux top命令详解</title>
    <url>/2011/03/28/1204/</url>
    <content><![CDATA[<p>top命令是Linux下常用的性能分析工具,能够实时显示系统中各个进程的资源占用状况,类似于Windows的任务管理器.下面详细介绍它的使用方法.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">top</span> - <span class="number">01</span>:<span class="number">06</span>:<span class="number">48</span> up <span class="number">1</span>:<span class="number">22</span>, <span class="number">1</span> user, load average: <span class="number">0</span>.<span class="number">06</span>, <span class="number">0</span>.<span class="number">60</span>, <span class="number">0</span>.<span class="number">48</span></span><br><span class="line"><span class="attribute">Tasks</span>: <span class="number">29</span> total, <span class="number">1</span> running, <span class="number">28</span> sleeping, <span class="number">0</span> stopped, <span class="number">0</span> zombie</span><br><span class="line"><span class="attribute">Cpu</span>(s): <span class="number">0</span>.<span class="number">3</span>% us, <span class="number">1</span>.<span class="number">0</span>% sy, <span class="number">0</span>.<span class="number">0</span>% ni, <span class="number">98</span>.<span class="number">7</span>% id, <span class="number">0</span>.<span class="number">0</span>% wa, <span class="number">0</span>.<span class="number">0</span>% hi, <span class="number">0</span>.<span class="number">0</span>% si</span><br><span class="line"><span class="attribute">Mem</span>: <span class="number">191272</span>k total, <span class="number">173656</span>k used, <span class="number">17616</span>k free, <span class="number">22052</span>k buffers</span><br><span class="line"><span class="attribute">Swap</span>: <span class="number">192772</span>k total, <span class="number">0</span>k used, <span class="number">192772</span>k free, <span class="number">123988</span>k cached</span><br><span class="line"></span><br><span class="line"><span class="attribute">PID</span> USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND</span><br><span class="line"><span class="attribute">1379</span> root <span class="number">16</span> <span class="number">0</span> <span class="number">7976</span> <span class="number">2456</span> <span class="number">1980</span> S <span class="number">0</span>.<span class="number">7</span> <span class="number">1</span>.<span class="number">3</span> <span class="number">0</span>:<span class="number">11</span>.<span class="number">03</span> sshd</span><br><span class="line"><span class="attribute">14704</span> root <span class="number">16</span> <span class="number">0</span> <span class="number">2128</span> <span class="number">980</span> <span class="number">796</span> R <span class="number">0</span>.<span class="number">7</span> <span class="number">0</span>.<span class="number">5</span> <span class="number">0</span>:<span class="number">02</span>.<span class="number">72</span> top</span><br><span class="line"><span class="attribute">1</span> root <span class="number">16</span> <span class="number">0</span> <span class="number">1992</span> <span class="number">632</span> <span class="number">544</span> S <span class="number">0</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">3</span> <span class="number">0</span>:<span class="number">00</span>.<span class="number">90</span> init</span><br><span class="line"><span class="attribute">2</span> root <span class="number">34</span> <span class="number">19</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> S <span class="number">0</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span> <span class="number">0</span>:<span class="number">00</span>.<span class="number">00</span> ksoftirqd/<span class="number">0</span></span><br><span class="line"><span class="attribute">3</span> root RT <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> S <span class="number">0</span>.<span class="number">0</span> <span class="number">0</span>.<span class="number">0</span> <span class="number">0</span>:<span class="number">00</span>.<span class="number">00</span> watchdog/<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>统计信息区</p>
<p>前五行是系统整体的统计信息.第一行是任务队列信息,同 uptime 命令的执行结果.其内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">01</span>:<span class="number">06</span>:<span class="number">48</span> 当前时间</span><br><span class="line"><span class="attribute">up</span> <span class="number">1</span>:<span class="number">22</span> 系统运行时间,格式为时:分</span><br><span class="line"><span class="attribute">1</span> user 当前登录用户数</span><br><span class="line"><span class="attribute">load</span> average: <span class="number">0</span>.<span class="number">06</span>, <span class="number">0</span>.<span class="number">60</span>, <span class="number">0</span>.<span class="number">48</span> 系统负载,即任务队列的平均长度.</span><br><span class="line"><span class="comment"># 三个数值分别为 1分钟、5分钟、15分钟前到现在的平均值.</span></span><br></pre></td></tr></table></figure>

<p>第二、三行为进程和CPU的信息.当有多个CPU时,这些内容可能会超过两行.内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Tasks</span>: <span class="number">29</span> total 进程总数</span><br><span class="line"><span class="attribute">1</span> running 正在运行的进程数</span><br><span class="line"><span class="attribute">28</span> sleeping 睡眠的进程数</span><br><span class="line"><span class="attribute">0</span> stopped 停止的进程数</span><br><span class="line"><span class="attribute">0</span> zombie 僵尸进程数</span><br><span class="line"><span class="attribute">Cpu</span>(s): <span class="number">0</span>.<span class="number">3</span>% us 用户空间占用CPU百分比</span><br><span class="line"><span class="attribute">1</span>.<span class="number">0</span>% sy 内核空间占用CPU百分比</span><br><span class="line"><span class="attribute">0</span>.<span class="number">0</span>% ni 用户进程空间内改变过优先级的进程占用CPU百分比</span><br><span class="line"><span class="attribute">98</span>.<span class="number">7</span>% id 空闲CPU百分比</span><br><span class="line"><span class="attribute">0</span>.<span class="number">0</span>% wa 等待输入输出的CPU时间百分比</span><br><span class="line"><span class="attribute">0</span>.<span class="number">0</span>% hi</span><br><span class="line"><span class="attribute">0</span>.<span class="number">0</span>% si</span><br></pre></td></tr></table></figure>

<p>最后两行为内存信息.内容如下:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">Mem:</span> <span class="number">191272</span>k total 物理内存总量</span><br><span class="line"><span class="number">173656</span>k used 使用的物理内存总量</span><br><span class="line"><span class="number">17616</span>k free 空闲内存总量</span><br><span class="line"><span class="number">22052</span>k <span class="keyword">buffers </span>用作内核缓存的内存量</span><br><span class="line"><span class="keyword">Swap: </span><span class="number">192772</span>k total 交换区总量</span><br><span class="line"><span class="number">0</span>k used 使用的交换区总量</span><br><span class="line"><span class="number">192772</span>k free 空闲交换区总量</span><br><span class="line"><span class="number">123988</span>k <span class="keyword">cached </span>缓冲的交换区总量.</span><br></pre></td></tr></table></figure>

<p>内存中的内容被换出到交换区,而后又被换入到内存,但使用过的交换区尚未被覆盖,<br>该数值即为这些内容已存在于内存中的交换区的大小.<br>相应的内存再次被换出时可不必再对交换区写入.</p>
<p>进程信息区</p>
<p>统计信息区域的下方显示了各个进程的详细信息.首先来认识一下各列的含义.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">序号 列名 含义</span><br><span class="line">a PID 进程id</span><br><span class="line">b PPID 父进程id</span><br><span class="line">c RUSER Real<span class="built_in"> user </span>name</span><br><span class="line">d UID 进程所有者的用户id</span><br><span class="line">e<span class="built_in"> USER </span>进程所有者的用户名</span><br><span class="line">f<span class="built_in"> GROUP </span>进程所有者的组名</span><br><span class="line">g TTY 启动进程的终端名.不是从终端启动的进程则显示为 ?</span><br><span class="line">h PR 优先级</span><br><span class="line">i NI nice值.负值表示高优先级,正值表示低优先级</span><br><span class="line">j P 最后使用的CPU,仅在多CPU环境下有意义</span><br><span class="line">k %CPU 上次更新到现在的CPU时间占用百分比</span><br><span class="line">l TIME 进程使用的CPU时间总计,单位秒</span><br><span class="line">m TIME+ 进程使用的CPU时间总计,单位1/100秒</span><br><span class="line">n %MEM 进程使用的物理内存百分比</span><br><span class="line">o VIRT 进程使用的虚拟内存总量,单位kb.<span class="attribute">VIRT</span>=SWAP+RES</span><br><span class="line">p SWAP 进程使用的虚拟内存中,被换出的大小,单位kb.</span><br><span class="line">q RES 进程使用的、未被换出的物理内存大小,单位kb.<span class="attribute">RES</span>=CODE+DATA</span><br><span class="line">r CODE 可执行代码占用的物理内存大小,单位kb</span><br><span class="line">s DATA 可执行代码以外的部分(数据段+栈)占用的物理内存大小,单位kb</span><br><span class="line">t SHR 共享内存大小,单位kb</span><br><span class="line">u nFLT 页面错误次数</span><br><span class="line">v nDRT 最后一次写入到现在,被修改过的页面数.</span><br><span class="line">w S 进程状态.</span><br><span class="line"><span class="attribute">D</span>=不可中断的睡眠状态</span><br><span class="line"><span class="attribute">R</span>=运行</span><br><span class="line"><span class="attribute">S</span>=睡眠</span><br><span class="line"><span class="attribute">T</span>=跟踪/停止</span><br><span class="line"><span class="attribute">Z</span>=僵尸进程</span><br><span class="line">x COMMAND 命令名/命令行</span><br><span class="line">y WCHAN 若该进程在睡眠,则显示睡眠中的系统函数名</span><br><span class="line">z Flags 任务标志,参考 sched.h</span><br></pre></td></tr></table></figure>

<p>默认情况下仅显示比较重要的 PID、USER、PR、NI、VIRT、RES、SHR、S、%CPU、%MEM、TIME+、COMMAND 列.可以通过下面的快捷键来更改显示内容.</p>
<p>更改显示内容</p>
<p>通过 f 键可以选择显示的内容.按 f 键之后会显示列的列表,按 a-z 即可显示或隐藏对应的列,最后按回车键确定.</p>
<p>按 o 键可以改变列的显示顺序.按小写的 a-z 可以将相应的列向右移动,而大写的 A-Z 可以将相应的列向左移动.最后按回车键确定.</p>
<p>按大写的 F 或 O 键,然后按 a-z 可以将进程按照相应的列进行排序.而大写的 R 键可以将当前的排序倒转.</p>
<p>命令使用</p>
<p>1． 工具(命令)名称</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line"><span class="built_in">top</span></span><br></pre></td></tr></table></figure>

<p>2．工具(命令)作用</p>
<p>显示系统当前的进程和其他状况; top是一个动态显示过程,即可以通过用户按键来不断刷新当前状态.如果在前台执行该命令,它将独占前台,直到用户终止该程序为止. 比较准确的说,top命令提供了实时的对系统处理器的状态监视.它将显示系统中CPU最”敏感”的任务列表.该命令可以按CPU使用.内存使用和执行时间对任务进行排序;而且该命令的很多特性都可以通过交互式命令或者在个人定制文件中进行设定.</p>
<p>3．环境设置</p>
<p>在Linux下使用.</p>
<p>4．使用方法</p>
<p>4．1使用格式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="attribute">top</span> <span class="selector-attr">[-]</span> <span class="selector-attr">[d]</span> <span class="selector-attr">[p]</span> <span class="selector-attr">[q]</span> <span class="selector-attr">[c]</span> <span class="selector-attr">[C]</span> <span class="selector-attr">[S]</span> <span class="selector-attr">[s]</span> <span class="selector-attr">[n]</span></span><br></pre></td></tr></table></figure>

<p>4．2参数说明</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">d 指定每两次屏幕信息刷新之间的时间间隔.当然用户可以使用s交互命令来改变之.</span><br><span class="line">p 通过指定监控进程ID来仅仅监控某个进程的状态.</span><br><span class="line">q该选项将使top没有任何延迟的进行刷新.如果调用程序有超级用户权限,那么top将以尽可能高的优先级运行.</span><br><span class="line">S 指定累计模式</span><br><span class="line">s 使top命令在安全模式中运行.这将去除交互命令所带来的潜在危险.</span><br><span class="line">i 使top不显示任何闲置或者僵死进程.</span><br><span class="line">c 显示整个命令行而不只是显示命令名</span><br><span class="line"><span class="number">4.3</span>其他</span><br><span class="line">下面介绍在top命令执行过程中可以使用的一些交互命令.从使用角度来看,熟练的掌握这些命令比掌握选项还重要一些.这些命令都是单字母的,如果在命令行选项中使用了s选项,则可能其中一些命令会被屏蔽掉.</span><br><span class="line">Ctrl+L 擦除并且重写屏幕.</span><br><span class="line">h或者? 显示帮助画面,给出一些简短的命令总结说明.</span><br><span class="line">k 终止一个进程.系统将提示用户输入需要终止的进程PID,以及需要发送给该进程什么样的信号.一般的终止进程可以使用<span class="number">15</span>信号;如果不能正常结束那就使用信号<span class="number">9</span>强制结束该进程.默认值是信号<span class="number">15</span>.在安全模式中此命令被屏蔽.</span><br><span class="line">i 忽略闲置和僵死进程.这是一个开关式命令.</span><br><span class="line">q 退出程序.</span><br><span class="line">r 重新安排一个进程的优先级别.系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值.输入一个正值将使优先级降低,反之则可以使该进程拥有更高的优先权.默认值是<span class="number">10</span>.</span><br><span class="line">S 切换到累计模式.</span><br><span class="line">s 改变两次刷新之间的延迟时间.系统将提示用户输入新的时间,单位为s.如果有小数,就换算成m s.输入<span class="number">0</span>值则系统将不断刷新,默认值是<span class="number">5</span> s.需要注意的是如果设置太小的时间,很可能会引起不断刷新,从而根本来不及看清显示的情况,而且系统负载也会大大增加.</span><br><span class="line">f或者F 从当前显示中添加或者删除项目.</span><br><span class="line">o或者O 改变显示项目的顺序.</span><br><span class="line">l 切换显示平均负载和启动时间信息.</span><br><span class="line">m 切换显示内存信息.</span><br><span class="line">t 切换显示进程和CPU状态信息.</span><br><span class="line">c 切换显示命令名称和完整命令行.</span><br><span class="line">M 根据驻留内存大小进行排序.</span><br><span class="line">P 根据CPU使用百分比大小进行排序.</span><br><span class="line">T 根据时间/累计时间进行排序.</span><br><span class="line">W 将当前设置写入~/.toprc文件中.这是写top配置文件的推荐方法.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux 添加全局环境变量</title>
    <url>/2014/08/19/1207/</url>
    <content><![CDATA[<figure class="highlight plaintext"><figcaption><span>/etc/bashrc</span></figcaption><table><tr><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/git/bin</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux 下网关MAC的查看和配置arp命令</title>
    <url>/2014/05/01/1208/</url>
    <content><![CDATA[<p>linux 下网关MAC的查看和配置arp命令:</p>
<figure class="highlight fsharp"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ arp</span><br><span class="line">Address                 HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line"><span class="number">203.171</span>.xx.xx           ether   <span class="number">00</span>:D0:D3:<span class="number">3</span>B:<span class="number">23</span>:A8   C                     eth0</span><br><span class="line"><span class="number">203.171</span>.xx.ab           ether   <span class="number">00</span>:<span class="number">16</span>:<span class="number">76</span>:<span class="number">74</span>:<span class="number">45</span>:A1   C                     eth0</span><br><span class="line"><span class="number">203.171</span>.xx.ac           ether   <span class="number">00</span>:<span class="number">16</span>:<span class="number">76</span>:<span class="number">74</span>:<span class="number">45</span>:A1   C                     eth1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]$ arp -a</span><br><span class="line">? (<span class="number">203.171</span>.xx.xx) at <span class="number">00</span>:D0:D3:<span class="number">3</span>B:<span class="number">23</span>:A8 [ether] . eth0</span><br><span class="line">? (<span class="number">203.171</span>.xx.ab) at <span class="number">00</span>:<span class="number">16</span>:<span class="number">76</span>:<span class="number">74</span>:<span class="number">45</span>:A1 [ether] . eth0</span><br><span class="line">? (<span class="number">203.171</span>.xx.ac) at <span class="number">00</span>:<span class="number">16</span>:<span class="number">76</span>:<span class="number">74</span>:<span class="number">45</span>:A1 [ether] . eth1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]$ arp -h</span><br><span class="line">Usage:</span><br><span class="line">arp [-vn]  <span class="meta">[&lt;HW&gt;]</span> [-i &lt;<span class="keyword">if</span>&gt;] [-a] <span class="meta">[&lt;hostname&gt;]</span>             &lt;-Display ARP cache</span><br><span class="line">arp [-v]          [-i &lt;<span class="keyword">if</span>&gt;] -d  &lt;hostname&gt; [pub][nopub]    &lt;-Delete ARP entry</span><br><span class="line">arp [-vnD] <span class="meta">[&lt;HW&gt;]</span> [-i &lt;<span class="keyword">if</span>&gt;] -f  <span class="meta">[&lt;filename&gt;]</span>              &lt;-Add entry from file</span><br><span class="line">arp [-v]   <span class="meta">[&lt;HW&gt;]</span> [-i &lt;<span class="keyword">if</span>&gt;] -s  &lt;hostname&gt; &lt;hwaddr&gt; [temp][nopub] &lt;-Add entry</span><br><span class="line">arp [-v]   <span class="meta">[&lt;HW&gt;]</span> [-i &lt;<span class="keyword">if</span>&gt;] -s  &lt;hostname&gt; &lt;hwaddr&gt; [netmask &lt;nm&gt;] pub  &lt;-&#x27;&#x27;-</span><br><span class="line">arp [-v]   <span class="meta">[&lt;HW&gt;]</span> [-i &lt;<span class="keyword">if</span>&gt;] -Ds &lt;hostname&gt; &lt;<span class="keyword">if</span>&gt; [netmask &lt;nm&gt;] pub      &lt;-&#x27;&#x27;-</span><br><span class="line">-a                       display (all) hosts <span class="keyword">in</span> alternative (BSD) style</span><br><span class="line">-e                       display (all) hosts <span class="keyword">in</span> <span class="keyword">default</span> (Linux) style</span><br><span class="line">-s, --set                set a <span class="keyword">new</span> ARP entry        -d, --delete             delete a specified entry      </span><br><span class="line">-v, --verbose            be verbose</span><br><span class="line">-n, --numeric            don&#x27;t resolve names</span><br><span class="line">-i, --device             specify network <span class="keyword">interface</span> (e.g. eth0)</span><br><span class="line">-D, --<span class="keyword">use</span>-device         read &lt;hwaddr&gt; from given device</span><br><span class="line">-A, -p, --protocol       specify protocol family</span><br><span class="line">-f, --file               read <span class="keyword">new</span> entries from file <span class="keyword">or</span> from /etc/ethers</span><br><span class="line">&lt;HW&gt;=Use &#x27;-H &lt;hw&gt;&#x27; <span class="keyword">to</span> specify hardware address <span class="keyword">type</span>. Default: ether</span><br><span class="line">List <span class="keyword">of</span> possible hardware types (which support ARP):</span><br><span class="line">strip (Metricom Starmode IP) ash (Ash) ether (Ethernet)</span><br><span class="line">tr (<span class="number">16</span>/<span class="number">4</span> Mbps Token Ring) tr (<span class="number">16</span>/<span class="number">4</span> Mbps Token Ring (New)) ax25 (AMPR AX<span class="number">.25</span>)</span><br><span class="line">netrom (AMPR NET/ROM) rose (AMPR ROSE) arcnet (ARCnet)</span><br><span class="line">dlci (Frame Relay DLCI) fddi (Fiber Distributed Data Interface) hippi (HIPPI)</span><br><span class="line">irda (IrLAP) x25 (generic X<span class="number">.25</span>) infiniband (InfiniBand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]$ cat /etc/ethers</span><br><span class="line">cat: /etc/ethers: No such file <span class="keyword">or</span> directory</span><br></pre></td></tr></table></figure>

<p>添加静态项.这个很有用,特别是局域网中中了arp病毒以后:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arp</span> -s <span class="number">123.123</span>.<span class="number">123.111</span> 00<span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">56</span><span class="symbol">:</span><span class="number">6</span><span class="symbol">F:</span><span class="number">87</span><span class="symbol">:D3</span></span><br><span class="line"><span class="variable">$arp</span> -a <span class="comment">#显示 ARP 表.</span></span><br></pre></td></tr></table></figure>

<p>但是arp -s 设置的静态项在用户登出之后或重起之后会失效,如果想要任何时候都不失效,可以将ip和mac的对应关系写入arp命令默认的配置文件 <code>/etc/ethers</code>中.<br>例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/etc/</span>ethers</span><br><span class="line">arp -s <span class="number">123.123</span>.<span class="number">123.111</span> <span class="number">00</span>:<span class="number">11</span>:<span class="number">56</span>:<span class="number">6</span>F:<span class="number">87</span>:D3</span><br><span class="line"><span class="variable">$arp</span> -f <span class="regexp">/etc/</span>ethers</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux安全扫描工具rkhunter使用教程</title>
    <url>/2013/09/12/1211/</url>
    <content><![CDATA[<p>首先到 <a href="http://www.rootkit.nl/projects/rootkit_hunter.html">http://www.rootkit.nl/projects/rootkit_hunter.html</a><br>下载最新版本的rkhunter.</p>
<p>安装:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">tar -zxvf rkhunter-1.3.8.tar.gz</span><br><span class="line"><span class="keyword">cd</span> rkhunter-1.3.8</span><br><span class="line"><span class="string">./installer.sh</span> <span class="params">--install</span></span><br><span class="line"><span class="string">./installer.sh</span> <span class="params">--show</span></span><br></pre></td></tr></table></figure>

<p>rkhunter就安装好了,然后我们要更新一下:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">rkhunter <span class="params">--update</span></span><br><span class="line">rkhunter <span class="params">--propupd</span></span><br><span class="line"><span class="string">/usr/local/bin/rkhunter</span> <span class="params">--cronjob</span> -l <span class="params">--nomow</span> <span class="params">--rwo</span></span><br></pre></td></tr></table></figure>

<p>使用方法:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Usage:</span><br><span class="line">rkhunter</span><br><span class="line"><span class="comment">--checkall (or -c)</span></span><br><span class="line"><span class="keyword">Check</span> the <span class="keyword">system</span>, performs <span class="keyword">all</span> tests.</span><br><span class="line"><span class="comment">--createlogfile*</span></span><br><span class="line"><span class="keyword">Create</span> a logfile (<span class="keyword">default</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>rkhunter.log)</span><br><span class="line"><span class="comment">--cronjob</span></span><br><span class="line">Run <span class="keyword">as</span> cronjob (removes colored layout)</span><br><span class="line"><span class="comment">--help (or -h)</span></span><br><span class="line"><span class="keyword">Show</span> help about usage</span><br><span class="line"><span class="comment">--nocolors*</span></span><br><span class="line">Don<span class="string">&#x27;t use colors for output (some terminals don&#x27;</span>t <span class="keyword">like</span> colors <span class="keyword">or</span> extended layout characters)</span><br><span class="line"><span class="comment">--report-mode*</span></span><br><span class="line">Don<span class="string">&#x27;t</span></span><br><span class="line"><span class="string">show uninteresting information for reports, like header/footer.</span></span><br><span class="line"><span class="string">Interesting when scanning from crontab or with usage of other</span></span><br><span class="line"><span class="string">applications.</span></span><br><span class="line"><span class="string">--skip-keypress*</span></span><br><span class="line"><span class="string">Don&#x27;</span>t wait after <span class="keyword">every</span> test (makes it non<span class="operator">-</span>interactive)</span><br><span class="line"><span class="comment">--quick*</span></span><br><span class="line">Perform quick scan (instead <span class="keyword">of</span> <span class="keyword">full</span> scan). Skips <span class="keyword">some</span> tests <span class="keyword">and</span> performs <span class="keyword">some</span> enhanced tests (less suitable <span class="keyword">for</span> normal scans).</span><br><span class="line"><span class="comment">--version</span></span><br><span class="line"><span class="keyword">Show</span> version <span class="keyword">and</span> quit</span><br><span class="line"><span class="comment">--versioncheck</span></span><br><span class="line"><span class="keyword">Check</span> <span class="keyword">for</span> latest version</span><br><span class="line"><span class="keyword">Dynamic</span> paths</span><br><span class="line"><span class="comment">--bindir *</span></span><br><span class="line">Uses another directory <span class="keyword">when</span> <span class="keyword">search</span> <span class="keyword">for</span> binaries (use instead <span class="keyword">of</span> <span class="keyword">using</span> <span class="keyword">default</span> binaries)</span><br><span class="line"><span class="comment">--configfile *</span></span><br><span class="line">Uses a different configuration file (instead <span class="keyword">of</span> <span class="keyword">default</span> <span class="keyword">one</span>)</span><br><span class="line"><span class="comment">--dbdir *</span></span><br><span class="line">Uses another directory <span class="keyword">for</span> the databases (instead <span class="keyword">of</span> the <span class="keyword">default</span> <span class="keyword">one</span>, often <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>rkhunter<span class="operator">/</span>db)</span><br><span class="line"><span class="comment">--rootdir *</span></span><br><span class="line">Uses</span><br><span class="line">another rootdirectory (normally <span class="string">&#x27;/&#x27;</span>). So <span class="keyword">all</span> binaries <span class="keyword">and</span> tests will be</span><br><span class="line">performed <span class="keyword">on</span> this directory instead <span class="keyword">of</span> the <span class="keyword">default</span> .</span><br><span class="line"><span class="comment">--tmpdir *</span></span><br><span class="line">Uses another directory <span class="keyword">for</span> temporary storage <span class="keyword">of</span> files</span><br><span class="line">Explicit scan options:</span><br><span class="line"><span class="comment">--disable-md5-check*</span></span><br><span class="line">Disable MD5 checks</span><br><span class="line"><span class="comment">--disable-passwd-check*</span></span><br><span class="line">Disable passwd<span class="operator">/</span><span class="keyword">group</span> checks</span><br><span class="line"><span class="comment">--scan-knownbad-files*</span></span><br><span class="line">Perform besides <span class="string">&#x27;known good&#x27;</span> <span class="keyword">check</span> a <span class="string">&#x27;known bad&#x27;</span> <span class="keyword">check</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>LINUX安全snort安装教程</title>
    <url>/2012/05/02/1209/</url>
    <content><![CDATA[<p>1.安装依赖</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">sudo yum <span class="keyword">install </span>gcc flex <span class="keyword">bison </span>zlib zlib-devel libpcap libpcap-devel pcre pcre-devel libdnet libdnet-devel tcpdump</span><br></pre></td></tr></table></figure>

<p>2.Snort安装</p>
<p>2.1 snort&amp;daq安装</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install https://www.snort.org/downloads/snort/daq-<span class="number">2</span>.<span class="number">0</span>.<span class="number">6</span>-<span class="number">1</span>.centos<span class="number">7</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm                  </span><br><span class="line"><span class="attribute">yum</span> install https://www.snort.org/downloads/snort/snort-<span class="number">2.9.9.0</span>-<span class="number">1</span>.centos<span class="number">7</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure>

<p>在安装snort的时候可能会报错:缺少libnghttp2.so.14()(64bit).</p>
<p>请尝试:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo yum <span class="keyword">install</span> epel-release -y</span><br><span class="line">sudo yum <span class="keyword">install</span> nghttp2</span><br></pre></td></tr></table></figure>

<p>再次安装即可.</p>
<p>2.2 规则下载</p>
<p>Snort官方提供的三类规则:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Community rule<span class="variable">s:</span>无需注册<span class="built_in">or</span>购买,可直接下载使用</span><br><span class="line">Registered rule<span class="variable">s:</span>需要注册才可以下载(建议大家用这个,只需要注册即可,可以说是零成本)</span><br><span class="line">Subscriber rule<span class="variable">s:</span>需要注册花钱购买</span><br></pre></td></tr></table></figure>

<p>注册登录之后根据你下载的snort版本下载即可,这里我用的是最新版本即2.9.9.0,同样的对国内不是很友好,我已经上传至网盘.</p>
<p>2.3 规则解压</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">tar -xvf snortrules-snapshot-&lt;<span class="keyword">version</span>&gt;<span class="string">.tar.gz</span> -C <span class="string">/etc/snort/rules</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux安全检查方法</title>
    <url>/2013/01/26/1210/</url>
    <content><![CDATA[<p>检查系统密码文件,查看文件修改日期:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@fedora ~]$ ls -l <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure>

<p>查看passwd文件中有哪些特权用户:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">[root<span class="meta">@fedora</span> ~]$ awk -F: <span class="string">&#x27;<span class="subst">$3</span>= =0 &#123;print <span class="subst">$1</span>&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<p>查看系统里有没有空口令帐户:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">awk</span> -F: <span class="string">&#x27;length(<span class="variable">$2</span>)= =0 &#123;print <span class="variable">$1</span>&#125;&#x27;</span> /etc/shadow</span><br></pre></td></tr></table></figure>

<p>检查系统守护进程:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/etc/i</span>netd.conf | <span class="keyword">grep</span> -v <span class="string">&quot;^#&quot;</span></span><br></pre></td></tr></table></figure>

<p>检查网络连接和监听端口:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">netstat</span> <span class="comment">–an</span></span><br><span class="line"><span class="comment">netstat</span> <span class="comment">–rn</span></span><br><span class="line"><span class="comment">ifconfig</span> <span class="comment">–a</span></span><br></pre></td></tr></table></figure>

<p>查看正常情况下登录到本机的所有用户的历史记录:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">last</span></span><br></pre></td></tr></table></figure>

<p>检查系统中的core文件:</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -<span class="built_in">name</span> core -<span class="built_in">exec</span> ls -l &#123;&#125; ;</span><br></pre></td></tr></table></figure>

<p>检查系统文件完整性:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm –qf <span class="regexp">/bin/</span>ls</span><br><span class="line">rpm -qf <span class="regexp">/bin/</span>login</span><br><span class="line">md5sum –b 文件名</span><br><span class="line">md5sum –t 文件名</span><br></pre></td></tr></table></figure>

<p>查找是否有后门:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/etc/</span>crontab</span><br><span class="line">ls <span class="regexp">/var/</span>spool<span class="regexp">/cron/</span></span><br><span class="line">cat <span class="regexp">/etc/</span>rc.d/rc.local</span><br><span class="line">ls <span class="regexp">/etc/</span>rc.d</span><br><span class="line">ls <span class="regexp">/etc/</span>rc3.d</span><br><span class="line"><span class="keyword">find</span> / -type f -perm <span class="number">4000</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux打包命令</title>
    <url>/2018/06/05/1214/</url>
    <content><![CDATA[<p>tar命令可以用来压缩打包单文件、多个文件、单个目录、多个目录.</p>
<p>单个文件压缩打包:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">tar czvf my<span class="selector-class">.tar</span><span class="selector-class">.gz</span> file1</span><br></pre></td></tr></table></figure>

<p>多个文件压缩打包:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> czvf my.tar.gz file<span class="number">1</span> file<span class="number">2</span>,...</span><br></pre></td></tr></table></figure>

<p>单个目录压缩打包:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">tar czvf my<span class="selector-class">.tar</span><span class="selector-class">.gz</span> dir1</span><br></pre></td></tr></table></figure>

<p>多个目录压缩打包:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> czvf my.tar.gz dir<span class="number">1</span> dir<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>解包至当前目录:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">tar xzvf <span class="keyword">my</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>参数:</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">c <span class="symbol">:</span>建立一个压缩文件的参数指令(create 的意思);</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">x <span class="symbol">:</span>解开一个压缩文件的参数指令!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">t <span class="symbol">:</span>查看 tarfile 里面的文件!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">z <span class="symbol">:</span>是否同时具有 gzip 的属性<span class="string">?亦</span>即是否需要用 gzip 压缩?</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">j <span class="symbol">:</span>是否同时具有 bzip2 的属性<span class="string">?亦</span>即是否需要用 bzip2 压缩?</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">v <span class="symbol">:</span>压缩的过程中显示文件!这个常用,但不建议用在背景执行过程!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">f <span class="symbol">:</span>使用档名,请留意,在 f 之后要立即接档名喔!不要再加参数!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">p <span class="symbol">:</span>使用原文件的原来属性(属性不会依据使用者而变)</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">P <span class="symbol">:</span>可以使用绝对路径来压缩!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">N <span class="symbol">:</span>比后面接的日期(yyyy/mm/dd)还要新的才会被打包进新建的文件中!</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-exclude <span class="symbol">FILE:</span>在压缩的过程中,不要将 FILE 打包!</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux安装Xcache缓存器</title>
    <url>/2014/03/13/1212/</url>
    <content><![CDATA[<p>由于国内网站备案比较麻烦,所以笔者便把网站放到了美国.虽然网站免去了备案的困扰,但是从访问速度上来看,一般要比放于国内的网站慢2-3倍,所以便想办法对网站做了一些简单的优化,比如使用缓存系统来提升网站页面访问速度.<br>目前用于Web的缓存系统很多,包括squid、varnish、Nginx自带的proxy_cache、FastCGI中的fastcgi_cache、APC、Xcache等.<br>像squid、varnish、Nginx自带的proxy_cache这类系统,属于重量级产品,配置维护比较麻烦,不适合小型网站,而且一般用这类系统缓存静态内容,比如图片、css、JavaScript等;像FastCGI中的fastcgi_cache,它主要用于缓存动态内容,所以在访问使用fastcgi_cache的网站时速度极快,但是笔者使用时发现其维护比较麻烦,特别是每次网站有数据要更新后,如果不等到缓冲期过期后得需要手动清除缓存才能看到网站更新的内容;至于APC个人感觉性能就一般了,拿它和Xcache比较时发现访问使用Xcache网站的速度明显高于使用APC网站的速度(笔者没有具体测试),所以最终选择了使用Xcache.<br>我们都知道PHP是一种动态语言,它在执行时是以解释的方式执行,所以 PHP代码每次执行时都会被解析和转换成操作码(opcode).而Xcache是一个开源的操作码缓存器/优化器,它通过把解析/转换PHP后的操作码缓存到文件(直到原始代码被修改)从而避免重复的解析过程,提高了代码的执行速度,通常能够提高页面生成速率2-5倍,降低了服务器负载,提高了用户访问网站的速度.</p>
<p>一、安装Xcache</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ wget http:<span class="regexp">//</span>xcache.lighttpd.net<span class="regexp">/pub/</span>Releases<span class="regexp">/1.3.0/</span>xcache-<span class="number">1.3</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">$ tar zxvf xcache-<span class="number">1.3</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">$ cd xcache-<span class="number">1.3</span>.<span class="number">0</span></span><br><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin/phpize</span><br><span class="line">$ ./configure --enable-xcache</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>注:–enable-xcache表示启用Xcache支持;–enable-xcache-coverager表示包含用于测量加速器功效的附加特性;–enable-xcache-optimizer表示启用操作码优化<br>安装完毕后系统会提示xcache.so模块生成路径,本次生成路径为 <code>/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/</code>,然后把xcache.so移动到 <code>/usr/local/php/include/php/ext</code>目录下.</p>
<p>二、配置管理Xcache</p>
<p>1、修改php配置文件<br>配置时我们可以参考xcache的配置模板xcache.ini,此文件位于Xcache安装程序中</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>lib/php.ini</span><br></pre></td></tr></table></figure>

<p>然后添加如下内容</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">extension_dir</span>=/usr/local/php/include/php/ext</span><br><span class="line"><span class="section">[xcache-common]</span></span><br><span class="line"><span class="attr">extension</span> = xcache.so</span><br><span class="line"><span class="section">[xcache.admin]</span></span><br><span class="line"><span class="attr">xcache.admin.enable_auth</span> = <span class="literal">On</span></span><br><span class="line"><span class="attr">xcache.admin.user</span> = <span class="string">&quot;xcache&quot;</span></span><br><span class="line"><span class="attr">xcache.admin.pass</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="section">[xcache]</span></span><br><span class="line"><span class="attr">xcache.shm_scheme</span> =<span class="string">&quot;mmap&quot;</span></span><br><span class="line"><span class="attr">xcache.size</span>=<span class="number">60</span>M</span><br><span class="line"><span class="attr">xcache.count</span> =<span class="number">1</span></span><br><span class="line"><span class="attr">xcache.slots</span> =<span class="number">8</span>K</span><br><span class="line"><span class="attr">xcache.ttl</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">xcache.gc_interval</span> =<span class="number">0</span></span><br><span class="line"><span class="attr">xcache.var_size</span>=<span class="number">4</span>M</span><br><span class="line"><span class="attr">xcache.var_count</span> =<span class="number">1</span></span><br><span class="line"><span class="attr">xcache.var_slots</span> =<span class="number">8</span>K</span><br><span class="line"><span class="attr">xcache.var_ttl</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">xcache.var_maxttl</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">xcache.var_gc_interval</span> =<span class="number">300</span></span><br><span class="line"><span class="attr">xcache.test</span> =<span class="literal">Off</span></span><br><span class="line"><span class="attr">xcache.readonly_protection</span> = <span class="literal">On</span></span><br><span class="line"><span class="attr">xcache.mmap_path</span> =<span class="string">&quot;/tmp/xcache&quot;</span></span><br><span class="line"><span class="attr">xcache.coredump_directory</span> =<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">xcache.cacher</span> =<span class="literal">On</span></span><br><span class="line"><span class="attr">xcache.stat</span>=<span class="literal">On</span></span><br><span class="line"><span class="attr">xcache.optimizer</span> =<span class="literal">Off</span></span><br><span class="line"><span class="section">[xcache.coverager]</span></span><br><span class="line"><span class="attr">xcache.coverager</span> =<span class="literal">On</span></span><br><span class="line"><span class="attr">xcache.coveragedump_directory</span> =<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>2、生成Xcache缓存文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ touch <span class="regexp">/tmp/</span>xcache</span><br><span class="line">$ chmod <span class="number">777</span> <span class="regexp">/tmp/</span>xcache</span><br></pre></td></tr></table></figure>

<p>3、生成Xcache管理员的秘密(MD5密文)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> -n <span class="string">&quot;123456&quot;</span> | md5sum</span></span><br><span class="line">e10adc3949ba59abbe56e057f20f883e</span><br></pre></td></tr></table></figure>

<p>然后将上述生成的MD5密文粘贴到php.ini文件中xcache.admin.pass = “”选项,xcache.admin.pass= “e10adc3949ba59abbe56e057f20f883e”<br>4、拷贝Xcache管理程序到网站根目录下</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cp -a <span class="regexp">/tmp/</span>xcache-<span class="number">1.3</span>.<span class="number">0</span><span class="regexp">/admin/</span><span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>html/</span><br></pre></td></tr></table></figure>

<p>然后重新启动PHP,然后访问<a href="http://localhost/admin">http://localhost/admin</a> ,用户名为xcache 密码为123456;另外,还可以通过phpinfo来验证PHP是否支持Xcache.</p>
]]></content>
  </entry>
  <entry>
    <title>linux查看操作系统位数</title>
    <url>/2015/06/14/1213/</url>
    <content><![CDATA[<p>方法1:<br>命令是 getconf LONG_BIT</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[dovao<span class="variable">@localhost</span> ~]<span class="variable">$ </span>getconf LONG_BIT</span><br><span class="line"><span class="number">64</span></span><br><span class="line">[dovao<span class="variable">@localhost</span> ~]$</span><br></pre></td></tr></table></figure>

<p>方法2:<br>命令是 uname -a</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">[dovao<span class="title">@localhost</span> ~]$ uname -a</span><br><span class="line">Linux localhost.localdomain <span class="number">2.6</span>.<span class="number">32</span><span class="number">-220.7</span>.<span class="number">1</span>.el<span class="number">6</span>.centos.plus.<span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> <span class="variable">#1</span> SMP Wed Mar <span class="number">7</span> <span class="number">11</span>:<span class="number">06</span>:<span class="number">23</span> GMT <span class="number">2012</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> GNU/Linux</span><br><span class="line">#<span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span> 是 <span class="number">64</span>位系统</span><br><span class="line">#<span class="type">i686</span> <span class="type">i686</span> <span class="type">i386</span> 是 <span class="number">32</span>位系统</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux的环境变量</title>
    <url>/2016/11/13/1216/</url>
    <content><![CDATA[<p>一、Linux的变量种类</p>
<p>按变量的生存周期来划分,Linux变量可分为两类:</p>
<p>1、永久的:需要修改配置文件,变量永久生效.<br>2、临时的:使用export命令声明即可,变量在关闭shell时失效.</p>
<p>二、设置变量的三种方法</p>
<p>1、在 <code>/etc/profile</code>文件中添加变量,对所有用户生效(永久的).</p>
<p>用VI在文件 <code>/etc/profile</code>文件中增加变量,该变量将会对Linux下所有用户有效,并且是”永久的”.<br>例如:编辑 <code>/etc/profile</code>文件,添加CLASSPATH变量.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>profile</span><br><span class="line">export CLASSPATH=.<span class="regexp">/JAVA_HOME/</span>lib;<span class="variable">$JAVA_HOME</span><span class="regexp">/jre/</span>lib</span><br></pre></td></tr></table></figure>

<p>注:修改文件后要想马上生效还要运行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>不然只能在下次重进此用户时生效.</p>
<p>2、在用户目录下的.bash_profile文件中增加变量,对单一用户生效(永久的).</p>
<p>用VI在用户目录下的.bash_profile文件中增加变量,改变量仅会对当前用户有效,并且是”永久的”.<br>例如:编辑guok用户目录 <code>/home/guok</code>下的.bash_profile.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/home/gu</span>ok/.bash.profile</span><br></pre></td></tr></table></figure>

<p>添加如下内容:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">export CLASSPATH=.<span class="regexp">/JAVA_HOME/</span>lib;<span class="variable">$JAVA_HOME</span><span class="regexp">/jre/</span>lib</span><br></pre></td></tr></table></figure>

<p>注:修改文件后要想马上生效还要运行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/home/gu</span>ok/.bash_profile</span><br></pre></td></tr></table></figure>

<p>不然只能在下次重进此用户时生效.</p>
<p>3、直接运行export命令定义变量,只对当前shell有效(临时的).</p>
<p>在shell的命令行下直接使用[export 变量名=变量值].<br>定义变量,该变量只在当前的shell或其子shell下是有效的,shell关闭了,变量也就失效了,再打开新shell时就没有这个变量,需要使用的话还需要重新定义.</p>
<p>三、PATH声明,其格式为:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:&lt;PATH</span> <span class="number">1</span>&gt;<span class="symbol">:&lt;PATH</span> <span class="number">2</span>&gt;<span class="symbol">:&lt;PATH</span> <span class="number">3</span>&gt;<span class="symbol">:------</span><span class="symbol">:&lt;PATH</span> N&gt;</span><br></pre></td></tr></table></figure>

<p>你可以自己加上指定的路径,中间用冒号隔开.环境变量更改后,在用户下次登陆时生效.<br>如果想立刻生效,则可执行下面的语句:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure>

<p>需要注意的是,最好不要把当前路径”./“放到PATH里,这样可能会受到意想不到的攻击.<br>完成后,可以通过:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>查看当前的搜索路径.这样定制后,就可以避免频繁的启动位于shell搜索的路径之外的程序了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux分区格式化</title>
    <url>/2015/09/09/1218/</url>
    <content><![CDATA[<p>万恶的图形化安装界面,虽然安装linux各种发行版有小20次,可至今对分区及格式化命令没有个人体会,只知道fdisk -l,du -sh,df -ah这几个命令,查看了分区或者目录的信息,而且只是一目带过,好多点都没想过…不求甚解啊.</p>
<p>万恶的图形化安装界面,虽然安装linux各种发行版有小20次,可至今对分区及格式化命令没有个人体会,只知道fdisk -l,du -sh,df -ah这几个命令,查看了分区或者目录的信息,而且只是一目带过,好多点都没想过…不求甚解啊…反省中…</p>
<p>du,df命令相对简单,man一下,就ok了,摘录有用的几个参数如下:</p>
<p>1.du命令详解</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">常用命令:du</span> <span class="comment">–a</span></span><br></pre></td></tr></table></figure>

<p>查询档案或目录的磁盘使用空间</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">a:</span>显示全部目录和其次目录下的每个档案所占的磁盘空间</span><br><span class="line"><span class="symbol">b:</span>大小用bytes来表示 (默认值为k bytes)</span><br><span class="line"><span class="symbol">c:</span>最后再加上总计 (默认值)</span><br><span class="line"><span class="symbol">s:</span>只显示各档案大小的总合</span><br><span class="line"><span class="symbol">x:</span>只计算同属同一个档案系统的档案</span><br><span class="line"><span class="symbol">L:</span>计算所有的档案大小</span><br></pre></td></tr></table></figure>

<p>指令 du 能以指定的目录下的子目录为单位,显示每个目录内所有档案所占用的磁盘空间大小.使用 -h 参数来显示 human-readable 的格式.<br>在查看目录的使用情形时,我们可以将输出结果导到 sort 指令进行排序,以了解哪个档案用了最多的空间:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># du /etc | sort -nr | more</span></span><br><span class="line"><span class="number">1746</span> /etc</span><br><span class="line"><span class="number">388</span> <span class="regexp">/etc/m</span>ail</span><br><span class="line"><span class="number">318</span> <span class="regexp">/etc/</span>rc.d</span><br></pre></td></tr></table></figure>

<p>2.df命令详解</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">常用命令:df –ah</span></span><br><span class="line"></span><br><span class="line"><span class="section">a:显示全部的档案系统和各分割区的磁盘使用情形</span></span><br><span class="line"><span class="section">i:显示i -nodes的使用量</span></span><br><span class="line"><span class="section">k:大小用k来表示 (默认值)</span></span><br><span class="line"><span class="section">t:显示某一个档案系统的所有分割区磁盘使用量</span></span><br><span class="line"><span class="section">x:显示不是某一个档案系统的所有分割区磁盘使用量</span></span><br><span class="line"><span class="section">T:显示每个分割区所属的档案系统名称</span></span><br></pre></td></tr></table></figure>

<p>上面科普和加深下相关知识,开始进入主题:</p>
<p>分为两个步骤:1.分区:用fdisk;2.格式化:用mkfs(或直接用mkfs.ext4)<br>举个实例来分析吧,这样更容易明白和记住:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">fdisk -l 查看硬盘及分区信息</span><br><span class="line">Disk /dev/<span class="symbol">hdd:</span> <span class="number">250.0</span> GB, <span class="number">250059350016</span> bytes</span><br><span class="line"><span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">30401</span> cylinders</span><br><span class="line">Units = cylinders of <span class="number">16065</span> * <span class="number">512</span> = <span class="number">8225280</span> bytes</span><br><span class="line"></span><br><span class="line">Device Boot?<span class="string">??</span> Start?<span class="string">??</span> End?<span class="string">??</span><span class="string">??</span><span class="string">??</span> Blocks?<span class="string">??</span><span class="string">??</span><span class="string">??</span> Id?<span class="string">??</span> System</span><br><span class="line">/dev/hdd1?<span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">1</span>?<span class="string">??</span> <span class="number">30401</span>?<span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">244196001</span>?<span class="string">??</span>? <span class="number">83</span>?<span class="string">??</span> Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/<span class="symbol">sda:</span> <span class="number">203.9</span> GB, <span class="number">203928109056</span> bytes</span><br><span class="line"><span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">24792</span> cylinders</span><br><span class="line">Units = cylinders of <span class="number">16065</span> * <span class="number">512</span> = <span class="number">8225280</span> bytes</span><br><span class="line"></span><br><span class="line">Device?<span class="string">??</span><span class="string">??</span><span class="string">??</span>? Boot?<span class="string">??</span> Start?<span class="string">??</span> End?<span class="string">??</span><span class="string">??</span><span class="string">??</span> Blocks?<span class="string">??</span><span class="string">??</span><span class="string">??</span> Id?<span class="string">??</span> System</span><br><span class="line">/dev/sda1?<span class="string">??</span><span class="string">??</span><span class="string">??</span> *<span class="string">??</span>? <span class="number">1</span>?<span class="string">??</span> <span class="number">16</span>?<span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">128488</span>+<span class="string">??</span>? <span class="number">83</span>?<span class="string">??</span> Linux</span><br><span class="line">/dev/sda2?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">17</span>?<span class="string">??</span> <span class="number">277</span>?<span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">2096482</span>+<span class="string">??</span>? <span class="number">82</span>?<span class="string">??</span> Linux swap / Solaris</span><br><span class="line">/dev/sda3?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">278</span>?<span class="string">??</span> <span class="number">1599</span>?<span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">10618965</span>?<span class="string">??</span> <span class="number">83</span>?<span class="string">??</span> Linux</span><br></pre></td></tr></table></figure>

<p>可以看出来,这台机器的硬盘设备有两个,分别是/dev/hdd1 跟/dev/sda1 两块,而且可以判断出来/dev/hdd1 是并口的.因为linux下并口设备跟串口设备的设备名前缀是不同的h代表pata,s代表sata.而且可以看出来一块是250g,另一块串口的是200g.<br>使用fdisk /dev/hdd给硬盘分区(/dev/hdd 指的是硬盘,/dev/hdd1指的是这块硬盘的第一个分区,两者概念要弄明白),fdisk命令动词后面必需跟硬盘设备名,而不能跟分区名,切记.</p>
<p>接下来会出现fdisk的交互命令:</p>
<p>简单说下,具体见参考资料2:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">Command action</span><br><span class="line">a?<span class="string">??</span> toggle a bootable flag?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 设置引导扇区</span><br><span class="line">b?<span class="string">??</span> edit bsd disklabel?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 编辑卷标(linux下使用的卷标bsd通用)</span><br><span class="line">c?<span class="string">??</span> toggle the dos compatibility flag</span><br><span class="line">d?<span class="string">??</span> delete a partition?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 删除一个分区</span><br><span class="line">l?<span class="string">??</span> list known partition types?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 列出已知分区类型</span><br><span class="line">m?<span class="string">??</span> print this menu?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 显示该菜单</span><br><span class="line">n?<span class="string">??</span> add a new partition?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 添加一个新分区</span><br><span class="line">o?<span class="string">??</span> create a new empty DOS partition table</span><br><span class="line">p?<span class="string">??</span> print the partition table?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> 显示分区表</span><br><span class="line">q?<span class="string">??</span> quit without saving changes?<span class="string">??</span><span class="string">??</span><span class="string">??</span> 不保存退出</span><br><span class="line">s?<span class="string">??</span> create a new empty Sun disklabel</span><br><span class="line">t?<span class="string">??</span> change a partition<span class="string">&#x27;s system id??????? 修改分区类型</span></span><br><span class="line"><span class="string">u??? change display/entry units</span></span><br><span class="line"><span class="string">v??? verify the partition table</span></span><br><span class="line"><span class="string">w??? write table to disk and exit??????? 写入磁盘退出分区程序</span></span><br><span class="line"><span class="string">x??? extra functionality (experts only)</span></span><br></pre></td></tr></table></figure>

<p>通常先d,后n,再选择是创建主分区,还是扩展分区,然后输入扇区大小,再按w写入磁盘,分区工作就完事了.<br>然后mkfs.ext4 <code>/dev/hdd1</code>,开始格式化.Fsck.ext4是修复命令<br>到这,所有的工作都完事了,这下该有个初步的印象了…<br>另外mkfs.ext4 -F的参数选项,可以强行对非分区块设备进行格式化,例如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mkfs</span>.ext<span class="number">4</span> -F root.disk</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux导出光盘为iso</title>
    <url>/2018/09/10/1215/</url>
    <content><![CDATA[<p>其实命令非常简单就是使用了linux的dd命令.<br>转换CD到iso文件:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/cdrom <span class="attribute">of</span>=isofile.iso&lt;/code&gt;</span><br></pre></td></tr></table></figure>
<p>这样就将cdrom目录里的内容到处为isofile.iso了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux防止ip欺骗</title>
    <url>/2017/08/27/1217/</url>
    <content><![CDATA[<p>编辑 <code>/etc/host.conf</code>文件并增加如下几行来防止IP欺骗攻击.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="title">hosts</span>,bind     <span class="comment">#名称解释顺序</span></span><br><span class="line">multi on             <span class="comment">#允许主机拥有多个IP地址</span></span><br><span class="line">nospoof on           <span class="comment">#禁止IP地址欺骗</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux各种格式的压缩与打包</title>
    <url>/2018/02/15/1219/</url>
    <content><![CDATA[<!--markdown-->.tar

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解包:tar xvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar </span><br><span class="line">打包:tar cvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar DirName </span><br><span class="line">(注:tar是打包,不是压缩!)</span><br></pre></td></tr></table></figure>

<p>.gz</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解压 <span class="number">1</span>:gunzip <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>gz </span><br><span class="line">解压<span class="number">2</span>:gzip -d <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>gz </span><br><span class="line">压缩:gzip FileName </span><br></pre></td></tr></table></figure>

<p>.tar.gz 和 .tgz</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解压:tar zxvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar.gz </span><br><span class="line">压缩:tar zcvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar.gz DirName </span><br></pre></td></tr></table></figure>

<p>.bz2</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">解压<span class="number">1</span>:<span class="keyword">bzip2 </span>-d FileName.<span class="keyword">bz2 </span></span><br><span class="line">解压<span class="number">2</span>:<span class="keyword">bunzip2 </span>FileName.<span class="keyword">bz2 </span></span><br><span class="line">压缩: <span class="keyword">bzip2 </span>-z FileName </span><br></pre></td></tr></table></figure>

<p>.tar.bz2</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">解压:tar <span class="keyword">jxvf </span>FileName.tar.<span class="keyword">bz2 </span>       或tar --<span class="keyword">bzip </span>xvf FileName.tar.<span class="keyword">bz2 </span></span><br><span class="line">压缩:tar <span class="keyword">jcvf </span>FileName.tar.<span class="keyword">bz2 </span><span class="keyword">DirName </span></span><br></pre></td></tr></table></figure>

<p>.bz</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">解压<span class="number">1</span>:<span class="keyword">bzip2 </span>-d FileName.<span class="keyword">bz </span></span><br><span class="line">解压<span class="number">2</span>:<span class="keyword">bunzip2 </span>FileName.<span class="keyword">bz </span></span><br><span class="line">压缩:未知 </span><br></pre></td></tr></table></figure>

<p>.tar.bz</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">解压:tar jxvf FileName.tar.bz </span></span><br><span class="line"><span class="section">压缩:未知 </span></span><br></pre></td></tr></table></figure>

<p>.Z</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">解压<span class="symbol">:uncompress</span> FileName.Z </span><br><span class="line">压缩<span class="symbol">:compress</span> FileName </span><br></pre></td></tr></table></figure>

<p>.tar.Z</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解压:tar Zxvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar.Z </span><br><span class="line">压缩:tar Zcvf <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>tar.Z DirName </span><br></pre></td></tr></table></figure>

<p>.zip</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解压:unzip <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>zip </span><br><span class="line">压缩:zip <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>zip DirName </span><br><span class="line">压缩一个目录使用 -r 参数,-r 递归.例: $ zip -r <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>zip DirName </span><br></pre></td></tr></table></figure>

<p>.rar</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解压:rar x <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>rar </span><br><span class="line">压缩:rar a <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>rar DirName </span><br></pre></td></tr></table></figure>

<p>.lha</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">解压:<span class="keyword">lha </span>-e FileName.<span class="keyword">lha </span></span><br><span class="line">压缩:<span class="keyword">lha </span>-a FileName.<span class="keyword">lha </span>FileName </span><br></pre></td></tr></table></figure>

<p>.rpm</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">解包:rpm2cpio <span class="module-access"><span class="module"><span class="identifier">FileName</span>.</span></span>rpm <span class="pattern-match">| cpio -div </span></span><br></pre></td></tr></table></figure>

<p>.deb</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">解包:ar p <span class="type">FileName</span>.deb <span class="class"><span class="keyword">data</span>.tar.gz | tar zxf - </span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux管道详解</title>
    <url>/2013/01/31/1220/</url>
    <content><![CDATA[<p>那么一条复杂的Linux命令怎样构成呢?下面来介绍几个技巧.</p>
<p>利用输入/输出重定向</p>
<p>在Linux命令行模式中,如果命令所需的输入不是来自键盘,而是来自指定的文件,这就是输入重定向.同理,命令的输出也可以不显示在屏幕上,而是写入到指定文件中,这就是输出重定向.<br>接下来看看标准输入/输出重定向在构造一条Linux命令中的实际应用.</p>
<p>输入重定向和输出重定向</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> wc aa.txt</span><br><span class="line"><span class="variable">$</span> <span class="built_in">ls</span> &gt; home.txt</span><br></pre></td></tr></table></figure>

<p>第一条命令将文件aa.txt作为wc命令的输入,统计出aa.txt的行数、单词数和字符数.第二条命令将ls命令的输出保存在一个名为home.txt的文件中.如果&gt;符号后边的文件已存在,那么这个文件将被重写.</p>
<p>同时使用输入和输出重定向</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> iconv <span class="operator">-f</span> gb18030 <span class="literal">-t</span> utf<span class="literal">-8</span> <span class="built_in">new-aa</span>.txt</span><br></pre></td></tr></table></figure>

<p>这条命令里同时用到了输入重定向(new-aa.txt).aa.txt实际是一个gb18030编码的文件,而new-aa.txt则是将aa.txt的内容转换成utf-8格式的新文件.</p>
<p>利用管道</p>
<p>利用Linux所提供的管道符”|”将两个命令隔开,管道符左边命令的输出就会作为管道符右边命令的输入.连续使用管道意味着第一个命令的输出会作为 第二个命令的输入,第二个命令的输出又会作为第三个命令的输入,依此类推.下面来看看管道是如何在构造一条Linux命令中得到应用的.</p>
<p>利用一个管道</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ rpm -<span class="keyword">qa</span>|<span class="keyword">grep</span> licq</span><br></pre></td></tr></table></figure>

<p>这条命令使用一个管道符”|”建立了一个管道.管道将rpm -qa命令的输出(包括系统中所有安装的RPM包)作为grep命令的输入,从而列出带有licq字符的RPM包来.</p>
<p>利用多个管道</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ cat <span class="regexp">/etc/</span>passwd | <span class="keyword">grep</span> <span class="regexp">/bin/</span>bash | wc -l</span><br></pre></td></tr></table></figure>

<p>这条命令使用了两个管道,利用第一个管道将cat命令(显示passwd文件的内容)的输出送给grep命令,grep命令找出含有”/bin /bash”的所有行;第二个管道将grep的输出送给wc命令,wc命令统计出输入中的行数.这个命令的功能在于找出系统中有多少个用户使用bash.</p>
<p>利用命令替换</p>
<p>在Linux命令行模式下,当遇到一对”<code>&quot; (上分割符)时,将首先执行&quot;</code>“中间包含的命令,然后将其输出结果作为参数代入命令行中,这就是命令替换了.它类似于输入输出的重定向功能,但区别在于 命令替换是将一个命令的输出作为另外一个命令的参数.下面来看它的实际应用.</p>
<p>使用命令替换</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">$ touch `date +<span class="built_in">%Y</span><span class="built_in">%m</span><span class="built_in">%d</span><span class="built_in">%k</span><span class="built_in">%M</span><span class="built_in">%S</span>`.txt</span><br></pre></td></tr></table></figure>

<p>该命令使用了一次命令替换,date +%Y%m%d%k%M%S命令将首先执行,它将按指定格式输出当前的时间.然后,这个时间将被作为touch命令的参数,其结果是建立了一个以当前时间为文件名的文件.</p>
<p>使用命令替换</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ kill `<span class="regexp">/sbin/</span>pidof smbd`</span><br></pre></td></tr></table></figure>

<p>该命令将杀掉sshd的所有进程.这里用pidof这个命令给出进程号,因为kill是针对进程号进行操作的.两者通过命令替换,实现了只用一条命令就杀掉sshd所有进程的功能.</p>
<p>综合应用</p>
<p>在理解和熟悉了前面的几个技巧后,将它们综合运用起来就是较高的技巧了.同时,一些常用的、且本身用法就比较复杂的Linux命令一定要熟练掌握.在 构造Linux命令中常常用到的一些基础的、重要的命令有grep、tr、sed、awk、find、cat和echo等,下面来看一些综合应用的例子.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">man</span> <span class="keyword">ls</span> | col -b &gt; <span class="keyword">ls</span>.<span class="keyword">man</span>.txt</span><br></pre></td></tr></table></figure>

<p>这条命令同时运用了输出重定向和管道两种技巧,作用是将ls的帮助信息转成一个可以直接阅读的文本文件.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">kill</span> <span class="literal">-9</span> `ps <span class="literal">-ef</span> | grep smbd | tr <span class="literal">-s</span> <span class="string">&#x27; &#x27;</span> | awk <span class="operator">-F</span><span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br></pre></td></tr></table></figure>

<p>这个例子的功能和上面的功能是一样的,不过它不依赖pidof命令,使用的是多数Unix类系统中都有的命令,适用于更多的系统环境.但是它看起来更复杂一些,使用了三个管道和一次命令替换,另外使用了grep、tr和awk三个与字符操作相关的命令.<br>从前面的介绍可以看出,通过几种技巧的组合,Linux命令可以完成复杂的功能.除此之外,还可以将这些命令组织到一个脚本中来,加上函数、变量、判断和循环等功能,再加入一些编程思想,就是功能更强大的Shell脚本了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux简介</title>
    <url>/2007/05/19/1223/</url>
    <content><![CDATA[<p>Linux，全称GNU/Linux，是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX的多用户、多任务、支持多线程和多CPU的操作系统。伴随着互联网的发展，Linux得到了来自全世界软件爱好者、组织、公司的支持。它除了在服务器方面保持着强劲的发展势头以外，在个人电脑、嵌入式系统上都有着长足的进步。使用者不仅可以直观地获取该操作系统的实现机制，而且可以根据自身的需要来修改完善Linux，使其最大化地适应用户的需要。<br>Linux不仅系统性能稳定，而且是开源软件。其核心防火墙组件性能高效、配置简单，保证了系统的安全。在很多企业网络中，为了追求速度和安全，Linux不仅仅是被网络运维人员当作服务器使用，甚至当作网络防火墙，这是Linux的一大亮点。<br>Linux具有开放源码、没有版权、技术社区用户多等特点，开放源码使得用户可以自由裁剪，灵活性高，功能强大，成本低。尤其系统中内嵌网络协议栈，经过适当的配置就可实现路由器的功能。这些特点使得Linux成为开发路由交换设备的理想开发平台。</p>
]]></content>
  </entry>
  <entry>
    <title>linux管理服务</title>
    <url>/2017/12/01/1221/</url>
    <content><![CDATA[<p>Linux 提供了chkconfig 命令用来更新和查询不同运行级上的系统服务.<br>语法为:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">chkconfig <span class="comment">--list [name]</span></span><br><span class="line"><span class="comment">#用来列表服务</span></span><br><span class="line">chkconfig <span class="comment">--add name</span></span><br><span class="line"><span class="comment">#用来添加服务</span></span><br><span class="line">chkconfig <span class="comment">--del name</span></span><br><span class="line"><span class="comment">#用来删除服务</span></span><br><span class="line">chkconfig [<span class="comment">--level levels] name</span></span><br><span class="line"><span class="comment">#改变启动信息以及检查特定服务的启动状态.</span></span><br></pre></td></tr></table></figure>

<p>on 和 off 分别指服务在改变运行级时的启动和停止.reset 指初始化服务信息.<br>对于 on 和 off 开关,系统默认只对运行级 3,4, 5有效,但是 reset 可以对所有运行级有效.</p>
<p>选项介绍:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">--level levels</span></span><br><span class="line"><span class="comment">#指定运行级,由数字 0 到 7 构成的字符串,如:</span></span><br><span class="line"><span class="comment">--level 35 表示指定运行级3 和5.</span></span><br><span class="line"><span class="comment">--add name</span></span><br><span class="line"><span class="comment">#这个选项增加一项新的服务,chkconfig 确保每个运行级有一项启动(S) 或者 杀死(K) 入口.如有缺少,则会从缺省的init</span></span><br><span class="line">脚本自动建立.</span><br><span class="line"><span class="comment">--del name</span></span><br><span class="line"><span class="comment">#用来删除服务,并把相关符号连接从 /etc/rc[0-6].d 删除.</span></span><br><span class="line"><span class="comment">--list name</span></span><br><span class="line"><span class="comment">#列表,如果指定了name 那么只是显示指定的服务名,否则,列出全部服务在不同运行级的状态.</span></span><br></pre></td></tr></table></figure>

<p>每个被chkconfig 管理的服务需要在对应的 <code>/etc/rc.d/init.d</code> 下的脚本加上两行或者更多行的注释.<br>第一行告诉 chkconfig 缺省启动的运行级以及启动和停止的优先级.如果某服务缺省不在任何运行级启动,那么使用 - 代替运行级.<br>第二行对服务进行描述,可以用 跨行注释.<br>例如,random.init 包含三行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span>: <span class="number">2345</span> <span class="number">20</span> <span class="number">80</span></span><br><span class="line"><span class="attribute">description</span>: Saves and restores system entropy pool for</span><br><span class="line"><span class="attribute">higher</span> quality random number generation.</span><br></pre></td></tr></table></figure>

<p>表明 random 脚本应该在运行级 2, 3, 4, 5 启动,启动优先权为20,停止优先权为 80.</p>
]]></content>
  </entry>
  <entry>
    <title>linux环境变量设置错误后,如何恢复解决方案</title>
    <url>/2012/09/19/1222/</url>
    <content><![CDATA[<p>linux环境变量设置错误后,如何恢复解决方案:在命令行中输入:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">export PATH=<span class="regexp">/usr/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/bin</span><span class="symbol">:/sbin</span><span class="symbol">:/usr/X11R6/bin</span></span><br></pre></td></tr></table></figure>

<p>后回车.</p>
<p><code>/etc/profile</code>: 此文件为系统的每个用户设置环境信息,当用户第一次登录时,该文件被执行.并从 <code>/etc/profile.d</code>目录的配置文件中搜集shell的设置.<br><code>/etc/bashrc</code>:为每一个运行bash shell的用户执行此文件.当bash shell被打开时,该文件被读取.<code>~/.bash_profile</code>:每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!默认情况下,他设置一些环境变量,执行用户的.bashrc文件.<code>~/.bashrc</code>:该文件包含专用于你的bash shell的bash信息,当登录时以及每次打开新的shell时,该该文件被读取.<code>~/.bash_logout</code>:当每次退出系统(退出bash shell)时,执行该文件.<br>另外,<code>/etc/profile</code>中设定的变量(全局)的可以作用于任何用户,而<del>/.bashrc等中设定的变量(局部)只能继承 <code>/etc/profile</code>中的变量,他们是”父子”关系.<br>`</del>/.bash_profile<code>是交互式、login 方式进入 bash 运行的</code>~/.bashrc`是交互式 non-login 方式进入 bash 运行的通常二者设置大致相同,所以通常前者会调用后者.</p>
]]></content>
  </entry>
  <entry>
    <title>linux禁止某个用户登录系统</title>
    <url>/2019/03/22/1225/</url>
    <content><![CDATA[<p>之前站长发布过一片文章,内容是禁止除了root以外的所有用户登录系统,<br>但这个似乎有些时候不是很实用,现在站长来教大家禁止某个用户登录系统的办法.</p>
<p>1、禁止个别用户登录.比如禁止lynn用户登录.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">passwd -l lynn</span></span><br></pre></td></tr></table></figure>

<p>这就话的意思是锁定lynn用户,这样该用户就不能登录了.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">passwd -u lynn</span></span><br></pre></td></tr></table></figure>

<p>对锁定的用户lynn进行解锁,用户可登录了.</p>
<p>2、我们通过修改 <code>/etc/passwd</code>文件中用户登录的shell:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">vi /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line"><span class="symbol">bin:</span><span class="symbol">x:</span><span class="number">1</span><span class="symbol">:</span><span class="number">1</span><span class="symbol">:bin</span><span class="symbol">:/bin</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">daemon:</span><span class="symbol">x:</span><span class="number">2</span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:daemon</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">adm:</span><span class="symbol">x:</span><span class="number">3</span><span class="symbol">:</span><span class="number">4</span><span class="symbol">:adm</span><span class="symbol">:/var/adm</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">lp:</span><span class="symbol">x:</span><span class="number">4</span><span class="symbol">:</span><span class="number">7</span><span class="symbol">:lp</span><span class="symbol">:/var/spool/lpd</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">sync:</span><span class="symbol">x:</span><span class="number">5</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:sync</span><span class="symbol">:/sbin</span><span class="symbol">:/bin/sync</span></span><br><span class="line"><span class="symbol">shutdown:</span><span class="symbol">x:</span><span class="number">6</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:shutdown</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/shutdown</span></span><br><span class="line"><span class="symbol">halt:</span><span class="symbol">x:</span><span class="number">7</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:halt</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/halt</span></span><br><span class="line"><span class="symbol">mail:</span><span class="symbol">x:</span><span class="number">8</span><span class="symbol">:</span><span class="number">12</span><span class="symbol">:mail</span><span class="symbol">:/var/spool/mail</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">uucp:</span><span class="symbol">x:</span><span class="number">10</span><span class="symbol">:</span><span class="number">14</span><span class="symbol">:uucp</span><span class="symbol">:/var/spool/uucp</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">games:</span><span class="symbol">x:</span><span class="number">12</span><span class="symbol">:</span><span class="number">100</span><span class="symbol">:games</span><span class="symbol">:/usr/games</span><span class="symbol">:/sbin/nologin</span></span><br><span class="line"><span class="symbol">lynn:</span><span class="symbol">x:</span><span class="number">500</span><span class="symbol">:</span><span class="number">500</span><span class="symbol">:</span><span class="symbol">:/home/lynn</span><span class="symbol">:/bin/bash</span></span><br></pre></td></tr></table></figure>

<p>更改为:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">lynn:</span><span class="symbol">x:</span><span class="number">500</span><span class="symbol">:</span><span class="number">500</span><span class="symbol">:</span><span class="symbol">:/home/lynn</span><span class="symbol">:/sbin/nologin</span></span><br></pre></td></tr></table></figure>

<p>该用户就无法登录了.<br>到这里全部教程就结束了,两种禁止用户登录的方法,大家根据自己的情况选择把.</p>
]]></content>
  </entry>
  <entry>
    <title>linux禁用用户</title>
    <url>/2019/03/20/1224/</url>
    <content><![CDATA[<p>linux如何禁用用户呢?</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> usermod -L 用户名</span><br></pre></td></tr></table></figure>

<p>或:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> passwd -l 用户名</span><br></pre></td></tr></table></figure>

<p>这样就可以禁用这个用户了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux权限</title>
    <url>/2019/02/01/1228/</url>
    <content><![CDATA[<p>755 代表用户对该文件拥有读,写,执行的权限,同组其他人员拥有执行和读的权限,没有写的权限,其他用户的权限和同组人员权限一样.<br>777代表,user,group ,others ,都有读写和可执行权限.<br>在Unix和Linux的各种操作系统下,每个文件(文件夹也被看作是文件)都按读、写、运行设定权限.<br>例如我用ls -l命令列文件表时,得到如下输出:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span>--<span class="comment">r</span>-- <span class="comment">1</span> <span class="comment">apple</span> <span class="comment">users</span> <span class="comment">2254</span> <span class="comment">2006</span><span class="literal">-</span><span class="comment">05</span><span class="literal">-</span><span class="comment">20</span> <span class="comment">13:47</span> <span class="comment">tt</span><span class="string">.</span><span class="comment">htm</span></span><br></pre></td></tr></table></figure>

<p>从第二个字符起rw-是说用户apple有读、写权,没有运行权,接着的r–表示用户组users只有读权限,没有运行权,最后的r–指其他人(others)只有读权限,没有写权和运行权.这是系统默认设置,我可以改写tt.htm,同组的人和其他人只有权读,没人有权运行,因为只是一个html文件,不必运行.这在Novell的directory services之前很先进.<br>读、写、运行三项权限可以用数字表示,就是r=4,w=2,x=1.所以,上面的例子中的rw-r–r–用数字表示成644.<br>反过来说777就是rwxrwxrwx,意思是该登录用户(可以用命令id查看)、他所在的组和其他人都有最高权限.<br>再多说一句.我用chmod o-r tt.htm命令改权限,o-r是others的权限中减掉读.结果是:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">-rw-r----- <span class="number">1</span> bu users <span class="number">2254 2006</span>-<span class="number">05-20 13:47</span> tt.htm</span><br></pre></td></tr></table></figure>

<p>如果用命令chmod 777 tt.htm,结果是:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">-rwxrwxrwx <span class="number">1</span> bu users <span class="number">2254 2006</span>-<span class="number">05-20 13:47</span> tt.htm</span><br></pre></td></tr></table></figure>

<p>任何人都有读、写、运行三项权限.</p>
]]></content>
  </entry>
  <entry>
    <title>linux清空last和lastb记录</title>
    <url>/2018/10/09/1227/</url>
    <content><![CDATA[<p>清除登陆系统成功的记录,也就是last命令看到的记录:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> &gt; /var/<span class="built_in">log</span>/wtmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> &gt;/var/<span class="built_in">log</span>/wtmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> last</span></span><br></pre></td></tr></table></figure>

<p>此时即看不到用户登录信息.<br>清除登陆系统失败的记录,也就是lastb命令看到的记录:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> &gt; /var/<span class="built_in">log</span>/btmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> &gt; /var/<span class="built_in">log</span>/btmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> lastb</span></span><br></pre></td></tr></table></figure>

<p>此时就没有结果输出了.<br>清除历史执行命令:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">history</span> <span class="literal">-c</span></span><br></pre></td></tr></table></figure>

<p>或者,清空用户目录下的这个文件即可.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">echo</span> &gt; <span class="string">./.bash_history</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux设置程序的开机自启动与Linux服务</title>
    <url>/2019/04/02/1230/</url>
    <content><![CDATA[<p>这里只说我所知道的,举例如下:<br>需求是我要用Windows下的VNC Viewer连接到Linux Server. 我在Linux下面输入:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$vncserver</span></span></span><br></pre></td></tr></table></figure>

<p>设置好密码,好现在我就可以在Windows下面使用VNC连接到Linux桌面了,这个时候如果我的Linux Server系统重启了,那么我还得再敲一次vncserver这个命令,所以我现在要让Linux Server在开机时自动启动vncserver有哪些方法呢?<br>我可以把vncserver设置成系统的服务,并启动起来,使用如下命令查看vncserver是否已经是系统的服务:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$chkconfig</span> --list|grep vnc</span><br><span class="line">vncserver       0<span class="symbol">:off</span>   <span class="number">1</span><span class="symbol">:off</span>   <span class="number">2</span><span class="symbol">:off</span>   <span class="number">3</span><span class="symbol">:off</span>   <span class="number">4</span><span class="symbol">:off</span>   <span class="number">5</span><span class="symbol">:off</span>    <span class="number">6</span><span class="symbol">:off</span></span><br></pre></td></tr></table></figure>

<p>现在我们要设置vncserver开机自启动,使用如下命令:</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line"><span class="variable">$chkconfig</span> --level <span class="number">5</span> vncserver <span class="literal">on</span><span class="comment">#chkconfig --list|grep vnc</span></span><br><span class="line">vncserver       <span class="number">0</span>:<span class="literal">off</span>   <span class="number">1</span>:<span class="literal">off</span>   <span class="number">2</span>:<span class="literal">off</span>   <span class="number">3</span>:<span class="literal">off</span>   <span class="number">4</span>:<span class="literal">off</span>   <span class="number">5</span>:<span class="literal">on</span>    <span class="number">6</span>:<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>这个时候重启系统,那么vncserver就会以服务的方式自动起来,但是现在如果想立即使用vnc则直接敲命令 vncserver即可.<br>我们可以把vncserver这条命令写在Linux开机要运行的脚本里面,那些脚本是Linux开机时要执行的呢?<br>我知道的有以下这些:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.local</span><br><span class="line"><span class="regexp">/etc/</span>rc.sysinit</span><br><span class="line"><span class="regexp">/etc/i</span>nittab</span><br><span class="line"><span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure>

<p>这里记住Linux服务于Linux开机自启动之间的区别和联系.</p>
]]></content>
  </entry>
  <entry>
    <title>linux临时禁止除root用户登录 nologin(centos环境)</title>
    <url>/2016/12/20/1226/</url>
    <content><![CDATA[<p>操作系统为centos环境.有时候为了进行系统维护工作,临时禁止其他用户登录,可以使用nologin文件.具体的做法是在 <code>/etc/</code>目录下创建一个名称为nologin的文件.例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">touch <span class="regexp">/etc/</span>nologin</span><br></pre></td></tr></table></figure>

<p>这样将禁止随后的用户登录到系统中.禁止用户登录时,<code>/etc/nologin</code>文件中的内容将会显示给用户.例如,按如下方式创建nologin文件时:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;disable login by admin temperarily&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>nologin</span><br></pre></td></tr></table></figure>

<p>当用户试图登录时,将会显示给用户显示信息”disable login by admin temperarily”,然后注销用户.</p>
]]></content>
  </entry>
  <entry>
    <title>linux删除旧内核</title>
    <url>/2018/12/17/1229/</url>
    <content><![CDATA[<p>删除 <code>/boot</code>下面关于内核2.4的相关文件,如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vmlinuz</span>-<span class="number">2</span>.<span class="number">4</span>.xx System.map-<span class="number">2</span>.<span class="number">4</span>.xx initrd.img-<span class="number">2</span>.<span class="number">4</span>.xx</span><br></pre></td></tr></table></figure>

<p>进入对应目录:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/lib/m</span>odules</span><br></pre></td></tr></table></figure>

<p>将相应内核的模块连带文件夹删了.<br>最后编辑 grub.将相当的行删掉或注释掉就OK了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux无法添加用户帐号的原因分析</title>
    <url>/2019/06/13/1233/</url>
    <content><![CDATA[<p>1.故障问题:</p>
<p>近日配置linux服务器,,在使用useradd命令添加帐号(的)时候出现:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">unable <span class="keyword">to</span> <span class="keyword">lock</span> <span class="keyword">password</span> file</span><br><span class="line"></span><br><span class="line">cannot <span class="keyword">lock</span> shadow <span class="keyword">password</span> file</span><br><span class="line"></span><br><span class="line">useradd: unable <span class="keyword">to</span> <span class="keyword">lock</span> <span class="keyword">password</span> file</span><br></pre></td></tr></table></figure>

<p>2.解決技巧:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">在/etc/目錄下會有passwd.<span class="keyword">lock</span>、<span class="keyword">group</span>.<span class="keyword">lock</span>、gshadow.<span class="keyword">lock</span>、passwd.<span class="keyword">lock</span>、shadow.<span class="keyword">lock</span>(的)檔案,把它们刪除就OK了.</span><br></pre></td></tr></table></figure>

<p>3.具体有什么用呢?</p>
<p>顾名思义就是某人在读取时先锁定文件以防另一个程序又来读取产生错误.</p>
<p>4.产生原因:</p>
<p>可能是上次用ssh登入改东西改到一半是断线,,或者是某些程序也需要存取特定档案.</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">useradd: unable <span class="built_in">to</span> <span class="built_in">open</span> password <span class="built_in">file</span></span><br></pre></td></tr></table></figure>

<p>这种错误原因,还没有查清楚.<br>不过解决方案,已经有人放到网上了,说法不一,我总结如下:<br>其实就是更改下几个关于权利的操作文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chattr -i <span class="regexp">/etc/</span>passwd</span><br><span class="line">chattr -i <span class="regexp">/etc/</span>shadow</span><br><span class="line">chattr -i <span class="regexp">/etc/g</span>roup</span><br><span class="line">chattr -i <span class="regexp">/etc/g</span>shadow</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux调整系统时间和时区的方法</title>
    <url>/2016/08/04/1231/</url>
    <content><![CDATA[<ol>
<li><p>找到相应的时区文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/zoneinfo/</span>Asia/Shanghai</span><br></pre></td></tr></table></figure>
<p>用这个文件替换当前的 <code>/etc/localtime</code>文件.</p>
</li>
<li><p>修改 <code>/etc/sysconfig/clock</code>文件</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig<span class="built_in">/clock</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="attribute">ZONE</span>=<span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="attribute">UTC</span>=<span class="literal">false</span></span><br><span class="line"><span class="attribute">ARC</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
<li><p>时间设定成2005年8月30日</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">date</span> -s <span class="number">08</span>/<span class="number">30</span>/<span class="number">2005</span></span><br></pre></td></tr></table></figure></li>
<li><p>将系统时间设定成下午6点40分0秒</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">date</span> -s <span class="number">18</span>:<span class="number">40</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure></li>
<li><p>同步BIOS时钟,强制把系统时间写入CMOS</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">clock -w</span></span><br></pre></td></tr></table></figure></li>
<li><p>重启apache</p>
</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service apache restart</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux网络流量实时监控工具</title>
    <url>/2012/05/12/1232/</url>
    <content><![CDATA[<p>Iftop 主要用来显示本机网络流量情况及各相互通信的流量集合,如单独同那台机器间的流量大小,非常适合于代理服务器和iptables服务器使用.<br>iftop安装</p>
<p>1、安装依赖</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libpcap-devel ncurses-devel</span><br></pre></td></tr></table></figure>

<p>2、开始安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.ex-parrot.com<span class="regexp">/pdw/i</span>ftop<span class="regexp">/download/i</span>ftop-<span class="number">0.17</span>.tar.gz</span><br><span class="line">tar xzf iftop-<span class="number">0.17</span>.tar.gz</span><br><span class="line">cd iftop-<span class="number">0.17</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>3、如何使用</p>
<p>直接执行iftop即可运行查看流量情况.<br>执行iftop -h得到帮助信息.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">[root@www ~]<span class="variable">$iftop</span> -<span class="keyword">h</span></span><br><span class="line">iftop: <span class="keyword">display</span> bandwidth usage <span class="keyword">on</span> <span class="keyword">an</span> interface <span class="keyword">by</span> host</span><br><span class="line"> </span><br><span class="line">Synopsis: iftop -<span class="keyword">h</span> | [-npbBP] [-i interface] [-f filter coolcode] [-<span class="keyword">N</span> <span class="keyword">net</span>/mask]</span><br><span class="line"> </span><br><span class="line">   -<span class="keyword">h</span>                  <span class="keyword">display</span> this message</span><br><span class="line">   -<span class="keyword">n</span>                  don&#x27;t <span class="keyword">do</span> hostname lookups</span><br><span class="line">   -<span class="keyword">N</span>                  don&#x27;t convert port numbers to services</span><br><span class="line">   -p                  <span class="keyword">run</span> <span class="keyword">in</span> promiscuous mode (show traffic between other</span><br><span class="line">                       hosts <span class="keyword">on</span> the same network segment)</span><br><span class="line">   -b                  don&#x27;t <span class="keyword">display</span> a bar <span class="keyword">graph</span> of traffic</span><br><span class="line">   -B                  <span class="keyword">Display</span> bandwidth <span class="keyword">in</span> bytes</span><br><span class="line">   -i interface        listen <span class="keyword">on</span> named interface</span><br><span class="line">   -f filter coolcode      <span class="keyword">use</span> filter coolcode to select packets to <span class="keyword">count</span></span><br><span class="line">                       (default: none, but only IP packets are counted)</span><br><span class="line">   -F <span class="keyword">net</span>/mask         show traffic flows <span class="keyword">in</span>/<span class="keyword">out</span> of network</span><br><span class="line">   -P                  show ports <span class="keyword">as</span> well <span class="keyword">as</span> hosts</span><br><span class="line">   -<span class="keyword">m</span> limit            sets the upper limit <span class="keyword">for</span> the bandwidth scale</span><br><span class="line">   -c config <span class="keyword">file</span>      specifies <span class="keyword">an</span> alternative configuration <span class="keyword">file</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux系统备份与恢复的方法与工具介绍</title>
    <url>/2011/03/07/1234/</url>
    <content><![CDATA[<p>无论什么系统,最安全的做法.就是调试好后,做个备份.到时遇到什么大问题,直接恢复出来,方便而省事.</p>
<p>下面详细Linux备份与恢复方法:</p>
<p>备份与恢复系统承担着事前备份与事后恢复的职能.在当前高速发展的网络环境下,任何一个网络上的信息系统都不可能保证绝对的安全.只要有网络存在,就会有来自网络的形形色色的威胁.为了抵御网络的攻击和入侵,虽然我们引入了日趋成熟的入侵检测系统、防火墙系统等,黑客们的入侵手段也日益高明,他们总能找到这些系统的安全漏洞及不足进行入侵,因而网络入侵所引起的安全事件呈逐年增加之势.</p>
<p>在这种情况下,我们难以保证网络中关键系统的绝对安全,因而就需要采用备份及恢复技术.备份及恢复技术就是使用存储介质和一定的策略,定期将系统业务数据备份下来,以保证数据意外丢失时能尽快恢复,将用户的损失降到最低点.它是信息安全学科中一种非常重要的核心技术.</p>
<p>Linux下的备份技术</p>
<p>对于备份和恢复来说,Linux提供了诸如tar、cpio、 dump等工具来实现.这样,用户无需花钱购买,便可根据系统的实际情况,结合使用相应的备份恢复工具实现备份与恢复的基本功能.</p>
<p>tar工具介绍</p>
<p>tar是一个已移植到Linux中的经典Unix命令.tar是tape archive(磁带归档)的缩写,最初设计用于将文件打包到磁带上,现在我们大都使用它来实现备份某个分区或者某些重要的文件目录.我们使用 tar可以打包整个目录树,这使得它特别适合用于备份.归档文件可以全部还原,或从中展开单独的文件和目录.备份可以保存到基于文件的设备或磁带设备上.文件可以在还原时重定向,以便将它们重新放到一个与最初保存它们的目录(或系统)不同的目录(或系统).tar是与文件系统无关的,因而它的适用范围很广,它可以使用在ext2、ext3、jfs、Reiser和其他文件系统上.</p>
<p>使用tar非常类似于使用诸如Windows环境下的Winzip、WinRAR这样的文件实用工具.只需将它指向一个目的(可以是文件或设备),然后指定想要打包的文件,就可以通过标准的压缩类型来动态压缩归档文件,或指定一个自己选择的外部压缩程序.要通过bzip2压缩或解压缩文件,可使用tar -z命令.</p>
<p>下面是一个简单的使用该工具进行数据备份的例子:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar czvf - <span class="regexp">/root/</span>code &gt; <span class="regexp">/tmp/</span>code_bak.tgz (将<span class="regexp">/root/</span>code目录下的所有程序文件打包备份到<span class="regexp">/tmp/</span>code_bak.tgz</span><br><span class="line">tar xzvf <span class="regexp">/tmp/</span>code_bak.tgz <span class="regexp">/root/</span>code (将备份的目录文件恢复到指定目录)</span><br></pre></td></tr></table></figure>

<p>cpio工具介绍</p>
<p>cpio命令可以从tar或者cpio档案文件中拷入或者拷出文件.cpio命令和tar命令兼容,但是这个命令具备一些tar命令没有的功能,如下所示:</p>
<p>支持cpio和tar两种档案文件格式;</p>
<p>支持许多老式磁带数据格式;</p>
<p>能够通过一个管道(pipe-line)读取文件的文件名.</p>
<p>目前看来,只有很少的Linux软件包是以cpio格式发行的.用户如果对cpio命令的详细情况感兴趣,可以通过”man cpio “命令阅读它的使用手册.</p>
<p>dump 和 restore介绍</p>
<p>dump可以执行类似tar的功能.然而,dump倾向于考虑文件系统而不是个别的文件.dump检查ext2文件系统上的文件,并确定哪些文件需要备份.这些文件将出于安全保护而被复制到给定的磁盘、磁带或其他存储媒体上.在大多数媒体上,容量是通过一直写入直至返回一个end-of-media标记来确定的.</p>
<p>配合dump的程序是restore,它用于从转储映像还原文件.restore命令执行转储的逆向功能.可以首先还原文件系统的完全备份,而后续的增量备份可以在已还原的完全备份之上覆盖.可以从完全或部分备份中还原单独的文件或者目录树.</p>
<p>dump和restore都能在网络上运行,因此用户可以通过远程设备进行备份或还原.dump和restore使用磁带驱动器和提供广泛选项的文件设备.然而,两者都仅限用于ext2和ext3文件系统.如果使用的是JFS、Reiser或者其他文件系统,将需要其他的实用工具,比如 tar. 举个例子:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">dump</span> <span class="number">0</span>f <span class="regexp">/dev/</span>nst0 /(将ext2文件系统备份到第一个SCSI设备)</span><br><span class="line">restore -xf <span class="regexp">/dev/</span>nst0 <span class="regexp">/home/</span>code (将备份的SCSI设备中的<span class="regexp">/home/</span>code目录下的所有数据还原到磁盘)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux下Apache与Tomcat整合</title>
    <url>/2017/09/24/1235/</url>
    <content><![CDATA[<p>1、准备</p>
<p>下载需要的文件.这里假定你已经正确安装配置好了JDK.<br>到Apache官方网站下载所需要的文件:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">httpd</span>-<span class="number">2</span>.<span class="number">2</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"><span class="attribute">apache</span>-tomcat-<span class="number">5</span>.<span class="number">5</span>.<span class="number">12</span>.tar.gz</span><br><span class="line"><span class="attribute">jakarta</span>-tomcat-connectors-<span class="number">1</span>.<span class="number">2</span>.<span class="number">15</span>-src.tar.gz</span><br><span class="line"><span class="comment">#其中httpd和jakarta-tomcat-connectors为源码包,apache-tomcat为二进制包.</span></span><br></pre></td></tr></table></figure>

<p>2、安装Apache</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar xzvf httpd-<span class="number">2.2</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">cd httpd-<span class="number">2.2</span>.<span class="number">0</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>apache2 --enable-so</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>3、安装Tomcat</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cp</span> apache-tomcat-<span class="number">5</span>.<span class="number">5</span>.<span class="number">12</span>.tar.gz /usr/local/</span><br><span class="line"><span class="attribute">cd</span> /usr/local</span><br><span class="line"><span class="attribute">tar</span> xzvf apache-tomcat-<span class="number">5</span>.<span class="number">5</span>.<span class="number">12</span>.tar.gz</span><br><span class="line"><span class="attribute">ln</span> -s apache-tomcat-<span class="number">5</span>.<span class="number">5</span>.<span class="number">12</span> tomcat</span><br></pre></td></tr></table></figure>

<p>4、编译生成mod_jk</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">tar xzvf jakarta-tomcat-connectors-<span class="number">1.2</span>.<span class="number">15</span>-src.tar.gz</span><br><span class="line">cd jakarta-tomcat-connectors-<span class="number">1.2</span>.<span class="number">15</span>-src<span class="regexp">/jk/</span><span class="keyword">native</span></span><br><span class="line">.<span class="regexp">/configure --with-apxs=/u</span>sr<span class="regexp">/local/</span>apache2<span class="regexp">/bin/</span>apxs</span><br><span class="line">make</span><br><span class="line">cp .<span class="regexp">/apache-2.0/m</span>od_jk.so <span class="regexp">/usr/</span>local<span class="regexp">/apache2/m</span>odules/</span><br></pre></td></tr></table></figure>

<p>5、配置</p>
<p>在 <code>/usr/local/apache2/conf/</code>下面建立两个配置文件mod_jk.conf和workers.properties.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vi</span> mod_jk.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>添加以下内容:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment">#指出mod_jk模块工作所需要的工作文件workers.properties的位置</span></span><br><span class="line">JkWorkersFile /usr/<span class="keyword">local</span>/apache2/conf/workers.properties</span><br><span class="line"><span class="comment"># Where to put jk logs</span></span><br><span class="line">JkLogFile /usr/<span class="keyword">local</span>/apache2/logs/mod_jk.log</span><br><span class="line"><span class="comment"># Set the jk log level [debug/error/info]</span></span><br><span class="line">JkLogLevel info</span><br><span class="line"><span class="comment"># Select the log format</span></span><br><span class="line">JkLogStampFormat <span class="string">&quot;[%a %b %d %H:%M:%S %Y]&quot;</span></span><br><span class="line"><span class="comment"># JkOptions indicate to send SSL KEY SIZE,</span></span><br><span class="line">JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories</span><br><span class="line"><span class="comment"># JkRequestLogFormat set the request format</span></span><br><span class="line">JkRequestLogFormat <span class="string">&quot;%w %V %T&quot;</span></span><br><span class="line"><span class="comment"># 将所有servlet 和jsp请求通过ajp13的协议送给Tomcat,让Tomcat来处理</span></span><br><span class="line">JkMount /servlet/* worker1</span><br><span class="line">JkMount /*.jsp worker1</span><br></pre></td></tr></table></figure>

<p>编辑workers.properties添加以下内容:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Defining a worker named worker1 and of type ajp13</span></span><br><span class="line"><span class="attr">worker.list</span>=worker1</span><br><span class="line"><span class="comment"># Set properties for worker1</span></span><br><span class="line"><span class="attr">worker.worker1.type</span>=ajp13</span><br><span class="line"><span class="attr">worker.worker1.host</span>=localhost</span><br><span class="line"><span class="attr">worker.worker1.port</span>=<span class="number">8009</span></span><br><span class="line"><span class="attr">worker.worker1.lbfactor</span>=<span class="number">50</span></span><br><span class="line"><span class="attr">worker.worker1.cachesize</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">worker.worker1.cache_timeout</span>=<span class="number">600</span></span><br><span class="line"><span class="attr">worker.worker1.socket_keepalive</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">worker.worker1.socket_timeout</span>=<span class="number">300</span></span><br></pre></td></tr></table></figure>

<p>再配置httpd.conf,作以下修改:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">将<span class="keyword">Listen</span> <span class="number">80</span> 修改为 <span class="keyword">Listen</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">80.</span></span><br><span class="line">将ServerName 修改为 ServerName LocalHost:<span class="number">80.</span></span><br><span class="line">在DirectoryIndex中添加 <span class="keyword">index</span>.jsp.</span><br><span class="line">我的网页放在`/var/wwwroot`下,所以要修改DocumentRoot.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DocumentRoot &quot;/var/wwwroot&quot;</span><br><span class="line">&lt;Directory &quot;/var/wwwroot&quot;&gt;</span><br><span class="line">    <span class="keyword">Options</span> Includes FollowSymLinks</span><br><span class="line">    AllowOverride <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">Order</span> deny,allow</span><br><span class="line">    Allow <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">    XBitHack <span class="keyword">on</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;Directory &quot;/var/wwwroot/WEB-INF&quot;&gt;</span><br><span class="line">    <span class="keyword">Order</span> deny,allow</span><br><span class="line">    Deny <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<p>增加关于加载mod_jk的语句:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">LoadModule jk_module modules/mod_jk.so</span><br><span class="line"><span class="keyword">Include</span> <span class="regexp">/usr/</span>local<span class="regexp">/apache2/</span>conf/mod_jk.conf</span><br></pre></td></tr></table></figure>

<p>最后编辑Tomcat的配置文件server.xml,在HOST段中加入:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Context <span class="attribute">path</span>=<span class="string">&quot;&quot;</span> <span class="attribute">docBase</span>=<span class="string">&quot;/var/wwwroot&quot;</span> <span class="attribute">debug</span>=<span class="string">&quot;0&quot;</span> <span class="attribute">reloadable</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">crossContext</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>在 <code>/var/wwwroot</code>下建立一个index.jsp,启动Apache和Tomcat,用浏览器访问<a href="http://localhost/">http://localhost/</a> ,应该可以看到正确的页面了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下ape转换flac</title>
    <url>/2018/08/29/1236/</url>
    <content><![CDATA[<p>ape转换为flac:<br>下载shntool:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install flac shntool;</span><br></pre></td></tr></table></figure>

<p>然后执行:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">shntool <span class="keyword">split</span> -t <span class="string">&quot;%n.%p-%t&quot;</span> -f example_UTF-<span class="number">8</span>.cue -o flac example.ape -d flacOutputDir</span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下PacketiX的安装设置</title>
    <url>/2011/02/16/1237/</url>
    <content><![CDATA[<p>download:</p>
<p><a href="http://www.softether.co.jp/jp/download/file.aspx/37520A8DB099EC339A07F95D005370B22CA9E67C/vpnclient-5280-rtm-linux-x64.tar.gz">http://www.softether.co.jp/jp/download/file.aspx/37520A8DB099EC339A07F95D005370B22CA9E67C/vpnclient-5280-rtm-linux-x64.tar.gz</a></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> xzvf vpnclient-<span class="number">5280</span>-rtm-linux-x<span class="number">64</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> vpnclient</span><br><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>

<p>notice:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">cannot <span class="builtin-name">find</span> -lcurses</span><br></pre></td></tr></table></figure>

<p>solution:</p>
<p>copy these two files under <code>/usr/lib64</code></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">libncurses.<span class="keyword">a</span></span><br><span class="line">libncurses.so</span><br></pre></td></tr></table></figure>

<p>to vpnclient install directory.<br>and:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi Makefile</span></span><br></pre></td></tr></table></figure>

<p>change:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-lcurses</span></span><br></pre></td></tr></table></figure>

<p>to:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-lncurses -L.</span></span><br></pre></td></tr></table></figure>

<p>final:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>

<p>How to access vpn client:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./vpncmd</span> localhost</span><br></pre></td></tr></table></figure>

<p>configure:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/vpnclient/</span></span><br><span class="line">./vpncmd</span><br></pre></td></tr></table></figure>

<p>select 2 and enter next, you will getm VPN Client:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">command</span>: (exam:fujikazu /fujikazu<span class="number">123456</span>)</span><br></pre></td></tr></table></figure>

<p>create name:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">NicCreate VPNChina</span></span><br></pre></td></tr></table></figure>

<p>configure args:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">AccountCreate VPNChina <span class="regexp">/SERVER:vpn.a-it.jp:8888 /</span>HUB:CHINA-HUB <span class="regexp">/USERNAME:fujikazu /</span>NICNAME:VPNChina</span><br></pre></td></tr></table></figure>

<p>set up vpn:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AccountStartupSet VPNChina</span></span><br></pre></td></tr></table></figure>

<p>set password:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">AccountPasswordSet VPNChina <span class="regexp">/PASSWORD:fujikazu123456 /</span>TYPE:standard</span><br></pre></td></tr></table></figure>

<p>connect vpn:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AccountConnect VPNChina</span></span><br></pre></td></tr></table></figure>

<p>cut off vpn:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AccountDisconnect VPNChina</span></span><br></pre></td></tr></table></figure>

<p>test:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ping</span> <span class="number">192.168.6.52</span></span><br></pre></td></tr></table></figure>

<p>It ‘s OK if ping reachable.</p>
]]></content>
  </entry>
  <entry>
    <title>Linux下安装咪咕音乐播放器,解决无声</title>
    <url>/2015/03/26/1240/</url>
    <content><![CDATA[<p>咪咕音乐播放器是中国移动为广大网友精心打造的正版音乐客户端软件,强大的正版音乐搜索、快捷的音乐下载到本地和手机、完美的多种音乐风格播放为你带来最优的音乐体验.</p>
<p>下载地址:<br><a href="http://interface-club.12530.com/update/Linux/MiguMusic_2010Beta1.bin">http://interface-club.12530.com/update/Linux/MiguMusic_2010Beta1.bin</a><br>推荐大家下完整版,据网上流传说精简版装不了,我给的下载地址就是完整版.</p>
<p>下载好后改名成1.bin放到主文件夹下,不知道主文件夹在哪就看桌面左上角那三个选项卡的第二个,位置,点击出来的列表,第一个就是主文件夹了.<br>对着1.bin右键,选择属性.<br>如图,勾上允许以程序执行文件,然后关闭.<br>然后打开终端,输入./1.bin,然后回车.<br>下一步.<br>同意协议,下一步.<br>看清楚了哈,这里是指播放器安装到哪里,不要习惯性的认为是把音乐下到哪里…<br>安装.<br>下一步.<br>建议不要启动咪咕音乐,阅读我(Readme)可以看看,下面就来做Readme里要做的东东,因为还没完全弄完,然后点完成<br>等待一下,到这里就可以把终端关闭了.<br>桌面已经自动创建号一个图标了～<br>不过还不能用呢,现在的功能不完全,一些FLASH和广告是没办法显示的..囧,好玩吧,还有广告呢…而且也放不了音乐…<br>行了,继续,打开<a href="http://get.adobe.com/cn/flashplayer/otherversions/">http://get.adobe.com/cn/flashplayer/otherversions/</a><br>选择Linux.<br>选择.tar.gz,然后下载.<br>下载完成后先暂时解压到桌面～<br>然后回到主文件夹,界面左上角编辑 – 首选项.<br>如图勾选,我们下下来的FLASH插件要解压到的地方是.开头的文件夹,所以我们要显示.<br>一路找到这,默认是没有plugins这个文件夹的,我们手动建立,然后把解压到桌面上的那个东东放进去,然后再去掉显示隐藏文件的那个勾勾就行.<br>好了,这里只是Readme里的第一步,不要以为这样就玩了,完成这个东东只是为了让音乐资讯和广告显示而已…(=.-!我还是很不适应..Linux…的..软件..有…广告).</p>
<p>然后打开终端,输入:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install phonon-backend-gstreamer</span><br></pre></td></tr></table></figure>

<p>(这个命令是我网上查到的,Readme里没有提到的,不装这个等下是没声音的)<br>然后等安装完就输入:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt-get install gstreamer<span class="number">0</span>.<span class="number">10</span>-ffmpeg</span><br></pre></td></tr></table></figure>

<p>然后等安装完…然后..</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt-get install gstreamer<span class="number">0</span>.<span class="number">10</span>-fluendo-mp<span class="number">3</span></span><br><span class="line"><span class="attribute">sudo</span> apt-get install gstreamer<span class="number">0</span>.<span class="number">10</span>-plugins-ugly</span><br><span class="line"><span class="attribute">sudo</span> apt-get install gstreamer<span class="number">0</span>.<span class="number">10</span>-plugins-bad</span><br><span class="line"><span class="attribute">sudo</span> apt-get install libgtk<span class="number">2</span>.<span class="number">0</span>-dev</span><br></pre></td></tr></table></figure>

<p>然后就OK了…<br>这时候打开咪咕音乐,选择本地音乐或者试听就有声音咯～</p>
]]></content>
  </entry>
  <entry>
    <title>linux下xampp搭配</title>
    <url>/2014/09/30/1238/</url>
    <content><![CDATA[<p>一、安装</p>
<p>这里我选择的是CentOS,当然,版本你可以自己选择,官网地址  <a href="http://www.centos.org/">http://www.centos.org</a>.<br>当然,有一点要值得注意,就是32位和64位的选择.如果机器符合64位,那就没必要用32位的.<br>安装这里就没什么好讲的了,尽量最小化安装,留个”开发工具”就可以了!<br>至于分区,google一下,很多!但我们在第一次接触时,尽量选择默认分区.先顺利的达成应用,以后再慢慢研究尚可.这能增加你的信心和学习效率!</p>
<p>二、AMP的安装和配置、优化</p>
<p>也就是apache、mysql、php.<br>我的学习过程是,用一个集成的安装包,而不是一上来就挨个的那样配置,会对信心大打折扣,并且引出的问题会很多!<br>这里,我推荐的是:LAMPP 官方地址:<a href="http://www.apachefriends.org/zh_cn/xampp-linux.html">http://www.apachefriends.org/zh_cn/xampp-linux.html</a>.<br>下载源码包,然后解压进行安装、启动.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>nchc.dl.sourceforge.net/s ... linux-<span class="number">1.6</span>.<span class="number">8</span>a.tar.gz</span><br><span class="line">tar xvfz xampp-linux-<span class="number">1.6</span>.<span class="number">8</span>a.tar.gz -C /opt</span><br><span class="line"><span class="regexp">/opt/</span>lampp/lampp start</span><br></pre></td></tr></table></figure>

<p>此时,lampp组件就成功启动了,但它并不是每次随系统启动.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/opt/</span>lampp<span class="regexp">/lampp /</span>etc<span class="regexp">/rc.d/</span>rc3.d/S99lampp</span><br><span class="line">ln -s <span class="regexp">/opt/</span>lampp<span class="regexp">/lampp /</span>etc<span class="regexp">/rc.d/</span>rc4.d/S99lampp</span><br><span class="line">ln -s <span class="regexp">/opt/</span>lampp<span class="regexp">/lampp /</span>etc<span class="regexp">/rc.d/</span>rc5.d/S99lampp</span><br></pre></td></tr></table></figure>

<p>这样,就OK了!<br>然后我们来重启服务器,看下成功与否.</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure>

<p>但这个时候是比较危险的,如果你的服务器已经在公网的话,那么你需要马上执行下面的命令,根据提示,设定密码.具体的可参照上面给出的lampp官方说明.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>lampp/lampp security</span><br></pre></td></tr></table></figure>

<p>开启 eAccelerator:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/opt/</span>lampp<span class="regexp">/etc/</span>php.ini</span><br></pre></td></tr></table></figure>

<p>查找 eAccelerator 将前面的 # 去掉,重启apache即可.<br>另外,参数可以默认即可,当然,你也可以改一下,比如我把 eaccelerator.shm_size 修改为 32.<br>意思是eAccelerator缓存可用的共享内存数量为32M.<br>这个时候,实质上,你的LAMP已经是基本可以应用了!但有一点你要知道,这个组件默认是没有zend的,你可以再另外安装配置:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">wget http:<span class="string">//</span>网址<span class="string">/ZendOptimizer-3.3.3-linux-glibc23-i386.tar.gz</span></span><br><span class="line">tar xvzf ZendOptimizer-3.3.3-linux-glibc23-i386.tar.gz</span><br><span class="line"><span class="keyword">cd</span> ZendOptimizer-3.2.2-linux-glibc21-i386</span><br><span class="line"><span class="string">./install.sh</span></span><br></pre></td></tr></table></figure>

<p>在Please specify the location for installing ZendOptimizer:提示后输入ZendOptimizer安装路径,例:如:<code>/data/webserver/zend</code>.<br>在Confirm the location of your php.ini file:提示后输入php.ini文件所在目录,例如 <code>/data/webserver/php/etc</code>.<br>在Specify the full path to the Apache control utility (apachectl):提示输入apachectl绝对路径,例:如:<code>/data/webserver/apache/bin/apachectl</code>.<br>时间差问题.<br>在php.ini添加(eaccelerator下边).</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">;;;;;;;;;;;;;;;;;;;</span></span><br><span class="line"><span class="comment">; Module Settings ;</span></span><br><span class="line"><span class="comment">;;;;;;;;;;;;;;;;;;;</span></span><br><span class="line"><span class="section">[Date]</span></span><br><span class="line"><span class="comment">; Defines the default timezone used by the date functions</span></span><br><span class="line"><span class="comment">;date.timezone =</span></span><br><span class="line"><span class="attr">date.timezone</span> = Etc/GMT-<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>修改mysql最大连接数:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>在 [mysqld] 下面加入一行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">max_connections</span> = <span class="number">1500</span></span><br></pre></td></tr></table></figure>

<p>伪静态:</p>
<p>打开apache的配置文件(httpd.conf).<br>找到<br>#LoadModule rewrite_module modules/mod_rewrite.so<br>把前面的#去掉.<br>然后找到AllowOverride None,将其全部改成AllowOverride All.<br>即可支持伪静态功能.<br>在bbs等站点根目录下放置相应htaccess规则即可.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">Include</span> conf<span class="regexp">/extra/</span>httpd-mpm.conf</span><br><span class="line">#<span class="keyword">Include</span> conf<span class="regexp">/extra/</span>httpd-<span class="keyword">default</span>.conf</span><br><span class="line">#<span class="keyword">Include</span> conf<span class="regexp">/extra/</span>httpd-info.conf</span><br><span class="line">#<span class="keyword">Include</span> conf<span class="regexp">/extra/</span>httpd-vhosts.conf #这个就是apache虚拟主机的配置文件了</span><br></pre></td></tr></table></figure>

<p>去掉前边的#  按照相关原则进行合理配置!<br>影响最大的是 httpd-mpm.conf:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;ifModule prefork.c&gt;</span></span><br><span class="line">    <span class="attribute">ServerLimit</span> <span class="number">2000</span></span><br><span class="line">    <span class="attribute">StartServers</span> <span class="number">10</span></span><br><span class="line">    <span class="attribute">MinSpareServers</span> <span class="number">10</span></span><br><span class="line">    <span class="attribute">MaxSpareServers</span> <span class="number">15</span></span><br><span class="line">    <span class="attribute">MaxClients</span> <span class="number">1500</span></span><br><span class="line">    <span class="attribute">MaxRequestsPerChild</span> <span class="number">10000</span></span><br><span class="line"><span class="section">&lt;/ifModule&gt;</span></span><br></pre></td></tr></table></figure>

<p>虚拟主机配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Include conf/extra/httpd-vhosts.conf #这个就是apache虚拟主机的配置文件了</span></span><br><span class="line"><span class="section">&lt;virtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">    <span class="attribute">ServerAdmin</span> www@iamhe.cn</span><br><span class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /opt/lampp/htdocs/wwwroot/bbs</span><br><span class="line">    <span class="attribute"><span class="nomarkup">ServerName</span></span> bbs.<span class="number">123</span>.com</span><br><span class="line">    <span class="attribute">ServerAlias</span> bbs<span class="number">2</span>.<span class="number">123</span>.com</span><br><span class="line">    <span class="attribute">ErrorLog</span> logs/bbs.<span class="number">123</span>.com-error_log</span><br><span class="line">    <span class="attribute">CustomLog</span> logs/bbs.<span class="number">123</span>.com-access_log common</span><br><span class="line"><span class="section">&lt;/virtualHost&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在,bbs.123.com和bbs2.123.com 即可同时访问这个目录,那么如果你不想让 bbs2 访问,那么去掉  ServerAlias bbs2.123.com   这行就可以了.</p>
<p>三、安全方面的问题</p>
<p>这个一看就知道什么意思吧?<br>修改 Options Indexes FollowSymLinks ExecCGI Includes 为 Options FollowSymLinks Includes.<br>隐藏apache版本相关信息 (错误页面).<br>添加到httpd.conf文件结尾即可:<br>ServerSignature Off<br>ServerTokens Prod</p>
<p>提升PHP安全性:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">php.ini</span><br></pre></td></tr></table></figure>

<p>找到:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">disable_functions</span> =</span><br></pre></td></tr></table></figure>

<p>设置为:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">disable_functions = phpinfo,passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,popen,<span class="keyword">chroot</span>,escapeshellcmd,escapeshellarg,shell_exec,proc_open,proc_get_status,ini_restore</span><br><span class="line">disable_functions = phpinfo,passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,<span class="keyword">chroot</span>,scandir,chgrp,<span class="keyword">chown</span>,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,pfsockopen,openlog,syslog,<span class="keyword">readlink</span>,<span class="keyword">symlink</span>,popepassthru,stream_socket_server</span><br></pre></td></tr></table></figure>

<p>这里我给出了两组,根据你自己需求写吧.<br>关闭 ipv6 以最大限度保证安全和快速.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">ifconfig -a <span class="comment">#列出全部网络接口信息</span></span><br><span class="line">sit0 Link encap<span class="function">:IPv6-in-IPv4</span> <span class="comment">#确认ipv6是被启动的状态</span></span><br><span class="line">vi <span class="string">/etc/modprobe.conf</span> <span class="comment">#修改相应配置文件,添加如下行到文尾:</span></span><br><span class="line"><span class="keyword">alias</span> net-pf-10 off</span><br><span class="line"><span class="keyword">alias</span> ipv6 off</span><br><span class="line"><span class="keyword">shutdown</span> -r now <span class="comment">#重新启动系统,使设置生效</span></span><br></pre></td></tr></table></figure>

<p>如果你安装了X,那么想让linux默认不启动X,而是启动字符文本….</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/i</span>nittab</span><br></pre></td></tr></table></figure>

<p>文档中,将 id:5改成3即可.<br>(在/etc/inittab修改运行等级为5是系统开机进入X windows,运行等级为3是系统开机进入文本.).</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">Default</span> runlevel. (<span class="keyword">Do</span> <span class="built_in">not</span> <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">0</span> <span class="built_in">or</span> <span class="number">6</span>)</span><br><span class="line"><span class="symbol">id:</span><span class="number">3</span>:initdefault:</span><br></pre></td></tr></table></figure>

<p>字符终端模式下启动x-windows:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">startx</span></span><br></pre></td></tr></table></figure>

<p>ARP绑定:</p>
<p>为了开机启动:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>增加:</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">arp</span> -s 网关<span class="built_in">IP</span> 网关MAC</span><br><span class="line"><span class="symbol">arp</span> -s 服务器<span class="built_in">IP</span> 服务器MAC</span><br></pre></td></tr></table></figure>

<p>SYN、DDOS的解决办法  (没有硬防的情况下).<br>这个只能抵御,不能本质上防范.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --syn -m limit --limit <span class="number">1</span>/s -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST RST -m limit --limit <span class="number">1</span>/s -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit <span class="number">1</span>/s -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo <span class="number">2048</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/tcp_max_syn_backlog</span><br><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/tcp_synack_retries</span><br><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/tcp_syn_retries</span><br><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4/tcp_syncookies</span><br></pre></td></tr></table></figure>

<p>如果你有幸能分析出攻击者的真实肉机IP地址.<br>那么你可以同样通过linux防火墙来封掉他的IP地址或IP段,比如:<br>单个IP的命令是:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -s <span class="number">127.0</span>.<span class="number">0.1</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封IP段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.1.0.0</span>/<span class="number">16</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.2.0.0</span>/<span class="number">16</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.3.0.0</span>/<span class="number">16</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封整个段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.0.0.0</span>/<span class="number">8</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>封几个段的命令是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.0.1.0</span>/<span class="number">24</span> -j DROP</span><br><span class="line"><span class="attribute">iptables</span> -I INPUT -s <span class="number">127.0.2.0</span>/<span class="number">24</span> -j DROP</span><br></pre></td></tr></table></figure>

<p>对LAMPP套件的补充<br>在初步安装完后,你在浏览器里输入  localhost  即可出现lampp的界面,里面包括你开放的组件,安全状况,phpinfo、以及流量监 测,都在里面.<br>这个界面的地址是 htdocs的 index.html.<br>那么你在没配置虚拟主机时,任何人通过IP或你绑定的域名,都可以访问得到.<br>我的建议是,在 htdocs 下,新建一个 robots.txt 文件来屏蔽所有的搜索引擎.<br>然后再另建一个 wwwroot 目录来存放你的网站.<br>套件的官方地址是:<a href="http://www.apachefriends.org/zh_cn/xampp-linux.html">http://www.apachefriends.org/zh_cn/xampp-linux.html</a>.<br>这个套件有win、linux、macos 等版本,其实它是适合做开发环境的,并不适合生产环境.<br>但如果你做一下安全配置,例如把不需要的都关掉,也是可以投入生产环境的.</p>
]]></content>
  </entry>
  <entry>
    <title>Linux下ZendOptimizer的安装与配置</title>
    <url>/2016/08/28/1239/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget http:<span class="regexp">//</span>www.phpchina.com<span class="regexp">/download/</span>soft<span class="regexp">/zend/</span>optimizer<span class="regexp">/3.3.3/</span>ZendOptimizer-<span class="number">3.3</span>.<span class="number">3</span>-linux-glibc23-x86_64.tar.gz</span><br><span class="line">tar xzvf ZendOptimizer-<span class="number">3.3</span>.<span class="number">3</span>-linux-glibc23-x86_64.tar.gz</span><br><span class="line">cd ZendOptimizer-<span class="number">3.3</span>.<span class="number">3</span>-linux-glibc23-x86_64</span><br><span class="line">.<span class="regexp">/install.sh #自动 ./i</span>nstall-tty <span class="comment">#手动安装</span></span><br></pre></td></tr></table></figure>

<p>过程如下:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">Please specify the <span class="keyword">location</span> <span class="title">for</span> installingzend Optimizer:</span><br><span class="line">/usr/local/Zend</span><br><span class="line">Enter the <span class="keyword">location</span> <span class="title">of</span> your php.ini file:</span><br><span class="line">/etc/php5/apache2</span><br><span class="line">Specify the full path to the Apachecontrol utility(apachectl):</span><br><span class="line">/usr/sbin/apache2ctl</span><br><span class="line">Installation couldn&#x27; detect the <span class="keyword">location</span> <span class="title">of</span> Apache executable. Pleaes specify the full path to the Apache binary (httpd):</span><br><span class="line">/etc/init.d/apache2</span><br><span class="line">Please specify the full path to the Apache configuration file (httpd.conf):</span><br><span class="line">/etc/init.d/apache2</span><br></pre></td></tr></table></figure>

<p>如无配置错误,这样就可以用ZEND编译器了…</p>
]]></content>
  </entry>
  <entry>
    <title>linux下查看CPU型号的命令命令</title>
    <url>/2015/02/12/1241/</url>
    <content><![CDATA[<p>2019年8月16日更新:<br>要查看cpu型号也可以使用如下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/proc/</span>cpuinfo</span><br></pre></td></tr></table></figure>

<p>还能看到主频核心数之类的信息.</p>
<p>以下为原文章:</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">[root@localhost nginx<span class="number">-1.0</span><span class="number">.13</span>]$ cat /<span class="keyword">proc</span>/cpuinfo |<span class="title"> grep</span> &quot;model<span class="title"> name&quot;</span></span><br><span class="line">model<span class="title"> name</span>    :<span class="title"> Pentium(R)</span> Dual-Core<span class="title">  CPU</span> <span class="title">     E5700</span> @ 3.00GHz</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux下查看文件和文件夹大小</title>
    <url>/2017/11/10/1242/</url>
    <content><![CDATA[<p>当磁盘大小超过标准时会有报警提示,这时如果掌握df和du命令是非常明智的选择.<br>df可以查看一级文件夹大小、使用比例、档案系统及其挂入点,但对文件却无能为力.<br>du可以查看文件及文件夹的大小.<br>两者配合使用,非常有效.比如用df查看哪个一级目录过大,然后用df查看文件夹或文件的大小,如此便可迅速确定症结.</p>
<p>下面分别简要介绍:</p>
<p>df命令可以显示目前所有文件系统的可用空间及使用情形,请看下列这个例子:<br>以下是代码片段:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line"></span><br><span class="line">Filesystem            <span class="keyword">Size</span>  Used Avail Use% Mounted on</span><br><span class="line"><span class="regexp">/dev/</span>sda1             <span class="number">3.9</span>G  <span class="number">300</span>M  <span class="number">3.4</span>G   <span class="number">8</span>% /</span><br><span class="line"><span class="regexp">/dev/</span>sda7             <span class="number">100</span>G  <span class="number">188</span>M   <span class="number">95</span>G   <span class="number">1</span>% /data0</span><br><span class="line"><span class="regexp">/dev/</span>sdb1             <span class="number">133</span>G   <span class="number">80</span>G   <span class="number">47</span>G  <span class="number">64</span>% /data1</span><br><span class="line"><span class="regexp">/dev/</span>sda6             <span class="number">7.8</span>G  <span class="number">218</span>M  <span class="number">7.2</span>G   <span class="number">3</span>% /var</span><br><span class="line"><span class="regexp">/dev/</span>sda5             <span class="number">7.8</span>G  <span class="number">166</span>M  <span class="number">7.2</span>G   <span class="number">3</span>% /tmp</span><br><span class="line"><span class="regexp">/dev/</span>sda3             <span class="number">9.7</span>G  <span class="number">2.5</span>G  <span class="number">6.8</span>G  <span class="number">27</span>% /usr</span><br><span class="line">tmpfs                 <span class="number">2.0</span>G     <span class="number">0</span>  <span class="number">2.0</span>G   <span class="number">0</span>% <span class="regexp">/dev/</span>shm</span><br></pre></td></tr></table></figure>

<p>参数 -h 表示使用「Human-readable」的输出,也就是在档案系统大小使用 GB、MB 等易读的格式.</p>
<p>上面的命令输出的第一个字段(Filesystem)及最后一个字段(Mounted on)分别是档案系统及其挂入点.我们可以看到 <code>/dev/sda1</code> 这个分割区被挂在根目录下.<br>接下来的四个字段 Size、Used、Avail、及 Use% 分别是该分割区的容量、已使用的大小、剩下的大小、及使用的百分比. FreeBSD下,当硬盘容量已满时,您可能会看到已使用的百分比超过 100%,因为 FreeBSD 会留一些空间给 root,让 root 在档案系统满时,还是可以写东西到该档案系统中,以进行管理.</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">du:</span>查询文件或文件夹的磁盘使用空间</span><br></pre></td></tr></table></figure>

<p>如果当前目录下文件和文件夹很多,使用不带参数du的命令,可以循环列出所有文件和文件夹所使用的空间.这对查看究竟是那个地方过大是不利的,所以得指定 深入目录的层数,参数:–max-depth=,这是个极为有用的参数!如下,注意使用”*”,可以得到文件的使用空间大小.<br>提醒:一向命令比linux复杂的FreeBSD,它的du命令指定深入目录的层数却是比linux简化,为 -d.<br>以下是代码片段:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ du -h --max-depth=<span class="number">1</span> work/testing</span><br><span class="line"></span><br><span class="line"><span class="number">27</span>M     work<span class="regexp">/testing/</span>logs</span><br><span class="line"><span class="number">35</span>M     work/testing</span><br><span class="line"></span><br><span class="line">$ du -h --max-depth=<span class="number">1</span> work<span class="regexp">/testing/</span>*</span><br><span class="line"></span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span><span class="keyword">func</span>.php</span><br><span class="line"><span class="number">27</span>M     work<span class="regexp">/testing/</span>logs</span><br><span class="line"><span class="number">8.1</span>M    work<span class="regexp">/testing/</span>nohup.out</span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span>testing_c.php</span><br><span class="line"><span class="number">12</span>K     work<span class="regexp">/testing/</span>testing_func_reg.php</span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span>testing_get.php</span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span>testing_g.php</span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span>var.php</span><br><span class="line"></span><br><span class="line">$ du -h --max-depth=<span class="number">1</span> work<span class="regexp">/testing/</span>logs/</span><br><span class="line"></span><br><span class="line"><span class="number">27</span>M     work<span class="regexp">/testing/</span>logs/</span><br><span class="line"></span><br><span class="line">$ du -h --max-depth=<span class="number">1</span> work<span class="regexp">/testing/</span>logs/*</span><br><span class="line"></span><br><span class="line"><span class="number">24</span>K     work<span class="regexp">/testing/</span>logs/errdate.log_show.log</span><br><span class="line"><span class="number">8.0</span>K    work<span class="regexp">/testing/</span>logs/pertime_show.log</span><br><span class="line"><span class="number">27</span>M     work<span class="regexp">/testing/</span>logs/show.log</span><br></pre></td></tr></table></figure>

<p>值得注意的是,看见一个针对du和df命令异同的文章:du df 差异导致文件系统误报解决.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">du</span> 统计文件大小相加</span><br><span class="line">df 统计数据块使用情况</span><br></pre></td></tr></table></figure>

<p>如果有一个进程在打开一个大文件的时候,这个大文件直接被rm 或者mv掉,则du会更新统计数值,df不会更新统计数值,还是认为空间没有释放.直到这个打开大文件的进程被Kill掉.<br>如此一来在定期删除 /var/spool/clientmqueue下面的文件时,如果没有杀掉其进程,那么空间一直没有释放.<br>使用下面的命令杀掉进程之后,系统恢复.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">fuser -u <span class="regexp">/var/</span>spool/clientmqueue</span><br></pre></td></tr></table></figure>

<p>查看linux文件目录的大小和文件夹包含的文件数.</p>
<p>统计总数大小:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">du -sh xmldb/</span><br><span class="line">du -sm * | sort -n <span class="regexp">//</span>统计当前目录大小 并安大小 排序</span><br><span class="line">du -sk * | sort -n</span><br><span class="line">du -sk * | grep guojf <span class="regexp">//</span>看一个人的大小</span><br><span class="line">du -m | cut -d <span class="string">&quot;/&quot;</span> -f <span class="number">2</span> <span class="regexp">//</span>看第二个/ 字符前的文字</span><br></pre></td></tr></table></figure>

<p>查看此文件夹有多少文件有多少文件:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">du xmldb/</span><br><span class="line">du xmldb <span class="string">|wc -l</span></span><br><span class="line"><span class="number">40752</span></span><br></pre></td></tr></table></figure>

<p>解释:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">wc [-lmw]</span><br><span class="line"><span class="comment">#参数说明:</span></span><br><span class="line">-l :多少行</span><br><span class="line"><span class="section">-m:多少字符</span></span><br><span class="line"><span class="section">-w:多少字</span></span><br><span class="line"><span class="comment">#Linux:ls以K、M、G为单位查看文件大小</span></span><br></pre></td></tr></table></figure>

<p>man的解释:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">man ls</span><br><span class="line">……</span><br><span class="line">-h, --human-readable</span><br><span class="line">print sizes in human readable format (e.g., 1K 234M 2G)</span><br><span class="line">……</span><br><span class="line">ls</span><br><span class="line">cuss.war    nohup.out</span><br><span class="line">ls -l</span><br><span class="line">total 30372</span><br><span class="line">-rw-r--r--   <span class="number"> 1 </span>root root<span class="number"> 31051909 </span>May<span class="number"> 24 </span>10:07 cuss.war</span><br><span class="line">-rw-------   <span class="number"> 1 </span>root root         <span class="number"> 0 </span>Mar<span class="number"> 20 </span>13:52 nohup.out</span><br><span class="line">ls -lh</span><br><span class="line">total 30M</span><br><span class="line">-rw-r--r--   <span class="number"> 1 </span>root root 30M May<span class="number"> 24 </span>10:07 cuss.war</span><br><span class="line">-rw-------   <span class="number"> 1 </span>root root    <span class="number"> 0 </span>Mar<span class="number"> 20 </span>13:52 nohup.out</span><br><span class="line">ll -h</span><br><span class="line">total 30M</span><br><span class="line">-rw-r--r--   <span class="number"> 1 </span>root root 30M May<span class="number"> 24 </span>10:07 cuss.war</span><br><span class="line">-rw-------   <span class="number"> 1 </span>root root    <span class="number"> 0 </span>Mar<span class="number"> 20 </span>13:52 nohup.out</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux下查看显卡的信息</title>
    <url>/2018/03/23/1243/</url>
    <content><![CDATA[<p>1、hwbrowser</p>
<p>2、dmidecode,从bios中读取信息.</p>
<p>3、lspci | grep VGA</p>
<p>4、glxinfo,如果是nvdia的话,可以试试.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下的arp检测软件 arpwatch(ARP watcher)</title>
    <url>/2012/02/16/1244/</url>
    <content><![CDATA[<p>功能说明:监听网络上ARP的记录.</p>
<p>语　　法:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">arpwatch <span class="selector-attr">[-d]</span><span class="selector-attr">[-f&lt;记录文件&gt;]</span><span class="selector-attr">[-i&lt;接口&gt;]</span><span class="selector-attr">[-r&lt;记录文件&gt;]</span></span><br></pre></td></tr></table></figure>

<p>补充说明:ARP(Address Resolution Protocol)是用来解析IP与网络装置硬件地址的协议.arpwatch可监听区域网络中的ARP数据包并记录,同时将监听到的变化通过E-mail来报告.</p>
<p>参　　数:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-d            启动排错模式.</span></span><br><span class="line"><span class="deletion">-f&lt;记录文件&gt;   设置存储ARP记录的文件,预设为/var/arpwatch/arp.dat.</span></span><br><span class="line"><span class="deletion">-i&lt;接口&gt;       指定监听ARP的接口,预设的接口为eth0.</span></span><br><span class="line"><span class="deletion">-r&lt;记录文件&gt;   从指定的文件中读取ARP记录,而不是从网络上监听.</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux下的zip加密压缩</title>
    <url>/2015/06/03/1245/</url>
    <content><![CDATA[<p>1、 文件、文件夹加密:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">zip</span> -e linuxzgf.<span class="built_in">zip</span> linuxzgf </span><br></pre></td></tr></table></figure>

<p>即可出现输入密码的提示,输入2次密码. 此文件即被加密解压时候是需要密码的.<br>文件夹加密:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">zip</span> -re linuxzgf.<span class="built_in">zip</span> linuxzgf</span><br></pre></td></tr></table></figure>

<p>即可出现输入密码的提示,输入2次密码. 此文件即被加密解压时候是需要密码的.</p>
<p>2、 文件、文件夹解密:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">unzip</span> linuxzgf.zip</span><br></pre></td></tr></table></figure>

<p>按提示输入密码即可.<br>密码输入错误会有如下提示:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">..... </span>incorrect password</span><br></pre></td></tr></table></figure>

<p>文件加密:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">[root@f5ha.com ~]# <span class="keyword">zip</span> -<span class="keyword">e</span> f5ha.<span class="keyword">zip</span> f5ha.<span class="keyword">log</span></span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">adding: f5ha.<span class="keyword">log</span> (deflated 74%)http:<span class="comment">//www.f5ha.com文件解密</span></span><br><span class="line">[root@f5ha.com ~]# unzip f5ha.<span class="keyword">zip</span></span><br><span class="line">Archive: f5ha.<span class="keyword">zip</span></span><br><span class="line">[f5ha.<span class="keyword">zip</span>] f5ha.<span class="keyword">log</span> password:</span><br><span class="line">inflating: f5ha.<span class="keyword">log</span></span><br></pre></td></tr></table></figure>

<p>文件夹加密解密如下:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@f5ha.<span class="keyword">com</span> ~]# zip -re f5ha.zip f5ha/</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">addin<span class="variable">g:</span> f5ha/ (stored <span class="number">0</span>%)</span><br><span class="line">addin<span class="variable">g:</span> f5ha/opera-browser.f5ha (deflated <span class="number">54</span>%)</span><br><span class="line">addin<span class="variable">g:</span> f5ha/<span class="keyword">new</span> <span class="keyword">file</span> (deflated <span class="number">25</span>%)</span><br><span class="line">addin<span class="variable">g:</span> f5ha/<span class="keyword">new</span> <span class="keyword">file</span>~ (stored <span class="number">0</span>%)</span><br><span class="line">addin<span class="variable">g:</span> f5ha/mozilla-firefox.f5ha (deflated <span class="number">33</span>%)</span><br></pre></td></tr></table></figure>

<p>解压:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@f5ha.<span class="keyword">com</span> ~]# unzip f5ha.zip</span><br><span class="line">Archive: f5ha.zip</span><br><span class="line">[f5ha.zip] f5ha/ password:</span><br><span class="line">creatin<span class="variable">g:</span> f5ha/</span><br><span class="line">inflatin<span class="variable">g:</span> f5ha/opera-browser.f5ha</span><br><span class="line">inflatin<span class="variable">g:</span> f5ha/<span class="keyword">new</span> <span class="keyword">file</span></span><br><span class="line">extractin<span class="variable">g:</span> f5ha/<span class="keyword">new</span> <span class="keyword">file</span>~</span><br><span class="line">inflatin<span class="variable">g:</span> f5ha/mozilla-firefox.f5ha</span><br></pre></td></tr></table></figure>

<p>输入密码错误解压如下:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@f5ha.com</span> <span class="string">~</span>]<span class="comment"># unzip f5ha.zip</span></span><br><span class="line"><span class="attr">Archive:</span> <span class="string">f5ha.zip</span></span><br><span class="line">[<span class="string">f5ha.zip</span>] <span class="attr">f5ha/ password:</span></span><br><span class="line"><span class="attr">skipping:</span> <span class="string">f5ha/</span>           <span class="string">incorrect</span> <span class="string">password</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux下的文件名编码转换工具</title>
    <url>/2018/08/17/1247/</url>
    <content><![CDATA[<p>今天介绍个文件名转码的工具convmv,convmv能帮助我们很容易地对一个文件,一个目录下所有文件进行编码转换,比如gbk转为utf8等.<br>语法:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">convmv</span> <span class="selector-attr">[options]</span> <span class="selector-tag">FILE</span>(S) ... <span class="selector-tag">DIRECTORY</span>(S)</span><br></pre></td></tr></table></figure>

<p>主要选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-f ENCODING 指定目前文件名的编码,如-f gbk</span></span><br><span class="line"><span class="deletion">-t ENCODING 指定将要转换成的编码,如-f utf-8</span></span><br><span class="line"><span class="deletion">-r 递归转换目录下所有文件名</span></span><br><span class="line"><span class="deletion">--list 列出所有支持的编码</span></span><br><span class="line"><span class="deletion">--notest 默认是只打印转换后的效果,加这个选项才真正执行转换操作. 更多选项请man convmv.</span></span><br></pre></td></tr></table></figure>

<p>例子: 递归转换centos目录下的目前文件名编码gbk为utf-8:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">convmv -f gbk -t utf-<span class="number">8</span> <span class="comment">--notest -r centos</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux下挂载windows的fat32分区的方法</title>
    <url>/2013/09/10/1249/</url>
    <content><![CDATA[<p>有些时候我们需要挂载windows的硬盘做一些操作,<br>所以就需要挂载fat32的分区.<br>挂载fat32分区的命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo mount -t vfat -o iocharset=utf8,umask=<span class="number">0</span> <span class="regexp">/dev/</span>sda1 <span class="regexp">/mnt/</span>c</span><br></pre></td></tr></table></figure>

<p>这样我们在 <code>/mnt/c</code>下就能看到fat32磁盘的内容了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下的建模软件Dia Diagram Editor</title>
    <url>/2010/11/11/1246/</url>
    <content><![CDATA[<p>站长用的是centos操作系统所以deb不能使用,rpm也一样不能使用,因为官网的rpm是针对opensuse的.<br>我们下载tar.bz2的包.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -jxvf ****<span class="regexp">*.tar.bz</span>2</span><br></pre></td></tr></table></figure>

<p>cd 到解压出来的目录.</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>

<p>其间遇到的错误大多也很好解决,不懂再问我吧.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下定时关机</title>
    <url>/2012/01/02/1248/</url>
    <content><![CDATA[<p>windows下的自动关机命令就不说了,这里说下linux的:</p>
<p>晚上11点自动关机:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> shutdown -h <span class="number">23</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<p>这样晚上11点电脑就自己关机了,适合挂机下载的时候用.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下强制踢掉登陆用户</title>
    <url>/2017/04/02/1250/</url>
    <content><![CDATA[<p>查看机器中登陆的用户.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@sunsyk ~]# <span class="keyword">w</span></span><br><span class="line"><span class="number">16</span>:<span class="number">29</span>:<span class="number">02</span> <span class="keyword">up</span> <span class="number">2</span> days, <span class="number">2</span>:<span class="number">35</span>, <span class="number">5</span> users, load average: <span class="number">0.03</span>, <span class="number">0.05</span>, <span class="number">0.01</span></span><br><span class="line">USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT</span><br><span class="line">root <span class="keyword">pts</span>/<span class="number">1</span> :<span class="number">0.0</span> Tue15 <span class="number">2</span>days <span class="number">1</span>:<span class="number">44</span> <span class="number">0.04</span>s -bash</span><br><span class="line">root <span class="keyword">pts</span>/<span class="number">2</span> :<span class="number">0.0</span> Tue15 <span class="number">46</span>:<span class="number">42</span><span class="keyword">m</span> <span class="number">0.05</span>s <span class="number">0.05</span>s bash</span><br><span class="line">root <span class="keyword">pts</span>/<span class="number">3</span> :<span class="number">0.0</span> Tue15 <span class="number">2</span>days <span class="number">0.02</span>s <span class="number">0.02</span>s bash</span><br><span class="line">root <span class="keyword">pts</span>/<span class="number">4</span> <span class="number">172.20</span>.<span class="number">52.114</span> <span class="number">14</span>:<span class="number">17</span> <span class="number">58</span>:<span class="number">48</span> <span class="number">0.16</span>s <span class="number">0.03</span>s sqlplus</span><br><span class="line">root <span class="keyword">pts</span>/<span class="number">5</span> <span class="number">172.20</span>.<span class="number">52.114</span> <span class="number">15</span>:<span class="number">31</span> <span class="number">0.00</span>s <span class="number">0.03</span>s <span class="number">0.00</span>s <span class="keyword">w</span></span><br></pre></td></tr></table></figure>

<p>我把pts/1踢掉(只有root才能去踢掉用户).</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@sunsyk</span> ~]<span class="meta"># pkill -kill -t pts/1</span></span><br><span class="line">[root<span class="symbol">@sunsyk</span> ~]<span class="meta"># pkill -kill -t pts/2</span></span><br><span class="line">[root<span class="symbol">@sunsyk</span> ~]<span class="meta"># pkill -kill -t pts/3</span></span><br></pre></td></tr></table></figure>

<p>查看是不是踢掉.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[root@sunsyk ~]<span class="comment"># w</span></span><br><span class="line"><span class="number">16</span>:<span class="number">34</span>:<span class="number">16</span> up <span class="number">2</span> days, <span class="number">2</span>:<span class="number">40</span>, <span class="number">2</span> users, load average: <span class="number">0.00</span>, <span class="number">0.05</span>, <span class="number">0.02</span></span><br><span class="line"><span class="keyword">USER</span> <span class="title">TTY</span> FROM LOGIN@ IDLE JCPU PCPU WHAT</span><br><span class="line">root pts/<span class="number">4</span> <span class="number">172.20</span>.<span class="number">52.114</span> <span class="number">14</span>:<span class="number">17</span> <span class="number">1</span>:<span class="number">04m</span> <span class="number">0.16s</span> <span class="number">0.03s</span> sqlplus</span><br><span class="line">root pts/<span class="number">5</span> <span class="number">172.20</span>.<span class="number">52.114</span> <span class="number">15</span>:<span class="number">31</span> <span class="number">0.00s</span> <span class="number">0.03s</span> <span class="number">0.00s</span> w</span><br></pre></td></tr></table></figure>

<p>root可以踢掉其他用户包括自己.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下清除所有.svn目录</title>
    <url>/2012/04/20/1251/</url>
    <content><![CDATA[<p>删除这些目录是很简单的,命令如下:</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> . -<span class="built_in">type</span> d -<span class="built_in">name</span> <span class="string">&quot;.svn&quot;</span>|xargs rm -rf</span><br></pre></td></tr></table></figure>
<p>或者:</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> . -<span class="built_in">type</span> d -iname <span class="string">&quot;.svn&quot;</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; ;</span><br></pre></td></tr></table></figure>
<p>全部搞定.</p>
]]></content>
  </entry>
  <entry>
    <title>linux下如何查看自己的外网IP</title>
    <url>/2013/03/22/1252/</url>
    <content><![CDATA[<p>由于局域网的服务器是通过ADSL路由器连接外网的,但ADSL是从ISP运营商那儿通过动态获得IP的,那么我怎么知道自己的外网地址是多少呢?<br>现在介绍两个方法:</p>
<p>1、直接在命令行敲如下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl -s http:<span class="regexp">//</span>whatismyip.org</span><br></pre></td></tr></table></figure>

<p>2、敲命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>whatismyip.org</span><br></pre></td></tr></table></figure>

<p>然后再敲命令:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> <span class="built_in">index</span>.html</span><br></pre></td></tr></table></figure>

<p>以上两种方法均通过实践验证,确实有效.</p>
]]></content>
  </entry>
  <entry>
    <title>Linux下怎样查看某一端口是否开放</title>
    <url>/2012/06/18/1254/</url>
    <content><![CDATA[<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">netstat</span> <span class="selector-tag">-nupl</span>  (UDP类型的端口)</span><br><span class="line"><span class="selector-tag">netstat</span> <span class="selector-tag">-ntpl</span>  (TCP类型的端口)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux下实现链路聚合</title>
    <url>/2016/05/11/1253/</url>
    <content><![CDATA[<p>CentOS 双网卡绑定实现负载均衡或容错.</p>
<p>在这介绍的Linux双网卡绑定实现就是使用两块网卡虚拟成为一块网卡,这个聚合起来的设备看起来是一个单独的以太网接口设备,通俗点讲就是两块网卡具有相同的IP地址而并行链接聚合成一个逻辑链路工作.其实这项技术在Sun和Cisco中早已存在,被称为Trunking和Etherchannel技术,在Linux的2.4.x的内核中也采用这这种技术,被称为bonding.bonding技术的最早应用是在集群——beowulf上,为了提高集群节点间的数据传输而设计的.下面我们讨论一下bonding 的原理,什么是bonding需要从网卡的混杂(promisc)模式说起.我们知道,在正常情况下,网卡只接收目的硬件地址(MAC Address)是自身Mac的以太网帧,对于别的数据帧都滤掉,以减轻驱动程序的负担.但是网卡也支持另外一种被称为混杂promisc的模式,可以接收网络上所有的帧,比如说tcpdump,就是运行在这个模式下.bonding也运行在这个模式下,而且修改了驱动程序中的mac地址,将两块网卡的Mac地址改成相同,可以接收特定mac的数据帧.然后把相应的数据帧传送给bond驱动程序处理.</p>
<p>其实在 linux 将双网卡绑定成一块网卡,配置起来非常简单,只需要简单几个步骤即可实现,下面我们就一起来体验一下吧.首先,还是将本次实验的环境做个简单的介绍:</p>
<p>操作系统:CentOS 5.5 x86.<br>绑定的前提条件:芯片组型号相同,而且网卡应该具备自己独立的BIOS芯片.</p>
<p>1.先修改eth0 和eht1这2个网卡配置文件.目录在(<code>/etc/sysconfig/network-scripts/</code>)如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">MASTER</span>=bond0 <span class="comment">#也可没有该项</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br></pre></td></tr></table></figure>

<p>2.eth1也是同样的修改.如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth1</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">MASTER</span>=bond0 <span class="comment">#也可没有该项</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br></pre></td></tr></table></figure>

<p>3.新建一个虚拟网卡bond0,创建bond0的配置文件ifcfg-bond0.如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=bond0</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">0.223</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">BROADCAST</span>=<span class="number">192.168</span>.<span class="number">0.255</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br></pre></td></tr></table></figure>

<p>注意:编辑的时候在配置文件中把MAC地址去掉,否则会出现mac冲突.</p>
<p>4.修改 <code>/etc/modprobe.conf</code>添加内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">alias</span> bond<span class="number">0</span> bonding</span><br><span class="line"><span class="attribute"><span class="nomarkup">options</span></span> bond<span class="number">0</span> miimon=<span class="number">100</span> mode=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>说明:miimon是用来进行链路监测的. 比如:miimon=100,那么系统每100ms监测一次链路连接状态,如果有一条线路不通就转入另一条线路;mode的值表示工作模式,他共有0,1,2,3四种模式,常用的为0,1两种.<br>mode=0表示load balancing (round-robin)为负载均衡方式,两块网卡都工作.<br>mode=1表示fault-tolerance (active-backup)提供冗余功能,工作方式是主备的工作方式,也就是说默认情况下只有一块网卡工作,另一块做备份.<br>bonding只能提供链路监测,即从主机到交换机的链路是否接通.如果只是交换机对外的链路down掉了,而交换机本身并没有故障,那么bonding会认为链路没有问题而继续使用.</p>
<p>MODE=0测试结论:<br>如果交换机未配置链路聚合则会发生MAC动荡的情况,在配置了链路聚合后不会出现,SRV发出数据包的MAC为Bond0的MAC.</p>
<p><em>MODE=6</em>测试结论:(这个mode=6不了解)<br>此时交换机无需特殊配置,即可实现负载均衡.2个网卡发出的包使用的是各自的MAC,因此也不会造成交换机MAC地址表的动荡.</p>
<p>5.修改 <code>/etc/rc.d/rc.local</code>添加内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifenslave</span> bond<span class="number">0</span> eth<span class="number">0</span> eth<span class="number">1</span></span><br><span class="line"><span class="attribute">route</span> add -net <span class="number">192.168.0.255</span> netmask <span class="number">255.255.255.0</span> bond<span class="number">0</span> 或者</span><br><span class="line"><span class="attribute">route</span> add default gw <span class="number">192.168.0.255</span> –interface bond<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>OK 完成.<br>重启(开始重启network服务没出想要得到的效果,最后选择重启的系统),验证:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">bond0</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">inet</span> addr:<span class="number">202.206.197.171</span> Bcast:<span class="number">202.206.197.191</span> Mask:<span class="number">255.255.255.224</span></span><br><span class="line"><span class="attribute">inet6</span> addr: fe<span class="number">80</span>::<span class="number">250</span>:<span class="number">56</span>ff:fe<span class="number">90</span>:<span class="number">38</span>/<span class="number">64</span> Scope:Link</span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING MASTER MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">688</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">397</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">54107</span> (<span class="number">52</span>.<span class="number">8</span> KiB) TX bytes:<span class="number">31854</span> (<span class="number">31</span>.<span class="number">1</span> KiB)</span><br><span class="line"></span><br><span class="line"><span class="attribute">eth0</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING SLAVE MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">345</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">200</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">27202</span> (<span class="number">26</span>.<span class="number">5</span> KiB) TX bytes:<span class="number">15284</span> (<span class="number">14</span>.<span class="number">9</span> KiB)</span><br><span class="line"><span class="attribute">Interrupt</span>:<span class="number">59</span> Base address:<span class="number">0</span>x<span class="number">2024</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">eth1</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING SLAVE MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">343</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">199</span>errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">26905</span> (<span class="number">26</span>.<span class="number">2</span> KiB) TX bytes:<span class="number">16910</span> (<span class="number">16</span>.<span class="number">5</span> KiB)</span><br><span class="line"><span class="attribute">Interrupt</span>:<span class="number">67</span> Base address:<span class="number">0</span>x<span class="number">20</span>a<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>可以down掉其中的一个网卡,链路依然是通的.</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">ifconfig eth* <span class="meta">down</span></span><br><span class="line">ifconfig eth* <span class="meta">up</span></span><br></pre></td></tr></table></figure>

<p>当都down掉的时候就不通了.<br>通过网卡邦定技术既增加了服务器的可靠性,又增加了可用网络带宽,为用户提供不间断的关键服务.</p>
]]></content>
  </entry>
  <entry>
    <title>linux修改ip和dns的方法</title>
    <url>/2013/07/09/1256/</url>
    <content><![CDATA[<p>specify IP by self:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth0</span><br></pre></td></tr></table></figure>

<p>fix like below:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Xen Virtual Ethernet</span></span><br><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="comment">#BOOTPROTO=dhcp</span></span><br><span class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>E:<span class="number">06</span>:<span class="number">22</span>:<span class="number">34</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">75.20</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">75.254</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br></pre></td></tr></table></figure>

<p>specify SVN IP by self:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-vpn_vpnchina</span><br></pre></td></tr></table></figure>

<p>fix like below:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Broadcom Corporation NetXtreme BCM5721 Gigabit Ethernet PCI Express</span></span><br><span class="line"><span class="attr">DEVICE</span>=vpn_vpnchina</span><br><span class="line"><span class="attr">BOOTPROTO</span>=<span class="string">&#x27;none&#x27;</span></span><br><span class="line"><span class="attr">BROADCAST</span>=<span class="string">&#x27;192.168.6.255&#x27;</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="string">&#x27;192.168.6.45&#x27;</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="string">&#x27;255.255.255.0&#x27;</span></span><br><span class="line"><span class="attr">NETWORK</span>=<span class="string">&#x27;192.168.6.0&#x27;</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line"><span class="attr">TYPE</span>=<span class="string">&#x27;Ethernet&#x27;</span></span><br><span class="line"><span class="attr">USERCTL</span>=<span class="string">&#x27;no&#x27;</span></span><br><span class="line"><span class="attr">STARTMODE</span>=<span class="string">&#x27;auto&#x27;</span></span><br></pre></td></tr></table></figure>

<p>配置文件位于:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"></span><br><span class="line"><span class="attribute">DEVICE</span>=eth0</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">IPADDR</span>=192.168.0.3</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.255.0</span><br><span class="line"><span class="attribute">GATEWAY</span>=192.168.0.1</span><br></pre></td></tr></table></figure>

<p>使IP地址生效:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/sbin/i</span>fdown eth0</span><br><span class="line"><span class="regexp">/sbin/i</span>fup eth0</span><br></pre></td></tr></table></figure>

<p>通知网关更新信息:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/network restart</span><br></pre></td></tr></table></figure>

<p>OpenSuse的配置:</p>
<p>修改/etc/sysconfig/network/config文件:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">NETWORKMANAGER</span>=<span class="string">&quot;yes&quot;</span> 通过 networkmanage 的用户方法设置</span><br><span class="line"><span class="attr">NETWORKMANAGER</span>=<span class="string">&quot;no&quot;</span>? 通过 ipfu传统的方法设置(选择这个)</span><br></pre></td></tr></table></figure>

<p>修改 <code>/etc/sysconfig/network/ifcfg-eth0</code>,详细设置请看ifcfg.template:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">BOOTPROTO</span>=<span class="string">&#x27;static&#x27;</span></span><br><span class="line"><span class="attr">BROADCAST</span>=<span class="string">&#x27;192.168.75.255&#x27;</span></span><br><span class="line"><span class="attr">ETHTOOL_OPTIONS</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="string">&#x27;192.168.75.100&#x27;</span></span><br><span class="line"><span class="attr">NAME</span>=<span class="string">&#x27;82562EZ 10/100 Ethernet Controller&#x27;</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="string">&#x27;255.255.255.0&#x27;</span></span><br><span class="line"><span class="attr">NETWORK</span>=<span class="string">&#x27;192.168.75.0&#x27;</span></span><br><span class="line"><span class="attr">STARTMODE</span>=<span class="string">&#x27;onboot&#x27;</span></span><br><span class="line"><span class="attr">USERCONTROL</span>=<span class="string">&#x27;no&#x27;</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line"><span class="attr">PREFIXLEN</span>=<span class="string">&#x27;24&#x27;</span></span><br><span class="line"><span class="attr">LLADDR</span>=<span class="string">&#x27;00:11:43:A9:E6:D7&#x27;</span>? (mac地址)</span><br></pre></td></tr></table></figure>

<p>3.<code>/etc/sysconfig/network/routes</code>网关设置:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">default</span> <span class="number">192.168.75.254</span></span><br></pre></td></tr></table></figure>

<p>4.<code>/etc/resolv.conf</code> DNS设置:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nameserver</span> <span class="number">202.101.224.69</span></span><br></pre></td></tr></table></figure>

<p>5.重启network服务:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/network restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linux修改IP地址及激活网卡</title>
    <url>/2015/08/16/1255/</url>
    <content><![CDATA[<p>A、修改ip地址即时生效:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span> eth<span class="number">0</span> <span class="number">192.168.0.20</span> netmask <span class="number">255.255.255.0</span></span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<p>修改 <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code></p>
<p>B、修改default gateway:</p>
<p>即时生效:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">route <span class="builtin-name">add</span><span class="built_in"> default </span>gw 192.168.0.254</span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<p>修改 <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code></p>
<p>C、修改dns:</p>
<p>修改 <code>/etc/resolv.conf</code></p>
<p>修改后可即时生效,启动同样有效.</p>
<p>D、修改host name:</p>
<p>即时生效:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hostname</span> fc<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<p>修改 <code>/etc/sysconfig/network</code></p>
<p>修改完后需要重启网络服务才能生效:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service network restart</span></span><br></pre></td></tr></table></figure>

<p>如果以上命令无效,可以用下面的命令激活网卡:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">ifup eth0?<span class="string">??</span><span class="string">??</span><span class="comment">#激活网卡</span></span><br><span class="line">ifdown eth0?? <span class="comment">#取消激活网卡</span></span><br></pre></td></tr></table></figure>

<p>或者:</p>
<p>在gnome界面,按 系统–管理–网络 打开网络配置 选择设备激活.<br>注意,用ifconfig命令配置的网络设备参数,机器重新启动以后将会丢失.所以最好是采用修改配置文件(即启动生效)的方式对IP地址、网关、路由、主机名等进行修改.</p>
]]></content>
  </entry>
  <entry>
    <title>Linux中netstat命令的用法详解</title>
    <url>/2018/05/01/1258/</url>
    <content><![CDATA[<p>功能:Netstat用于显示与IP、TCP、UDP和ICMP协议相关的统计数据,一般用于检验本机各端口的网络连接情况.</p>
<p>语法:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">netstat <span class="selector-attr">[-acCeFghilMnNoprstuvVwx]</span><span class="selector-attr">[-A&lt;网络类型&gt;]</span><span class="selector-attr">[--ip]</span></span><br></pre></td></tr></table></figure>

<p>补充说明:利用netstat指令可让你得知整个Linux系统的网络情况.</p>
<p>参数:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">-a或–all 显示所有连线中的<span class="symbol">Socket</span>.</span><br><span class="line">-<span class="symbol">A</span>&lt;网络类型&gt;或–&lt;网络类型&gt; 列出该网络类型连线中的相关地址.</span><br><span class="line">-c或–continuous 持续列出网络状态.</span><br><span class="line">-<span class="symbol">C</span>或–cache 显示路由器配置的快取信息.</span><br><span class="line">-e或–extend 显示网络其他相关信息.</span><br><span class="line">-<span class="symbol">F</span>或–fib 显示<span class="symbol">FIB</span>.</span><br><span class="line">-g或–groups 显示多重广播功能群组组员名单.</span><br><span class="line">-h或–help 在线帮助.</span><br><span class="line">-i或–interfaces 显示网络界面信息表单.</span><br><span class="line">-l或–listening 显示监控中的服务器的<span class="symbol">Socket</span>.</span><br><span class="line">-<span class="symbol">M</span>或–masquerade 显示伪装的网络连线.</span><br><span class="line">-n或–numeric 直接使用<span class="symbol">IP</span>地址,而不通过域名服务器.</span><br><span class="line">-<span class="symbol">N</span>或–netlink或–symbolic 显示网络硬件外围设备的符号连接名称.</span><br><span class="line">-o或–timers 显示计时器.</span><br><span class="line">-p或–programs 显示正在使用<span class="symbol">Socket</span>的程序识别码和程序名称.</span><br><span class="line">-r或–route 显示<span class="symbol">Routing</span> <span class="symbol">Table</span>.</span><br><span class="line">-s或–statistice 显示网络工作信息统计表.</span><br><span class="line">-t或–tcp 显示<span class="symbol">TCP</span>传输协议的连线状况.</span><br><span class="line">-u或–udp 显示<span class="symbol">UDP</span>传输协议的连线状况.</span><br><span class="line">-v或–verbose 显示指令执行过程.</span><br><span class="line">-<span class="symbol">V</span>或–version 显示版本信息.</span><br><span class="line">-w或–raw 显示<span class="symbol">RAW</span>传输协议的连线状况.</span><br><span class="line">-x或–unix 此参数的效果和指定<span class="string">&quot;-A unix&quot;</span>参数相同.</span><br><span class="line">–ip或–inet 此参数的效果和指定<span class="string">&quot;-A inet&quot;</span>参数相同</span><br></pre></td></tr></table></figure>

<p>netstat 的一些常用选项:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">·netstat –s</span><br><span class="line"><span class="meta">#本选项能够按照各个协议分别显示其统计数据.如果我们的应用程序(如Web浏览器)运行速度比较慢,或者不能显示Web页之类的数据,那么我们就可以用本选项来查看一下所显示的信息.我们需要仔细查看统计数据的各行,找到出错的关键字,进而确定问题所在.</span></span><br><span class="line">·netstat –e</span><br><span class="line"><span class="meta">#本选项用于显示关于以太网的统计数据.它列出的项目包括传送的数据报的总字节数、错误数、删除数、数据报的数量和广播的数量.这些统计数据既有发送的数据报数量,也有接收的数据报数量.这个选项可以用来统计一些基本的网络流量).</span></span><br><span class="line">·netstat –r</span><br><span class="line"><span class="meta">#本选项可以显示关于路由表的信息,类似于后面所讲使用route print命令时看到的 信息.除了显示有效路由外,还显示当前有效的连接.</span></span><br><span class="line">·netstat –a</span><br><span class="line"><span class="meta">#本选项显示一个所有的有效连接信息列表,包括已建立的连接(ESTABLISHED),也包括监听连接请(LISTENING)的那些连接.</span></span><br><span class="line">·netstat –n</span><br><span class="line"><span class="meta">#显示所有已建立的有效连接.</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>linux转发root邮件到其他邮箱</title>
    <url>/2017/12/08/1260/</url>
    <content><![CDATA[<p>把给root 用户的系统邮件转发的管理员的gmail 邮箱<br>虽然可以登陆到系统去看系统邮件,但显然能用gmail 查看是更方便的选择.</p>
<p>1.安装sendmail 邮件转发要用到sendmail.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install sendmail</span><br><span class="line"><span class="regexp">/etc/i</span>ntit.d/sendmail start (sendmail服务)</span><br></pre></td></tr></table></figure>

<p>2.设置转发,编辑 <code>/etc/aliases</code>,在文件最后加入:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">roo<span class="variable">t:</span> youname@gmail.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>

<p>然后运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">newaliases</span></span><br></pre></td></tr></table></figure>

<p>更新aliases.<br>这样系统就会把给root 的邮件转发的你gmail 邮箱里去了.</p>
]]></content>
  </entry>
  <entry>
    <title>linux中挂载新颖盘</title>
    <url>/2017/08/23/1259/</url>
    <content><![CDATA[<p>首先,切换到root用户:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su root</span></span><br></pre></td></tr></table></figure>

<p>需要你输入密码.<br>然后:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fdisk -l</span></span><br></pre></td></tr></table></figure>

<p>查看系统挂载的设备列表.硬盘标签一般会出现在最后一个,看看它所列出的大小是否正确,并记住它的标签.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/dev/</span>sdb1</span><br></pre></td></tr></table></figure>

<p>最后,把这个标签挂载到你想要的目录下,这个目录你可以自己mkdir,我习惯挂载到/media下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mount  <span class="regexp">/dev/</span>sdb1  /media</span><br></pre></td></tr></table></figure>

<p>注意,此时仍是在超级用户root下,为防止误操作,挂载完成后,要记得返回普通用户下.</p>
]]></content>
  </entry>
  <entry>
    <title>lvs keepalived实现高可用负载均衡</title>
    <url>/2016/02/05/1261/</url>
    <content><![CDATA[<p>今天要做的是通过LVS和keepalived实现的高可用的负载均衡,<br>通过LVS实现负载均衡能达到F5硬件负载均衡效果的60%,其他的负载均衡则无法达到10%.<br>而keepalived前面也讲过,是实现高可用的程序,可以在一台服务器崩溃后,另一台可以及时接管并继续提供服务.<br>保证服务器不会宕机.<br>好下面就开始配置:</p>
<p>系统环境:CentOS 5.5(定制安装)<br>组件:</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Base</span></span><br><span class="line">Development Libraries</span><br><span class="line">Development Tools</span><br><span class="line">Editors</span><br><span class="line"><span class="built_in">Text</span>-based Internet</span><br></pre></td></tr></table></figure>

<p>服务器及网络参数:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lvs</span>-master:<span class="number">192.168.9.201</span></span><br><span class="line"><span class="attribute">lvs</span>-backup:<span class="number">192.168.9.202</span></span><br><span class="line"><span class="attribute">vip</span>:<span class="number">192.168.9.200</span></span><br><span class="line"><span class="attribute">web1</span>:<span class="number">192.168.9.203</span></span><br><span class="line"><span class="attribute">web2</span>:<span class="number">192.168.9.204</span></span><br><span class="line"><span class="attribute">netmask</span>:<span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">gateway</span>:<span class="number">192.168.9.1</span></span><br></pre></td></tr></table></figure>

<p>========================= 安装ipvsadm、keepalived ==================</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> /usr/local/src</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# wget</span> http://www.linuxvirtualserver.org/software/kernel-<span class="number">2.6</span>/ipvsadm-<span class="number">1.24</span>.tar.gz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# wget</span> http://www.keepalived.org/software/keepalived-<span class="number">1.1</span>.<span class="number">17</span>.tar.gz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ln</span> -sv /usr/src/kernels/<span class="number">2.6</span>.<span class="number">18</span>-<span class="number">194</span>.el5-i686/ /usr/src/linux</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# tar</span> -zxvf ipvsadm-<span class="number">1.24</span>.tar.gz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> ipvsadm-<span class="number">1.24</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# make</span>;make install</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> ..</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# tar</span> -zxvf keepalived-<span class="number">1.1</span>.<span class="number">17</span>.tar.gz</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cd</span> keepalived-<span class="number">1.1</span>.<span class="number">17</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ./configure</span></span><br></pre></td></tr></table></figure>

<p>出现编译错误:</p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">!!! OpenSSL is not properly installed on your system. !!!</span><br><span class="line">!!! Can not include OpenSSL headers files.</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# yum</span> -y install openssl-devel</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# ./configure</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# make</span>;make install</span><br></pre></td></tr></table></figure>

<p>编译的时候出现这个提示,说明keepalived和内核结合了,如果不是这样的,需要加上这个参数</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">./configure <span class="comment">--with-kernel-dir=/kernel/path</span></span><br><span class="line">Keepalived configuration</span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line">Keepalived version : 1.1.17</span><br><span class="line">Compiler : <span class="type">gcc</span></span><br><span class="line">Compiler flags : -<span class="type">g</span> -O2</span><br><span class="line">Extra Lib : -<span class="type">lpopt</span> -lssl -lcrypto</span><br><span class="line"><span class="keyword">Use</span> IPVS Framework : <span class="type">Yes</span></span><br><span class="line">IPVS sync daemon support : <span class="type">Yes</span></span><br><span class="line"><span class="keyword">Use</span> VRRP Framework : <span class="type">Yes</span></span><br><span class="line"><span class="keyword">Use</span> LinkWatch : <span class="type">No</span></span><br><span class="line"><span class="keyword">Use</span> Debug flags : <span class="type">No</span></span><br></pre></td></tr></table></figure>

<p>======================= 配置keepalived ===========================</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@master ~]# cp <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>keepalived <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span></span><br><span class="line">[root@master ~]# cp <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>sysconfig<span class="regexp">/keepalived /</span>etc<span class="regexp">/sysconfig/</span></span><br><span class="line">[root@master ~]# mkdir <span class="regexp">/etc/</span>keepalived</span><br><span class="line">[root@master ~]# cp <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>keepalived <span class="regexp">/usr/</span>sbin/</span><br><span class="line">[root@master ~]# vi <span class="regexp">/etc/</span>keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>

<p>keepalived配置文件内容:</p>
<figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">        king_819@163.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from king_819@163.com</span><br><span class="line">    smtp_server smtp.163.com</span><br><span class="line">    # smtp_connect_timeout 30</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># VIP1</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER #备份服务器上将MASTER改为BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    lvs_sync_daemon_inteface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100 # 备份服务上将100改为90</span><br><span class="line">    advert_int 5</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.9.200</span><br><span class="line">        <span class="function"><span class="keyword">#</span><span class="params">(如果有多个<span class="variable">VIP</span>,继续换行填写.)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 192.168.9.200 80 &#123;</span><br><span class="line">    delay_loop 6 <span class="function"><span class="keyword">#</span><span class="params">(每隔10秒查询<span class="variable">realserver</span>状态)</span></span></span><br><span class="line">    lb_algo wlc <span class="function"><span class="keyword">#</span><span class="params">(<span class="variable">lvs</span> 算法)</span></span></span><br><span class="line">    lb_kind DR <span class="function"><span class="keyword">#</span><span class="params">(<span class="variable">Direct</span> <span class="variable">Route</span>)</span></span></span><br><span class="line">    persistence_timeout 60 <span class="function"><span class="keyword">#</span><span class="params">(同一<span class="variable">IP</span>的连接60秒内被分配到同一台<span class="variable">realserver</span>)</span></span></span><br><span class="line">    protocol TCP <span class="function"><span class="keyword">#</span><span class="params">(用<span class="variable">TCP</span>协议检查<span class="variable">realserver</span>状态)</span></span></span><br><span class="line"></span><br><span class="line">    real_server 192.168.9.203 80 &#123;</span><br><span class="line">        weight 100 <span class="function"><span class="keyword">#</span><span class="params">(权重)</span></span></span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10 <span class="function"><span class="keyword">#</span><span class="params">(10秒无响应超时)</span></span></span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 192.168.9.204 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master ~]# service keepalived start|stop</span><br><span class="line">[root@master ~]# chkconfig –level 2345 keepalived on</span><br></pre></td></tr></table></figure>

<p>====================== 配置realserver =========================</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@web_1 ~]<span class="comment"># vi /root/lvs_real.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># description: Config realserver</span></span><br><span class="line"><span class="comment">#Written by : http://kerry.blog.51cto.com</span></span><br><span class="line"></span><br><span class="line">SNS_VIP=<span class="number">192.168</span>.<span class="number">9.200</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>functions</span><br><span class="line"></span><br><span class="line">case <span class="string">&quot;$1&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line"><span class="regexp">/sbin/i</span>fconfig lo:<span class="number">0</span> <span class="variable">$SNS_VIP</span> netmask <span class="number">255.255</span>.<span class="number">255.255</span> broadcast <span class="variable">$SNS_VIP</span></span><br><span class="line"><span class="regexp">/sbin/</span>route add -host <span class="variable">$SNS_VIP</span> dev lo:<span class="number">0</span></span><br><span class="line">echo <span class="string">&quot;1&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_ignore</span><br><span class="line">echo <span class="string">&quot;2&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_announce</span><br><span class="line">echo <span class="string">&quot;1&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_ignore</span><br><span class="line">echo <span class="string">&quot;2&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_announce</span><br><span class="line">sysctl -p &gt;<span class="regexp">/dev/</span>null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">echo <span class="string">&quot;RealServer Start OK&quot;</span></span><br><span class="line"></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"><span class="regexp">/sbin/i</span>fconfig lo:<span class="number">0</span> down</span><br><span class="line"><span class="regexp">/sbin/</span>route del <span class="variable">$SNS_VIP</span> &gt;<span class="regexp">/dev/</span>null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_ignore</span><br><span class="line">echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>lo/arp_announce</span><br><span class="line">echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_ignore</span><br><span class="line">echo <span class="string">&quot;0&quot;</span> &gt;<span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/conf/</span>all/arp_announce</span><br><span class="line">echo <span class="string">&quot;RealServer Stoped&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo <span class="string">&quot;Usage: $0 &#123;start|stop&#125;&quot;</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[root@web_1 ~]<span class="comment"># chmod +x /roo/lvs_real.sh</span></span><br><span class="line">[root@web_1 ~]<span class="comment"># /root/lvs_real.sh start</span></span><br><span class="line">[root@web_1 ~]<span class="comment"># ifconfig</span></span><br><span class="line">lo:<span class="number">0</span> Link encap:Local Loopback</span><br><span class="line">inet addr:<span class="number">192.168</span>.<span class="number">0.10</span> Mask:<span class="number">255.255</span>.<span class="number">255.255</span></span><br><span class="line">UP LOOPBACK RUNNING MTU:<span class="number">16436</span> Metric:<span class="number">1</span></span><br><span class="line">[root@web_1 ~]<span class="comment"># echo &quot;/root/lvs_real.sh start&quot; &gt;&gt; /etc/rc.local</span></span><br></pre></td></tr></table></figure>

<p>===================== 测试LVS+keepalived ========================<br>#LVS_master、LVS_backup上开启keepalived,LVS_master先绑定VIP<br>在LVS_master执行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ip</span> a</span><br><span class="line"><span class="attribute">1</span>: lo: mtu <span class="number">16436</span> qdisc noqueue</span><br><span class="line"><span class="attribute">link</span>/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="attribute">inet</span> <span class="number">127.0.0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line"><span class="attribute">inet6</span> ::<span class="number">1</span>/<span class="number">128</span> scope host</span><br><span class="line"><span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line"><span class="attribute">link</span>/ether <span class="number">08</span>:<span class="number">00</span>:<span class="number">27</span>:<span class="number">8</span>e:<span class="number">14</span>:<span class="number">62</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.0.254</span>/<span class="number">24</span> brd <span class="number">192.168.0.255</span> scope global eth<span class="number">0</span></span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.0.10</span>/<span class="number">32</span> scope global eth<span class="number">0</span></span><br><span class="line"><span class="attribute">inet6</span> fe<span class="number">80</span>::a<span class="number">00</span>:<span class="number">27</span>ff:fe<span class="number">8</span>e:<span class="number">1462</span>/<span class="number">64</span> scope link</span><br><span class="line"><span class="attribute">valid_lft</span> forever preferred_lft forever</span><br><span class="line"><span class="attribute">3</span>: sit<span class="number">0</span>: mtu <span class="number">1480</span> qdisc noop</span><br><span class="line"><span class="attribute">link</span>/sit <span class="number">0.0.0.0</span> brd <span class="number">0.0.0.0</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到已经成功绑定了虚拟IP了.<br>在LVS_backup下则没有哪条加粗的虚拟ip地址.<br>在LVS_master执行ipvsadm,可以看到后端web服务器的负载情况.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">IP Virtual Server version <span class="number">1.2</span>.<span class="number">1</span> (size=<span class="number">4096</span>)</span><br><span class="line">Prot <span class="symbol">LocalAddress:</span>Port Scheduler Flags</span><br><span class="line">-&gt; <span class="symbol">RemoteAddress:</span>Port Forward Weight ActiveConn InActConn</span><br><span class="line">TCP <span class="number">192.168</span>.0.<span class="number">10</span><span class="symbol">:http</span> wlc persistent <span class="number">60</span></span><br><span class="line">-&gt; <span class="number">192.168</span>.0.<span class="number">14</span><span class="symbol">:http</span> Route <span class="number">100</span> 0 0</span><br><span class="line">-&gt; <span class="number">192.168</span>.0.<span class="number">11</span><span class="symbol">:http</span> Route <span class="number">100</span> 0 0</span><br></pre></td></tr></table></figure>

<p>现在我们就可以来测试一下了,首先我们访问虚拟IP,如果可以访问切多次刷新都没有问题的话,可以关闭一台LVS_master服务器,LVS_backup会很快接管工作.<br>我们如果停掉一台web服务器,则LVS服务器会将问题服务器剔除列表,执行ipvsadm会看到只剩一台web服务器.<br>但是虚拟ip的访问不受任何影响.这样一个高可用的负载均衡集群就搭建完成了.</p>
]]></content>
  </entry>
  <entry>
    <title>MFS挂载回收站报错</title>
    <url>/2011/04/28/1262/</url>
    <content><![CDATA[<p>出现报错:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mfsmount -m <span class="regexp">/mnt/m</span>fsmeta -H mfsmaster</span><br><span class="line">mfsmaster register error: Permission denied</span><br></pre></td></tr></table></figure>

<p>经查询得知masterserver上的mfsexports.cfg 设置里关闭了权限.<br>meta 的目录名称为 “.”,且不在 / 下面.设置好后重启 mfsmaster 后方可挂载.<br>如:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.2.110</span> . rw</span><br></pre></td></tr></table></figure>

<p>重启master server 即可挂载成功.</p>
]]></content>
  </entry>
  <entry>
    <title>linux中Diff命令详解</title>
    <url>/2016/07/17/1257/</url>
    <content><![CDATA[<p>1&gt;Diff命令的功能</p>
<p>Linux中Diff命令的功能为逐行比较两个文本文件,列出其不同之处.它对给出的文件进行系统的检查,并显示出两个文件中所有不同的行,不要求事先对文件进行排序.</p>
<p>2&gt;语法</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">diff <span class="selector-attr">[options]</span> file1 file2</span><br></pre></td></tr></table></figure>

<p>该命令告诉用户,为了使两个文件file1和file2一致,需要修改它们的哪些行.如果用”-“表示file1或file2,则表示标准输入.如果file1或file2是目录,那么diff将使用该目录中的同名文件进行比较.</p>
<p>3&gt;[options]主要参数</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby"><span class="symbol">a:</span>将所有文件当作文本文件来处理.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">b或–ignore-space-change 忽略空格造成的不同.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">B或–ignore-blank-lines 忽略空行造成的不同.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"><span class="symbol">c:</span>使用纲要输出格式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"><span class="symbol">H:</span>利用试探法加速对大文件的搜索.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"><span class="symbol">I:</span>忽略大小写的变化.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">n –<span class="symbol">rcs:</span>输出RCS格式.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">N或–new-file 在比较目录时,若文件A仅出现在某个目录中,会显示<span class="symbol">:Only</span> <span class="keyword">in</span>目录;文件A若使用-N参数,则diff会将文件A与一个空白的文件比较.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">r或–recursive 比较子目录中的文件.</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">u,-U&lt;列数&gt;或–unified=&lt;列数&gt; 以合并的方式来显示文件内容的不同.</span></span><br></pre></td></tr></table></figure>

<p>4&gt;使用方法的实例说明</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">diff <span class="regexp">/usr/</span>xu mine</span><br></pre></td></tr></table></figure>

<p>把目录/usr/xu 中名为mine的文件与当前目录中的mine文件进行比较.<br>通常输出由下述形式的行组成:</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="symbol">n1</span> a <span class="symbol">n3</span>,<span class="symbol">n4</span></span><br><span class="line"><span class="symbol">n1</span>,<span class="symbol">n2</span> d <span class="symbol">n3</span></span><br><span class="line"><span class="symbol">n1</span>,<span class="symbol">n2</span> c <span class="symbol">n3</span>,<span class="symbol">n4</span> </span><br></pre></td></tr></table></figure>

<p>这些行类似ed命令把filel转换成file2.字母(a、d和c)之前的行号(n1,n2)是针对file1的,其后面的行号(n3,n4)是针对file2的.字母a、d和c分别表示附加、删除和修改操作.<br>在上述形式的每一行的后面跟随受到影响的若干行,以”&lt;”打头的行属于第一个文件,以”&gt;”打头的行属于第二个文件.<br>diff能区别块和字符设备文件以及FIFO(管道文件),不会把它们与普通文件进行比较.<br>如果file1和file2都是目录,则diff会产生很多信息.</p>
<p>5&gt;diff最常用的功能</p>
<p>diff有很多功能平时我们不常用到,最常用的功能莫过于生成patch文件了:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">diff -urN old<span class="regexp">/ new/</span> &gt; mysoft.patch</span><br></pre></td></tr></table></figure>

<p>参数 -u 表示使用 unified 格式,-r 表示比较目录,-N 表示将不存在的文件当作空文件处理,这样新添加的文件也会出现在patch文件中.<br>然后在需要应用patch的地方使用下述命令即可:</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">patch</span> -p0 &lt; mysoft.<span class="keyword">patch</span></span><br></pre></td></tr></table></figure>

<p>diff的 -y 命令(长格式为 –side-by-side)可以将屏幕分成左右两部分,来比较两个文件之间的差异.许多图形化的比较工具都有这个功能,但如果只能使用命令行,这个参数就相当有用了.如果要改变左右各部分的宽度,可以通过 -W (–width)参数来指定.<br>–ignore-blank-lines 参数可以不检查空白行.这样DOS格式和Unix格式的文件互相比较时,就不至于因为换行符不一致而出现大量的差异.</p>
]]></content>
  </entry>
  <entry>
    <title>monit常用监控</title>
    <url>/2011/09/30/1266/</url>
    <content><![CDATA[<p>a.监控nginx</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">vi /etc/monit.d/nginx.monit<span class="built_in"></span></span><br><span class="line"><span class="built_in">check </span>process nginx with pidfile /usr/local/nginx/nginx.pid</span><br><span class="line">start program = <span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span></span><br><span class="line">stop program = <span class="string">&quot;/usr/local/nginx/sbin/nginx -s stop&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>failed host 192.168.1.11 port 8011 protocol http then restart</span><br></pre></td></tr></table></figure>

<p>b.监控memcached</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">vi /etc/monit.d/memcached.monit<span class="built_in"></span></span><br><span class="line"><span class="built_in">check </span>process memcached with pidfile /tmp/linuxjcq_memcached.pid</span><br><span class="line">start program = <span class="string">&quot;/etc/rc.d/init.d/memcached start&quot;</span></span><br><span class="line">stop program = <span class="string">&quot;/etc/rc.d/init.d/memcached stop&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>failed host 192.168.1.10 port 11211 protocol memcache then restart</span><br></pre></td></tr></table></figure>

<p>c.监控php-fpm</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">vi /etc/monit.d/php-fpm.monit<span class="built_in"></span></span><br><span class="line"><span class="built_in">check </span>process php-fpm with pidfile /usr/local/php/logs/php-fpm.pid</span><br><span class="line">start program = <span class="string">&quot;/usr/local/php/sbin/php-fpm start&quot;</span></span><br><span class="line">stop program = <span class="string">&quot;/usr/local/php/sbin/php-fpm stop&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>cpu &gt; 50% for 2 cycles then alert<span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>cpu &gt; 70% for 5 cycles then restart<span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>failed host 192.168.1.10 port 9000 then restart<span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>5 restarts within 5 cycles then timeout</span><br></pre></td></tr></table></figure>

<p>d.监控mysql</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">vi /etc/monit.d/mysqld.monit<span class="built_in"></span></span><br><span class="line"><span class="built_in">check </span>process mysqld with pidfile /data/mysql/mysql.pid</span><br><span class="line">start program = <span class="string">&quot;/etc/init.d/mysqld start&quot;</span></span><br><span class="line">stop program = <span class="string">&quot;/etc/init.d/mysqld stop&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>failed host 192.168.1.10 port 3306 then restart<span class="built_in"></span></span><br><span class="line"><span class="built_in">if </span>5 restarts within 5 cycles then timeout </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Modules [MIMEEntity, MIMEParser, CryptCBC, CryptBlowfish, CryptPasswdMD5, TermReadPassword] WAS NOT FOUND in your system...</title>
    <url>/2011/05/01/1264/</url>
    <content><![CDATA[<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">perl</span> -<span class="variable">MCPAN</span> -<span class="variable">e</span> <span class="variable">shell</span></span><br><span class="line"></span><br><span class="line"><span class="variable">i</span> <span class="variable">XXX</span>-<span class="function"><span class="title">XXX</span>(缺少的包名)</span></span><br><span class="line"><span class="variable">install</span> /<span class="variable">XXXX</span>/<span class="variable">XXXXX</span>/<span class="function"><span class="title">XXXX</span>(上面检索到的路径)</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MFS客户端错误</title>
    <url>/2013/06/08/1263/</url>
    <content><![CDATA[<p>错误:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">configure: <span class="keyword">error</span>: mfsmount build was forced, <span class="keyword">but</span> fuse library <span class="keyword">is</span> too old <span class="keyword">or</span> <span class="keyword">not</span> installed</span><br></pre></td></tr></table></figure>

<p>解决:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> fuse-devel</span><br></pre></td></tr></table></figure>

<p>对client进行操作时 注意防火墙是否授权.</p>
]]></content>
  </entry>
  <entry>
    <title>mongodb备份与恢复</title>
    <url>/2015/01/31/1265/</url>
    <content><![CDATA[<p>备份单个表:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mongodump</span> -u superuser -p <span class="number">123456</span> --port <span class="number">27017</span> --authenticationDatabase admin -d myTest -c d -o /backup/mongodb/myTest_d_bak_<span class="number">201507021701</span>.bak</span><br></pre></td></tr></table></figure>

<p>备份单个库:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mongodump -u superuser -p 123456 <span class="params">--port</span> 27017 <span class="params">--authenticationDatabase</span> admin -d myTest -o <span class="string">/backup/mongodb/</span></span><br></pre></td></tr></table></figure>

<p>备份所有库:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mongodump -u superuser -p 123456 <span class="params">--authenticationDatabase</span> admin <span class="params">--port</span> 27017 -o <span class="string">/root/bak</span></span><br></pre></td></tr></table></figure>

<p>备份所有库推荐使用添加–oplog参数的命令,这样的备份是基于某一时间点的快照,只能用于备份全部库时才可用,单库和单表不适用:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mongodump -h 127.0.0.1 <span class="params">--port</span> 27017 <span class="params">--oplog</span> -o <span class="string">/root/bak</span></span><br></pre></td></tr></table></figure>

<p>同时,恢复时也要加上–oplogReplay参数,具体命令如下(下面是恢复单库的命令):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mongorestore -d swrd --oplogReplay <span class="regexp">/home/m</span>ongo<span class="regexp">/swrdbak/</span>swrd/</span><br></pre></td></tr></table></figure>

<p>恢复单个库:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mongorestore -u superuser -p 123456 <span class="params">--port</span> 27017 <span class="params">--authenticationDatabase</span> admin -d myTest <span class="string">/backup/mongodb/</span></span><br></pre></td></tr></table></figure>

<p>恢复所有库:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mongorestore -u superuser -p 123456 <span class="params">--port</span> 27017 <span class="params">--authenticationDatabase</span> admin <span class="string">/root/bak</span></span><br></pre></td></tr></table></figure>

<p>恢复单表:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mongorestore -u superuser -p <span class="number">123456</span> --authenticationDatabase admin -d myTest -c d <span class="regexp">/backup/m</span>ongodb<span class="regexp">/myTest_d_bak_201507021701.bak/my</span>Test/d.bson</span><br></pre></td></tr></table></figure>

<p>备份库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/mongodump -h127.0.0.1 -d kh_logs -o /</span>home/kh_logs</span><br></pre></td></tr></table></figure>

<p>恢复库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/mongorestore  -d kh_logs  /</span>root<span class="regexp">/kh_logs/</span>kh_logs/</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Mysql 5.7 查看原始密码和修改密码</title>
    <url>/2019/08/09/1267/</url>
    <content><![CDATA[<p>1.mysql5.7会生成一个初始化密码,而在之前的版本首次登陆不需要登录.</p>
<p>进入mysql的日志文件.</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">vim /<span class="built_in">var</span>/<span class="keyword">log</span>/mysqld.<span class="keyword">log</span></span><br></pre></td></tr></table></figure>

<p>找到下面这句话,密码在后面.</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">A temporary password <span class="keyword">is</span> generated <span class="keyword">for</span> <span class="symbol">root@</span>localhost: </span><br></pre></td></tr></table></figure>

<p>2.使用这个 root 账户的密码进入mysql.</p>
<p>用一下三步骤可以解决.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = <span class="keyword">PASSWORD</span>(&quot;new password&quot;);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">PASSWORD</span> EXPIRE NEVER;</span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

<p>只修改红色字体部分就可以,因为密码要求十分严格,密码简单mysql是不会认得.</p>
<p>3.重启mysq,利用新密码重新登录.</p>
]]></content>
  </entry>
  <entry>
    <title>Mysql ERROR 1045 (28000) Access denied for user &#39;root&#39;@&#39;localhost&#39;</title>
    <url>/2016/04/23/1268/</url>
    <content><![CDATA[<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">MySQLAccessSSHBash  </span><br><span class="line">Mysql <span class="builtin-name">ERROR</span> 1045 (28000): Access denied <span class="keyword">for</span><span class="built_in"> user </span><span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这种问题需要强行重新修改密码,方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/mysql stop?? (service mysqld stop )</span><br><span class="line"><span class="regexp">/usr/</span>bin/mysqld_safe --skip-grant-tables</span><br></pre></td></tr></table></figure>

<p>另外开个SSH连接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ mysql</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;update user set password=password(<span class="string">&quot;123456&quot;</span>) where user=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;<span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line">pkill -KILL -t pts/<span class="number">0</span> </span><br></pre></td></tr></table></figure>

<p>可将pts为0的**用户(之前运行mysqld_safe的用户窗口)强制踢出.<br>正常启动:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">MySQL:<span class="regexp">/etc/i</span>nit.d/mysql start?? (service mysqld start)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySQL server has gone away</title>
    <url>/2017/11/13/1269/</url>
    <content><![CDATA[<p>1、应用程序(比如PHP)长时间的执行批量的MYSQL语句.</p>
<p>最常见的就是采集或者新旧数据转化.</p>
<p>解决方案:</p>
<p>在my.cnf文件中添加或者修改以下两个变量:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">wait_timeout</span>=<span class="number">2880000</span></span><br><span class="line"><span class="attr">interactive_timeout</span> = <span class="number">2880000</span></span><br></pre></td></tr></table></figure>

<p>关于两个变量的具体说明可以google或者看官方手册.<br>如果不能修改my.cnf,则可以在连接数据库的时候设置CLIENT_INTERACTIVE,比如:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">sql = <span class="string">&quot;set interactive_timeout=24*3600&quot;</span>;</span><br><span class="line"><span class="function"><span class="title">mysql_real_query</span>(<span class="params">...</span>)</span></span><br></pre></td></tr></table></figure>

<p>2、执行一个SQL,但SQL语句过大或者语句中含有BLOB或者longblob字段.</p>
<p>解决方案:</p>
<p>在my.cnf文件中添加或者修改以下变量:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">max_allowed_packet</span> = 10M(也可以设置自己需要的大小)</span><br><span class="line">max_allowed_packet 参数的作用是,用来控制其通信缓冲区的最大长度.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql创建用户与授权</title>
    <url>/2018/05/10/1273/</url>
    <content><![CDATA[<p>一, 创建用户<br>命令:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>说明:username - 你将创建的用户名, host - 指定该用户在哪个主机上可以登陆,如果是本地用户可用localhost, 如果想让该用户可以从任意远程主机登陆,可以使用通配符%. password - 该用户的登陆密码,密码可以为空,如果为空则该用户可以不需要密码登陆服务器.</p>
<p>例子:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;dog&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;192.168.1.101_&#x27;</span> IDENDIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>二,授权<br>命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span></span><br></pre></td></tr></table></figure>

<p>说明: privileges - 用户的操作权限,如SELECT , INSERT , UPDATE 等.如果要授予所的权限则使用ALL.;databasename - 数据库名,tablename-表名,如果要授予该用户对所有数据库和表的相应操作权限则可用*表示, 如*.*.</p>
<p>例子:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> test.<span class="keyword">user</span> <span class="keyword">TO</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">#注意:用以上命令授权的用户不能给其它用户授权,如果想让该用户可以授权,用以下命令:</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<p>三.设置与更改用户密码<br>命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> = <span class="keyword">PASSWORD</span>(<span class="string">&#x27;newpassword&#x27;</span>);如果是当前登陆用户用<span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = </span><br><span class="line"><span class="keyword">PASSWORD</span>(&quot;newpassword&quot;);</span><br></pre></td></tr></table></figure>

<p>例子:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span> = <span class="keyword">PASSWORD</span>(&quot;123456&quot;);</span><br></pre></td></tr></table></figure>

<p>四.撤销用户权限<br>命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> privilege <span class="keyword">ON</span> databasename.tablename <span class="keyword">FROM</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>说明: privilege, databasename, tablename - 同授权部分.</p>
<p>例子:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> *.* <span class="keyword">FROM</span> <span class="string">&#x27;pig&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>注意: 假如你在给用户‘pig‘@’%’授权的时候是这样的(或类似的):<code>GRANT SELECT ON test.user TO &#39;pig&#39;@&#39;%&#39;</code>, 则在使用 <code>REVOKE SELECT ON *.* FROM &#39;pig&#39;@&#39;%&#39;;</code>命令并不能撤销该用户对test数据库中user表的SELECT 操作.相反,如果授权使用的是 <code>GRANT SELECT ON *.* TO &#39;pig&#39;@&#39;%&#39;;</code>则 <code>REVOKE SELECT ON test.user FROM &#39;pig&#39;@&#39;%&#39;;</code>命令也不能撤销该用户对test数据库中user表的Select 权限.<br>具体信息可以用命令 <code>SHOW GRANTS FOR &#39;pig&#39;@&#39;%&#39;;</code> 查看.</p>
<p>五.删除用户<br>命令:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySQL-Proxy 实现 MySQL 的负载均衡和读写分离实现</title>
    <url>/2019/02/28/1270/</url>
    <content><![CDATA[<p>Mysql proxy是MySQL官方开发一个mysql数据库前端代理,使用C语言编写,并且支持lua来编写proxy规则,可以用来实现mysql的读写分 离,负载均衡等等功能.</p>
<p>一:安装Mysql-Proxy</p>
<p>1)系统环境的设置(系统为CentOs 5.2):</p>
<p>确定这些包已经安装:GNU Autotools, flex, pkg-config, bazaar, MySQL client libraries:</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">yum install <span class="built_in">auto</span>conf <span class="built_in">auto</span>make libtool flex pkgconfig bzr mysql-devel</span><br></pre></td></tr></table></figure>

<p>因为系统自带的libevent 和 glib的版本都比较低,然而mysql proxy 0.7.0对其版本要求是libevent&gt;1.4.0,glib2&gt;2.1.16.因此要手动编译.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">A:libevent</span><br><span class="line">    wget http:<span class="regexp">//</span>www.dbasky.net<span class="regexp">/tool/</span>libevent-<span class="number">1.4</span>.<span class="number">9</span>-stable.tar.gz</span><br><span class="line">    tar zvfx libevent-<span class="number">1.4</span>.<span class="number">9</span>-stable.tar.gz</span><br><span class="line">    cd libevent-<span class="number">1.4</span>.<span class="number">9</span>-stable</span><br><span class="line">    ./configure</span><br><span class="line">    make</span><br><span class="line">    make install</span><br><span class="line">B:GLIB</span><br><span class="line">    wget http:<span class="regexp">//</span>www.dbasky.net<span class="regexp">/tool/g</span>lib-<span class="number">2.18</span>.<span class="number">4</span>.tar.gz</span><br><span class="line">    tar zvfx glib-<span class="number">2.18</span>.<span class="number">4</span>.tar.gz</span><br><span class="line">    cd glib-<span class="number">2.18</span>.<span class="number">4</span></span><br><span class="line">    ./configure</span><br><span class="line">    make</span><br><span class="line">    make install</span><br></pre></td></tr></table></figure>

<p>2)安装lua 5.1</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.dbasky.net<span class="regexp">/tool/</span>lua-<span class="number">5.1</span>.<span class="number">4</span>.tar.gz</span><br><span class="line">tar zvfx lua-<span class="number">5.1</span>.<span class="number">4</span>.tar.gz</span><br><span class="line">cd lua-<span class="number">5.1</span>.<span class="number">4</span></span><br><span class="line">vi src/Makefile <span class="comment">#在64位机上编译出现了&quot;relocations&quot;错误,需要在CFLAGS里加上-fPIC.</span></span><br><span class="line">make linux</span><br><span class="line">make install</span><br><span class="line">cp etc<span class="regexp">/lua.pc /u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/pkgconfig/</span> <span class="comment">#重要:让pkg-config找到自己编译的库在哪里</span></span><br><span class="line">export PKG_CONFIG_PATH=<span class="variable">$PKG_CONFIG_PATH</span>:<span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>pkgconfig</span><br></pre></td></tr></table></figure>

<p>3)安装Mysql-proxy</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">wget http://www.dbasky.net/tool/mysql-proxy-0.7.0.tar.tar</span><br><span class="line">tar zxvf mysql-proxy-0.7.0.tar.tar</span><br><span class="line">cd mysql-proxy-0.7.0</span><br><span class="line"><span class="keyword">.</span>/configure</span><br><span class="line">make</span><br><span class="line">make<span class="built_in"> check</span></span><br><span class="line"><span class="built_in"></span>make install</span><br></pre></td></tr></table></figure>

<p>编译完成,可以检查一下最终结果:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mysql-proxy -V</span><br><span class="line">mysql-proxy: error <span class="keyword">while</span> loading shared libraries: <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libmysql-chassis.so.<span class="number">0</span>: cannot restore segment prot after reloc: Permission denied</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<p>编辑 <code>/etc/selinux/config</code>,找到这段:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="meta"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="meta"># enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="meta"># permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="meta"># disabled - SELinux is fully disabled.</span></span><br><span class="line">SELINUX=enforcing</span><br></pre></td></tr></table></figure>

<p>把 SELINUX=enforcing 注释掉:#SELINUX=enforcing ,然后新加一行为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure>

<p>保存,关闭.</p>
<p>在你保证SElinux 被disable后.还执行下:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">chcon -t <span class="keyword">texrel_shlib_t</span></span><br></pre></td></tr></table></figure>

<p>例:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chcon -t texrel_shlib_t <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libmysql-chassis.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>再一次检查:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql</span>-proxy -V</span><br><span class="line"><span class="attribute">mysql</span>-proxy <span class="number">0</span>.<span class="number">7</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">glib2</span>: <span class="number">2</span>.<span class="number">18</span>.<span class="number">4</span></span><br><span class="line"><span class="attribute">libevent</span>: <span class="number">1</span>.<span class="number">1</span>a</span><br><span class="line"><span class="attribute">admin</span>: <span class="number">0</span>.<span class="number">7</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">proxy</span>: <span class="number">0</span>.<span class="number">7</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>二:使用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql-proxy --<span class="built_in">help</span>-<span class="built_in">all</span> <span class="comment">#查看所有的设置选项</span></span><br></pre></td></tr></table></figure>

<p>管理功能选项:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line">--<span class="comment">admin</span><span class="literal">-</span><span class="comment">address=host:port</span> -- <span class="comment">指定一个mysqo</span><span class="literal">-</span><span class="comment">proxy的管理端口</span><span class="string">,</span><span class="comment">缺省是</span> <span class="comment">4041</span></span><br></pre></td></tr></table></figure>

<p>代理功能选项:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">address=host:port</span> -- <span class="comment">这个是mysql</span><span class="literal">-</span><span class="comment">proxy</span> <span class="comment">服务器端的监听端口</span><span class="string">,</span><span class="comment">缺省是</span> <span class="comment">4040</span></span><br><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">read</span><span class="literal">-</span><span class="comment">only</span><span class="literal">-</span><span class="comment">backend</span><span class="literal">-</span><span class="comment">addresses=</span> -- <span class="comment">远程只读Slave服务器的地址和端口</span><span class="string">,</span><span class="comment">缺省为不设置(本选项在mysql</span><span class="literal">-</span><span class="comment">proxy0</span><span class="string">.</span><span class="comment">5</span><span class="string">.</span><span class="comment">0版本中没有)</span></span><br><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">backend</span><span class="literal">-</span><span class="comment">addresses=host:port</span> -- <span class="comment">指定远程MySQL服务器地址和端口</span><span class="string">,</span><span class="comment">可以设置多个</span><span class="string">,</span></span><br><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">skip</span><span class="literal">-</span><span class="comment">profiling</span> -- <span class="comment">关闭查询分析功能</span><span class="string">,</span><span class="comment">缺省是打开的</span></span><br><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">fix</span><span class="literal">-</span><span class="comment">bug</span><span class="literal">-</span><span class="comment">25371</span> -- <span class="comment">修正</span> <span class="comment">mysql的libmysql版本大于5</span><span class="string">.</span><span class="comment">1</span><span class="string">.</span><span class="comment">12的一个#25371号bug</span></span><br><span class="line">--<span class="comment">proxy</span><span class="literal">-</span><span class="comment">lua</span><span class="literal">-</span><span class="comment">script=file</span> -- <span class="comment">指定一个Lua脚本程序来控制mysql</span><span class="literal">-</span><span class="comment">proxy的运行和设置</span><span class="string">,</span><span class="comment">这个脚本在每次新建连接和脚本发生修改的的时候将重新调用:</span></span><br><span class="line">--<span class="comment">daemon</span> -- <span class="comment">mysql</span><span class="literal">-</span><span class="comment">proxy以守护进程方式运行</span></span><br><span class="line">--<span class="comment">pid</span><span class="literal">-</span><span class="comment">file=file</span> -- <span class="comment">设置mysql</span><span class="literal">-</span><span class="comment">proxy的存储PID文件的路径</span></span><br></pre></td></tr></table></figure>

<p>例:</p>
<p>监听本地Mysql 3307端口:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/sbin/my</span>sql-proxy --proxy-backend-addresses=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3307</span></span><br></pre></td></tr></table></figure>

<p>通过其它机器的mysql客户端连接:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">/usr/<span class="keyword">local</span>/mysql/bin/mysql -uroot -h <span class="number">192.168</span><span class="number">.1</span><span class="number">.6</span> -p <span class="number">4040</span></span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor. Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> /g.</span><br><span class="line">Your MySQL <span class="keyword">connection</span> id <span class="keyword">is</span> <span class="number">32</span></span><br><span class="line"><span class="keyword">Server</span> <span class="keyword">version</span>: <span class="number">5.0</span><span class="number">.45</span></span><br><span class="line"><span class="keyword">Type</span> <span class="string">&#x27;help;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;/h&#x27;</span> <span class="keyword">for</span> help. <span class="keyword">Type</span> <span class="string">&#x27;/c&#x27;</span> <span class="keyword">to</span> clear the buffer.</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>例:对两台或者多台Mysql的负载均衡:<br>假设有两台Slave的读数据服务器,我们使用mysql_proxy多个数据库的轮询技术来进行两台Slave数据库的负载均衡分散访问措 施,mysql-proxy可以做到,缺省就具有了简单的均衡功能,它自带的均衡功能是当有多台MySQL服务器的时候,进行逐个访问的原则,比如有A、 B两台MySQL服务器,那么第一个连接就访问A,第二个连接访问B,第三个连接访问A,一次分布,达到A、B两台MySQL访问均衡.<br>对于mysql-proxy这个功能,我们进行检测一下.增加一个Lua检测脚本 test-conn.lua,就一个函数:</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_query</span><span class="params">( packet )</span></span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;read_query: connection.backend_ndx: &quot;</span>, proxy.connection.backend_ndx)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>执行:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">/usr/local/sbin/mysql-proxy <span class="attribute">--proxy-address</span>=192.168.1.6:3306 <span class="attribute">--proxy-backend-addresses</span>=192.168.1.231:3306 <span class="attribute">--proxy-backend-addresses</span>=192.168.1.10:3306 <span class="attribute">--proxy-lua-script</span>=/opt/test-conn.lua</span><br></pre></td></tr></table></figure>

<p>通过其它机器的mysql客户端进行多次的连接登陆,在mysql-proxy的服务端输出:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">1</span></span><br><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">2</span></span><br><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">1</span></span><br><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">2</span></span><br><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">1</span></span><br><span class="line"><span class="attribute">read_query</span>: connection.backend_ndx: <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>启动脚本:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi mysql-proxy.sh</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">export LUA_PATH=<span class="regexp">/usr/</span>local<span class="regexp">/share/my</span>sql-proxy/?.lua</span><br><span class="line">case <span class="string">&quot;$1&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/sbin/my</span>sql-proxy --daemon /</span><br><span class="line">--proxy-address=<span class="number">192.168</span>.<span class="number">1.6</span>:<span class="number">3306</span> /</span><br><span class="line">--proxy-backend-addresses=<span class="number">192.168</span>.<span class="number">1.6</span>:<span class="number">3307</span> /</span><br><span class="line"><span class="comment">#--proxy-read-only-backend-addresses=192.168.1.10:3306 /</span></span><br><span class="line">--proxy-lua-script=<span class="regexp">/usr/</span>local<span class="regexp">/share/my</span>sql-proxy/rw-splitting.lua</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">killall mysql-proxy</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo <span class="string">&quot;Usage: mysql-proxy &#123;start|stop&#125;&quot;</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>三:管理Mysql Proxy</p>
<p>在启动 mysql-proxy 之后,就会打开两个端口,一个是4040,这个是缺省用于提供给MySQL客户端连接使用的端口,可以通过 –proxy-address 选项修改为其他的,比如设置为 –proxy-address=192.168.1.6:3306,就完全模拟成了一台MySQL数据库了.另外默认开放 4041 的端口,这个是用来提供给管理 mysql-proxy 使用的,可以使用标准的mysql客户端来连接,同样能够通过 –admin-address 选项来设置为其他管理端口.<br>例:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysql -u root -h 192.168.1.6 -P 4041</span><br><span class="line">Welcome to the MySQL monitor. Commands end with ; or g.</span><br><span class="line">Your MySQL connection id is 10</span><br><span class="line">Server version: 5.0.45-agent MySQL Enterprise Agent</span><br><span class="line"><span class="section">mysql&gt; select * from proxy_connections;</span></span><br><span class="line"><span class="section">+------+--------+-------+------------+</span></span><br><span class="line"><span class="section">| id | type | state | db |</span></span><br><span class="line"><span class="section">+------+--------+-------+------------+</span></span><br><span class="line">| 0 | server | 0 | |</span><br><span class="line">| 1 | proxy | 0 | |</span><br><span class="line">| 2 | proxy | 10 | replaction |</span><br><span class="line"><span class="section">| 3 | server | 10 | |</span></span><br><span class="line"><span class="section">+------+--------+-------+------------+</span></span><br><span class="line">4 rows in set (0.02 sec)</span><br><span class="line"><span class="section">mysql&gt; select * from proxy_config;</span></span><br><span class="line"><span class="section">+----------------------------+------------------+</span></span><br><span class="line"><span class="section">| option | value |</span></span><br><span class="line"><span class="section">+----------------------------+------------------+</span></span><br><span class="line">| admin.address | :4041 |</span><br><span class="line">| proxy.address | 192.168.1.10:3306 |</span><br><span class="line">| proxy.lua<span class="emphasis">_script | NULL |</span></span><br><span class="line"><span class="emphasis">| proxy.backend_addresses[0] | 192.168.1.231:3306 |</span></span><br><span class="line"><span class="emphasis">| proxy.fix_bug_</span>25371 | 0 |</span><br><span class="line"><span class="section">| proxy.profiling | 1 |</span></span><br><span class="line"><span class="section">+----------------------------+------------------+</span></span><br><span class="line">6 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>基本的运行信息都包含.</p>
]]></content>
  </entry>
  <entry>
    <title>MySQL安全配置</title>
    <url>/2014/12/07/1271/</url>
    <content><![CDATA[<p>数据库作为数据管理的平台,它的安全性首先由系统的内部安全和网络安全两部分来决定.对于系统管理员来说,首先要保证系统本身的安全,在安装MySQL数据库时,需要对基础环境进行较好的配置.</p>
<p>1、修改root用户口令,删除空口令</p>
<p>缺省安装的MySQL的root用户是空密码的,为了安全起见,必须修改为强密码,所谓的强密码,至少8位,由字母、数字和符号组成的不规律密码.使用 MySQL自带的命令mysaladmin修改root密码,同时也可以登陆数据库,修改数据库mysql下的user表的字段内容,修改方法如下所示:<br>$ /usr/local/mysql/bin/mysqladmin -u root password “upassword” //使用mysqladmin<br>$mysql&gt; use mysql;<br>$mysql&gt; update user set password=password(‘upassword’) where user=’root’;<br>$mysql&gt; flush privileges; //强制刷新内存授权表,否则用的还是在内存缓冲的口令</p>
<p>2、删除默认数据库和数据库用户</p>
<p>一般情况下,MySQL数据库安装在本地,并且也只需要本地的php脚本对mysql进行读取,所以很多用户不需要,尤其是默认安装的用户.MySQL初始化后会自动生成空用户和test库,进行安装的测试,这会对数据库的安全构成威胁,有必要全部删除,最后的状态只保留单个root即可,当然以后根据需要增加用户和数据库.<br>$mysql&gt; show databases;<br>$mysql&gt; drop database test; //删除数据库test<br>$use mysql;<br>$delete from db; //删除存放数据库的表信息,因为还没有数据库信息.<br>$mysql&gt; delete from user where not (user=’root’) ; // 删除初始非root的用户<br>$mysql&gt; delete from user where user=’root’ and password=’’; //删除空密码的root,尽量重复操作<br>Query OK, 2 rows affected (0.00 sec)<br>$mysql&gt; flush privileges; //强制刷新内存授权表.</p>
<p>3、改变默认mysql管理员帐号</p>
<p>系统mysql的管理员名称是root,而一般情况下,数据库管理员都没进行修改,这一定程度上对系统用户穷举的恶意行为提供了便利,此时修改为复杂的用户名,请不要在设定为admin或者administraror的形式,因为它们也在易猜的用户字典中.<br>mysql&gt; update user set user=”newroot” where user=”root”; //改成不易被猜测的用户名<br>mysql&gt; flush privileges;</p>
<p>4、关于密码的管理</p>
<p>密码是数据库安全管理的一个很重要因素,不要将纯文本密码保存到数据库中.如果你的计算机有安全危险,入侵者可以获得所有的密码并使用它们.相反,应使用 MD5()、SHA1()或单向哈希函数.也不要从词典中选择密码,有专门的程序可以破解它们,请选用至少八位,由字母、数字和符号组成的强密码.在存取密码时,使用mysql的内置函数password()的sql语句,对密码进行加密后存储.例如以下方式在users表中加入新用户.<br>$mysql&gt; insert into users values (1,password(1234),’test’);</p>
<p>5、使用独立用户运行msyql</p>
<p>绝对不要作为使用root用户运行MySQL服务器.这样做非常危险,因为任何具有FILE权限的用户能够用root创建文件(例如,~root/.bashrc).mysqld拒绝使用root运行,除非使用–user=root选项明显指定.应该用普通非特权用户运行 mysqld.正如前面的安装过程一样,为数据库建立独立的linux中的mysql账户,该账户用来只用于管理和运行MySQL.<br>要想用其它Unix用户启动mysqld,,增加user选项指定/etc/my.cnf选项文件或服务器数据目录的my.cnf选项文件中的 [mysqld]组的用户名.<br>$vi /etc/my.cnf<br>[mysqld]<br>user=mysql<br>该命令使服务器用指定的用户来启动,无论你手动启动或通过mysqld_safe或mysql.server启动,都能确保使用mysql的身份.也可以在启动数据库是,加上user参数.<br>$ /usr/local/mysql/bin/mysqld_safe –user=mysql &amp;<br>作为其它linux用户而不用root运行mysqld,你不需要更改user表中的root用户名,因为MySQL账户的用户名与linux账户的用户名无关.确保mysqld运行时,只使用对数据库目录具有读或写权限的linux用户来运行.</p>
<p>6、禁止远程连接数据库</p>
<p>在命令行netstat -ant下看到,默认的3306端口是打开的,此时打开了mysqld的网络监听,允许用户远程通过帐号密码连接数本地据库,默认情况是允许远程连接数据的.为了禁止该功能,启动skip-networking,不监听sql的任何TCP/IP的连接,切断远程访问的权利,保证安全性.假如需要远程管理数据库,可通过安装PhpMyadmin来实现.假如确实需要远程连接数据库,至少修改默认的监听端口,同时添加防火墙规则,只允许可信任的网络的 mysql监听端口的数据通过.<br>$ vi /etc/my.cf<br>将$skip-networking注释去掉.<br>$/usr/local/mysql/bin/mysqladmin -u root -p shutdown //停止数据库<br>$/usr/local/mysql/bin/mysqld_safe –user=mysql &amp; //后台用mysql用户启动mysql</p>
<p>7、限制连接用户的数量</p>
<p>数据库的某用户多次远程连接,会导致性能的下降和影响其他用户的操作,有必要对其进行限制.可以通过限制单个账户允许的连接数量来实现,设置my.cnf 文件的mysqld中的max_user_connections变量来完成.GRANT语句也可以支持 资源控制选项来限制服务器对一个账户允许的使用范围.<br>$vi /etc/my.cnf<br>[mysqld]<br>max_user_connections 2</p>
<p>8、用户目录权限限制</p>
<p>默认的mysql是安装在/usr/local/mysql,而对应的数据库文件在/usr/local/mysql/var目录下,因此,必须保证该目录不能让未经授权的用户访问后把数据库打包拷贝走了,所以要限制对该目录的访问.确保mysqld运行时,只使用对数据库目录具有读或写权限的linux 用户来运行.<br>$ chown -R root /usr/local/mysql/ //mysql主目录给root<br>$ chown -R mysql.mysql /usr/local/mysql/var //确保数据库目录权限所属mysql用户</p>
<p>9、命令历史记录保护</p>
<p>数据库相关的shell操作命令都会分别记录在.bash_history,如果这些文件不慎被读取,会导致数据库密码和数据库结构等信息泄露,而登陆数据库后的操作将记录在.mysql_history文件中,如果使用update表信息来修改数据库用户密码的话,也会被读取密码,因此需要删除这两个文件,同时在进行登陆或备份数据库等与密码相关操作时,应该使用-p参数加入提示输入密码后,隐式输入密码,建议将以上文件置空.<br>$ rm .bash_history .mysql_history //删除历史记录<br>$ ln -s /dev/null .bash_history   //将shell记录文件置空<br>$ ln -s /dev/null .mysql_history //将mysql记录文件置空</p>
<p>10、禁止MySQL对本地文件存取</p>
<p>在mysql中,提供对本地文件的读取,使用的是load data local infile命令,默认在5.0版本中,该选项是默认打开的,该操作令会利用MySQL把本地文件读到数据库中,然后用户就可以非法获取敏感信息了,假如你不需要读取本地文件,请务必关闭.<br>测试:首先在测试数据库下建立sqlfile.txt文件,用逗号隔开各个字段<br>$ vi sqlfile.txt<br>1,sszng,111<br>2,sman,222<br>$mysql&gt; load data local infile ‘sqlfile.txt’ into table users fields terminated by ‘,’; //读入数据<br>$mysql&gt; select * from users;<br>+——–+————+———-+<br>| userid | username   | password |<br>+——–+————+———-+<br>|      1 | sszng    | 111   |<br>|      2 | sman    | 222 |<br>+——–+————+———-+<br>成功的将本地数据插入数据中,此时应该禁止MySQL中用”LOAD DATA LOCAL INFILE”命令.网络上流传的一些攻击方法中就有用它LOAD DATA LOCAL INFILE的,同时它也是很多新发现的SQL Injection攻击利用的手段!黑客还能通过使用LOAD DATALOCAL INFILE装载”/etc/passwd”进一个数据库表,然后能用SELECT显示它,这个操作对服务器的安全来说,是致命的.可以在my.cnf中添加local-infile=0,或者加参数local-infile=0启动mysql.<br>$/usr/local/mysql/bin/mysqld_safe –user=mysql –local-infile=0 &amp;<br>$mysql&gt; load data local infile ‘sqlfile.txt’ into table users fields terminated by ‘,’;<br>$ERROR 1148 (42000): The used command is not allowed with this MySQL version<br>–local-infile=0选项启动mysqld从服务器端禁用所有LOAD DATA LOCAL命令,假如需要获取本地文件,需要打开,但是建议关闭.</p>
<p>11、MySQL服务器权限控制</p>
<p>MySQL权限系统的主要功能是证实连接到一台给定主机的用户,并且赋予该用户在数据库上的SELECT、INSERT、UPDATE和DELETE等权限(详见user超级用户表).它的附加的功能包括有匿名的用户并对于MySQL特定的功能例如LOAD DATA INFILE进行授权及管理操作的能力.<br>管理员可以对user,db,host等表进行配置,来控制用户的访问权限,而user表权限是超级用户权限.只把user表的权限授予超级用户如服务器或数据库主管是明智的.对其他用户,你应该把在user表中的权限设成’N’并且仅在特定数据库的基础上授权.你可以为特定的数据库、表或列授权,FILE权限给予你用LOAD DATA INFILE和SELECT … INTO OUTFILE语句读和写服务器上的文件,任何被授予FILE权限的用户都能读或写MySQL服务器能读或写的任何文件.(说明用户可以读任何数据库目录下的文件,因为服务器可以访问这些文件). FILE权限允许用户在MySQL服务器具有写权限的目录下创建新文件,但不能覆盖已有文件在user表的File_priv设置Y或N.,所以当你不需要对服务器文件读取时,请关闭该权限.<br>$mysql&gt; load data infile ‘sqlfile.txt’ into table loadfile.users fields terminated by ‘,’;<br>Query OK, 4 rows affected (0.00 sec) //读取本地信息sqlfile.txt’<br>Records: 4 Deleted: 0 Skipped: 0 Warnings: 0<br>$mysql&gt; update user set File_priv=’N’ where user=’root’; //禁止读取权限<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1 Changed: 1 Warnings: 0<br>mysql&gt; flush privileges; //刷新授权表<br>Query OK, 0 rows affected (0.00 sec)<br>$mysql&gt; load data infile ‘sqlfile.txt’ into table users fields terminated by ‘,’; //重登陆读取文件<br>$ERROR 1045 (28000): Access denied for user ‘root‘@’localhost’ (using password: YES) //失败<br>$ mysql&gt; select * from loadfile.users into outfile ‘test.txt’ fields terminated by ‘,’;<br>ERROR 1045 (28000): Access denied for user ‘root‘@’localhost’ (using password: YES)<br>为了安全起见,随时使用SHOW GRANTS语句检查查看谁已经访问了什么.然后使用REVOKE语句删除不再需要的权限.</p>
<p>12、使用chroot方式来控制MySQL的运行目录</p>
<p>Chroot是linux中的一种系统高级保护手段,它的建立会将其与主系统几乎完全隔离,也就是说,一旦遭到什么问题,也不会危及到正在运行的主系统.这是一个非常有效的办法,特别是在配置网络服务程序的时候.</p>
<p>13、关闭对Web访问的支持</p>
<p>如果不打算让Web访问使用MySQL数据库,没有提供诸如PHP这样的Web语言的时候,重新设置或编译你的PHP,取消它们对MySQL的默认支持.假如服务器中使用php等web程序,试试用Web形式非法的请求,如果得到任何形式的MySQL错误,立即分析原因,及时修改Web程序,堵住漏洞,防止MySQL暴露在web面前.<br>对于Web的安全检查,在MySQL官方文档中这么建议,对于web应用,至少检查以下清单:<br>试试用Web形式输入单引号和双引号(‘’’和’”‘).如果得到任何形式的MySQL错误,立即分析原因.<br>试试修改动态URL,可以在其中添加%22(‘“‘)、%23(‘$’)和%27(‘’’).<br>试试在动态URL中修改数据类型,使用前面示例中的字符,包括数字和字符类型.你的应用程序应足够安全,可以防范此类修改和类似攻击.<br>试试输入字符、空格和特殊符号,不要输入数值字段的数字.你的应用程序应在将它们传递到MySQL之前将它们删除或生成错误.将未经过检查的值传递给 MySQL是很危险的!<br>将数据传给MySQL之前先检查其大小.<br>用管理账户之外的用户名将应用程序连接到数据库.不要给应用程序任何不需要的访问权限.</p>
<p>14、数据库备份策略</p>
<p>一般可采用本地备份和网络备份的形式,可采用MySQL本身自带的mysqldump的方式和直接复制备份形式,<br>直接拷贝数据文件最为直接、快速、方便,但缺点是基本上不能实现增量备份.为了保证数据的一致性,需要在备份文件前,执行以下 SQL 语句:FLUSH TABLES WITH READ LOCK;也就是把内存中的数据都刷新到磁盘中,同时锁定数据表,以保证拷贝过程中不会有新的数据写入.这种方法备份出来的数据恢复也很简单,直接拷贝回原来的数据库目录下即可.<br>使用mysqldump可以把整个数据库装载到一个单独的文本文件中.这个文件包含有所有重建您的数据库所需要的SQL命令.这个命令取得所有的模式(Schema,后面有解释)并且将其转换成DDL语法(CREATE语句,即数据库定义语句),取得所有的数据,并且从这些数据中创建INSERT语句.这个工具将您的数据库中所有的设计倒转.因为所有的东西都被包含到了一个文本文件中.这个文本文件可以用一个简单的批处理和一个合适SQL语句导回到 MySQL中.<br>使用 mysqldump进行备份非常简单,如果要备份数据库” nagios_db_backup “,使用命令,同时使用管道gzip命令对备份文件进行压缩,建议使用异地备份的形式,可以采用Rsync等方式,将备份服务器的目录挂载到数据库服务器,将数据库文件备份打包在,通过crontab定时备份数据:<br>$!/bin/sh<br>time=<code>date +&quot;(&quot;%F&quot;)&quot;%R</code><br>$/usr/local/mysql/bin/mysqldump -u nagios -pnagios nagios | gzip &gt;/home/sszheng/nfs58/nagiosbackup/nagios_backup.$time.gz<br>$ crontab -l<br>$ m h dom mon dow   command<br>00 00 * * * /home/sszheng/shnagios/backup.sh<br>恢复数据使用命令:<br>gzip -d nagios_backup.(2008-01-24)00:00.gz<br>nagios_backup.(2008-01-24)00:00<br>$mysql –u root -p nagios       &lt; /home/sszheng/nfs58/nagiosbackup/nagios_backup.(2008-01-24)12:00</p>
<p>Mysqld安全相关启动选项</p>
<p>下列mysqld选项影响安全:<br>–allow-suspicious-udfs<br>该选项控制是否可以载入主函数只有xxx符的用户定义函数.默认情况下,该选项被关闭,并且只能载入至少有辅助符的UDF.这样可以防止从未包含合法 UDF的共享对象文件载入函数.<br>–local-infile[={0|1}]<br>如果用–local-infile=0启动服务器,则客户端不能使用LOCAL in LOAD DATA语句.<br>–old-passwords<br>强制服务器为新密码生成短(pre-4.1)密码哈希.当服务器必须支持旧版本客户端程序时,为了保证兼容性这很有用.<br>(OBSOLETE) –safe-show-database<br>在以前版本的MySQL中,该选项使SHOW DATABASES语句只显示用户具有部分权限的数据库名.在MySQL 5.1中,该选项不再作为现在的 默认行为使用,有一个SHOW DATABASES权限可以用来控制每个账户对数据库名的访问.<br>–safe-user-create<br>如果启用,用户不能用GRANT语句创建新用户,除非用户有mysql.user表的INSERT权限.如果你想让用户具有授权权限来创建新用户,你应给用户授予下面的权限:<br>mysql&gt; GRANT INSERT(user) ON mysql.user TO ‘user_name‘@’host_name’;<br>这样确保用户不能直接更改权限列,必须使用GRANT语句给其它用户授予该权限.<br>–secure-auth<br>不允许鉴定有旧(pre-4.1)密码的账户.<br>–skip-grant-tables<br>这个选项导致服务器根本不使用权限系统.这给每个人以完全访问所有的数据库的权力!(通过执行mysqladmin flush-privileges或mysqladmin eload命令,或执行FLUSH PRIVILEGES语句,你能告诉一个正在运行的服务器再次开始使用授权表.)<br>–skip-name-resolve<br>主机名不被解析.所有在授权表的Host的列值必须是IP号或localhost.<br>–skip-networking<br>在网络上不允许TCP/IP连接.所有到mysqld的连接必须经由Unix套接字进行.<br>–skip-show-database<br>使用该选项,只允许有SHOW DATABASES权限的用户执行SHOW DATABASES语句,该语句显示所有数据库名.不使用该选项,允许所有用户执行SHOW DATABASES,但只显示用户有SHOW DATABASES权限或部分数据库权限的数据库名.请注意全局权限指数据库的权限.</p>
]]></content>
  </entry>
  <entry>
    <title>MySQL查看用户权限命令</title>
    <url>/2016/12/23/1272/</url>
    <content><![CDATA[<p>如果可以用navicat工具连过去,查看用户权限,修改用户权限都是很方便的,但很多时候MySQL都是只允许localhost访问,这时就只能用命令了.<br>以前只会用:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> mysql.<span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">&#x27;username&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>今天发现这个更方便:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">show</span> grants <span class="keyword">for</span> username<span class="meta">@localhost</span>;</span><br></pre></td></tr></table></figure>

<p>show可以看到很多东西:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database dbname;  <span class="meta">#这个可以看到创建数据库时用到的一些参数.</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> table tickets;    <span class="meta">#可以看到创建表时用到的一些参数</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql错误</title>
    <url>/2015/12/07/1274/</url>
    <content><![CDATA[<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">henry@henry-laptop:~<span class="regexp">/Soft/</span>Ruby<span class="regexp">/RubyGem/</span>rubygems-<span class="number">0.9</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ sudo gem update --system Updating RubyGems...</span><br><span class="line">Bulk updating Gem <span class="keyword">source</span> index <span class="keyword">for</span>: http:<span class="comment">//gems.rubyforge.org</span></span><br><span class="line">Attempting remote update of rubygems-update</span><br><span class="line">ERROR:? <span class="keyword">While</span> executing gem ... (Errno::ENOENT)</span><br><span class="line">&amp; No such <span class="keyword">file</span> or directory - getcwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">henry@henry-laptop:~<span class="regexp">/Soft/</span>Ruby<span class="regexp">/RubyGem/</span>rubygems-<span class="number">0.9</span>.<span class="number">0</span>$ sudo gem update rails</span><br><span class="line">sudo: cannot get working directory</span><br><span class="line">Updating installed gems...</span><br><span class="line">Attempting remote update of rails</span><br><span class="line">Install required dependency rake? [Yn]? y</span><br><span class="line">ERROR:? <span class="keyword">While</span> executing gem ... (Errno::ENOENT)</span><br><span class="line">&amp; No such <span class="keyword">file</span> or directory - getcwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">henry@henry-laptop:~<span class="regexp">/Soft/</span>Ruby<span class="regexp">/RubyGem/</span>rubygems-<span class="number">0.9</span>.<span class="number">0</span>$ cd ~</span><br><span class="line">henry@henry-laptop:~$ sudo gem update --system</span><br></pre></td></tr></table></figure>

<p>后面运行正常,看来Gem还会挑剔目录～</p>
]]></content>
  </entry>
  <entry>
    <title>mysql导入导出部分表</title>
    <url>/2015/10/13/1276/</url>
    <content><![CDATA[<p>导出:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">mysqldump -uroot -phtbk123456 mysql <span class="keyword">user</span> <span class="title">host</span> &gt; /home/sq3.sql</span><br></pre></td></tr></table></figure>

<p>导入:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">use 数据库名</span><br><span class="line"><span class="keyword">source</span> <span class="regexp">/home/</span>sq3.sql</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql导入sql文件乱码解决</title>
    <url>/2016/10/22/1275/</url>
    <content><![CDATA[<p>打开mysql数据库客户端,输入:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;character%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>查看各个编码格式.<br>如果没有sql文件对应的编码格式,可如下操作:</p>
<p>先修改my.inimysql数据库配置文件,添加[client]标签内容和修改[mysqld]标签内容,然后保存.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line">　　<span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">　　<span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line">　　<span class="attr">character-set-server</span>=utf8</span><br><span class="line">　　<span class="attr">collation-server</span>=utf8_general_ci</span><br></pre></td></tr></table></figure>

<p>电脑重启mysql服务,之后再重新执行 <code>show variables like &#39;character%&#39;;</code>查看编码格式,若没有修改,则使用命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">SET character_set_client</span> = utf8;</span><br></pre></td></tr></table></figure>

<p>等等类似命令修改对应编码格式.这样大概问题就得以解决了.</p>
]]></content>
  </entry>
  <entry>
    <title>mysql的备份与恢复</title>
    <url>/2015/12/03/1277/</url>
    <content><![CDATA[<p>1.用命令实现备份</p>
<p>数据库备份是很重要的.如果定期做好备份,这样就可以在发生系统崩溃时恢复数据到最后一次正常的状态,把损失减小到最少.MySQLl提供了一个mysqldump命令,我们可以用它进行数据备份,下面假设要备份tm这个数据库:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$mysqldump</span> -u root -p tm &gt; tm_050519.sql</span></span><br></pre></td></tr></table></figure>

<p>按提示输入密码,这就把tm数据库所有的表结构和数据备份到tm_050519.sql了,因为要总进行备份工作,如果数据量大会占用很大空间,这时可以利用gzip压缩数据,命令如下:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$mysqldump</span> -u root -p tm | gzip &gt; tm_050519.sql.gz</span></span><br></pre></td></tr></table></figure>

<p>系统崩溃,重建系统时,可以这样恢复数据:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$mysql</span> -u root -p tm &lt; tm_050519.sql</span></span><br></pre></td></tr></table></figure>

<p>从压缩文件直接恢复:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$gzip</span> &lt; tm_050519.sql.gz | mysql -u root -p tm</span></span><br></pre></td></tr></table></figure>

<p>当然,有很多MySQL工具提供更直观的备份恢复功能,比如用phpMyAdmin就很方便.但我认为,mysqldump是最基本、最通用的.</p>
<p>2.利用crontab,系统每天定时备份mysql数据库</p>
<p>利用系统crontab来定时执行备份文件,按日期对备份结果进行保存,达到备份的目的.</p>
<p>1、创建保存备份文件的路径/mysqldata</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$mkdir</span> /mysqldata</span></span><br></pre></td></tr></table></figure>

<p>2、创建/usr/sbin/bakmysql文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/usr/</span>sbin/bakmysql</span><br></pre></td></tr></table></figure>

<p>输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rq=` date +%Y%m%d `</span><br><span class="line">tar zcvf <span class="regexp">/mysqldata/my</span>sql<span class="variable">$rq</span>.tar.gz <span class="regexp">/var/</span>lib/mysql</span><br></pre></td></tr></table></figure>

<p>或者写成:</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">rq=` date +<span class="meta">%Y</span><span class="meta">%m</span><span class="meta">%d</span> `</span><br><span class="line">mysqldump --all-databases -u<span class="built_in"> root</span> -p密码 &gt; /mysqldata/mysql<span class="variable">$rq</span>.sql</span><br></pre></td></tr></table></figure>

<p><code>/var/lib/mysql</code>是你数据库文件的目录,部分用户是 <code>/usr/local/mysql/data</code>,每个人可能不同,<code>/mysqldata/</code>表示保存备份文件的目录,这个每个人也可以根据自己的要求来做.</p>
<p>3、修改文件属性,使其可执行</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ chmod +x <span class="regexp">/usr/</span>sbin/bakmysql</span><br></pre></td></tr></table></figure>

<p>4、修改 <code>/etc/crontab</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vi</span> <span class="regexp">/etc/</span>crontab</span><br></pre></td></tr></table></figure>

<p>在下面添加:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">01 </span><span class="number">3</span> * * * root /<span class="keyword">usr</span>/sbin/bakmysql</span><br></pre></td></tr></table></figure>

<p>表示每天3点钟执行备份.</p>
<p>5、重新启动crond</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>crond restart</span><br></pre></td></tr></table></figure>

<p>完成.<br>这样每天你在 <code>/mysqldata</code>可以看到这样的文件:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">mysql<span class="number">20040619</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>你直接下载就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>Mysql的编译安装</title>
    <url>/2015/09/09/1278/</url>
    <content><![CDATA[<p>mysql5.1.38源码编译过程如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>sbin/groupadd mysql</span><br><span class="line"><span class="regexp">/usr/</span>sbin/useradd -g mysql mysql</span><br><span class="line">unzip mysql-<span class="number">5.1</span>.<span class="number">38</span>.zip</span><br><span class="line">cd mysql-<span class="number">5.1</span>.<span class="number">38</span>/</span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>webserver<span class="regexp">/mysql/</span> --enable-assembler --with-extra-charsets=complex --enable-thread-safe-client --with-big-tables --with-readline --with-ssl --with-embedded-server --enable-local-infile --with-plugins=innobase</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">chmod +w <span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql</span><br><span class="line">chown -R mysql:mysql <span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql</span><br><span class="line">cp support-files<span class="regexp">/my-medium.cnf /u</span>sr<span class="regexp">/local/</span>webserver<span class="regexp">/mysql/my</span>.cnf</span><br><span class="line"><span class="comment">#这部可依具体环境而定,压力大的化可采用huge.cnf</span></span><br></pre></td></tr></table></figure>

<p>以mysql用户帐号的身份建立数据表(初始化):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql<span class="regexp">/bin/my</span>sql_install_db --basedir=<span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql --datadir=<span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql/data --user=mysql</span><br></pre></td></tr></table></figure>

<p>启动MySQL(最后的&amp;表示在后台运行):</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/bin/</span>sh <span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql<span class="regexp">/bin/my</span>sqld_safe --defaults-<span class="keyword">file</span>=<span class="regexp">/usr/</span>local<span class="regexp">/webserver/my</span>sql/my.cnf &amp;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql读写分开Amoeba3.x的实现</title>
    <url>/2017/03/01/1279/</url>
    <content><![CDATA[<!--markdown-->**安装amoeba**

<p>下载amoeba(1.2.0-GA)后解压到本地(/usr/local/amoeba),即完成安装</p>
<p><strong>配置amoeba</strong></p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">ls</span><br><span class="line">access_list.conf amoeba.<span class="keyword">xml</span> <span class="title">dbServers</span>.<span class="keyword">xml</span> <span class="title">functionMap</span>.<span class="keyword">xml</span> <span class="title">log4j</span>.<span class="keyword">xml</span> <span class="title">ruleFunctionMap</span>.<span class="keyword">xml</span> <span class="title">amoeba</span>.dtd dbserver.dtd function.dtd log4j.dtd <span class="keyword">rule</span>.dtd <span class="keyword">rule</span>.xml</span><br></pre></td></tr></table></figure>

<p>在这里我主要介绍配置 amoeba.xml、dbServers.xml、log4j.xml 三个主要的配置文件,其它文件没有特殊需要默认就可以了.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">vi access_list.conf <span class="comment">#修改允许访问列表</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.152</span>.*:yes</span><br><span class="line">vi amoeba.xml <span class="comment">#修改主配置文件</span></span><br><span class="line"><span class="comment">#把默认端口8066改成3306;前提是你的数据库与amoeba安装的机器不在同一个机器上</span></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;port&quot;</span>&gt;<span class="number">3066</span>&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"><span class="comment">#把默认连接用户名和密码改成自己的</span></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;user&quot;</span>&gt;root&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;password&quot;</span>&gt;<span class="number">123456</span>&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"><span class="comment">#把默认的代理服务器客户端进程线程大小数改成300</span></span><br><span class="line">&lt;!<span class="comment">-- proxy server client process thread size --&gt;</span></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;executeThreadSize&quot;</span>&gt;<span class="number">300</span>&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line"><span class="comment">#把默认注释掉的读写分离选项,把注释去掉并readpool修改成server2</span></span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;writePool&quot;</span>&gt;server1&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;readPool&quot;</span>&gt;server2&lt;/<span class="keyword">property</span>&gt;</span><br></pre></td></tr></table></figure>

<p>增加SEVER2模块,里面的连接用户名密码及地址都表示两台MYSQL的物理机器,192.168.1.11和192.168.1.13 另SERVER1是写,SERVER是读.<br>需要手动增加SERVER2代码,最终改变成如下:</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml">vi dbServers.xml</span></span><br><span class="line"><span class="xml">&lt; xml version=&quot;1.0&quot; encoding=&quot;gbk&quot; &gt;</span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">amoeba</span>:dbServers <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;dbserver.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">amoeba:dbServers</span> <span class="attr">xmlns:amoeba</span>=<span class="string">&quot;;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">&lt;!--</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">Each dbServer needs to be configured into a Pool,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">If you need to configure multiple dbServer with load balancing that can be simplified by the following configuration:</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">add attribute with name virtual = &quot;</span><span class="attr">true</span>&quot; <span class="attr">in</span> <span class="attr">dbServer</span>, <span class="attr">but</span> <span class="attr">the</span> <span class="attr">configuration</span> <span class="attr">does</span> <span class="attr">not</span> <span class="attr">allow</span> <span class="attr">the</span> <span class="attr">element</span> <span class="attr">with</span> <span class="attr">name</span> <span class="attr">factoryConfig</span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="attr">such</span> <span class="attr">as</span> &#x27;<span class="attr">multiPool</span>&#x27; <span class="attr">dbServer</span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="attr">--</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">&quot;abstractServer&quot;</span> <span class="attr">abstractive</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">factoryConfig</span> <span class="attr">class</span>=<span class="string">&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;manager&quot;</span>&gt;</span>$</span><span class="template-variable">&#123;defaultManager&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sendBufferSize&quot;</span>&gt;</span>64<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;receiveBufferSize&quot;</span>&gt;</span>128<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql port --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql schema --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schema&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql user --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql password --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">poolConfig</span> <span class="attr">class</span>=<span class="string">&quot;co.poolable.PoolableObjectPool&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span>&gt;</span>500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span>&gt;</span>500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minEvictableIdleTimeMillis&quot;</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testWhileIdle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">poolConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">&quot;server1&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;abstractServer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">factoryConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql ip --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ipAddress&quot;</span>&gt;</span>192.168.2.11<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">&quot;server2&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;abstractServer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">factoryConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- mysql ip --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ipAddress&quot;</span>&gt;</span>192.168.2.13<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">&quot;multiPool&quot;</span> <span class="attr">virtual</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">poolConfig</span> <span class="attr">class</span>=<span class="string">&quot;com.meidusa.amoeba.server.MultipleServerPool&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- Load balancing strategy: 1=ROUNDROBIN , 2=WEIGHTBASED , 3=HA--&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;loadbalance&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- Separated by commas,such as: server1,server2,server1 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolNames&quot;</span>&gt;</span>server1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">poolConfig</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">amoeba:dbServers</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>修改log4j.xml 取消日志文件生成(太大了,磁盘很容易满;)<br>暂时还不清楚如何进行修改.</p>
<p><strong>性能优化</strong></p>
<p>打开bin/amoeba(window下可用)</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEFAULT_OPTS</span>=<span class="string">&quot;-server -Xms256m -Xmx256m -Xss128k&quot;</span></span><br></pre></td></tr></table></figure>

<p>改成</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEFAULT_OPTS</span>=<span class="string">&quot;-server -Xms512m -Xmx512m -Xmn100m -Xss1204k&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>设置压力比</strong></p>
<p>大家可能会想到,我们加入只有两台数据库服务器,一台主,一台从,按照上面的配置只能是主和从的读取比率是1:1,而写又全部在主上进行,这样主的压力就很大了,所以如果能让主和从的读设置权重,比如设置成1:3,这样就可以很好的解决主从不压力均衡的问题!通过研究确实可以!<br>配置就是将上面的读的池的配置更改一下:</p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">property</span><span class="string"> name</span>=<span class="string">&quot;poolNames&quot;</span>&gt;server1,server2&lt;/<span class="keyword">property</span><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>

<p>更改成</p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">property</span><span class="string"> name</span>=<span class="string">&quot;poolNames&quot;</span>&gt;server1,server2,server2,server2&lt;/<span class="keyword">property</span><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>启动amoeba</strong></p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#(<span class="number">1.2</span>的`nohup <span class="regexp">/usr/</span>local<span class="regexp">/amoeba/</span>bin<span class="regexp">/amoeba start 2&gt;&amp;1 &gt;/</span>dev/<span class="keyword">null</span>`)</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/amoeba/</span>bin/launcher</span><br><span class="line">log4j:WARN log4j config load completed <span class="keyword">from</span> <span class="keyword">file</span>:D:openSourceamoeba-mysql-<span class="number">1.2</span>.<span class="number">0</span>-GAconflog4j.xml</span><br><span class="line">log4j:WARN ip access config load completed <span class="keyword">from</span> <span class="keyword">file</span>:D:openSourceamoeba-mysql-<span class="number">1.2</span>.<span class="number">0</span>-GA<span class="regexp">/conf/</span>access_list.conf</span><br><span class="line"><span class="number">2010</span>-<span class="number">07</span>-<span class="number">03</span> <span class="number">09</span>:<span class="number">55</span>:<span class="number">33</span>,<span class="number">821</span> INFO net.ServerableConnectionManager - Server listening on <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8066</span>.</span><br></pre></td></tr></table></figure>

<p>设置mysql主从服务器的允许访问的用户和地址</p>
<p>三.client端调用与测试</p>
<p>1)在装有mysql客户端的机器上使用:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -uroot -p<span class="number">123456</span> -P<span class="number">3306</span> -h<span class="number">192.168.152.146</span></span><br></pre></td></tr></table></figure>

<p>参数分别是amoeba的用户名、密码、端口号和所做主机的地址.</p>
<p>2)调用与测试</p>
<p>首先插入一条数据:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> zone_by_id(id,<span class="type">name</span>) <span class="keyword">values</span>(<span class="number">20003</span>,<span class="string">&#x27;name_20003&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>通过查看master机上的日志 <code>/var/lib/mysql/mysql_log.log</code>:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">100703 </span><span class="number">11</span>:<span class="number">58</span>:<span class="number">42</span> <span class="number">1</span> Query set names latin1</span><br><span class="line"><span class="symbol">1 </span>Query SET NAMES latin1</span><br><span class="line"><span class="symbol">1 </span>Query SET character_set_results = NULL</span><br><span class="line"><span class="symbol">1 </span>Query SHOW VARIABLES</span><br><span class="line"><span class="symbol">1 </span>Query SHOW COLLATION</span><br><span class="line"><span class="symbol">1 </span>Query SET autocommit=<span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span>Query SET sql_mode=<span class="comment">&#x27;STRICT_TRANS_TABLES&#x27;</span></span><br><span class="line"><span class="symbol">1 </span>Query SHOW VARIABLES LIKE <span class="comment">&#x27;tx_isolation&#x27;</span></span><br><span class="line"><span class="symbol">1 </span>Query SHOW FULL TABLES FROM `amoeba_study` LIKE <span class="comment">&#x27;PROBABLYNOT&#x27;</span></span><br><span class="line"><span class="symbol">1 </span>Prepare [<span class="number">1</span>] insert into zone_by_id(id,<span class="keyword">name</span>) values( , )</span><br><span class="line"><span class="symbol">1 </span>Prepare [<span class="number">2</span>] insert into zone_by_id(id,<span class="keyword">name</span>) values( , )</span><br><span class="line"><span class="symbol">1 </span>Execute [<span class="number">2</span>] insert into zone_by_id(id,<span class="keyword">name</span>) values(<span class="number">20003</span>,<span class="comment">&#x27;name_20003&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>得知写操作发生在master机上<br>通过查看slave机上的日志 <code>/var/lib/mysql/mysql_log.log</code>:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">100703 </span><span class="number">11</span>:<span class="number">58</span>:<span class="number">42</span> <span class="number">2</span> Query insert into zone_by_id(id,<span class="keyword">name</span>) values(<span class="number">20003</span>,<span class="comment">&#x27;name_20003&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>得知slave同步执行了这条语句.<br>然后查一条数据:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">select t.<span class="built_in">name</span> <span class="keyword">from</span> zone_by_id t <span class="keyword">where</span> t.<span class="built_in">id</span> = <span class="number">20003</span></span><br></pre></td></tr></table></figure>

<p>通过查看slave机上的日志 <code>/var/lib/mysql/mysql_log.log</code>:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">100703 </span><span class="number">12</span>:<span class="number">02</span>:<span class="number">00</span> <span class="number">33</span> Query set names latin1</span><br><span class="line"><span class="symbol">33 </span>Prepare [<span class="number">1</span>] select t.<span class="keyword">name</span> from zone_by_id t where t.id =</span><br><span class="line"><span class="symbol">33 </span>Prepare [<span class="number">2</span>] select t.<span class="keyword">name</span> from zone_by_id t where t.id =</span><br><span class="line"><span class="symbol">33 </span>Execute [<span class="number">2</span>] select t.<span class="keyword">name</span> from zone_by_id t where t.id = <span class="number">20003</span></span><br></pre></td></tr></table></figure>

<p>得知读操作发生在slave机上.<br>并且通过查看slave机上的日志 <code>/var/lib/mysql/mysql_log.log</code>发现这条语句没在master上执行<br>通过以上验证得知简单的master-slave搭建和实战得以生效.</p>
<p>注意事项</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">Amoeba不支持事务</span><br><span class="line">Amoeba不支持跨库join和排序</span><br><span class="line">Insert语句必须指定表的列名</span><br><span class="line">Amoeba不支持分库分表.</span><br><span class="line">Amoeba不支持分库分表,只能分MySQL实例.</span><br><span class="line">Amoeba不支持大数据量的查询.</span><br><span class="line">Amoeba需要更严格的SQL语句规范</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Mysql管理员密码的初始化</title>
    <url>/2015/12/29/1280/</url>
    <content><![CDATA[<p>1,杀掉正在运行中的mysql</p>
<p>2,依版本不同可能该脚本名称不同</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>safe_mysqld --skip-grant-tables &amp;(较老版本)</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/my</span>sqld_safe --skip-grant-tables &amp;(较新版本)</span><br></pre></td></tr></table></figure>

<p>3,用空密码登录mysql</p>
<p>4,修改root用户密码</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&gt;use mysql</span><br><span class="line">&gt;<span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="keyword">password</span>(&quot;new_pass&quot;) <span class="keyword">where</span> <span class="keyword">user</span>=&quot;root&quot;;</span><br><span class="line">&gt;flush <span class="keyword">privileges</span>;</span><br><span class="line">&gt;quit</span><br></pre></td></tr></table></figure>

<p>杀掉mysql,重启,搞定!</p>
]]></content>
  </entry>
  <entry>
    <title>mysql慢查询</title>
    <url>/2014/01/02/1281/</url>
    <content><![CDATA[<p>mysql服务器有一项功能,可以检测到哪条sql语句查询得比较慢,就是慢查询slowlog,现在介绍如何开启.<br>在[mysqld]下面增加如下代码:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">long_query_time = <span class="number">1</span></span><br><span class="line"><span class="built_in">log</span>-slow-queries = /usr/<span class="built_in">local</span>/mysql/data/slow.<span class="built_in">log</span></span><br><span class="line"><span class="built_in">log</span>-queries-<span class="keyword">not</span>-<span class="keyword">using</span>-indexes</span><br><span class="line"></span><br><span class="line">long_query_time = <span class="number">1</span> <span class="comment">#定义超过1秒的查询计数到变量Slow_queries.</span></span><br><span class="line"><span class="built_in">log</span>-slow-queries = /usr/<span class="built_in">local</span>/mysql/data/slow.<span class="built_in">log</span> <span class="comment">#定义慢查询日志路径.</span></span><br><span class="line"><span class="built_in">log</span>-queries-<span class="keyword">not</span>-<span class="keyword">using</span>-indexes <span class="comment">#未使用索引的查询也被记录到慢查询日志中(可选).</span></span><br></pre></td></tr></table></figure>

<p>mysql自带了一个查看慢日志的工具mysqldumpslow.<br>执行mysqldumpslow –h可以查看帮助信息.<br>主要介绍两个参数-s和-t:</p>
<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line"><span class="literal">-s 这个是排序参数,可选的有:</span></span><br><span class="line"><span class="literal">-t n 显示头n条记录.</span></span><br><span class="line"><span class="attribute">al</span>: 平均锁定时间</span><br><span class="line"><span class="attribute">ar</span>: 平均返回记录数</span><br><span class="line"><span class="attribute">at</span>: 平均查询时间</span><br><span class="line"><span class="attribute">c</span>: 计数</span><br><span class="line"><span class="attribute">l</span>: 锁定时间</span><br><span class="line"><span class="attribute">r</span>: 返回记录</span><br><span class="line"><span class="attribute">t</span>: 查询时间</span><br></pre></td></tr></table></figure>

<p>实例:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -s c -t <span class="number">20</span> host-slow.<span class="built_in">log</span></span><br><span class="line">mysqldumpslow -s r -t <span class="number">20</span> host-slow.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>上述命令可以看出访问次数最多的20个sql语句和返回记录集最多的20个sql.</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">mysqldumpslow -<span class="built_in">t</span> <span class="number">10</span> -s <span class="built_in">t</span> -g <span class="string">&quot;left join&quot;</span> host-slow.log</span><br></pre></td></tr></table></figure>

<p>这个是按照时间返回前10条里面含有左连接的sql语句.<br>用了这个工具就可以查询出来那些sql语句是性能的瓶颈,进行优化,比如加索引,该应用的实现方式等.</p>
]]></content>
  </entry>
  <entry>
    <title>mysql命令</title>
    <url>/2015/03/30/1282/</url>
    <content><![CDATA[<p>一、连接MYSQL.</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line">格式: <span class="selector-tag">mysql</span> <span class="selector-tag">-h</span>主机地址 <span class="selector-tag">-u</span>用户名 －<span class="selector-tag">p</span>用户密码</span><br></pre></td></tr></table></figure>

<p>1、连接到本机上的MYSQL.</p>
<p>首先打开DOS窗口,然后进入目录mysqlbin,再键入命令mysql -u root -p,回车后提示你输密码.注意用户名前可以有空格也可以没有空格,但是密码前必须没有空格,否则让你重新输入密码.<br>如果刚安装好MYSQL,超级用户root是没有密码的,故直接回车即可进入到MYSQL中了,MYSQL的提示符是: mysql&gt;</p>
<p>2、连接到远程主机上的MYSQL.假设远程主机的IP为:110.110.110.110,用户名为root,密码为abcd123.则键入以下命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -h<span class="number">110.110.110.110</span> -u root -p <span class="number">123</span>;(注:u与root之间可以不用加空格,其它也一样)</span><br></pre></td></tr></table></figure>

<p>3、退出MYSQL命令: exit (回车)</p>
<p>二、修改密码.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">格式<span class="symbol">:mysqladmin</span> -u用户名 -p旧密码 password 新密码</span><br></pre></td></tr></table></figure>

<p>1、给root加个密码ab12.首先在DOS下进入目录mysqlbin,然后键入以下命令</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u root -password ab<span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>注:因为开始时root没有密码,所以-p旧密码一项就可以省略了.</p>
<p>2、再将root的密码改为djg345.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u root -p ab<span class="number">12</span> password djg<span class="number">345</span></span><br></pre></td></tr></table></figure>

<p>三、增加新用户.</p>
<p>(注意:和上面不同,下面的因为是MYSQL环境中的命令,所以后面都带一个分号作为命令结束符)</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">格式:<span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> 数据库.* <span class="keyword">to</span> 用户名@登录主机 identified <span class="keyword">by</span> &quot;密码&quot;</span><br></pre></td></tr></table></figure>

<p>1、增加一个用户test1密码为abc,让他可以在任何主机上登录,并对所有数据库有查询、插入、修改、删除的权限.首先用root用户连入MYSQL,然后键入以下命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> [email=test1@&quot;%]test1@&quot;%[/email]&quot; Identified by &quot;abc&quot;;</span><br></pre></td></tr></table></figure>

<p>但增加的用户是十分危险的,你想如某个人知道test1的密码,那么他就可以在internet上的任何一台电脑上登录你的mysql数据库并对你的数据可以为所欲为了,解决办法见2.</p>
<p>2、增加一个用户test2密码为abc,让他只可以在localhost上登录,并可以对数据库mydb进行查询、插入、修改、删除的操作(localhost指本地主机,即MYSQL数据库所在的那台主机),<br>这样用户即使用知道test2的密码,他也无法从internet上直接访问数据库,只能通过MYSQL主机上的web页来访问了.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> mydb.* <span class="keyword">to</span> [email=test2@localhost]test2@localhost[/email] identified <span class="keyword">by</span> &quot;abc&quot;;</span><br></pre></td></tr></table></figure>

<p>如果你不想test2有密码,可以再打一个命令将密码消掉.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> mydb.* <span class="keyword">to</span> [email=test2@localhost]test2@localhost[/email] identified <span class="keyword">by</span> &quot;&quot;;</span><br></pre></td></tr></table></figure>

<p>下篇我是MYSQL中有关数据库方面的操作.注意:你必须首先登录到MYSQL中,以下操作都是在MYSQL的提示符下进行的,而且每个命令以分号结束.</p>
<p>一、操作技巧</p>
<p>1、如果你打命令时,回车后发现忘记加分号,你无须重打一遍命令,只要打个分号回车就可以了.<br>也就是说你可以把一个完整的命令分成几行来打,完后用分号作结束标志就OK.</p>
<p>2、你可以使用光标上下键调出以前的命令.</p>
<p>二、显示命令</p>
<p>1、显示当前数据库服务器中的数据库列表:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>注意:mysql库里面有MYSQL的系统信息,我们改密码和新增用户,实际上就是用这个库进行操作.</p>
<p>2、显示数据库中的数据表:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt; USE 库名<span class="comment">;</span></span><br><span class="line">mysql&gt; SHOW TABLES<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>3、显示数据表的结构:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt; DESCRIBE 表名<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>4、建立数据库:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> 库名;</span><br></pre></td></tr></table></figure>

<p>5、建立数据表:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> USE 库名;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名 (字段名 <span class="type">VARCHAR</span>(<span class="number">20</span>), 字段名 <span class="type">CHAR</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<p>6、删除数据库:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">DROP</span> <span class="keyword">DATABASE</span> 库名;</span><br></pre></td></tr></table></figure>

<p>7、删除数据表:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure>

<p>8、将表中记录清空:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<p>9、显示表中的记录:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<p>10、往表中插入记录:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span> (&quot;hyq&quot;,&quot;M&quot;);</span><br></pre></td></tr></table></figure>

<p>11、更新表中数据:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql-&gt; UPDATE 表名 <span class="builtin-name">SET</span> 字段名<span class="attribute">1</span>=<span class="string">&#x27;a&#x27;</span>,字段名2=&#x27;b&#x27; WHERE 字段名<span class="attribute">3</span>=<span class="string">&#x27;c&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>12、用文本方式将数据装入数据表中:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">LOAD</span> DATA <span class="keyword">LOCAL</span> INFILE &quot;D:/mysql.txt&quot; <span class="keyword">INTO</span> <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure>

<p>13、导入.sql文件命令:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> USE 数据库名;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SOURCE d:/mysql.sql;</span></span><br></pre></td></tr></table></figure>

<p>14、命令行修改root密码:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">UPDATE</span> mysql.<span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">password</span>=<span class="keyword">PASSWORD</span>(<span class="string">&#x27;新密码&#x27;</span>) <span class="keyword">WHERE</span> <span class="keyword">User</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>

<p>15、显示use的数据库名:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();</span><br></pre></td></tr></table></figure>

<p>16、显示当前的user:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br></pre></td></tr></table></figure>

<p>三、一个建库和建表以及插入数据的实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> school; <span class="operator">/</span><span class="operator">/</span>如果存在SCHOOL则删除</span><br><span class="line"><span class="keyword">create</span> database school; <span class="operator">/</span><span class="operator">/</span>建立库SCHOOL</span><br><span class="line">use school; <span class="operator">/</span><span class="operator">/</span>打开库SCHOOL</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher <span class="operator">/</span><span class="operator">/</span>建立表TEACHER</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span>(<span class="number">3</span>) auto_increment <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    address <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">default</span> <span class="string">&#x27;深圳&#x27;</span>,</span><br><span class="line">    <span class="keyword">year</span> <span class="type">date</span></span><br><span class="line">); <span class="operator">/</span><span class="operator">/</span>建表结束</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>以下为插入字段</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(&quot;,&#x27;allen&#x27;,&#x27;大连一中&#x27;,&#x27;1976-10-10&#x27;);</span><br><span class="line">insert into teacher values(&quot;,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;大连二中&#x27;</span>,<span class="string">&#x27;1975-12-23&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如果你在mysql提示符键入上面的命令也可以,但不方便调试.</p>
<p>(1)你可以将以上命令原样写入一个文本文件中,假设为school.sql,然后复制到c:下,并在DOS状态进入目录 <code>[url=file://mysqlbin]mysqlbin[/url]</code>,然后键入以下命令:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">mysql -uroot -<span class="selector-tag">p</span>密码 &lt; c:school.sql</span><br></pre></td></tr></table></figure>

<p>如果成功,空出一行无任何显示;如有错误,会有提示.(以上命令已经调试,你只要将//的注释去掉即可使用).</p>
<p>(2)或者进入命令行后使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">source</span> c:/school.sql;</span> </span><br></pre></td></tr></table></figure>

<p>也可以将school.sql文件导入数据库中.</p>
<p>四、将文本数据转到数据库中</p>
<p>1、文本数据应符合的格式:字段数据之间用tab键隔开,null值用[url=file://n]n[/url]来代替.例:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">3 </span>rose 大连二中 <span class="number">1976</span>-<span class="number">10</span>-<span class="number">10</span></span><br><span class="line"><span class="symbol">4 </span>mike 大连一中 <span class="number">1975</span>-<span class="number">12</span>-<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>假设你把这两组数据存为school.txt文件,放在c盘根目录下.</p>
<p>2、数据传入命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">load</span> data <span class="keyword">local</span> infile &quot;c:/school.txt&quot; <span class="keyword">into</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>

<p>注意:你最好将文件复制到 <code>[url=file://mysqlbin]mysqlbin[/url]</code>目录下,并且要先用use命令打表所在的库.</p>
<p>五、备份数据库:(命令在DOS的 <code>[url=file://mysqlbin]mysqlbin[/url]</code>目录下执行)</p>
<p>1.导出整个数据库</p>
<p>导出文件默认是存在mysqlbin目录下</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqldump</span> -u 用户名 -p 数据库名 &gt; 导出的文件名</span><br><span class="line"><span class="attribute">mysqldump</span> -u user_name -p<span class="number">123456</span> database_name &gt; outfile_name.sql</span><br></pre></td></tr></table></figure>

<p>2.导出一个表</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">mysqldump -u 用户名 -<span class="selector-tag">p</span> 数据库名 表名&gt; 导出的文件名</span><br><span class="line">mysqldump -u user_name -<span class="selector-tag">p</span> database_name table_name &gt; outfile_name<span class="selector-class">.sql</span></span><br></pre></td></tr></table></figure>

<p>3.导出一个数据库结构</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysqldump -u user_name -p -d –<span class="keyword">add</span>-<span class="keyword">drop</span>-<span class="keyword">table</span> database_name &gt; outfile_name.<span class="keyword">sql</span></span><br><span class="line">-d 没有数据 –<span class="keyword">add</span>-<span class="keyword">drop</span>-<span class="keyword">table</span> 在每个<span class="keyword">create</span>语句之前增加一个<span class="keyword">drop</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<p>4.带语言参数导出</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">mysqldump</span> -<span class="string">uroot</span> -<span class="string">p</span> –<span class="string">default-character-set</span>=<span class="string">latin1</span> –<span class="built_in">set-charset=gbk</span> –<span class="string">skip-opt</span> <span class="string">database_name</span> &gt; <span class="string">outfile_name</span>.<span class="string">sql</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySQL默认密码和修改密码</title>
    <url>/2020/07/07/1283/</url>
    <content><![CDATA[<p>在MySQL服务启动后，默认的密码被保存在错误日志文件中，可以通过以下命令查看：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">shell&gt; sudo grep <span class="string">&#x27;temporary password&#x27;</span> /var/<span class="keyword">log</span>/mysqld.<span class="keyword">log</span></span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span>T10:<span class="number">15</span>:<span class="number">57.448920</span>Z <span class="number">5</span> [Note] [MY<span class="number">-010454</span>] [<span class="keyword">Server</span>] A <span class="keyword">temporary</span> <span class="keyword">password</span> <span class="keyword">is</span> <span class="keyword">generated</span> <span class="keyword">for</span> root@localhost: <span class="number">0</span>xxXxxXx?xXX</span><br></pre></td></tr></table></figure>

<p>通过默认密码登录MySQL服务器，并马上修改密码(强烈建议)！！！。<br>用默认密码(0xxXxxXx?xXX)登录：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">shell&gt; mysql -uroot -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>修改密码：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;*&#123;your-password&#125;*&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>退出MySQL并用新密码重新登录，然后就可以在MySQL中尽情发挥想象了。</p>
]]></content>
  </entry>
  <entry>
    <title>mysql启用innodb</title>
    <url>/2014/12/12/1285/</url>
    <content><![CDATA[<p>mysql 5.1默认只启用MyISAM, 使用INNODB要做一下修改:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section">=== InnoDB Storage Engine ===</span></span><br><span class="line">Plugin Name: innobase</span><br><span class="line">Description: Transactional Tables using InnoDB</span><br><span class="line">Supports build: static and dynamic</span><br><span class="line">Configurations: max, max-no-ndb</span><br></pre></td></tr></table></figure>

<p>mysql 5.1版本之后,要使用innodb有两种方法</p>
<p>(1).静态编译的时候加入 –with-plugin-innobase<br>(2).动态扩展 启动mysqld后</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> INSTALL PLUGIN innodb SONAME <span class="string">&#x27;ha_innodb.so&#x27;</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show plugin</span></span><br></pre></td></tr></table></figure>

<p>就可以看见了<br>动态的话plugin_dir要指定正确:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">plugin_dir=<span class="regexp">/path/</span>to<span class="regexp">/plugin/</span>directory</span><br></pre></td></tr></table></figure>

<p>最后,通过动态方式,解决了这个转换问题.</p>
<p>查看mysql 5.1 是否安装了innodb插件(mysql 5.0使用: show variables like ‘have_%’;)</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; show plugins;</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line">|<span class="string"> Name </span>|<span class="string"> Status </span>|<span class="string"> Type </span>|<span class="string"> Library </span>|<span class="string"> License </span>|</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line">|<span class="string"> binlog </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> CSV </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MEMORY </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MyISAM </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MRG_MYISAM </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|<span class="string"> </span>|</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>发现没有安装 INNODB,执行下面语句:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> install plugin innodb soname <span class="string">&#x27;ha_innodb.so&#x27;</span>;</span></span><br></pre></td></tr></table></figure>

<p>再次查看:</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; show plugins;</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line">|<span class="string"> Name </span>|<span class="string"> Status </span>|<span class="string"> Type </span>|<span class="string"> Library </span>|<span class="string"> License </span>|</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line">|<span class="string"> binlog </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> CSV </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MEMORY </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MyISAM </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> MRG_MYISAM </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> NULL </span>|<span class="string"> GPL </span>|</span><br><span class="line">|<span class="string"> InnoDB </span>|<span class="string"> ACTIVE </span>|<span class="string"> STORAGE ENGINE </span>|<span class="string"> ha_innodb.so </span>|<span class="string"> GPL </span>|</span><br><span class="line">+------------+--------+----------------+--------------+---------+</span><br><span class="line"></span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>查看表的类型:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">mysql&gt; use web_db<span class="comment">;</span></span><br><span class="line">mysql. show tablse<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>随便找个表看类型:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql. <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> sys_user;</span><br></pre></td></tr></table></figure>

<p>查看是否有以下字段:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ENGINE</span>=InnoDB <span class="attribute">AUTO_INCREMENT</span>=4<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure>

<p>如何将MyISAM库 导成 INNODB:<br>在备份出的 xxx.bak文件中 把 ENGINE=MyISAM 全换成 ENGINE=INNODB<br>再次导入就可以了.<br>转换表的命令:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> POD engine<span class="operator">=</span>innodb;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql配置文件</title>
    <url>/2013/12/07/1284/</url>
    <content><![CDATA[<p>MySQL发布的最新产品实际上超出了Red Hat Enterprise Linux所携带的版本.但是,稳定性和开放源代码可是很重要的因素,因此在操作系统上使用较早MySQL版本是有道理的.<br>有许多可以采用的配置文件,它们都被包含在mysql-server PRM程序中.还有一个默认的配置文件被包含在mysql PRM程序包中.<br>配置MySQL服务器是一个丰富而复杂的工作.在本文中,我只能肤浅的说一下各种选项.可以使用的MySQL配置文件共有５个.最后４个位于 <code>/usr/share/doc/mysql-server-*/</code>目录中.<br><code>/etc/my.cnf</code>是默认的MySQL配置文件.应该对这个文件配置修改.它是为学习目的而设计的.<br><code>/etc/my-small.cnf</code>是为了小型数据库而设计的.不应该把这个模型用于含有一些常用项目的数据库.<br><code>/etc/my-medium.cnf</code>是为中等规模的数据库而设计的.如果你正在企业中使用RHEL,可能会比这个操作系统的最小RAM需求(256MB)明显多得多的物理内存.由此可见,如果有那么多RAM内存可以使用,自然可以在同一台机器上运行其它服务.<br><code>/etc/my-large.cnf</code>是为专用于一个SQL数据库的计算机而设计的.由于它可以为该数据库使用多达512MB的内存,所以在这种类型的系统上将需要至少1GB的RAM,以便它能够同时处理操作系统与数据库应用程序.<br><code>/etc/my-huge.cnf</code>是为企业中的数据库而设计的.这样的数据库要求专用服务器和1GB或1GB以上的RAM.<br>这些选择高度依赖于内存的数量、计算机的运算速度、数据库的细节大小、访问数据库的用户数量以及在数据库中装入并访问数据的用户数量.随着数据库和用户的不断增加,数据库的性能可能会发生变化.<br>我将逐个的说明这些配置文件.如果用户决定使用my-*.cnf文件之一,将首先需要把这个文件复制到/etc/my.cnf文件上.<br>由于这些原因,用户应该仔细观察数据库系统的性能.如果发现问题,可能需要增加更多的RAM,或者把数据库迁移到一个含有附加资源(比如多个CPU)的系统上.<br>提示:数据库变得非常大.把一个SQL数据库目录配置在一个专用分区上可能更有道理.虽然一个不断增长的数据库可能会占满整个分区,但它至少不会吞掉RHEL运行所必需的磁盘空间.</p>
<p><code>/etc/my.cnf</code>文件</p>
<p>默认是/etc/my.cnf文件.它包含6条命令,并且这6条命令被组织在3个配置段中.这些配置段与Samba配置文件中的配置段相似,并且含有功能组名称和相关的命令.本文将逐行的说明这个文件的默认版本.如果用户进行了任何修改,将需要确保MySQL启动脚本(即/etc/rc.d/init.d/mysqld)中的命令一致.</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#在这个配置段之内,将会看到与MySQL守护进程相关的命令.</span></span><br><span class="line">datadir=/<span class="keyword">var</span>/lib/mysql</span><br><span class="line"><span class="meta">#MySQL服务器把数据库存储在由datadir变量所定义的目录中.</span></span><br><span class="line">Socket=/<span class="keyword">var</span>/lib/mysql/mysql.sock</span><br><span class="line"><span class="meta">#MySQL套接字把数据库程序局部的或通过网络连接到MySQL客户.</span></span><br><span class="line"><span class="meta">#提示:MySQL被配置成使用InnoDB存储器引擎.如果用户在自己的系统上还没有一个InnoDB数据库,将需要给[mysqld]配置段添加skip-innodb语句.</span></span><br><span class="line">[mysql.server]</span><br><span class="line"><span class="meta">#在这个配置段之内,将会看到MySQL服务器守护进程有关的命令.这个配置段的较早期版本被命名为[mysql_server].如果使用MySQL4.X或MySQL4.X以上版本,将必须把这个配置段标题改成[mysql_server].当启动MySQL服务时,它使用这个配置段中的选项.</span></span><br><span class="line">user=mysql</span><br><span class="line"><span class="meta">#与MySQL服务相关联的标准用户名是mysql.它应该是/etc/passwd文件的一部分;如果在这个文件中没有发现它,用户可能还没有安装Red Hat Enterprise Linux mysql-server RPM程序包.</span></span><br><span class="line">basedir=/<span class="keyword">var</span>/lib</span><br><span class="line"><span class="meta">#这表示MySQL数据库的顶级目录.它充当MySQL系统上的一个根目录;这个数据库中的其它目录都是相对于这个目录.</span></span><br><span class="line">[safe_mysqld]</span><br><span class="line"><span class="meta">#这个配置段包含MySQL启动脚本所引用的命令.如果使用MySQL4.X或4.X以上版本,必须把这个配置段改成[mysqld_safe].</span></span><br><span class="line">err-log=/<span class="keyword">var</span>/log/mysqld.log</span><br><span class="line"><span class="meta">#这是MySQL所关联的错误被发送到的这个文件.如果使用MySQL4.X或4.X以上版本,必须使用log-error指令替换这条命令.</span></span><br><span class="line">pid-file=/<span class="keyword">var</span>/run/mysqld/mysqld.pid</span><br><span class="line"><span class="meta">#最后,pid-file指令定义MySQL服务器在运作期间的进程标识符(PID).如果MySQL服务器当前没有运行,这个文件应该不存在.</span></span><br><span class="line"><span class="meta">#提示:用户可以配置与用户特定相关的MySQL配置文件;为此,只需给指定用户主目录中的.my.cnf隐含文件添加所选的配置命令即可.</span></span><br></pre></td></tr></table></figure>

<p><code>/etc/my-samll-cnf</code>文件<br>在本文中,将说明my-small-cnf配置文本中的所有命令.当回顾其它MySQL样本配置文件时,将参考本文所解释的各条命令和指令的含义.先从下面这个配置段开始分析该文件中的有效命令和指令:</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line">[<span class="string">client</span>]</span><br><span class="line"><span class="comment">#这个配置把指令传递给与MySQL服务器相关的客户.</span></span><br><span class="line"><span class="string">port</span>＝<span class="string">3306</span></span><br><span class="line"><span class="comment">#MySQL所相关的标准TCP/IP端口是3306.如果需要修改这个端口号(可以增强安全),必须确保用于MySQL客户与服务器的所有相应配置文件中均修改这个号.</span></span><br><span class="line"><span class="string">socket</span>=/<span class="string">var</span>/<span class="string">lib</span>/<span class="string">mysql</span>/<span class="string">mysql</span>.<span class="string">sock</span></span><br><span class="line"><span class="comment">#正像默认的/etc/my.cnf文件中所定义的那样,这是控制MySQL客户与服务器间通信的标准套接字文件.</span></span><br><span class="line">[<span class="string">mysqld</span>]</span><br><span class="line"><span class="comment">#当启动MySQL服务器时,它由[mysqld]配置段中所定义的命令来控制.</span></span><br><span class="line"><span class="string">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="string">socket</span>=/<span class="string">var</span>/<span class="string">lib</span>/<span class="string">mysql</span>/<span class="string">mysql</span>.<span class="string">sock</span></span><br><span class="line"><span class="comment">#当然,与同一个MySQL数据库相关的客户与服务器需要使用相同的TCP/IP端口和套接字.</span></span><br><span class="line"><span class="string">skip-locking</span></span><br><span class="line"><span class="comment">#多个客户可能会访问同一个数据库,因此这防止外部客户锁定MySQL服务器.这个skip-locking命令是MySQL4.X或4.X以上版本中的skip-external-locking命令.</span></span><br><span class="line"><span class="comment">#一般来说,如果正在使用MySQL4.X或4.X上以版本,这个set-variable指令没有必要带有这个列表中的这些命令.</span></span><br><span class="line"><span class="built_in">set-variable=key_buffer=16k</span></span><br><span class="line"><span class="comment">#这个缓冲区确实很小;如果一个数据库在一个文本文件中包含不止几百行数据,它将会超载这个缓冲区的容量.这个数据库可能不会超载一个文本文件地址簿的容量.如果这不只是一个供个人使用的数据库,这个限额很快就会被达到.假使那样的话,可能需要考虑与其它配置文件之一相关的那些限额.</span></span><br><span class="line"><span class="built_in">set-variable=max_allowed_packet=1M</span></span><br><span class="line"><span class="comment">#当然,与一个数据库相关的信息会增加到超出实际数据.在默认的情况下,如果该信息在一个服务器上超过1MB以上,MySQL将会产生一条错误信息.</span></span><br><span class="line"><span class="built_in">set-variable=thread_stack=64k</span></span><br><span class="line"><span class="comment">#这条指令限定用于每个数据库线程的栈大小.默认设置足以满足大多数应用.</span></span><br><span class="line"><span class="built_in">set-variable=table_cache=4</span></span><br><span class="line"><span class="comment">#用户可以限定一个数据库中打开表的数量;越小的限额(默认值是64)适合越小规模的数据库.</span></span><br><span class="line"><span class="built_in">set-variable=sort_buffer=64k</span></span><br><span class="line"><span class="comment">#在处理一个数据库时,用户可能需要内存中附加的缓冲区空间.</span></span><br><span class="line"><span class="built_in">set-variable=net_buffer_length=2k</span></span><br><span class="line"><span class="comment">#正如net_buffer_length指令所定义的,MySQL服务器还给传入的请求保留了空间.</span></span><br><span class="line"><span class="string">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#一般来说,如果有一个MySQL主服务器,应该把它的server-id设置成１;应该把MySQL从属服务器的server-id设置成２;</span></span><br><span class="line">[<span class="string">mysqldump</span>]</span><br><span class="line"><span class="comment">#用户可以在不同类型的SQL数据库之间传输数据,这由[mysqldump]配置段中的命令来控制.</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">quick</span>选项支持较大数据库的转储.</span><br><span class="line"><span class="built_in">set-variable=max_allowed_packet=16M</span></span><br><span class="line"><span class="comment">#当然,用来传输数据库表到其它数据库的max_allowed_packet大于客户与服务器之间的简单通信所使用的信息包.</span></span><br><span class="line">[<span class="string">mysql</span>]</span><br><span class="line"><span class="string">no-auto-rehash</span></span><br><span class="line"><span class="comment">#这个配置段设置启动MySQL服务的条件;在这种情况下,no-auto-rehash确保这个服务启动得比较快.</span></span><br><span class="line">[<span class="string">isamchk</span>]</span><br><span class="line">[<span class="string">myisamchk</span>]</span><br><span class="line"><span class="comment">#像SQL这样的关系数据库用所谓的Indexed Sequential Access Method(索引顺序存取方法,简称ISAM)来处理.这两个配置段中的命令是相同的;这些命令与检查并修复数据库表的同名命令有关.</span></span><br><span class="line"><span class="built_in">set-variable=key_buffer=8M</span></span><br><span class="line"><span class="built_in">set-variable=sort_buffer=8M</span></span><br><span class="line"><span class="comment">#在前面谈及MySQL服务器时,用户己经见过这些变量.它们在这里都比较大,以便支持数据库的较快速检查与修复.</span></span><br><span class="line">[<span class="string">mysqlhotcopy</span>]</span><br><span class="line"><span class="string">interactive-timeout</span></span><br><span class="line"><span class="comment">#正如[mysqlhotcopy]配置段所指定的,在一个数据库复制操作期间,连接会挂起.在默认情况下,interactive-timeout变量把一个数据传输的最大时间量设置为28800秒(8个小时).</span></span><br><span class="line"><span class="string">my-medium</span>.<span class="string">cnf</span>文件</span><br><span class="line"><span class="comment">#与中等数据库相关的MySQL配置文件含有和my-small-cnf配置文件中一样的有效配置段.在[mysqld]配置段中,下面这些命令支持较大规模的服务器数据库:</span></span><br><span class="line"><span class="built_in">set-variable=key_buffer=16M</span></span><br><span class="line"><span class="built_in">set-variable=table_cache=64</span></span><br><span class="line"><span class="built_in">set-variable=sort_buffer=512K</span></span><br><span class="line"><span class="built_in">set-variable=net_buffer_length=8K</span></span><br><span class="line"><span class="string">log-bin</span></span><br><span class="line"><span class="comment">#一般来说,这个配置段中的命令支持服务器上的较大高速缓存与缓冲区长度.应该看到两条新命令.</span></span><br><span class="line"><span class="built_in">set-variable=myisam_sort_buffer_size=8M</span></span><br><span class="line"><span class="string">log-bin</span></span><br><span class="line"><span class="string">myisam_sort_buffer_size</span>命令允许<span class="string">MySQL</span>索引数据库,第二条命令支持二进制日志记录方法.</span><br><span class="line">[<span class="string">isamchk</span>]</span><br><span class="line">[<span class="string">myisamchk</span>]</span><br><span class="line"><span class="comment">#当然,这两个配置段中的缓冲区比用于数据库传输的缓冲区大,这个文件包含下面这些命令;它们发送消息到服务器和接收来自服务器的消息.</span></span><br><span class="line"><span class="built_in">set-variable=read_buffer=2M</span></span><br><span class="line"><span class="built_in">set-variable=write_buffer=2M</span></span><br></pre></td></tr></table></figure>

<p><code>/etc/my-large.cnf</code>文件<br>与较大型数据库相关的MySQL配置文件含有和my-samll-cnf配置文件中一样的有效配置段.在本文中,将比较my-large-cnf与my-medium-cnf样本文件中的各条命令.在[mysqld]配置段中,下面这些命令支持较大型的服务器数据库:</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set-variable=key_buffer=256M</span></span><br><span class="line"><span class="built_in">set-variable=table_cache=256</span></span><br><span class="line"><span class="built_in">set-variable=sort_buffer=1M</span></span><br><span class="line"><span class="built_in">set-variable=myisam_sort_buffer_size=64M</span></span><br><span class="line"><span class="built_in">set-variable=net_buffer_length=8K</span></span><br><span class="line"><span class="comment">#这个配置段中有３条附加的命令.record_buffer命令保存对一个数据库中不同表的扫描结果.thread_cache命令对多请求有用;空闲线程被高速缓存起来,进而允许新的搜索操作采用己有的线程.只要这防止搜索操作启动新的服务器进程,这就能减轻系统上的负荷.</span></span><br><span class="line"><span class="built_in">set-variable=record_buffer=1M</span></span><br><span class="line"><span class="built_in">set-variable=thread_cache=8</span></span><br><span class="line"><span class="built_in">set-variable=thread_concurrency=8</span></span><br><span class="line"><span class="comment">#thread_concurrency变量限定同时运行的线程数量.my-large.cnf样本文件建议用户应该把这个数量限定于本计算机上CPU数量的两倍;这个特定设置相当于４个CPU.</span></span><br></pre></td></tr></table></figure>

<p><code>/etc/my-huge.cnf</code>文件<br><code>/etc/my-huge.cnf</code>文件含有和my-large.cnf配置文件中一样的命令.当然,分配给大多数指令的值比较大并适合较大型的数据库.</p>
<p>正如<a href="http://www.mysql.com站点上所描述的,拥有大量数据库的组织,比如:google、">www.mysql.com站点上所描述的,拥有大量数据库的组织,比如:google、</a> Sabre和NASA都采用MySQL.虽然我们猜测这些公司所使用的命令不同于用户在my-huge.cnf文件中所看到的命令,但这至少让用户对 MySQL企业级数据库有一个概念.</p>
]]></content>
  </entry>
  <entry>
    <title>mysql实现远程登录</title>
    <url>/2013/01/29/1287/</url>
    <content><![CDATA[<p>Mysql默认是不允许远程连接的,因为有很大的安全隐患.<br>需要手动增加可以远程访问数据库的用户.</p>
<p>方法一、本地登入mysql,更改 “mysql” 数据库里的 “user” 表里的 “host” 项,将”localhost”改为”%”.</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -proot</span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt;<span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host = <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt;<span class="keyword">select</span> host, <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>方法二、直接授权(推荐)</p>
<p>从任何主机上使用root用户,密码:youpassword(你的root密码)连接到mysql服务器:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -proot</span><br><span class="line">mysql&gt;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;youpassword&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<p>允许地址202.11.10.253上用root用户,密码dboomysql来连接mysql的所有数据库,付给select,insert,update,delete权限.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -proot</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@&quot;202.11.10.253&quot; Identified <span class="keyword">by</span> &quot;dboomysql&quot;;</span><br></pre></td></tr></table></figure>

<p>允许地址202.11.10.253上用root用户,密码dboomysql来连接mysql的所有数据库,付给所有权限.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ mysql -u root -proot</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@&quot;202.11.10.253&quot; Identified <span class="keyword">by</span> &quot;dboomysql&quot;</span><br></pre></td></tr></table></figure>

<p>重启Mysql服务后,这样就可用图形化数据库管理软件(Navicat MySQL是个不错的选择)远程访问Mysql.</p>
]]></content>
  </entry>
  <entry>
    <title>mysql权限添加</title>
    <url>/2012/08/31/1286/</url>
    <content><![CDATA[<p>说明:</p>
<p>有时候我们需要给某个用户可以登录mysql的权限,或者是修改某个用户的密码,就需要用到如下的命令.</p>
<p>用法:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;   (第一个*是databases  第二个*是<span class="keyword">table</span>)</span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (Host,<span class="keyword">User</span>,<span class="keyword">Password</span>) <span class="keyword">values</span>(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;yww&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">bin&gt;mysql -uroot -p123456</span><br><span class="line">mysql&gt; <span class="keyword">grant</span> 权限<span class="number">1</span>,权限<span class="number">2</span>,…权限n <span class="keyword">on</span> 数据库名称.表名称 <span class="keyword">to</span> 用户名@用户地址 identified <span class="keyword">by</span> <span class="string">&#x27;连接口令&#x27;</span>;</span><br><span class="line">* &quot;权限1,权限2,…权限n&quot;代表<span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span>,<span class="keyword">create</span>,<span class="keyword">drop</span>,<span class="keyword">index</span>,<span class="keyword">alter</span>,<span class="keyword">grant</span>,<span class="keyword">references</span>,reload,shutdown,process,file等<span class="number">14</span>个权限.</span><br><span class="line">* 当&quot;权限1,权限2,…权限n&quot;被&quot;all privileges&quot;或者&quot;all&quot;代替,表示赋予用户全部权限.</span><br><span class="line">* 当&quot;数据库名称.表名称&quot;被&quot;*.*&quot;代替,表示赋予用户操作服务器上所有数据库所有表的权限.</span><br><span class="line">* &quot;用户地址&quot;可以是localhost,也可以是ip地址、机器名字、域名.也可以用<span class="string">&#x27;%&#x27;</span>表示从任何地址连接.</span><br><span class="line">* &quot;连接口令&quot;不能为空,否则创建失败.</span><br></pre></td></tr></table></figure>

<p>实例:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span>,<span class="keyword">create</span>,<span class="keyword">drop</span> <span class="keyword">on</span> vtdc.employee <span class="keyword">to</span> joe@<span class="number">10.163</span><span class="number">.225</span><span class="number">.87</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>给来自10.163.225.87的用户joe分配可对数据库vtdc的employee表进行select,insert,update,delete,create,drop等操作的权限,并设定口令为123.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> vtdc.* <span class="keyword">to</span> joe@<span class="number">10.163</span><span class="number">.225</span><span class="number">.87</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>给来自10.163.225.87的用户joe分配可对数据库vtdc所有表进行所有操作的权限,并设定口令为123.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> joe@<span class="number">10.163</span><span class="number">.225</span><span class="number">.87</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>给来自10.163.225.87的用户joe分配可对所有数据库的所有表进行所有操作的权限,并设定口令为123.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> joe@localhost identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>给本机用户joe分配可对所有数据库的所有表进行所有操作的权限,并设定口令为123.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> dod_production.* <span class="keyword">to</span> epics@<span class="number">219.111</span><span class="number">.52</span><span class="number">.144</span> identified <span class="keyword">by</span> <span class="string">&#x27;KgDqET48&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>给ip地址为219.111.52.144的用户远程操作美国服务器上dod_production数据库的所有权限,并设定口令为KgDqET48.</p>
<p>电脑重启后,执行如下命令:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">/etc/init.d/mysql</span> stop</span><br><span class="line">mysqld_safe <span class="params">--user=mysql</span> <span class="params">--skip-grant-tables</span> <span class="params">--skip-networking</span> &amp;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql双向同步</title>
    <url>/2012/12/26/1289/</url>
    <content><![CDATA[<p>一．准备环境<br>Master:<br>Ip:192.168.211.128<br>Mysql版本:5.0.77(可以通过命令mysqladmin -uroot -p123 version查看)<br>Slave:<br>Ip:192.168.211.131<br>Mysql版本:5.0.77<br>二．设置同步<br>设置master同步</p>
<ol>
<li>修改my.cnf<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">添加内容如下:</span><br><span class="line"><span class="attribute">server-id</span>=1 (mysql标示)</span><br><span class="line"><span class="attribute">log-bin</span>=mysql-bin(开启log-bin二进制日志文件,默认存在/var/lib/mysql下日志文 件以mysql-bin为开头)</span><br><span class="line">binlog-do-db =backup(backup为需要同步的数据库名,如需同步多个数据库,可以另起行如binlog-do-db =backup1)</span><br><span class="line"><span class="comment"># binlog-ignore-db=db_name (不进行同步日志的数据库,不需要的话注释掉)</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">max-binlog-size</span>=104857600(日志的大小,超出会自动生成一个新的)</span><br><span class="line"><span class="attribute">master-host</span>=192.168.211.131(同步主机)</span><br><span class="line"><span class="attribute">master-user</span>=backup(同步用户)</span><br><span class="line"><span class="attribute">master-password</span>=123(同步用户密码)</span><br><span class="line"><span class="attribute">master-port</span>=3306</span><br><span class="line"><span class="attribute">replicate-do-db</span>=backup(同步数据库)</span><br></pre></td></tr></table></figure>
修改完后保存退出,并重启mysql 如:service mysqld restart (重启正常,表示配置没错误)</li>
<li>在作为master的mysql上建立一个账户专门用于slave来进行数据同步<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> backup@<span class="string">&#x27;192.168.211.131&#x27;</span>identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">mysql&gt;flush <span class="keyword">privileges</span>;</span><br><span class="line">Mysql&gt;<span class="keyword">create</span> <span class="keyword">database</span> backup;</span><br></pre></td></tr></table></figure>
在slave上测试账户backup是否可以访问mster上的mysql:<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="attr">#mysql -u backup -p -h 192</span><span class="number">.168</span><span class="number">.211</span><span class="number">.128</span><span class="comment">(输入密码123,可以访问说明设置正确)</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>设置slave同步</p>
<ol>
<li>修改my.cnf<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnfa</span><br></pre></td></tr></table></figure>
添加内容如下:<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">server-id</span>= <span class="number">2</span> (mysql标示,不能出现重复)</span><br><span class="line"><span class="attr">log-bin</span>=mysql-bin(开启log-bin二进制日志文件,默认存在/var/lib/mysql下日志文 件以mysql-bin为开头)</span><br><span class="line"><span class="attr">binlog-do-db</span> =backup(backup为需要同步的数据库名,如需同步多个数据库,可以另起行如binlog-do-db =backup1)</span><br><span class="line"><span class="attr">max-binlog-size</span>=<span class="number">104857600</span>(日志的大小,超出会自动生成一个新的</span><br><span class="line"><span class="attr">master-host</span>=<span class="number">192.168</span>.<span class="number">211.128</span> (同步Master的ip地址)</span><br><span class="line"><span class="attr">master-user</span>=backup (同步所需的账号)</span><br><span class="line"><span class="attr">master-password</span>=<span class="number">123</span> (同步账号的密码)</span><br><span class="line"><span class="attr">master-port</span>=<span class="number">3306</span> (mstart 中mysql的访问端口)</span><br><span class="line"><span class="attr">replicate-do-db</span>=backup (所需同步的数据库名)</span><br><span class="line"><span class="comment">#replicate-ignore-db=mysql(不同步mysql库)</span></span><br><span class="line"><span class="comment">#replicate-do-table=backup.stu (如果只需同步backup数据库中的stu表)</span></span><br><span class="line"><span class="comment">#replicate-do-table=backup.teacher(如果只需同步backup数据库中的stu表)</span></span><br><span class="line"><span class="attr">master-connect-retry</span>=<span class="number">60</span> (主服务器宕机或连接丢失的情况下,从服务器线程重新尝试连接主服务器之前睡眠的秒数</span><br><span class="line"><span class="attr">log-bin</span>=mysql-bin (开启log-bin二进制日志文件)</span><br></pre></td></tr></table></figure>
修改完后保存退出,并重启mysql 如:service mysqld restart (重启正常,表示配置没错误)</li>
<li>在作为slave的mysql上建立用来同步的账户和库<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span>*.* <span class="keyword">to</span> backup@<span class="string">&#x27;192.168.211.128&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">mysql&gt;flush <span class="keyword">privileges</span>;</span><br><span class="line">Mysql&gt;<span class="keyword">create</span> <span class="keyword">database</span> backup;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>主服务器操作</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section">show master status;</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="section">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="section">| mysql-bin.000004 | 308 | | |</span></span><br><span class="line"><span class="section">+------------------+----------+--------------+------------------+</span></span><br></pre></td></tr></table></figure>
<p>从服务器操作:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">to</span> <span class="attribute">MASTER_HOST</span>=<span class="string">&#x27;192.168.100.253&#x27;</span>, <span class="attribute">MASTER_PORT</span>=3306, <span class="attribute">MASTER_USER</span>=<span class="string">&#x27;mysync&#x27;</span>, <span class="attribute">MASTER_PASSWORD</span>=<span class="string">&#x27;q123456&#x27;</span>, <span class="attribute">MASTER_LOG_FILE</span>=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,MASTER_LOG_POS=251;</span><br><span class="line">start slave;</span><br><span class="line">show slave statusG</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>mysql视图简介</title>
    <url>/2014/01/22/1288/</url>
    <content><![CDATA[<p>一．视图概述</p>
<p>视图是一个虚拟表,其内容由查询定义.同真实的表一样,视图包含一系列带有名称的列和行数据.但是,视图并不在数据库中以存储的数据值集形式存在.行和列数据来自由定义视图的查询所引用的表,并且在引用视图时动态生成.<br>对其中所引用的基础表来说,视图的作用类似于筛选.定义视图的筛选可以来自当前或其它数据库的一个或多个表,或者其它视图.通过视图进行查询没有任何限制,通过它们进行数据修改时的限制也很少.<br>视图是存储在数据库中的查询的sql 语句,它主要出于两种原因:安全原因,视图可以隐藏一些数据,如:社会保险基金表,可以用视图只显示姓名,地址,而不显示社会保险号和工资数等,另一原因是可使复杂的查询易于理解和使用.</p>
<p>二．创建视图 create view</p>
<p>1.语法</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">create [or replace] [algorithm = &#123;undefined | merge | temptable&#125;] view [db_name.]view_name [(column_list)] as select_statement [with [cascaded | local]<span class="built_in"> check </span>option]</span><br></pre></td></tr></table></figure>

<p>通过该语句可以创建视图,若给定了[or replace],则表示当已具有同名的视图时,将覆盖原视图.select_statement是一个查询语句,这个查询语句可从表或其它的视图中查询.视图属于数据库,因此需要指定数据库的名称,若未指定时,表示在当前的数据库创建新视图.<br>表和数据库共享数据库中相同的名称空间,因此,数据库不能包含相同名称的表和视图,并且,视图的列名也不能重复.</p>
<p>2.使用举例</p>
<p>本例创建一个产品表(product)和一个购买记录表(purchase),再通过视图purchase_detail查询出购买的详细信息.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> product</span><br><span class="line">(</span><br><span class="line">    product_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    price <span class="keyword">double</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> product <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;apple &#x27;</span>, <span class="number">5.5</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> purchase</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    product_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    qty <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    gen_time datetime <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> purchase <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>, now());</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> purchase_detail <span class="keyword">as</span> <span class="keyword">select</span> product.name <span class="keyword">as</span> name, product .price <span class="keyword">as</span> price, purchase.qty <span class="keyword">as</span> qty, product .price <span class="operator">*</span> purchase.qty <span class="keyword">as</span> total_value <span class="keyword">from</span> product, purchase <span class="keyword">where</span> product.product_id <span class="operator">=</span> purchase.product_id;</span><br></pre></td></tr></table></figure>

<p>创建成功后,输入:select * from purchase_detail;<br>运行效果如下:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="code">+-------+</span>-------<span class="code">+-----+</span>-------------+</span><br><span class="line"><span class="section">| name | price | qty | total_value |</span></span><br><span class="line"><span class="section">+-------+-------+-----+-------------+</span></span><br><span class="line"><span class="section">| apple | 5.5 | 10 | 55 |</span></span><br><span class="line"><span class="section">+-------+-------+-----+-------------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>3.注意事项</p>
<p>创建视图存在如下注意事项:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>) 运行创建视图的语句需要用户具有创建视图(crate <span class="keyword">view</span>)的权限,若加了[<span class="keyword">or replace</span>]时,还需要用户具有删除视图(<span class="keyword">drop</span> <span class="keyword">view</span>)的权限;</span><br><span class="line">(<span class="number">2</span>) <span class="keyword">select</span>语句不能包含<span class="keyword">from</span>子句中的子查询;</span><br><span class="line">(<span class="number">3</span>) <span class="keyword">select</span>语句不能引用系统或用户变量;</span><br><span class="line">(<span class="number">4</span>) <span class="keyword">select</span>语句不能引用预处理语句参数;</span><br><span class="line">(<span class="number">5</span>) 在存储子程序内,定义不能引用子程序参数或局部变量;</span><br><span class="line">(<span class="number">6</span>)在定义中引用的表或视图必须存在.但是,创建了视图后,能够舍弃定义引用的表或视图.要想检查视图定义是否存在这类问题,可使用<span class="keyword">check</span> <span class="keyword">table</span>语句;</span><br><span class="line">(<span class="number">7</span>) 在定义中不能引用<span class="keyword">temporary</span>表,不能创建<span class="keyword">temporary</span>视图;</span><br><span class="line">(<span class="number">8</span>) 在视图定义中命名的表必须已存在;</span><br><span class="line">(<span class="number">9</span>) 不能将触发程序与视图关联在一起;</span><br><span class="line">(<span class="number">10</span>) 在视图定义中允许使用<span class="keyword">order</span> <span class="keyword">by</span>,但是,如果从特定视图进行了选择,而该视图使用了具有自己<span class="keyword">order</span> <span class="keyword">by</span>的语句,它将被忽略.</span><br></pre></td></tr></table></figure>

<p>三．修改视图 alter view</p>
<p>1.语法</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">alter [algorithm = &#123;undefined | merge | temptable&#125;] view view_name [(column_list)] as select_statement [with [cascaded | local]<span class="built_in"> check </span>option]</span><br></pre></td></tr></table></figure>

<p>该语句用于更改已有视图的定义.其语法与create view类似.</p>
<p>2.使用举例<br>eg. 将上一小节中中创建的视purchase_detail进行修改,去掉qty列,语句如下:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> purchase_detail <span class="keyword">as</span> <span class="keyword">select</span> product.name <span class="keyword">as</span> <span class="type">name</span>, product .price <span class="keyword">as</span> price, product .price * purchase.qty <span class="keyword">as</span> total_value <span class="keyword">from</span> product, purchase <span class="keyword">where</span> product.product_id = purchase.product_id;</span><br></pre></td></tr></table></figure>

<p>此时通过语句:select * from purchase_detail;对视图进行查询时.</p>
]]></content>
  </entry>
  <entry>
    <title>mysql忘记root密码的解决方法</title>
    <url>/2013/07/11/1290/</url>
    <content><![CDATA[<p>如果忘记了MySQL的root密码,可以用以下方法重新设置:<br>1.KILL掉系统里的MySQL进程:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">killall -TERM mysqld</span></span><br></pre></td></tr></table></figure>

<p>2.用以下命令启动MySQL,以不检查权限的方式启动:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin/safe_mysqld –skip-grant-tables &amp;</span><br></pre></td></tr></table></figure>

<p>3.然后用空密码方式使用root用户登录 MySQL:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql -u root</span></span><br></pre></td></tr></table></figure>

<p>4.修改root用户的密码:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">update</span> mysql.<span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="keyword">PASSWORD</span>(<span class="string">&#x27;新密码&#x27;</span>) <span class="keyword">where</span> <span class="keyword">User</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; flush <span class="keyword">privileges</span>;</span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySQL优化</title>
    <url>/2015/03/17/1291/</url>
    <content><![CDATA[<p>打开/etc/my.cnf文件,修改以下设置,如果没有,可手动添加.调整设置时,请量力而行,这与你的服务器的配置有关,特别是内存大小.以下设置比较适合于1G内存的服务器,但并不绝对.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment">#指定索引缓冲区的大小,它决定索引处理的速度,尤其是索引读的速度.通过检查状态值 Key_read_requests和Key_reads,可以知道key_buffer_size设置是否合理.比例key_reads / key_read_requests应该尽可能的低,至少是1:100,1:1000更好(上述状态值可以使用show status like &#x27;key_reads&#x27;获得).key_buffer_size只对MyISAM表起作用.即使你不使用MyISAM表,但是内部的临时磁盘表是 MyISAM表,也要使用该值.可以使用检查状态值created_tmp_disk_tables得知详情.</span></span><br><span class="line"><span class="attribute">key_buffer</span> = <span class="number">384</span>M</span><br><span class="line"><span class="comment">#要求MySQL能有的连接数量.当主要MySQL线程在一个很短时间内得到非常多的连接请求,这就起作 用,然后主线程花些时间(尽管很短)检查连接并且启动一个新线程.back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被 存在堆栈中.只有如果期望在一个短时间内有很多连接,你需要增加它,换句话说,这值对到来的TCP/IP连接的侦听队列的大小.你的操作系统在这个队列大 小上有它自己的限制.试图设定back_log高于你的操作系统的限制将是无效的.默认数值是50</span></span><br><span class="line"><span class="attribute">back_log</span> = <span class="number">200</span></span><br><span class="line"><span class="comment">#一个包的最大尺寸.消息缓冲区被初始化为net_buffer_length字节,但是可在需要时增加到 max_allowed_packet个字节.缺省地,该值太小必能捕捉大的(可能错误)包.如果你正在使用大的BLOB列,你必须增加该值.它应该象你 想要使用的最大BLOB的那么大.</span></span><br><span class="line"><span class="attribute">max_allowed_packet</span> = <span class="number">4</span>M</span><br><span class="line"><span class="comment">#允许的同时客户的数量.增加该值增加 mysqld要求的文件描述符的数量.这个数字应该增加,否则,你将经常看到 Too many connections 错误. 默认数值是100</span></span><br><span class="line"><span class="attribute">max_connections</span> = <span class="number">1024</span></span><br><span class="line"><span class="comment">#指定表高速缓存的大小.每当MySQL访问一个表时,如果在表缓冲区中还有空间,该表就被打开并放入其 中,这样可以更快地访问表内容.通过检查峰值时间的状态值Open_tables和Opened_tables,可以决定是否需要增加 table_cache的值.如果你发现open_tables等于table_cache,并且opened_tables在不断增长,那么你就需要增 加table_cache的值了(上述状态值可以使用show status like &#x27;Open_tables&#x27;获得).注意,不能盲目地把table_cache设置成很大的值.如果设置得太高,可能会造成文件描述符不足,从而造成性能 不稳定或者连接失败.</span></span><br><span class="line"><span class="attribute">table_cache</span> = <span class="number">512</span></span><br><span class="line"><span class="comment">#每个线程排序所需的缓冲</span></span><br><span class="line"><span class="attribute">sort_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="comment">#当一个查询不断地扫描某一个表,MySQL会为它分配一段内存缓冲区.read_buffer_size变量控制这一缓冲区的大小.如果你认为连续扫描进行得太慢,可以通过增加该变量值以及内存缓冲区大小提高其性能.</span></span><br><span class="line"><span class="attribute">read_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="comment">#加速排序操作后的读数据,提高读分类行的速度.如果正对远远大于可用内存的表执行GROUP BY或ORDER BY操作,应增加read_rnd_buffer_size的值以加速排序操作后面的行读取.仍然不明白这个选项的用处……</span></span><br><span class="line"><span class="attribute">read_rnd_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="comment">#用于REPAIR TABLE.不明白这个选项的用处,百度上找到的设置方向也是五花八门,有128M、64M、32M等,折中选一个.</span></span><br><span class="line"><span class="attribute">myisam_sort_buffer_size</span> = <span class="number">64</span>M</span><br><span class="line"><span class="comment">#可以复用的保存在中的线程的数量.如果有,新的线程从缓存中取得,当断开连接的时候如果有空间,客户的线 置在缓存中.如果有很多新的线程,为了提高性能可以这个变量值.通过比较 Connections 和 Threads_created 状态的变量,可以看到这个变量的作用.</span></span><br><span class="line"><span class="attribute">thread_cache_size</span> = <span class="number">128</span></span><br><span class="line"><span class="comment">#查询结果缓存.第一次执行某条SELECT语句的时候,服务器记住该查询的文本内容和它返回的结果.服务器下一次碰到这个语句的时候,它不会再次执行该语句.作为代替,它直接从查询缓存中的得到结果并把结果返回给客户端.</span></span><br><span class="line"><span class="attribute">query_cache_size</span> = <span class="number">32</span>M</span><br><span class="line"><span class="comment">#最大并发线程数,cpu数量*2</span></span><br><span class="line"><span class="attribute">thread_concurrency</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">#设置超时时间,能避免长连接</span></span><br><span class="line"><span class="attribute">wait_timeout</span> = <span class="number">120</span></span><br><span class="line"><span class="comment">#关闭不需要的表类型,如果你需要,就不要加上这个</span></span><br><span class="line"><span class="attribute">skip</span>-innodb</span><br><span class="line"><span class="attribute">skip</span>-bdb</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>NameError (undefined local variable or method `acts_as_taggab)</title>
    <url>/2018/08/25/1293/</url>
    <content><![CDATA[<p>在WIN的话 请直接使用:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">gem <span class="keyword">install</span> acts_as_taggable</span><br></pre></td></tr></table></figure>

<p>如果还不行:<br>那就去github 下一份acts_as_taggable到PLUGIN 就能正常使用了.<br>记得 要重新执行一次:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">ruby <span class="keyword">script</span>/server</span><br></pre></td></tr></table></figure>

<p>acts_as_taggable下载地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/mattetti/</span>acts_as_taggable_on_steroids/</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySql中only_full_group_by的问题解决</title>
    <url>/2019/12/12/1292/</url>
    <content><![CDATA[<p>首先查看mysql的sql_mode：</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section">mysql&gt; select @@sql_mode;</span></span><br><span class="line"><span class="section">+----------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| @@sql_mode                                                                                         |</span></span><br><span class="line"><span class="section">+----------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="section">| ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |</span></span><br><span class="line"><span class="section">+----------------------------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in set (0.25 sec)</span><br></pre></td></tr></table></figure>

<p>可以看到ONLY_FULL_GROUP_BY，我们需要关闭它。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>sql<span class="regexp">/conf.d/</span>custom.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class="line"><span class="comment">#没有only_full_group_by</span></span><br></pre></td></tr></table></figure>

<p>最后重启mysql。</p>
]]></content>
  </entry>
  <entry>
    <title>Nginx EAccelerator 的安装笔记</title>
    <url>/2015/05/26/1295/</url>
    <content><![CDATA[<p>这个是我的安装环境,适合大部分的安装,是linux nginx下的安装.<br>进入相应文件夹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/src/</span></span><br></pre></td></tr></table></figure>

<p>安装的是0.9.5.3版,下载:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget -c http:<span class="regexp">//</span>bart.eaccelerator.net<span class="regexp">/source/</span><span class="number">0.9</span>.<span class="number">5.3</span>/eaccelerator-<span class="number">0.9</span>.<span class="number">5.3</span>.tar.bz2</span><br></pre></td></tr></table></figure>

<p>解压:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> jxvf eaccelerator-<span class="number">0.9.5.3</span>.tar.bz<span class="number">2</span></span><br><span class="line"><span class="attribute">cd</span> eaccelerator-<span class="number">0.9.5.3</span>/</span><br></pre></td></tr></table></figure>

<p>然后:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">phpize</span></span><br></pre></td></tr></table></figure>

<p>接着;</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">./configure --enable-eaccelerator=shared --<span class="keyword">with</span>-php-<span class="keyword">config</span>=/usr/<span class="keyword">local</span>/bin/php-<span class="keyword">config</span>  --<span class="keyword">with</span>-eaccelerator-shared-memory</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>创建缓存临时文件夹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/tmp/</span>eaccelerator</span><br></pre></td></tr></table></figure>

<p>赋予权限;</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">777</span> <span class="regexp">/tmp/</span>eaccelerator</span><br></pre></td></tr></table></figure>

<p>配置文件:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt;<span class="regexp">/etc/</span>php.ini&lt;</span><br></pre></td></tr></table></figure>

<p>重启:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service nginx restart</span></span><br></pre></td></tr></table></figure>

<p>大功告成!</p>
]]></content>
  </entry>
  <entry>
    <title>nginx + php-fpm 访问php提示File not found.</title>
    <url>/2012/03/26/1294/</url>
    <content><![CDATA[<p>检查虚拟主机配置中的:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ .php$</span> &#123;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME html$fastcgi_script_name;</span><br><span class="line">    <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看下最后的include的文件是否存在,因为不同的版本这个文件的名字可能不同,所以只看网上的教程可能会照不到这个文件.<br>比如我本地的是fastcgi.conf,而VPS是fcgi.conf,所以这里一定要注意了.</p>
]]></content>
  </entry>
  <entry>
    <title>nginx upstream timed out 10060错误解决</title>
    <url>/2015/08/21/1296/</url>
    <content><![CDATA[<p>减少反向代理连接时间,可以解决这个问题.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>;</span><br><span class="line">    <span class="comment">#charset koi8-r;</span></span><br><span class="line">    <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /&#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://paila;</span><br><span class="line">        <span class="attribute">proxy_redirect</span> <span class="literal">off</span> ;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> REMOTE-HOST $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">50m</span>;</span><br><span class="line">        <span class="attribute">client_body_buffer_size</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">30</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">60</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> timeout invalid_header http_500 http_503 http_404;</span><br><span class="line">        <span class="attribute">proxy_max_temp_file_size</span> <span class="number">128m</span>; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx 多站点配置方法</title>
    <url>/2014/10/22/1297/</url>
    <content><![CDATA[<p>关于nginx的多站设置,其实和apache很相似,假设我们已经有两个域名,分别是:<a href="http://www.websuita.com和www.websuitb.com/">www.websuitA.com和www.websuitB.com</a>.<br>那么我们开始吧:<br>1、为我们的站点创建配置文件<br>我是这么做的,在nginx的配置文件conf目录下创建一个专门存放VirtualHost的目录,命名为vhosts_conf,可以把虚拟目录的配置全部放在这里.在里面创建名为vhosts_modoupi_websuitA.conf的配置文件并打开,我们在这里做配置,往里面写:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;　　　　　　　　　　　　　　　<span class="comment">#监听的端口号</span></span><br><span class="line">    <span class="attribute">server_name</span> websuitA.com;　　　　　　　　<span class="comment">#域名</span></span><br><span class="line">    <span class="comment">#access_log logs/host.access.log main;</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> X:/wnmp/www/websuitA;　　　　<span class="comment">#站点的路径</span></span><br><span class="line">        <span class="attribute">index</span> default.php index.php index.html index.htm;</span><br><span class="line">        <span class="comment">#站点的rewrite在这里写</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/(w+).html$</span> /<span class="variable">$1</span>.php;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/(w+)/(w+)$</span> /<span class="variable">$1</span>/<span class="variable">$2</span>.php;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#错误页的配置</span></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /error.html;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span> html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .php$</span> &#123;</span><br><span class="line">        <span class="attribute">root</span> X:/wnmp/www/websuitA;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就做好了,站点A的配置,同样的方法,做websuitB的配置,这里我命名为vhosts_modoupi_websuitB.conf,直接上代码:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;　　　　　　　　　　　　　　　<span class="comment">#监听的端口号</span></span><br><span class="line">    <span class="attribute">server_name</span> websuitB.com;　　　　　　　　<span class="comment">#域名</span></span><br><span class="line">    <span class="comment">#access_log logs/host.access.log main;</span></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> X:/wnmp/www/websuitB;　　　　<span class="comment">#站点的路径</span></span><br><span class="line">        <span class="attribute">index</span> default.php index.php index.html index.htm;</span><br><span class="line">        <span class="comment">#站点的rewrite在这里写</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/(w+).html$</span> /<span class="variable">$1</span>.php;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/(w+)/(w+)$</span> /<span class="variable">$1</span>/<span class="variable">$2</span>.php;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#错误页的配置</span></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /error.html;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ .php$</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> X:/wnmp/www/websuitB;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">    <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样,两个站点的配置就OK了.</p>
<p>2、在nginx的主配置文件里,包含这两个站点的配置文件.</p>
<p>我们打开conf目录下的nginx.conf文件,很容易做,只要在http{…}段输入以下代码:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#包含所有的虚拟主机的配置文件</span></span><br><span class="line">include X:<span class="regexp">/wnmp/</span>nginx<span class="regexp">/conf/</span>vhosts_conf/*.conf;</span><br></pre></td></tr></table></figure>

<p>这样,nginx的多站点配置就做好了,怎么样打开浏览器测试一下吧~</p>
]]></content>
  </entry>
  <entry>
    <title>Nginx 限制网站并发数和带宽</title>
    <url>/2011/02/10/1298/</url>
    <content><![CDATA[<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> download.selboo.com.cn;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm default.html default.htm index.php;</span><br><span class="line">    <span class="attribute">root</span> /wwwroot/selboo/download/;</span><br><span class="line">    <span class="attribute">limit_zone</span> limit $binary_remote_addr <span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">limit_conn</span> limit <span class="number">2</span>;</span><br><span class="line">        <span class="attribute">limit_rate</span> <span class="number">50k</span>;</span><br><span class="line">        <span class="comment">#限制并发为2,每个并发限速50k.</span></span><br><span class="line">        <span class="attribute">limit_zone</span></span><br><span class="line">        <span class="comment">#是针对每个IP定义一个存储session状态的容器.这个示例中定义了一个10m的容器,按照32bytes/session,可以处理320000个session.</span></span><br><span class="line">        limit_conn limit <span class="number">2</span></span><br><span class="line">        <span class="comment">#限制每个IP只能并发两个连接.</span></span><br><span class="line">        limit_rate <span class="number">50k</span>;</span><br><span class="line">        <span class="comment">#对每个连接限速50k. 注意,这里是对连接限速,而不是对IP限速.如果一个IP允许两个并发连接,那么这个IP就是限速       limit_conn ×limit_rate,也就是 2×50k=100k.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx+keepalived实现双机热备高可用</title>
    <url>/2015/11/15/1299/</url>
    <content><![CDATA[<p>这篇文章简单介绍利用keepalived软件,实现对nginx服务器的高可用,即实现故障自动切换.</p>
<p>安装nginx(两台安装配置都一样!)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#添加运行nginx的用户和组www</span></span><br><span class="line">groupadd www</span><br><span class="line">useradd -g www www</span><br><span class="line"><span class="comment">#安装依赖</span></span><br><span class="line">yum install pcre pcre-devel</span><br><span class="line"><span class="comment">#开始安装nginx</span></span><br><span class="line">wget http:<span class="regexp">//</span>sysoev.ru<span class="regexp">/nginx/</span>nginx-<span class="number">0.7</span>.<span class="number">51</span>.tar.gz</span><br><span class="line">tar zxvf nginx-<span class="number">0.7</span>.<span class="number">51</span>.tar.gz</span><br><span class="line">cd nginx-<span class="number">0.7</span>.<span class="number">51</span>/</span><br><span class="line">.<span class="regexp">/configure --user=www --group=www --prefix=/u</span>sr<span class="regexp">/local/</span>webserver/nginx --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>keepalived安装</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install openssl-devel</span><br><span class="line">cd /tmp</span><br><span class="line">wget http:<span class="regexp">//</span>www.keepalived.org<span class="regexp">/software/</span>keepalived-<span class="number">1.2</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">tar xzf keepalived-<span class="number">1.2</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">cd keepalived-<span class="number">1.2</span>.<span class="number">2</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>keepalived <span class="regexp">/etc/i</span>nit.d/</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>sysconfig<span class="regexp">/keepalived /</span>etc<span class="regexp">/sysconfig/</span></span><br><span class="line">chmod +x <span class="regexp">/etc/i</span>nit.d/keepalived</span><br><span class="line">chkconfig --add keepalived</span><br><span class="line">chkconfig keepalived on</span><br><span class="line">mkdir <span class="regexp">/etc/</span>keepalived</span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>keepalived <span class="regexp">/usr/</span>sbin/</span><br></pre></td></tr></table></figure>

<p>keepalived的配置</p>
<p>更详细的keepalived配置文件说明可以执行man keepalived.conf查看.<br>我们假设主服务器IP:192.168.1.103,从服务器ip:192.168.1.101 虚拟ip:192.168.1.110</p>
<p>下面对主服务器的keepalived进行配置:</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">vi /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">    admin@centos.bz</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from keepalived@domain.com</span><br><span class="line">    smtp_server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    smtp_connect_timeout <span class="number">30</span></span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_http_port &#123;</span><br><span class="line">    script <span class="string">&quot;/opt/nginx_pid.sh&quot;</span></span><br><span class="line">    interval <span class="number">2</span></span><br><span class="line">    weight <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER ############ 辅机为 BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id <span class="number">51</span></span><br><span class="line">    mcast_src_ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.103</span></span><br><span class="line">    priority <span class="number">102</span> ########### 权值要比 back 高</span><br><span class="line">    advert_int <span class="number">1</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass <span class="number">1111</span></span><br><span class="line">    &#125;</span><br><span class="line">track_script &#123;</span><br><span class="line">    chk_http_port ### 执行监控的服务</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        <span class="number">192.168</span><span class="number">.1</span><span class="number">.110</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从服务器:</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">    admin@centos.bz</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from keepalived@domain.com</span><br><span class="line">    smtp_server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    smtp_connect_timeout <span class="number">30</span></span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_http_port &#123;</span><br><span class="line">    script <span class="string">&quot;/opt/nginx_pid.sh&quot;</span></span><br><span class="line">    interval <span class="number">2</span></span><br><span class="line">    weight <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id <span class="number">51</span></span><br><span class="line">    mcast_src_ip <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span></span><br><span class="line">    priority <span class="number">101</span> ##########权值 要比 master 低..</span><br><span class="line">    advert_int <span class="number">1</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass <span class="number">1111</span></span><br><span class="line">&#125;</span><br><span class="line">track_script &#123;</span><br><span class="line">    chk_http_port ### 执行监控的服务</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        <span class="number">192.168</span><span class="number">.1</span><span class="number">.110</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后分别在主从服务器建立nginx的监控脚本:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/opt/</span>nginx_pid.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">A=`ps -C nginx --no-header |wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$A</span> -eq <span class="number">0</span> ];then</span><br><span class="line">    <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin/nginx</span><br><span class="line">    sleep <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq <span class="number">0</span> ];then</span><br><span class="line">        killall keepalived</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>然后分别启动主从服务器的keepalived:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service keepalived <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>keepalived的测试<br>我们在主服务器上执行命令ip a,显示如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line"><span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:aa:a<span class="number">1</span>:e<span class="number">4</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.103</span>/<span class="number">24</span> brd <span class="number">255.255.255.255</span> scope global eth<span class="number">0</span></span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.110</span>/<span class="number">32</span> scope global eth<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>证明主服务器已经绑定了虚拟ip 192.168.1.110<br>在从服务器上执行命令ip a,显示如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line"><span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">2</span>b:<span class="number">94</span>:<span class="number">3</span>b brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.101</span>/<span class="number">24</span> brd <span class="number">255.255.255.255</span> scope global eth<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>显示表明从服务器上没有绑定vip 192.168.1.110,只有本机真实ip192.168.1.101<br>下面我们停止主服务器的nginx进程,再看看ip绑定情况:<br>主服务器的情况:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line"><span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:aa:a<span class="number">1</span>:e<span class="number">4</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.103</span>/<span class="number">24</span> brd <span class="number">255.255.255.255</span> scope global eth<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>从服务器的情况:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2</span>: eth<span class="number">0</span>: mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span></span><br><span class="line"><span class="attribute">link</span>/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">2</span>b:<span class="number">94</span>:<span class="number">3</span>b brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.101</span>/<span class="number">24</span> brd <span class="number">255.255.255.255</span> scope global eth<span class="number">0</span></span><br><span class="line"><span class="attribute">inet</span> <span class="number">192.168.1.110</span>/<span class="number">32</span> scope global eth<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>由此可见vip已经指向了从服务器.</p>
]]></content>
  </entry>
  <entry>
    <title>Nginx+rtmp 搭建流媒体服务器</title>
    <url>/2012/10/11/1300/</url>
    <content><![CDATA[<p>一. gcc 安装</p>
<p>安装 nginx 需要先将官网下载的源码进行编译,编译依赖 gcc 环境,如果没有 gcc 环境,则需要安装:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">yum</span> <span class="literal">-</span><span class="comment">y</span> <span class="comment">install</span> <span class="comment">gcc</span> <span class="comment">gcc</span><span class="literal">-</span><span class="comment">c</span>++</span><br></pre></td></tr></table></figure>

<p>二. PCRE pcre-devel 安装</p>
<p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库,包括 perl 兼容的正则表达式库.nginx 的 http 模块使用 pcre 来解析正则表达式,所以需要在 linux 上安装 pcre 库,pcre-devel 是使用 pcre 开发的一个二次开发库.nginx也需要此库.命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> -y pcre pcre-devel</span><br></pre></td></tr></table></figure>

<p>三. zlib 安装</p>
<p>zlib 库提供了很多种压缩和解压缩的方式, nginx 使用 zlib 对 http 包的内容进行 gzip ,所以需要在 Centos 上安装 zlib 库.</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">yum install -y <span class="literal">zlib</span> <span class="literal">zlib</span>-devel</span><br></pre></td></tr></table></figure>

<p>四. OpenSSL 安装</p>
<p>OpenSSL 是一个强大的安全套接字层密码库,囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议,并提供丰富的应用程序供测试或其它目的使用.nginx 不仅支持 http 协议,还支持 https(即在ssl协议上传输http),所以需要在 Centos 安装 OpenSSL 库.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>五、安装nginx 跟rtmp模块</p>
<p>1.官网下载直接下载.tar.gz安装包,地址:<a href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a>.</p>
<p>2.解压:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf nginx-<span class="number">1</span>.<span class="number">13</span>.<span class="number">8</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>3.下载rtmp 模块, nginx-rtmp-module的官方github地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/arut/</span>nginx-rtmp-module</span><br></pre></td></tr></table></figure>

<p>4.安装nginx跟rtmp模块:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">./configure --prefix=<span class="regexp">/usr/</span>local/nginx  --add-<span class="built_in">module</span>=../nginx-rtmp-<span class="built_in">module</span>  --<span class="keyword">with</span>-http_ssl_module</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure>

<p>5.修改配置文件.进入 <code>/usr/local/nginx/conf</code>文件夹.增添rtmp部分:<br>rtmp {<br>server {<br>listen 1935;  #监听的端口<br>chunk_size 4000;<br>application hls {  #rtmp推流请求路径<br>live on;<br>}<br>}<br>}</p>
<p>6.重启电脑.进入 <code>/usr/local/nginx/sbin</code>文件夹,执行./nginx启动nginx.</p>
<p>六、OBS推流</p>
<p>1.设置推流地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rtmp:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.39</span>:<span class="number">1935</span>/hls</span><br></pre></td></tr></table></figure>

<p>流名称:test</p>
<p>这里说明下,rtmp的URL基础格式:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rtmp:<span class="regexp">//</span>nginx_host[:nginx_port]<span class="regexp">/application_name/</span>stream_name</span><br></pre></td></tr></table></figure>

<p>2.推流:</p>
<p>媒体源添加摄像机地址.然后点击推流.</p>
<p>3.vlc串流地址输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rtmp:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.39</span>:<span class="number">1935</span><span class="regexp">/hls/</span>test</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Nginx安装及配置</title>
    <url>/2018/10/12/1302/</url>
    <content><![CDATA[<p>Nginx作为一个后起之秀,他的迷人之处已经让很多人都投入了他的怀抱.配置简单,实现原理简单.做一个负载平衡的再好不过了.</p>
<p>一、依赖的程序</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>gzip <span class="keyword">module</span> <span class="keyword">requires</span> zlib library</span><br><span class="line"><span class="number">2.</span>rewrite <span class="keyword">module</span> <span class="keyword">requires</span> pcre library</span><br><span class="line"><span class="number">3.</span>ssl support <span class="keyword">requires</span> openssl library</span><br></pre></td></tr></table></figure>

<p>二、安装</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> install</span><br></pre></td></tr></table></figure>

<p>默认安装的路径是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local/nginx</span><br></pre></td></tr></table></figure>

<p>更多的安装配置:</p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">./configure --prefix=<span class="regexp">/usr/</span>local/nginx</span><br><span class="line">--<span class="keyword">with</span>-openssl=<span class="regexp">/usr/i</span>nclude (启用ssl)</span><br><span class="line">--<span class="keyword">with</span>-pcre=<span class="regexp">/usr/i</span>nclude/pcre/ (启用正规表达式)</span><br><span class="line">--<span class="keyword">with</span>-http_stub_status_module (安装可以查看nginx状态的程序)</span><br><span class="line">--<span class="keyword">with</span>-http_memcached_module (启用memcache缓存)</span><br><span class="line">--<span class="keyword">with</span>-http_rewrite_module (启用支持<span class="built_in">url</span>重写)</span><br></pre></td></tr></table></figure>

<p>三、启动及重启</p>
<p>启动:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx</span></span><br></pre></td></tr></table></figure>

<p>重启:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">kill -HUP `cat <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>logs/nginx.pid`</span><br></pre></td></tr></table></figure>

<p>测试配置文件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -t</span></span><br></pre></td></tr></table></figure>

<p>简单吧,安装,启动都比较方便.</p>
<p>四、配置文件</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#运行用户</span></span><br><span class="line"><span class="attribute">user</span>  nobody nobody;</span><br><span class="line"><span class="comment">#启动进程</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">5</span>;</span><br><span class="line"><span class="comment">#全局错误日志及PID文件</span></span><br><span class="line"><span class="attribute">error_log</span>  logs/error.log <span class="literal">notice</span>;</span><br><span class="line"><span class="attribute">pid</span>        logs/nginx.pid;</span><br><span class="line"><span class="comment">#工作模式及连接数上限</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="comment">#工作模式有:select(标准模式),poll(标准模式),kqueue(高效模式,适用FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 and MacOS X),</span></span><br><span class="line">    <span class="comment">#epoll(高效模式,本例用的.适用Linux 2.6+,SuSE 8.2,),/dev/poll(高效模式,适用Solaris 7 11/99+, HP/UX 11.22+ (eventport), IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+)</span></span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">    <span class="attribute">worker_connections</span>      <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#设定http服务器,利用它的反向代理功能提供负载均衡支持</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment">#设定mime类型</span></span><br><span class="line">    <span class="attribute">include</span>      conf/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="comment">#设定日志格式</span></span><br><span class="line">    <span class="attribute">log_format</span> main        <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$request&quot; $status $bytes_sent &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$gzip_ratio&quot;&#x27;</span>;</span><br><span class="line">    <span class="attribute">log_format</span> download    <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$request&quot; $status $bytes_sent &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &#x27;</span></span><br><span class="line">                           <span class="string">&#x27;&quot;$http_range&quot; &quot;$sent_http_content_range&quot;&#x27;</span>;</span><br><span class="line"><span class="comment">#设定请求缓冲</span></span><br><span class="line">    <span class="attribute">client_header_buffer_size</span>    <span class="number">10k</span>;</span><br><span class="line">    <span class="attribute">large_client_header_buffers</span>  <span class="number">4</span> <span class="number">4k</span>;</span><br><span class="line">    <span class="comment">#开启gzip模块,要求安装gzip 在运行./config时要指定</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span>  <span class="number">1100</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span>    <span class="number">4</span> <span class="number">8k</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span>      text/plain;</span><br><span class="line">    <span class="attribute">output_buffers</span>  <span class="number">1</span> <span class="number">32k</span>;</span><br><span class="line">    <span class="attribute">postpone_output</span>  <span class="number">1460</span>;</span><br><span class="line">    <span class="comment">#设定访问日志</span></span><br><span class="line">    <span class="attribute">access_log</span>  logs/access.log  main;</span><br><span class="line">    <span class="attribute">client_header_timeout</span>  <span class="number">3m</span>;</span><br><span class="line">    <span class="attribute">client_body_timeout</span>    <span class="number">3m</span>;</span><br><span class="line">    <span class="attribute">send_timeout</span>          <span class="number">3m</span>;</span><br><span class="line">    <span class="attribute">sendfile</span>                <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span>              <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span>            <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">    <span class="comment">#设定负载均衡的服务器列表</span></span><br><span class="line">    <span class="attribute">upstream</span> backserver &#123;</span><br><span class="line">    <span class="comment">#weigth参数表示权值,权值越高被分配到的几率越大</span></span><br><span class="line">    <span class="comment">#本例是指在同一台服务器,多台服务器改变ip即可</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8081</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8082</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8083</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#设定虚拟主机,默认为监听80端口,改成其他端口会出现问题</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>         <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>    test.com www.test.com;</span><br><span class="line">        <span class="attribute">charset</span> utf8;</span><br><span class="line">        <span class="comment">#设定本虚拟主机的访问日志</span></span><br><span class="line">        <span class="attribute">access_log</span>  logs/test.com.log  main;</span><br><span class="line">        <span class="comment">#如果访问 /images/*, /js/*, /css/* 资源,则直接取本地文件,不用转发.但如果文件较多效果不是太好.</span></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ ^/(images|js|css)/</span>  &#123;</span><br><span class="line">            <span class="attribute">root</span>    /usr/local/testweb;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">30m</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#对 &quot;/&quot; 启用负载均衡</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span>      http://backserver;</span><br><span class="line">            <span class="attribute">proxy_redirect</span>          <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        Host $host;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        X-Real-IP $remote_addr;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            <span class="attribute">client_max_body_size</span>    <span class="number">10m</span>;</span><br><span class="line">            <span class="attribute">client_body_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line">            <span class="attribute">proxy_connect_timeout</span>  <span class="number">90</span>;</span><br><span class="line">            <span class="attribute">proxy_send_timeout</span>      <span class="number">90</span>;</span><br><span class="line">            <span class="attribute">proxy_read_timeout</span>      <span class="number">90</span>;</span><br><span class="line">            <span class="attribute">proxy_buffer_size</span>      <span class="number">4k</span>;</span><br><span class="line">            <span class="attribute">proxy_buffers</span>          <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">            <span class="attribute">proxy_busy_buffers_size</span> <span class="number">64k</span>;</span><br><span class="line">            <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">#设定查看Nginx状态的地址,在运行./config 要指定,默认是不安装的.</span></span><br><span class="line">        <span class="attribute">location</span> /NginxStatus &#123;</span><br><span class="line">            <span class="attribute">stub_status</span>            <span class="literal">on</span>;</span><br><span class="line">            <span class="attribute">access_log</span>              <span class="literal">on</span>;</span><br><span class="line">            <span class="attribute">auth_basic</span>              <span class="string">&quot;NginxStatus&quot;</span>;</span><br><span class="line">            <span class="comment">#是否要通过用户名和密码访问,测试时可以不加上.conf/htpasswd 文件的内容用 apache 提供的 htpasswd 工具来产生即可</span></span><br><span class="line">            <span class="comment">#auth_basic_user_file  conf/htpasswd;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx-301重定向域名</title>
    <url>/2015/11/09/1301/</url>
    <content><![CDATA[<p>域名跳转</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> jump.c1gstudio.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    <span class="attribute">root</span> /opt/lampp/htdocs/www;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.c1gstudio.com/;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多域名转向</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">server_name</span> www.c1gstudio.com www.c1gstudio.net;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line"><span class="attribute">root</span> /opt/lampp/htdocs;</span><br><span class="line"><span class="attribute">if</span> ($host <span class="regexp">~ &quot;c1gstudio\.net&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.c1gstudio.com<span class="variable">$1</span>/ <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三级域名跳转</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_host</span> ~* <span class="string">&quot;^(.*)\.i\.c1gstudio\.com$&quot;</span>) &#123;</span><br><span class="line">    rewrite ^(.*) http:<span class="regexp">//</span>top.yingjiesheng.com<span class="variable">$1</span>/;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>域名镜向</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mirror.c1gstudio.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    <span class="attribute">root</span> /opt/lampp/htdocs/www;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)</span> http://www.c1gstudio.com/<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Nginx反向代理命令详解</title>
    <url>/2019/07/03/1304/</url>
    <content><![CDATA[<h2 id="正向代理指令"><a href="#正向代理指令" class="headerlink" title="正向代理指令:"></a>正向代理指令:</h2><p>1 resolver<br>这个用于DNS服务器的ip . DNS服务器的主要工作是进行域名解析,将域名映射为对应IP地址<br>resolver address … [valid = time ]<br>address ,   DNS 服务器的ip地址, 不指定的话默认53<br>time 设置数据包在网络中的有效时间.<br>例: resolver 127.0.0.1 [::1]:52113 valids<br>2 resolver_timeout<br>设置DNS服务器域名解析超时时间<br>语法结构: resolver_timeout time;<br>3 proxy_pass<br>设置代理服务器的协议和地址,可以用于反向代理服务<br>proxy_pass URL<br>URL  为设置的代理服务器协议和地址<br><code>&lt;br&gt;</code><br>反向代理基本指令:</p>
<hr>
<p>1 proxy_pass<br>设置代理服务器的协议和地址<br>proxy_pass URL<br>URL  为设置的代理服务器协议和地址<br>使用这个指令时要注意:<br>如果指令URL中变量不含有URI转向地址会只改变URL<br>如果指令URL中变量含有URI转向地址会全部改变<br>如果配置指令url后面带有/ 那么跳转同理<br>2 proxy_hide_header 指令<br>用于设置Nginx服务器发送http相应时,隐藏一些头域信息<br>proxy_hide_header field;<br>field 为需要隐藏的头域. 可以用于 http  server  localtion<br>3 proxy_pass_header 指令<br>默认Nginx 服务器在发送响应报文时,报文不包含 date server X-accel 等来自被代理服务器的头域信息,<br>该指令可以设置这些头域信息已被发送<br>proxy_pass_header filed;<br>field 为需要隐藏的头域. 可以用于 http  server  localtion<br>4 proxy_pass_request_body<br>配置是否将客户端请求体发送给代理服务器<br>proxy_pass_request_body on | off 可以用于 http server localtion<br>5 proxy_pass_request_header<br>配置是否将客户端的请求头发送给代理服务器<br>proxy_pass_request_header 可以用于 http server localtion<br>6 proxy_set_header<br>用于更改Nginx服务器接收到的客户端请求的请求头,然后将新的请求头发送给被代理服务器<br>proxy_set_header filed value<br>field 要更改的信息所在的头域<br>value  更改的值<br>7 proxy_set_body<br>更改Nginx服务器接收到的客户端请求的请求体信息,然后将新的请求体发送给被代理的服务器　<br>proxy_set_body value<br>value 为更改的信息<br>8 proxy_bind<br>强制将与代理主机的连接绑定到指定的ip主机<br>proxy_bind address<br>address 为IP地址<br>9 proxy_connect_timout<br>用于配置Nginx服务器与后端被代理服务器尝试连接的超时时间<br>proxy_connect_timout time 默认时间时60秒<br>10 proxy_read_timeout<br>用于配置Nginx服务器向后端被代理服务器(组)发出read请求后,等待响应的超时时间<br>proxy_read_timeout time; 默认时间时60秒<br>11 proxy_send_timeout<br>用于配置Nginx服务器向后端被代理服务器(组)发出write请求后,等待响应的超时时间<br>proxy_send_timeout time;默认时间时60秒<br>12 proxy_http_version<br>用于设置Nginx服务器提供代理服务器的HTTP协议版本<br>proxy_http_version 1.0 | 1.1 |2.0<br>13 proxy_method<br>用于设置Nginx服务器请求贝代理服务器使用的请求方法,设置了这个客户端的请求方法将会被忽略<br>proxy_method method<br>method 设置 POST | GET<br>14 proxy_ignore_client_abort<br>用于设置在客户端中断网络请求的时候,Nginx服务器是否中断对被代理服务器的请求,<br>proxy_ignore_client_abort on | off<br>15 proxy_ignore_headers<br>用于设置一些HTTP相应头的头域,<br>proxy_ignore_headers filed …<br>filed 为要设置的HTTP相应头的头域信息,例如”X-Accel-Redirect” “X-Accel-Expires” “Expores “  “Cache-Control “ “Set-Cookie”<br>16 proxy_redirect<br>用于修改被代理服务器返回的相应头中的location和Refresh 与 proxy_pass指令配合使用<br>语法结构:<br>proxy_redirect redirect replacement<br>proxy_redirect default<br>proxy_redirect　 off<br>redirect  匹配localtion头域值的字符串<br>replacement 用于替换redirect变量的字符串<br>假设前端url是example.com.后端server域名是csdn123.com,那么后端server在返回refresh或location的时候,host为csdn123.com,显然这个信息直接返回给客户端是不行的,需要nginx做转换,这时可以设置:<br>proxy_redirect <a href="http://csdn123.com/">http://csdn123.com</a><br>nginx会将host及port部分替换成自身的server_name及listen port.不过这种配置对server_name有多个值的情况下支持不好.<br>我们可以用nginx内部变量来解决这一问题:<br>proxy_redirect <a href="http://csdn123.com/">http://csdn123.com</a> http://$host:$server_port<br>17 proxy_intercept_errors<br>配置一个状态的开启或者关闭<br>proxy_intercept_errors on | off<br>18 proxy_headers_hash_max_size<br>存放HTTP报文头的哈希表的容量<br>proxy_headers_hash_max_size size; 默认大小512<br>19 proxy_headers_hash_bucket_size<br>Nginx服务器申请存放HTTP报文头的哈希表容量的单位大小<br>proxy_headers_hash_max_size 64;<br>20 proxy_next_upstream<br>如果Nginx定义了 upstream 后端服务器组,如果组内有异常情况,将请求顺次交给下一个组内服务器处理<br>proxy_next_upstream status…<br>status: error,timeout,invalid_header,http_500 502 503 504 404,off<br>21 proxy_ssl_session_reuse<br>该指令用于配置是否使用基于SSL安全协议的会话连接(htts://)被代理服务器,<br>proxy_ssl_session_reuse on | off; 默认on<br>Proxy Buffer 指令详解:<br>22 proxy_buffering<br>用于配置是否启用或者关闭proxybuff<br>proxy_buffering on | off<br>23 proxy_buffers　<br>用于配置接收一次被代理服务器响应数据的Proxy Buffer个数和每个Buffer的大小.<br>proxy_buffers number size;<br>size一般设置为内存页大小.根据平台的不同,取值可能为4KB或者8KB<br>proxy_buffers 8 4KB|8KB;<br>24 proxy_buffer_size<br>用于配置从被代理服务器获取的第一部分响应数据的大小,默认为4k或者8k,保持与proxy_buffers指令中的size变量相同.<br>25 proxy_busy_buffers_size<br>用于限制同时处于BUSY状态的Proxy Buffer的总大小.<br>proxy_busy_buffers_size size;<br>size为设置处于BUSY状态的缓存区总大小.默认为8KB或者16KB.<br>26 proxy_temp_path<br>用于配置磁盘上的一个文件路径,用于临时存放被代理服务器的大体积响应数据.如果Proxy Buffer被装满后,响应数据仍然没有被Nginx服务器完全接收,之后响应的数据就会被临时存放在该文件中.语法结构为:<br>proxy_temp_path path [level1 [level2 [level3]]]<br>path 磁盘上临时存放文件的路径<br>levelN 缓存文件存放在设置的路径的第几级hash目录中<br>27 proxy_max_temp_file_size<br>用于设置所有临时文件的总大小.<br>proxy_max_temp_file_size size;<br>默认为:1024MB<br>28 proxy_temp_file_write_size<br>用于配置同时写入临时文件的数据量的总大小<br>proxy_temp_file_write_size size;<br>默认设置根据平台的不同,可以为8KB或者16KB,一般与平台的内存也大小相同.<br>Proxy Cache 配置指令　　　　　　　　<br>29 proxy_cache<br>用于配置一块公用的内存区域的名称,该区域可以存放缓存的索引数据.这些数据在Nginx服务器启动时由缓存索引重建进程负责建立,在Nginx服务器的整个运行过程中由缓存管理进程负责定时检查过期数据、检索等管理工作.语法结构为:<br>proxy_cache zone | off;<br>zone 设置用于存放缓存索引的内存区域的名称<br>off 关闭proxy_cache功能,默认设置<br>30 proxy_cache_bypass<br>用于配置Nginx在响应客户端时不从缓存中获取数据的条件.语法结构为:<br>proxy_cache_bypass string …;<br>string为条件变量,支持配置多个,当至少有一个字符串指令不为空或者不等于0时,响应数据不从缓存中获取.<br>例子:<br>proxy_cache_bypass $cookie_nocache $arg_nocache $arg_comment $http_pragma $http_authorization;<br>31 proxy_cache_key<br>用于配置Nginx服务器在内存中为缓存数据建立索引时使用的关键字.默认为:<br>proxy_cache_key $scheme$proxy_host$uri$is_args$args<br>proxy_cache_lock<br>用于配置是否开启缓存的锁功能.在缓存中,某些数据项可以同时被多个请求返回的响应数据填充,开启该功能后,Nginx服务器同时只能有一个请求填充缓存中的某一数据项.如果其他请求也想填充该数据项,必须等待该数据项的锁被释放.这个等待的时间由proxy_cache_lock_timeout指令设置.<br>默认值为off,表示关闭锁功能.<br>32 proxy_cache_lock_timeout<br>用于配置开启锁功能以后锁的超时时间.默认为5s.<br>33 proxy_cache_in_uses<br>当客户端向被代理的服务器发送相同的请求达到该指令设定的次数后,Nginx服务器才对该其更年期的响应数据做缓存.默认为1<br>34 proxy_cache_path<br>用于设置Nginx服务器存储缓存数据的路径以及和缓存索引相关的内容,语法结构为:<br>proxy_cache_path path [levels=levels] keys_zone=name:size1 [inactive=time1] [max_size=size2] [loader_files=number] [loader_sleep=time2] [loader_threshold=time3];<br>path 设置缓存存放的根路径<br>levels 设置相对于path指定目录的第几级hash目录中缓存数据.levels=1,表示一级hash目录;levels=1:2,表示两极目录,以此类推.该目录是基于请求URL通过哈希算法得到的.<br>name:size1 Nginx服务器的缓存索引重建进程在内存中为缓存数据建立索引,这一对变量用来设置存放缓存索引的内存区域的名称和大小.<br>time1 设置强制更新缓存数据的时间,当缓存数据在设定的时间内没有被访问时,Nginx服务器就强制从硬盘上将其删除,下次客户端访问该数据时重新缓存.默认为10s.<br>size2 设置缓存数据大小.当缓存的大小超过该变量的设置时,索引管理进程将根据最近最少被访问的策略删除缓存.<br>number 设置缓存索引重建进程每次加载的数据元素的数量上限.默认为100<br>time2 设置缓存索引重建进程在一次遍历结束后下一次遍历开始之间暂停的时长,默认为50ms.<br>time3 设置遍历一次磁盘缓存源数据的时间上限.默认为200ms.<br>该指令比较复杂,一般需要设置前面3个指令的情形比较多,后面几个变量与Nginx服务器缓存索引重建进程以及管理进程性能有关,一般情况下保持默认设置就可以了.<br>例子:<br>proxy_cache_path /data/nginx/cache/a levels=1 keys_zone=a:10m;<br>proxy_cache_path /data/nginx/cache/b levels=2:2 keys_zone=b:100m;<br>proxy_cache_path /data/nginx/cache/c levels=1:1:2 keys_zone=c:1000m;<br>==该指令只能放在http块中==<br>35 proxy_cache_use_stale<br>指定在那种情况下,当被代理的服务器无法访问或者访问错误等现象时,Nginx服务器可以使用历史缓存响应客户端的请求.语法结构为:<br>proxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | off …;<br>默认为off<br>36 proxy_cache_valid<br>该指令可以针对不能的HTTP响应状态设置不同的缓存时间,语法结构为:<br>proxy_cache_valid [code …] time;<br>code 设置HTTP响应的状态码,可选,默认只为响应吗是200 301 302的响应数据做缓存.可以使用 ‘any’ 表示缓存所有该指令中未设定的其他响应数据<br>time 缓存时间<br>例子:<br>proxy_cache_valid 200 302 10m;<br>proxy_cache_valid 301 1h;<br>proxy_cache_valid any 10m;<br>第三个例子表示对返回状态为不是200 301 302的响应数据缓存10分钟.<br>37 proxy_no_cache<br>配置在什么情况下不使用cache功能.语法结构为:<br>proxy_no_cache string …;<br>其中,string可以是一个或者多个变量,当string的值不为空或者不为’0’时,不启用cache功能.<br>38 proxy_store<br>配置是否在本地磁盘缓存来自被代理服务器的响应数据.语法结构为:<br>39 proxy_store on | off | string;<br>on | off 设置是否开启Proxy Store功能.如果开启,缓存文件会存放到alias指令或root指令设置的本地路径.默认为off<br>string 自定义缓存文件存放路径.使用该配置时,默认开启Proxy Store.<br>40 proxy_store_access<br>用于设置用户或用户组对Proxy Store缓存文件的访问权限,语法结构为:<br>proxy_store_access users:permissions …;<br>users 可以设置为user、group或者all<br>permission 设置方位权限<br>例子:<br>proxy_store on;<br>proxy_store_access user:rw group:rw all:r;<br>root /data/www;</p>
]]></content>
  </entry>
  <entry>
    <title>nginx防盗链配置</title>
    <url>/2015/01/20/1305/</url>
    <content><![CDATA[<p>判断一个请求的Referer可以有效的防止盗链,使用nginx相应的HTTP Referer模块(HTTP Referer)可以实现此功能. 当一个请求头的Referer字段中包含一些非正确的字段,这个模块可以禁止这个请求访问站点. 这个头可以随意的伪造,因此,使用这个模块并不能100%的阻止这些请求,绝大多数拒绝的请求来自一些典型的浏览器,可以认为这些典型的浏览器并不能提供一个”Referer”头,甚至是那些正确的请求. 如下例:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">location <span class="regexp">/photos/</span> &#123;</span><br><span class="line">    valid_referers none blocked www.mydomain.com mydomain.com;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        return?? <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里只有一个重要的指令valid_referers: 这个指令在referer头的基础上为 $invalid_referer 变量赋值,其值为0或1. 可以使用这个指令来实现防盗链功能,如果valid_referers列表中没有Referer头的值, $invalid_referer将被设置为1(参照前例). 参数可以使如下形式:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">none</span>意为不存在的Referer头</span><br><span class="line"><span class="attribute">blocked</span>意为根据防火墙伪装Referer头,如:<span class="string">&quot;Referer: XXXXXXX&quot;</span>.</span><br><span class="line"><span class="attribute">server_names</span>为一个或多个服务器的列表,<span class="number">0</span>.<span class="number">5</span>.<span class="number">33</span>版本以后可以在名称中使用<span class="string">&quot;*&quot;</span>通配符.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx反向代理</title>
    <url>/2018/02/25/1303/</url>
    <content><![CDATA[<p>首先在nginx的配置文件nginx.conf的http模块中添加,服务器集群server cluster(我们这里是两台)的定义:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> myCluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:80</span> ;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">158.37.70.143:80</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表示这个server cluster包含2台服务器&gt;然后在server模块中定义,负载均衡:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ .php$</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://myCluster ; <span class="comment">#这里的名字和上面的cluster的名字相同</span></span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的话,如果访问<a href="http://localhost:8080/test.php">http://localhost:8080/test.php</a> 页面的话,nginx目录下根本没有该文件,但是它会自动将其pass到myCluster定义的服务区机群中,分别由127.0.0.1:80;或者158.37.70.143:80;来做处理.上面在定义upstream的时候每个server之后没有定义权重,表示两者均衡;如果希望某个更多响应的话例如:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> myCluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:80</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">158.37.70.143:80</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx简单负载均衡</title>
    <url>/2018/05/11/1306/</url>
    <content><![CDATA[<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">worker_processes <span class="number">1</span>;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line">http&#123;</span><br><span class="line">    upstream myproject &#123;</span><br><span class="line">    <span class="meta">#这里指定多个源服务器,ip:端口,80端口的话可写可不写</span></span><br><span class="line">    <span class="keyword">server</span> <span class="number">192.168</span><span class="number">.43</span><span class="number">.158</span>:<span class="number">80</span>;</span><br><span class="line">    <span class="keyword">server</span> <span class="number">192.168</span><span class="number">.41</span><span class="number">.167</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">server</span> &#123;</span><br><span class="line">        listen <span class="number">8080</span>;</span><br><span class="line">        location / &#123;</span><br><span class="line">             proxy_pass http:<span class="comment">//myproject;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>```</p>
]]></content>
  </entry>
  <entry>
    <title>nginx配置优化</title>
    <url>/2018/09/28/1307/</url>
    <content><![CDATA[<p>1、Nginx 运行工作进程个数</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">worker_processes</span> <span class="number">4</span><span class="string">;</span>                           <span class="comment">#工作进程,建议和cpu核心数一致</span></span><br><span class="line"><span class="string">worker_cpu_affinity</span> <span class="number">0001 </span><span class="number">0010 </span><span class="number">0100 </span><span class="number">1000</span>       <span class="comment">#cpu亲和力设置</span></span><br></pre></td></tr></table></figure>

<p>2、Nginx 事件处理模型</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">events</span> &#123;                                      <span class="comment">#events:提供配置文件上下文,其中指定了影响连接处理的指令.</span></span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;                                <span class="comment">#使用epoll事件处理模型</span></span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">65535</span>;                 <span class="comment">#单个worker_processes支持的最大连接</span></span><br><span class="line">    <span class="attribute">multi_accept</span> <span class="literal">on</span>;                          <span class="comment">#worker_processes一次接受所有连接</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、开启高效传输模式</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">http &#123;                                        <span class="comment">#提供指定的HTTP服务器指令的配置文件上下文</span></span><br><span class="line">    include mime.types;                       <span class="comment">#支持所有mime类型</span></span><br><span class="line">    default_type <span class="built_in">application</span>/octet-stream;    <span class="comment">#默认流的类型</span></span><br><span class="line">    ……</span><br><span class="line">    sendfile <span class="keyword">on</span>;                              <span class="comment">#开启高效传输模式</span></span><br><span class="line">    tcp_nopush <span class="keyword">on</span>;                            <span class="comment">#告诉 nginx 在一个数据包里发送所有头文件,可防止网络阻塞</span></span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、连接超时时间</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">60</span>;                         <span class="comment">#长连接超时时间60s</span></span><br><span class="line"><span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;                               <span class="comment">#防止网络阻塞</span></span><br><span class="line"><span class="attribute">client_header_buffer_size</span> <span class="number">4k</span>;                 <span class="comment">#客户端请求头部的缓冲区大小</span></span><br><span class="line"><span class="attribute">open_file_cache</span> max=<span class="number">102400</span> inactive=<span class="number">20s</span>;      <span class="comment">#打开文件的缓存大小,最大100M,活跃时间20s</span></span><br><span class="line"><span class="attribute">open_file_cache_valid</span> <span class="number">30s</span>;                    <span class="comment">#缓存有效时间30s</span></span><br><span class="line"><span class="attribute">open_file_cache_min_uses</span> <span class="number">1</span>;                   <span class="comment">#最少打开一个文件进行缓存</span></span><br><span class="line"><span class="attribute">client_header_timeout</span> <span class="number">15</span>;                     <span class="comment">#请求头超时时间</span></span><br><span class="line"><span class="attribute">client_body_timeout</span> <span class="number">15</span>;                       <span class="comment">#请求体超时时间</span></span><br><span class="line"><span class="attribute">reset_timedout_connection</span> <span class="literal">on</span>;                 <span class="comment">#关闭不响应的客户端连接</span></span><br><span class="line"><span class="attribute">send_timeout</span> <span class="number">15</span>;                              <span class="comment">#发送超时时间</span></span><br><span class="line"><span class="attribute">server_tokens</span> <span class="literal">off</span>;                            <span class="comment">#不显示nginx的版本</span></span><br><span class="line"><span class="attribute">client_max_body_size</span> <span class="number">10m</span>;                     <span class="comment">#上传文件的大小限制</span></span><br></pre></td></tr></table></figure>

<p>5、fastcgi连接优化</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fastcgi_connect_timeout</span> <span class="number">600</span>;                  #指定连接后端fastcgi超时时间</span><br><span class="line"><span class="attribute">fastcgi_send_timeout</span> <span class="number">600</span>;                     #向fastcg发送请求超时时间</span><br><span class="line"><span class="attribute">fastcgi_read_timeout</span> <span class="number">600</span>;                     #接收fastcgi应答的超时时间</span><br><span class="line"><span class="attribute">fastcgi_buffer_size</span> <span class="number">64</span>k;                      #缓冲区大小</span><br><span class="line"><span class="attribute">fastcgi_buffers</span> <span class="number">4</span> <span class="number">64</span>k;                        #给fastcgi分配<span class="number">4</span>个缓冲区,每个<span class="number">64</span>K</span><br><span class="line"><span class="attribute">fastcgi_busy_buffers_size</span> <span class="number">128</span>k;               #fastcgi忙碌时的缓冲区大小</span><br><span class="line"><span class="attribute">fastcgi_temp_file_write_size</span> <span class="number">128</span>k;            #临时写文件的目录大小</span><br><span class="line"><span class="attribute">fastcgi_temp_path</span> /tmp/nginx_tmp;             #临时写文件的路径</span><br><span class="line"><span class="attribute">fastcgi_intercept_errors</span> <span class="literal">on</span>;                  #允许发送错误到客户端,(php页面不存在默认返回空白页)</span><br><span class="line"><span class="attribute">fastcgi_cache_path</span> /usr/local/nginx<span class="number">1</span>.<span class="number">10</span>/fastcgi_cache levels=<span class="number">1</span>:<span class="number">2</span> keys_zone=cache_fastcgi:<span class="number">128</span>m inactive=<span class="number">1</span>d max_size=<span class="number">10</span>g;                                     #设置缓存路径、目录层级为<span class="number">16</span>*<span class="number">256</span>个子目录、缓存区名称为cache_fastcgi,大小<span class="number">128</span>M,有效期一天,最大缓存<span class="number">10</span>G.</span><br></pre></td></tr></table></figure>

<p>6、gzip压缩</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;                                     <span class="comment">#开启gzip</span></span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">2k</span>;                          <span class="comment">#最小压缩大小2k,也就是只要超过2k就进行压缩</span></span><br><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">32k</span>;                          <span class="comment">#压缩缓冲区大小32k,4个</span></span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;                       <span class="comment">#gzip版本</span></span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">6</span>;                           <span class="comment">#压缩级别6</span></span><br><span class="line"><span class="attribute">gzip_types</span> text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;                           <span class="comment">#以上的那些格式的数据进行压缩</span></span><br><span class="line"><span class="attribute">gzip_vary</span> <span class="literal">on</span>;                                <span class="comment">#加&quot;Vary:Accept-Encoding&quot;响应头字段,为了让前端的代理识别是压缩数据 </span></span><br><span class="line"><span class="attribute">gzip_proxied</span> any;                            <span class="comment">#为所有代理请求启用压缩</span></span><br></pre></td></tr></table></figure>

<p>7、expires头缓存</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(ico|jpeg|png|bmp|swf|flv)$</span> &#123;  <span class="comment">#匹配以.ico.jpg.jpeg.gif.png.bmp.swf.flv结尾的文件</span></span><br><span class="line">    <span class="attribute">expires</span> <span class="number">30d</span>;                             <span class="comment">#缓存30天</span></span><br><span class="line">    <span class="comment">#log_not_found off;</span></span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;                          <span class="comment">#不记录成功日志</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(js|css)$</span> &#123;                    <span class="comment">#匹配.js.css结尾的</span></span><br><span class="line">    <span class="attribute">expires</span> <span class="number">7d</span>;                              <span class="comment">#缓存7天</span></span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;                          <span class="comment">#不记录日志</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8、防盗链</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">location ~* ^.+\.(jpg|gif|png|swf|flv)$ &#123;    <span class="comment">#匹配以任意多个字符开头中间带&quot;.&quot;并且以jpg gif png swf flv </span></span><br><span class="line">    wma wmv asf mp3 mmf zip rar结尾的</span><br><span class="line">    valid_referers none blocked zhangsan.com;<span class="comment">#定义变量valid_referers,当referer为空、或者为www.zhangsan.com、zhangsan.com为有效</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;                  <span class="comment">#如果referer无效时,也就是不是上面定义的</span></span><br><span class="line">        return <span class="number">302</span> http:<span class="regexp">//</span>zhangsan.com<span class="regexp">/img/</span>nolink.jpg;</span><br><span class="line">                                             <span class="comment">#返回302,指定一个图片位置(你可以给一个警告的图片)</span></span><br><span class="line">        return <span class="number">404</span>;                          <span class="comment">#返回404</span></span><br><span class="line">        <span class="keyword">break</span>;                               <span class="comment">#if语句的结束</span></span><br><span class="line">    &#125;</span><br><span class="line">access_log off;                              <span class="comment">#不记录日志</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9、内核参数</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vim</span> /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="attribute">fs</span>.file-max = <span class="number">999999</span>                        #打开文件的句柄数</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_forward = <span class="number">0</span>                     #打开ipv<span class="number">4</span>路由转发</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.conf.default.rp_filter = <span class="number">1</span>         #启用源路由核查功能</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.conf.default.accept_source_route = <span class="number">0</span></span><br><span class="line">                                            <span class="comment">#禁用所有IP源路由</span></span><br><span class="line"><span class="attribute">kernel</span>.sysrq = <span class="number">0</span>                            #使用sysrq组合键是了解系统目前运行情况,为安全起见设为<span class="number">0</span>关闭</span><br><span class="line"><span class="attribute">kernel</span>.core_uses_pid = <span class="number">1</span>                    #控制core文件的文件名是否添加pid作为扩展</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syncookies = <span class="number">1</span>                 #启SYN Cookies,当出现SYN等待队列溢出时,启用cookies来处理</span><br><span class="line"><span class="attribute">kernel</span>.msgmnb = <span class="number">65536</span>                       #每个消息队列的大小(单位:字节)限制</span><br><span class="line"><span class="attribute">kernel</span>.msgmax = <span class="number">65536</span>                       #整个系统最大消息队列数量限制</span><br><span class="line"><span class="attribute">kernel</span>.shmmax = <span class="number">68719476736</span>                 #单个共享内存段的大小</span><br><span class="line"><span class="attribute">kernel</span>.shmall = <span class="number">4294967296</span>                  #所有内存大小</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_tw_buckets = <span class="number">6000</span>          #timewait的数量,默认是<span class="number">180000</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_sack = <span class="number">1</span>                       #开启有选择的应答</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_window_scaling = <span class="number">1</span>             #支持更大的TCP窗口. 如果TCP窗口最大超过<span class="number">65535</span>(<span class="number">64</span>K), 必须设置该数值为<span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_rmem = <span class="number">10240</span> <span class="number">87380</span> <span class="number">12582912</span>    #TCP读buffer</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_wmem = <span class="number">10240</span> <span class="number">87380</span> <span class="number">12582912</span>    #TCP写buffer</span><br><span class="line"><span class="attribute">net</span>.core.wmem_default = <span class="number">8388608</span>             #为TCP socket预留用于发送缓冲的内存默认值(单位:字节)</span><br><span class="line"><span class="attribute">net</span>.core.rmem_default = <span class="number">8388608</span>             #为TCP socket预留用于接收缓冲的内存默认值(单位:字节)</span><br><span class="line"><span class="attribute">net</span>.core.rmem_max = <span class="number">16777216</span>                #为TCP socket预留用于接收缓冲的内存最大值(单位:字节)</span><br><span class="line"><span class="attribute">net</span>.core.wmem_max = <span class="number">16777216</span>                #为TCP socket预留用于发送缓冲的内存最大值(单位:字节)</span><br><span class="line"><span class="attribute">net</span>.core.netdev_max_backlog = <span class="number">262144</span>        #每个网络接口接收数据包的速率比内核处理这些包的速率快时,允许送到队列的数据包的最大数目</span><br><span class="line"><span class="attribute">net</span>.core.somaxconn = <span class="number">40960</span>                  #web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到<span class="number">128</span>,而nginx定义的NGX_LISTEN_BACKLOG默认为<span class="number">511</span>,所以有必要调整这个值</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_orphans = <span class="number">3276800</span>          #系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上.这个限制仅仅是为了防止简单的DoS×××,不能过分依靠它或者人为地减小这个值,更应该增加这个值(如果增加了内存之后)</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">262144</span>       #记录的那些尚未收到客户端确认信息的连接请求的最大值.对于有<span class="number">128</span>M内存的系统而言,缺省值是<span class="number">1024</span>,小内存的系统则是<span class="number">128</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_timestamps = <span class="number">0</span>                 #时间戳可以避免序列号的卷绕.一个<span class="number">1</span>Gbps的链路肯定会遇到以前用过的序列号.时间戳能够让内核接受这种<span class="string">&quot;异常&quot;</span>的数据包.这里需要将其关掉</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_synack_retries = <span class="number">1</span>             #为了打开对端的连接,内核需要发送一个SYN并附带一个回应前面一个SYN的ACK.也就是所谓三次握手中的第二次握手.这个设置决定了内核放弃连接之前发送SYN+ACK包的数量</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syn_retries = <span class="number">1</span>                #在内核放弃建立连接之前发送SYN包的数量</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_recycle = <span class="number">1</span>                 #开启TCP连接中time_wait sockets的快速回收</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span>                   #开启TCP连接复用功能,允许将time_wait sockets重新用于新的TCP连接(主要针对time_wait连接)</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_mem = <span class="number">94500000</span> <span class="number">915000000</span> <span class="number">927000000</span></span><br><span class="line">                                           <span class="comment">#1st低于此值,TCP没有内存压力,2nd进入内存压力阶段,3rdTCP拒绝分配socket(单位:内存页)</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout = <span class="number">1</span>               #如果套接字由本端要求关闭,这个参数决定了它保持在FIN-WAIT-<span class="number">2</span>状态的时间.对端可以出错并永远不关闭连接,甚至意外当机.缺省值是<span class="number">60</span> 秒.<span class="number">2</span>.<span class="number">2</span> 内核的通常值是<span class="number">180</span>秒,你可以按这个设置,但要记住的是,即使你的机器是一个轻载的WEB服务器,也有因为大量的死套接字而内存溢出的风险,FIN- WAIT-<span class="number">2</span>的危险性比FIN-WAIT-<span class="number">1</span>要小,因为它最多只能吃掉<span class="number">1</span>.<span class="number">5</span>K内存,但是它们的生存期长些.</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_keepalive_time = <span class="number">30</span>           #表示当keepalive起用的时候,TCP发送keepalive消息的频度(单位:秒)</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_local_port_range = <span class="number">1024</span> <span class="number">65000</span>  #对外连接端口范围</span><br></pre></td></tr></table></figure>

<p>10、关于系统连接数的优化<br>在 <code>/etc/security/limits.conf</code> 最后增加:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">vim /etc/security/limits</span><br><span class="line"></span><br><span class="line">* soft nofile<span class="number"> 65535 </span>                       <span class="comment">#软限制打开最大文件数65535</span></span><br><span class="line">* hard nofile<span class="number"> 65535 </span>                       <span class="comment">#硬限制打开最大文件数65535</span></span><br><span class="line">* soft noproc<span class="number"> 65535 </span>                       <span class="comment">#软限制打开最大进程数65535</span></span><br><span class="line">* hard noproc<span class="number"> 65535 </span>                       <span class="comment">#硬限制打开最大进程数65535</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx实现ip访问跳转域名首页</title>
    <url>/2013/07/22/1308/</url>
    <content><![CDATA[<p>编辑nginx的配置文件 <code>nginx.conf</code> 修改下面:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">173.252.192.205</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://w91838.s85.chinaccnet.cn <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>server段为这个样子就可以了,域名根据自己需要修改.</p>
]]></content>
  </entry>
  <entry>
    <title>nginx实现图片防盗链</title>
    <url>/2018/06/05/1309/</url>
    <content><![CDATA[<p>好久没写文章了,这次写的是如果用nginx实现防止图片盗链.<br>一共有两种方法,直接写到nginx的配置文件里就可以了.</p>
<p>一,针对后缀实行防盗链</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">location ~*\.(gif|<span class="type">jpg</span>|<span class="type">jpeg</span>|<span class="type">png</span>|<span class="type">bmp</span>|<span class="type">txt</span>|<span class="type">zip</span>|<span class="type">jar</span>|<span class="type">swf</span>)$ &#123;</span><br><span class="line">    valid_referers none blocled *.mynginx.com;</span><br><span class="line">    <span class="keyword">if</span> ($invalid_referer) &#123;</span><br><span class="line">        <span class="built_in">rewrite</span> ^/ http://www.mynginx.com/daolian.gif;</span><br><span class="line">        #<span class="keyword">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>二,针对图片目录实行防盗链</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /images/ &#123;</span><br><span class="line">    <span class="attribute">alias</span> /data/images/;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> .dujiaoniu.com;</span><br><span class="line">    <span class="attribute">if</span> ($invalid_referer) &#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.mynginx.com/daolian.gif;</span><br><span class="line">        <span class="comment">#return 403;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就可以防止被人盗链你网站的图片了.</p>
]]></content>
  </entry>
  <entry>
    <title>nginx网页只有指定ip才能访问</title>
    <url>/2013/03/23/1310/</url>
    <content><![CDATA[<p>让nginx服务器上的某个页面只有指定ip才能访问,只需要在server内添加如下字段即可.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">location</span> /nginxallstatus &#123;</span><br><span class="line">        <span class="attribute">stub_status</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">allow</span> <span class="number">60.195.252.106</span>;</span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>nginx做负载均衡时其中一台服务器挂掉宕机时响应速度慢的问题解决</title>
    <url>/2019/07/03/1311/</url>
    <content><![CDATA[<p>nginx会根据预先设置的权重转发请求,<br>若给某一台服务器转发请求时,达到默认超时时间未响应,则再向另一台服务器转发请求.<br>默认超时时间1分钟.<br>修改默认超时时间为1s:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">        listen       <span class="number">80</span>; </span><br><span class="line">        <span class="comment">#server_name  localhost; </span></span><br><span class="line">        server_name  www.wuwh.com; </span><br><span class="line"></span><br><span class="line">        location / &#123;  </span><br><span class="line">        <span class="comment">#proxy_pass         http://www.wuwh.com ;; </span></span><br><span class="line">        proxy_pass         http:<span class="regexp">//</span>www.wu.com ;; </span><br><span class="line">        proxy_set_header   Host             <span class="variable">$host</span>;  </span><br><span class="line">        proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;  </span><br><span class="line">        proxy_set_header   X-Forwarded-For  </span><br><span class="line">        <span class="variable">$proxy_add_x_forwarded_for</span>;  </span><br><span class="line">        proxy_connect_timeout <span class="number">1</span>; </span><br><span class="line">        proxy_read_timeout <span class="number">1</span>; </span><br><span class="line">        proxy_send_timeout <span class="number">1</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>No module dm-mem-cache found for kernel 2.6.27, aborting.</title>
    <url>/2015/02/15/1312/</url>
    <content><![CDATA[<p>执行mkinitrd命令时,提示:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;No module dm-mem-cache found for kernel 2.6.27, aborting.&quot;</span></span><br></pre></td></tr></table></figure>

<p>表明该版本的mkinitrd有bug.<br>解决方法,1是当使用mkinitrd时,使用”-without-dmraid”这个参数.2是在使用mkinitrd之前,先创建一个noraid文件.创建方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ echo <span class="string">&quot;DMRAID=no&quot;</span> &gt; <span class="regexp">/etc/</span>sysconfig<span class="regexp">/mkinitrd/</span>noraid</span><br><span class="line">$ chmod <span class="number">755</span> <span class="regexp">/etc/</span>sysconfig<span class="regexp">/mkinitrd/</span>noraid</span><br></pre></td></tr></table></figure>

<p>然后再运行mkinitrd命令.</p>
]]></content>
  </entry>
  <entry>
    <title>no such file to load -- application (MissingSourceFile)</title>
    <url>/2009/04/04/1313/</url>
    <content><![CDATA[<p>2019年8月15日更新:<br>今天发现这片文章,应该是本站最早的一片文章了,应该是我在上大二的时候.<br>那年我刚刚拥有自己的第一台笔记本电脑.</p>
<p>历史内容:<br>尝试:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mv app<span class="regexp">/controllers/</span>application_controller.rb app<span class="regexp">/controllers/</span>application.rb</span><br></pre></td></tr></table></figure>

<p>问题解决.</p>
]]></content>
  </entry>
  <entry>
    <title>no such file to load -- zlib</title>
    <url>/2018/10/27/1315/</url>
    <content><![CDATA[<p>安装了rubygems后,gem list出现如下错误.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ gem list</span><br><span class="line"></span><br><span class="line">/usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_requir<span class="string">e&#x27;: no such file to load -- zlib (LoadError)</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/spec_fetcher.rb:<span class="number">1</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_requir<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/commands/query_command.rb:<span class="number">3</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_requir<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/commands/list_command.rb:<span class="number">2</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_requir<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/command_manager.rb:<span class="number">167</span>:<span class="keyword">in</span> `load_and_instantiat<span class="string">e&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:88:in `[]&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/command_manager.rb:<span class="number">144</span>:<span class="keyword">in</span> `find_command<span class="string">&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/command_manager.rb:131:in `process_args&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/lib/ruby/site_ruby/<span class="number">1.8</span>/rubygems/command_manager.rb:<span class="number">102</span>:<span class="keyword">in</span> `run<span class="string">&#x27;</span></span><br><span class="line"><span class="string">from /usr/local/ruby/lib/ruby/site_ruby/1.8/rubygems/gem_runner.rb:58:in `run&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/<span class="keyword">local</span>/ruby/bin/gem:<span class="number">21</span></span><br></pre></td></tr></table></figure>

<p>原因是缺少zlib、zlib-devel,一下是解决办法:</p>
<p>1、查看zlib、zlib-devel是否存在</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="literal">zlib</span>]<span class="comment"># rpm -qa|grep zlib</span></span><br><span class="line"><span class="literal">zlib</span>-<span class="number">1.2</span>.<span class="number">3</span>-<span class="number">3</span></span><br><span class="line"><span class="literal">zlib</span>-<span class="number">1.2</span>.<span class="number">3</span>-<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>2、发现缺少zlib-devel,安装zlib-devel</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> zlib-devel</span><br></pre></td></tr></table></figure>

<p>3、进入ruby安装路径,重新编译安装zlib</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/usr/</span>local<span class="regexp">/src/</span>ruby-<span class="number">1.8</span>.<span class="number">7</span>-p72<span class="regexp">/ext/</span>zlib</span><br><span class="line">$ ruby ./extconf.rb</span><br><span class="line"></span><br><span class="line">checking <span class="keyword">for</span> deflateReset() <span class="keyword">in</span> -lz... yes</span><br><span class="line">checking <span class="keyword">for</span> zlib.h... yes</span><br><span class="line">checking <span class="keyword">for</span> kind of operating system... Unix</span><br><span class="line">creating Makefile</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line"></span><br><span class="line">gcc -I. -I. -I<span class="regexp">/usr/</span>local<span class="regexp">/ruby/</span>lib<span class="regexp">/ruby/</span><span class="number">1.8</span>/x86_64-linux -I. -DHAVE_ZLIB_H  -DOS_CODE=OS_UNIX    -fPIC -g -O2   -c zlib.c</span><br><span class="line">gcc -shared -o zlib.so zlib.o -L. -L<span class="regexp">/usr/</span>local<span class="regexp">/ruby/</span>lib -Wl,-R<span class="regexp">/usr/</span>local<span class="regexp">/ruby/</span>lib -L.  -rdynamic -Wl,-export-dynamic    -lz  -ldl -lcrypt -lm   -lc</span><br><span class="line">[root@localhost zlib]<span class="comment"># make install</span></span><br><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/install -c -m 0755 zlib.so /u</span>sr<span class="regexp">/local/</span>ruby<span class="regexp">/lib/</span>ruby<span class="regexp">/site_ruby/</span><span class="number">1.8</span>/x86_64-linux</span><br></pre></td></tr></table></figure>

<p>4、查看一下,已经正常了</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">$ gem list</span><br><span class="line"><span class="bullet">*** </span>LOCAL GEMS <span class="strong">***</span></span><br></pre></td></tr></table></figure>

<p>centos 安装程序是使用yum,opensuse是zypper,ubuntu是apt-get 请根据自己系统情况选择.</p>
]]></content>
  </entry>
  <entry>
    <title>no such file to load -- spec</title>
    <url>/2013/08/25/1314/</url>
    <content><![CDATA[<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">gem <span class="keyword">install</span> rspec-rails</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>OpenSSL support for Ruby... not found</title>
    <url>/2017/12/10/1317/</url>
    <content><![CDATA[<p>错误代码:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">Checking for required software.<span class="string">..</span></span><br><span class="line"></span><br><span class="line">* GNU C++ compiler.<span class="string">..</span> found at <span class="string">/usr/bin/g</span>++</span><br><span class="line">* Curl development headers with SSL support.<span class="string">..</span> found</span><br><span class="line">* OpenSSL development headers.<span class="string">..</span> found</span><br><span class="line">* Zlib development headers.<span class="string">..</span> found</span><br><span class="line">* Ruby development headers.<span class="string">..</span> found</span><br><span class="line">* OpenSSL support for Ruby.<span class="string">..</span> not found</span><br><span class="line">* RubyGems.<span class="string">..</span> found</span><br><span class="line">* Rake.<span class="string">..</span> found at <span class="string">/home/sammy/.rvm/wrappers/ruby-1.9.2-p180/rake</span></span><br><span class="line">* rack.<span class="string">..</span> found</span><br><span class="line">* Apache 2.<span class="string">..</span> found at <span class="string">/usr/sbin/apache2</span></span><br><span class="line">* Apache 2 development headers.<span class="string">..</span> found at <span class="string">/usr/bin/apxs2</span></span><br><span class="line">* Apache Portable Runtime <span class="params">(APR)</span> development headers.<span class="string">..</span> found at <span class="string">/usr/bin/apr-1-config</span></span><br><span class="line">* Apache Portable Runtime Utility <span class="params">(APU)</span> development headers.<span class="string">..</span> found at <span class="string">/usr/bin/apu-1-config</span></span><br><span class="line"></span><br><span class="line">Some required software is not installed.</span><br><span class="line">But don&#x27;t worry, this installer will tell you how to install them.</span><br><span class="line"></span><br><span class="line">Press Enter to continue, or Ctrl-C to abort.</span><br></pre></td></tr></table></figure>

<p>找不到 OpenSSL support for Ruby.</p>
<p>解決方式:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> $HOME</span><br><span class="line"><span class="keyword">cd</span> .rvm/src/<span class="keyword">ruby</span>-<span class="number">1.9</span>.<span class="number">2</span>-p0/ext/openssl</span><br><span class="line"><span class="keyword">ruby</span> extconf.rb</span><br><span class="line"><span class="keyword">make</span></span><br><span class="line"><span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ntp服务的安装和设置</title>
    <url>/2019/05/02/1316/</url>
    <content><![CDATA[<p>服务器时间的手动设置</p>
<p>查看时刻:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># date</span></span><br><span class="line"><span class="number">2011</span>年 <span class="number">02</span>月 <span class="number">26</span>日 星期六 <span class="number">21</span>:<span class="number">45</span>:<span class="number">09</span> CST</span><br></pre></td></tr></table></figure>

<p>修改时间:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># date -s 2011/02/28</span></span><br><span class="line"><span class="number">2011</span>年 <span class="number">02</span>月 <span class="number">28</span>日 星期一 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> CST</span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># date -s 08:31:15</span></span><br><span class="line"><span class="number">2011</span>年 <span class="number">02</span>月 <span class="number">28</span>日 星期一 <span class="number">08</span>:<span class="number">31</span>:<span class="number">15</span> CST</span><br><span class="line"><span class="literal">or</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># date -s <span class="string">&quot;2011/02/28 08:31:15&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>ntp服务的安装</p>
<p>安装:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># yum install ntp</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># rpm -qa|grep ntp</span></span><br><span class="line">ntp<span class="number">-4.2</span><span class="number">.2</span>p1<span class="number">-9.</span>el5.centos<span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>ntp时间服务器的设置:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="meta"># vi /etc/ntp.conf</span></span><br><span class="line"><span class="keyword">server</span> <span class="number">0.</span>centos.pool.ntp.org</span><br><span class="line"><span class="keyword">server</span> <span class="number">1.</span>centos.pool.ntp.org</span><br><span class="line"><span class="keyword">server</span> <span class="number">2.</span>centos.pool.ntp.org</span><br><span class="line"><span class="keyword">server</span> <span class="number">130.69</span><span class="number">.251</span><span class="number">.23</span>?? <span class="meta">#可以在此处添加</span></span><br></pre></td></tr></table></figure>

<p>ntp服务启动/关闭/重启:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># service ntpd start</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># service ntpd stop</span></span><br><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># service ntpd restart</span></span><br></pre></td></tr></table></figure>

<p>开机自动启动设置:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># chkconfig ntpd on</span></span><br><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># chkconfig --list ntpd</span></span><br><span class="line">ntpd?<span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span> <span class="number">0</span><span class="symbol">:</span>关闭? <span class="number">1</span><span class="symbol">:</span>关闭? <span class="number">2</span><span class="symbol">:</span>启用? <span class="number">3</span><span class="symbol">:</span>启用? <span class="number">4</span><span class="symbol">:</span>启用? <span class="number">5</span><span class="symbol">:</span>启用? <span class="number">6</span><span class="symbol">:</span>关闭</span><br></pre></td></tr></table></figure>

<p>手动同步时间:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ntpdate</span> <span class="selector-tag">time</span><span class="selector-class">.windows</span><span class="selector-class">.com</span></span><br><span class="line"><span class="selector-tag">22</span> <span class="selector-tag">Mar</span> <span class="selector-tag">09</span>:<span class="selector-tag">45</span>:<span class="selector-tag">14</span> <span class="selector-tag">ntpdate</span><span class="selector-attr">[31325]</span>: <span class="selector-tag">step</span> <span class="selector-tag">time</span> <span class="selector-tag">server</span> <span class="selector-tag">207</span><span class="selector-class">.46</span><span class="selector-class">.232</span><span class="selector-class">.182</span> <span class="selector-tag">offset</span> <span class="selector-tag">-29409</span><span class="selector-class">.044121</span> <span class="selector-tag">sec</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>OpenVZ 安装 PPTP 完整无错教程</title>
    <url>/2018/06/30/1318/</url>
    <content><![CDATA[<p>首先,我们必须要知道自己的VPS是否支持PPTP.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/dev/</span>ppp</span><br><span class="line">cat: <span class="regexp">/dev/</span>ppp: No such device or address</span><br><span class="line">cat <span class="regexp">/dev/</span>net/tun</span><br><span class="line">cat: <span class="regexp">/dev/</span>net/tun: <span class="keyword">File</span> descriptor in bad state</span><br></pre></td></tr></table></figure>

<p>我记得有一篇如果你的结果和我上面的两个结果不一样的话,那么你是肯定无法正常使用PPTP的哦.<br>不一样的话也好办,直接去tk VPS客服基本都会给开通的,我的VPN假架设在VPSYOU的openvz上,我联系客服10分钟后开通,赞一个先.<br>如果你的结果和我一样的话,那么就继续往下看吧.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install -y ppp</span><br><span class="line">yum install -y iptables</span><br><span class="line">rpm -ivh http:<span class="regexp">//</span>acelnmp.googlecode.com<span class="regexp">/files/</span>pptpd-<span class="number">1.3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel5.<span class="number">1</span>.i386.rpm(X86)</span><br><span class="line">rpm -ivh http:<span class="regexp">//</span>acelnmp.googlecode.com<span class="regexp">/files/</span>pptpd-<span class="number">1.3</span>.<span class="number">4</span>-<span class="number">1</span>.rhel5.<span class="number">1</span>.x86_64.rpm(X64)</span><br><span class="line">vi <span class="regexp">/etc/</span>pptpd.conf</span><br><span class="line"><span class="comment"># localip 192.168.0.1 -&gt; localip 192.168.0.1</span></span><br><span class="line"><span class="comment"># remoteip 192.168.0.234-238,192.168.0.245 -&gt;remoteip 192.168.0.234-238,192.168.0.245</span></span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/options.pptpd</span><br><span class="line"><span class="comment"># ms-dns 192.168.0.1 -&gt; ms-dns 8.8.8.8</span></span><br><span class="line"><span class="comment"># ms-dns 192.168.0.2 -&gt; ms-dns 8.8.4.4</span></span><br><span class="line">require-mppe-<span class="number">128</span> -&gt; <span class="comment"># require-mppe-128</span></span><br><span class="line">vi <span class="regexp">/etc/</span>ppp/chap-secrets</span><br><span class="line">用户名 pptpd 密码 *</span><br><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span> -&gt; net.ipv4.ip_forward = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span> -&gt; <span class="comment"># net.ipv4.tcp_syncookies = 1</span></span><br><span class="line">sysctl -p</span><br><span class="line">iptables -t nat -A POSTROUTING -s <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span> -j SNAT --to-source 你的VPS的IP</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables save</span><br><span class="line">chkconfig pptpd on</span><br><span class="line">chkconfig iptables on</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/pptpd restart</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>现在你已经可以使用PPTP了,如果你连接的时候出现619错误的话.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -r <span class="regexp">/dev/</span>ppp</span><br><span class="line">mknod <span class="regexp">/dev/</span>ppp c <span class="number">108</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Oracle 修改服务名的方法</title>
    <url>/2020/08/17/1320/</url>
    <content><![CDATA[<p>查看当前服务名：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">parameter</span> service_name;</span><br></pre></td></tr></table></figure>
<p>修改服务名：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">SQL&gt; alter<span class="built_in"> system </span><span class="builtin-name">set</span> <span class="attribute">service_names</span>=<span class="string">&#x27;orcl&#x27;</span> <span class="attribute">scope</span>=both;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>oracle服务器谨慎删除tmp目录</title>
    <url>/2021/03/07/1321/</url>
    <content><![CDATA[<p>安装oracle的服务器这三个目录千万别删。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">/tmp</span><br><span class="line"><span class="regexp">/usr/</span>tmp</span><br><span class="line"><span class="regexp">/var/</span>tmp</span><br></pre></td></tr></table></figure>
<p>里面可能存在.oracle目录。</p>
<p>删除会导致oracle监听失败。</p>
<p>需要重建该目录。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/var/</span>tmp/.oracle</span><br><span class="line">chown -R oracle:oinstall <span class="regexp">/var/</span>tmp/.oracle</span><br></pre></td></tr></table></figure>
<p>重启oracle并重启监听。</p>
]]></content>
  </entry>
  <entry>
    <title>ORA-32001 write to SPFILE requested but no SPFILE is in use</title>
    <url>/2020/08/17/1319/</url>
    <content><![CDATA[<p>错误如下：</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">ORA<span class="number">-32001</span>: <span class="built_in">write</span> <span class="keyword">to</span> SPFILE requested <span class="keyword">but</span> no SPFILE specified <span class="keyword">at</span> startup</span><br></pre></td></tr></table></figure>
<p>重新创建一下spfile：</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> spfile <span class="keyword">from</span> pfile;</span><br></pre></td></tr></table></figure>
<p>重启数据库，即可解决此错误。</p>
]]></content>
  </entry>
  <entry>
    <title>perl ----Can&#39;t locate CPAN.pm in @INC的解决办法</title>
    <url>/2015/04/09/1323/</url>
    <content><![CDATA[<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">perl -MCPAN -e <span class="symbol">&#x27;install</span> <span class="string">&quot;模块名称&quot;</span>&#x27;</span><br></pre></td></tr></table></figure>

<p>我在在线安装perl 模块时,发现有这样的问题.应该是说没有安装CPAN这个服务吧.</p>
<p>1、执行perl -MCPAN -e shell出错,提示如下:</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">[root<span class="meta">@GM</span> ~]<span class="comment"># perl -MCPAN -e shell</span></span><br><span class="line">Can&#x27;t locate CPAN.pm in <span class="meta">@INC</span> (<span class="meta">@INC</span> contains:......省略</span><br></pre></td></tr></table></figure>

<p>2、到cpan的官方站点下载CPAN模块.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@GM ~]$ wget http:<span class="regexp">//</span>cpan.communilink.net<span class="regexp">/authors/i</span>d<span class="regexp">/A/</span>AN<span class="regexp">/ANDK/</span>CPAN-<span class="number">1.9600</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>3、解压,编绎,安装.<br>[root@GM ~]$ tar -zxvf CPAN-1.9600.tar.gz<br>[root@GM ~]$ cd CPAN-1.9600<br>[root@GM CPAN-1.9600]$ perl Makefile.PL<br>[root@GM CPAN-1.9600]$ make<br>[root@GM CPAN-1.9600]$ make install</p>
<p>4、成功进入CPAN的shell模式.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@GM</span> CPAN<span class="number">-1.9600</span>]<span class="variable">$ </span>perl -MCPAN -e shell</span><br></pre></td></tr></table></figure>

<p>5、install XXX 安装对应模块.</p>
]]></content>
  </entry>
  <entry>
    <title>oracle权限设置</title>
    <url>/2015/03/21/1322/</url>
    <content><![CDATA[<p>一、权限分类:</p>
<p>系统权限:系统规定用户使用数据库的权限.(系统权限是对用户而言).<br>实体权限:某种权限用户对其它用户的表或视图的存取权限.(是针对表或视图而言的).</p>
<p>二、系统权限管理:</p>
<p>1系统权限分类:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">DBA: 拥有全部特权,是系统最高权限,只有DBA才可以创建数据库结构.</span><br><span class="line">RESOURCE:拥有Resource权限的用户只可以创建实体,不可以创建数据库结构.</span><br><span class="line">CONNECT:拥有Connect权限的用户只可以登录Oracle,不可以创建实体,不可以创建数据库结构.</span><br><span class="line">对于普通用户:授予connect, resource权限.</span><br><span class="line">对于DBA管理用户:授予connect,resource, dba权限.</span><br></pre></td></tr></table></figure>

<p>2、系统权限授权命令:</p>
<p>[系统权限只能由DBA用户授出:sys, system(最开始只能是这两个用户)]</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">授权命令:<span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">grant</span> <span class="keyword">connect</span>, resource, dba <span class="keyword">to</span> 用户名<span class="number">1</span> [,用户名<span class="number">2</span>]...;</span><br></pre></td></tr></table></figure>

<p>[普通用户通过授权可以具有与system相同的用户权限,但永远不能达到与sys用户相同的权限,system用户的权限也可以被回收.]</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">例:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">connect</span> <span class="keyword">system</span>/manager</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">Create</span> <span class="keyword">user</span> user50 identified <span class="keyword">by</span> user50;</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">connect</span>, resource <span class="keyword">to</span> user50;</span><br><span class="line"></span><br><span class="line">查询用户拥有哪里权限:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> dba_role_privs;</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> dba_sys_privs;</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> role_sys_privs;</span><br></pre></td></tr></table></figure>

<p>删除用户:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">drop</span> <span class="keyword">user</span> 用户名 <span class="keyword">cascade</span>; //加上<span class="keyword">cascade</span>则将用户连同其创建的东西全部删除</span><br></pre></td></tr></table></figure>

<p>3、系统权限传递:</p>
<p>增加WITH ADMIN OPTION选项,则得到的权限可以传递.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">connect</span>, resorce <span class="keyword">to</span> user50 <span class="keyword">with</span> <span class="keyword">admin</span> <span class="keyword">option</span>; //可以传递所获权限.</span><br></pre></td></tr></table></figure>

<p>4、系统权限回收:系统权限只能由DBA用户回收</p>
<p>命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">Revoke</span> <span class="keyword">connect</span>, resource <span class="keyword">from</span> user50;</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<p>1)如果使用WITH ADMIN OPTION为某个用户授予系统权限,那么对于被这个用户授予相同权限的所有用户来说,取消该用户的系统权限并不会级联取消这些用户的相同权限.</p>
<p>2)系统权限无级联,即A授予B权限,B授予C权限,如果A收回B的权限,C的权限不受影响;系统权限可以跨用户回收,即A可以直接收回C用户的权限.</p>
<p>三、实体权限管理</p>
<p>1、实体权限分类:select, update, insert, alter, index, delete, all //all包括所有权限</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">execute</span> //执行存储过程权限</span><br><span class="line"></span><br><span class="line">user01:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">select</span>, <span class="keyword">update</span>, <span class="keyword">insert</span> <span class="keyword">on</span> product <span class="keyword">to</span> user02;</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> product <span class="keyword">to</span> user02;</span><br><span class="line"></span><br><span class="line">user02:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> * <span class="keyword">from</span> user01.product;</span><br><span class="line"></span><br><span class="line">// 此时user02查user_tables,不包括user01.product这个表,但如果查all_tables则可以查到,因为他可以访问.</span><br></pre></td></tr></table></figure>

<p>2、 将表的操作权限授予全体用户:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> product <span class="keyword">to</span> <span class="built_in">public</span>; // <span class="built_in">public</span>表示是所有的用户,这里的<span class="keyword">all</span>权限不包括<span class="keyword">drop</span>.</span><br><span class="line"></span><br><span class="line">[实体权限数据字典]:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> <span class="keyword">owner</span>, <span class="built_in">table_name</span> <span class="keyword">from</span> all_tables; // 用户可以查询的表</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> user_tables; // 用户创建的表</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> grantor, table_schema, <span class="built_in">table_name</span>, privilege <span class="keyword">from</span> all_tab_privs; // 获权可以存取的表(被授权的)</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">select</span> grantee, <span class="keyword">owner</span>, <span class="built_in">table_name</span>, privilege <span class="keyword">from</span> user_tab_privs; // 授出权限的表(授出的权限)</span><br></pre></td></tr></table></figure>

<p>3、 DBA用户可以操作全体用户的任意基表(无需授权,包括删除):</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">DBA用户:</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">Create</span> <span class="keyword">table</span> stud02.product(</span><br><span class="line">id number(<span class="number">10</span>),</span><br><span class="line"><span class="type">name</span> varchar2(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">drop</span> <span class="keyword">table</span> stud02.emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">create</span> <span class="keyword">table</span> stud02.employee</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>

<p>4、实体权限传递(with grant option):</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">user01:</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">grant</span> <span class="keyword">select</span>, <span class="keyword">update</span> <span class="keyword">on</span> product <span class="keyword">to</span> user02 <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>; // user02得到权限,并可以传递.</span><br></pre></td></tr></table></figure>

<p>5、实体权限回收:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">user01:</span><br><span class="line"><span class="keyword">SQL</span>&gt;<span class="keyword">Revoke</span> <span class="keyword">select</span>, <span class="keyword">update</span> <span class="keyword">on</span> product <span class="keyword">from</span> user02; //传递的权限将全部丢失.</span><br></pre></td></tr></table></figure>

<p>说明</p>
<p>如果取消某个用户的对象权限,那么对于这个用户使用WITH GRANT OPTION授予权限的用户来说,同样还会取消这些用户的相同权限,也就是说取消授权时级联的.</p>
]]></content>
  </entry>
  <entry>
    <title>phpmyadmin 提示 PHP 5.2+ is required 的解决办法 phpinfo.php</title>
    <url>/2016/01/02/1326/</url>
    <content><![CDATA[<p>今天想安装个phpmyadmin于是去官网看了一下,看到有phpMyAdmin 3.3.3 于是就下了,安装,访问.<br>出错了.<br>提示:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">PHP</span> <span class="number">5</span>.<span class="number">2</span>+ is required</span><br></pre></td></tr></table></figure>

<p>应该是说要求php 5.2以上吧.<br>系统装是提CentOS 5.5 因为只是玩玩,所以图省事,apache,php,mysql都直接选装了.<br>建个phpinfo.php来看一下自己的php版本情况</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>原来CentOS 5.5自带的php是5.1.6.<br>两个方法:</p>
<p>1.升级php,2使用低版本的phpmyadmin.<br>因为本人还是比较懒的,所以找了一下phpMyAdmin-2.11.10-all-languages.tar.gz 问题解决.<br>网上也有使用yum升级php的,不过,还要配制yum源,如果 是想升级php的,请看下文升级方法.</p>
<p>2.yum 升级php和mysql.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>download.fedora.redhat.com<span class="regexp">/pub/</span>epel<span class="regexp">/5/i</span>386/epel-release-<span class="number">5</span>-<span class="number">3</span>.noarch.rpm</span><br><span class="line">wget http:<span class="regexp">//</span>rpms.famillecollet.com<span class="regexp">/enterprise/</span><span class="number">5</span><span class="regexp">/remi/i</span>386/remi-release-<span class="number">5</span>-<span class="number">7</span>.el5.remi.noarch.rpm</span><br><span class="line">rpm -Uvh remi-release-<span class="number">5</span>*.rpm epel-release-<span class="number">5</span>*.rpm</span><br></pre></td></tr></table></figure>

<p>然后编辑 <code>/etc/yum.repos.d/remi.repo</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/remi.repo</span><br></pre></td></tr></table></figure>

<p>在这个文件的最后增加一行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">priority</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>保存退出.<br><code>/etc/yum.repos.d/epel.repo</code>和 <code>/etc/yum.repos.d/epel-testing.repo</code>这两个文件也按照上面的方法进行编辑!<br>使用下面的命令进行升级,但是经过测试,如果单独升级php将提示失败,只有联通mysql一起升级才可以,所以我们必须执行以下命令才能升级php到5.2.9版本:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">yum –<span class="attribute">-enablerepo</span>=remi update php* mysql*</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>phpmyadmin 提示 PHP 5.2+ is required 的解决办法 phpinfo.php</title>
    <url>/2016/01/02/1325/</url>
    <content><![CDATA[<!--markdown-->今天想安装个phpmyadmin于是去官网看了一下,看到有phpMyAdmin 3.3.3 于是就下了,安装,访问.
<p>出错了.<br>提示:</p>
<pre><code>PHP 5.2+ is required
</code></pre>
<p>应该是说要求php 5.2以上吧.<br>系统装是提CentOS 5.5 因为只是玩玩,所以图省事,apache,php,mysql都直接选装了.<br>建个phpinfo.php来看一下自己的php版本情况</p>
<pre><code>&lt;?php phpinfo();?&gt;
</code></pre>
<p>原来CentOS 5.5自带的php是5.1.6.<br>两个方法:</p>
<p>1.升级php,2使用低版本的phpmyadmin.<br>因为本人还是比较懒的,所以找了一下phpMyAdmin-2.11.10-all-languages.tar.gz 问题解决.<br>网上也有使用yum升级php的,不过,还要配制yum源,如果 是想升级php的,请看下文升级方法.</p>
<p>2.yum 升级php和mysql.</p>
<pre><code>wget http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm
wget http://rpms.famillecollet.com/enterprise/5/remi/i386/remi-release-5-7.el5.remi.noarch.rpm
rpm -Uvh remi-release-5*.rpm epel-release-5*.rpm
</code></pre>
<p>然后编辑<code>/etc/yum.repos.d/remi.repo</code></p>
<pre><code>vi /etc/yum.repos.d/remi.repo
</code></pre>
<p>在这个文件的最后增加一行:</p>
<pre><code>priority=1
</code></pre>
<p>保存退出.<br><code>/etc/yum.repos.d/epel.repo</code>和<code>/etc/yum.repos.d/epel-testing.repo</code>这两个文件也按照上面的方法进行编辑!<br>使用下面的命令进行升级,但是经过测试,如果单独升级php将提示失败,只有联通mysql一起升级才可以,所以我们必须执行以下命令才能升级php到5.2.9版本:</p>
<pre><code>yum –-enablerepo=remi update php* mysql*
</code></pre>
]]></content>
  </entry>
  <entry>
    <title>php不能连接mysql</title>
    <url>/2018/12/01/1327/</url>
    <content><![CDATA[<p>重新安装php:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --with-mysql=/u</span>sr<span class="regexp">/include/my</span>sql(mysql.h所在目录)</span><br></pre></td></tr></table></figure>

<p>然后安装php-mysql.</p>
]]></content>
  </entry>
  <entry>
    <title>phpize command not found</title>
    <url>/2011/10/11/1324/</url>
    <content><![CDATA[<p>我们在编译安装的时候有时候会出现这个错误:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@fuwuqiweihu_com</span> ~]<span class="meta"># phpize</span></span><br><span class="line">bash: phpize: command <span class="literal">not</span> found</span><br></pre></td></tr></table></figure>

<p>这个错误是因为服务器上没有phpize这个命令,我们需要安装php-devel package:</p>
<p>Centos系统:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> php-devel</span><br></pre></td></tr></table></figure>

<p>ubuntu系统:</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install php5-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>php中提示Undefined index的解决方法</title>
    <url>/2012/09/17/1328/</url>
    <content><![CDATA[<p>我们经常接收表单POST过来的数据时报Undefined index错误,如下:$act=$_POST[‘action’];<br>用以上代码总是提示:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Notice</span>: Undefined <span class="keyword">index</span>: act <span class="keyword">in</span> D:testpost.php <span class="keyword">on</span> <span class="type">line</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>另外,有时还会出现:</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">Notice: Undefined <span class="built_in">variable</span>: Submit <span class="params">...</span><span class="params">...</span></span><br></pre></td></tr></table></figure>

<p>出现上面这些是 PHP 的提示而非报错,PHP 本身不需要事先声明变量即可直接使用,但是对未声明变量会有提示.一般作为正式的网站会把提示关掉的,甚至连错误信息也被关掉.</p>
<p>解决方法:</p>
<p>1)在变量前面 加上一个 @ ,如:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">if (@$<span class="symbol">_GET</span>[<span class="string">&#x27;action&#x27;</span>]==<span class="string">&#x27;save&#x27;</span>) &#123; ...</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>修改 php.ini 中的 error配置下错误显示方式:将error_reporting = E_ALL 修改为:</p>
<p>error_reporting = E_ALL &amp; ~E_NOTICE</p>
</li>
</ol>
<p>修改后重启下APCHE服务器,方可生效.</p>
]]></content>
  </entry>
  <entry>
    <title>prince安装</title>
    <url>/2014/05/20/1329/</url>
    <content><![CDATA[<p>下载软件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>www.princexml.com<span class="regexp">/download/</span>prince-<span class="number">7.1</span>-linux.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压缩:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> xfzv prince-<span class="number">7</span>.<span class="number">1</span>-linux.tar.gz</span><br></pre></td></tr></table></figure>

<p>进入目录:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> prince-<span class="number">7</span>.<span class="number">1</span>-linux</span><br></pre></td></tr></table></figure>

<p>安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">./<span class="keyword">install</span>.sh</span><br></pre></td></tr></table></figure>

<p>查看:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">whereis prince</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python reload报错</title>
    <url>/2019/09/23/1331/</url>
    <content><![CDATA[<p>程序:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">import sys </span><br><span class="line"><span class="function"><span class="title">reload</span><span class="params">(sys)</span></span> </span><br><span class="line">sys<span class="selector-class">.setdefaultencoding</span>(‘utf-<span class="number">8</span>’) </span><br></pre></td></tr></table></figure>

<p>以上是python2的写法，但是在python3中这个需要已经不存在了，这么做也没什么实际意义。<br>但是python3中仍然可以使用这个方法代替:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib,sys </span><br><span class="line">importlib.reload(sys)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ps、kill、sleep命令详解</title>
    <url>/2015/10/17/1330/</url>
    <content><![CDATA[<p>Linux是一个多用户多任务的操作系统统,这意味着多个用户可以同时使用一个操作系统,而每个用户又可以同时运行多个命令.命令的执行是通过进程实现的.”进程”是Linux系统中一个重要的概念.</p>
<p>简单地说,进程是一个程序或任务的执行过程.例如,在提示符之后输入一个命令或可执行文件的名字,按下Enter键,就开始执行这个命令了.在操作系统中,为了执行这个命令,往往要创建相应的进程.通过进程的活动来完成一个预定的任务.其实,在Linux中,通常执行任何一个命令都会创建一个或多个进程,即命令是通过进程实现的.当进程完成了预期的目标,自行终止时,该命令也就执行完了.不但用户可以创建进程,系统程序也可以创建进程.可以说,一个运行着的操作系统就是由许许多多的进程组成的.</p>
<p>ps命令<br>ps命令用来查看当前系统中运行的进程的信息.它可以提供关于进程的许多信息.可以根据显示的信息确定哪个进程正在运行,哪个进程是被挂起或出了问题,进程已运行了多久,进程正在使用的资源,进程的相对优先级及进程的标志号(PID).所有这些信息对用户都很有用,对于系统管理员来说更为重要.</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">一般格式:ps [选项]</span><br><span class="line"></span><br><span class="line">常用选项:</span><br><span class="line"> -a  显示系统中与tty相关的(除会话组长之外)所有进程的信息.</span><br><span class="line"> -e  显示所有进程的信息.</span><br><span class="line"> -f  显示进程的所有信息.</span><br><span class="line"> -l  以长格式显示进程信息.</span><br><span class="line"> -r  只显示正在运行的进程.</span><br><span class="line"> -u  显示面向用户的格式(包括用户名、<span class="symbol">CPU</span>及内存使用情况等信息).</span><br><span class="line"> -x  显示所有终端上的进程信息.</span><br></pre></td></tr></table></figure>

<p>示例:</p>
<p>①列出每个与当前shell有关的进程的基本信息:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">ps</span></span><br><span class="line">PID TTY          TIME CMD</span><br><span class="line"><span class="number">9723</span> <span class="keyword">pts</span>/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> bash</span><br><span class="line"><span class="number">9751</span> <span class="keyword">pts</span>/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="keyword">ps</span></span><br></pre></td></tr></table></figure>

<p>其中,各字段的含义如下:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">PID  进程标志号.</span><br><span class="line">TTY  该进程建立时所对应的终端,<span class="string">&quot;?&quot;</span>表示该进程不占用终端.</span><br><span class="line">TIME  报告进程累计使用的CPU时间.注意,尽管有些命令(如 sh)已经运转了很长时间,但是它们真正使用CPU的时间往往很短.所以,该字段的值往往是<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>.</span><br><span class="line">CMD 执行进程的命令名.</span><br></pre></td></tr></table></figure>

<p>②显示系统中所有进程的全面信息:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">$ ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root        <span class="number"> 1 </span>   <span class="number"> 0 </span><span class="number"> 0 </span>Jun25 ?        00:00:01 init [3]</span><br><span class="line">root        <span class="number"> 2 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [migration/0]</span><br><span class="line">root        <span class="number"> 3 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [ksoftirqd/0]</span><br><span class="line">root        <span class="number"> 4 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [watchdog/0]</span><br><span class="line">root        <span class="number"> 5 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [migration/1]</span><br><span class="line">root        <span class="number"> 6 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [ksoftirqd/1]</span><br><span class="line">root        <span class="number"> 7 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [watchdog/1]</span><br><span class="line">root        <span class="number"> 8 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [events/0]</span><br><span class="line">root        <span class="number"> 9 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [events/1]</span><br><span class="line">root       <span class="number"> 10 </span>   <span class="number"> 1 </span><span class="number"> 0 </span>Jun25 ?        00:00:00 [khelper]</span><br><span class="line">……</span><br><span class="line">root     <span class="number"> 9755 </span><span class="number"> 9723 </span><span class="number"> 0 </span>10:10 pts/0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<p>各项的含义是:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">UID  进程属主的用户ID号.</span><br><span class="line">PID  进程ID号.</span><br><span class="line">PPID  父进程的ID号.</span><br><span class="line">C  进程最近使用CPU的估算.</span><br><span class="line">STIME  进程开始时间,以小时:分:秒的形式给出.</span><br><span class="line">TTY  该进程建立时所对应的终端,<span class="string">&quot;?&quot;</span>表示该进程不占用终端.</span><br><span class="line">TIME  报告进程累计使用的CPU时间.注意,尽管有些命令(如 sh)己经运转了很长时间,但是它们真正使用CPU的时间往往很短.所以,该字段的值往往是<span class="number">0</span>:<span class="number">00</span>.</span><br><span class="line">CMD 是conunand(命令)的缩写.</span><br></pre></td></tr></table></figure>

<p>③显示所有终端上所有用户的有关进程的所有信息:</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">$ ps -aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root        <span class="number"> 1 </span> 0.0  0.0  <span class="number"> 2160 </span> <span class="number"> 660 </span>?        Ss   Jun25   0:01 init [3]</span><br><span class="line">root        <span class="number"> 2 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [migration/0]</span><br><span class="line">root        <span class="number"> 3 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        SN   Jun25   0:00 [ksoftirqd/0]</span><br><span class="line">root        <span class="number"> 4 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [watchdog/0]</span><br><span class="line">root        <span class="number"> 5 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [migration/1]</span><br><span class="line">root        <span class="number"> 6 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        SN   Jun25   0:00 [ksoftirqd/1]</span><br><span class="line">root        <span class="number"> 7 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [watchdog/1]</span><br><span class="line">root        <span class="number"> 8 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [events/0]</span><br><span class="line">root        <span class="number"> 9 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [events/1]</span><br><span class="line">root       <span class="number"> 10 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [khelper]</span><br><span class="line">root       <span class="number"> 11 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [kthread]</span><br><span class="line">root       <span class="number"> 15 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [kblockd/0]</span><br><span class="line">root       <span class="number"> 16 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [kblockd/1]</span><br><span class="line">root       <span class="number"> 17 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [kacpid]</span><br><span class="line">root      <span class="number"> 120 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   Jun25   0:00 [cqueue/0]</span><br><span class="line">……</span><br><span class="line">root     <span class="number"> 9784 </span> 0.0  0.0  <span class="number"> 5456 </span> <span class="number"> 956 </span>pts/0    R+   10:23   0:00 ps -aux</span><br></pre></td></tr></table></figure>

<p>在上面列表中列出的进程信息中包含了一些新的项,它们的含义是:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">USER  启动进程的用户.</span><br><span class="line"><span class="comment">%CPU  运行该进程占用CPU的时间与该进程总的运行时间的比例.</span></span><br><span class="line"><span class="comment">%MEM  该进程占用内存和总内存的比例.</span></span><br><span class="line">VSZ  虚拟内存的大小,以KB为．单位.</span><br><span class="line">RSS  占用实际内存的大小,以KB为单位.</span><br><span class="line">STAT  进程的运行状态,其中包括以下几种代码:</span><br><span class="line"> 　D 不可中断的睡眠.</span><br><span class="line"> 　R 执行.</span><br><span class="line"> 　S 睡眠.</span><br><span class="line"> 　T 跟踪或停止.</span><br><span class="line"> 　Z 终止.</span><br><span class="line"> 　W 没有内存驻留页.</span><br><span class="line"> 　&lt; 高优先权的进程.</span><br><span class="line"> 　N 低优先权的进程.</span><br><span class="line"> 　L 有锁入内存的页面(用于实时任务或UO任务).</span><br><span class="line">START  开始运行的时间.</span><br></pre></td></tr></table></figure>

<p>kill命令</p>
<p>kill命令用来终止一个进程的运行.通常,终止一个前台进程可以使用Ctrl+C键,但是,对于一个后台进程就须用kill命令来终止.kill命令是通过向进程发送指定的信号来结束相应进程的.在默认情况下,采用编号为15的TERM信号.TERM信号将终止所有不能捕获该信号的进程.对于那些可以捕获该信号的进程就要用编号为9的kill信号,强行”杀掉”该进程.</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line">一般格式:</span><br><span class="line"> <span class="selector-tag">kill</span> <span class="selector-attr">[-s 信号 -p]</span> <span class="selector-attr">[-a]</span> 进程号…</span><br><span class="line"> <span class="selector-tag">kill</span> <span class="selector-tag">-l</span> <span class="selector-attr">[信号]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">选项:</span><br><span class="line"> <span class="selector-tag">-s</span> 指定需要发送的信号,既可以是信号名(如kill),也可以是对应信号的号码(如<span class="number">9</span>).</span><br><span class="line"> <span class="selector-tag">-p</span> 指定<span class="selector-tag">kill</span>命令只是显示进程的<span class="selector-tag">PID</span>(进程标志号),并不真正发出结束信号.</span><br><span class="line"> <span class="selector-tag">-l</span> 显示信号名称列表,这也可以在/<span class="selector-tag">usr</span>/<span class="selector-tag">include</span>/<span class="selector-tag">linux</span>/<span class="selector-tag">signal</span><span class="selector-class">.h</span>文件中找到.</span><br></pre></td></tr></table></figure>

<p>注意:<br>1、kill命令可以带信号号码选项,也可以不带.如果没有信号号码,kin命令就会发出终止信号(15),这个信号可以被进程捕获,使得进程在退出之前可以清理并释放资源.也可以用kiU向进程发送特定的信号.例如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kill</span> -<span class="number">2</span> <span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>它的效果等同于在前台运行PID为123的进程时按下Ctrl+C键.但是,普通用户只能使用不带signal参数的kill命令或最多使用-9信号.</p>
<p>2、kill可以带有进程ID号作为参数.当用kill向这些进程发送信号时,必须是这些进程的主人.如果试图撤销一个没有权限撤销的进程或撤销一个不存在的进程,就会得到一个错误信息.</p>
<p>3、可以向多个进程发信号或终止它们.</p>
<p>4、当kill成功地发送了信号后,shell会在屏幕上显示出进程的终止信息.有时这个信息不会马上显示,只有当按下Enter键使shell的命令提示符再次出现时,才会显示出来.</p>
<p>5、应注意,信号使进程强行终止,这常会带来一些副作用,如数据丢失或者终端无法恢复到正常状态.发送信号时必须小心,只有在万不得已时,才用kill信号(9),因为进程不能首先捕获它.要撤销所有的后台作业,可以输入kill 0.因为有些在后台运行的命令会启动多个进程,跟踪并找到所有要杀掉的进程的PID是件很麻烦的事.这时,使用kill 0来终止所有由当前shell启动的进程,是个有效的方法.</p>
<p>示例:<br>一般可以用kill命令来终止一个己经挂死的进程或者一个陷入死循环的进程.首先执行以下命令:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">find</span> <span class="regexp">/ -name core -print&gt;/</span>dev/<span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span>&amp;</span><br></pre></td></tr></table></figure>

<p>这是一条后台命令,执行时间较一长.其功能是:从根目录开始搜索名为core的文件,将结果输出(包括错误输出)都定向到 <code>/dev/null</code>文件.现在决定终止该进程.为此,运行ps命令来查看该进程对应的PID.例如,该进程对应的PID是1651,现在可用垃l命令”杀死”这个进程:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$kill</span> 1651</span></span><br></pre></td></tr></table></figure>

<p>再用ps命令查看进程状态时,就可以看到,find进程已经不存在了.</p>
<p>sleep命令</p>
<p>sleep命令的功能是使进程暂停执行一段时间.”时间值”参数以秒为单位,即让进程暂停由时间值所指定的秒数.此命令大多用于shell程序设计中,使两条命令执行之间停顿指定的时间.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">一般格式:<span class="built_in">sleep</span> 时间值</span><br></pre></td></tr></table></figure>

<p>示例:下面的命令行使进程先暂停100秒,然后查看用户abc是否在系统中:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$sleep <span class="number">100</span>;who | <span class="keyword">grep</span> <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python查找指定时间范围的文件并保存目录结构复制</title>
    <url>/2021/04/07/1333/</url>
    <content><![CDATA[<p>该脚本可以查找某个目录里指定时间范围的文件，并保存目录结构复制到新的路径。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">time0 = <span class="string">&quot;2021-01-27&quot;</span><span class="comment">#起始日期</span></span><br><span class="line">time1 = <span class="string">&quot;2021-03-02&quot;</span><span class="comment">#结束日期</span></span><br><span class="line">targetDir = <span class="string">r&quot;/home/backup&quot;</span><span class="comment">#目标目录</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正在处理，请稍等.....&quot;</span>)</span><br><span class="line">curDir = <span class="string">r&quot;/home/flask&quot;</span><span class="comment">#原来的路径</span></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(curDir):</span><br><span class="line">    <span class="comment">#先创建目标目录</span></span><br><span class="line">    curFolder = root[<span class="built_in">len</span>(curDir)+<span class="number">1</span>:]                    <span class="comment">#提取当前文件夹</span></span><br><span class="line">    tempTargetDir = os.path.join(targetDir, curFolder)  <span class="comment">#生成目标目录绝对路径</span></span><br><span class="line">    <span class="comment"># print(tempTargetDir)</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(tempTargetDir):</span><br><span class="line">        shutil.rmtree(tempTargetDir)</span><br><span class="line">    <span class="comment">#再拷贝文件</span></span><br><span class="line">    t0 = time.mktime(time.strptime(time0, <span class="string">&quot;%Y-%m-%d&quot;</span>))</span><br><span class="line">    t1 = time.mktime(time.strptime(time1, <span class="string">&quot;%Y-%m-%d&quot;</span>))+<span class="number">3600</span>*<span class="number">24</span></span><br><span class="line">    <span class="keyword">for</span> fileName <span class="keyword">in</span> files:</span><br><span class="line">        absFileName = os.path.join(root, fileName)</span><br><span class="line">        <span class="keyword">if</span> os.path.splitext(absFileName)[<span class="number">1</span>] != <span class="string">&#x27;.py&#x27;</span> <span class="keyword">and</span> os.path.getmtime(absFileName) &gt;= t0 <span class="keyword">and</span> os.path.getmtime(absFileName) &lt;= t1:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(tempTargetDir):</span><br><span class="line">                os.makedirs(tempTargetDir)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在拷贝文件：&quot;</span>, absFileName)</span><br><span class="line">            shutil.copy(absFileName, tempTargetDir)</span><br></pre></td></tr></table></figure>

<p>推荐python3运行。</p>
]]></content>
  </entry>
  <entry>
    <title>python判断是否为手机号</title>
    <url>/2021/07/01/1335/</url>
    <content><![CDATA[<p>通过该程序可以判断一端数据是否为手机号码。</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">import</span> <span class="variable">re</span></span><br><span class="line"><span class="variable">def</span> <span class="function"><span class="title">judge_Monile_phone</span>(<span class="variable">phone</span>):</span></span><br><span class="line"><span class="function">	<span class="variable"><span class="keyword">if</span></span> <span class="title">len</span>(<span class="variable">phone</span>)==<span class="number">11</span>:</span></span><br><span class="line"><span class="function">		<span class="variable">rp</span>=<span class="variable">re.compile</span>(<span class="string">&#x27;^0\d&#123;2,3&#125;\d&#123;7,8&#125;$|^1[358]\d&#123;9&#125;$|^147\d&#123;8&#125;&#x27;</span>)</span></span><br><span class="line">		<span class="variable">phoneMatch</span> = <span class="variable">rp.match</span>(<span class="variable">phone</span>)</span><br><span class="line">		<span class="variable"><span class="keyword">if</span></span> <span class="variable">phoneMatch</span>:</span><br><span class="line">			<span class="function"><span class="title">print</span>(<span class="string">&#x27;手机号正确!&#x27;</span>)</span></span><br><span class="line">		<span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">			<span class="function"><span class="title">print</span>(<span class="string">&quot;手机号码错误!&quot;</span>)</span></span><br><span class="line">	<span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">		<span class="function"><span class="title">print</span>(<span class="string">&quot;号码长度错误!&quot;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="function"><span class="title">judge_Monile_phone</span>(<span class="string">&#x27;13412341234&#x27;</span>)</span></span><br></pre></td></tr></table></figure>

<p>推荐python3运行该程序。</p>
]]></content>
  </entry>
  <entry>
    <title>python 在某个时间段内生成随机日期的时间戳</title>
    <url>/2017/01/01/1332/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="attribute">import</span> MySQLdb as mdb</span><br><span class="line"><span class="attribute">import</span> time</span><br><span class="line"><span class="attribute">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="attribute">a1</span>=(<span class="number">2010</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)              #设置开始日期时间元组(<span class="number">1976</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>)</span><br><span class="line"><span class="attribute">a2</span>=(<span class="number">2019</span>,<span class="number">5</span>,<span class="number">31</span>,<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)    #设置结束日期时间元组(<span class="number">1990</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">start</span>=time.mktime(a<span class="number">1</span>)    #生成开始时间戳</span><br><span class="line"><span class="attribute">end</span>=time.mktime(a<span class="number">2</span>)      #生成结束时间戳</span><br><span class="line"></span><br><span class="line"><span class="attribute">for</span> i in range(<span class="number">10</span>):     #随机生成<span class="number">10</span>个日期字符串</span><br><span class="line">    <span class="attribute">t</span>=random.randint(start,end)    #在开始和结束时间戳中随机取出一个</span><br><span class="line">    <span class="attribute">date_touple</span>=time.localtime(t)          #将时间戳生成时间元组</span><br><span class="line">    <span class="attribute">date</span>=time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,date_touple)  #将时间元组转成格式化字符串(<span class="number">1976</span>-<span class="number">05</span>-<span class="number">21</span>)</span><br><span class="line">    <span class="attribute">timeArray</span> = time.strptime(date, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="attribute">timestamp</span> = int(time.mktime(timeArray))</span><br><span class="line">    <span class="attribute">print</span> timestamp</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python记录程序运行时间</title>
    <url>/2019/06/20/1334/</url>
    <content><![CDATA[<p>我们在用python编程时经常需要记录程序运行时间,可以借助time模块的time()方法:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">time</span>.<span class="built_in">time</span>()</span><br></pre></td></tr></table></figure>

<p>返回当前时间的时间戳(1970纪元后经过的浮点秒数).</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8 #</span></span><br><span class="line">import <span class="built_in">time</span>  </span><br><span class="line">starttime = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line"><span class="built_in">time</span>.sleep(<span class="number">2.1</span>) <span class="comment">#延时2.1s</span></span><br><span class="line">endtime = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">dtime = endtime - starttime  </span><br><span class="line">print(<span class="string">&quot;程序运行时间:%.8s s&quot;</span> % dtime)  <span class="comment">#显示到微秒</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python批量转换数据库markdown为html</title>
    <url>/2020/11/07/1336/</url>
    <content><![CDATA[<p>该程序是使用Python把sqlite的article表中的content字段全部由markdown转换为html。</p>
<p>首先安装依赖：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">pip</span> install sqlite<span class="number">3</span></span><br><span class="line"><span class="attribute">pipinstall</span> markdown</span><br></pre></td></tr></table></figure>

<p>以下是程序主体：</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line">import markdown</span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;test.db&#x27;</span>)</span><br><span class="line"><span class="built_in">cursor</span> = conn.<span class="built_in">cursor</span>()</span><br><span class="line"><span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">900</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">a</span> = <span class="built_in">cursor</span>.<span class="keyword">execute</span>(<span class="string">&#x27;select content from articles where id = %s&#x27;</span>%i).fetchall()</span><br><span class="line">		<span class="keyword">for</span> a1 in <span class="variable">a:</span></span><br><span class="line">			<span class="built_in">cursor</span>.<span class="keyword">execute</span>(<span class="string">&quot;update articles set content = &#x27;%s&#x27; where id = &#x27;%s&#x27;&quot;</span>%(markdown.markdown(a1[<span class="number">0</span>]),i))</span><br><span class="line">			conn.commit()</span><br><span class="line">	excep<span class="variable">t:</span></span><br><span class="line">		<span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>经测试python2和python3都可以正常运行。</p>
]]></content>
  </entry>
  <entry>
    <title>raid规格详解</title>
    <url>/2014/02/25/1339/</url>
    <content><![CDATA[<p>RAID技术主要包含RAID 0～RAID 7等数个规范,它们的侧重点各不相同,常见的规范有如下几种:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line">　　<span class="attribute">RAID</span> <span class="number">0</span>:RAID <span class="number">0</span>连续以位或字节为单位分割数据,并行读/写于多个磁盘上,因此具有很高的数据传输率,但它没有数据冗余,因此并不能算是真正的RAID结构.RAID <span class="number">0</span>只是单纯地提高性能,并没有为数据的可靠性提供保证,而且其中的一个磁盘失效将影响到所有数据.因此,RAID <span class="number">0</span>不能应用于数据安全性要求高的场合.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">1</span>:它是通过磁盘数据镜像实现数据冗余,在成对的独立磁盘上产生互为备份的数据.当原始数据繁忙时,可直接从镜像拷贝中读取数据,因此RAID <span class="number">1</span>可以提高读取性能.RAID <span class="number">1</span>是磁盘阵列中单位成本最高的,但提供了很高的数据安全性和可用性.当一个磁盘失效时,系统可以自动切换到镜像磁盘上读写,而不需要重组失效的数据.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">0</span>+<span class="number">1</span>: 也被称为RAID <span class="number">10</span>标准,实际是将RAID <span class="number">0</span>和RAID <span class="number">1</span>标准结合的产物,在连续地以位或字节为单位分割数据并且并行读/写多个磁盘的同时,为每一块磁盘作磁盘镜像进行冗余.它的优点是同时拥有RAID <span class="number">0</span>的超凡速度和RAID <span class="number">1</span>的数据高可靠性,但是CPU占用率同样也更高,而且磁盘的利用率比较低.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">2</span>:将数据条块化地分布于不同的硬盘上,条块单位为位或字节,并使用称为<span class="string">&quot;加重平均纠错码(海明码)&quot;</span>的编码技术来提供错误检查及恢复.这种编码技术需要多个磁盘存放检查及恢复信息,使得RAID <span class="number">2</span>技术实施更复杂,因此在商业环境中很少使用.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">3</span>:它同RAID <span class="number">2</span>非常类似,都是将数据条块化分布于不同的硬盘上,区别在于RAID <span class="number">3</span>使用简单的奇偶校验,并用单块磁盘存放奇偶校验信息.如果一块磁盘失效,奇偶盘及其他数据盘可以重新产生数据;如果奇偶盘失效则不影响数据使用.RAID <span class="number">3</span>对于大量的连续数据可提供很好的传输率,但对于随机数据来说,奇偶盘会成为写操作的瓶颈.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">4</span>:RAID <span class="number">4</span>同样也将数据条块化并分布于不同的磁盘上,但条块单位为块或记录.RAID <span class="number">4</span>使用一块磁盘作为奇偶校验盘,每次写操作都需要访问奇偶盘,这时奇偶校验盘会成为写操作的瓶颈,因此RAID <span class="number">4</span>在商业环境中也很少使用.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">5</span>:RAID <span class="number">5</span>不单独指定的奇偶盘,而是在所有磁盘上交叉地存取数据及奇偶校验信息.在RAID <span class="number">5</span>上,读/写指针可同时对阵列设备进行操作,提供了更高的数据流量.RAID <span class="number">5</span>更适合于小数据块和随机读写的数据.RAID <span class="number">3</span>与RAID <span class="number">5</span>相比,最主要的区别在于RAID <span class="number">3</span>每进行一次数据传输就需涉及到所有的阵列盘;而对于RAID <span class="number">5</span>来说,大部分数据传输只对一块磁盘操作,并可进行并行操作.在RAID <span class="number">5</span>中有<span class="string">&quot;写损失&quot;</span>,即每一次写操作将产生四个实际的读/写操作,其中两次读旧的数据及奇偶信息,两次写新的数据及奇偶信息.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">6</span>:与RAID <span class="number">5</span>相比,RAID <span class="number">6</span>增加了第二个独立的奇偶校验信息块.两个独立的奇偶系统使用不同的算法,数据的可靠性非常高,即使两块磁盘同时失效也不会影响数据的使用.但RAID <span class="number">6</span>需要分配给奇偶校验信息更大的磁盘空间,相对于RAID <span class="number">5</span>有更大的<span class="string">&quot;写损失&quot;</span>,因此<span class="string">&quot;写性能&quot;</span>非常差.较差的性能和复杂的实施方式使得RAID <span class="number">6</span>很少得到实际应用.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">7</span>:这是一种新的RAID标准,其自身带有智能化实时操作系统和用于存储管理的软件工具,可完全独立于主机运行,不占用主机CPU资源.RAID <span class="number">7</span>可以看作是一种存储计算机(Storage Computer),它与其他RAID标准有明显区别.除了以上的各种标准(如表<span class="number">1</span>),我们可以如RAID <span class="number">0</span>+<span class="number">1</span>那样结合多种RAID规范来构筑所需的RAID阵列,例如RAID <span class="number">5</span>+<span class="number">3</span>(RAID <span class="number">53</span>)就是一种应用较为广泛的阵列形式.用户一般可以通过灵活配置磁盘阵列来获得更加符合其要求的磁盘存储系统.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">5</span>E(RAID <span class="number">5</span> Enhencement): RAID <span class="number">5</span>E是在RAID <span class="number">5</span>级别基础上的改进,与RAID <span class="number">5</span>类似,数据的校验信息均匀分布在各硬盘上,但是,在每个硬盘上都保留了一部分未使用的空间,这部分空间没有进行条带化,最多允许两块物理硬盘出现故障.看起来,RAID <span class="number">5</span>E和RAID <span class="number">5</span>加一块热备盘好象差不多,其实由于RAID <span class="number">5</span>E是把数据分布在所有的硬盘上,性能会与RAID<span class="number">5</span> 加一块热备盘要好.当一块硬盘出现故障时,有故障硬盘上的数据会被压缩到其它硬盘上未使用的空间,逻辑盘保持RAID <span class="number">5</span>级别.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">5</span>EE: 与RAID <span class="number">5</span>E相比,RAID <span class="number">5</span>EE的数据分布更有效率,每个硬盘的一部分空间被用作分布的热备盘,它们是阵列的一部分,当阵列中一个物理硬盘出现故障时,数据重建的速度会更快.</span><br><span class="line">　　<span class="attribute">RAID</span> <span class="number">50</span>:RAID<span class="number">50</span>是RAID<span class="number">5</span>与RAID<span class="number">0</span>的结合.此配置在RAID<span class="number">5</span>的子磁盘组的每个磁盘上进行包括奇偶信息在内的数据的剥离.每个RAID<span class="number">5</span>子磁盘组要求三个硬盘.RAID<span class="number">50</span>具备更高的容错能力,因为它允许某个组内有一个磁盘出现故障,而不会造成数据丢失.而且因为奇偶位分部于RAID<span class="number">5</span>子磁盘组上,故重建速度有很大提高.优势:更高的容错能力,具备更快数据读取速率的潜力.需要注意的是:磁盘故障会影响吞吐量.故障后重建信息的时间比镜像配置情况下要长.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Python同步遍历多个列表</title>
    <url>/2017/05/24/1337/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line">name_list = [<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;33&#x27;</span>]</span><br><span class="line">age_list = [<span class="number">54</span>, <span class="number">18</span>, <span class="number">34</span>]</span><br><span class="line"><span class="keyword">for</span> name, age <span class="keyword">in</span> <span class="built_in">zip</span>(name_list, age_list):</span><br><span class="line">    <span class="built_in">print</span> name,age</span><br></pre></td></tr></table></figure>

<p>运行结果为</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">11 </span><span class="number">54</span></span><br><span class="line"><span class="symbol">22 </span><span class="number">18</span></span><br><span class="line"><span class="symbol">33 </span><span class="number">34</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>python修改typecho全站文章发表日期为某个时间段内的随机时间</title>
    <url>/2019/05/21/1338/</url>
    <content><![CDATA[<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"># -*- coding: UTF<span class="number">-8</span> -*-</span><br><span class="line"><span class="keyword">import</span> MySQLdb <span class="keyword">as</span> mdb</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">  </span><br><span class="line">a1=(<span class="number">2010</span>,<span class="number">12</span>,<span class="number">29</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">a2=(<span class="number">2019</span>,<span class="number">5</span>,<span class="number">31</span>,<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">  </span><br><span class="line">start=<span class="type">time</span>.mktime(a1)</span><br><span class="line">end=<span class="type">time</span>.mktime(a2)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">16</span>]:</span><br><span class="line">    t=random.randrange(<span class="keyword">start</span>,<span class="keyword">end</span>)</span><br><span class="line">    date_touple=<span class="type">time</span>.<span class="built_in">localtime</span>(t)</span><br><span class="line">    <span class="type">date</span>=<span class="type">time</span>.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,date_touple)?</span><br><span class="line">    timeArray = <span class="type">time</span>.strptime(<span class="type">date</span>, &quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">    <span class="type">timestamp</span> = <span class="type">int</span>(<span class="type">time</span>.mktime(timeArray))</span><br><span class="line">    print <span class="type">timestamp</span></span><br><span class="line">    conn = mdb.<span class="keyword">connect</span>(<span class="string">&#x27;数据库服务器ip&#x27;</span>,<span class="string">&#x27;数据库用户名&#x27;</span>,<span class="string">&#x27;数据库密码&#x27;</span>,<span class="string">&#x27;数据库名&#x27;</span>)</span><br><span class="line">    cur = conn.<span class="keyword">cursor</span>()</span><br><span class="line">    cur.<span class="keyword">execute</span>(&quot;update typecho_contents set created = %s where cid = %s&quot;%(<span class="type">timestamp</span>,i))</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>rails2.3.2遇到问题</title>
    <url>/2013/03/29/1340/</url>
    <content><![CDATA[<p>rake rails:update必须到项目根目录.</p>
]]></content>
  </entry>
  <entry>
    <title>rake command not found</title>
    <url>/2019/01/06/1341/</url>
    <content><![CDATA[<p>错误:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">rake command <span class="keyword">not</span> <span class="built_in">found</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">find / -<span class="type">name</span> rake</span><br></pre></td></tr></table></figure>

<p>找到bin下的rake 然后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s /路径</span><br><span class="line"><span class="regexp">/usr/</span>bin/rake</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>read命令详解</title>
    <url>/2011/08/15/1343/</url>
    <content><![CDATA[<p>1.简介</p>
<p>read是一个buildin命令,主要完成对参数的赋值,类似C语言中的scanf.其不仅可以赋值变量,还可以赋值数组;其输入不仅是屏幕,还可以是文件描述符.</p>
<p>2.man中选项说明</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-a aname</span><br><span class="line">The words are assigned <span class="keyword">to</span> sequential indices  <span class="keyword">of</span>  the  <span class="keyword">array</span>  variable</span><br><span class="line">aname,  starting  at  <span class="number">0.</span>   aname  <span class="keyword">is</span>  unset  <span class="keyword">before</span> <span class="keyword">any</span> <span class="built_in">new</span> <span class="keyword">values</span> are</span><br><span class="line">assigned.  Other <span class="type">name</span> arguments are ignored.</span><br><span class="line">-d delim</span><br><span class="line">The first <span class="type">character</span> <span class="keyword">of</span> delim <span class="keyword">is</span> used  <span class="keyword">to</span>  terminate  the  <span class="keyword">input</span>  <span class="type">line</span>,</span><br><span class="line">rather than newline.</span><br><span class="line">-e     <span class="keyword">If</span>  the  standard <span class="keyword">input</span> <span class="keyword">is</span> coming <span class="keyword">from</span> a terminal, readline (see <span class="keyword">READ</span>-</span><br><span class="line"><span class="type">LINE</span> above) <span class="keyword">is</span> used <span class="keyword">to</span> obtain the <span class="type">line</span>.</span><br><span class="line">-n nchars</span><br><span class="line"><span class="keyword">read</span> <span class="keyword">returns</span> <span class="keyword">after</span> reading nchars characters rather than waiting <span class="keyword">for</span> a</span><br><span class="line">complete <span class="type">line</span> <span class="keyword">of</span> <span class="keyword">input</span>.</span><br><span class="line">-p prompt</span><br><span class="line">Display  prompt  <span class="keyword">on</span> standard error, <span class="keyword">without</span> a <span class="keyword">trailing</span> newline, <span class="keyword">before</span></span><br><span class="line">attempting <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">any</span> <span class="keyword">input</span>.  The prompt <span class="keyword">is</span> displayed <span class="keyword">only</span>  <span class="keyword">if</span>  <span class="keyword">input</span></span><br><span class="line"><span class="keyword">is</span> coming <span class="keyword">from</span> a terminal.</span><br><span class="line">-r     Backslash  does <span class="keyword">not</span> act <span class="keyword">as</span> an <span class="keyword">escape</span> <span class="type">character</span>.  The backslash <span class="keyword">is</span> con-</span><br><span class="line">sidered <span class="keyword">to</span> be part <span class="keyword">of</span> the <span class="type">line</span>.  <span class="keyword">In</span>  particular,  a  backslash-newline</span><br><span class="line">pair may <span class="keyword">not</span> be used <span class="keyword">as</span> a <span class="type">line</span> continuation.</span><br><span class="line">-s     Silent  mode.   <span class="keyword">If</span> <span class="keyword">input</span> <span class="keyword">is</span> coming <span class="keyword">from</span> a terminal, characters are <span class="keyword">not</span></span><br><span class="line">echoed.</span><br><span class="line">-t timeout</span><br><span class="line">Cause <span class="keyword">read</span> <span class="keyword">to</span> <span class="type">time</span> <span class="keyword">out</span> <span class="keyword">and</span> <span class="keyword">return</span> failure <span class="keyword">if</span> a complete <span class="type">line</span> <span class="keyword">of</span>  <span class="keyword">input</span></span><br><span class="line"><span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">read</span> <span class="keyword">within</span> timeout seconds.  This <span class="keyword">option</span> has <span class="keyword">no</span> effect <span class="keyword">if</span> <span class="keyword">read</span></span><br><span class="line"><span class="keyword">is</span> <span class="keyword">not</span> reading <span class="keyword">input</span> <span class="keyword">from</span> the terminal <span class="keyword">or</span> a pipe.</span><br><span class="line">-u fd  <span class="keyword">Read</span> <span class="keyword">input</span> <span class="keyword">from</span> file descriptor fd.</span><br><span class="line">-a 后跟一个变量,该变量会被认为是个数组,然后给其赋值,默认是以空格为分割符.</span><br><span class="line">-d 后面跟一个标志符,其实只有其后的第一个字符有用,作为结束的标志,会举例说  明.</span><br><span class="line">-p 后面跟提示信息,即在输入前打印提示信息.</span><br><span class="line">-e 在输入的时候可以时候命令补全功能.</span><br><span class="line">-n 后跟一个数字,定义输入文本的长度,很实用.</span><br><span class="line">-r 屏蔽,如果没有该选项,则作为一个转义字符,有的话 就是个正常的字符了.</span><br><span class="line">-s 安静模式,在输入字符时不再屏幕上显示,例如<span class="keyword">login</span>时输入密码.</span><br><span class="line">-t 后面跟秒数,定义输入字符的等待时间.</span><br><span class="line">-u 后面跟fd,从文件描述符中读入,该文件描述符可以是exec新开启的.</span><br></pre></td></tr></table></figure>

<p>3.举例</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">-a举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -a tao</span></span><br><span class="line">qq ww ee rr</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#echo $&#123;tao[1]&#125;</span></span><br><span class="line">Ww</span><br><span class="line"></span><br><span class="line">-b举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -d eof -a tao</span></span><br><span class="line">ww</span><br><span class="line">dd</span><br><span class="line">gg</span><br><span class="line">hh  (输入一个e)</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#echo $&#123;tao[3]&#125;</span></span><br><span class="line">Hh</span><br><span class="line"></span><br><span class="line">-n举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -n3 -p &quot;you can input 3 word:&quot;</span></span><br><span class="line">you can input <span class="number">3</span> <span class="symbol">word:</span>xxx</span><br><span class="line">(输入<span class="number">3</span>个字符后自动退出!)</span><br><span class="line"></span><br><span class="line">-s举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -p password: -s passwd</span></span><br><span class="line"><span class="symbol">password:</span></span><br><span class="line">(这时候输入就不再显示在屏幕上了!)</span><br><span class="line"></span><br><span class="line">-e举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -e file</span></span><br><span class="line">(tab键补全)</span><br><span class="line">exp1               file               ngis_post.sh       text</span><br><span class="line">exp5               linux<span class="number">-2.6</span>.<span class="number">27.54</span>/   test               xen<span class="number">-3.0</span>.<span class="number">1</span>-install/</span><br><span class="line"></span><br><span class="line">-u举例:</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#exec 3&lt;file</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -u 3 tao</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#echo $tao</span></span><br><span class="line">hello world!</span><br><span class="line"><span class="comment">#注意看下读入的次序:</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#cat file</span></span><br><span class="line">hello world!</span><br><span class="line">i am good</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#exec 3&lt;file</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -u 3 tao</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#echo $tao</span></span><br><span class="line">hello world!</span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#read -u 3 tao</span></span><br><span class="line">root<span class="variable">@localhost</span><span class="symbol">:~/test</span><span class="comment">#echo $tao</span></span><br><span class="line">i am good</span><br></pre></td></tr></table></figure>

<p>这个选项很有用的,特别是自循环读入的时候.</p>
]]></content>
  </entry>
  <entry>
    <title>rakerdoctask is deprecated. Use rdoctask instead</title>
    <url>/2014/08/19/1342/</url>
    <content><![CDATA[<p>解决报错:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">rake/rdoctask <span class="keyword">is</span> deprecated. <span class="keyword">Use</span> rdoc/<span class="keyword">task</span> instead</span><br></pre></td></tr></table></figure>

<p>遇到的问题:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">D:/redmine&gt;rake db:migrate</span><br><span class="line">(<span class="keyword">in</span> D:/redmine)</span><br><span class="line">rake aborted!</span><br><span class="line">syntax <span class="keyword">error</span> <span class="keyword">on</span> line <span class="number">8</span>, col <span class="number">2</span>: `? encoding: utf8&#x27;</span><br><span class="line">(See full trace <span class="keyword">by</span> <span class="built_in">running</span> task <span class="keyword">with</span> <span class="comment">--trace)</span></span><br></pre></td></tr></table></figure>

<p>修改redmine目录下config中的database.yml 配置mysql连接密码时应在密码前加一个空格.</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">production:</span></span><br><span class="line"><span class="symbol">    adapter:</span> mysql</span><br><span class="line"><span class="symbol">    database:</span> redmine</span><br><span class="line"><span class="symbol">    host:</span> localhost</span><br><span class="line"><span class="symbol">    username:</span> jif</span><br><span class="line"><span class="symbol">    password:</span> <span class="number">123456</span></span><br><span class="line"><span class="symbol">    encoding:</span> utf8</span><br></pre></td></tr></table></figure>

<p>如果出现以下异常:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">rake/rdoctask is deprecated.? Use rdoc/task instead (in RDoc 2.4.2+)</span><br><span class="line"><span class="symbol">WARNING: </span><span class="emphasis">&#x27;task :t, arg, :needs =&gt; [deps]&#x27;</span> is deprecated.? Please use <span class="emphasis">&#x27;task :t, [</span></span><br><span class="line"><span class="emphasis">args] =&gt; [deps]&#x27;</span> instead.</span><br><span class="line">at D:/Downloads/ruby/redmine-1.1.3/lib/tasks/email.rake:170</span><br></pre></td></tr></table></figure>

<p>这是因为rake版本太高造成的.<br>解决办法:<br>先执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gem list rake</span></span><br></pre></td></tr></table></figure>

<p>查看rake版本.若果高于0.8.7那就是太高了(比方说0.9.0).<br>这样的话就需要卸载0.9.0的,安装0.8.7的.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gem</span> uninstall rake -v=<span class="number">0</span>.<span class="number">9</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">gem</span> install rake -v=<span class="number">0</span>.<span class="number">8</span>.<span class="number">7</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>RedHat CentOS搭建DNS服务器正向解析</title>
    <url>/2017/06/13/1344/</url>
    <content><![CDATA[<p>以下是基于RedHat 5或CentOS系统的正向解析(IP192.168.1.2域名为<a href="http://www.shuxun.wang)为保证建设成功请不要错过任何一个步骤,以下所写是详细步骤挨个执行命令也能保证成功!(反向解析步骤请参考下篇)/">www.shuxun.wang)为保证建设成功请不要错过任何一个步骤,以下所写是详细步骤挨个执行命令也能保证成功!(反向解析步骤请参考下篇)</a></p>
<p>一.安装相关软件包:为保证顺利进行请按步骤先删除再重新安装所有软件包</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@server ~]# rpm -qa | <span class="keyword">grep</span> bind <span class="comment">//查看bind相关软件包</span></span><br><span class="line">[root@server ~]# rpm -e `rpm -qa | <span class="keyword">grep</span> bind` --nodeps <span class="comment">//删除相关软件包</span></span><br><span class="line">[root@server ~]# mount <span class="regexp">/dev/</span>cdrom <span class="regexp">/media/</span> <span class="comment">//将系统光盘挂载到/media/</span></span><br><span class="line">[root@server media]# cd <span class="regexp">/media/</span>Server<span class="regexp">/ /</span><span class="regexp">/进入/m</span>edia<span class="regexp">/Server/</span>目录</span><br><span class="line">[root@server Server]# rpm -vih bind-* <span class="comment">//再次安装相关软件包</span></span><br><span class="line">[root@server Server]# rpm -vih caching-nameserver-<span class="number">9.3</span>.<span class="number">3</span>-<span class="number">7</span>.el5.i386.rpm</span><br><span class="line">[root@server Server]# service named start <span class="comment">//重启named服务</span></span><br></pre></td></tr></table></figure>

<p>二.修改主配置文件</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">[root@server Server]# cd <span class="regexp">/var/</span>named<span class="regexp">/chroot/</span>etc<span class="regexp">/ /</span><span class="regexp">/进入/</span>var<span class="regexp">/named/</span>chroot<span class="regexp">/etc/</span>目录</span><br><span class="line">[root@server etc]# vim named.caching-nameserver.conf <span class="comment">//修改主配置文件</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"><span class="keyword">options</span> &#123;</span><br><span class="line">    listen-on port <span class="number">53</span> &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    listen-on-v6 port <span class="number">53</span> &#123; ::<span class="number">1</span>; &#125;;</span><br><span class="line">    directory <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">    <span class="keyword">dump</span>-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-<span class="keyword">file</span> <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">    query-<span class="keyword">source</span> port <span class="number">53</span>;</span><br><span class="line">    query-<span class="keyword">source</span>-v6 port <span class="number">53</span>;</span><br><span class="line">    allow-query &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;</span><br><span class="line">    channel default_debug &#123;</span><br><span class="line">    <span class="keyword">file</span> <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">    severity dynamic;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view localhost_resolver &#123;</span><br><span class="line">    match-clients &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    match-destinations &#123; <span class="keyword">any</span>; &#125;; <span class="comment">//修改为any</span></span><br><span class="line">    recursion yes;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>三.修改主机配置文件的扩展文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@server etc]<span class="comment"># vim named.rfc1912.zones //修改主机配置文件的扩展名在最后一行添加</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">zone <span class="string">&quot;shuxun.wang&quot;</span> IN &#123; <span class="regexp">//</span>IN可有可无</span><br><span class="line">    type master; <span class="regexp">//</span>类型为主域</span><br><span class="line">    file <span class="string">&quot;shuxun.wang&quot;</span>; <span class="regexp">//</span>域配置文件</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<p>四.建立shuxun.wang的域配置文件</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">[root@server etc]# cd /var/<span class="keyword">named</span>/chroot/var/<span class="keyword">named</span>/ //进入/var/<span class="keyword">named</span>/chroot/var/<span class="keyword">named</span>/目录</span><br><span class="line">[root@server <span class="keyword">named</span>]# cp <span class="keyword">named</span>.<span class="keyword">local</span> shuxun.wang //拷贝域配置文件</span><br><span class="line">[root@server <span class="keyword">named</span>]# vim shuxun.wang</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">$TTL <span class="number">86400</span></span><br><span class="line">@ <span class="keyword">IN</span> SOA localhost. root.localhost. (</span><br><span class="line"><span class="number">1997022700</span> ; Serial</span><br><span class="line"><span class="number">28800</span> ; Refresh</span><br><span class="line"><span class="number">14400</span> ; Retry</span><br><span class="line"><span class="number">3600000</span> ; Expire</span><br><span class="line"><span class="number">86400</span> ) ; Minimum</span><br><span class="line"><span class="keyword">IN</span> NS localhost.</span><br><span class="line">www <span class="keyword">IN</span> A <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> //修改最后一行为...(此行)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">[root@server <span class="keyword">named</span>]# <span class="keyword">bind</span>-chroot-admin -s //自动设置组和权限</span><br><span class="line">[root@server <span class="keyword">named</span>]# service <span class="keyword">named</span> restart //重启<span class="keyword">named</span>服务</span><br></pre></td></tr></table></figure>

<p>五.测试验证</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@localhost</span> <span class="string">~</span>]<span class="comment"># nslookup //在本机验证解析成功</span></span><br><span class="line"><span class="string">&gt;</span> <span class="string">www.shuxun.wang</span></span><br><span class="line"><span class="attr">Server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"><span class="attr">Address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="comment">#53</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Name:</span> <span class="string">www.shuxun.wang</span></span><br><span class="line"><span class="attr">Address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="string">C:Documents</span> <span class="string">and</span> <span class="string">SettingsAdministrator&gt;nslookup</span> <span class="string">//在远端windows撒谎那个验证成功</span></span><br><span class="line"><span class="string">***</span> <span class="string">Can&#x27;t</span> <span class="attr">find server name for address 219.244.93.2:</span> <span class="string">Non-existent</span> <span class="string">domain</span></span><br><span class="line"><span class="string">***</span> <span class="string">Default</span> <span class="string">servers</span> <span class="string">are</span> <span class="string">not</span> <span class="string">available</span></span><br><span class="line"><span class="attr">Default Server:</span> <span class="string">UnKnown</span></span><br><span class="line"><span class="attr">Address:</span> <span class="number">219.244</span><span class="number">.93</span><span class="number">.2</span> <span class="string">//本来DNS为219.244.93.2</span></span><br><span class="line"></span><br><span class="line"><span class="string">&gt;</span> <span class="string">server</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span> <span class="string">//更改解析主机</span></span><br><span class="line"><span class="attr">Default Server:</span> [<span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>]</span><br><span class="line"><span class="attr">Address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="string">&gt;</span> <span class="string">www.shuxun.wang</span></span><br><span class="line"><span class="attr">Server:</span> [<span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span>]</span><br><span class="line"><span class="attr">Address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Name:</span> <span class="string">www.shuxun.wang</span></span><br><span class="line"><span class="attr">Address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>redis备份恢复</title>
    <url>/2015/08/31/1346/</url>
    <content><![CDATA[<p>1.启动redis<br>进入redis目录</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span></span><br></pre></td></tr></table></figure>

<p>2.数据备份</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">redis</span> <span class="number">127.0.0.1:6379</span>&gt; SAVE </span><br></pre></td></tr></table></figure>

<p>该命令将在 redis 备份目录中创建dump.rdb文件.<br>3.恢复数据<br>1、获取备份目录</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt;<span class="built_in"> CONFIG </span><span class="builtin-name">GET</span> dir</span><br><span class="line"></span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/usr/local/redis/bin&quot;</span>　</span><br></pre></td></tr></table></figure>

<p>以上命令 CONFIG GET dir 输出的 redis 备份目录为 <code>/usr/local/redis/bin</code>.<br>2、停止redis服务<br>3、拷贝备份文件到 <code>/usr/local/redis/bin</code>目录下<br>4、重新启动redis服务</p>
]]></content>
  </entry>
  <entry>
    <title>redis出现(error) READONLY You can&#39;t write against a read only slave.</title>
    <url>/2019/10/09/1347/</url>
    <content><![CDATA[<p>redis为只读模式,而进行了写操作,导致了报错.</p>
<p>之前服务器设置了主从模式来测试哨兵机制,测试完成后关闭了其他服务,留下的一个服务为slave模式,只读,所以 再次使用它进行写操作是导致了报错.</p>
<p>解决:</p>
<p>如果没有没有进行其他的配置更改,直接重启服务就可以了.<br>更改了其他配置,关闭只读模式即可.</p>
]]></content>
  </entry>
  <entry>
    <title>redhat下修改apache端口出错,启动出错</title>
    <url>/2014/08/16/1345/</url>
    <content><![CDATA[<p>错误信息如下:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Starting httpd: (13)Permission denied: make_sock: could <span class="keyword">not</span> bind <span class="keyword">to</span><span class="built_in"> address </span>[::]:81</span><br><span class="line">(13)Permission denied: make_sock: could <span class="keyword">not</span> bind <span class="keyword">to</span><span class="built_in"> address </span>0.0.0.0:81</span><br><span class="line"><span class="literal">no</span> listening sockets available, shutting down</span><br><span class="line">Unable <span class="keyword">to</span> open logs</span><br></pre></td></tr></table></figure>

<p>处理办法:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">semanage port -<span class="selector-tag">a</span> -t http_port_t -<span class="selector-tag">p</span> tcp <span class="number">81</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service httpd start</span><br><span class="line">Starting httpd: <span class="selector-attr">[ OK ]</span> </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>RPM 命令参数使用详解</title>
    <url>/2019/04/18/1349/</url>
    <content><![CDATA[<p>在Linux操作系统中,有一个系统软件包,它的功能类似于Windows里面的”添加/删除程序”,但是功能又比”添加/删除程序”强很多,它就是 Red Hat Package Manager(简称RPM).此工具包最先是由Red Hat公司推出的,后来被其他Linux开发商所借用.由于它为Linux使用者省去了很多时间,所以被广泛应用于在Linux下安装、删除软件.下面就给大家介绍一下它的具体使用方法.</p>
<p>1.我们得到一个新软件,在安装之前,一般都要先查看一下这个软件包里有什么内容,假设这个文件是:Linux-1.4-6.i368.rpm,我们可以用这条命令查看:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -qpi Linux-<span class="number">1</span>.<span class="number">4</span>-<span class="number">6</span>.i<span class="number">368</span>.rpm</span><br></pre></td></tr></table></figure>

<p>系统将会列出这个软件包的详细资料,包括含有多少个文件、各文件名称、文件大小、创建时间、编译日期等信息.</p>
<p>2.上面列出的所有文件在安装时不一定全部安装,就像Windows下程序的安装方式分为典型、完全、自定义一样,Linux也会让你选择安装方式,此时我们可以用下面这条命令查看软件包将会在系统里安装哪些部分,以方便我们的选择:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -qpl Linux-<span class="number">1</span>.<span class="number">4</span>-<span class="number">6</span>.i<span class="number">368</span>.rpm</span><br></pre></td></tr></table></figure>

<p>3.选择安装方式后,开始安装.我们可以用rpm-ivh Linux-1.4-6.i368.rpm命令安装此软件.在安装过程中,若系统提示此软件已安装过或因其他原因无法继续安装,但若我们确实想执行安装命令,可以在 -ivh后加一参数”-replacepkgs”:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh -replacepkgs Linux-<span class="number">1</span>.<span class="number">4</span>-<span class="number">6</span>.i<span class="number">368</span>.rpm</span><br></pre></td></tr></table></figure>

<p>4.有时我们卸载某个安装过的软件,只需执行rpm-e &lt;文件名&gt;命令即可.</p>
<p>5.对低版本软件进行升级是提高其功能的好办法,这样可以省去我们卸载后再安装新软件的麻烦,要升级某个软件,只须执行如下命令:rpm -uvh &lt;文件名&gt;,注意:此时的文件名必须是要升级软件的升级补丁.</p>
<p>6.另外一个安装软件的方法可谓是Linux的独到之处,同时也是RMP强大功能的一个表现:通过FTP站点直接在线安装软件.当找到含有你所需软件的站点并与此网站连接后,执行下面的命令即可实现在线安装,譬如在线安装Linux-1.4-6.i368.rpm,可以用命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -i ftp:<span class="regexp">//</span>ftp.pht.com<span class="regexp">/pub/</span>linux<span class="regexp">/redhat/</span>...-<span class="number">1.4</span>-<span class="number">6</span>.i368.rpm</span><br></pre></td></tr></table></figure>

<p>7.在我们使用电脑过程中,难免会有误操作,若我们误删了几个文件而影响了系统的性能时,怎样查找到底少了哪些文件呢?RPM软件包提供了一个查找损坏文件的功能,执行此命令:rpm -Va即可,Linux将为你列出所有损坏的文件.你可以通过Linux的安装光盘进行修复.</p>
<p>8.Linux系统中文件繁多,在使用过程中,难免会碰到我们不认识的文件,在Windows下我们可以用”开始/查找”菜单快速判断某个文件属于哪个文件夹,在Linux中,下面这条命令行可以帮助我们快速判定某个文件属于哪个软件包:</p>
<figure class="highlight bnf"><table><tr><td class="code"><pre><span class="line">rpm -qf <span class="attribute">&lt;文件名&gt;</span></span><br></pre></td></tr></table></figure>

<p>9.当每个软件包安装在Linux系统后,安装文件都会到RPM数据库中”报到”,所以,我们要查询某个已安装软件的属性时,只需到此数据库中查找即可.注意:此时的查询命令不同于1和8介绍的查询,这种方法只适用于已安装过的软件包!命令格式:</p>
<figure class="highlight bnf"><table><tr><td class="code"><pre><span class="line">rpm -参数 <span class="attribute">&lt;文件名&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>redis主从同步</title>
    <url>/2012/04/01/1348/</url>
    <content><![CDATA[<p>首先在新服务器上直接进入redis-cli,执行从库配置slaveof 192.168.1.100 6379,这里假设要将192.168.1.100的6379端口的redis服务转移过来.这样就已经开始同步了.通过info可以查看当前服务器是slave.<br>然后通过info命令查看master_link_status,如果为up,表示同步完成.(在同步过程中,执行查询的时候还是会提示”Redis is loading the dataset in memory”,这属于正常情况.把数据从磁盘文件加载到内存中可能会消耗很长的一段时间.)<br>最后断开主从关系,在redis-cli命令行下执行slaveof no one提示OK,再通过info查看,该新服务器已经自己变成master了.<br>确保旧的服务器的服务已经停止服务.<br>上面没有配合说明业务代码对服务器的请求切换,但是我们在切换完服务之后肯定需要转移业务代码的请求吧.那么如何确定服务已经完全转移走了呢?<br>在旧服务器上通过netstat命令查看是否还有请求过来.</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -an|<span class="type">grep</span> <span class="string">&quot;100:6379&quot;</span>|<span class="type">wc</span> -l</span><br></pre></td></tr></table></figure>

<p>有时候netstat的结果也不一定准,因为有些请求已经不在,但是socket状态还在,比如CLOSE_WAIT状态最长可持续2小时.同时socket请求太快,也会出现netstat没数据,但是实际网卡有流量的情况.<br>我们可以通过tcdump监控网卡在该端口上确实已经没有流量.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tcpdump</span>  -i em<span class="number">2</span> -vv -nn host  <span class="number">192.168.1.100</span> and  port <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<p>注意排除监控系统对该redis实例的请求.<br>如何判断 redis 已经同步完毕呢?<br>在命令行查看:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">info</span> master_link_status:up</span><br></pre></td></tr></table></figure>

<p>则表示同步完成了.<br>日志文件也可以看:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">24</span>:<span class="number">03.549</span> * The server is now ready to accept connections on port <span class="number">6310</span></span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">52.936</span> * <span class="literal">SLAVE</span> OF <span class="number">192.168</span>.<span class="number">50.17</span>:<span class="number">8004</span> enabled (<span class="keyword">user</span> <span class="title">request</span>)</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.467</span> * Connecting to <span class="keyword">MASTER</span> <span class="title">192</span>.<span class="number">168.50</span>.<span class="number">17</span>:<span class="number">8004</span></span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.467</span> * <span class="keyword">MASTER</span> <span class="title">&lt;-&gt; SLAVE</span> sync <span class="literal">started</span></span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.470</span> * Non blocking connect for SYNC fired the event.</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.470</span> * <span class="keyword">Master</span> <span class="title">replied</span> to PING, replication can continue...</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.470</span> * Partial resynchronization not possible (no cached <span class="literal">master</span>)</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.470</span> * <span class="keyword">Master</span> <span class="title">does</span> not support PSYNC <span class="keyword">or</span> is <span class="keyword">in</span> error state (reply: -ERR unknown command &#x27;PSYNC&#x27;)</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">31</span>:<span class="number">53.470</span> * Retrying with SYNC...</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">32</span>:<span class="number">13.085</span> * <span class="keyword">MASTER</span> <span class="title">&lt;-&gt; SLAVE</span> sync: receiving <span class="number">484322714</span> bytes from <span class="keyword">master</span></span><br><span class="line"><span class="title">[48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">32</span>:<span class="number">18.498</span> * <span class="keyword">MASTER</span> <span class="title">&lt;-&gt; SLAVE</span> sync: Flushing old data</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">32</span>:<span class="number">18.498</span> * <span class="keyword">MASTER</span> <span class="title">&lt;-&gt; SLAVE</span> sync: Loading DB <span class="keyword">in</span> memory</span><br><span class="line">[<span class="number">48864</span>] <span class="number">12</span> Jun <span class="number">11</span>:<span class="number">32</span>:<span class="number">32.349</span> * <span class="keyword">MASTER</span> <span class="title">&lt;-&gt; SLAVE</span> sync: Finished with succes</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>rrd的ExtUtils错误解决</title>
    <url>/2012/01/04/1350/</url>
    <content><![CDATA[<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ perl Makefile.<span class="keyword">PL</span> <span class="comment">//perl脚本检查包依赖关系</span></span><br><span class="line"></span><br><span class="line">Can&#x27;t locate ExtUtils/MakeMaker.pm <span class="keyword">in</span> @INC (@INC contains: /usr/<span class="keyword">local</span>/lib64/perl5 /usr/<span class="keyword">local</span>/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at Makefile.<span class="keyword">PL</span> <span class="keyword">line</span> 2.</span><br><span class="line">BEGIN failed--compilation aborted at Makefile.<span class="keyword">PL</span> <span class="keyword">line</span> 2.</span><br></pre></td></tr></table></figure>

<p>缺少perl-ExtUtils-MakeMaker依赖包,安装即可:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">$ yum <span class="keyword">install </span>perl-<span class="keyword">ExtUtils-MakeMaker </span>perl-<span class="keyword">ExtUtils-CBuilder</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ruby scriptserver 出错(openssl),解决方法</title>
    <url>/2014/02/02/1351/</url>
    <content><![CDATA[<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">ruby <span class="keyword">script</span>/server</span><br></pre></td></tr></table></figure>

<p>错误信息如下:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">=&gt; Booting WEBrick...</span><br><span class="line">/usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/rails-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/initializer.rb:<span class="number">259</span>:<span class="keyword">in</span> `require_frameworks<span class="comment">&#x27;: no such file to load -- openssl (RuntimeError)</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/rails-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/initializer.rb:<span class="number">133</span>:<span class="keyword">in</span> `process<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/rails-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/initializer.rb:<span class="number">112</span>:<span class="keyword">in</span> `send<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/rails-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/initializer.rb:<span class="number">112</span>:<span class="keyword">in</span> `run<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /home/zhaorong/workspace/test/config/environment.rb:<span class="number">13</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_require<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `require<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/activesupport-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/active_support/dependencies.rb:<span class="number">153</span>:<span class="keyword">in</span> `require<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/activesupport-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/active_support/dependencies.rb:<span class="number">521</span>:<span class="keyword">in</span> `new_constants_in<span class="comment">&#x27;</span></span><br><span class="line">... <span class="number">7</span> levels...</span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/gems/<span class="number">1.8</span>/gems/rails-<span class="number">2.2</span>.<span class="number">2</span>/<span class="keyword">lib</span>/commands/server.rb:<span class="number">49</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `gem_original_require<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> /usr/local/ruby/<span class="keyword">lib</span>/ruby/site_ruby/<span class="number">1.8</span>/rubygems/custom_require.rb:<span class="number">31</span>:<span class="keyword">in</span> `require<span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">from</span> script/server:<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt-get install libopenssl-ruby<span class="number">1</span>.<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>如果不是编译的ruby版本的话,问题就解决了.<br>对于编译的版本还需要做以下操作:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> /ruby_source_directory/ext/openssl</span><br><span class="line"><span class="keyword">ruby</span> extconf.rb</span><br><span class="line">sudo <span class="keyword">make</span></span><br><span class="line">sudo <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>

<p>ruby_source_directory是编译ruby的路径,不是安装路径.<br>问题完美解决.</p>
]]></content>
  </entry>
  <entry>
    <title>ruby1.9 rails视图中中文显示为乱码</title>
    <url>/2017/12/01/1352/</url>
    <content><![CDATA[<p>以前正常的ruby1.8.7+rails3程序(运行环境为windows操作系统),现将ruby升级为ruby1.9.2后rails3后从数据库读出的中文字符在页面视图(.rhtml)中显示为乱码(中文保存到数据库中正常),控制器第一行 Datagrid model第一行 .rhtml文件开头也加上还是乱码.</p>
<p>解决办法:</p>
<p>连接mysql用mysql换成mysql2问题解决.</p>
]]></content>
  </entry>
  <entry>
    <title>rubygems版本升级</title>
    <url>/2016/06/19/1353/</url>
    <content><![CDATA[<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">gem update --<span class="keyword">system</span>=<span class="number">1.7</span><span class="number">.2</span> # 升级到指定版本</span><br><span class="line"></span><br><span class="line">gem update --<span class="keyword">system</span>        # 升级到最新版本</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>scp命令详解</title>
    <url>/2013/06/27/1355/</url>
    <content><![CDATA[<p>相信各位VPSer在使用VPS时会经常在不同VPS间互相备份数据或者转移数据,大部分情况下VPS上都已经安装了Nginx或者类似的web server,直接将要传输的文件放到web server的目录,然后在目标机器上执行:wget <a href="http://shuxun.wang/testfile.zip">http://shuxun.wang/testfile.zip</a> 就行了.当VPS上没有安装web server和ftp server的时候或感觉上面的方法比较麻烦,那么用scp命令就会排上用场.</p>
<p>一、scp是什么?</p>
<p>scp是secure copy的简写,用于在Linux下进行远程拷贝文件的命令,和它类似的命令有cp,不过cp只是在本机进行拷贝不能跨服务器,而且scp传输是加密的.可能会稍微影响一下速度.</p>
<p>二、scp有什么用?</p>
<p>1、我们需要获得远程服务器上的某个文件,远程服务器既没有配置ftp服务器,没有开启web服务器,也没有做共享,无法通过常规途径获得文件时,只需要通过scp命令便可轻松的达到目的.<br>2、我们需要将本机上的文件上传到远程服务器上,远程服务器没有开启ftp服务器或共享,无法通过常规途径上传是,只需要通过scp命令便可以轻松的达到目的.</p>
<p>三、scp使用方法</p>
<p>1、获取远程服务器上的文件</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">scp</span> -P <span class="number">2222</span> root@shuxun.wang:/root/lnmp<span class="number">0</span>.<span class="number">4</span>.tar.gz /home/lnmp<span class="number">0</span>.<span class="number">4</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>上端口大写P 为参数,2222 表示更改SSH端口后的端口,如果没有更改SSH端口可以不用添加该参数. <a href="mailto:&#114;&#x6f;&#111;&#116;&#x40;&#115;&#104;&#117;&#x78;&#117;&#110;&#46;&#x77;&#97;&#110;&#x67;">&#114;&#x6f;&#111;&#116;&#x40;&#115;&#104;&#117;&#x78;&#117;&#110;&#46;&#x77;&#97;&#110;&#x67;</a> 表示使用root用户登录远程服务器shuxun.wang,<code>:/root/lnmp0.4.tar.gz</code> 表示远程服务器上的文件,最后面的 <code>/home/lnmp0.4.tar.gz</code>表示保存在本地上的路径和文件名.</p>
<p>2、获取远程服务器上的目录</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">scp -P <span class="number">2222</span> -r root@shuxun.wang:<span class="regexp">/root/</span>lnmp0.<span class="number">4</span><span class="regexp">/ /</span>home<span class="regexp">/lnmp0.4/</span></span><br></pre></td></tr></table></figure>

<p>上端口大写P 为参数,2222 表示更改SSH端口后的端口,如果没有更改SSH端口可以不用添加该参数.-r 参数表示递归复制(即复制该目录下面的文件和目录);<a href="mailto:&#x72;&#111;&#111;&#x74;&#x40;&#x73;&#x68;&#x75;&#x78;&#x75;&#110;&#x2e;&#x77;&#97;&#x6e;&#103;">&#x72;&#111;&#111;&#x74;&#x40;&#x73;&#x68;&#x75;&#x78;&#x75;&#110;&#x2e;&#x77;&#97;&#x6e;&#103;</a> 表示使用root用户登录远程服务器shuxun.wang,<code>:/root/lnmp0.4/</code> 表示远程服务器上的目录,最后面的 <code>/home/lnmp0.4/</code>表示保存在本地上的路径.</p>
<p>3、将本地文件上传到服务器上</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">scp</span> -P <span class="number">2222</span> /home/lnmp<span class="number">0</span>.<span class="number">4</span>.tar.gz root@shuxun.wang:/root/lnmp<span class="number">0</span>.<span class="number">4</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>上端口大写P 为参数,2222 表示更改SSH端口后的端口,如果没有更改SSH端口可以不用添加该参数. <code>/home/lnmp0.4.tar.gz</code>表示本地上准备上传文件的路径和文件名.root@shuxun 表示使用root用户登录远程服务器shuxun.wang,<code>:/root/lnmp0.4.tar.gz</code> 表示保存在远程服务器上目录和文件名.</p>
<p>4、将本地目录上传到服务器上</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">scp -P <span class="number">2222</span> -r <span class="regexp">/home/</span>lnmp0.<span class="number">4</span><span class="regexp">/ root@shuxun.wang:/</span>root<span class="regexp">/lnmp0.4/</span></span><br></pre></td></tr></table></figure>

<p>上 端口大写P 为参数,2222 表示更改SSH端口后的端口,如果没有更改SSH端口可以不用添加该参数.-r 参数表示递归复制(即复制该目录下面的文件和目录);<code>/home/lnmp0.4/</code>表示准备要上传的目录,<a href="mailto:&#114;&#111;&#x6f;&#x74;&#x40;&#x73;&#x68;&#x75;&#120;&#x75;&#110;&#46;&#119;&#x61;&#110;&#x67;">&#114;&#111;&#x6f;&#x74;&#x40;&#x73;&#x68;&#x75;&#120;&#x75;&#110;&#46;&#119;&#x61;&#110;&#x67;</a> 表示使用root用户登录远程服务器shuxun.wang,<code>:/root/lnmp0.4/</code> 表示保存在远程服务器上的目录位置.</p>
<p>5、可能有用的几个参数</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">v <span class="comment">#和大多数 linux 命令中的 -v 意思一样 , 用来显示进度 . 可以用来查看连接 , 认证 , 或是配置错误 .</span></span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">C <span class="comment">#使能压缩选项 .</span></span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"><span class="number">4</span> <span class="comment">#强行使用 IPV4 地址 .</span></span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby"><span class="number">6</span> <span class="comment">#强行使用 IPV6 地址 .</span></span></span><br></pre></td></tr></table></figure>

<p>附上将DiaHosting VPS 上的文件 scp传输Linode上的截图,速度在10MB/s.</p>
]]></content>
  </entry>
  <entry>
    <title>samba拒绝访问 samba不能创建文件</title>
    <url>/2017/02/24/1354/</url>
    <content><![CDATA[<p>关闭selinux就可以解决问题,关闭方法:<br>编辑 <code>/etc/selinux/config</code></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment"># enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment"># permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment"># disabled - SELinux is fully disabled.</span></span><br><span class="line"><span class="attr">SELINUX</span>=disabled <span class="comment">#把这里改成disabled</span></span><br><span class="line"><span class="comment"># SELINUXTYPE= type of policy in use. Possible values are:</span></span><br><span class="line"><span class="comment"># targeted - Only targeted network daemons are protected.</span></span><br><span class="line"><span class="comment"># strict - Full SELinux protection.</span></span><br><span class="line"><span class="attr">SELINUXTYPE</span>=targeted</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>skill-命令使用方法介绍(linux命令)</title>
    <url>/2013/03/02/1357/</url>
    <content><![CDATA[<p>送个讯号给正在执行的程序,预设的讯息为 TERM (中断) , 较常使用的讯息为 HUP , INT , KILL , STOP , CONT ,和 0<br>讯息有三种写法:分别为 -9 , -SIGKILL , -KILL , 可以使用 -l 或 -L 已列出可使用的讯息.</p>
<p>一般参数:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-f 快速模式/尚未完成</span></span><br><span class="line"><span class="deletion">-i 互动模式/ 每个动作将要被确认</span></span><br><span class="line"><span class="deletion">-v 详细输出/ 列出所选择程序的资讯</span></span><br><span class="line"><span class="deletion">-w 智能警告讯息/ 尚未完成</span></span><br><span class="line"><span class="deletion">-n 没有动作/ 显示程序代号</span></span><br><span class="line">参数:选择程序的规则可以是, 终端机代号,使用者名称,程序代号,命令名称.</span><br><span class="line"><span class="deletion">-t 终端机代号 ( tty 或 pty )</span></span><br><span class="line"><span class="deletion">-u 使用者名称</span></span><br><span class="line"><span class="deletion">-p 程序代号 ( pid )</span></span><br><span class="line"><span class="deletion">-c 命令名称 可使用的讯号:</span></span><br></pre></td></tr></table></figure>
<p>范例:</p>
<p>停止所有在PTY装置上的程序:</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">skill -<span class="keyword">KILL</span> -v pts<span class="comment">/*</span></span><br></pre></td></tr></table></figure>
<p>停止三个使用者 user1,user2,user3:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">skill</span> -STOP user<span class="number">1</span> user<span class="number">2</span> user<span class="number">3</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>shell常用命令</title>
    <url>/2014/05/13/1356/</url>
    <content><![CDATA[<p>shell获取命令输出的某行某列:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">free</span> -m | sed -n <span class="string">&quot;1&quot;</span>p | awk <span class="string">&#x27;&#123;print <span class="variable">$2</span>&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>删除所有txt但不包括1.txt:</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> . -<span class="built_in">name</span> <span class="string">&quot;*.txt&quot;</span> -a ! -<span class="built_in">name</span> <span class="string">&quot;1.txt&quot;</span> -<span class="built_in">exec</span> rm &#123;&#125; \; </span><br></pre></td></tr></table></figure>

<p>计算长度:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">echo</span> <span class="number">123123123123</span> | awk <span class="string">&#x27;&#123;print length(<span class="variable">$0</span>)&#125;&#x27;</span> </span><br></pre></td></tr></table></figure>

<p>统计进程数量:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ps</span> aux | <span class="keyword">grep</span> httpd | <span class="keyword">grep</span> -v <span class="keyword">grep</span> | wc -<span class="keyword">l</span> </span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>snort所有依赖包</title>
    <url>/2017/02/18/1359/</url>
    <content><![CDATA[<p>大家一定在安装snort的时候经常找不到需要的包,站长发现一个整理好的ftp地址,里面有snort需要的所有程序,非常方便,这里分享给大家.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>vscojot.free.fr<span class="regexp">/dist/</span>snort/</span><br></pre></td></tr></table></figure>
<p>不能保证永久有效,如果失效了,忘告知.</p>
]]></content>
  </entry>
  <entry>
    <title>snort安装daq时报错</title>
    <url>/2013/02/02/1358/</url>
    <content><![CDATA[<p>daq运行./configure时报错:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">ERROR! Libpcap library <span class="built_in">version</span> &gt;= <span class="string">&quot;1.0.0&quot;</span> <span class="keyword">not</span> found.</span><br><span class="line">Get <span class="keyword">it</span> <span class="built_in">from</span> <span class="keyword">http</span>://www.tcpdump.org<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>尝试以下做法,无果:</p>
<p>1.yum卸载掉0.9.4版本.<br>2.下载1.1.1版本源码包,安装.<br>3.再次运行daq,问题依旧.<br>4.复制<code>/usr/local/lib/libpcap.a</code>到<code>/usr/lib</code>.<br>5.再运行daq,问题依旧.</p>
<p>最终找到了解决办法:</p>
<p>从<code>http://vscojot.free.fr/dist/snort/</code>下载libpcap的rpm包,安装,问题解决<br>浪费了一下午的时间,靠…</p>
]]></content>
  </entry>
  <entry>
    <title>sqlserver 镜像同步</title>
    <url>/2018/08/31/1360/</url>
    <content><![CDATA[<p>防火墙打开5022进出.<br>完整备份A服务器上的Test库.</p>
<p>主机执行完整备份:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">USEmaster;</span><br><span class="line">ALTERDATABASETestSETRECOVERYFULL;</span><br><span class="line">GO</span><br><span class="line"><span class="attribute">BACKUPDATABASETestTODISK</span>=<span class="string">&#x27;D:\SQLServerBackups\Test.bak&#x27;</span>WITHFORMAT;</span><br><span class="line">GO</span><br><span class="line"><span class="attribute">BACKUPLOGTestTODISK</span>=<span class="string">&#x27;D:\SQLServerBackups\Test.bak&#x27;</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>–将备份文件拷贝到B上.<br>一定要执行完整备份.<br>在B服务器上完整还原数据库:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">RESTOREDATABASETestFROMDISK=&#x27;D:<span class="symbol">\B</span>ack<span class="symbol">\T</span>est.bak&#x27;WITHNORECOVERY</span><br><span class="line">GO</span><br><span class="line">RESTORELOGTestFROMDISK=&#x27;D:<span class="symbol">\B</span>ack<span class="symbol">\T</span>est_log.bak&#x27;WITHFILE=1,NORECOVERY</span><br><span class="line">GO</span><br><span class="line">在Host_A上执行</span><br><span class="line">USEmaster;</span><br><span class="line">GO</span><br><span class="line">//在master数据库中,创建数据库主密钥(如果需要).</span><br><span class="line">CREATEMASTERKEYENCRYPTIONBYPASSWORD=&#x27;password&#x27;;</span><br><span class="line">GO</span><br><span class="line">CREATECERTIFICATEHOST_A_cert</span><br><span class="line">WITHSUBJECT=&#x27;HOST_Acertificate&#x27;;</span><br><span class="line">GO</span><br><span class="line"><span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span>Object:Endpoint[镜像]ScriptDate:09/01/200917:44:54<span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span></span><br><span class="line">IFEXISTS(SELECT*FROMsys.endpointseWHEREe.name=N&#x27;镜像&#x27;)</span><br><span class="line">DROPENDPOINT[镜像]</span><br><span class="line">GO</span><br><span class="line"><span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span>Object:Endpoint[镜像]ScriptDate:09/01/200917:44:54<span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span></span><br><span class="line">CREATEENDPOINT[镜像]</span><br><span class="line">AUTHORIZATION[sa]</span><br><span class="line">STATE=STARTED</span><br><span class="line">ASTCP(LISTENER_PORT=5022,LISTENER_IP=ALL)</span><br><span class="line">FORDATA_MIRRORING(ROLE=PARTNER,AUTHENTICATION=CERTIFICATEHOST_A_cert</span><br><span class="line">,ENCRYPTION=REQUIREDALGORITHMRC4)</span><br><span class="line">GO</span><br><span class="line">BACKUPCERTIFICATEHOST_B_certTOFILE=&#x27;D:<span class="symbol">\D</span>ata<span class="symbol">\H</span>OST_A_cert.cer&#x27;;</span><br></pre></td></tr></table></figure>

<p>步骤二</p>
<p>在Host_B上执行:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">//在master数据库中,创建数据库主密钥(如果需要).</span><br><span class="line">CREATEMASTERKEYENCRYPTIONBYPASSWORD=&#x27;password&#x27;;</span><br><span class="line">GO</span><br><span class="line">CREATECERTIFICATEHOST_B_cert</span><br><span class="line">WITHSUBJECT=&#x27;HOST_Bcertificate&#x27;;</span><br><span class="line">GO</span><br><span class="line"><span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span>Object:Endpoint[镜像]ScriptDate:09/01/200917:44:54<span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span></span><br><span class="line">IFEXISTS(SELECT*FROMsys.endpointseWHEREe.name=N&#x27;镜像&#x27;)</span><br><span class="line">DROPENDPOINT[镜像]</span><br><span class="line">GO</span><br><span class="line"><span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span>Object:Endpoint[镜像]ScriptDate:09/01/200917:44:54<span class="symbol">\\</span><span class="symbol">\\</span><span class="symbol">\\</span></span><br><span class="line">CREATEENDPOINT[镜像]</span><br><span class="line">AUTHORIZATION[sa]</span><br><span class="line">STATE=STARTED</span><br><span class="line">ASTCP(LISTENER_PORT=5022,LISTENER_IP=ALL)</span><br><span class="line">FORDATA_MIRRORING(ROLE=PARTNER,AUTHENTICATION=CERTIFICATEHOST_B_cert</span><br><span class="line">,ENCRYPTION=REQUIREDALGORITHMRC4)</span><br><span class="line">GO</span><br><span class="line">BACKUPCERTIFICATEHOST_B_certTOFILE=&#x27;D:<span class="symbol">\D</span>ata<span class="symbol">\H</span>OST_B_cert.cer&#x27;;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>步骤三</p>
<p>复制HOST_A_cert.cer到Host_B,复制复制HOST_B_cert.cer到Host_A.</p>
<p>步骤四</p>
<p>在Host_A上执行:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">USEmaster;</span><br><span class="line"><span class="attribute">CREATELOGINHOST_B_loginWITHPASSWORD</span>=<span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">GO</span><br><span class="line">CREATEUSERHOST_B_userFORLOGINHOST_B_login;</span><br><span class="line">GO</span><br><span class="line">CREATECERTIFICATEHOST_B_cert</span><br><span class="line">AUTHORIZATIONHOST_B_user</span><br><span class="line"><span class="attribute">FROMFILE</span>=<span class="string">&#x27;D:\backup\HOST_B_cert.cer&#x27;</span></span><br><span class="line">GO</span><br><span class="line">GRANTCONNECTONENDPOINT::[镜像]<span class="keyword">TO</span>[HOST_B_login];</span><br></pre></td></tr></table></figure>

<p>步骤五</p>
<p>在Host_B上执行:<br>USEmaster;<br>CREATELOGINHOST_A_loginWITHPASSWORD=’password’;<br>GO<br>CREATEUSERHOST_A_userFORLOGINHOST_A_login;<br>GO<br>CREATECERTIFICATEHOST_A_cert<br>AUTHORIZATIONHOST_A_user<br>FROMFILE=’D:\backup\HOST_A_cert.cer’<br>GO<br>GRANTCONNECTONENDPOINT::[镜像]TO[HOST_A_login]</p>
<p>先在镜像服务器上执行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ALTERDATABASETestSETPARTNER</span>=<span class="string">&#x27;TCP://192.168.10.2:5022&#x27;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>成功之后再在主机上执行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ALTERDATABASETestSETPARTNER</span>=<span class="string">&#x27;TCP://192.168.10.2:5022&#x27;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>这样两台服务器的镜像就同步了.<br>删除镜像:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ALTERDATABASETestSETPARTNEROFF</span></span><br></pre></td></tr></table></figure>

<p>如果主机出现问题,在主机执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">USEMASTERGoALTERDATABASETestSETPARTNERFAILOVERGo</span></span><br></pre></td></tr></table></figure>

<p>总结:</p>
<p>如果在建立镜像的时候中间的那个步骤出问题,需要重新执行的时候一定要把该删得东西删除掉.</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">-查询镜像select*fromsys.endpoints</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-删除端口dropendpointEndpoint_As</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-查询证书select*fromsys.symmetric_keys</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-删除证书,先删除证书再删除主键DROPCERTIFICATEAs_A_cert</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-删除主键DROPMASTERKEY</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-删除镜像alterdatabase&lt;dbname&gt;setpartneroff</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">-删除登录名droplogin&lt;login_name&gt;&lt;<span class="regexp">/login_name&gt;&lt;/dbname</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ssl证书生成方法</title>
    <url>/2018/07/20/1364/</url>
    <content><![CDATA[<p>一般情况下,如果能找到可用的证书,就可以直接使用,只不过会因证书的某些信息不正确或与部署证书的主机不匹配而导致浏览器提示证书无效,但这并不影响使用.<br>需要手工生成证书的情况有:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">1.找不到可用的证书</span><br><span class="line">2.需要配置双向SSL,但缺少客户端证书</span><br><span class="line">3.需要对证书作特别的定制</span><br></pre></td></tr></table></figure>

<p>首先,无论是在Linux下还是在Windows下的Cygwin中,进行下面的操作前都须确认已安装OpenSSL软件包.</p>
<p>1.创建根证书密钥文件root.key</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">openssl genrsa -des3 -<span class="meta">out</span> root.<span class="meta">key</span></span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">$ openssl genrsa -des3 -out<span class="built_in"> root</span><span class="built_in">.key</span></span><br><span class="line"></span><br><span class="line">Generating RSA private<span class="built_in"> key</span>, <span class="number">512</span> bit long modulus</span><br><span class="line">……………..++++++++++++</span><br><span class="line">..++++++++++++</span><br><span class="line">e <span class="literal">is</span> <span class="number">65537</span> (<span class="number">0</span>×<span class="number">10001</span>)</span><br><span class="line">Enter pass phrase <span class="keyword">for</span><span class="built_in"> root</span><span class="built_in">.key</span>: ← 输入一个新密码</span><br><span class="line">Verifying – Enter pass phrase <span class="keyword">for</span><span class="built_in"> root</span><span class="built_in">.key</span>: ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>2.创建根证书的申请文件root.req</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">openssl req -<span class="built_in">new</span> -<span class="built_in">key</span> root.<span class="built_in">key</span> -out root.req</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ openssl req -<span class="built_in">new</span> -key root.key -<span class="keyword">out</span> root.req</span><br><span class="line"></span><br><span class="line">Enter pass phrase <span class="keyword">for</span> root.key: ← 输入前面创建的密码</span><br><span class="line">You are about <span class="keyword">to</span> be asked <span class="keyword">to</span> enter information that will be incorporated</span><br><span class="line"><span class="keyword">into</span> your certificate request.</span><br><span class="line">What you are about <span class="keyword">to</span> enter <span class="keyword">is</span> what <span class="keyword">is</span> <span class="keyword">called</span> a Distinguished <span class="type">Name</span> <span class="keyword">or</span> a DN.</span><br><span class="line">There are quite a few fields but you can leave <span class="keyword">some</span> blank</span><br><span class="line"><span class="keyword">For</span> <span class="keyword">some</span> fields there will be a <span class="keyword">default</span> <span class="keyword">value</span>,</span><br><span class="line"><span class="keyword">If</span> you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">—–</span><br><span class="line">Country <span class="type">Name</span> (<span class="number">2</span> letter code) [AU]:CN ← 国家代号,中国输入CN</span><br><span class="line">State <span class="keyword">or</span> Province <span class="type">Name</span> (<span class="keyword">full</span> <span class="type">name</span>) [<span class="keyword">Some</span>-State]:BeiJing ← 省的全名,拼音</span><br><span class="line">Locality <span class="type">Name</span> (eg, city) []:BeiJing ← 市的全名,拼音</span><br><span class="line">Organization <span class="type">Name</span> (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名</span><br><span class="line">Organizational Unit <span class="type">Name</span> (eg, section) []: ← 可以不输入</span><br><span class="line">Common <span class="type">Name</span> (eg, YOUR <span class="type">name</span>) []: ← 此时不输入</span><br><span class="line">Email Address []:<span class="keyword">admin</span>@mycompany.com ← 电子邮箱,可随意填</span><br><span class="line">Please enter the <span class="keyword">following</span> <span class="string">&#x27;extra&#x27;</span> attributes</span><br><span class="line"><span class="keyword">to</span> be sent <span class="keyword">with</span> your certificate request</span><br><span class="line">A challenge <span class="keyword">password</span> []: ← 可以不输入</span><br><span class="line">An optional company <span class="type">name</span> []: ← 可以不输入</span><br></pre></td></tr></table></figure>

<p>3.创建一个自当前日期起为期十年的根证书root.crt</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">openssl</span> x<span class="number">509</span> -req -days <span class="number">3650</span> -sha<span class="number">1</span> -extensions v<span class="number">3</span>_ca -signkey root.key -in root.req -out root.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">$ openssl x509 -req -days <span class="number">3650</span> -sha1 -extensions v3_ca -signkey<span class="built_in"> root</span><span class="built_in">.key</span> -<span class="keyword">in</span><span class="built_in"> root</span>.req -out<span class="built_in"> root</span>.crt</span><br><span class="line"></span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./emailAddress=admin@mycompany.com</span><br><span class="line">Getting Private<span class="built_in"> key</span></span><br><span class="line">Enter pass phrase <span class="keyword">for</span><span class="built_in"> root</span><span class="built_in">.key</span>: ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>4.创建服务器证书密钥server.key</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">openssl genrsa -<span class="keyword">out</span> <span class="keyword">server</span>.key <span class="number">2048</span></span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">$ openssl genrsa -out <span class="keyword">server</span>.key <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">Generating RSA <span class="keyword">private</span> key, <span class="number">2048</span> bit <span class="built_in">long</span> modulus</span><br><span class="line">….+++</span><br><span class="line">…………………………………………..+++</span><br><span class="line">e <span class="keyword">is</span> <span class="number">65537</span> (<span class="number">0</span>×<span class="number">10001</span>)</span><br></pre></td></tr></table></figure>

<p>5.创建服务器证书的申请文件server.req</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">openssl req -<span class="built_in">new</span> -key <span class="keyword">server</span>.key -<span class="keyword">out</span> <span class="keyword">server</span>.req</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ openssl req -<span class="built_in">new</span> -key <span class="keyword">server</span>.key -<span class="keyword">out</span> <span class="keyword">server</span>.req</span><br><span class="line"></span><br><span class="line">You are about <span class="keyword">to</span> be asked <span class="keyword">to</span> enter information that will be incorporated</span><br><span class="line"><span class="keyword">into</span> your certificate request.</span><br><span class="line">What you are about <span class="keyword">to</span> enter <span class="keyword">is</span> what <span class="keyword">is</span> <span class="keyword">called</span> a Distinguished <span class="type">Name</span> <span class="keyword">or</span> a DN.</span><br><span class="line">There are quite a few fields but you can leave <span class="keyword">some</span> blank</span><br><span class="line"><span class="keyword">For</span> <span class="keyword">some</span> fields there will be a <span class="keyword">default</span> <span class="keyword">value</span>,</span><br><span class="line"><span class="keyword">If</span> you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">—–</span><br><span class="line">Country <span class="type">Name</span> (<span class="number">2</span> letter code) [AU]:CN ← 国家名称,中国输入CN</span><br><span class="line">State <span class="keyword">or</span> Province <span class="type">Name</span> (<span class="keyword">full</span> <span class="type">name</span>) [<span class="keyword">Some</span>-State]:BeiJing ← 省名,拼音</span><br><span class="line">Locality <span class="type">Name</span> (eg, city) []:BeiJing ← 市名,拼音</span><br><span class="line">Organization <span class="type">Name</span> (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名</span><br><span class="line">Organizational Unit <span class="type">Name</span> (eg, section) []: ← 可以不输入</span><br><span class="line">Common <span class="type">Name</span> (eg, YOUR <span class="type">name</span>) []:www.mycompany.com ← 服务器主机名,若填写不正确,浏览器会报告证书无效,但并不影响使用</span><br><span class="line">Email Address []:<span class="keyword">admin</span>@mycompany.com ← 电子邮箱,可随便填</span><br><span class="line">Please enter the <span class="keyword">following</span> <span class="string">&#x27;extra&#x27;</span> attributes</span><br><span class="line"><span class="keyword">to</span> be sent <span class="keyword">with</span> your certificate request</span><br><span class="line">A challenge <span class="keyword">password</span> []: ← 可以不输入</span><br><span class="line">An optional company <span class="type">name</span> []: ← 可以不输入</span><br></pre></td></tr></table></figure>

<p>6.创建自当前日期起有效期为期两年的服务器证书server.crt</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">openssl</span> x<span class="number">509</span> -req -days <span class="number">730</span> -sha<span class="number">1</span> -extensions v<span class="number">3</span>_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in server.req -out server.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$ openssl x509 -req -days <span class="number">730</span> -sha1 -extensions v3_req -CA root<span class="selector-class">.crt</span> -CAkey root<span class="selector-class">.key</span> -CAserial root<span class="selector-class">.srl</span> -CAcreateserial -<span class="keyword">in</span> server<span class="selector-class">.req</span> -out server<span class="selector-class">.crt</span></span><br><span class="line"></span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www<span class="selector-class">.mycompany</span>.com/emailAddress=admin@mycompany<span class="selector-class">.com</span></span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> root<span class="selector-class">.key</span>: ← 输入前面创建的密码</span><br></pre></td></tr></table></figure>

<p>7.创建客户端证书密钥文件client.key</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">openssl</span> genrsa -des<span class="number">3</span> -out client.key <span class="number">2048</span></span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">$ openssl genrsa -des3 -out <span class="keyword">client</span>.key <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">Generating RSA <span class="keyword">private</span> key, <span class="number">2048</span> bit <span class="built_in">long</span> modulus</span><br><span class="line">……………………………………………………………………………..+++</span><br><span class="line">……………………………………………………………………………………………………….+++</span><br><span class="line">e <span class="keyword">is</span> <span class="number">65537</span> (<span class="number">0</span>×<span class="number">10001</span>)</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> <span class="keyword">client</span>.key: ← 输入一个新密码</span><br><span class="line">Verifying – Enter pass phrase <span class="keyword">for</span> <span class="keyword">client</span>.key: ← 重新输入一遍密码</span><br></pre></td></tr></table></figure>

<p>8.创建客户端证书的申请文件client.req</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">openssl req -<span class="keyword">new</span> -key <span class="keyword">client</span>.key -out <span class="keyword">client</span>.req</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">$ openssl genrsa -des3 -<span class="keyword">out</span> client.key <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">Generating RSA <span class="keyword">private</span> key, <span class="number">2048</span> bit long modulus</span><br><span class="line">……………………………………………………………………………..+++</span><br><span class="line">……………………………………………………………………………………………………….+++</span><br><span class="line">e <span class="keyword">is</span> <span class="number">65537</span> (<span class="number">0</span>×<span class="number">10001</span>)</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> client.key:</span><br><span class="line">Verifying – Enter pass phrase <span class="keyword">for</span> client.key:</span><br><span class="line">[lenin@archer ~]$ openssl req -new -key client.key -<span class="keyword">out</span> client.req</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> client.key: ← 输入上一步中创建的密码</span><br><span class="line">You are about <span class="keyword">to</span> be asked <span class="keyword">to</span> enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about <span class="keyword">to</span> enter <span class="keyword">is</span> what <span class="keyword">is</span> called a Distinguished <span class="keyword">Name</span> <span class="keyword">or</span> a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line"><span class="keyword">For</span> some fields there will be a <span class="keyword">default</span> value,</span><br><span class="line"><span class="keyword">If</span> you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">—–</span><br><span class="line">Country <span class="keyword">Name</span> (<span class="number">2</span> letter code) [AU]:CN ← 国家名称,中国输入CN</span><br><span class="line">State <span class="keyword">or</span> Province <span class="keyword">Name</span> (full <span class="keyword">name</span>) [Some-State]:BeiJing ← 省名称,拼音</span><br><span class="line">Locality <span class="keyword">Name</span> (eg, city) []:BeiJing ← 市名称,拼音</span><br><span class="line">Organization <span class="keyword">Name</span> (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名</span><br><span class="line">Organizational <span class="keyword">Unit</span> <span class="keyword">Name</span> (eg, section) []: ← 可以不填</span><br><span class="line">Common <span class="keyword">Name</span> (eg, YOUR <span class="keyword">name</span>) []:Lenin ← 自己的英文名,可以随便填</span><br><span class="line">Email Address []:admin@mycompany.com ← 电子邮箱,可以随便填</span><br><span class="line">Please enter the following <span class="string">&#x27;extra&#x27;</span> attributes</span><br><span class="line"><span class="keyword">to</span> be sent <span class="keyword">with</span> your certificate request</span><br><span class="line">A challenge password []: ← 可以不填</span><br><span class="line">An optional company <span class="keyword">name</span> []: ← 可以不填</span><br></pre></td></tr></table></figure>

<p>9.创建一个自当前日期起有效期为两年的客户端证书client.crt</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">openssl</span> x<span class="number">509</span> -req -days <span class="number">730</span> -sha<span class="number">1</span> -extensions v<span class="number">3</span>_req -CA root.crt -CAkey root.key -CAserial root.srl -CAcreateserial -in client.req -out client.crt</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$ openssl x509 -req -days <span class="number">730</span> -sha1 -extensions v3_req -CA root<span class="selector-class">.crt</span> -CAkey root<span class="selector-class">.key</span> -CAserial root<span class="selector-class">.srl</span> -CAcreateserial -<span class="keyword">in</span> client<span class="selector-class">.req</span> -out client<span class="selector-class">.crt</span></span><br><span class="line"></span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=BeiJing/L=BeiJing/O=MyCompany Corp./CN=www<span class="selector-class">.mycompany</span>.com/emailAddress=admin@mycompany<span class="selector-class">.com</span></span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> root<span class="selector-class">.key</span>: ← 输入上面创建的密码</span><br></pre></td></tr></table></figure>

<p>10.将客户端证书文件client.crt和客户端证书密钥文件client.key合并成客户端证书安装包client.pfx</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">openssl pkcs12 -export -<span class="keyword">in</span> <span class="keyword">client</span>.crt -inkey <span class="keyword">client</span>.key -out <span class="keyword">client</span>.pfx</span><br></pre></td></tr></table></figure>

<p>输出内容为:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">$ openssl pkcs12 -<span class="builtin-name">export</span> -in client.crt -inkey client.key -out client.pfx</span><br><span class="line"></span><br><span class="line">Enter pass phrase <span class="keyword">for</span> client.key: ← 输入上面创建的密码</span><br><span class="line">Enter <span class="builtin-name">Export</span> Password: ← 输入一个新的密码,用作客户端证书的保护密码,在客户端安装证书时需要输入此密码</span><br><span class="line">Verifying – Enter <span class="builtin-name">Export</span> Password: ← 确认密码</span><br></pre></td></tr></table></figure>

<p>11.保存生成的文件备用,其中server.crt和server.key是配置单向SSL时需要使用的证书文件,client.crt是配置双向SSL时需要使用的证书文件,client.pfx是配置双向SSL时需要客户端安装的证书文件.</p>
]]></content>
  </entry>
  <entry>
    <title>ssh 连接的时候 Host key verification failed.</title>
    <url>/2018/09/18/1362/</url>
    <content><![CDATA[<p>SSH连接的时候:</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">Host <span class="built_in">key</span> verification failed.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ssh <span class="number">192.168</span><span class="number">.1</span><span class="number">.90</span></span><br><span class="line"></span><br><span class="line"><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@</span></span><br><span class="line"><span class="comment">@</span>    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     <span class="comment">@</span></span><br><span class="line"><span class="comment">@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span></span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right <span class="built_in">now</span> (man-in-the-middle attack)!</span><br><span class="line">It is also possible that the RSA host <span class="built_in">key</span> has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the RSA key sent by the remote host is</span><br><span class="line">05:25:84:ea:dd:92:8d:80:ce:ad:5b:79:58:fe:c9:42.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key in /root/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending key in /root/.ssh/known_hosts:10</span><br><span class="line">RSA host key <span class="keyword">for</span> 192.168.1.90 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">vi ~<span class="regexp">/.ssh/</span>known_hosts</span><br></pre></td></tr></table></figure>

<p>进入此目录,删除192.168.1.90的相关rsa的信息即可.</p>
<p>或者删除这个文件:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">cd ~<span class="regexp">/.ssh/</span></span><br><span class="line">rm known_hosts</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ssh的安全配置</title>
    <url>/2013/11/01/1363/</url>
    <content><![CDATA[<p>首先修改配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>a 修改SSH端口</p>
<p>找到#Port 22一段,这里是标识默认使用22端口,修改为如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Port</span> <span class="number">22</span></span><br><span class="line"><span class="attribute">Port</span> <span class="number">50000</span></span><br></pre></td></tr></table></figure>

<p>然后保存退出,重启sshd.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/sshd restart</span><br></pre></td></tr></table></figure>

<p>这样SSH端口将同时工作与22和50000上.<br>现在编辑防火墙配置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>启用50000端口,重启防火墙:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>现在请使用ssh工具连接50000端口,来测试是否成功.<br>如果连接成功了,则再次编辑sshd_config的设置,将里边的Port22删除,即可.</p>
<p>b 只使用SSH v2</p>
<p>将#Protocol 2,1改为 Protocol 2.</p>
<p>c 限制用户的SSH访问</p>
<p>假设我们只要root,vivek和jerry用户能通过SSH使用系统,向sshd_config配置文件中添加:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AllowUsers root vivek jerry</span></span><br></pre></td></tr></table></figure>

<p>d 配置空闲超时退出时间间隔</p>
<p>用户可以通过ssh登录到服务器,你可以设置一个空闲超时时间间隔避免出现孤儿ssh会话,打开sshd_config配置文件,确保有如下的配置项:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ClientAliveInterval</span> <span class="number">300</span></span><br><span class="line"><span class="attribute">ClientAliveCountMax</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>上面的例子设置的空闲超时时间间隔是300秒,即5分钟,过了这个时间后,空闲用户将被自动踢出出去(可以理解为退出登录/注销).</p>
<p>e 禁用.rhosts文件</p>
<p>不要读取用户的 <code>~/.rhosts</code>和 <code>~/.shosts</code>文件,使用下面的设置更新sshd_config配置文件:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">IgnoreRhosts</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>SSH可以模拟过时的rsh命令的行为,rsh被公认为是不安全的远程访问协议,因此必须得禁用掉.</p>
]]></content>
  </entry>
  <entry>
    <title>Starting httpd httpd Could not reliably determine the server&#39;s fully qualified domain name, using 127.0.0.1 for ServerName</title>
    <url>/2013/06/23/1365/</url>
    <content><![CDATA[<p>centos架设邮件服务器完成,重启httpd出现如上错误,原因是域名没有解析到服务器上来,比如我配置的时候用的是shuxun.wang 所以我们要把mail.shuxun.wang A记录解析到服务器的IP就好了.</p>
]]></content>
  </entry>
  <entry>
    <title>SSH Secure Shell Client中文乱码的解决办法</title>
    <url>/2016/06/18/1361/</url>
    <content><![CDATA[<p>说这是SSH Secure Shell Client多年未解决的短板,要求客户端和服务器端都要’UTF-8’编码,恩恩,这下我终于知道Windows中文版的编码居然是非UTF-8了.<br>意思是我不换操作系统,就无法使用这个东东了?<br>于是乎,解决办法貌似只有两个.<br>1,换系统.<br>2,使用Putty:<a href="http://filezilla-project.org/download.php?type=client">http://filezilla-project.org/download.php?type=client</a><br>当然,如果需要SFTP,可以使用filezilla,包含了一个小巧的服务器端和FTP功能.<br>就是安装起来麻烦点…<br>后来找到根本的解决办法,只知方法,不知原因.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/i18n</span><br></pre></td></tr></table></figure>

<p>将内容改为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">LANG</span>=<span class="string">&quot;zh_CN.GB18030&quot;</span></span><br><span class="line"><span class="attr">LANGUAGE</span>=<span class="string">&quot;zh_CN.GB18030:zh_CN.GB2312:zh_CN&quot;</span></span><br><span class="line"><span class="attr">SUPPORTED</span>=<span class="string">&quot;zh_CN.GB18030:zh_CN:zh:en_US.UTF-8:en_US:en&quot;</span></span><br><span class="line"><span class="attr">SYSFONT</span>=<span class="string">&quot;lat0-sun16&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样中文在SSH,telnet终端就可以正常显示了.</p>
]]></content>
  </entry>
  <entry>
    <title>svn操作</title>
    <url>/2016/06/05/1367/</url>
    <content><![CDATA[<p>1、将文件checkout到本地目录</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">svn checkout <span class="built_in">path</span> # <span class="built_in">path</span>是服务器上的目录</span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">svn checkout svn:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.1</span><span class="regexp">/pro/</span>domain</span><br></pre></td></tr></table></figure>

<p>简写:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn co</span></span><br></pre></td></tr></table></figure>

<p>2、往版本库中添加新的文件</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">svn <span class="built_in">add</span> <span class="built_in">file</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">add</span> test.php <span class="meta"># 添加test.php</span></span><br><span class="line">svn <span class="keyword">add</span> *.php <span class="meta"># 添加当前目录下所有的php文件</span></span><br></pre></td></tr></table></figure>

<p>3、将改动的文件提交到版本库</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span> commit -m <span class="string">&quot;LogMessage&quot;</span> [-N] [--<span class="literal">no</span>-unlock] PATH <span class="comment"># 如果选择了保持锁,就使用--no-unlock开关</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">svn commit -m <span class="string">&quot;add test file for my test&quot;</span> <span class="keyword">test</span>.php</span><br></pre></td></tr></table></figure>

<p>简写:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn ci</span></span><br></pre></td></tr></table></figure>

<p>4、加锁/解锁</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">lock</span> -m &quot;LockMessage&quot; [<span class="comment">--force] PATH</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">lock</span> -m &quot;lock test file&quot; test.php</span><br><span class="line">svn unlock <span class="type">PATH</span></span><br></pre></td></tr></table></figure>

<p>5、更新到某个版本</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">update</span> -r m <span class="keyword">path</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">update</span> # 如果后面没有目录,默认将当前目录以及子目录下的所有文件都更新到最新版本.</span><br><span class="line">svn <span class="keyword">update</span> -r 200 <span class="keyword">test</span>.php # 将版本库中的文件<span class="keyword">test</span>.php还原到版本200</span><br><span class="line">svn <span class="keyword">update</span> <span class="keyword">test</span>.php # 更新,于版本库同步.如果在提交的时候提示过期的话,是因为冲突,需要先<span class="keyword">update</span>,修改文件,然后清除svn resolved,最后再提交commit</span><br></pre></td></tr></table></figure>

<p>简写:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn up</span></span><br></pre></td></tr></table></figure>

<p>6、查看文件或者目录状态</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">svn <span class="built_in">status</span> <span class="built_in">path</span> # 目录下的文件和子目录的状态,正常状态不显示</span><br><span class="line"></span><br><span class="line">[?:不在svn的控制中;M:内容被修改;C:发生冲突;A:预定加入到版本库;K:被锁定]</span><br><span class="line"></span><br><span class="line">svn <span class="built_in">status</span> -v <span class="built_in">path</span> # 显示文件和子目录状态</span><br><span class="line"></span><br><span class="line">第一列保持相同,第二列显示工作版本号,第三和第四列显示最后一次修改的版本号和修改人.</span><br><span class="line">注:svn <span class="built_in">status</span>、svn diff和 svn revert这三条命令在没有网络的情况下也可以执行的,原因是svn在本地的.svn中保留了本地版本的原始拷贝.</span><br></pre></td></tr></table></figure>

<p>简写:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">st</span></span><br></pre></td></tr></table></figure>

<p>7、删除文件</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">delete</span> <span class="keyword">path</span> -m <span class="string">&quot;delete test fle&quot;</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">delete</span> svn:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.1</span><span class="regexp">/pro/</span>domain/test.php -m <span class="string">&quot;delete test file&quot;</span></span><br></pre></td></tr></table></figure>

<p>或者直接svn delete test.php 然后再svn ci -m ‘delete test file’,推荐使用这种.</p>
<p>简写:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">svn (<span class="built_in">del</span>, <span class="built_in">remove</span>, rm)</span><br></pre></td></tr></table></figure>

<p>8、查看日志</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">svn <span class="built_in">log</span> <span class="built_in">path</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">svn <span class="built_in">log</span> test.php <span class="meta"># 显示这个文件的所有修改记录,及其版本号的变化</span></span><br></pre></td></tr></table></figure>

<p>9、查看文件详细信息</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span> <span class="literal">info</span> path</span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span> <span class="literal">info</span> test.php</span><br></pre></td></tr></table></figure>

<p>10、比较差异</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">diff </span>path <span class="comment"># 将修改的文件与基础版本比较</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">diff </span>test.php</span><br><span class="line">svn <span class="keyword">diff </span>-r m:n path <span class="comment"># 对版本m和版本n比较差异</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span> diff -r <span class="number">200</span>:<span class="number">201</span> test.php</span><br></pre></td></tr></table></figure>

<p>简写:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn di</span></span><br></pre></td></tr></table></figure>

<p>11、将两个版本之间的差异合并到当前文件</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">merge</span> -r m:n <span class="keyword">path</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span> merge -r <span class="number">200</span>:<span class="number">205</span> test.php # 将版本<span class="number">200</span>与<span class="number">205</span>之间的差异合并到当前文件,但是一般都会产生冲突,需要处理一下</span><br></pre></td></tr></table></figure>

<p>12、SVN 帮助</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">help</span></span><br><span class="line">svn <span class="keyword">help</span> <span class="keyword">ci</span></span><br></pre></td></tr></table></figure>

<p>以上是常用命令,下面写几个不经常用的.</p>
<p>13、版本库下的文件和目录列表</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">svn list <span class="built_in">path</span> # 显示<span class="built_in">path</span>目录下的所有属于版本库的文件和目录</span><br><span class="line"></span><br><span class="line">简写: </span><br><span class="line"></span><br><span class="line">svn ls</span><br></pre></td></tr></table></figure>

<p>14、创建纳入版本控制下的新目录</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">svn mkdir: 创建纳入版本控制下的新目录.</span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="built_in">mkdir</span> <span class="built_in">PATH</span>...</span><br><span class="line"><span class="number">2</span>.<span class="built_in">mkdir</span> URL...</span><br></pre></td></tr></table></figure>

<p>创建版本控制的目录.</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>.每一个以工作副本 PATH 指定的目录,都会创建在本地端,并且加入新增调度,以待下一次的提交.</span><br><span class="line"><span class="number">2</span>.每个以URL指定的目录,都会透过立即提交于仓库中创建,在这两个情况下,所有的中间目录都必须事先存在.</span><br></pre></td></tr></table></figure>

<p>15、恢复本地修改</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">svn <span class="built_in">revert</span>: # 恢复原始未改变的工作副本文件 (恢复大部份的本地修改).<span class="built_in">revert</span>:</span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">revert</span></span> PATH...</span><br></pre></td></tr></table></figure>

<p>注意: 本子命令不会存取网络,并且会解除冲突的状况.但是它不会恢复被删除的目录.</p>
<p>16、代码库URL变更</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">svn <span class="keyword">switch</span> (sw): 更新工作副本至不同的<span class="built_in">URL</span>.</span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">switch</span> <span class="built_in">URL</span> [PATH]</span><br><span class="line"><span class="number">2.</span><span class="keyword">switch</span> <span class="comment">--relocate FROM TO [PATH...]</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>更新你的工作副本,映射到一个新的<span class="built_in">URL</span>,其行为跟<span class="string">&quot;svn update&quot;</span>很像,也会将服务器上文件与本地文件合并.这是将工作副本对应到同一仓库中某个分支或者标记的方法.</span><br><span class="line"><span class="number">2.</span>改写工作副本的<span class="built_in">URL</span>元数据,以反映单纯的<span class="built_in">URL</span>上的改变.当仓库的根<span class="built_in">URL</span>变动(比如方案名或是主机名称变动),但是工作副本仍旧对映到同一仓库的同一目录时使用这个命令更新工作副本与仓库的对应关系.</span><br></pre></td></tr></table></figure>

<p>17、解决冲突</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">svn resolved: <span class="meta"># 移除工作副本的目录或文件的<span class="string">&quot;冲突&quot;</span>状态.</span></span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">resolved</span></span> PATH...</span><br></pre></td></tr></table></figure>

<p>注意: 本子命令不会依语法来解决冲突或是移除冲突标记;它只是移除冲突的相关文件,然后让 PATH 可以再次提交.</p>
<p>18、输出指定文件或URL的内容.</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>svn cat 目标[@版本]...</span><br><span class="line"><span class="number">2.</span>svn cat -r <span class="symbol">PREV</span> filename &gt; filename</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>如果指定了版本,将从指定的版本开始查找.</span><br><span class="line"><span class="number">2.</span><span class="symbol">PREV</span> 是上一版本,也可以写具体版本号,这样输出结果是可以提交的.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>svnserve.conf12 Option expected的问题解决方法</title>
    <url>/2012/09/10/1366/</url>
    <content><![CDATA[<p>经常有新手配置基于svnserve的subversion服务器后,<br>在客户端访问subversion版本库时出现这个错误:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svnserve</span>.conf:<span class="number">12</span>: Option expected</span><br></pre></td></tr></table></figure>

<p>为什么会出现这个错误呢,就是因为subversion读取配置文件svnserve.conf时,无法识别有前置空格的配置文件,如:</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">### This file controls the configuration <span class="keyword">of</span> the svnserve daemon, <span class="keyword">if</span> you</span><br><span class="line">### use it to allow access to this repository.?(If you only allow</span><br><span class="line">### access through http: and/or file: URLs, then this file is</span><br><span class="line">### irrelevant.)</span><br><span class="line"></span><br><span class="line">### Visit http:<span class="comment">//subversion.tigris.org/ for more information.</span></span><br><span class="line"></span><br><span class="line">[general]</span><br><span class="line">### These options control access to the repository for unauthenticated</span><br><span class="line">### and authenticated users.??Valid values are <span class="string">&quot;write&quot;</span>, <span class="string">&quot;read&quot;</span>,</span><br><span class="line">### and <span class="string">&quot;none&quot;</span>.??The sample settings below are the defaults.</span><br><span class="line">[这里多了空格]anon-access = read</span><br><span class="line">auth-access = write</span><br></pre></td></tr></table></figure>

<p>像上面的配置文件中,anon-access是顶行的,没问题,而auth-access就存在前置空格,会导致这个错误.<br>要避免出现这个错误,应该在去掉这些行前的#时,也要顺手去掉前面的空格.</p>
]]></content>
  </entry>
  <entry>
    <title>The file is absent or does not have execute permission This file is needed to run this program.</title>
    <url>/2014/03/10/1369/</url>
    <content><![CDATA[<p>运行:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>./startup.sh</span><br></pre></td></tr></table></figure>

<p>提示:</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">Cannot find ./catalina.sh</span><br><span class="line">The file is absent<span class="built_in"> or </span>does<span class="built_in"> not </span>have<span class="built_in"> execute </span>permission</span><br><span class="line">This file is needed to run this program.</span><br></pre></td></tr></table></figure>

<p>说明catalina.sh没有执行权限.把 <code>~/apache-tomcat-6.0.33/bin/</code>目录下的所有sh文件的权限都设为755(当然<br>也包括catalina.sh)即可:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>chmod <span class="number">755</span> *.sh</span><br></pre></td></tr></table></figure>

<p>再次运行startup.sh,显示的结果正常:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ ./startup.sh</span><br><span class="line"></span><br><span class="line">Using CATALINA_BASE: <span class="regexp">/root/</span>apache-tomcat-<span class="number">6.0</span>.<span class="number">33</span></span><br><span class="line">Using CATALINA_HOME: <span class="regexp">/root/</span>apache-tomcat-<span class="number">6.0</span>.<span class="number">33</span></span><br><span class="line">Using CATALINA_TMPDIR: <span class="regexp">/root/</span>apache-tomcat-<span class="number">6.0</span>.<span class="number">33</span>/temp</span><br><span class="line">Using JRE_HOME: /usr</span><br><span class="line">Using <span class="keyword">CLASSPATH</span>: <span class="regexp">/root/</span>apache-tomcat-<span class="number">6.0</span>.<span class="number">33</span><span class="regexp">/bin/</span>bootstrap.jar</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>ubuntu下看迅雷看看</title>
    <url>/2014/08/24/1373/</url>
    <content><![CDATA[<p>其实是可以在线看迅雷看看的,安装火狐插件User Agent Switcher 选择iphone 或者设置ipad都行.<br>直接在线就能看的.</p>
]]></content>
  </entry>
  <entry>
    <title>Tcpdump 的用法</title>
    <url>/2014/04/12/1368/</url>
    <content><![CDATA[<p>yum安装:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> tcpdump</span><br></pre></td></tr></table></figure>

<p>源码安装:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flex</span></span><br><span class="line">yum -y install flex</span><br><span class="line"></span><br><span class="line"><span class="comment"># bison</span></span><br><span class="line">yum -y install bison</span><br><span class="line"></span><br><span class="line">wget http:<span class="regexp">//</span>www.tcpdump.org<span class="regexp">/release/</span>libpcap-<span class="number">1.5</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">wget http:<span class="regexp">//</span>www.tcpdump.org<span class="regexp">/release/</span>tcpdump-<span class="number">4.5</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar -zxvf libpcap-<span class="number">1.5</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">cd libpcap-<span class="number">1.5</span>.<span class="number">3</span></span><br><span class="line">./configure</span><br><span class="line">sudo make install</span><br><span class="line">cd ..</span><br><span class="line">tar -zxvf tcpdump-<span class="number">4.5</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">cd tcpdump-<span class="number">4.5</span>.<span class="number">1</span></span><br><span class="line">./configure</span><br><span class="line">sudo make install</span><br><span class="line">yum -y install bison</span><br></pre></td></tr></table></figure>

<p>抓http包:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tcpdump</span> -XvvennSs <span class="number">0</span> -i eth<span class="number">0</span> tcp[<span class="number">20</span>:<span class="number">2</span>]=<span class="number">0</span>x<span class="number">4745</span> or tcp[<span class="number">20</span>:<span class="number">2</span>]=<span class="number">0</span>x<span class="number">4854</span> -w /tmp/capture.pcap</span><br></pre></td></tr></table></figure>

<p>通过网卡eth1来监听端口80发出去的host包到192.168.109.8的报文:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tcpdump</span> -i eth<span class="number">1</span> port <span class="number">80</span> and dst host <span class="string">&quot;192.168.109.8&quot;</span></span><br></pre></td></tr></table></figure>

<p>任意网卡目标是192.168.109.*的 80端口数据:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/sbin/</span>tcpdump -i <span class="keyword">any</span>  port <span class="number">80</span> and dst host <span class="string">&quot;192.168.109.*&quot;</span> -w <span class="regexp">/tmp/</span>capture.pcap</span><br></pre></td></tr></table></figure>

<p>加上源地址IP:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">tcpdump -i <span class="keyword">any</span> -p -s <span class="number">0</span> port <span class="number">80</span> and dst host <span class="string">&quot;192.168.109.*&quot;</span> and src host <span class="string">&quot;10.70.32.**&quot;</span> -w <span class="regexp">/tmp/</span>capture.pcap</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>The selected operation can only be executed on a disk with no snapshots.</title>
    <url>/2018/04/09/1370/</url>
    <content><![CDATA[<p>不能对包含有snapshot快照的硬盘扩容,所以,只好去打开虚拟机-&gt;虚拟机快照-&gt;快照管理器,然后删除了对应的快照,然后再继续下面操作.</p>
]]></content>
  </entry>
  <entry>
    <title>tomcat修改网站目录</title>
    <url>/2013/02/16/1371/</url>
    <content><![CDATA[<p>找到tomcat的server.xml(在conf目录下),找到:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Host <span class="attribute">name</span>=<span class="string">&quot;localhost&quot;</span> <span class="attribute">appBase</span>=<span class="string">&quot;webapps&quot;</span></span><br><span class="line"><span class="attribute">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">autoDeploy</span>=<span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attribute">xmlValidation</span>=<span class="string">&quot;false&quot;</span> <span class="attribute">xmlNamespaceAware</span>=<span class="string">&quot;false&quot;</span>&gt;&lt;/Host&gt;;</span><br></pre></td></tr></table></figure>

<p>在<code>&lt;/Host&gt;</code>前插入:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Context <span class="attribute">path</span>=<span class="string">&quot;&quot;</span> <span class="attribute">docBase</span>=<span class="string">&quot;D:/eclipse3.3/jb51.net/tomcat/&quot;</span> <span class="attribute">debug</span>=<span class="string">&quot;0&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>其中 <code>D:/eclipse3.3/jb51.net/tomcat/</code>就是我想设置的网站根目录,然后重启tomcat.</p>
]]></content>
  </entry>
  <entry>
    <title>ubuntu httpd.conf文件空白</title>
    <url>/2011/07/02/1372/</url>
    <content><![CDATA[<p>貌似在apache2.conf里面…</p>
]]></content>
  </entry>
  <entry>
    <title>undefined local variable or method &#39;version_requirements&#39; for</title>
    <url>/2014/04/19/1374/</url>
    <content><![CDATA[<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">vi config/environment.rb</span><br></pre></td></tr></table></figure>

<p>在开头加入:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> Gem::VERSION &gt;= <span class="string">&quot;1.3.6&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Rails</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GemDependency</span></span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">requirement</span></span></span><br><span class="line">r = <span class="keyword">super</span></span><br><span class="line">(r == Gem::Requirement.default) ? <span class="literal">nil</span> : r</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>undefined method &#39;cache_template_loading=&#39; for ActionViewBaseClass</title>
    <url>/2014/07/16/1375/</url>
    <content><![CDATA[<p>Problem:<br>While developing on Rails 2.3.2 you want to deploy in dreamhost that uses 2.2.2 at the moment.</p>
<p>Solution:<br>Although we could try to freeze the specific rails version we are using, it’s probably easier as a temporary solution, until dreamhost upgrades the rails version to do the following:</p>
<ul>
<li>Make sure that we have the following line with the appropriate version of</li>
</ul>
<p>RAILS_GEM_VERSION = ‘2.2.2’ unless defined? RAILS_GEM_VERSION</p>
<p>in the <code>config/environment.rb</code> file.</p>
<ul>
<li>Rename the application_controller.rb file back to application.rb</li>
<li>Comment out the following line from<code>config/environments/production.rb</code></li>
</ul>
<p>config.action_view.cache_template_loading = true.</p>
]]></content>
  </entry>
  <entry>
    <title>vim使用大全</title>
    <url>/2015/08/01/1376/</url>
    <content><![CDATA[<p>1、vi的基本概念</p>
<p>基本上vi可以分为三种状态,分别是命令模式(command mode)、插入模式(Insert mode)和底行模式(last line mode),各模式的功能区分如下:</p>
<ol>
<li>命令行模式command mode)<br>控制屏幕光标的移动,字符、字或行的删除,移动复制某区段及进入Insert mode下,或者到 last line mode.</li>
<li>插入模式(Insert mode)<br>只有在Insert mode下,才可以做文字输入,按「ESC」键可回到命令行模式.</li>
<li>底行模式(last line mode)<br>将文件保存或退出vi,也可以设置编辑环境,如寻找字符串、列出行号……等.<br>不过一般我们在使用时把vi简化成两个模式,就是将底行模式(last line mode)也算入命令行模式command mode).</li>
</ol>
<p>2、vi的基本操作</p>
<p>a) 进入vi</p>
<p>在系统提示符号输入vi及文件名称后,就进入vi全屏幕编辑画面:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>vi myfile</span><br></pre></td></tr></table></figure>

<p>不过有一点要特别注意,就是您进入vi之后,是处于「命令行模式(command mode)」,您要切换到「插入模式(Insert mode)」才能够输入文字.初次使用vi的人都会想先用上下左右键移动光标,结果电脑一直哔哔叫,把自己气个半死,所以进入vi后,先不要乱动,转换到「插入模式(Insert mode)」再说吧!</p>
<p>b) 切换至插入模式(Insert mode)编辑文件</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><span class="line">在「命令行模式(command <span class="keyword">mode</span>)」下按一下字母「i」就可以进入「插入模式(Insert <span class="keyword">mode</span>)」,这时候你就可以开始输入文字了.</span><br></pre></td></tr></table></figure>

<p>c) Insert 的切换</p>
<figure class="highlight mercury"><table><tr><td class="code"><pre><span class="line">您目前处于「插入模式(Insert <span class="keyword">mode</span>)」,您就只能一直输入文字,如果您发现输错了字!想用光标键往回移动,将该字删除,就要先按一下「ESC」键转到「命令行模式(command <span class="keyword">mode</span>)」再删除文字.</span><br></pre></td></tr></table></figure>

<p>d) 退出vi及保存文件</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">在「命令行模式(<span class="keyword">command</span> <span class="keyword">mode</span>)」下,按一下「:」冒号键进入「Last <span class="built_in">line</span> <span class="keyword">mode</span>」,例如:</span><br><span class="line"></span><br><span class="line">: <span class="keyword">w</span> filename (输入 「<span class="keyword">w</span> filename」将文章以指定的文件名filename保存)</span><br><span class="line">: <span class="keyword">wq</span> (输入「<span class="keyword">wq</span>」,存盘并退出<span class="keyword">vi</span>)</span><br><span class="line">: q! (输入q!, 不存盘强制退出<span class="keyword">vi</span>)</span><br></pre></td></tr></table></figure>

<p>3、命令行模式(command mode)功能键</p>
<p>1). 插入模式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">按「<span class="selector-tag">i</span>」切换进入插入模式「insert mode」,按&quot;<span class="selector-tag">i</span>&quot;进入插入模式后是从光标当前位置开始输入文件;</span><br><span class="line">按「<span class="selector-tag">a</span>」进入插入模式后,是从目前光标所在位置的下一个位置开始输入文字;</span><br><span class="line">按「o」进入插入模式后,是插入新的一行,从行首开始输入文字.</span><br></pre></td></tr></table></figure>

<p>2). 从插入模式切换为命令行模式</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">按「ESC」键.</span><br></pre></td></tr></table></figure>

<p>3). 移动光标</p>
<p>vi可以直接用键盘上的光标来上下左右移动,但正规的vi是用小写英文字母「h」、「j」、「k」、「l」,分别控制光标左、下、上、右移一格.</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">按「ctrl」+「b」:屏幕往<span class="string">&quot;后&quot;</span>移动一页.</span><br><span class="line">按「ctrl」+「f」:屏幕往<span class="string">&quot;前&quot;</span>移动一页.</span><br><span class="line">按「ctrl」+「u」:屏幕往<span class="string">&quot;后&quot;</span>移动半页.</span><br><span class="line">按「ctrl」+「d」:屏幕往<span class="string">&quot;前&quot;</span>移动半页.</span><br><span class="line">按数字「<span class="number">0</span>」:移到文章的开头.</span><br><span class="line">按「G」:移动到文章的最后.</span><br><span class="line">按「$」:移动到光标所在行的<span class="string">&quot;行尾&quot;</span>.</span><br><span class="line">按「^」:移动到光标所在行的<span class="string">&quot;行首&quot;</span></span><br><span class="line">按「w」:光标跳到下个字的开头</span><br><span class="line">按「e」:光标跳到下个字的字尾</span><br><span class="line">按「b」:光标回到上个字的开头</span><br><span class="line">按「#l」:光标移到该行的第#个位置,如:<span class="number">5</span>l,<span class="number">56</span>l.</span><br></pre></td></tr></table></figure>

<p>4). 删除文字</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「x」:每按一次,删除光标所在位置的<span class="string">&quot;后面&quot;</span>一个字符.</span><br><span class="line">「#x」:例如,「<span class="number">6</span>x」表示删除光标所在位置的<span class="string">&quot;后面&quot;</span><span class="number">6</span>个字符.</span><br><span class="line">「X」:大写的X,每按一次,删除光标所在位置的<span class="string">&quot;前面&quot;</span>一个字符.</span><br><span class="line">「#X」:例如,「<span class="number">20</span>X」表示删除光标所在位置的<span class="string">&quot;前面&quot;</span><span class="number">20</span>个字符.</span><br><span class="line">「dd」:删除光标所在行.</span><br><span class="line">「#dd」:从光标所在行开始删除#行</span><br></pre></td></tr></table></figure>

<p>5). 复制</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「yw」:将光标所在之处到字尾的字符复制到缓冲区中.</span><br><span class="line">「#yw」:复制#个字到缓冲区</span><br><span class="line">「yy」:复制光标所在行到缓冲区.</span><br><span class="line">「#yy」:例如,「<span class="number">6</span>yy」表示拷贝从光标所在的该行<span class="string">&quot;往下数&quot;</span><span class="number">6</span>行文字.</span><br><span class="line">「p」:将缓冲区内的字符贴到光标所在位置.注意:所有与<span class="string">&quot;y&quot;</span>有关的复制命令都必须与<span class="string">&quot;p&quot;</span>配合才能完成复制与粘贴功能.</span><br></pre></td></tr></table></figure>

<p>6). 替换</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「r」:替换光标所在处的字符.</span><br><span class="line">「R」:替换光标所到之处的字符,直到按下「ESC」键为止.</span><br></pre></td></tr></table></figure>

<p>7). 回复上一次操作</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「u」:如果您误执行一个命令,可以马上按下「u」,回到上一个操作.按多次<span class="string">&quot;u&quot;</span>可以执行多次回复.</span><br></pre></td></tr></table></figure>

<p>8). 更改</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line">「<span class="keyword">cw</span>」:更改光标所在处的字到字尾处</span><br><span class="line">「c<span class="meta">#w」:例如,「c3w」表示更改3个字</span></span><br></pre></td></tr></table></figure>

<p>9). 跳至指定的行</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「ctrl」+「g」列出光标所在行的行号.</span><br><span class="line">「#G」:例如,「<span class="number">15</span>G」,表示移动光标至文章的第<span class="number">15</span>行行首.</span><br></pre></td></tr></table></figure>

<p>4、Last line mode下命令简介<br>在使用「last line mode」之前,请记住先按「ESC」键确定您已经处于「command mode」下后,再按「:」冒号即可进入「last line mode」.</p>
<p>A) 列出行号</p>
<p><code>「set nu」:输入「set nu」后,会在文件中的每一行前面列出行号</code>.</p>
<p>B) 跳到文件中的某一行</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">「#」:「#」号表示一个数字,在冒号后输入一个数字,再按回车键就会跳到该行了,如输入数字<span class="number">15</span>,再回车,就会跳到文章的第<span class="number">15</span>行.</span><br></pre></td></tr></table></figure>

<p>C) 查找字符</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">「<span class="regexp">/关键字」:先按「/</span>」键,再输入您想寻找的字符,如果第一次找的关键字不是您想要的,可以一直按「n」会往后寻找到您要的关键字为止.</span><br><span class="line">「?关键字」:先按「?」键,再输入您想寻找的字符,如果第一次找的关键字不是您想要的,可以一直按「n」会往前寻找到您要的关键字为止.</span><br></pre></td></tr></table></figure>

<p>D) 保存文件</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">「w」:在冒号输入字母「w」就可以将文件保存起来.</span><br></pre></td></tr></table></figure>

<p>E) 离开vi</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line">「<span class="selector-tag">q</span>」:按「<span class="selector-tag">q</span>」就是退出,如果无法离开<span class="selector-tag">vi</span>,可以在「<span class="selector-tag">q</span>」后跟一个「!」强制离开<span class="selector-tag">vi</span>.</span><br><span class="line">「<span class="selector-tag">qw</span>」:一般建议离开时,搭配「<span class="selector-tag">w</span>」一起使用,这样在退出的时候还可以保存文件.</span><br></pre></td></tr></table></figure>

<p>5、vi命令列表<br>1、下表列出命令模式下的一些键的功能:</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">h</span><br><span class="line">左移光标一个字符</span><br><span class="line">l</span><br><span class="line">右移光标一个字符</span><br><span class="line">k</span><br><span class="line">光标上移一行</span><br><span class="line"><span class="keyword">j</span></span><br><span class="line"><span class="keyword"></span>光标下移一行</span><br><span class="line">^</span><br><span class="line">光标移动至行首</span><br><span class="line"><span class="number">0</span></span><br><span class="line">数字<span class="string">&quot;0&quot;</span>,光标移至文章的开头</span><br><span class="line">G</span><br><span class="line">光标移至文章的最后</span><br><span class="line">$</span><br><span class="line">光标移动至行尾</span><br><span class="line">Ctrl+f</span><br><span class="line">向前翻屏</span><br><span class="line">Ctrl+<span class="keyword">b</span></span><br><span class="line"><span class="keyword"></span>向后翻屏</span><br><span class="line">Ctrl+d</span><br><span class="line">向前翻半屏</span><br><span class="line">Ctrl+u</span><br><span class="line">向后翻半屏</span><br><span class="line">i</span><br><span class="line">在光标位置前插入字符</span><br><span class="line">a</span><br><span class="line">在光标所在位置的后一个字符开始增加</span><br><span class="line">o</span><br><span class="line">插入新的一行,从行首开始输入</span><br><span class="line">ESC</span><br><span class="line">从输入状态退至命令状态</span><br><span class="line">x</span><br><span class="line">删除光标后面的字符</span><br><span class="line"><span class="comment">#x</span></span><br><span class="line">删除光标后的＃个字符</span><br><span class="line">X</span><br><span class="line">(大写X),删除光标前面的字符</span><br><span class="line"><span class="comment">#X</span></span><br><span class="line">删除光标前面的<span class="comment">#个字符</span></span><br><span class="line">dd</span><br><span class="line">删除光标所在的行</span><br><span class="line"><span class="comment">#dd</span></span><br><span class="line">删除从光标所在行数的<span class="comment">#行</span></span><br><span class="line">yw</span><br><span class="line">复制光标所在位置的一个字</span><br><span class="line"><span class="comment">#yw</span></span><br><span class="line">复制光标所在位置的<span class="comment">#个字</span></span><br><span class="line">yy</span><br><span class="line">复制光标所在位置的一行</span><br><span class="line"><span class="comment">#yy</span></span><br><span class="line">复制从光标所在行数的<span class="comment">#行</span></span><br><span class="line">p</span><br><span class="line">粘贴</span><br><span class="line">u</span><br><span class="line">取消操作</span><br><span class="line">cw</span><br><span class="line">更改光标所在位置的一个字</span><br><span class="line"><span class="comment">#cw</span></span><br><span class="line">更改光标所在位置的<span class="comment">#个字</span></span><br></pre></td></tr></table></figure>

<p>2、下表列出行命令模式下的一些指令<br>w filename<br>储存正在编辑的文件为filename<br>wq filename<br>储存正在编辑的文件为filename,并退出vi<br>q!<br>放弃所有修改,退出vi<br>set nu<br>显示行号<br>/或?<br>查找,在/后输入要查找的内容<br>n<br>与/或?一起使用,如果查找的内容不是想要找的关键字,按n或向后(与/联用)或向前(与?联用)继续查找,直到找到为止.</p>
]]></content>
  </entry>
  <entry>
    <title>vim显示彩色字符的方法</title>
    <url>/2017/06/23/1377/</url>
    <content><![CDATA[<p>vim 如何显示彩色字符:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo cp <span class="regexp">/usr/</span>share<span class="regexp">/vim/</span>vimcurrent<span class="regexp">/vimrc_example.vim /u</span>sr<span class="regexp">/share/</span>vim/vimrc</span><br></pre></td></tr></table></figure>
<p>这样vim显示的就更清晰了.</p>
]]></content>
  </entry>
  <entry>
    <title>WAMP + Zend Framework + Zend Studio For Eclipse 开发环境搭建</title>
    <url>/2015/05/28/1378/</url>
    <content><![CDATA[<p>1.需要的软件和下载地址:</p>
<p>WAMP Server (Windows + Apache + MySql + PHP)</p>
<p>版本: WampServer 2.0e<br>网站: <a href="http://www.wampserver.com/en/">http://www.wampserver.com/en/</a><br>下载地址: <a href="http://www.wampserver.com/en/download.php">http://www.wampserver.com/en/download.php</a></p>
<p>Zend Framework</p>
<p>版本: Zend Framework 1.7.1<br>网站: <a href="http://framework.zend.com/">http://framework.zend.com/</a><br>下载地址: <a href="http://framework.zend.com/download/latest">http://framework.zend.com/download/latest</a></p>
<p>Zend Studio For Eclipse</p>
<p>版本: Zend Studio For Eclipse 6.1<br>网站: <a href="http://www.zend.com/en/products/studio/">http://www.zend.com/en/products/studio/</a><br>下载地址: <a href="http://www.zend.com/en/downloads/">http://www.zend.com/en/downloads/</a></p>
<p>2.服务器环境搭建</p>
<p>安装WampServer,下载地址:<br><a href="http://www.crsky.com/soft/10723.html">http://www.crsky.com/soft/10723.html</a><br>安装 WampServer 至:D:/Program Files/wamp<br>安装Zend Framework,解压缩 Zend Framework 压缩包中 library 至 D:/Program Files/wamp/library<br>开启支持rewrite module<br>编辑 <code>D:/Program Files/wamp/bin/apacheApache2.2.10/conf/httpd.conf</code> 文件.<br>或右击托盘里WampServer小图标 –&gt; Apache –&gt; httpd.conf</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># LoadModule rewrite_module modules/mod_rewrite.so</span></span><br></pre></td></tr></table></figure>

<p>去掉 ‘#’,改为:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure>

<p>自动启动服务</p>
<p>我的电脑(右键)–&gt;管理–&gt;服务和应用程序–&gt;服务:<br>wampapache:设置为自动启动<br>wampmysqld:设置为自动启动</p>
<p>MySql搭建</p>
<p>创建 root 帐号密码<br>在浏览器里输入<a href="http://localhost/%E6%88%96">http://localhost/或</a> 127.0.0.1就可以访问了,自带了一个index.php页面,在tools里包含了 phpinfo(),phpmyadmin和sqlitemanager三个工具.打开phpmyadmin会在下方看到提示,root用户没有设置密码,需要先为root帐户设置密码.</p>
<p>点击phpmyadmin页面中部的”权限”,可以看到”用户一览”,即root localhost这一行,点击编辑权限图标(1个小人拿个笔的那个),在打开的页面找到”更改密码”,为root用户设置密码,并点击”执行”.</p>
<p>然后刷新页面,会看到错误提示,这是因为帐户已经设置密码.<br>到WampServer程序安装目录,在apps目录找到phpmyadmin的目录,打开phpmyadmin目录里面的config.inc.php文件,找到下面这一行:</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;password&#x27;</span>]<span class="string">??</span><span class="string">??</span><span class="string">??</span> = <span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>

<p>在等号右面的单引号里面输入刚才设置的密码,重新打开phpmyadmin的页面并刷新,这时候phpmyadmin就可以正常访问了.</p>
<p>3.开发环境搭建</p>
<p>安装 Zend Studio For Eclipse<br>新建项目<br>启动 Zend Studio for Eclipse<br>File –&gt; New –&gt; Zend Framework Project<br>Project Name: test<br>Finish<br>在Apache中加入新项目</p>
<p>方法一:</p>
<p>右击托盘里WampServer小图标 –&gt; Apache –&gt; Apache目录 –&gt; 添加一个Apache<br>输入url: test<br>输入项目地址:D:/Programme/webtest</p>
<p>方法二:</p>
<p>在 D:/Program Files/wamp/alias 下添加文件:test.conf,内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Alias</span> /ro <span class="string">&quot;d:/Programme/web/Test/public&quot;</span></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;d:/Programme/web/Test/public&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks MultiViews</span><br><span class="line">    <span class="attribute">AllowOverride</span> <span class="literal">all</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>项目创建后删除文件:/test/public.htaccess (不删除貌似有冲突)<br>配置 .htaccess<br>右击托盘里WampServer小图标 –&gt; Apache –&gt; Apache目录 –&gt; <a href="http://localhost/test/">http://localhost/test/</a> –&gt; Edit .htaccess</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">RewriteEngine on</span><br><span class="line">RewriteRule !.(js|<span class="type">ico</span>|<span class="type">gif</span>|<span class="type">jpg</span>|<span class="type">png</span>|<span class="type">css</span>)$ index.php</span><br></pre></td></tr></table></figure>

<p>4.测试地址:</p>
<p><a href="http://localhost/test/">http://localhost/test/</a></p>
]]></content>
  </entry>
  <entry>
    <title>wc命令详解</title>
    <url>/2012/07/05/1379/</url>
    <content><![CDATA[<p>wc命令统计出指定文件的字节数、字数、行数,并输出结果.如果没有给出文件名或者文件名为”-“,则从标准输入读取数据.如果多个文件一起进行统计,则wc最后给出所有指定文件的总统计数.</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">一般格式:wc <span class="comment">[选项]</span> <span class="comment">[文件]</span> …</span><br></pre></td></tr></table></figure>

<p>字是由空格符隔开的字符串.wc输出列的顺序和数目不受选项顺序和数目的影响,总是按以下格式显示,并且每项只占一列:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">行数 字数 字节数 文件名</span><br></pre></td></tr></table></figure>

<p>选项:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-c 统计字节数.</span></span><br><span class="line"><span class="deletion">-l 统计行数.</span></span><br><span class="line"><span class="deletion">-w 统计字数.</span></span><br></pre></td></tr></table></figure>

<p>注意:如果命令行中没有给出文件名,则输出中不出现文件名.</p>
<p>示例:</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">$ wc -lcw <span class="built_in">f1</span> <span class="built_in">f2</span>(统计文件<span class="built_in">f1</span>和<span class="built_in">f2</span>的字节数、字数和行数)</span><br><span class="line">$ wc <span class="built_in">f1</span> <span class="built_in">f2</span>(不带选项,统计文件<span class="built_in">f1</span>和<span class="built_in">f2</span>的字节数、字数和行数)</span><br></pre></td></tr></table></figure>

<p>在上面两种情况下,命令执行的结果是一样的.</p>
]]></content>
  </entry>
  <entry>
    <title>web安装扫描软件</title>
    <url>/2018/01/08/1380/</url>
    <content><![CDATA[<p>Nikto</p>
]]></content>
  </entry>
  <entry>
    <title>win7访问共享文件,登录失败禁用当前用户 解决方法</title>
    <url>/2016/12/11/1381/</url>
    <content><![CDATA[<p>原因分析:</p>
<p>1、Win7操作系统,默认禁用了管理员和来宾账户.<br>2、无法访问共享的机器,访问共享文件时使用的是默认的管理员,没有设置密码.</p>
<p>由于win7共享服务器端的同名账户是禁用的,当客户端还用同名账户(普遍来说都是administrator账户同名)去验证的时候,服务器返回这个账户禁止,客户端就不提示用户输入用户名和密码,直接终止就了共享访问…..</p>
<p>解决办法:</p>
<p>方法1:最简单的解决方法就是——本机建立一个新账户,这样通过新账户而不是同名的admin账户去访问共享服务端就不会出现”登        录失败:禁用的当前账户”,会直接提示输入密码.</p>
<p>方法2:修改服务器端的访问模式,让everyone都能访问、客户端以guest登陆.</p>
<p>方法3:使用windows的cmd,输入net use \ip\共享文件夹 /user:用户名后回车后输入密码,注意是net use 不是net user.</p>
<p>这时候再通过\ip就能访问共享文件夹了.重启电脑以后就能再访问共享文件夹就能输入帐号密码了.</p>
]]></content>
  </entry>
  <entry>
    <title>Windows XP下Fedora 15硬盘安装(使用LiveCD)之旅</title>
    <url>/2018/09/04/1383/</url>
    <content><![CDATA[<p>之前在心爱的笔记本电脑上装了一个RedHat Linux 9.0.然而,由于RedHat Linux 9.0版本太低,许多硬件(网卡、声卡等)都识别不了,驱动程序也安装不好,导致用不了多媒体的功能也上不了网.于是便于昨晚将RedHat Linux 9.0换了,装了一个Fedora 13.过程如下:</p>
<p>(一)确保电脑可以启动grub.上网查了一下Windows XP引导grub的方法.</p>
<p>①下载必要文件</p>
<p>网上一般要求下载grub for dos,但实际上只要有grldr一个文件就可以了,可以从这里直接下载(2009年2月15日更新),解压、并把这个文件放在C盘根目录下.</p>
<p>②编辑boot.ini</p>
<p>在Windows中,”我的电脑”上点右键-&gt;属性-&gt;高级-&gt;启动和故障恢复右边的”设置”-&gt;上半部分的”编辑”出现用记事本打开的 boot.ini 文件.<br>在文件的末尾,加上一行:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">c:</span>grldr=<span class="string">&quot;GRUB&quot;</span></span><br></pre></td></tr></table></figure>

<p>保存文件,退出,重新启动. 如果不出意外的话,重启后就可以进入grub.<br>其实之后发现,因为我之前在Windows XP上安装了一个Linux RedHat 9.0,就已经可以引导进入grub了,所以此步对于我来说,是可以省的.</p>
<p>(二)从网上下载Fedora六百多MB的LiveCD的镜像文件</p>
<p>下载网址为:<a href="http://fedoraproject.org/zh_CN/get-fedora">http://fedoraproject.org/zh_CN/get-fedora</a></p>
<p>(三)从下载的iso文件件中提取相关文件</p>
<p>在Window XP上安装一个虚拟光驱(Daemon),装载下载的iso文件.然后把iso中的LiveOS目录复制到某个fat或ext分区的根目录,我复制到的是C盘根目录下.再把isolinux/vmlinuz0和isolinux/initrd0.img复制到前面得到的LiveOS中.   最后把iso文件也复制到C盘根目录下.</p>
<p>(四)进入grub进行相关操作</p>
<p>重启电脑,在启动选项中使用上下键选择进行grub.按c键进行命令行状态.输入如下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">root (hd0,<span class="number">0</span>)</span><br><span class="line">kernel <span class="regexp">/LiveOS/</span>vmlinuz0 root=live:<span class="regexp">/dev/</span>sda1 ro liveimg rhgb rootfstype=auto</span><br><span class="line">initrd <span class="regexp">/LiveOS/i</span>nitrd0.img</span><br><span class="line"></span><br><span class="line">boot</span><br></pre></td></tr></table></figure>

<p>在这一步,我费了很大的劲才成功.之前一直出现”Boot has failed,sleeping forever.”的错误,我费了两个多小时才弄明白.注意上面的第一个蓝色部分(hd0,0),表示的是Windows XP下的C盘,用于说明文件夹LiveOS和文件 <code>isolinux/vmlinuz0</code>、<code>isolinux/initrd0.img</code>的存放位置,如果是D盘,则表示为(hd0,4).第二个蓝色部分live:/dev/sda1 ,用于指明iso文件的存放位置,我的在C盘根目录下,所以表示为/dev/sda1.关于(hd0,5)及/dev/sda5的具体含义可以参考grub磁盘分区表示方法.</p>
<p>(五)之后就会提醒你进入一个在iso文件里已经安装好的Fedora 13.在这个Fedora 13里,选择桌面上的install to harddisk(安装到硬盘)的快捷方式,就可以进行Fedora 13的安装了.</p>
<p>(六)将Fedora 13安装到硬盘后,有可能出现在grub中只能引导Fedora而不能引导已经存在的Windows XP的情况,我的就是这样.可以修改Fedora中/etc/grub.conf文件,在它的末尾加入下面内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">title</span> Windows XP</span><br><span class="line">    <span class="attribute">root</span> (hd<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="attribute">chainloader</span> +<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>即可.其中的root (hd0,0)表示Windowx XP的启动文件在C盘下.</p>
]]></content>
  </entry>
  <entry>
    <title>Windows Server 2008作Web服务器优化配置</title>
    <url>/2011/07/26/1382/</url>
    <content><![CDATA[<p>列表项目</p>
<p>只安装必要的选件</p>
<p>空间面板中可选择删除Windows组件.</p>
<p>如何安装IIS?</p>
<p>计算机右键→管理→服务器管理器→角色摘要→添加角色→服务器角色→Web服务器(IIS).</p>
<p>关闭界面美化选项</p>
<p>如在Windows操作系统,系统属性里,有一个性能选项(Performance Options),一般选择性能优先,而不是显示优先.如应用系统中不做三维图形显示,可将操作系统中的显示属性/Settings/Advanced/Troubleshoot中,硬件加速(Hardware acceleration)调到None.</p>
<p>如何打开显卡的硬件加速?<br>桌面右键→个性化→显示设置→高级设置→疑难解答→更该设置→硬件加速→完全.然后运行dxdiag,打开显示选项卡,会发现DirectX功能已经全部启用了.</p>
<p>设后台服务优先</p>
<p>在”系统属性”的”性能选项”中,”高级”页面,调整Processor Scheduling为后台服务优先(Background services).</p>
<p>关闭不必要的服务和端口</p>
<p>检查您操作系统中所有的服务和端口,对于一些用不到的服务和端口,可将其停止或关闭.</p>
<p>如何打开索引功能?</p>
<p>计算机右键→管理→服务器管理器→角色摘要→添加角色→服务器角色→文件服务→角色服务→选择Windows 搜索服务.但是索引功能,会在系统空闲时运行,出现系统空闲时硬盘狂转的现象.另外可能会造成长时间的I/O操作的内容主要有:1磁盘碎片整理计划.2 Windows Defender计划.3 Windows Search 服务.4 Superfetch 服务.</p>
<p>1 Computer Browser(默认禁用)<br>有了网络和共享中心的网络发现,这个服务应该没什么用了.<br>2 Distributed Link Tracking Client<br>个人用户一般用不到,设置为手动.<br>3 Distributed Transaction Coordinator<br>个人用户一般用不到,也容易受到远程拒绝服务攻击,设置为手动.<br>4 Remote Registry<br>这个服务应该算是必停的服务之一,设置为禁用.<br>5 Secondary Logon<br>对于多用户,可以给某用户分配临时的管理员权限,一般不会用到,设置为手动.<br>6 TCP/IP NetBIOS Helper<br>如果你的网络不使用NetBIOS或是WINS,设置为手动.<br>7 Terminal Services<br>用于远程桌面控制,存在安全隐患,设置为手动.<br>8 Windows Defender<br>四大拖慢你机器的功能之一,当然前提是你不需要这个功能,设置为禁用.<br>9 Windows Error Reporting Service<br>生成错误报告,个人觉得意义不大,设置为手动.</p>
<p>[根据情况可以关闭的服务]<br>1 Netlogon(默认手动)<br>如果你不是处在域管理当中,设置为手动.<br>2 Server<br>如果你不会共享你的文件或打印机,设置为手动.<br>3 Smart Card(默认手动)<br>如果你不用U盾等智能卡,设置为禁用.<br>4 Tablet PC Input Service<br>如果你没有这样的设备,设置为手动.<br>5 Windows Update<br>如果你不用自动更新.设置为手动.</p>
<p>开始→运行→输入”msconfig”确定→<br>①启动→点击[全部禁用]→[确定]后,不要重新启动<br>②服务→勾上”隐藏所有Microsoft服务”的勾→点击[全部禁用],[应用]→再去掉”隐藏所有Microsoft服务”的勾→将”windows time, wireless zero configuration, task scheduler, Fast user switching compatibility,Netmeeting remote desktop sharing,terminal services, automatic updates, remote registry,removable storage, Indexing service, messenger, server, Computer browser,Print Spooler”服务前的勾去掉(请仔细查找,大小写忽略.电脑若在局域网内,用时将server,Computer browser手动打开,若有打印机,用时将Print Spooler手动打开)[确定]后,重新启动.</p>
<p>尽量将数据库服务器与WebGIS服务器分开</p>
<p>多数情况下,针对数据库服务器和WebGIS服务器的优化是有冲突的,而且若这两者在同一台设备上,也会产生资源争用的情形,WebGIS服务器对内存的消耗也是非常大.另外,有一点值得注意,最好不要将这两类服务器分到两个子网中,即中间最好不要有路由器.</p>
<p>关于杀毒软件</p>
<p>一些杀毒软件在运行查毒时,非常消耗资源,服务器尽量不要安装杀毒软件,在一些优化措施已实施的情况下,比如关掉不必要的服务和端口,病毒一般也不会感染服务器.在Windows Server下若要安装杀毒软件,也尽量将查毒时间放在系统闲时;而在Solaris,AIX或Linux下,最好不要安装杀毒软件.</p>
]]></content>
  </entry>
  <entry>
    <title>Windows 不能在 本地计算机 启动 SQL Server</title>
    <url>/2015/11/03/1384/</url>
    <content><![CDATA[<p>在使用SQL2005(或2008)是可能会遇到错误提示:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Windows 不能在 本地计算机 启动 SQL Server .有关更多信息,查阅系统事件日志.如果这是非 Microsoft 服务,请与服务厂商联系,并参考特定服务错误代码126&quot;</span></span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>在2005(2008)的”配置工具”中有个”SQL Server Configuration Manager”–&gt;SQLserver 2005(2008) 的网络配置,<br>在MSSOLSERVER和SQLEXPRESS中都有个VIA的属性,你那个服务无法启动就把那个VIA设置禁用.<br>然后重启一下服务,就可以了.<br>我试过了是在2008中无法启动服务,<br>查看MSSOLSERVER和SQLEXPRESS中都有个VIA的属性,将VIA设置为禁用,然后重启服务,就可以了,服务能正常启动.</p>
]]></content>
  </entry>
  <entry>
    <title>windows打开软件 任务栏图标白色解决方法</title>
    <url>/2019/06/28/1385/</url>
    <content><![CDATA[<p>解决:<br>1.”win”+”R键”弹出运行窗口,输入<code>%APPDATA%\Microsoft\Internet Explorer\Quick Launch\User Pinned\TaskBar</code>.<br>2.在弹出的TaskBar文件夹中,发现没有图标显示异常的快捷方式.将该程序的快捷方式放入到TaskBar文件夹.<br>3.重新运行该程序,若未恢复图标,在任务栏上右键点击[固定到任务栏]再取消固定,可以发现图标显示正常. </p>
]]></content>
  </entry>
  <entry>
    <title>windows服务器禁止ip</title>
    <url>/2017/01/12/1387/</url>
    <content><![CDATA[<p>使用IP策略,阻止该ip访问你的任何端口.<br>下边是方法:<br>打开:控制面版–管理工具-本地安全设置.点左边的 IP安全策略,在本地计算机.然后在右边点右键–创建IP安全策略,打开IP安全策略向导.<br>下一步,出现IP安全策略名称,随便起个就行.比如叫 阻止192.168.1.163<br>下一步,出现激活默认响应规则,不要选中,把钩去掉.<br>下一步,选中编辑属性,完成.<br>然后出现了 IP安全策略属性,点下边的添加,出现规则属性,点击添加,出现IP策略器列表.把使用添加向导去掉,点右边的添加,出现筛选器属性.<br>寻址栏 原地址选 一个特定的IP 192.168.1.163.目标IP是 我的IP地址.然后点击确定.<br>现在回到 IP 筛选器列表,点击确定,在规则属性里应该多了个列表,选中它.然后切换到筛选器操作选项卡,把使用添加向导去掉,点击添加.在出现的筛选器操作 属性里的安全措施选项卡中,选择 阻止,点击确定.在筛选器操作选项卡中会多出一个阻止的选项,选中它.<br>总之,在IP筛选器列表中你要选中你建的那个列表,筛选器操作中要选中阻止.然后点击应用以后关闭.<br>现在回到 IP安全策略 属性 这里,把你建的IP筛选器列表钩上,点击关闭.<br>这时,在你最开始打开的 本地安全设置里 会多出一个策略,就是你建立的<br>“阻止192.168.1.163”.在它身上点右键,选择指派,就OK了.</p>
]]></content>
  </entry>
  <entry>
    <title>windows端口占用查看</title>
    <url>/2011/03/18/1386/</url>
    <content><![CDATA[<p>1.查看所有的端口占用情况:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">C:\&gt;netstat -ano</span><br><span class="line">协议    本地地址              外部地址               状态            PID</span><br><span class="line">TCP    <span class="number">127.0.0.1</span>:<span class="number">1434</span>         <span class="number">0.0.0.0</span>:<span class="number">0</span>              LISTENING       <span class="number">3236</span></span><br><span class="line">TCP    <span class="number">127.0.0.1</span>:<span class="number">5679</span>         <span class="number">0.0.0.0</span>:<span class="number">0</span>              LISTENING       <span class="number">4168</span></span><br><span class="line">TCP    <span class="number">127.0.0.1</span>:<span class="number">7438</span>         <span class="number">0.0.0.0</span>:<span class="number">0</span>              LISTENING       <span class="number">4168</span></span><br><span class="line">TCP    <span class="number">127.0.0.1</span>:<span class="number">8015</span>         <span class="number">0.0.0.0</span>:<span class="number">0</span>              LISTENING       <span class="number">1456</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">139</span>      <span class="number">0.0.0.0</span>:<span class="number">0</span>              LISTENING       <span class="number">4</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">1957</span>     <span class="number">220.181.31.225</span>:<span class="number">443</span>     ESTABLISHED     <span class="number">3068</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">2020</span>     <span class="number">183.62.96.189</span>:<span class="number">1522</span>     ESTABLISHED     <span class="number">1456</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">2927</span>     <span class="number">117.79.91.18</span>:<span class="number">80</span>        ESTABLISHED     <span class="number">4732</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">2929</span>     <span class="number">117.79.91.18</span>:<span class="number">80</span>        ESTABLISHED     <span class="number">4732</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">2930</span>     <span class="number">117.79.91.18</span>:<span class="number">80</span>        ESTABLISHED     <span class="number">4732</span></span><br><span class="line">TCP    <span class="number">192.168.3.230</span>:<span class="number">2931</span>     <span class="number">117.79.91.18</span>:<span class="number">80</span>        ESTABLISHED     <span class="number">4732</span></span><br></pre></td></tr></table></figure>
<p>2.查看指定端口的占用情况:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>\&gt;netstat -aon|findstr <span class="string">&quot;9050&quot;</span></span><br><span class="line">协议    本地地址                     外部地址               状态                   PID</span><br><span class="line">TCP    <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9050</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">0</span>              LISTENING       <span class="number">2016</span></span><br><span class="line"><span class="symbol">P:</span> 看到了吗,端口被进程号为<span class="number">2016</span>的进程占用,继续执行下面命令: (也可以去任务管理器中查看pid对应的进程)</span><br></pre></td></tr></table></figure>
<p>3.查看PID对应的进程:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>\&gt;tasklist|findstr <span class="string">&quot;2016&quot;</span></span><br><span class="line">映像名称                       PID 会话名              会话<span class="meta">#       内存使用</span></span><br><span class="line">========================= ======== ================</span><br><span class="line">tor.exe                   <span class="number">2016</span>     Console              <span class="number">0</span>          <span class="number">16</span>,<span class="number">064</span> K</span><br><span class="line"><span class="symbol">P:</span>很清楚吧,tor占用了你的端口.</span><br></pre></td></tr></table></figure>
<p>4.结束该进程:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">C:\&gt;taskkill <span class="string">/f</span> <span class="string">/t</span> <span class="string">/im</span> tor.exe</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>windows释放端口占用</title>
    <url>/2016/12/05/1388/</url>
    <content><![CDATA[<p>Windows下查看进程及结束进程命令<br>1)查看占用8080端口的进程号</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">&gt;netstat –aon <span class="string">| findstr &quot;</span><span class="number">8080</span><span class="string">&quot;</span></span><br><span class="line"><span class="meta">#结果:</span></span><br><span class="line">TCP    <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span>    <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">0</span>    LISTENING    <span class="number">3500</span></span><br></pre></td></tr></table></figure>

<p>可知,进程号为3500的进程占用了8080端口<br>可以使用命令tasklist | findstr “3500”进一步查看3500进程的具体信息.</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">&gt; tasklist <span class="string">| findstr &quot;</span><span class="number">3500</span><span class="string">&quot;</span></span><br><span class="line"><span class="meta">#结果:</span></span><br><span class="line">javaw.exe    <span class="number">3500</span> Console    <span class="number">0</span>    <span class="number">28</span>,<span class="number">792</span> K</span><br></pre></td></tr></table></figure>

<p>可知3500进程为javaw.exe.<br>2)杀掉进程</p>
<figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span> <span class="javascript">tskill <span class="number">3500</span> </span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>windows无法启动windows firewall服务 错误1068 依赖服务或组无法启动</title>
    <url>/2016/08/25/1390/</url>
    <content><![CDATA[<p>Base Filtering Engine 服务是需要设置为自动的,否则会无法开启Windows自带的防火墙.</p>
]]></content>
  </entry>
  <entry>
    <title>windows下建立.htaccess</title>
    <url>/2013/11/30/1391/</url>
    <content><![CDATA[<p>新建文本文件填入规则,<br>然后选择文件然后选择另存为,<br>文件名填<code>.htaccess</code>,<br>保存类型选择所有文件,<br>最后单击保存.<br><code>.htaccess</code>文件就建立好了.</p>
]]></content>
  </entry>
  <entry>
    <title>Windows文件在linux下不能使用 每行后出现^M字样</title>
    <url>/2016/11/18/1389/</url>
    <content><![CDATA[<p>最近使用Ubuntu Linux发现,Windows 下的文本到Linux下可以正常的浏览,但是Linux下的文本到Windows下后发现凡是”回车”部分全是”黑块”,经过一段时间的查询搜索发现了原因及解决办法.<br>DOS/Windows和Linux/Unix的文件换行回车格式不同,基于 DOS/Windows 的文本文件在每一行末尾有一个 CR(回车)和 LF(换行),而 UNIX 文本只有一个换行.</p>
<p>1)、把Dos/Windows下的文件移至Linux/Unix系统</p>
<p>虽然很多程序不在乎 DOS/Windows 格式的 CR/LF 文本文件,但是有几个程序却在乎 – 最著名的是 bash,只要一遇到回车,它就会出问题.以下 sed 调用将把 DOS/Windows 格式的文本转换成可信赖的 UNIX 格式:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>sed -e <span class="string">&#x27;s/.$//&#x27;</span> mydos.txt &gt; myunix.txt</span><br></pre></td></tr></table></figure>

<p>该脚本的工作原理很简单:替代规则表达式与一行的最末字符匹配,而该字符恰好就是回车.我们用空字符替换它,从而将其从输出中彻底删除.如果使用该脚本并注意到已经删除了输出中每行的最末字符,那么,您就指定了已经是 UNIX 格式的文本文件.也就没必要那样做了!</p>
<p>2)、把Linux/UNIX 文本移至 Windows 系统,使用以下脚本执行必需的格式转换</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>sed -e <span class="string">&#x27;s/$/r/&#x27;</span> myunix.txt &gt; mydos.txt</span><br></pre></td></tr></table></figure>

<p>在该脚本中,’$’ 规则表达式将与行的末尾匹配,而 ‘r’ 告诉 sed 在其之前插入一个回车.在换行之前插入回车,立即,每一行就以 CR/LF 结束.请注意,仅当使用 GNU sed 3.02.80 或以后的版本时,才会用 CR 替换 ‘r’.</p>
<p>另外还有个方法,使用命令:</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">unix2dos <span class="meta">filename</span></span><br><span class="line">dos2unix <span class="meta">filename</span></span><br></pre></td></tr></table></figure>

<p>互相转换,具体哪个方向转不用我说了吧.</p>
]]></content>
  </entry>
  <entry>
    <title>wordpress的varnish内存级缓存方案</title>
    <url>/2012/11/14/1392/</url>
    <content><![CDATA[<p>varnish是优秀的缓存服务器,配置简单,命中率高,性能高效.下面我们以wordpress博客程序为例看看如何配置varnish.</p>
<p>1、首先安装好web环境,可以使用本站的LNMP一键安装包配置.<br>2、安装varnish.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> --nosignature -i http://repo.varnish-cache.org/redhat/varnish-<span class="number">3</span>.<span class="number">0</span>/el<span class="number">5</span>/noarch/varnish-release-<span class="number">3</span>.<span class="number">0</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line"><span class="attribute">yum</span> install varnish</span><br></pre></td></tr></table></figure>

<p>下载default.vcl文件覆盖 <code>/etc/varnish/default.vcl</code>文件.<br><a href="http://centos.googlecode.com/files/default.vcl">http://centos.googlecode.com/files/default.vcl</a></p>
<p>3、修改varnish配置文件 <code>/etc/varnish/default.vcl</code>:</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">backend <span class="meta">default</span> &#123;</span><br><span class="line"><span class="meta">    .host</span> = <span class="string">&quot;127.0.0.1&quot;</span><span class="comment">;</span></span><br><span class="line"><span class="meta">    .port</span> = <span class="string">&quot;8080&quot;</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8080端口是后缀nginx或apache的端口.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Only cache the following site</span></span><br><span class="line"><span class="attribute">if</span> (req.http.host <span class="regexp">~ &quot;(localhost)&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">set</span> req.backend = default;</span><br><span class="line">&#125; <span class="section">else</span> &#123;</span><br><span class="line">    <span class="attribute">return</span> (pass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是只允许localhost缓存,需要改成自己的wordpress域名.</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="meta">[</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="meta">]</span></span><br><span class="line">set beresp.ttl = 1h;</span><br><span class="line"><span class="meta">[</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="meta">]</span></span><br></pre></td></tr></table></figure>

<p>这个是设置缓存页面过期时间为1h,单位可以是s(秒),h(小时),d(天)等.</p>
<p>4、修改 <code>/etc/sysconfig/varnish</code>配置文件:</p>
<p>重要的有两个值:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">VARNISH_LISTEN_PORT</span>=<span class="number">80</span> 定义varnish的端口为<span class="number">80</span>.</span><br><span class="line"><span class="attribute">VARNISH_STORAGE_SIZE</span>=<span class="number">1</span>G 定义varnish最大缓存大小为<span class="number">1</span>G</span><br></pre></td></tr></table></figure>

<p>5、管理varnish的命令</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">service varnish start(restart|reload) 进程的启动,重启,配置重载.</span><br><span class="line">varnishstat 实时查看varnish缓存命中状态.</span><br><span class="line">varnishadm varnish后台管理命令.</span><br></pre></td></tr></table></figure>

<p>6、最后需要安装wordpress清除varnish缓存的插件wordpress varnish:</p>
<p>可以在后台搜索,也可以直接下载<a href="http://wordpress.org/extend/plugins/wordpress-varnish/">http://wordpress.org/extend/plugins/wordpress-varnish/</a>.<br>经过简单的六步,就完全了wordpress varnish缓存的配置.</p>
]]></content>
  </entry>
  <entry>
    <title>wordpress在nginx下只能显示一个主题的解决方法</title>
    <url>/2011/07/22/1394/</url>
    <content><![CDATA[<p>最近买了一个vps,装了lnmp一键安装包,架了一个博客站,本来用的挺爽的,某天突然想给那个博客站换一个主题,在后台只显示一个主题其他主题都不知道跑哪去了,刚开始以为是wordpress新版本的问题,不管安装什么主题都只显示一个,安装同一个提示安装的目录有存在,这可真够纳闷的,后来在wordpress论坛上找到了答案:原来是php.ini禁止了scandir函数.<br>翻看php手册,scandir() 函数是这样被定义的:”scandir() 函数返回一个数组,其中包含指定路径中的文件和目录”,wordpress可能居于这个函数去开发的,所以就只显示了一个主题.</p>
<p>由于我装的是lnmp0.9的安装包,其中禁用了部分危险函数:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">passthru, <span class="keyword">exec</span>, <span class="keyword">system</span>, <span class="keyword">chroot</span>, scandir, chgrp, <span class="keyword">chown</span>, shell_exec, proc_open, proc_get_status, ini_alter, ini_alter, ini_restore, dl, pfsockopen</span><br></pre></td></tr></table></figure>

<p>而scandir函数也在此列,所以这样问题的解决方法只能是将scandir从禁用函数剔除就可以了.<br>我们可以通过登录到winscp或是putty来修改/usr/local/php/etc下的php.ini文件,然后重启一下php进程:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/php-fpm restart</span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>wordpress更换域名后文章图片不显示问题的解决方法</title>
    <url>/2012/06/18/1393/</url>
    <content><![CDATA[<p>这几天TK域名又删除了,联系了TK方面说是博客有XX内容,没办法,只有解析成二级域名了,但是在WP更换域名后会有一个问题,原来上传的图片会无法显示,就算后台更改成了新域名也是一样,网上搜了下,大体有2种方法:</p>
<p>一,PHPMYADMIN操作批量更改数据库;</p>
<p>此方法需要仔细,因为在填写时所有的标点符号都需要在英文半角状态下输入,稍有错误就会无法执行,具体修改:<br>在 phpMyAdmin 中选择WP的数据库,然后点击 “SQL”,并在输入以下代码:</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> wp_options <span class="keyword">SET</span> option_value = <span class="built_in">replace</span>( option_value, <span class="string">&#x27;http://www.old.com&#x27;</span>, <span class="string">&#x27;http://new.org&#x27;</span>) <span class="keyword">WHERE</span> option_name = <span class="string">&#x27;home&#x27;</span> <span class="keyword">OR</span> option_name = <span class="string">&#x27;siteurl&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> wp_posts <span class="keyword">SET</span> post_content = <span class="built_in">replace</span>( post_content, <span class="string">&#x27;http://www.old.com&#x27;</span>, <span class="string">&#x27;http://new.org&#x27;</span> );</span><br><span class="line"><span class="keyword">UPDATE</span> wp_posts <span class="keyword">SET</span> guid = <span class="built_in">replace</span>( guid, <span class="string">&#x27;www.old.com&#x27;</span>, <span class="string">&#x27;http://new.org&#x27;</span> );</span><br></pre></td></tr></table></figure>

<p>操作时注意把<a href="http://www.old.com改为你的旧域名,把/">www.old.com改为你的旧域名,把</a> new.org 改为你的新域名.<br>这步完成了之后,你访问新的域名博客时,就会看到文章中原来上传的图片能正常显示了.</p>
<p>二,通过修改配置文件来让WP自动更新域名;</p>
<p>此方法安全简单,对于不会使用phpmyadmin的新手来说非常实用,</p>
<p>方法一、修改wp-config.php:</p>
<p>1、在wp-config.php中,添加以下两行内容:</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">&#x27;WP_HOME&#x27;</span>,<span class="string">&#x27;http://www.newdomain.com&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">&#x27;WP_SITEURL&#x27;</span>,<span class="string">&#x27;http://www.newdomain.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#www.newdomain.com – 代表你的新地址</span><br></pre></td></tr></table></figure>

<p>2、登录后台,在”常规 – 设置”重新配置新博客地址(HOME)和安装地址(SITEURL),成功后一定记得删除上面添加的两行内容.</p>
<p>方法二、修改functions.php:</p>
<p>(functions.php指的是位于当前博客主题目录内,可以自定义一些主题函数)</p>
<p>1、在functions.php中,添加以下两行内容:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">update<span class="constructor">_option(&#x27;<span class="params">siteurl</span>&#x27;,&#x27;<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">newdomain</span>.<span class="params">com</span>&#x27;)</span>;</span><br><span class="line">update<span class="constructor">_option(&#x27;<span class="params">home</span>&#x27;,&#x27;<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">newdomain</span>.<span class="params">com</span>&#x27;)</span>;</span><br><span class="line"></span><br><span class="line">#www.newdomain.com – 代表你的新地址</span><br></pre></td></tr></table></figure>

<p>2、登录后台,在”常规 – 设置”重新配置新博客地址(HOME)和安装地址(SITEURL),成功后一定记得删除上面添加的两行内容.</p>
<p>方法三、修改wp-config.php(自动更新地址)(推荐)</p>
<p>1、在wp-config.php中,添加下面一行内容:</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">&#x27;RELOCATE&#x27;</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>2、登录后台地址,WP将自动更新安装地址(SITEURL),手动修改博客地址(HOME)地址即可,成功后一定记得删除上面添加的一行内容.</p>
]]></content>
  </entry>
  <entry>
    <title>wrong ELF class ELFCLASS32和wrong ELF class ELFCLASS64错误</title>
    <url>/2016/07/30/1395/</url>
    <content><![CDATA[<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">wrong ELF <span class="keyword">class</span>: <span class="symbol">ELFCLASS32</span></span><br></pre></td></tr></table></figure>
<p>你是64位的系统就不要安装32位的软件.</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">wrong ELF <span class="keyword">class</span>: <span class="symbol">ELFCLASS64</span></span><br></pre></td></tr></table></figure>
<p>你是32位系统就不要安装64位的软件.</p>
]]></content>
  </entry>
  <entry>
    <title>XAMPP1.7.4远程访问</title>
    <url>/2012/12/30/1397/</url>
    <content><![CDATA[<p>在<code>/opt/lampp/lampp/</code>下面注释 denny for all.</p>
]]></content>
  </entry>
  <entry>
    <title>XAMPP 修改Mysql密码</title>
    <url>/2019/05/10/1396/</url>
    <content><![CDATA[<p>MySQL 的”root”用户默认状态是没有密码的,所以在 PHP 中您可以使用 mysql_connect(“localhost”,”root”,””) 来连接 MySQL 服务器;<br>如果您想为 MySQL 中的”root”用户设置密码,请在控制台中使用”mysqladmin”命令.例如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">linux命令:</span><br><span class="line"></span><br><span class="line">.<span class="regexp">/xampp/my</span>sql<span class="regexp">/bin/my</span>sqladmin -u root password secret</span><br><span class="line"></span><br><span class="line">windows命令:</span><br><span class="line"></span><br><span class="line">E:\xampplite\mysql\bin\mysqladmin -u root password <span class="string">&quot;test2009&quot;</span></span><br></pre></td></tr></table></figure>

<p>请注意,您更改 root 的密码之后,不要忘记更改 PHPMyAdmin 中的相关信息.在 /xampp/phpmyadmin 下搜索”config.inc.php”并编辑下面几行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;user&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>; <span class="regexp">//</span> MySQL SuperUser</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;auth_type&#x27;</span>] = <span class="string">&#x27;http&#x27;</span>; <span class="regexp">//</span> HTTP MySQL</span><br><span class="line">authentification</span><br></pre></td></tr></table></figure>

<p>从今往后,需要正确输入”root”的密码才能启动 PHPMyAdmin.</p>
]]></content>
  </entry>
  <entry>
    <title>Xampp中Apache和mysql无法启动问题解决</title>
    <url>/2012/09/01/1398/</url>
    <content><![CDATA[<p>本地安装WordPress使用xampp无法启动apache和mysql的解决方法.</p>
<p>今天开始装本地测试用的WordPress,选择xampp集成包.可是安装就出问题了.<br>apache和MySQL老安装失败,很是纠结···<br>百度Google了一晚上终于捣鼓好了.</p>
<p>下面来说说我是怎么解决的,和贴一份关于这个问题的一篇文章.<br>首先安装目录不可以用中文,开始我就是用中文,总是安装不上apache,最后使用英文字母.OK顺利通过安装Apache(但问题又来了,居然上不了网了,凭着记忆,我吧端口改了,恩,貌似我还聪明着,Apache和上网一切正常O(∩_∩)O~)</p>
<p>再说mysql的安装,开始也一直安装不上.最后使用摘录的文章里的方法,完全正常成功启动MySQL.就是:运行xamppmysql 目录下的 mysql_installservice.bat 弹出dos窗口后按任意键关闭,然后运行相同目录下的 mysql_uninstallservice.bat 即可,在XAMPP的控制版面可以成功启动 MySql.不知道为什么,难道是集成包的作者文件名起反了???</p>
<p>好了,我也该好好睡个好觉了.说这些也不知道有人知道我在说什么吗,早安.</p>
]]></content>
  </entry>
  <entry>
    <title>yum lock的解决办法</title>
    <url>/2015/12/07/1399/</url>
    <content><![CDATA[<p>错误提示:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost wangcheng]<span class="comment"># yum install yumex</span></span><br><span class="line"></span><br><span class="line">Existing lock <span class="regexp">/var/</span>run/yum.pid: another copy is running as pid <span class="number">3807</span>.</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br><span class="line">Another app is currently holding the yum lock; waiting <span class="keyword">for</span> it to <span class="keyword">exit</span>...</span><br></pre></td></tr></table></figure>

<p>可能是系统自动升级正在运行,所以yum被锁定了.<br>可以通过执行</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rm</span> -rf /<span class="keyword">var</span>/<span class="keyword">run</span>/yum.pid</span><br></pre></td></tr></table></figure>

<p>来强行解除锁定,然后你的yum就可以运行了</p>
]]></content>
  </entry>
  <entry>
    <title>yum 安装 varnish 并启动</title>
    <url>/2012/08/29/1400/</url>
    <content><![CDATA[<p>Varnish is distributed in the EPEL (Extra Packages for Enterprise Linux) package repositories. However, while EPEL allows new versions to be distributed, it does not allow for backwards-incompatible changes. Therefore, new major versions will not hit EPEL and it is therefore not necessarily up to date. If you require a newer major version than what is available in EPEL, you should use the repository provided by varnish-cache.org.<br>To use the varnish-cache.org repository, run:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> --nosignature -i http://repo.varnish-cache.org/redhat/varnish-<span class="number">3</span>.<span class="number">0</span>/el<span class="number">5</span>/noarch/varnish-release-<span class="number">3</span>.<span class="number">0</span>-<span class="number">1</span>.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>and then run:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> varnish</span><br></pre></td></tr></table></figure>

<p>The –no-signature is only needed on initial installation, since the Varnish GPG key is not yet in the yum keyring.<br>I assume varnishd is in your path. You might want to run pkill varnishd to make sure varnishd isn’t running. Become root and type:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ varnishd -f <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>varnish/<span class="keyword">default</span>.vcl -s malloc,<span class="number">1</span>G -T <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2000</span> -a <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>I added a few options, lets go through them:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">-f <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>varnish/<span class="keyword">default</span>.vcl</span><br></pre></td></tr></table></figure>

<p>The -f options specifies what configuration varnishd should use.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">-s malloc,<span class="number">1</span>G</span><br></pre></td></tr></table></figure>

<p>The -s options chooses the storage type Varnish should use for storing its content. I used the type malloc, which just uses memory for storage. There are other backends as well, described in :ref:tutorial-storage. 1G specifies how much memory should be allocated - one gigabyte.</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-T 127.0.0.1:2000</span></span><br></pre></td></tr></table></figure>

<p>Varnish has a built-in text-based administration interface. Activating the interface makes Varnish manageble without stopping it. You can specify what interface the management interface should listen to. Make sure you don’t expose the management interface to the world as you can easily gain root access to a system via the Varnish management interface. I recommend tieing it to localhost. If you have users on your system that you don’t fully trust, use firewall rules to restrict access to the interface to root only.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">-<span class="selector-tag">a</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>I specify that I want Varnish to listen on port 8080 for incomming HTTP requests. For a production environment you would probably make Varnish listen on port 80, which is the default.<br>Now you have Varnish running. Let us make sure that it works properly. Use your browser to go to <a href="http://192.168.2.2:8080/">http://192.168.2.2:8080/</a> (obviously, you should replace the IP address with one on your own system) - you should now see your web application running there.<br>Whether or not the application actually goes faster when run through Varnish depends on a few factors. If you application uses cookies for every session (a lot of PHP and Java applications seem to send a session cookie if it is needed or not) or if it uses authentication chances are Varnish won’t do much caching. Ignore that for the moment, we come back to that in Achieving a high hitrate.<br>Lets make sure that Varnish really does do something to your web site. To do that we’ll take a look at the logs.</p>
]]></content>
  </entry>
  <entry>
    <title>yum安装eaccelerator</title>
    <url>/2014/09/30/1401/</url>
    <content><![CDATA[<p>现在已经习惯yum安装软件,可以用rpm就尽量用rpm包来安装,尽量不去编译.<br>官方的源没有eaccelerator,</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rpm -Uhv http:<span class="regexp">//</span>apt.sw.be<span class="regexp">/redhat/</span>el5<span class="regexp">/en/i</span>386<span class="regexp">/rpmforge/</span>RPMS/rpmforge-release-<span class="number">0.3</span>.<span class="number">6</span>-<span class="number">1</span>.el5.rf.i386.rpm</span><br><span class="line">rpm –import <span class="regexp">/etc/</span>pki<span class="regexp">/rpm-gpg/</span>RPM-GPG-KEY*</span><br><span class="line">yum install php-eaccelerator</span><br></pre></td></tr></table></figure>

<p>执行 yum install eaccelerator 半天,都说没有这个包,后来:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@srv</span> <span class="string">yum.repos.d</span>]<span class="comment"># yum search eaccelerator</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Loaded plugins:</span> <span class="string">fastestmirror</span></span><br><span class="line"><span class="string">Loading</span> <span class="string">mirror</span> <span class="string">speeds</span> <span class="string">from</span> <span class="string">cached</span> <span class="string">hostfile</span></span><br><span class="line"><span class="string">*</span> <span class="attr">rpmforge:</span> <span class="string">apt.sw.be</span></span><br><span class="line"><span class="string">*</span> <span class="attr">base:</span> <span class="string">centos.mirrors.redwire.net</span></span><br><span class="line"><span class="string">*</span> <span class="attr">updates:</span> <span class="string">mirrors.usc.edu</span></span><br><span class="line"><span class="string">*</span> <span class="attr">addons:</span> <span class="string">mirror.nic.uoregon.edu</span></span><br><span class="line"><span class="string">*</span> <span class="attr">extras:</span> <span class="string">centos.cogentcloud.com</span></span><br><span class="line"><span class="string">=============================</span> <span class="attr">Matched:</span> <span class="string">eaccelerator</span> <span class="string">==============================</span></span><br><span class="line"><span class="attr">php-eaccelerator.i386 :</span> <span class="string">PHP</span> <span class="string">accelerator,</span> <span class="string">optimizer,</span> <span class="string">encoder</span> <span class="string">and</span> <span class="string">dynamic</span> <span class="string">content</span></span><br><span class="line"><span class="string">:</span> <span class="string">cacher</span></span><br></pre></td></tr></table></figure>

<p>搞定.装完就好了,什么都不要管,这比你用编译的方式方便多,也不需要设置什么目录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>php.d/eaccelerator.ini</span><br></pre></td></tr></table></figure>

<p>配置信息都在上面.</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[root@srv yum.repos.d]</span># <span class="selector-tag">php</span> <span class="selector-tag">-v</span></span><br><span class="line"><span class="selector-tag">PHP</span> <span class="selector-tag">5</span><span class="selector-class">.1</span><span class="selector-class">.6</span> (cli) (<span class="attribute">built</span>: Apr <span class="number">7</span> <span class="number">2009</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">04</span>)</span><br><span class="line"><span class="selector-tag">Copyright</span> (c) <span class="selector-tag">1997-2006</span> <span class="selector-tag">The</span> <span class="selector-tag">PHP</span> <span class="selector-tag">Group</span></span><br><span class="line"><span class="selector-tag">Zend</span> <span class="selector-tag">Engine</span> <span class="selector-tag">v2</span><span class="selector-class">.1</span><span class="selector-class">.0</span>, <span class="selector-tag">Copyright</span> (c) <span class="selector-tag">1998-2006</span> <span class="selector-tag">Zend</span> <span class="selector-tag">Technologies</span></span><br><span class="line"><span class="selector-tag">with</span> <span class="selector-tag">eAccelerator</span> <span class="selector-tag">v0</span><span class="selector-class">.9</span><span class="selector-class">.5</span><span class="selector-class">.2</span>, <span class="selector-tag">Copyright</span> (c) <span class="selector-tag">2004-2006</span> <span class="selector-tag">eAccelerator</span>, <span class="selector-tag">by</span> <span class="selector-tag">eAccelerator</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>yum安装rrdtool</title>
    <url>/2013/02/01/1402/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[root@localhost]$ cd <span class="regexp">/etc/yum</span>.repos.d/</span><br><span class="line">[root@localhost]$ vim dag.repo</span><br><span class="line"></span><br><span class="line">[dag]</span><br><span class="line">name=Dag RPM Repository <span class="keyword">for</span> Red Hat Enterprise Linux</span><br><span class="line">baseurl=http:<span class="regexp">//</span>apt.sw.be<span class="regexp">/redhat/</span>el<span class="variable">$releasever</span><span class="regexp">/en/</span><span class="variable">$basearch</span>/dag</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=http:<span class="regexp">//</span>dag.wieers.com<span class="regexp">/rpm/</span>packages/RPM-GPG-KEY.dag.txt</span><br><span class="line">enabled=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>安装相关依赖:</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="string">[root@localhost]</span>$ yum install ntp vim-enhanced gcc gcc-c++ gcc-g77 flex bison <span class="built_in">auto</span>conf <span class="built_in">auto</span>make bzip2-devel ncurses-devel zlib-devel libjpeg-devel libpng-devel libtiff-devel freetype-devel libXpm-devel gettext-devel  pam-devel</span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@localhost]</span>$ yum install -y rrdtool perl-rrdtool rrdtool-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>yum出现No more mirrors to try</title>
    <url>/2019/10/09/1404/</url>
    <content><![CDATA[<p>可能原因:可能是不正常删除造成的.</p>
<p>解决方法:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">yum clean <span class="keyword">all</span></span><br><span class="line">yum makecache</span><br><span class="line">yum -y <span class="keyword">update</span></span><br></pre></td></tr></table></figure>

<p>然后重新安装.</p>
]]></content>
  </entry>
  <entry>
    <title>zabbix_get 命令</title>
    <url>/2019/05/28/1405/</url>
    <content><![CDATA[<p>zabbix_get 是 zabbix 服务端的一个命令,用于检测 agent 端的配置是否正确,可以很方便地知道 key 是否能正常获取到数据,在测试自定义监控的时候特别有用.</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">$ zabbix_get -h</span><br><span class="line"></span><br><span class="line">Zabbix get v2<span class="number">.2</span><span class="number">.17</span> (revision <span class="number">65977</span>) (<span class="number">27</span> February <span class="number">2017</span>)</span><br><span class="line"><span class="symbol">usage:</span> zabbix_get [-hV] -s <span class="params">&lt;host name or IP&gt;</span> [-p <span class="params">&lt;port&gt;</span>] [-I <span class="params">&lt;IP address&gt;</span>] -k <span class="params">&lt;key&gt;</span></span><br><span class="line"><span class="symbol">Options:</span></span><br><span class="line">  -s --host <span class="params">&lt;host name or IP&gt;</span> <span class="meta"># agent 端的 ip</span></span><br><span class="line">  -p --port <span class="params">&lt;port number&gt;</span> <span class="meta"># agent 监听的端口   默认是10050</span></span><br><span class="line">  -I --source-address <span class="params">&lt;IP address&gt;</span> <span class="meta"># 指定通过哪个网卡进行数据获取</span></span><br><span class="line">  -k --key <span class="params">&lt;key of metric&gt;</span> <span class="meta"># 执行的参数</span></span><br><span class="line">  -h --help <span class="meta">#显示帮助</span></span><br><span class="line">  -V --version <span class="meta">#显示版本信息</span></span><br></pre></td></tr></table></figure>

<p>例子:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Example: zabbix_get -s 127.0.0.1 -p 10050 -k <span class="string">&quot;system.cpu.load[all,avg1]&quot;</span></span><br><span class="line"><span class="comment"># 192.168.1.106 已经配置好 agent</span></span><br><span class="line"><span class="comment"># 192.168.10.106 不存在</span></span><br><span class="line"></span><br><span class="line">$ zabbix_get -s 192.168.1.106 -p 10050 -k <span class="string">&quot;system.cpu.load[all]&quot;</span></span><br><span class="line">0.000000</span><br><span class="line">$ zabbix_get -s 192.168.10.106 -p 10050 -k <span class="string">&quot;system.cpu.load[all]&quot;</span></span><br><span class="line">zabbix_get [10420]: <span class="builtin-name">Get</span> value error: cannot connect <span class="keyword">to</span> [[192.168.10.106]:10050]: [110] Connect</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Yum出错Error Cannot find a valid baseurl for repo addons</title>
    <url>/2012/01/27/1403/</url>
    <content><![CDATA[<p>使用yum时出现了下面的错误提示:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">Could not retrieve mirrorlist http://mirrorlist.centos.org/?release=5&amp;arch=i386&amp;repo=addons error was</span><br><span class="line">[Errno 4] IOError:</span><br><span class="line"><span class="keyword">Error: </span>Cannot find a valid baseurl for repo: addons</span><br></pre></td></tr></table></figure>

<p>然后 ping mirrorlist.centos.org 发现ping不通.怀疑是dns设置问题.</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ping</span> www.ctohome.com</span><br></pre></td></tr></table></figure>

<p>也出现:</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="literal">unknown</span> host www.ctohome.com</span><br></pre></td></tr></table></figure>

<p>的错误.多试一试偶尔会ping通,说明dns的确有问题.于是,我们来修改dns配置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure>

<p>汗,发现vi也不能用,思索下,其实我们只是需要修改 <code>/etc/resolv.conf</code>文件,直接一个dns服务器即可,想到了echo命令:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;nameserver 8.8.8.8&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure>

<p>搞定,ping <a href="http://www.baidu.com/">www.baidu.com</a> 顺畅了,yum可以用了!第一件事情,就是去删除 <code>/etc/resolv.conf</code>里面有问题的dns服务器.</p>
]]></content>
  </entry>
  <entry>
    <title>zabbix-agent安装使用</title>
    <url>/2019/05/28/1406/</url>
    <content><![CDATA[<p>添加zabbix 源并安装配置.<br>添加源库:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$rpm</span> -ivh http:<span class="regexp">//</span>repo.zabbix.com<span class="regexp">/zabbix/</span><span class="number">3.2</span><span class="regexp">/rhel/</span><span class="number">6</span><span class="regexp">/x86_64/</span>zabbix-release-<span class="number">3.2</span>-<span class="number">1</span>.el6.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>安装:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$yum</span> install zabbix-agent -y</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$chkconfig</span> zabbix-agent on   #添加开机启动</span></span><br></pre></td></tr></table></figure>

<p>注意,如果网速过慢导致安装失败,请直接下载对应有agent包再安装,效果一样.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$wget</span> http:<span class="regexp">//</span><span class="number">101.96</span>.<span class="number">10.64</span><span class="regexp">/repo.zabbix.com/</span>zabbix<span class="regexp">/3.2/</span>rhel<span class="regexp">/6/</span>x86_64/zabbix-agent-<span class="number">3.2</span>.<span class="number">8</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br><span class="line"><span class="variable">$rpm</span> -ivh zabbix-agent-<span class="number">3.2</span>.<span class="number">8</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>配置zabbix_agentd.conf:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">PidFile</span>=/var/run/zabbix/zabbix_agentd.pid</span><br><span class="line"><span class="attr">LogFile</span>=/var/log/zabbix/zabbix_agentd.log</span><br><span class="line"><span class="attr">LogFileSize</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">Server</span>=<span class="number">172.16</span>.<span class="number">3.152</span>                   <span class="comment">#zabbix server</span></span><br><span class="line"><span class="attr">ServerActive</span>=<span class="number">172.16</span>.<span class="number">3.152</span>:<span class="number">10051</span>       <span class="comment">#zabbix server  主动提交监控数据时使用</span></span><br><span class="line"><span class="attr">Hostname</span>=salt-master147               <span class="comment">#zabbix-agent标识 可以是主机名一样</span></span><br><span class="line"><span class="attr">RefreshActiveChecks</span>=<span class="number">60</span>                <span class="comment">#主动刷新提交数据失败间隔重新提交时间</span></span><br><span class="line"><span class="attr">BufferSize</span>=<span class="number">1000</span>                       <span class="comment">#缓存大小</span></span><br><span class="line"><span class="attr">MaxLinesPerSecond</span>=<span class="number">200</span>                 <span class="comment">#处理监控类型为log和eventlog日志时,agent每秒最大发送的行数.默认为100行</span></span><br><span class="line"><span class="attr">Timeout</span>=<span class="number">30</span>                            <span class="comment">#超时时间</span></span><br><span class="line"><span class="attr">UnsafeUserParameters</span>=<span class="number">1</span>                <span class="comment">#允许所有字符的参数传递给用户定义的参数    </span></span><br><span class="line"><span class="attr">Include</span>=/etc/zabbix/zabbix_agentd.d/*.conf</span><br><span class="line"><span class="attr">UserParameter</span>=proc.mysql,ps -ef|grep /usr/sbin/mysqld|grep -v grep|wc -l</span><br><span class="line"><span class="attr">UserParameter</span>=mostcpu,ps -aux | sort -k4nr | head -<span class="number">1</span> | awk <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span></span><br><span class="line"><span class="attr">UserParameter</span>=mostmem,ps -aux | sort -k4nr | head -<span class="number">1</span> | awk <span class="string">&#x27;&#123;print $1,$4&#125;&#x27;</span></span><br><span class="line"><span class="attr">UserParameter</span>=webcheck,curl -I -m <span class="number">10</span> -o /dev/null -s -w %&#123;http_code&#125;  www.dytyou.com</span><br><span class="line"><span class="comment">#最后四行为自定义监控项</span></span><br></pre></td></tr></table></figure>

<p>保存,重启zabbbix-agent:<br>$service zabbix-agent restart</p>
]]></content>
  </entry>
  <entry>
    <title>zabbix官网安装教程</title>
    <url>/2019/05/28/1407/</url>
    <content><![CDATA[<p>a.安装 数据库</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ rpm -Uvh https:<span class="regexp">//</span>repo.zabbix.com<span class="regexp">/zabbix/</span><span class="number">4.2</span><span class="regexp">/rhel/</span><span class="number">7</span><span class="regexp">/x86_64/</span>zabbix-release-<span class="number">4.2</span>-<span class="number">1</span>.el7.noarch.rpm</span><br><span class="line">$ yum clean all</span><br></pre></td></tr></table></figure>

<p>b.安装Zabbix server,Web前端,agent</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">$ yum -y install zabbix-<span class="keyword">server</span>-mysql zabbix-web-mysql zabbix-agent</span><br></pre></td></tr></table></figure>

<p>c.创建初始数据库</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ mysql -uroot -p</span><br><span class="line"><span class="keyword">password</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> zabbix <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin;</span><br><span class="line">mysql&gt; <span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> zabbix.* <span class="keyword">to</span> zabbix@localhost identified <span class="keyword">by</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure>

<p>导入初始架构和数据,系统将提示您输入新创建的密码.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ zcat <span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span><br></pre></td></tr></table></figure>

<p>d.为Zabbix server配置数据库</p>
<p>编辑配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">DBPassword=password</span><br></pre></td></tr></table></figure>

<p>e.为Zabbix前端配置PHP</p>
<p>编辑配置文件 <code>/etc/httpd/conf.d/zabbix.conf</code>, uncomment and set the right timezone for you.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ php_value <span class="built_in">date</span>.timezone Europe/Riga</span><br></pre></td></tr></table></figure>

<p>f.启动Zabbix server和agent进程</p>
<p>启动Zabbix server和agent进程,并为它们设置开机自启:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ systemctl <span class="keyword">restart</span> zabbix-<span class="keyword">server</span> zabbix-agent httpd</span><br><span class="line">$ systemctl <span class="keyword">enable</span> zabbix-<span class="keyword">server</span> zabbix-agent httpd</span><br></pre></td></tr></table></figure>

<p>现在您的Zabbix server已经安装完成并开始运行.<br>配置Zabbix前端.<br>连接到新安装的Zabbix前端:<a href="http://server_ip_or_name/zabbix">http://server_ip_or_name/zabbix</a>.<br>根据Zabbix文件里步骤操作:安装前端.</p>
]]></content>
  </entry>
  <entry>
    <title>zlib.h 没有那个文件或目录</title>
    <url>/2013/10/29/1408/</url>
    <content><![CDATA[<p>解决 :</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">yum install <span class="literal">zlib</span> <span class="literal">zlib</span>-devel</span><br></pre></td></tr></table></figure>
<p>重新编译就可以通过了.</p>
]]></content>
  </entry>
  <entry>
    <title>安装GMONE3 卸载UNITY</title>
    <url>/2018/08/03/1409/</url>
    <content><![CDATA[<p>1、安装GNOME 3</p>
<figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">sudo apt-get install gnome-shell</span><br><span class="line">sudo apt-get install gnome-tweak-tool</span><br><span class="line">sudo apt-get install gnome-themes*</span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="params">(或者简单的选择 <span class="variable">sudo</span> <span class="variable">apt</span>-<span class="variable">get</span> <span class="variable">install</span> <span class="variable">gnome</span>-<span class="variable">themes</span>-<span class="variable">standard</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>2、删除UNITY</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> -y --auto-<span class="builtin-name">remove</span> purge unity</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> -y --auto-<span class="builtin-name">remove</span> purge unity-common</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> -y --auto-<span class="builtin-name">remove</span> purge unity-lens*</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> -y --auto-<span class="builtin-name">remove</span> purge unity-services</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> -y --auto-<span class="builtin-name">remove</span> purge unity-asset-pool</span><br></pre></td></tr></table></figure>

<p>注意:不能用 <code>sudo apt-get --auto-remove purge unity*</code>,看软件包列表里,有不少跟UNITY无关的也列出了.<br>而且 unity-greeter 必须保留.如果删了,自己蹲墙边哭一会儿再想办法.</p>
<p>详细过程:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get --auto-remove purge unity</span><br><span class="line"></span><br><span class="line">[sudo] password for geee:</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">下列软件包将被[卸载]:</span><br><span class="line">ubuntu-desktop* unity*</span><br><span class="line">升级了 <span class="number">0</span> 个软件包,新安装了 <span class="number">0</span> 个软件包,要卸载 <span class="number">2</span> 个软件包,有 <span class="number">142</span> 个软件包未被升级.</span><br><span class="line">解压缩后将会空出 <span class="number">2</span>,<span class="number">589</span> kB 的空间.</span><br><span class="line">您希望继续执行吗?[<span class="symbol">Y</span>/n]y</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 <span class="number">153261</span> 个文件和目录.)</span><br><span class="line">正在卸载 ubuntu-desktop ...</span><br><span class="line">正在卸载 unity ...</span><br><span class="line">正在处理用于 man-db 的触发器...</span><br><span class="line">geee@geeepc:~$ sudo apt-get --auto-remove purge unity-common</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">下列软件包将被[卸载]:</span><br><span class="line">libunity<span class="number">-2</span>d-private0* unity<span class="number">-2</span>d* unity<span class="number">-2</span>d-launcher* unity<span class="number">-2</span>d-panel*</span><br><span class="line">unity<span class="number">-2</span>d-places* unity<span class="number">-2</span>d-spread* unity-common* unity-lens-applications*</span><br><span class="line">升级了 <span class="number">0</span> 个软件包,新安装了 <span class="number">0</span> 个软件包,要卸载 <span class="number">8</span> 个软件包,有 <span class="number">140</span> 个软件包未被升级.</span><br><span class="line">解压缩后将会空出 <span class="number">3</span>,<span class="number">965</span> kB 的空间.</span><br><span class="line">您希望继续执行吗?[<span class="symbol">Y</span>/n]y</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 <span class="number">153236</span> 个文件和目录.)</span><br><span class="line">正在卸载 unity<span class="number">-2</span>d ...</span><br><span class="line">正在清除 unity<span class="number">-2</span>d 的配置文件 ...</span><br><span class="line">正在卸载 unity<span class="number">-2</span>d-spread ...</span><br><span class="line">正在卸载 unity<span class="number">-2</span>d-places ...</span><br><span class="line">正在卸载 unity<span class="number">-2</span>d-panel ...</span><br><span class="line">正在清除 unity<span class="number">-2</span>d-panel 的配置文件 ...</span><br><span class="line">正在卸载 unity<span class="number">-2</span>d-launcher ...</span><br><span class="line">正在卸载 libunity<span class="number">-2</span>d-private0 ...</span><br><span class="line">正在清除 libunity<span class="number">-2</span>d-private0 的配置文件 ...</span><br><span class="line">正在卸载 unity-lens-applications ...</span><br><span class="line">正在清除 unity-lens-applications 的配置文件 ...</span><br><span class="line">正在卸载 unity-common ...</span><br><span class="line">正在处理用于 gconf2 的触发器...</span><br><span class="line">正在处理用于 libglib2<span class="number">.0</span><span class="number">-0</span> 的触发器...</span><br><span class="line">正在处理用于 man-db 的触发器...</span><br><span class="line">正在处理用于 gnome-menus 的触发器...</span><br><span class="line">正在处理用于 desktop-file-utils 的触发器...</span><br><span class="line">正在处理用于 bamfdaemon 的触发器...</span><br><span class="line"><span class="symbol">Rebuilding</span> /usr/share/applications/bamf.index...</span><br><span class="line">正在处理用于 libc-bin 的触发器...</span><br><span class="line">ldconfig deferred processing now taking place</span><br><span class="line">geee@geeepc:~$ sudo apt-get --auto-remove purge unity-lens*</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">注意,根据正则表达式 unity-lens* 选中了 unity-lens-gwibber</span><br><span class="line">注意,根据正则表达式 unity-lens* 选中了 unity-lens-applications</span><br><span class="line">注意,根据正则表达式 unity-lens* 选中了 unity-lens-files</span><br><span class="line">注意,根据正则表达式 unity-lens* 选中了 unity-lens-music</span><br><span class="line">软件包 unity-lens-gwibber 还未安装,因而不会被卸载</span><br><span class="line">软件包 unity-lens-applications 还未安装,因而不会被卸载</span><br><span class="line">下列软件包将被[卸载]:</span><br><span class="line">unity-lens-files* unity-lens-music* unity-scope-musicstores*</span><br><span class="line">升级了 <span class="number">0</span> 个软件包,新安装了 <span class="number">0</span> 个软件包,要卸载 <span class="number">3</span> 个软件包,有 <span class="number">140</span> 个软件包未被升级.</span><br><span class="line">解压缩后将会空出 <span class="number">451</span> kB 的空间.</span><br><span class="line">您希望继续执行吗?[<span class="symbol">Y</span>/n]y</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 <span class="number">152932</span> 个文件和目录.)</span><br><span class="line">正在卸载 unity-lens-files ...</span><br><span class="line">正在卸载 unity-scope-musicstores ...</span><br><span class="line">正在卸载 unity-lens-music ...</span><br><span class="line">geee@geeepc:~$ sudo apt-get --auto-remove purge unity-services</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">下列软件包将被[卸载]:</span><br><span class="line">libunity-core<span class="number">-4.0</span><span class="number">-4</span>* unity-services*</span><br><span class="line">升级了 <span class="number">0</span> 个软件包,新安装了 <span class="number">0</span> 个软件包,要卸载 <span class="number">2</span> 个软件包,有 <span class="number">138</span> 个软件包未被升级.</span><br><span class="line">解压缩后将会空出 <span class="number">721</span> kB 的空间.</span><br><span class="line">您希望继续执行吗?[<span class="symbol">Y</span>/n]y</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 <span class="number">152906</span> 个文件和目录.)</span><br><span class="line">正在卸载 libunity-core<span class="number">-4.0</span><span class="number">-4</span> ...</span><br><span class="line">正在清除 libunity-core<span class="number">-4.0</span><span class="number">-4</span> 的配置文件 ...</span><br><span class="line">正在卸载 unity-services ...</span><br><span class="line">正在处理用于 libc-bin 的触发器...</span><br><span class="line">ldconfig deferred processing now taking place</span><br><span class="line">正在处理用于 man-db 的触发器...</span><br><span class="line">geee@geeepc:~$ sudo apt-get --auto-remove purge unity-asset-pool</span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树</span><br><span class="line">正在读取状态信息... 完成</span><br><span class="line">下列软件包将被[卸载]:</span><br><span class="line">unity-asset-pool*</span><br><span class="line">升级了 <span class="number">0</span> 个软件包,新安装了 <span class="number">0</span> 个软件包,要卸载 <span class="number">1</span> 个软件包,有 <span class="number">138</span> 个软件包未被升级.</span><br><span class="line">解压缩后将会空出 <span class="number">451</span> kB 的空间.</span><br><span class="line">您希望继续执行吗?[<span class="symbol">Y</span>/n]y</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 <span class="number">152894</span> 个文件和目录.)</span><br><span class="line">正在卸载 unity-asset-pool ...</span><br><span class="line">正在清除 unity-asset-pool 的配置文件 ...</span><br></pre></td></tr></table></figure>

<p>拆卸完成.</p>
]]></content>
  </entry>
  <entry>
    <title>安装nokogiri 报错 libxslt is missing</title>
    <url>/2014/06/21/1411/</url>
    <content><![CDATA[<p>需要安装:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ruby</span> <span class="number">1</span>.<span class="number">8</span> or <span class="number">1</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">libxml2</span></span><br><span class="line"><span class="attribute">libxml2</span>-dev</span><br><span class="line"><span class="attribute">libxslt</span></span><br><span class="line"><span class="attribute">libxslt</span>-dev</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>安装IE8 开机奇慢无比的解决办法</title>
    <url>/2016/03/09/1410/</url>
    <content><![CDATA[<p>去添加删除程序 删除 browser data service 这个程序 就好了.<br>这个程序是第一次开机设置ie8的程序,正常开机一次我们就不要这个程序了.</p>
]]></content>
  </entry>
  <entry>
    <title>安装配置eAccelerator</title>
    <url>/2018/12/19/1413/</url>
    <content><![CDATA[<p>eAccelerator的前身其实是truck-mmcache,因为开发truk-mmcache的人被Zend给招安了,所以开发eAccelerator的人继承了truk-mmcache的一些特性,设计出eAccelerator加速器.安装如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$wget</span> http:<span class="regexp">//</span>jaist.dl.sourceforge.net<span class="regexp">/sourceforge/</span>eaccelerator/eaccelerator-<span class="number">0.9</span>.<span class="number">5</span>.tar.bz2</span><br><span class="line"><span class="variable">$tar</span> -jxf eaccelerator-<span class="number">0.9</span>.<span class="number">5</span>.tar.bz2</span><br><span class="line"><span class="variable">$cd</span> eaccelerator-<span class="number">0.9</span>.<span class="number">5</span></span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin/phpize</span><br><span class="line">$.<span class="regexp">/configure –enable-eaccelerator=shared –with-php-config=/u</span>sr<span class="regexp">/local/</span>php<span class="regexp">/bin/</span>php-config</span><br><span class="line"><span class="variable">$make</span></span><br><span class="line"><span class="variable">$sudo</span> make install</span><br><span class="line"><span class="variable">$sudo</span> mv <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>lib<span class="regexp">/php/</span>extensions<span class="regexp">/no-debug-non-zts-20060613/</span>eaccelerator.so <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>lib<span class="regexp">/php/</span>extensions/PECL</span><br></pre></td></tr></table></figure>

<p>将下面代码加入php.ini文件中:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">extension</span> = eaccelerator.so</span><br><span class="line"><span class="comment">; eAccelerator</span></span><br><span class="line"><span class="attr">eaccelerator.shm_size</span> = <span class="string">&quot;16&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.cache_dir</span> = <span class="string">&quot;/tmp/eaccelerator&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.enable</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.optimizer</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.check_mtime</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.debug</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.filter</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_max</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_ttl</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.prune_period</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_only</span> = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress_level</span> = <span class="string">&quot;9&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建缓存目录,重启apache.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sudo</span> mkdir <span class="regexp">/tmp/</span>eaccelerator</span><br><span class="line"><span class="variable">$sudo</span> chmod <span class="number">777</span> <span class="regexp">/tmp/</span>eaccelerator</span><br><span class="line"><span class="variable">$sudo</span> <span class="regexp">/usr/</span>local<span class="regexp">/apache/</span>apachectl restart</span><br></pre></td></tr></table></figure>

<p>在phpinfo()检查是否安装成功.</p>
]]></content>
  </entry>
  <entry>
    <title>安装ubuntu卡在 正在完成文件复制</title>
    <url>/2019/03/07/1412/</url>
    <content><![CDATA[<p>系统是Ubunut 10.04.<br>安装Ubuntu时,安装过程卡在99%正在完成文件复制.<br>一直就卡在那里,其实安装过程并没有挂起,是通过网络下载安装文件,所以看起来是卡着.<br>断开网络就可以了.<br>记录下来,希望给遇到同样问题的人.</p>
]]></content>
  </entry>
  <entry>
    <title>按cpu占用排列进程</title>
    <url>/2012/09/14/1415/</url>
    <content><![CDATA[<p>linux服务器有的时候会很卡,为了查找占用cpu最高的程序,所以:<br>按cpu利用率从大到小排列进程:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">ps -eo <span class="string">&quot;%C : %p : %z : %a&quot;</span>|<span class="keyword">sort</span> -nr</span><br></pre></td></tr></table></figure>
<p>这样我们就可以按着cpu占用排列所有进程了,找到占用最高的kill掉就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>安装完rsync找不到rsyncd.conf</title>
    <url>/2015/03/28/1414/</url>
    <content><![CDATA[<p>今天站长鼓捣rsync发现 安装完rsync找不到书上说的rsyncd.conf,</p>
<p>后来发现没有也没有关系,</p>
<p>直接在<code>/etc/</code>下建立一个这个文件,然后把内容写进去就可以使用了.</p>
]]></content>
  </entry>
  <entry>
    <title>备份mysql并传送到存储服务器</title>
    <url>/2019/03/01/1416/</url>
    <content><![CDATA[<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /root</span><br><span class="line">day=`date +%Y-%m-%d*%H`</span><br><span class="line">tar -cvf mysql-<span class="variable">$day</span>.tar <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>var<span class="regexp">/paila /u</span>sr<span class="regexp">/local/my</span>sql<span class="regexp">/var/</span>pmbcc</span><br><span class="line">scp -P65188 mysql-<span class="variable">$day</span>.tar superman003@<span class="number">10.0</span>.<span class="number">10.3</span>:<span class="regexp">/home/</span>superman003/mysqlbak</span><br><span class="line">rm -rf mysql-<span class="variable">$day</span>.tar</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>本站简介</title>
    <url>/2019/09/10/1417/</url>
    <content><![CDATA[<p>关于我：十年打杂胡混经验的职业IT农民工、专业运维工程师、偶尔充当python开发工程师。</p>
<p>网站地址首页：<a href="https://shuxun.wang/">https://shuxun.wang</a></p>
<p>广告合作：请邮件发送至 <a href="mailto:&#x39;&#49;&#54;&#49;&#x36;&#54;&#54;&#53;&#57;&#64;&#x71;&#113;&#46;&#x63;&#111;&#x6d;">&#x39;&#49;&#54;&#49;&#x36;&#54;&#54;&#53;&#57;&#64;&#x71;&#113;&#46;&#x63;&#111;&#x6d;</a> 进行恰谈 。</p>
]]></content>
  </entry>
  <entry>
    <title>编译安装php和php-fpm</title>
    <url>/2011/12/05/1419/</url>
    <content><![CDATA[<p>这篇文章的路径和用户都是站长自己服务器上的,大家要根据自己服务器的情况作出修改.</p>
<p>安装php 5.3.3(5.3.3已包括fpm):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>cn.php.net<span class="regexp">/get/</span>php-<span class="number">5.3</span>.<span class="number">3</span>.tar.bz2</span><br><span class="line">tar -jxvf php-<span class="number">5.3</span>.<span class="number">3</span>.tar.bz2 cd php-<span class="number">5.3</span>.<span class="number">3</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/home/y</span>aoya/php --enable-fpm</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>配置php:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cp php.ini-development <span class="regexp">/usr/</span>home<span class="regexp">/yaoya/</span>php<span class="regexp">/lib/</span>php.ini</span><br><span class="line">cd <span class="regexp">/usr/</span>home<span class="regexp">/yaoya/</span>php/etc</span><br><span class="line">cp php-fpm.conf.<span class="keyword">default</span> php-fpm.conf</span><br></pre></td></tr></table></figure>

<p>编辑php-fpm.conf:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">pid</span> = /usr/home/yaoya/php/var/run/php-fpm.pid</span><br><span class="line"><span class="attr">error_log</span> = /usr/home/yaoya/php/var/log/php-fpm.log</span><br><span class="line"><span class="attr">log_level</span> = notice</span><br><span class="line"><span class="section">[www]</span></span><br><span class="line"><span class="attr">listen</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span></span><br><span class="line"><span class="attr">user</span> = yaoya</span><br><span class="line"><span class="attr">group</span> = yaoya</span><br><span class="line"><span class="attr">pm</span> = dynamic</span><br><span class="line"><span class="attr">pm.max_children</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">pm.start_servers</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">pm.min_spare_servers</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">pm.max_spare_servers</span> = <span class="number">35</span></span><br></pre></td></tr></table></figure>

<p>启动php fastcgi:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>home<span class="regexp">/yaoya/</span>php<span class="regexp">/sbin/</span>php-fpm</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>编辑 (Rails on Ruby)错误&amp;quot;NameError (undefined local variable or method `acts_as_taggab&amp;quot;</title>
    <url>/2017/08/27/1418/</url>
    <content><![CDATA[<p>(Rails on Ruby)错误:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;NameError (undefined local variable or method `acts_as_taggab&quot;</span></span><br></pre></td></tr></table></figure>

<p>在WIN的话 请直接使用:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">gem <span class="keyword">install</span> acts_as_taggable</span><br></pre></td></tr></table></figure>

<p>如果还不行.<br>那就去github 下一份acts_as_taggable到PLUGIN 就能正常使用了.<br>记得 要重新执行一次:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">ruby <span class="keyword">script</span>/server</span><br></pre></td></tr></table></figure>

<p>acts_as_taggable下载地址:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/mattetti/</span>acts_as_taggable_on_steroids/</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>查看Apache并发请求数及其TCP连接状态</title>
    <url>/2012/01/24/1420/</url>
    <content><![CDATA[<p>这两天搭建了一组Apache服务器,每台服务器4G内存,采用的是prefork模式,一开始设置的连接数太少了,需要较长的时间去响应用户的请求,后来修改了一下Apache 2.0.59的配置文件httpd.conf:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># prefork MPM</span></span><br><span class="line"><span class="comment"># StartServers: number of server processes to start</span></span><br><span class="line"><span class="comment"># MinSpareServers: minimum number of server processes which are kept spare</span></span><br><span class="line"><span class="comment"># MaxSpareServers: maximum number of server processes which are kept spare</span></span><br><span class="line"><span class="comment"># MaxClients: maximum number of server processes allowed to start</span></span><br><span class="line"><span class="comment"># MaxRequestsPerChild: maximum number of requests a server process serves</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">StartServers</span>         <span class="number">10</span></span><br><span class="line"><span class="attribute">MinSpareServers</span>      <span class="number">10</span></span><br><span class="line"><span class="attribute">MaxSpareServers</span>      <span class="number">15</span></span><br><span class="line"><span class="attribute">ServerLimit</span>          <span class="number">2000</span></span><br><span class="line"><span class="attribute">MaxClients</span>           <span class="number">2000</span></span><br><span class="line"><span class="attribute">MaxRequestsPerChild</span>  <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<p>查看httpd进程数(即prefork模式下Apache能够处理的并发请求数):</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">ps -ef | <span class="type">grep</span> httpd | <span class="type">wc</span> -l</span><br></pre></td></tr></table></figure>

<p>返回结果示例:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="number">1388</span></span><br></pre></td></tr></table></figure>

<p>表示Apache能够处理1388个并发请求,这个值Apache可根据负载情况自动调整,我这组服务器中每台的峰值曾达到过2002.<br>查看Apache的并发请求数及其TCP连接状态:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">netstat -n | awk <span class="comment">&#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>返回结果示例:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">LAST_ACK</span> <span class="number">5</span></span><br><span class="line"><span class="attribute">SYN_RECV</span> <span class="number">30</span></span><br><span class="line"><span class="attribute">ESTABLISHED</span> <span class="number">1597</span></span><br><span class="line"><span class="attribute">FIN_WAIT1</span> <span class="number">51</span></span><br><span class="line"><span class="attribute">FIN_WAIT2</span> <span class="number">504</span></span><br><span class="line"><span class="attribute">TIME_WAIT</span> <span class="number">1057</span></span><br></pre></td></tr></table></figure>

<p>其中的SYN_RECV表示正在等待处理的请求数;ESTABLISHED表示正常数据传输状态;TIME_WAIT表示处理完毕,等待超时结束的请求数.</p>
]]></content>
  </entry>
  <entry>
    <title>查看redis的版本</title>
    <url>/2019/08/20/1422/</url>
    <content><![CDATA[<p>查看redis的版本有两种方式:</p>
<p>第一种:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">server</span> <span class="comment">--version</span></span><br><span class="line">redis-<span class="keyword">server</span> -v </span><br></pre></td></tr></table></figure>

<p>得到的结果是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Redis</span> server v=<span class="number">3</span>.<span class="number">0</span>.<span class="number">504</span> sha=<span class="number">00000000</span>:<span class="number">0</span> malloc=jemalloc-<span class="number">3</span>.<span class="number">6</span>.<span class="number">0</span> bits=<span class="number">64</span> build=a<span class="number">4</span>f<span class="number">7</span>a<span class="number">6</span>e<span class="number">86</span>f<span class="number">2</span>d<span class="number">60</span>b<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>第二种:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span> --<span class="keyword">version</span></span><br><span class="line">redis-<span class="keyword">cli</span> -v</span><br></pre></td></tr></table></figure>

<p>得到的结果是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">redis</span>-cli <span class="number">3</span>.<span class="number">0</span>.<span class="number">504</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>拆卸服务器原有环境</title>
    <url>/2017/04/17/1423/</url>
    <content><![CDATA[<p>如果你的VPS安装的是centos完全版,那么它已经自带有apache等组件,我们要使用kloxo自带的服务器组件,就需要先卸载自带的apache、mysql等.</p>
<p>卸载Mysql</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> mysql</span><br></pre></td></tr></table></figure>

<p>卸载Apache</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> httpd</span><br></pre></td></tr></table></figure>

<p>卸载PHP</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> php</span><br></pre></td></tr></table></figure>

<p>注意:卸载的时候如果卸载不掉,系统一般会提示包的依赖关系,并且列出依赖的包的名称,先卸载提示依赖的包就可以了.如果实在实在有卸载不掉的包,可以加-nodeps这个参数来卸载,比如卸载php-5.2.6-11,实在卸不掉了.就用:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -e php-<span class="number">5</span>.<span class="number">2</span>.<span class="number">6</span>-<span class="number">11</span> -nodeps</span><br></pre></td></tr></table></figure>

<p>命令很强硬,应该行的.</p>
]]></content>
  </entry>
  <entry>
    <title>初始化mysql</title>
    <url>/2013/08/05/1424/</url>
    <content><![CDATA[<p>解决方法:</p>
<pre><code>mysql_install_db --user=mysql
</code></pre>
]]></content>
  </entry>
  <entry>
    <title>查看linux系统信息</title>
    <url>/2017/04/17/1421/</url>
    <content><![CDATA[<p>查看内核版本命令:</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">cat /<span class="keyword">proc</span>/version<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">linux-o497:~</span> #<span class="title"> cat</span> /<span class="keyword">proc</span>/version<span class="title"></span></span><br><span class="line"><span class="title">Linux</span> version 2.6.27.29-0.1-xen (geeko@buildhost) (gcc<span class="title"> version</span> 4.3.2 [gcc-4_3-branch<span class="title"> revision</span> 141291] (SUSE<span class="title"> Linux)</span> ) #1<span class="title"> SMP</span> 2009-08-15 17:53:59 +0200<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">uname</span> -a ?<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">linux-o497:~</span> #<span class="title"> uname</span> -a<span class="title"></span></span><br><span class="line"><span class="title">Linux</span> linux-o497 2.6.27.29-0.1-xen #1<span class="title"> SMP</span> 2009-08-15 17:53:59 +0200<span class="title"> i686</span> i686<span class="title"> i386</span> GNU/Linux<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">uname</span> -r<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">linux-o497:~</span> #<span class="title"> uname</span> -r</span><br><span class="line">2.6.27.29-0.1-xen</span><br></pre></td></tr></table></figure>

<p>查看linux版本:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lsb_release</span> -a</span><br><span class="line"></span><br><span class="line"><span class="attribute">linux</span>-o<span class="number">497</span>:~ # lsb_release -a</span><br><span class="line"><span class="attribute">LSB</span> Version:??? core-<span class="number">2</span>.<span class="number">0</span>-noarch:core-<span class="number">3</span>.<span class="number">2</span>-noarch:core-<span class="number">2</span>.<span class="number">0</span>-ia<span class="number">32</span>:core-<span class="number">3</span>.<span class="number">2</span>-ia<span class="number">32</span>:desktop-<span class="number">3</span>.<span class="number">2</span>-ia<span class="number">32</span>:desktop-<span class="number">3</span>.<span class="number">2</span>-noarch:graphics-<span class="number">2</span>.<span class="number">0</span>-ia<span class="number">32</span>:graphics-<span class="number">2</span>.<span class="number">0</span>-noarch:graphics-<span class="number">3</span>.<span class="number">2</span>-ia<span class="number">32</span>:graphics-<span class="number">3</span>.<span class="number">2</span>-noarch</span><br><span class="line"><span class="attribute">Distributor</span> ID: SUSE LINUX</span><br><span class="line"><span class="attribute">Description</span>:??? openSUSE <span class="number">11</span>.<span class="number">1</span> (i<span class="number">586</span>)</span><br><span class="line"><span class="attribute">Release</span>:??????? <span class="number">11</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Codename</span>:?????? n/a</span><br></pre></td></tr></table></figure>

<p>注:这个命令适用于所有的linux,包括Redhat、SuSE、Debian等发行版.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/etc/i</span>ssue</span><br><span class="line"></span><br><span class="line">linux-o497:~ # cat <span class="regexp">/etc/i</span>ssue</span><br><span class="line">Welcome to openSUSE <span class="number">11.1</span> - Kernel r (l).</span><br><span class="line"></span><br><span class="line">cat <span class="regexp">/etc/</span>redhat-release ?</span><br><span class="line"></span><br><span class="line">[root@li82-<span class="number">95</span> ~]# cat <span class="regexp">/etc/</span>redhat-release</span><br><span class="line">CentOS release <span class="number">5.3</span> (<span class="keyword">Final</span>)</span><br></pre></td></tr></table></figure>

<p>注:这种方式下可以直接看到具体的版本号,比如 AS4 Update 1</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">rpm -q redhat-<span class="keyword">release</span></span><br><span class="line"></span><br><span class="line">[root<span class="title">@q1test01</span> ~]# rpm -q redhat-<span class="keyword">release</span></span><br><span class="line">redhat-<span class="keyword">release</span><span class="number">-4</span>AS<span class="number">-3</span></span><br></pre></td></tr></table></figure>

<p>注:这种方式下可看到一个所谓的release号,比如上边的例子是3<br>这个release号和实际的版本之间存在一定的对应关系,如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">redhat</span>-release-<span class="number">3</span>AS-<span class="number">1</span> -&gt; Redhat Enterprise Linux AS <span class="number">3</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">3</span>AS-<span class="number">7</span>.<span class="number">4</span> -&gt; Redhat Enterprise Linux AS <span class="number">3</span> Update <span class="number">4</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">4</span>AS-<span class="number">2</span> -&gt; Redhat Enterprise Linux AS <span class="number">4</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">4</span>AS-<span class="number">2</span>.<span class="number">4</span> -&gt; Redhat Enterprise Linux AS <span class="number">4</span> Update <span class="number">1</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">4</span>AS-<span class="number">3</span> -&gt; Redhat Enterprise Linux AS <span class="number">4</span> Update <span class="number">2</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">4</span>AS-<span class="number">4</span>.<span class="number">1</span> -&gt; Redhat Enterprise Linux AS <span class="number">4</span> Update <span class="number">3</span></span><br><span class="line"><span class="attribute">redhat</span>-release-<span class="number">4</span>AS-<span class="number">5</span>.<span class="number">5</span> -&gt; Redhat Enterprise Linux AS <span class="number">4</span> Update <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>另:最后两种方法只对Redhat Linux有效.</p>
]]></content>
  </entry>
  <entry>
    <title>创建centos linux回收站 防止误删</title>
    <url>/2016/12/26/1425/</url>
    <content><![CDATA[<p>创建”回收站”文件夹:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/tmp/</span>huishouzhan</span><br></pre></td></tr></table></figure>

<p>这个文件夹和位子大家可以根据自己情况建立.<br>在bin目录下创建一个文件,名字随意了,我这里就叫huishouzhan.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/bin/</span>huishouzhan</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">#<span class="regexp">/bin/</span>bash</span><br><span class="line">mv $@ <span class="regexp">/tmp/</span>huishouzhan #回收站目录就在<span class="regexp">/tmp/</span>huishouzhan</span><br></pre></td></tr></table></figure>

<p>编辑文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>bashrc</span><br></pre></td></tr></table></figure>

<p>在最下面添加:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> rm=<span class="string">&#x27;/bin/huishouzhan&#x27;</span></span><br></pre></td></tr></table></figure>

<p>做一个别名,这样我们在bash shell中执行rm就相当于执行/bin/huishouzhan这个脚本了,现在应该大家都知道原理了吧 o(∩_∩)o 哈哈,其实就是将要删除的文件夹移动到其他文件夹.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">755</span> <span class="regexp">/bin/</span>huishouzhan <span class="comment">#对脚本赋予权限</span></span><br><span class="line">chmod <span class="number">777</span> <span class="regexp">/tmp/</span>huishouzhan <span class="comment">#对回收站文件夹授予权限,777可能有些危险,我用的是这个,有空的朋友可以研究下.</span></span><br></pre></td></tr></table></figure>

<p>退出shell重新登录.</p>
]]></content>
  </entry>
  <entry>
    <title>防火墙开放端口</title>
    <url>/2014/09/11/1427/</url>
    <content><![CDATA[<p>临时开放端口:<br>运行命令:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">iptables -<span class="selector-tag">I</span> <span class="selector-tag">INPUT</span> -<span class="selector-tag">p</span> tcp --dport <span class="number">80</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>重启防火墙:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>该方式重启电脑后,可能会失效.</p>
<p>永久开放端口:<br>编辑文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/iptables</span><br></pre></td></tr></table></figure>

<p>添加一行:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">80</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>重启防火墙</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>该方式重启电脑后,不会失效.</p>
<p>关闭防火墙:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables stop</span><br></pre></td></tr></table></figure>

<p>永久关闭:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> –level <span class="number">35</span> iptables <span class="literal">off</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>防止提权</title>
    <url>/2018/03/26/1429/</url>
    <content><![CDATA[<p>chattr命令给下面的文件加上不可更改属性,从而防止非授权用户获得权限.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chattr +i <span class="regexp">/etc/</span>passwd</span><br><span class="line">chattr +i <span class="regexp">/etc/</span>shadow</span><br><span class="line">chattr +i <span class="regexp">/etc/g</span>roup</span><br><span class="line">chattr +i <span class="regexp">/etc/g</span>shadow</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>错误configure error no acceptable C compiler found in $PATH</title>
    <url>/2015/04/13/1426/</url>
    <content><![CDATA[<p>ar完了后 进入 文件夹 :</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./configure</span></span><br></pre></td></tr></table></figure>

<p>屏幕出现 :</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">checking for chosen layout<span class="params">...</span> Apache</span><br><span class="line">checking for working mkdir <span class="params">-p...</span> yes</span><br><span class="line">checking build system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">checking host system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">checking target system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line"></span><br><span class="line">Configuring Apache Portable Runtime library <span class="params">...</span></span><br><span class="line"></span><br><span class="line">checking for APR<span class="params">...</span> reconfig</span><br><span class="line">configuring package <span class="keyword">in</span> srclib/apr now</span><br><span class="line">checking build system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">checking host system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">checking target system <span class="keyword">type</span><span class="params">...</span> i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">Configuring APR library</span><br><span class="line">Platform: i686<span class="params">-pc</span><span class="params">-linux</span><span class="params">-gnu</span></span><br><span class="line">checking for working mkdir <span class="params">-p...</span> yes</span><br><span class="line">APR Version: <span class="number">1.2</span><span class="number">.8</span></span><br><span class="line">checking for chosen layout<span class="params">...</span> apr</span><br><span class="line">checking for gcc<span class="params">...</span> no</span><br><span class="line">checking for cc<span class="params">...</span> no</span><br><span class="line">checking for cc<span class="params">...</span> no</span><br><span class="line">checking for cl<span class="params">...</span> no</span><br><span class="line">configure: error: no acceptable C compiler found <span class="keyword">in</span> $PATH</span><br><span class="line">See <span class="string">`config.log&#x27; for more details.</span></span><br><span class="line"><span class="string">configure failed for srclib/apr</span></span><br></pre></td></tr></table></figure>

<p>如果遇到这个问题的时候,只要把安装盘里和gcc有关的都装上,如果安装盘里也没有.<br>运行:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc</span><br></pre></td></tr></table></figure>

<p>搞定.</p>
]]></content>
  </entry>
  <entry>
    <title>防火墙只允许某一个ip</title>
    <url>/2016/01/25/1428/</url>
    <content><![CDATA[<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">iptables -P <span class="keyword">OUTPUT</span> <span class="built_in">DROP</span></span><br><span class="line">iptables -A <span class="keyword">OUTPUT</span> -d xxx.xxx.xxx.xxx -j ACCEPT</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>服务器的安全配置技巧总结</title>
    <url>/2015/07/05/1431/</url>
    <content><![CDATA[<p>下面我就结合自己的经验和教训总结一下服务器安全设置的一些技巧和方法.</p>
<p>一、操作系统的安装</p>
<p>我这里说的操作系统以Windows 2000为例,高版本的Windows也有类似功能.<br>格式化硬盘时候,必须格式化为NTFS的,绝对不要使用FAT32类型.<br>C盘为操作系统盘,D盘放常用软件,E盘网站,格式化完成后立刻设置磁盘权限,C盘默认,D盘的安全设置为Administrator和System完全控制,其他用户删除,E盘放网站,如果只有一个网站,就设置Administrator和System完全控制,Everyone读取,如果网站上某段代码必须完成写操作,这时再单独对那个文件所在的文件夹权限进行更改.　　<br>还有:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">net<span class="selector-class">.exe</span> #NET命令</span><br><span class="line">cmd<span class="selector-class">.exe</span> <span class="selector-id">#CMD</span> 懂电脑的都知道咯~</span><br><span class="line">tftp<span class="selector-class">.exe</span></span><br><span class="line">netstat<span class="selector-class">.exe</span></span><br><span class="line">regedit<span class="selector-class">.exe</span> #注册表啦大家都知道</span><br><span class="line">at<span class="selector-class">.exe</span></span><br><span class="line">attrib<span class="selector-class">.exe</span></span><br><span class="line">cacls<span class="selector-class">.exe</span> #ACL用户组权限设置,此命令可以在NTFS下设置任何文件夹的任何权限!偶入侵的时候没少用这个....(:</span><br><span class="line">format<span class="selector-class">.exe</span> #不说了,大家都知道是做嘛的</span><br></pre></td></tr></table></figure>

<p>大家都知道ASP木马吧,有个CMD运行这个的,这些如果都可以在CMD下运行,估计别的没啥,format下估计就哭了(:这些文件都设置只允许administrator访问.)<br>系统安装过程中一定本着最小服务原则,无用的服务一概不选择,达到系统的最小安装,在安装IIS的过程中,只安装最基本必要的功能,那些不必要的危险服务千万不要安装,例如:FrontPage 2000服务器扩展,Internet服务管理器(HTML),FTP服务,文档,索引服务等等.</p>
<p>二、网络安全配置</p>
<p>网络安全最基本的是端口设置,在”本地连接属性”,点”Internet协议(TCP/IP)”,点”高级”,再点”选项”-“TCP/IP筛选”.仅打开网站服务所需要使用的端口,配置界面如下图.<br>进行如下设置后,从你的服务器将不能使用域名解析,因此上网,但是外部的访问是正常的.这个设置主要为了防止一般规模的DDOS攻击.</p>
<p>三、安全模板设置</p>
<p>运行MMC,添加独立管理单元”安全配置与分析”,导入模板basicsv.inf或者securedc.inf,然后点”立刻配置计算机”,系统就会自动配置”帐户策略”、”本地策略”、”系统服务”等信息,一步到位,不过这些配置可能会导致某些软件无法运行或者运行出错.<br>四、WEB服务器的设置<br>以IIS为例,绝对不要使用IIS默认安装的WEB目录,而需要在E盘新建立一个目录.然后在IIS管理器中右击主机-&gt;属性-&gt;WWW服务 编辑-&gt;主目录配置-&gt;应用程序映射,只保留asp和asa,其余全部删除.</p>
<p>IIS安全设置</p>
<p>1.不使用默认的Web站点,如果使用也要将IIS目录与系统磁盘分开.<br>2.删除IIS默认创建的Inetpub目录(在安装系统的盘上).<br>3.删除系统盘下的虚拟目录,如:_vti_bin、IISSamples、Scripts、IIShelp、IISAdmin、IIShelp、MSADC.<br>4.删除不必要的IIS扩展名映射.<br>右键单击”默认Web站点→属性→主目录→配置”,打开应用程序窗口,去掉不必要的应用程序映射.主要为.shtml、.shtm、 .stm.<br>5.更改IIS日志的路径<br>右键单击”默认Web站点→属性-网站-在启用日志记录下点击属性<br>6.如果使用的是2000可以使用iislockdown来保护IIS,在2003运行的IE6.0的版本不需要.</p>
<p>五、ASP的安全</p>
<p>在IIS系统上,大部分木马都是ASP写的,因此,ASP组件的安全是非常重要的.<br>ASP木马实际上大部分通过调用Shell.Application、WScript.Shell、WScript.Network、FSO、Adodb.Stream组件来实现其功能,除了FSO之外,其他的大多可以直接禁用.<br>WScript.Shell组件使用这个命令删除:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">regsvr32 <span class="module-access"><span class="module"><span class="identifier">WSHom</span>.</span></span>ocx /u</span><br></pre></td></tr></table></figure>

<p>WScript.Network组件使用这个命令删除:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">regsvr32 wshom.ocx <span class="string">/u</span></span><br></pre></td></tr></table></figure>

<p>Shell.Application可以使用禁止Guest用户使用shell32.dll来防止调用此组件.使用命令:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">cacls C:<span class="symbol">\W</span>INNT<span class="symbol">\s</span>ystem32<span class="symbol">\s</span>hell32.dll /e /d guests</span><br></pre></td></tr></table></figure>

<p>禁止guests用户执行cmd.exe的命令是:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">cacls C:<span class="symbol">\W</span>INNT<span class="symbol">\s</span>ystem32<span class="symbol">\C</span>md.exe /e /d guests</span><br></pre></td></tr></table></figure>

<p>FSO组件的禁用比较麻烦,如果网站本身不需要用这个组件,那么就通过:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">RegSrv32 scrrun.dll <span class="string">/u</span></span><br></pre></td></tr></table></figure>

<p>命令来禁用吧.<br>或者<br>第一种:用:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">RegSrv32 /u C:<span class="symbol">\W</span>INDOWS<span class="symbol">\S</span>YSTEM<span class="symbol">\s</span>crrun.dll</span><br></pre></td></tr></table></figure>

<p>来注销该组件.此方法过于狠毒,属于同归于尽的方法,大家都没得用,是下招.<br>第二种:修改Progid的值,在ASP里调用组件的方式通常是:</p>
<figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Set</span> 对象名=<span class="built_in">Server</span>. <span class="built_in">CreateObject</span>(<span class="string">&quot;Progid&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这时候我们就可以通过修改注册表中的Progid值从达到禁用该组件的方法.在 开始-运行中敲入regedit,然后找到 <code>HKEY_CLASSES_ROO T\Scripting.FileSystemObject</code>,这时候我们就可以更改该Progid的值了,如改成 <code>Scripting.FileSystemObject8</code>.这样在ASP页里就这样调用了:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;%@ <span class="attribute">Language</span>=Vbscript%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="builtin-name">Set</span> <span class="attribute">Fs</span>=Server.CreateObject(&quot;Scripting.FileSystemObject8&quot;)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>(如果你前面没有调用过该组件的话,则无须重启,就可以看到效果了,否则请重启后看效果.)<br>这时候我们看看还是用原来的调用方法的结果:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;%@ <span class="attribute">Language</span>=Vbscript%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="builtin-name">Set</span> <span class="attribute">Fs</span>=Server.CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>这时候的运行结果为:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">服务器对象 错误 &#x27;ASP <span class="number">0177</span> : <span class="number">800401</span>f3&#x27;</span><br><span class="line">Server.CreateObject 失败</span><br><span class="line">/aspimage/testfile2.asp, 行<span class="number">3</span></span><br><span class="line"><span class="number">800401</span>f3</span><br></pre></td></tr></table></figure>

<p>(OK,达到我们的要求)<br>该方法由于本人迟了两步,结果就让别人抢着回答了,这样极大的刺激了我,结果就产生了第三种方法.<br>第三种:细心的高手们会想,既然能通过修改Progid值来禁用该组件,那Clsid是否也可以来修改呢?(OK,你想得和我一样)我们知道,除了CreateObject方法以外,也可以使用一般的<code>&lt;object&gt;</code>标注建立一个组件,我们可以在ASP里面使用HTM L的<code>&lt;object&gt;</code>标注,以便在网页中加入一个组件.方法是:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;object <span class="attribute">runat</span>=server <span class="attribute">id</span>=fs1 <span class="attribute">scope</span>=page <span class="attribute">progid</span>=<span class="string">&quot;Scripting.FileSystemObject&quot;</span>&gt;&lt;/object&gt;</span><br></pre></td></tr></table></figure>

<p>Runat表示是在服务端执行,Scope表示组件的生命周期,可以选用Session,Appl ication或page(表示当前页面,也可缺省)<br>这种写法对我们没用,还有一种写法是:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;object <span class="attribute">runat</span>=server <span class="attribute">id</span>=fs1 <span class="attribute">scope</span>=page <span class="attribute">classid</span>=<span class="string">&quot;clsid:clsid的值&quot;</span>&gt;&lt;/object&gt;</span><br></pre></td></tr></table></figure>

<p>我们也可以通过修改该Clsid的值而禁用该组件,如将注册表中 <code>HKEY_CLASSES_RO OT\Scripting.FileSystemObject\CLSID</code>的值0D43FE01-F093-11CF-8940-00A0C90 54228改成0D43FE01-F093-11CF-8940-00A0C9054229(改了最后面一位),这时候的写法为:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;object <span class="attribute">runat</span>=server <span class="attribute">id</span>=fs1 <span class="attribute">scope</span>=page <span class="attribute">classid</span>=<span class="string">&quot;clsid:0D43FE01-F093-11CF-8940-00A0C9054229&quot;</span>&gt;&lt;/object&gt;</span><br></pre></td></tr></table></figure>

<p>看运行结果,没问题,OK.这时候我们再用</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;object <span class="attribute">runat</span>=server <span class="attribute">id</span>=fs1 <span class="attribute">scope</span>=page <span class="attribute">classid</span>=<span class="string">&quot;clsid:0D43FE01-F093-11CF-8940-00A0C9054228&quot;</span>&gt;&lt;/object&gt;</span><br></pre></td></tr></table></figure>

<p>这时候就出错了.(<br>另外,使用微软提供的URLScan Tool这个过滤非法URL访问的工具,也可以起到一定防范作用.当然,每天备份也是一个好习惯.</p>
<p>八、其它</p>
<p>1.系统升级、打操作系统补丁,尤其是IIS 6.0补丁、SQL SP3a补丁,甚至IE 6.0补丁也要打.同时及时跟踪最新漏洞补丁;<br>2.停掉Guest 帐号、并给guest 加一个异常复杂的密码,把Administrator改名或伪装!<br>3.隐藏重要文件/目录<br>可以修改注册表实现完全隐藏:H <code>KEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\ Current-Version\Explorer\Advanced\Folder\Hi-dden\SHOWALL</code>,鼠标右击 “CheckedValue”,选择修改,把数值由1改为0.<br>4.启动系统自带的Internet连接防火墙,在设置服务选项中勾选Web服务器.<br>5.防止SYN洪水攻击.</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE<span class="symbol">\S</span>YSTEM<span class="symbol">\C</span>urrentControlSet<span class="symbol">\S</span>ervices<span class="symbol">\T</span>cpip<span class="symbol">\P</span>arameters</span><br><span class="line">#新建DWORD值,名为SynAttackProtect,值为2</span><br></pre></td></tr></table></figure>

<p>6.禁止响应ICMP路由通告报文</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE <span class="symbol">\ </span>SYSTEM <span class="symbol">\ </span>CurrentControlSet<span class="symbol">\ </span>Services<span class="symbol">\T</span>cpip<span class="symbol">\P</span>arameters<span class="symbol">\I</span>nterfaces<span class="symbol">\i</span>nterface</span><br><span class="line">#新建DWORD值,名为PerformRouterDiscovery 值为0.</span><br></pre></td></tr></table></figure>

<p>7.防止ICMP重定向报文的攻击</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE<span class="symbol">\S</span>YSTEM<span class="symbol">\C</span>urrentControlSet<span class="symbol">\S</span>ervices<span class="symbol">\T</span>cpip<span class="symbol">\P</span>arameters</span><br><span class="line">#将EnableICMPRedirects 值设为0</span><br></pre></td></tr></table></figure>

<p>8.不支持IGMP协议</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE<span class="symbol">\S</span>YSTEM<span class="symbol">\C</span>urrentControlSet<span class="symbol">\S</span>ervices<span class="symbol">\T</span>cpip<span class="symbol">\P</span>arameters</span><br><span class="line">#新建DWORD值,名为IGMPLevel 值为0.</span><br></pre></td></tr></table></figure>

<p>9.禁用DCOM:<br>运行中输入Dcomcnfg.exe.回车,单击”控制台根节点”下的”组件服务”.打开”计算机”子文件夹.</p>
]]></content>
  </entry>
  <entry>
    <title>服务器连通性测试小程序</title>
    <url>/2021/01/07/1432/</url>
    <content><![CDATA[<p>可以测试到某个服务器的某个端口的连通性。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"><span class="selector-id">#-</span>*-coding:GBK -*- </span><br><span class="line"> </span><br><span class="line">import socket,sys,time,os,signal</span><br><span class="line">from ping3 import ping</span><br><span class="line">result = []</span><br><span class="line">def <span class="built_in">Seeyon_write</span>(result):</span><br><span class="line">    filename = <span class="string">&#x27;result.txt&#x27;</span></span><br><span class="line">    with <span class="built_in">open</span>(filename, <span class="string">&#x27;a+&#x27;</span>) as file_object:</span><br><span class="line">        file_object.<span class="built_in">write</span>(<span class="built_in">str</span>(time.<span class="built_in">asctime</span>( time.<span class="built_in">localtime</span>(time.<span class="built_in">time</span>()) ))+result)</span><br><span class="line">        file_object.<span class="built_in">close</span>()</span><br><span class="line">def <span class="built_in">Seeyon_Con</span>():</span><br><span class="line">    Seeyon_sk=socket.<span class="built_in">socket</span>(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    Seeyon_Result=Seeyon_sk.<span class="built_in">connect_ex</span>((<span class="string">&#x27;59.197.224.47&#x27;</span>,<span class="number">80</span>))</span><br><span class="line">    if Seeyon_Result == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">Seeyon_write</span>(<span class="string">&#x27; Port is Open! \n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(time.<span class="built_in">asctime</span>( time.<span class="built_in">localtime</span>(time.<span class="built_in">time</span>()) ))+<span class="string">&#x27; Port is Open!&#x27;</span>)</span><br><span class="line">        result.<span class="built_in">append</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    else:</span><br><span class="line">        <span class="built_in">Seeyon_write</span>(<span class="string">&#x27; Port is Not Open! \n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(time.<span class="built_in">asctime</span>( time.<span class="built_in">localtime</span>(time.<span class="built_in">time</span>()) ))+<span class="string">&#x27; Port is Open!&#x27;</span>)</span><br><span class="line">        result.<span class="built_in">append</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">def <span class="built_in">Seeyon_exit</span>(signum, frame):</span><br><span class="line">    <span class="built_in">Seeyon_write</span>(<span class="string">&#x27;成功:&#x27;</span>+<span class="built_in">str</span>(result.<span class="built_in">count</span>(<span class="string">&#x27;1&#x27;</span>))+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;失败:&#x27;</span>+<span class="built_in">str</span>(result.<span class="built_in">count</span>(<span class="string">&#x27;2&#x27;</span>)) +<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27; 成功:&#x27;</span>+<span class="built_in">str</span>(result.<span class="built_in">count</span>(<span class="string">&#x27;1&#x27;</span>))+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;失败:&#x27;</span>+<span class="built_in">str</span>(result.<span class="built_in">count</span>(<span class="string">&#x27;2&#x27;</span>)))</span><br><span class="line">    sys.<span class="built_in">exit</span>(<span class="number">0</span>)</span><br><span class="line">def <span class="built_in">Seeyon_ping</span>(ip_address):</span><br><span class="line">    response = <span class="built_in">ping</span>(ip_address)</span><br><span class="line">    if response is not None:</span><br><span class="line">        delay = <span class="built_in">int</span>(response * <span class="number">1000</span>)</span><br><span class="line">        <span class="built_in">Seeyon_write</span>(<span class="string">&#x27;连接延时:&#x27;</span>+<span class="built_in">str</span>(delay)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        print (<span class="string">&#x27;连接延时:&#x27;</span>+<span class="built_in">str</span>(delay)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">if __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    print (<span class="string">&#x27;\n开始测试本机到59.197.224.47的80端口的连通性:\n&#x27;</span>)</span><br><span class="line">    signal.<span class="built_in">signal</span>(signal.SIGINT, Seeyon_exit)</span><br><span class="line">    signal.<span class="built_in">signal</span>(signal.SIGTERM, Seeyon_exit)</span><br><span class="line">    while True:</span><br><span class="line">        <span class="built_in">Seeyon_Con</span>()</span><br><span class="line">        <span class="built_in">Seeyon_ping</span>(<span class="string">&#x27;59.197.224.47&#x27;</span>)</span><br><span class="line">        time.<span class="built_in">sleep</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>推荐python3运行。</p>
]]></content>
  </entry>
  <entry>
    <title>访问内网智能路由器</title>
    <url>/2015/06/08/1430/</url>
    <content><![CDATA[<p>SSH反向连接及Autossh</p>
<p>0.接触Linux恐怕对SSH再熟悉不过了,还有scp,sftp各种方便的功能,一般的使用都需要ip:port(如果不是默认22的话),但有些情况比较特殊,就是想连接一台内网主机(比如公司内网,当然你肯定做不了Port Forwarding,除非你想在公司防火墙上拆个洞).稍懂一点网络的童鞋会明白,Internet上去主动连接一台内网是不可能的,一般的解决方案分两种,一种是端口映射(Port Forwarding),将内网主机的某个端口Open出防火墙,相当于两个外网主机通信;另一种是内网主机主动连接到外网主机,又被称作反向连接(Reverse Connection),这样NAT路由/防火墙就会在内网主机和外网主机之间建立映射,自然可以相互通信了.但是,这种映射是NAT路由自动维持的,不会持续下去,如果连接断开或者网络不稳定都会导致通信失败,这时内网主机需要再次主动连接到外网主机,建立连接.</p>
<p>1.理论的介绍完了,下面实际操作:</p>
<p>A要控制B:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">A</span>主机:外网,ip:<span class="number">123.123.123.123</span>,sshd端口:<span class="number">2221</span></span><br><span class="line"><span class="attribute">B</span>主机:内网,sshd端口:<span class="number">2223</span></span><br></pre></td></tr></table></figure>

<p>无论是外网主机A,还是内网主机B都需要跑ssh daemon.</p>
<p>1.1.首先在B上执行:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -NfR <span class="number">1234</span><span class="symbol">:localhost</span><span class="symbol">:</span><span class="number">2223</span> user1<span class="variable">@123</span>.<span class="number">123.123</span>.<span class="number">123</span> -p2221</span><br></pre></td></tr></table></figure>

<p>这句话的意思是将A主机的1234端口和B主机的2223端口绑定,相当于远程端口映射(Remote Port Forwarding).<br>这里每次需要输入A主机user1的登陆密码,后面会讲到解决办法.</p>
<p>1.2.这时在A主机上sshd会listen本地1234端口:</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">$ ss -ant</span><br><span class="line"></span><br><span class="line">State Recv-Q <span class="built_in">Send</span>-Q <span class="keyword">Local</span> Address:Port Peer Address:Port</span><br><span class="line">LISTEN <span class="number">0</span> <span class="number">128</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1234</span> *:*</span><br></pre></td></tr></table></figure>

<p>1.3.像平时一样连接到A主机的1234端口就可以控制内网B主机了:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh localhost -p1234</span><br></pre></td></tr></table></figure>

<p>2.一开始提到,这种反向连接(Reverse Connection)不稳定,可能随时断开,需要内网主机B再次向外网A发起连接,这时需要个”朋友”帮你在内网B主机执行这条命令.它就是Autossh.<br>在此之前还要解决之前的一个问题,那就是每次内网主机B连接外网主机A时都需要输入密码,这个问题ssh本身是提供另外一种验证方式——通过密钥验证用户身份,实现自动登录.</p>
<p>2.1.在内网B主机上生产公钥和私钥:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen</span><br><span class="line">...(一直按Enter,最后在~<span class="regexp">/.ssh/</span>下生成密钥)</span><br><span class="line">$ ls ~<span class="regexp">/.ssh/</span></span><br><span class="line">id_rsa id_rsa.pub known_hosts</span><br></pre></td></tr></table></figure>

<p>2.2.复制B主机上生成的id_rsa.pub公钥到外网A主机上,并将内容加入到~/.ssh/authorized_keys中:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">$ cat id_rsa.pub &gt;&gt; ~<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure>

<p>试下,内网B主机连接外网A主机,就不再输入密码验证了.<br>补充:今天了解到ssh-copy-id这个命令,上面这个操作就变的简单了.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ ssh-<span class="keyword">copy</span>-<span class="built_in">id</span> user1@<span class="number">123.123</span><span class="number">.123</span><span class="number">.123</span></span><br></pre></td></tr></table></figure>

<p>2.3.再来看看Autossh的用法:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>autossh -M <span class="number">5678</span> -NR <span class="number">1234</span><span class="symbol">:localhost</span><span class="symbol">:</span><span class="number">2223</span> user1<span class="variable">@123</span>.<span class="number">123.123</span>.<span class="number">123</span> -p2221</span><br></pre></td></tr></table></figure>

<p>比之前的命令添加的一个-M 5678参数,负责通过5678端口监视连接状态,连接有问题时就会自动重连,去掉了一个-f参数,因为autossh本身就会在background运行.</p>
<p>3.终极方案:当重启内网B主机,谁来自动Autossh呢,加入daemon吧.</p>
<p>以daemon方式执行,相当于root去执行autossh, ssh,这时刚才普通用户目录下的.ssh/authorized_keys文件会不起效.有两种办法解决,一种是用autossh的参数指定.ssh路径;另外一种是以普通用户身份执行daemon,下面是第二种方式.</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">/bin/su -c &#x27;/usr/bin/autossh -M <span class="number">5678</span> -NR <span class="number">1234</span>:localhost:<span class="number">2223</span> user1@123.123.123.123 -p<span class="number">2221</span>&#x27; - user1</span><br></pre></td></tr></table></figure>

<p>autossh还有很多参数,用来设置重连间隔等等.<br>将上面命令放入下面各启动方式中,根据自己系统自己配置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">SysV:<span class="regexp">/etc/i</span>nid.d/autossh</span><br><span class="line">Upstart: <span class="regexp">/etc/i</span>nit/autossh.conf</span><br><span class="line">systemd: <span class="regexp">/usr/</span>lib<span class="regexp">/systemd/</span>system/autossh.service</span><br></pre></td></tr></table></figure>

<p>A主机用socat实现端口映射.<br>A主机上执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">socat</span> TCP<span class="number">4</span>-LISTEN:<span class="number">22222</span>,reuseaddr,fork TCP<span class="number">4</span>:<span class="number">127.0.0.1:1234</span></span><br></pre></td></tr></table></figure>

<p>这样,访问 vpsip:1234 就相当于连接上路由器的2223端口了.</p>
]]></content>
  </entry>
  <entry>
    <title>根据list元素包含某个字符的多少对list排序</title>
    <url>/2019/07/11/1433/</url>
    <content><![CDATA[<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">a=[<span class="string">&#x27;/&#x27;</span>,<span class="string">&#x27;/aass/dda&#x27;</span>,<span class="string">&#x27;/sdfsdf/dsfs/aa/s&#x27;</span>,<span class="string">&#x27;/s&#x27;</span>,<span class="string">&#x27;/sdf/fd/sdf/f/dsf/sdf/sdf/sd/fs/d&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> takeSecond(elem):</span><br><span class="line">    elem.<span class="keyword">count</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">a.<span class="keyword">sort</span>(key=takeSecond)</span><br><span class="line"><span class="keyword">print</span> (a)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>更改ssh用户根目录</title>
    <url>/2016/04/21/1434/</url>
    <content><![CDATA[<p>安装jailkit:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">wget http:<span class="regexp">//</span>olivier.sessink.nl<span class="regexp">/jailkit/</span>jailkit-<span class="number">2.16</span>.tar.gz</span><br><span class="line">tar xzf jailkit-<span class="number">2.16</span>.tar.gz</span><br><span class="line">cd jailkit-<span class="number">2.16</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">cp extra<span class="regexp">/jailkit /</span>etc<span class="regexp">/init.d/</span>jailkit</span><br><span class="line">chmod u+x <span class="regexp">/etc/i</span>nit.d/jailkit</span><br><span class="line">chkconfig jailkit on</span><br></pre></td></tr></table></figure>

<p>初始化chroot环境:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">jk_init -v -j <span class="regexp">/home/</span>chroot sftp scp jk_lsh netutils extendedshell</span><br><span class="line">service jailkit start</span><br></pre></td></tr></table></figure>

<p>新建wang用户:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">useradd wang -m</span><br><span class="line">echo www.centos.bz:password <span class="string">| chpasswd</span></span><br></pre></td></tr></table></figure>

<p>chroot用户:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">jk_jailuser -m -n -j <span class="regexp">/home/</span>chroot --shell=<span class="regexp">/bin/</span>bash wang</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>共享目录的重新登陆</title>
    <url>/2013/10/21/1435/</url>
    <content><![CDATA[<p>我们办公室内部架设了 samba 服务器,用于存放共享文件.共享目录有两个密码,一个是只读的,一个是读写的.为了方便,一直是让 windows 记住密码.我负责维护一些文件,所以自然是读写密码.</p>
<p>前几天,公司内部网络调整,我们办公室被换了网段.自然,共享目录进不去了.时间太久,只能去翻笔记本找回当初的密码.一不小心,让 windows 记住了只读密码,居然找不到怎么注销了.</p>
<p>找了好久,才发现注销的位置在,控制面板——用户帐户——左上角有一个管理我的网络密码.删除掉密码后,依然发现问题没有解决,然后在 console 下输入 net use 发现连接还在,用 <code>net use /delete</code> 后问题解决了.</p>
]]></content>
  </entry>
  <entry>
    <title>关闭135危险端口</title>
    <url>/2014/11/03/1436/</url>
    <content><![CDATA[<p>运行dcomcnfg,展开”组件服务”→”计算机”,在”我的电脑”上点右键选”属性”,切换到”默认属性”,取消”启用分布式COM”;然后切换到”默认协议”,删除”面向连接的TCP/IP”.</p>
<p>以上选项有对应的注册表键值,因此也可通过注册表来修改:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\M</span>icrosoft<span class="symbol">\O</span>le<span class="symbol">\E</span>nableDCOM的值改为&quot;N&quot;</span><br><span class="line">HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\M</span>icrosoft<span class="symbol">\R</span>pc<span class="symbol">\D</span>COM Protocols 中删除&quot;ncacn_ip_tcp&quot;</span><br></pre></td></tr></table></figure>

<p>此外,还需要停用”Distributed Transaction Coordinator”服务.</p>
<p>重启之后,135端口就没有了.</p>
]]></content>
  </entry>
  <entry>
    <title>关闭mysql bin日志</title>
    <url>/2011/10/18/1440/</url>
    <content><![CDATA[<p>编辑my.cnf.把里面的log-bin这一行注释掉.<br>进入 <code>/usr/local/mysql/var/</code>:<br>删除mysql-bin.000001 类似的文件.</p>
]]></content>
  </entry>
  <entry>
    <title>关闭137,138,139危险端口</title>
    <url>/2014/08/18/1437/</url>
    <content><![CDATA[<p>开始－设置－网络和拨号连接－本地连接－TCP/IP属性－高级－WINS－选’禁用TCP/IT上的NETBIOS’.<br>查看当前打开的端口可以用 开始－&gt;运行－&gt;cmd 运行netstat -na ,你改完以后用这个命令看一下,这3个端口应该关了,不影响使用的.</p>
]]></content>
  </entry>
  <entry>
    <title>关于centos的portmap和rpcbind</title>
    <url>/2012/05/25/1442/</url>
    <content><![CDATA[<p>centos下使用yum install portmap会自动安装rpcbind,<br>其实他们的功能是一样的,搭建NFS服务器直接启用rpcbind也是可以的.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service rpcbind <span class="literal">start</span></span><br><span class="line">service nfs <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>照不到portmap不用着急了,用rpcbind吧.</p>
]]></content>
  </entry>
  <entry>
    <title>关闭CENTOS不必要的默认服务</title>
    <url>/2017/07/31/1438/</url>
    <content><![CDATA[<p>关闭服务启动命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> –level <span class="number">2345</span> 服务名称 <span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>系统服务说明:</p>
<table width="814" border="0" cellspacing="1" cellpadding="0">
<tbody>
<tr>
<td><strong>服務名稱</strong></td>
<td><strong>建議</strong></td>
<td><strong>說明</strong></td>
</tr>
<tr>
<td>acpid</td>
<td>停用</td>
<td>Advanced Configuration and Power Interface 電源進階設定,常用在 Laptop 上</td>
</tr>
<tr>
<td>apmd</td>
<td>停用</td>
<td>Adventage Power Management daemon 偵測系統的電池電量,常用在 Laptop 上</td>
</tr>
<tr>
<td>atd</td>
<td>停用</td>
<td>/etc/at.allow,/etc/at.deny 我大概都使用 crond 來達成</td>
</tr>
<tr>
<td>autofs</td>
<td>停用</td>
<td>自動掛載檔案系統與週邊裝置 (如光碟、USB),常用在 Laptop 上</td>
</tr>
<tr>
<td>avahi-daemon</td>
<td>停用</td>
<td>當區網沒有 DNS 服務時會試著尋找提供 zeroconf 協定的主機</td>
</tr>
<tr>
<td>bluetooth</td>
<td>停用</td>
<td>Bluetooth 藍芽,常用在 Laptop 上</td>
</tr>
<tr>
<td>cpuspeed</td>
<td>停用</td>
<td>控制 CPU 速度主要用來省電,常用在 Laptop 上</td>
</tr>
<tr>
<td>cups</td>
<td>停用</td>
<td>Common UNIX Printing System 使系統支援印表機</td>
</tr>
<tr>
<td>firstboot</td>
<td>停用</td>
<td>安裝完成後第一次啟動時的服務,設定 auth、firewall、keyboard…</td>
</tr>
<tr>
<td>gpm</td>
<td>停用</td>
<td>記錄週邊裝置的檔案資料,例如文字模式下可使用滑鼠</td>
</tr>
<tr>
<td>haldaemon</td>
<td>停用</td>
<td>使系統支援 plug and play 裝置</td>
</tr>
<tr>
<td>hidd</td>
<td>停用</td>
<td>使系統支援藍芽裝置,例如滑鼠,鍵盤</td>
</tr>
<tr>
<td>hplip</td>
<td>停用</td>
<td>使系統支援 HP 相關型號印表機</td>
</tr>
<tr>
<td>ip6tables</td>
<td>停用</td>
<td>使系統支援 IPTables Filrewall IPv6</td>
</tr>
<tr>
<td>isdn</td>
<td>停用</td>
<td>使系統支援 Integrated Services Digital Network (ISDN) 環境</td>
</tr>
<tr>
<td>lm_sensors</td>
<td>停用</td>
<td>使系統支援偵測主機版或硬體,常用在 Laptop 上</td>
</tr>
<tr>
<td>messagebus</td>
<td>停用</td>
<td>使系統支援 plug and play 裝置</td>
</tr>
<tr>
<td>nfslock</td>
<td>停用</td>
<td>使系統支援 NFS Server 資料一致性功能</td>
</tr>
<tr>
<td>pcscd</td>
<td>停用</td>
<td>使系統支援 Smart Card</td>
</tr>
<tr>
<td>portmap</td>
<td>停用</td>
<td>使系統支援 NFS Service</td>
</tr>
<tr>
<td>rpcgssd</td>
<td>停用</td>
<td>使系統支援 NFSv4 Service</td>
</tr>
<tr>
<td>rpcidmapd</td>
<td>停用</td>
<td>使系統支援 NFSv4 Service</td>
</tr>
<tr>
<td>yum-updatesd</td>
<td>停用</td>
<td>使系統支援 YUM 自動更新服務 (上線機器還是先確認好再更新)</td>
</tr>
<tr>
<td colspan="4"></td>
</tr>
<tr>
<td>anacron</td>
<td>視個人需求</td>
<td>執行在 crontab 設定的時間沒有執行到的工作</td>
</tr>
<tr>
<td>auditd</td>
<td>視個人需求</td>
<td>稽核系統 /var/log/audit/audit.log,若 auditd 未執行中則稽核訊息會寫入 /var/log/messages</td>
</tr>
<tr>
<td>iptables</td>
<td>視個人需求</td>
<td>使系統支援 IPTables Filrewall</td>
</tr>
<tr>
<td>irqbalance</td>
<td>視個人需求</td>
<td>使系統支援多個 CPU 環境當系統中斷請求時進行負載平衡的程序,所以單 CPU 的機器就不需要</td>
</tr>
<tr>
<td>lvm2-monitor</td>
<td>視個人需求</td>
<td>使系統支援 Logical Volume Manager 邏輯磁區</td>
</tr>
<tr>
<td>mcstrans</td>
<td>視個人需求</td>
<td>主要用於配合 SELinux 服務</td>
</tr>
<tr>
<td>mdmonitor</td>
<td>視個人需求</td>
<td>使系統支援 RAID 相關程序</td>
</tr>
<tr>
<td>microcode_ctl</td>
<td>視個人需求</td>
<td>使系統支援 Intel IA32 CPU 特色,所以 AMD CPU 不需要</td>
</tr>
<tr>
<td>netfs</td>
<td>視個人需求</td>
<td>Network File System Mounter 網路掛載系統</td>
</tr>
<tr>
<td>restorecond</td>
<td>視個人需求</td>
<td>使系統支援 SELinux 監控檔案狀態</td>
</tr>
<tr>
<td>smartd</td>
<td>視個人需求</td>
<td>使系統支援檢查硬碟狀態 (Hardware RAID 要改設定檔)</td>
</tr>
<tr>
<td>sendmail</td>
<td>視個人需求</td>
<td>使系統支援 Sendmail</td>
</tr>
<tr>
<td>xfs</td>
<td>視個人需求</td>
<td>使系統支援 X Window 字型</td>
</tr>
<tr>
<td colspan="4"></td>
</tr>
<tr>
<td>crond</td>
<td>啟動</td>
<td>/etc/cron.* 排程服務</td>
</tr>
<tr>
<td>kudzu</td>
<td>啟動</td>
<td>使系統每次開機會都自動執行硬體偵測</td>
</tr>
<tr>
<td>network</td>
<td>啟動</td>
<td>使系統支援網卡</td>
</tr>
<tr>
<td>readahead_early</td>
<td>啟動</td>
<td>使系統再啟動時預先將相關檔案讀到記憶體內來加快啟動速度</td>
</tr>
<tr>
<td>sshd</td>
<td>啟動</td>
<td>使系統支援 SSH Service</td>
</tr>
<tr>
<td>syslog</td>
<td>啟動</td>
<td>使系統支援 System Log Service</td>
</tr>
</tbody>
</table>

<p>CentOS5.5 默认基本服务详解:</p>
<table width="100%" border="0" cellspacing="1" cellpadding="0">
<tbody>
<tr>
<td><strong>服务名称</strong></td>
<td><strong>功能</strong></td>
<td><strong>默认</strong></td>
<td><strong>建议</strong></td>
<td><strong>备注</strong></td>
</tr>
<tr>
<td>NetworkManager</td>
<td>用于自动连接网络</td>
<td>关闭</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>acpid</td>
<td>电源的开关等检测管理</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>anacron</td>
<td>一种计划任务管理</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>apmd</td>
<td>高级电源管理</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>atd</td>
<td>在指定时间执行命令</td>
<td>开启</td>
<td>关闭</td>
<td>如果用crond,则可关闭它</td>
</tr>
<tr>
<td>auditd</td>
<td></td>
<td>开启</td>
<td>自定</td>
<td>如果用selinux,需要开启它</td>
</tr>
<tr>
<td>autofs</td>
<td>文件系统自动加载、卸载</td>
<td>开启</td>
<td>自定</td>
<td>只在需要时开启它,可以停止</td>
</tr>
<tr>
<td>avahi-daemon</td>
<td>本地网络服务查找</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>avahi-dnsconfd</td>
<td>avahi DNS</td>
<td>关闭</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>bluetooth</td>
<td>蓝牙无线通信</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>conman</td>
<td>控制台管理</td>
<td>关闭</td>
<td>关闭</td>
<td>没用</td>
</tr>
<tr>
<td>spuspeed</td>
<td>调节cpu速度</td>
<td>开启</td>
<td>自定</td>
<td></td>
</tr>
<tr>
<td>crond</td>
<td>计划任务管理</td>
<td>开启</td>
<td>开启</td>
<td>很有用,开启</td>
</tr>
<tr>
<td>cups</td>
<td>通用unix打印服务</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>dnsmasq</td>
<td>dns cache</td>
<td>关闭</td>
<td>关闭</td>
<td>没用</td>
</tr>
<tr>
<td>dund</td>
<td>蓝牙相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>firstboot</td>
<td>系统安装后初始设定</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>gpm</td>
<td>控制台下的鼠标支持</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>haldaemon</td>
<td>硬件信息收集服务</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>hidd</td>
<td>蓝牙相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ibmasm</td>
<td>ibm硬件管理</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ip6tables</td>
<td>ipv6防火墙</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>iptables</td>
<td>ipv4防火墙</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>irda</td>
<td>红外线通信</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>irqbalance</td>
<td>cpu负载均衡</td>
<td>开启</td>
<td>自定</td>
<td>多核cup需要</td>
</tr>
<tr>
<td>kudzu</td>
<td>硬件变动检测</td>
<td>开启</td>
<td>关闭</td>
<td>服务器无用</td>
</tr>
<tr>
<td>lvm2-monitor</td>
<td>lvm监视</td>
<td>开启</td>
<td>关闭</td>
<td>非集群无用</td>
</tr>
<tr>
<td>mcstrans</td>
<td>在开启selinux时用于检查context</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>mdmonitor</td>
<td>软raid监视</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>mdmpd</td>
<td>软raid管理</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>messagebus</td>
<td>负责在各个系统进程之间传递消息</td>
<td>开启</td>
<td>开启</td>
<td>如停用,haldaemon启动会失败</td>
</tr>
<tr>
<td>microcode_ctl</td>
<td>?cpu微码管理升级</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>multipathd</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netconsole</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netfs</td>
<td>nfs相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netplugd</td>
<td>网线热插拔监视</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>network</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>nfs</td>
<td>网络文件系统</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>nfslock</td>
<td>nfs相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>nscd</td>
<td>name cache,应该与DNS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>oddjobd</td>
<td>与D-BUS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>pand</td>
<td>蓝牙相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>pcscd</td>
<td>pc/sc smart card daemon</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>portmap</td>
<td>使用NFS、NIS时的port map</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>psacct</td>
<td>负荷检测</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rawdevices</td>
<td>raw 设备支持</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>rdisc</td>
<td>自动检测路由器</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>readahead_early</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>readahead_later</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>restorecond</td>
<td>selinux相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rpcgssd</td>
<td>NFS相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rpcidmapd</td>
<td>RPC name to UID/GID mapper</td>
<td>开启</td>
<td>关闭</td>
<td>NFS相关</td>
</tr>
<tr>
<td>rpcsvcgssd</td>
<td>NFS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>saslauthd</td>
<td>sasl认证服务相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>sendmail</td>
<td></td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>smartd</td>
<td>硬盘自动检测守护进程</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>sshd</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>syslog</td>
<td>系统日志进程</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>tcsd</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>wpa_supplicant</td>
<td>无线认证相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>xfs</td>
<td>x windows相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ypbind</td>
<td>network information service客户端</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>yum-updatesd</td>
<td>yum自动升级</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器开启比较危险哦</td>
</tr>
</tbody>
</table>]]></content>
  </entry>
  <entry>
    <title>关闭和重启pureftpd</title>
    <url>/2011/12/21/1441/</url>
    <content><![CDATA[<p>暂时好像没有发现能关闭这个ftp软件的命令,但是应该是有的,但是我没有找到.<br>没有办法只能killall了 .</p>
<pre><code>killall pure-ftpd
</code></pre>
<p>启动的命令前面的文章有,这里就不写了.</p>
]]></content>
  </entry>
  <entry>
    <title>关闭CENTOS不必要的默认服务</title>
    <url>/2017/07/31/1439/</url>
    <content><![CDATA[<p>关闭服务启动命令:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> –level <span class="number">2345</span> 服务名称 <span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>系统服务说明:</p>
<table width="814" border="0" cellspacing="1" cellpadding="0">
<tbody>
<tr>
<td><strong>服務名稱</strong></td>
<td><strong>建議</strong></td>
<td><strong>說明</strong></td>
</tr>
<tr>
<td>acpid</td>
<td>停用</td>
<td>Advanced Configuration and Power Interface 電源進階設定,常用在 Laptop 上</td>
</tr>
<tr>
<td>apmd</td>
<td>停用</td>
<td>Adventage Power Management daemon 偵測系統的電池電量,常用在 Laptop 上</td>
</tr>
<tr>
<td>atd</td>
<td>停用</td>
<td>/etc/at.allow,/etc/at.deny 我大概都使用 crond 來達成</td>
</tr>
<tr>
<td>autofs</td>
<td>停用</td>
<td>自動掛載檔案系統與週邊裝置 (如光碟、USB),常用在 Laptop 上</td>
</tr>
<tr>
<td>avahi-daemon</td>
<td>停用</td>
<td>當區網沒有 DNS 服務時會試著尋找提供 zeroconf 協定的主機</td>
</tr>
<tr>
<td>bluetooth</td>
<td>停用</td>
<td>Bluetooth 藍芽,常用在 Laptop 上</td>
</tr>
<tr>
<td>cpuspeed</td>
<td>停用</td>
<td>控制 CPU 速度主要用來省電,常用在 Laptop 上</td>
</tr>
<tr>
<td>cups</td>
<td>停用</td>
<td>Common UNIX Printing System 使系統支援印表機</td>
</tr>
<tr>
<td>firstboot</td>
<td>停用</td>
<td>安裝完成後第一次啟動時的服務,設定 auth、firewall、keyboard…</td>
</tr>
<tr>
<td>gpm</td>
<td>停用</td>
<td>記錄週邊裝置的檔案資料,例如文字模式下可使用滑鼠</td>
</tr>
<tr>
<td>haldaemon</td>
<td>停用</td>
<td>使系統支援 plug and play 裝置</td>
</tr>
<tr>
<td>hidd</td>
<td>停用</td>
<td>使系統支援藍芽裝置,例如滑鼠,鍵盤</td>
</tr>
<tr>
<td>hplip</td>
<td>停用</td>
<td>使系統支援 HP 相關型號印表機</td>
</tr>
<tr>
<td>ip6tables</td>
<td>停用</td>
<td>使系統支援 IPTables Filrewall IPv6</td>
</tr>
<tr>
<td>isdn</td>
<td>停用</td>
<td>使系統支援 Integrated Services Digital Network (ISDN) 環境</td>
</tr>
<tr>
<td>lm_sensors</td>
<td>停用</td>
<td>使系統支援偵測主機版或硬體,常用在 Laptop 上</td>
</tr>
<tr>
<td>messagebus</td>
<td>停用</td>
<td>使系統支援 plug and play 裝置</td>
</tr>
<tr>
<td>nfslock</td>
<td>停用</td>
<td>使系統支援 NFS Server 資料一致性功能</td>
</tr>
<tr>
<td>pcscd</td>
<td>停用</td>
<td>使系統支援 Smart Card</td>
</tr>
<tr>
<td>portmap</td>
<td>停用</td>
<td>使系統支援 NFS Service</td>
</tr>
<tr>
<td>rpcgssd</td>
<td>停用</td>
<td>使系統支援 NFSv4 Service</td>
</tr>
<tr>
<td>rpcidmapd</td>
<td>停用</td>
<td>使系統支援 NFSv4 Service</td>
</tr>
<tr>
<td>yum-updatesd</td>
<td>停用</td>
<td>使系統支援 YUM 自動更新服務 (上線機器還是先確認好再更新)</td>
</tr>
<tr>
<td colspan="4"></td>
</tr>
<tr>
<td>anacron</td>
<td>視個人需求</td>
<td>執行在 crontab 設定的時間沒有執行到的工作</td>
</tr>
<tr>
<td>auditd</td>
<td>視個人需求</td>
<td>稽核系統 /var/log/audit/audit.log,若 auditd 未執行中則稽核訊息會寫入 /var/log/messages</td>
</tr>
<tr>
<td>iptables</td>
<td>視個人需求</td>
<td>使系統支援 IPTables Filrewall</td>
</tr>
<tr>
<td>irqbalance</td>
<td>視個人需求</td>
<td>使系統支援多個 CPU 環境當系統中斷請求時進行負載平衡的程序,所以單 CPU 的機器就不需要</td>
</tr>
<tr>
<td>lvm2-monitor</td>
<td>視個人需求</td>
<td>使系統支援 Logical Volume Manager 邏輯磁區</td>
</tr>
<tr>
<td>mcstrans</td>
<td>視個人需求</td>
<td>主要用於配合 SELinux 服務</td>
</tr>
<tr>
<td>mdmonitor</td>
<td>視個人需求</td>
<td>使系統支援 RAID 相關程序</td>
</tr>
<tr>
<td>microcode_ctl</td>
<td>視個人需求</td>
<td>使系統支援 Intel IA32 CPU 特色,所以 AMD CPU 不需要</td>
</tr>
<tr>
<td>netfs</td>
<td>視個人需求</td>
<td>Network File System Mounter 網路掛載系統</td>
</tr>
<tr>
<td>restorecond</td>
<td>視個人需求</td>
<td>使系統支援 SELinux 監控檔案狀態</td>
</tr>
<tr>
<td>smartd</td>
<td>視個人需求</td>
<td>使系統支援檢查硬碟狀態 (Hardware RAID 要改設定檔)</td>
</tr>
<tr>
<td>sendmail</td>
<td>視個人需求</td>
<td>使系統支援 Sendmail</td>
</tr>
<tr>
<td>xfs</td>
<td>視個人需求</td>
<td>使系統支援 X Window 字型</td>
</tr>
<tr>
<td colspan="4"></td>
</tr>
<tr>
<td>crond</td>
<td>啟動</td>
<td>/etc/cron.* 排程服務</td>
</tr>
<tr>
<td>kudzu</td>
<td>啟動</td>
<td>使系統每次開機會都自動執行硬體偵測</td>
</tr>
<tr>
<td>network</td>
<td>啟動</td>
<td>使系統支援網卡</td>
</tr>
<tr>
<td>readahead_early</td>
<td>啟動</td>
<td>使系統再啟動時預先將相關檔案讀到記憶體內來加快啟動速度</td>
</tr>
<tr>
<td>sshd</td>
<td>啟動</td>
<td>使系統支援 SSH Service</td>
</tr>
<tr>
<td>syslog</td>
<td>啟動</td>
<td>使系統支援 System Log Service</td>
</tr>
</tbody>
</table>

<p>CentOS5.5 默认基本服务详解:</p>
<table width="100%" border="0" cellspacing="1" cellpadding="0">
<tbody>
<tr>
<td><strong>服务名称</strong></td>
<td><strong>功能</strong></td>
<td><strong>默认</strong></td>
<td><strong>建议</strong></td>
<td><strong>备注</strong></td>
</tr>
<tr>
<td>NetworkManager</td>
<td>用于自动连接网络</td>
<td>关闭</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>acpid</td>
<td>电源的开关等检测管理</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>anacron</td>
<td>一种计划任务管理</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>apmd</td>
<td>高级电源管理</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>atd</td>
<td>在指定时间执行命令</td>
<td>开启</td>
<td>关闭</td>
<td>如果用crond,则可关闭它</td>
</tr>
<tr>
<td>auditd</td>
<td></td>
<td>开启</td>
<td>自定</td>
<td>如果用selinux,需要开启它</td>
</tr>
<tr>
<td>autofs</td>
<td>文件系统自动加载、卸载</td>
<td>开启</td>
<td>自定</td>
<td>只在需要时开启它,可以停止</td>
</tr>
<tr>
<td>avahi-daemon</td>
<td>本地网络服务查找</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>avahi-dnsconfd</td>
<td>avahi DNS</td>
<td>关闭</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>bluetooth</td>
<td>蓝牙无线通信</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>conman</td>
<td>控制台管理</td>
<td>关闭</td>
<td>关闭</td>
<td>没用</td>
</tr>
<tr>
<td>spuspeed</td>
<td>调节cpu速度</td>
<td>开启</td>
<td>自定</td>
<td></td>
</tr>
<tr>
<td>crond</td>
<td>计划任务管理</td>
<td>开启</td>
<td>开启</td>
<td>很有用,开启</td>
</tr>
<tr>
<td>cups</td>
<td>通用unix打印服务</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器没用</td>
</tr>
<tr>
<td>dnsmasq</td>
<td>dns cache</td>
<td>关闭</td>
<td>关闭</td>
<td>没用</td>
</tr>
<tr>
<td>dund</td>
<td>蓝牙相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>firstboot</td>
<td>系统安装后初始设定</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>gpm</td>
<td>控制台下的鼠标支持</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>haldaemon</td>
<td>硬件信息收集服务</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>hidd</td>
<td>蓝牙相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ibmasm</td>
<td>ibm硬件管理</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ip6tables</td>
<td>ipv6防火墙</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>iptables</td>
<td>ipv4防火墙</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>irda</td>
<td>红外线通信</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>irqbalance</td>
<td>cpu负载均衡</td>
<td>开启</td>
<td>自定</td>
<td>多核cup需要</td>
</tr>
<tr>
<td>kudzu</td>
<td>硬件变动检测</td>
<td>开启</td>
<td>关闭</td>
<td>服务器无用</td>
</tr>
<tr>
<td>lvm2-monitor</td>
<td>lvm监视</td>
<td>开启</td>
<td>关闭</td>
<td>非集群无用</td>
</tr>
<tr>
<td>mcstrans</td>
<td>在开启selinux时用于检查context</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>mdmonitor</td>
<td>软raid监视</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>mdmpd</td>
<td>软raid管理</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>messagebus</td>
<td>负责在各个系统进程之间传递消息</td>
<td>开启</td>
<td>开启</td>
<td>如停用,haldaemon启动会失败</td>
</tr>
<tr>
<td>microcode_ctl</td>
<td>?cpu微码管理升级</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>multipathd</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netconsole</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netfs</td>
<td>nfs相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>netplugd</td>
<td>网线热插拔监视</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>network</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>nfs</td>
<td>网络文件系统</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>nfslock</td>
<td>nfs相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>nscd</td>
<td>name cache,应该与DNS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>oddjobd</td>
<td>与D-BUS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>pand</td>
<td>蓝牙相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>pcscd</td>
<td>pc/sc smart card daemon</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>portmap</td>
<td>使用NFS、NIS时的port map</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>psacct</td>
<td>负荷检测</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rawdevices</td>
<td>raw 设备支持</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>rdisc</td>
<td>自动检测路由器</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>readahead_early</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>readahead_later</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>restorecond</td>
<td>selinux相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rpcgssd</td>
<td>NFS相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>rpcidmapd</td>
<td>RPC name to UID/GID mapper</td>
<td>开启</td>
<td>关闭</td>
<td>NFS相关</td>
</tr>
<tr>
<td>rpcsvcgssd</td>
<td>NFS相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>saslauthd</td>
<td>sasl认证服务相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>sendmail</td>
<td></td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>smartd</td>
<td>硬盘自动检测守护进程</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>sshd</td>
<td></td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>syslog</td>
<td>系统日志进程</td>
<td>开启</td>
<td>开启</td>
<td></td>
</tr>
<tr>
<td>tcsd</td>
<td></td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>wpa_supplicant</td>
<td>无线认证相关</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>xfs</td>
<td>x windows相关</td>
<td>开启</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>ypbind</td>
<td>network information service客户端</td>
<td>关闭</td>
<td>关闭</td>
<td></td>
</tr>
<tr>
<td>yum-updatesd</td>
<td>yum自动升级</td>
<td>开启</td>
<td>关闭</td>
<td>对服务器开启比较危险哦</td>
</tr>
</tbody>
</table>


<hr>
<p>title: 关闭linux不需要的进程<br>date: 2018-02-13 07:04:00<br>categories: 操作系统<br>urlname: 819<br>tags:</p>
<ul>
<li>程序</li>
<li>运行</li>
<li>举例</li>
<li>进程</li>
<li>终止</li>
<li>用法</li>
<li>杀死</li>
<li>killall</li>
<li>作用</li>
</ul>
<hr>
<p>1.kill</p>
<p>作用:根据进程号杀死进程.<br>用法:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> [信号代码] 进程ID</span><br></pre></td></tr></table></figure>

<p>举例:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">ps</span> auxf |grep httpd</span><br><span class="line"><span class="variable">$</span> <span class="built_in">kill</span> <span class="number">5623</span></span><br></pre></td></tr></table></figure>

<p>注意:kill -9 来强制终止退出</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">ps</span> aux |grep gaim</span><br><span class="line"><span class="variable">$</span> <span class="built_in">kill</span> <span class="literal">-9</span> <span class="number">5031</span></span><br></pre></td></tr></table></figure>

<p>特殊用法:</p>
<figure class="highlight ldif"><table><tr><td class="code"><pre><span class="line"><span class="literal">-STOP [pid]</span></span><br><span class="line"><span class="comment">#发送SIGSTOP (17,19,23)停止一个进程,而并不Linux操作系统杀死进程.</span></span><br><span class="line"><span class="literal">-CONT [pid]</span></span><br><span class="line"><span class="comment">#发送SIGCONT (19,18,25)重新开始一个停止的进程.</span></span><br><span class="line"><span class="literal">-KILL [pid]</span></span><br><span class="line"><span class="comment">#发送SIGKILL (9)强迫进程立即停止,并且不实施清理操作.</span></span><br><span class="line"><span class="literal">-9 -1</span></span><br><span class="line"><span class="comment">#终止你拥有的全部进程.</span></span><br></pre></td></tr></table></figure>

<p>2.killall</p>
<p>作用:通过程序的名字,直接杀死所有进程.<br>用法:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">killall</span> 正在运行的程序名</span><br></pre></td></tr></table></figure>

<p>举例:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>killall gaim</span><br></pre></td></tr></table></figure>

<p>注意:该命令可以使用 -9 参数来强制杀死进程.</p>
<p>3.pkill</p>
<p>作用:通过程序的名字,直接杀死所有进程.<br>用法:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">pkill</span> 正在运行的程序名</span><br></pre></td></tr></table></figure>

<p>举例:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>pkill gaim</span><br></pre></td></tr></table></figure>

<p>4.xkill</p>
<p>作用:杀死桌面图形界面的程序.</p>
<p>应用情形实例:firefox出现崩溃不能退出时,点鼠标就能杀死firefox .<br>当xkill运行时出来和个人脑骨的图标,哪个图形程序崩溃一点就OK了.<br>如果您想终止xkill ,就按右键取消;<br>调用方法:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>xkill</span><br></pre></td></tr></table></figure>

<p>5.KILLALL</p>
<p>作用:通过程序的名字,直接杀死所有进程.<br>用法:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">killall</span> 正在运行的程序名</span><br></pre></td></tr></table></figure>

<p>举例:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>killall gaim</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>关于shell脚本中的日期时间格式</title>
    <url>/2011/06/25/1444/</url>
    <content><![CDATA[<p>一般我们写自动备份的脚本都需要以当天的日期甚至要加上时间来作为文件名字,<br>所以这里就要知道在shell脚本中使用日期时间的格式是怎么样的.</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">CURTIME=`<span class="built_in">date</span> +&quot;<span class="variable">%Y-%</span>m-%d <span class="variable">%H:%</span>M:%S&quot;`</span><br></pre></td></tr></table></figure>

<p>这个就是年月日 + 时分秒,<br>在脚本后半部分 就可以使用CURTIME这个变量来命令文件了.<br>下面是一个备份数据库的例子:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd /root</span><br><span class="line">day=`date +%Y-%m-%d*%H`</span><br><span class="line">tar -cvf mysql-<span class="variable">$day</span>.tar <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>var<span class="regexp">/paila /u</span>sr<span class="regexp">/local/my</span>sql<span class="regexp">/var/</span>pmbcc</span><br><span class="line">scp -P65188 mysql-<span class="variable">$day</span>.tar superman003@<span class="number">10.0</span>.<span class="number">10.3</span>:<span class="regexp">/home/</span>superman003/mysqlbak</span><br><span class="line">rm -rf mysql-<span class="variable">$day</span>.tar</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>关于linux无法连接无线网络的问题</title>
    <url>/2016/12/15/1443/</url>
    <content><![CDATA[<p>我用的是deepinlinux,家里的是fast的无线路由,电脑可以搜索到无线网路可是无论如何连接,都提示重新输入密码.<br>网上的教程搞了很久没有效果,<br>后来发现路由器不设置密码,linux是可以连接到的.<br>但是不设置密码又有可能被别人蹭网,<br>所以最后的解决办法是:</p>
<p>路由器不设置密码,然后通过mac地址限制能访问该无线网络的设备.<br>这样就可以上网又不怕蹭网了.</p>
<p>但是如果路由器不是自己的依然没有办法上网.</p>
]]></content>
  </entry>
  <entry>
    <title>关于本站所有linux教程的说明</title>
    <url>/2016/03/14/1445/</url>
    <content><![CDATA[<p>本站所有linux教程全部基于Centos,如果您是其他系统,请根据具体的情况来操作,而且就算是一样的系统,导致一个问题的原因也是很多的,所以解决了站长问题的方法,不一定能解决大家的问题,还望您包含.</p>
<p>如果您希望得到我的帮助,可以联系QQ:53273291 我会尽力帮助大家的.</p>
]]></content>
  </entry>
  <entry>
    <title>华为云nginx安全配置</title>
    <url>/2019/09/24/1446/</url>
    <content><![CDATA[<p>1.减少点击劫持</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">http</span> &#123;</span><br><span class="line">    …</span><br><span class="line">    add_header X-frame-<span class="literal">options</span> SAMEORIGIN;</span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.隐藏或伪装Nginx的版本及版本相关提示信息</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    server_tokens off<span class="comment">;</span></span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.禁止开启Nginx的目录列表功能</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    autoindex off<span class="comment">;</span></span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.禁止Nginx重定向至监听端口</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    port_in_redirect off<span class="comment">;</span></span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.配置Nginx的网络超时时间</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    keepalive_timeout  <span class="number">5</span> <span class="number">30</span><span class="comment">;</span></span><br><span class="line">    client_body_timeout   <span class="number">10</span><span class="comment">;</span></span><br><span class="line">    client_header_timeout  <span class="number">10</span><span class="comment">;     </span></span><br><span class="line">    send_timeout          <span class="number">10</span><span class="comment">;</span></span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.禁用SSI功能</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Nginx默认是关闭SSI功能，如果在配置文件nginx.conf的http段、<span class="keyword">server</span>段或<span class="keyword">location</span>段出现ssi <span class="keyword">on</span>，务必设置为ssi <span class="keyword">off</span>。</span><br></pre></td></tr></table></figure>

<p>7.启用XSS保护</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">http</span> &#123;</span><br><span class="line">    …</span><br><span class="line">    add_header X-XSS-Protection <span class="string">&#x27;1; mode=block&#x27;</span>;</span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8.禁用浏览器的类型猜测</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    add_header X-Content-<span class="keyword">Type</span>-<span class="keyword">Options</span>  nosniff;</span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9.隐藏 X-Powered-By HTTP头</p>
<p>修改nginx.conf,在http {}内添加:</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    …</span><br><span class="line">    proxy_hide_header     <span class="meta">X</span>-Powered-<span class="meta">By</span>;</span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>记录python脚本执行时间并写入文件</title>
    <url>/2021/05/07/1447/</url>
    <content><![CDATA[<p>该脚本可以记录python程序运行时间，并写入日志。</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8 #</span></span><br><span class="line">import <span class="built_in">time</span></span><br><span class="line"></span><br><span class="line">starttime = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line"><span class="built_in">time</span>.sleep(<span class="number">2.1</span>) <span class="comment">#延时2.1s，此处可以是任何python需要执行的代码</span></span><br><span class="line">endtime = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">dtime = endtime - starttime</span><br><span class="line">filename = <span class="string">&#x27;test_text.txt&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.<span class="built_in">write</span>(<span class="string">&#x27;程序运行时间：%.8s s&#x27;</span> % dtime)</span><br><span class="line">print(<span class="string">&quot;程序运行时间：%.8s s&quot;</span> % dtime) <span class="comment">#显示到微秒</span></span><br></pre></td></tr></table></figure>

<p>自行更换掉time.sleep(2.1)为您需要记录的python操作。</p>
]]></content>
  </entry>
  <entry>
    <title>记录每天操作记录</title>
    <url>/2017/05/10/1448/</url>
    <content><![CDATA[<p>备份操作记录的脚本</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/root</span></span><br><span class="line">day=`date +%Y-%m-%d`</span><br><span class="line">tar -cvf <span class="string">/home/superman003/logbak/log-</span>$day.tar <span class="string">.bash_history</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;&quot;</span> &gt; <span class="string">.bash_history</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>记录蜘蛛爬行记录的一段简单PHP代码</title>
    <url>/2019/05/09/1449/</url>
    <content><![CDATA[<p>这段PHP代码是我调试好的,一直自己用,可以用来分析下每天蜘蛛的爬行记录,但是对于一些只是虚拟主机的朋友来说还是比较方便的,直接通过网页的形式分析你站点的蜘蛛爬行记录.<br>这个文件的代码挺简单:各大搜索引擎的蜘蛛爬行程序都有自己的标识符,百度的是baiduspider,谷歌的是googlebot,还有雅虎的 等.有朋友问怎么判断当前访问者是否是搜索引擎呢?实际上通过PHP中的$_SERVER[“HTTP_USER_AGENT”]服务器变量可以判断的. 下面就是一段简单的通过PHP获取搜索引擎蜘蛛来访爬行记录,并写入数据库的代码.<br>我们先用dreamweaver建一个php文件,代码如下,命名为robots.php.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_naps_bot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$useragent</span> = strtolower(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;googlebot&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Googlebot&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;msnbot&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;MSNbot&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;slurp&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Yahoobot&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;baiduspider&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Baiduspider&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;sohu-search&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Sohubot&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;lycos&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Lycos&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$useragent</span>, <span class="string">&#x27;robozilla&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Robozilla&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nowtime</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$date</span>=gmdate(<span class="string">&quot;Y-n-j H:i:s&quot;</span>,time()+<span class="number">8</span>*<span class="number">3600</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$date</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$searchbot</span> = get_naps_bot();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$searchbot</span>) &#123;</span><br><span class="line"><span class="variable">$tlc_thispage</span> = addslashes(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="variable">$file</span>=<span class="string">&quot;robotslogs.txt&quot;</span>;</span><br><span class="line"><span class="variable">$time</span>=nowtime();</span><br><span class="line"><span class="variable">$data</span>=fopen(<span class="variable">$file</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$data</span>,<span class="string">&quot;Time:<span class="subst">$time</span> robot:<span class="subst">$searchbot</span> URL:<span class="subst">$tlc_thispagen</span>&quot;</span>);</span><br><span class="line">fclose(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后把robots.php文件上传到你的网站程序的模板目录中(我自己的站点用的是wordpress程序,所以是放在wordpress主题的目录下 的);最后在你的模板文件中调用它,例如在Wordpress博客中,你可以在footer.php文件中最下面添加代码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&#x27;robots.php&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来就是等蜘蛛爬取了,爬行的记录均会记录在robotslogs.txt这个文件里,如果没有的话可以自己先建立个空白文档命名为 robotslogs.txt,然后打开<a href="http://www.yourdomain.com/robotslogs.txt">http://www.YourDomain.com/robotslogs.txt</a> 这个时候可以直接在网页上看到你的站点蜘蛛爬行记录了,很方便很直观的,当然你也可以自定义这个文档名称,把第36行的robotslogs.txt改为 其他名字.</p>
]]></content>
  </entry>
  <entry>
    <title>监控软件Monit安装与配置</title>
    <url>/2018/09/22/1450/</url>
    <content><![CDATA[<p>一、Monit简介</p>
<p>Monit是一款功能非常丰富的进程、文件、目录和设备的监测软件,用于Unix平台.它可以自动修复那些已经停止运作的程序,特使适合处理那些由于多种原因导致的软件错误.</p>
<p>二、安装与配置</p>
<p>1、软件包依赖</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">apache</span></span><br></pre></td></tr></table></figure>

<p>2、下载</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//mm</span>onit.com<span class="regexp">/monit/</span></span><br></pre></td></tr></table></figure>

<p>3、安装</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> tar monit<span class="literal">-5</span>.<span class="number">2.3</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> monit<span class="literal">-5</span>.<span class="number">2.3</span></span><br><span class="line"><span class="variable">$</span> ./configure   /前面有个点儿</span><br><span class="line"><span class="variable">$</span> make</span><br><span class="line"><span class="variable">$</span> make install</span><br></pre></td></tr></table></figure>

<p>4、配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cp <span class="regexp">/monit-5.2.3/m</span>onitrc /etc</span><br></pre></td></tr></table></figure>

<p>5、注册init守护进程</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/i</span>nittab</span><br></pre></td></tr></table></figure>

<p>添加下面一行:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="symbol">mo:</span><span class="number">2345</span><span class="symbol">:respawn</span><span class="symbol">:/usr/local/bin/monit</span> -Ic /etc/monirc</span><br></pre></td></tr></table></figure>

<p>6、配置实例</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">###############################################################</span><br><span class="line">#Global section                                 #全局配置</span><br><span class="line">###############################################################</span><br><span class="line">set daemon <span class="number">120</span> <span class="keyword">with</span> start delay <span class="number">240</span>             #设置monit为后台进程,没<span class="number">2</span>分钟为一个检查周期,首次启动后<span class="number">4</span>分钟开始第一次检查</span><br><span class="line">###############################################################</span><br><span class="line">set logfile syslog facility log_daemon          #设置系统日志,这是默认设定,可以手动配置指定日志文件</span><br><span class="line">###############################################################</span><br><span class="line">set idfile /var/.monit.id                       #设置monit对象实例,其实这里的对象就是指本机</span><br><span class="line">###############################################################</span><br><span class="line">set statefile /var/.monit.state                 #设置状态报告文件</span><br><span class="line">###############################################################</span><br><span class="line">set mailserver mail.tiigame.com                 #设置邮件服务器,通过它来发送邮件警告</span><br><span class="line">###############################################################</span><br><span class="line">set eventqueue</span><br><span class="line">basedir /var/monit                              #设置事件报告,每个事件对应的文件最大大小为<span class="number">100</span>KB</span><br><span class="line">slots <span class="number">100</span></span><br><span class="line">###############################################################</span><br><span class="line">##Monit by default uses the following alert mail format:</span><br><span class="line">##-<span class="number">-8</span>&lt;--</span><br><span class="line">##From: monit@$host</span><br><span class="line">##Subject: monit alert --  $EVENT $SERVICE</span><br><span class="line">##$EVENT Service $SERVICE</span><br><span class="line">##Date:        $DATE</span><br><span class="line">##Action:      $ACTION                          #邮件格式,此处忽略</span><br><span class="line">##Host:        $HOST</span><br><span class="line">##Description: $DESCRIPTION</span><br><span class="line">##Your faithful employee,</span><br><span class="line">##Monit</span><br><span class="line">##-<span class="number">-8</span>&lt;--</span><br><span class="line">###############################################################</span><br><span class="line">set alert <span class="number">244032545</span>@qq.com                      #设置警告要发往的邮箱</span><br><span class="line">set alert <span class="number">244032545</span>@qq.com only on &#123; timeout &#125;  #当警告发送失败时要发往的另一个邮箱</span><br><span class="line">###############################################################</span><br><span class="line">set httpd port <span class="number">2812</span> and use address localhost   #设定http访问端口,只允许本机访问</span><br><span class="line">allow localhost</span><br><span class="line">allow admin:monit                               #本地访问凭证,用户admin,密码monit</span><br><span class="line">allow @monit</span><br><span class="line">allow @users readonly</span><br><span class="line">###############################################################</span><br><span class="line">##Services                                      #服务的定义</span><br><span class="line">###############################################################</span><br><span class="line">check <span class="keyword">system</span> myhost.mydomain.tld</span><br><span class="line"><span class="keyword">if</span> loadavg (<span class="number">1</span>min) &gt; <span class="number">4</span> then alert</span><br><span class="line"><span class="keyword">if</span> loadavg (<span class="number">5</span>min) &gt; <span class="number">2</span> then alert</span><br><span class="line"><span class="keyword">if</span> memory usage &gt; <span class="number">75</span>% then alert                #检查负载</span><br><span class="line"><span class="keyword">if</span> swap usage &gt; <span class="number">25</span>% then alert</span><br><span class="line"><span class="keyword">if</span> cpu usage (user) &gt; <span class="number">70</span>% then alert</span><br><span class="line"><span class="keyword">if</span> cpu usage (<span class="keyword">system</span>) &gt; <span class="number">30</span>% then alert</span><br><span class="line"><span class="keyword">if</span> cpu usage (wait) &gt; <span class="number">20</span>% then alert</span><br><span class="line">###############################################################</span><br><span class="line">check file apache_bin <span class="keyword">with</span> path /usr/local/apache/bin/httpd</span><br><span class="line"><span class="keyword">if</span> failed checksum and expect the sum <span class="number">8</span>f7f419955cefa0b33a2ba316cba3659 then unmonitor</span><br><span class="line"><span class="keyword">if</span> failed permission <span class="number">755</span> then unmonitor</span><br><span class="line"><span class="keyword">if</span> failed uid root then unmonitor               #apache权限检查</span><br><span class="line"><span class="keyword">if</span> failed gid root then unmonitor</span><br><span class="line">alert <span class="number">244032545</span>@qq.com on &#123;checksum, permission, uid, gid&#125; <span class="keyword">with</span> the mail-format &#123; subject: Alarm! &#125;</span><br><span class="line">group server</span><br><span class="line">###############################################################</span><br><span class="line">check process apache <span class="keyword">with</span> pidfile /usr/local/apache/logs/httpd.pid</span><br><span class="line">start program = <span class="string">&quot;/etc/init.d/httpd start&quot;</span> <span class="keyword">with</span> timeout <span class="number">60</span> seconds</span><br><span class="line">stop program  = <span class="string">&quot;/etc/init.d/httpd stop&quot;</span></span><br><span class="line"><span class="keyword">if</span> cpu &gt; <span class="number">60</span>% for <span class="number">2</span> cycles then alert</span><br><span class="line"><span class="keyword">if</span> cpu &gt; <span class="number">80</span>% for <span class="number">5</span> cycles then restart</span><br><span class="line"><span class="keyword">if</span> totalmem &gt; <span class="number">200.0</span> MB for <span class="number">5</span> cycles then restart#检查apache服务器负载</span><br><span class="line"><span class="keyword">if</span> children &gt; <span class="number">250</span> then restart</span><br><span class="line"><span class="keyword">if</span> loadavg(<span class="number">5</span>min) greater than <span class="number">10</span> for <span class="number">8</span> cycles then stop</span><br><span class="line"><span class="keyword">if</span> failed host www.tildeslash.com port <span class="number">80</span> protocol http and request <span class="string">&quot;/somefile.html&quot;</span> then restart</span><br><span class="line"><span class="keyword">if</span> failed port <span class="number">443</span> type tcpssl protocol http <span class="keyword">with</span> timeout <span class="number">15</span> seconds then restart</span><br><span class="line"><span class="keyword">if</span> <span class="number">3</span> restarts within <span class="number">5</span> cycles then timeout depends on apache_bin</span><br><span class="line">group server</span><br><span class="line">###############################################################</span><br><span class="line">check filesystem datafs <span class="keyword">with</span> path /dev/sdb1</span><br><span class="line">start program  = <span class="string">&quot;/bin/mount /data&quot;</span></span><br><span class="line">stop program  = <span class="string">&quot;/bin/umount /data&quot;</span></span><br><span class="line"><span class="keyword">if</span> failed permission <span class="number">660</span> then unmonitor</span><br><span class="line"><span class="keyword">if</span> failed uid root then unmonitor               #检查磁盘使用情况</span><br><span class="line"><span class="keyword">if</span> failed gid disk then unmonitor</span><br><span class="line"><span class="keyword">if</span> space usage &gt; <span class="number">80</span>% for <span class="number">5</span> times within <span class="number">15</span> cycles then alert</span><br><span class="line"><span class="keyword">if</span> space usage &gt; <span class="number">99</span>% then stop</span><br><span class="line"><span class="keyword">if</span> inode usage &gt; <span class="number">30000</span> then alert</span><br><span class="line"><span class="keyword">if</span> inode usage &gt; <span class="number">99</span>% then stop</span><br><span class="line">group server</span><br><span class="line">###############################################################</span><br><span class="line">check file database <span class="keyword">with</span> path /data/mydatabase.db</span><br><span class="line"><span class="keyword">if</span> failed permission <span class="number">700</span> then alert</span><br><span class="line"><span class="keyword">if</span> failed uid <span class="number">0</span> then alert</span><br><span class="line"><span class="keyword">if</span> failed gid <span class="number">0</span> then alert                      #数据库</span><br><span class="line"><span class="keyword">if</span> timestamp &gt; <span class="number">15</span> minutes then alert</span><br><span class="line">#<span class="keyword">if</span> size &gt; <span class="number">100</span> MB then exec <span class="string">&quot;/my/cleanup/script&quot;</span> <span class="keyword">as</span> uid dba and gid dba</span><br><span class="line">###############################################################</span><br><span class="line">check directory bin <span class="keyword">with</span> path /bin</span><br><span class="line"><span class="keyword">if</span> failed permission <span class="number">755</span> then unmonitor         #检查某个目录,这里是/bin</span><br><span class="line"><span class="keyword">if</span> failed uid <span class="number">0</span> then unmonitor</span><br><span class="line"><span class="keyword">if</span> failed gid <span class="number">0</span> then unmonitor</span><br><span class="line">###############################################################</span><br><span class="line">##以下设置对一台远程主机的监控</span><br><span class="line">###############################################################</span><br><span class="line">#Check a remote host availability by issuing a ping test and check the</span><br><span class="line"># content <span class="keyword">of</span> a response <span class="keyword">from</span> a web server. Up to three pings are sent and</span><br><span class="line">#connection to a port and an application level network check is performed.</span><br><span class="line"># check host myserver <span class="keyword">with</span> address <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"># <span class="keyword">if</span> failed icmp type echo count <span class="number">3</span> <span class="keyword">with</span> timeout <span class="number">3</span> seconds then alert</span><br><span class="line"># <span class="keyword">if</span> failed port <span class="number">3306</span> protocol mysql <span class="keyword">with</span> timeout <span class="number">15</span> seconds then alert</span><br><span class="line"># <span class="keyword">if</span> failed url http:<span class="comment">//user:password@www.foo.bar:8080/?querystring</span></span><br><span class="line"># and content == <span class="string">&#x27;action=&quot;j_security_check&quot;&#x27;</span> then alert</span><br><span class="line">###############################################################</span><br><span class="line">##配置包含文件,这样管理起来可能更方便些,不至于主配置文件代码太多</span><br><span class="line">###############################################################</span><br><span class="line">#Includes</span><br><span class="line">#It is possible to include additional configuration parts <span class="keyword">from</span> other</span><br><span class="line">#files or directories.</span><br><span class="line">#include /etc/monit.d<span class="comment">/*</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br></pre></td></tr></table></figure>

<p>7、检查配置</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/bin/m</span>onit -t</span><br></pre></td></tr></table></figure>

<p>8、开始监控</p>
<p>用一下方式启动Monit:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>telinit q</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决 error while loading shared libraries libXp.so.6  error while loading shared libraries libjpeg.so.8 解决error while loading shared libraries libpng14.so.14</title>
    <url>/2011/03/10/1454/</url>
    <content><![CDATA[<p>出现错误:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error </span>while loading shared libraries: libXp.so.6 和 error while loading shared libraries: libjpeg.so.8</span><br></pre></td></tr></table></figure>

<p>直接yum install libXp.so.6 没有这个包,<br>后来search ,发现要安装的是libXp libXp-devel.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libXP libXp-devel</span><br></pre></td></tr></table></figure>

<p>就可以解决问题了.</p>
<p>第二种情况:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libjpeg libjpeg-devel</span><br></pre></td></tr></table></figure>

<p>然后执行依然报这个错误.</p>
<p>解决办法:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">find</span> / -name libjpeg*</span><br></pre></td></tr></table></figure>

<p>找到:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>lib64/libjpeg.so.<span class="number">62</span></span><br></pre></td></tr></table></figure>

<p>然后做一个软链接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>lib64<span class="regexp">/libjpeg.so.62 /u</span>sr<span class="regexp">/lib64/</span><span class="regexp">/usr/</span>lib64/libjpeg.so.<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>重新运行 错误消失.</p>
<p>另一个类似错误:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error </span>while loading shared libraries: libpng14.so.14</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum search libpng</span><br><span class="line">yum insall libpng libpng-devel</span><br></pre></td></tr></table></figure>

<p>然后安装libpng 和libpng-devel 结果发现都安装好了.</p>
<p>后来:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">find</span> / -name libpng*</span><br></pre></td></tr></table></figure>

<p>找到:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>lib64/libpng12.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>然后做一个软链接:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ln</span> -s /usr/lib<span class="number">64</span>/libpng<span class="number">12</span>.so.<span class="number">0</span> /usr/lib<span class="number">64</span>/libpng<span class="number">14</span>.so.<span class="number">14</span></span><br></pre></td></tr></table></figure>

<p>重新运行 错误消失.</p>
]]></content>
  </entry>
  <entry>
    <title>解决 drbdadm create-md ha exited with coolcode 40</title>
    <url>/2014/01/02/1453/</url>
    <content><![CDATA[<p>站长在使用drbd的时候,执行drbdadm create-md ha 时出现:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Device size would be truncated, which</span><br><span class="line"> would corrupt data and result <span class="keyword">in</span></span><br><span class="line"> <span class="string">&#x27;access beyond end of device&#x27;</span> errors.</span><br><span class="line"> You need to either</span><br><span class="line">    * use external meta data (recommended)</span><br><span class="line">    * shrink that filesystem first</span><br><span class="line">    * zero out the device (destroy the filesystem)</span><br><span class="line"> Operation refused.</span><br><span class="line"> Command <span class="string">&#x27;drbdmeta 0 v08 /dev/hdb1 internal create-md&#x27;</span> terminated with <span class="keyword">exit</span> coolcode <span class="number">40</span></span><br><span class="line"> drbdadm create-md ha: exited with coolcode <span class="number">40</span></span><br></pre></td></tr></table></figure>

<p>解决办法是:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/dev/hdb1 <span class="attribute">bs</span>=1M <span class="attribute">count</span>=100</span><br></pre></td></tr></table></figure>

<p>然后重新执行drbdadm create-md ha就可以顺利通过了.</p>
]]></content>
  </entry>
  <entry>
    <title>脚本语言与或非</title>
    <url>/2011/03/11/1452/</url>
    <content><![CDATA[<p><code>&amp;&amp;</code>为二元运算符,实现逻辑与.<br><code>|</code>逻辑或.<br><code>!</code>为一元运算符,实现逻辑非.</p>
]]></content>
  </entry>
  <entry>
    <title>脚本打包备份</title>
    <url>/2017/02/12/1451/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">day=`date +%Y%m%d`</span><br><span class="line">backupdir=<span class="string">&quot;/mnt/disk2/backup_files&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /srv/www/htdocs</span><br><span class="line">tar czvf <span class="string">&quot;<span class="variable">$backupdir</span>&quot;</span>/wiki_<span class="string">&quot;<span class="variable">$day</span>&quot;</span>.tar.gz cn</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决apache不能访问子目录</title>
    <url>/2013/07/26/1457/</url>
    <content><![CDATA[<p>导致这个问题的原因是子目录权限不够,</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> -R <span class="number">777</span> /目录</span><br></pre></td></tr></table></figure>

<p>就可以解决了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决 在向 API 发送请求时发生了一个 HTTP 异常错误</title>
    <url>/2015/05/26/1455/</url>
    <content><![CDATA[<p>今天站长想给本站安装一个统计插件,记过就出现了”在向 API 发送请求时发生了一个 HTTP 异常错误”.<br>百度了N久,找到了下面的文章,解决了站长的问题.<br>主要原因是 主机禁用函数fsockopen().API 调用不到的.</p>
<p>解决方法:</p>
<figure class="highlight sas"><table><tr><td class="code"><pre><span class="line">打开`/wp-includes/class-http.php`</span><br><span class="line">查找 @fsoc<span class="meta">kopen(</span> 替换为 @pfsoc<span class="meta">kopen(</span></span><br><span class="line">查找 fsoc<span class="meta">kopen(</span> 替换为 pfsoc<span class="meta">kopen(</span></span><br><span class="line">#注意:不要把 WP_Http_Fsoc<span class="meta">kopen(</span> 替换了</span><br></pre></td></tr></table></figure>

<p>还有个方法:</p>
<p>修改 <code>wp-includes/class-http.php</code>的第220行,将</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;timeout&#x27;</span> =&gt; apply_filters( <span class="string">&#x27;http_request_timeout&#x27;</span>, <span class="number">5</span>),</span><br></pre></td></tr></table></figure>

<p>中的5改为60,</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;timeout&#x27;</span> =&gt; apply_filters( <span class="string">&#x27;http_request_timeout&#x27;</span>, <span class="number">60</span>),</span><br></pre></td></tr></table></figure>

<p>这个5是请求时间,单位为 秒 ,就是5秒超时,经测有效.</p>
]]></content>
  </entry>
  <entry>
    <title>解决[warn] _default_ VirtualHost overlap on port 80</title>
    <url>/2014/07/08/1456/</url>
    <content><![CDATA[<p>错误:<br>[warn] <em>default</em> VirtualHost overlap on port 80, the first has precedence</p>
<p>这个,大概意思就是后面新增加的这个VirtualHost 由于端口被占用,不能生效,沿用第一个虚拟主机的配置.<br>检查了一下,发现,原来在httpd.conf里,我没有把#NameVirtualHost *:80前的注释去掉,导致这个没有生效.<br>去掉#之后:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/apache/</span>bin/httpd -k restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决apc.c419 error &#39;apc_regex&#39; has no member named &#39;preg&#39;</title>
    <url>/2013/11/12/1458/</url>
    <content><![CDATA[<p>出现以下错误:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">In <span class="keyword">file</span> included <span class="keyword">from</span> <span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">38</span>:</span><br><span class="line"><span class="regexp">/usr/i</span>nclude<span class="regexp">/php/</span>ext<span class="regexp">/pcre/</span>php_pcre.h:<span class="number">29</span>:<span class="number">18</span>: error: pcre.h: No such <span class="keyword">file</span> or directory</span><br><span class="line">In <span class="keyword">file</span> included <span class="keyword">from</span> <span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">38</span>:</span><br><span class="line">… …</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c: In function <span class="string">&#x27;apc_regex_compile_array&#x27;</span>:</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">419</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;preg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">419</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;preg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">420</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;nreg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">420</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;nreg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c: In function <span class="string">&#x27;apc_regex_match_array&#x27;</span>:</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">452</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;preg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">452</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;preg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">453</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;nreg&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/src/</span>APC-<span class="number">3.1</span>.<span class="number">5</span>/apc.c:<span class="number">453</span>: error: <span class="string">&#x27;apc_regex&#x27;</span> has no member named <span class="string">&#x27;nreg&#x27;</span></span><br><span class="line">make: *** [apc.lo] Error <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>安装 pcre-devel 就可以解决:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> pcre-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决cannot find -lncurses</title>
    <url>/2015/06/19/1459/</url>
    <content><![CDATA[<p>出现:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">cannot <span class="builtin-name">find</span> -lncurses</span><br></pre></td></tr></table></figure>
<p>这个错误的原因是没有安装ncurses-devel,所以解决办法也很简单,</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ncurses-devel</span><br></pre></td></tr></table></figure>
<p>搞定.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Cannot retrieve metalink for repository epel. Please verify its path and try again</title>
    <url>/2019/09/12/1460/</url>
    <content><![CDATA[<p>解决方法:</p>
<p>修改 epel.repo 文件,把第3行注释去掉,第四行注释掉.</p>
<p>编辑 <code>/etc/yum.repos.d/epel.repo</code>:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/epel.repo</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="number">6</span> - <span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch</span></span><br><span class="line">mirrorlist=https:<span class="regexp">//mi</span>rrors.fedoraproject.org/metalink?repo=epel-<span class="number">6</span>&amp;arch=<span class="variable">$basearch</span></span><br></pre></td></tr></table></figure>

<p>修改为:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux <span class="number">6</span> - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http:<span class="regexp">//</span>download.fedoraproject.org<span class="regexp">/pub/</span>epel<span class="regexp">/6/</span><span class="variable">$basearch</span></span><br><span class="line"><span class="comment">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch</span></span><br></pre></td></tr></table></figure>

<p>再清理源,重新安装.</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">yum clean <span class="keyword">all</span></span><br><span class="line">yum install -y 需要的包</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决centos Kernel driver not installed (rc=-1908)</title>
    <url>/2016/01/12/1461/</url>
    <content><![CDATA[<p>安装virtualbox时出现上述错误,下载fedora的 red hat的版本都不能解决,<br>最后下载官网最后一个链接,下载 .run 的安装文件安装就可以了.</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">chmod +x <span class="module-access"><span class="module"><span class="identifier">XXX</span>.</span></span>run</span><br><span class="line">./<span class="module-access"><span class="module"><span class="identifier">XXX</span>.</span></span>run</span><br></pre></td></tr></table></figure>

<p>下载地址:<a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p>
]]></content>
  </entry>
  <entry>
    <title>解决centos编译内核Unable to find the Ncurses libraries 错误</title>
    <url>/2011/08/13/1462/</url>
    <content><![CDATA[<p>解决办法:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ncurses ncurses-devel</span><br></pre></td></tr></table></figure>
<p>即可解决问题,ncurses是编译内核时显示图形界面的必须元素,<br>所以没有的话就会报错.</p>
]]></content>
  </entry>
  <entry>
    <title>解决centos小键盘无法使用</title>
    <url>/2018/06/08/1463/</url>
    <content><![CDATA[<p>其实这个问题很好解决,只要按按下 shift + alt 和 NumLock 就好了.<br>可能centos的小键盘锁的快捷键吧.</p>
]]></content>
  </entry>
  <entry>
    <title>解决centos照不到php.ini</title>
    <url>/2017/11/02/1464/</url>
    <content><![CDATA[<p>今天用centos搭建lamp环境,一切顺利,可是却照不到php.ini,后来谷歌了解到原来在<code>/etc/php.d</code>这个目录下,这个目录下所有的ini都是php的配置文件,随便写道哪个里面,或者新建一个ini文件都是可以的.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error Cannot find the WebServer</title>
    <url>/2016/01/24/1465/</url>
    <content><![CDATA[<p>今天在CentOS编译安装”tomcat-connectors-1.2.30”软件进行到configure时,提示</p>
<figure class="highlight smalltalk"><table><tr><td class="code"><pre><span class="line"><span class="comment">&quot;configure: error: Cannot find the WebServer&quot;</span></span><br></pre></td></tr></table></figure>

<p>错误信息,如下图所示:</p>
<p>最后仔细阅读文档,发现是没有”apxs”文件,</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/configure --with-apxs=/u</span>sr<span class="regexp">/sbin/</span>apxs</span><br></pre></td></tr></table></figure>

<p>要查找到此文件,才会继续进行下去,此文件是httpd啊,怎么会没有呢.后来在另外一台服务器上查找此文件是有的,然后rpm命令根据此文件查找安 装包,原来是需要安装httpd-devel安装包才有此文件的.于是立即安装了引包,再configure,顺利的完成了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error Popt libraries is required</title>
    <url>/2012/05/31/1467/</url>
    <content><![CDATA[<p>这个错误是因为没有安装popt的开发包导致的,解决方法也很简单,</p>
<p>只要:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> popt-devel</span><br></pre></td></tr></table></figure>

<p>就可以安装好popt的开发包了.</p>
<p>重新编译就会成功了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error can&#39;t find pcap.h   You&#39;re not going to get very far without libpcap.</title>
    <url>/2018/12/26/1466/</url>
    <content><![CDATA[<p>缺少libpcap libpcap-devel这两个包,</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> libpcap libpcap-devel</span><br></pre></td></tr></table></figure>
<p>就可以安装好了,<br>继续,就没有错误了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error We require OpenSSL; try –with-openssl configure failed for serf</title>
    <url>/2011/02/05/1468/</url>
    <content><![CDATA[<p>如果不安装openssl相关包,./configure时会出现以下错误:</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">configure:</span> <span class="keyword">error</span>: We require OpenSSL; <span class="keyword">try</span> –<span class="keyword">with</span>-openssl configure failed <span class="keyword">for</span> serf</span><br></pre></td></tr></table></figure>

<p>对于openssl openssl-devel包使用yum方式进行安装在管理员权限下执行下面的命令:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openssl</span><br><span class="line">yum <span class="keyword">install</span> openssl-devel</span><br></pre></td></tr></table></figure>

<p>在出现提示时输入y进行下载安装.</p>
]]></content>
  </entry>
  <entry>
    <title>解决configure error XMLParser perl module is required for intltool</title>
    <url>/2015/04/10/1469/</url>
    <content><![CDATA[<p>下载安装:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>web.mit.edu<span class="regexp">/zacheiss-ath/</span>dev<span class="regexp">/rhlinux/</span>redhat-<span class="number">9</span><span class="regexp">/RedHat/</span>RPMS/perl-XML-Parser-<span class="number">2.31</span>-<span class="number">15</span>.i386.rpm</span><br></pre></td></tr></table></figure>

<p>可能会下载很多的依赖包,时间比较久,耐心等待.<br>下载XML-Parser,目前版本是: 2.34,对应的文件名为:XML-Parser-2.34.tar.gz.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>search.cpan.org<span class="regexp">/CPAN/</span>authors<span class="regexp">/id/</span>M<span class="regexp">/MS/</span>MSERGEANT/XML-Parser-<span class="number">2.34</span>.tar.gz</span><br></pre></td></tr></table></figure>

<p>然后按照如下步骤进行安装:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> tar zxvf XML<span class="literal">-Parser</span><span class="literal">-2</span>.<span class="number">34</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> XML<span class="literal">-Parser</span><span class="literal">-2</span>.<span class="number">34</span></span><br><span class="line"><span class="variable">$</span> perl Makefile.PL</span><br><span class="line"><span class="variable">$</span> make</span><br><span class="line"><span class="variable">$</span> make install</span><br></pre></td></tr></table></figure>

<p>附注,在windows下,XML PARSER为:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">Microsoft <span class="keyword">XML</span> <span class="title">Parser</span> (MSXML)</span><br></pre></td></tr></table></figure>

<p>然后重新编译,成功通过.</p>
]]></content>
  </entry>
  <entry>
    <title>解决E37 No write since last change (add ! to override)</title>
    <url>/2016/09/25/1471/</url>
    <content><![CDATA[<p>2019年8月8日更新:<br>除了下面写的情况,还有两种可能:</p>
<p>1.文件有只读属性.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">chattr -<span class="selector-tag">i</span> 要修改的文件名</span><br></pre></td></tr></table></figure>

<p>2.用户没有权限修改该文件.</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">直接sudo 修改,或者切换为root用户操作.</span><br></pre></td></tr></table></figure>

<p>这个错误就是需要在修改完成文件后执行:wq!就可以了.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="symbol">:q</span> <span class="comment">#退出.</span></span><br><span class="line"><span class="symbol">:wq</span> <span class="comment">#保存退出.</span></span><br><span class="line"><span class="symbol">:q!</span><span class="comment">#强制退出.</span></span><br><span class="line"><span class="symbol">:wq!</span> <span class="comment">#强制保存退出.</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决configure编译时提示configure error youmust configure in a separate build directory</title>
    <url>/2013/12/21/1470/</url>
    <content><![CDATA[<p>编译pptp的时候出现这个错误:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">configure: error: youmust configure <span class="keyword">in</span> <span class="keyword">a</span> separate build <span class="built_in">directory</span></span><br></pre></td></tr></table></figure>

<p>大概意思就是要进入一个新的目录来configure.<br>所以如果源码路径是 <code>/usr/local/pptp</code> 下面运行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/pptp/</span>configure</span><br></pre></td></tr></table></figure>

<p>就可以编译了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决ECshop不支持问题</title>
    <url>/2018/05/31/1472/</url>
    <content><![CDATA[<p>php.ini中还有下面一些需要去掉注释:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">extension</span>=php_mysql.dll</span><br><span class="line"><span class="attr">extension</span>=php_mysqli.dll</span><br><span class="line"><span class="attr">extension</span>=php_zip.dll</span><br><span class="line"><span class="attr">extension</span>=php_sockets.dll</span><br><span class="line"><span class="attr">extension</span>=php_mbstring.dll</span><br><span class="line"><span class="attr">extension</span>=php_exif.dll</span><br><span class="line"><span class="attr">extension</span>=php_mcrypt.dll</span><br><span class="line"><span class="attr">extension</span>=php_imap.dll</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决ECSHOP为静态 404</title>
    <url>/2013/10/17/1473/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">The</span> requested URL goods-<span class="number">2222</span>.html was not found <span class="literal">on</span> this server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/zhaoshang&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>将这里的:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">AllowOverride <span class="attribute">None</span></span><br></pre></td></tr></table></figure>

<p>改成:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">AllowOverride <span class="keyword">All</span></span><br></pre></td></tr></table></figure>

<p>就是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/zhaoshang&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">AllowOverride</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决ECSHOP无法伪静态</title>
    <url>/2014/07/28/1474/</url>
    <content><![CDATA[<p>1、首先您需要找到 Apache 安装目录,之后找到 conf 目录下的 httpd.conf 文件.<br>2、将下面的代码复制到 httpd.conf 文件中,注意将 <code>/ecshop</code> 替换为您的商店的实际安装目录.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory /ecshop&gt;</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> FollowSymLinks</span><br><span class="line">    <span class="attribute">AllowOverride</span> <span class="literal">All</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、在 httpd.conf 中搜索 LoadModule rewrite_module,将该行前面的 # 号删除.<br>如果您的 Apache 是1.3.x版本还需要查找 AddModule mod_rewrite.c,<br>请将前面的#删除.<br>4、保存 httpd.conf.<br>5、重命名htaccess.txt为.htaccess.放到网站根目录.<br>6、重新启动 Apache.<br>7、进入 ecshop 管理中心-&gt;商店设置,将 URL 重写设置为启用.</p>
]]></content>
  </entry>
  <entry>
    <title>解决error specifies multiple packages</title>
    <url>/2015/03/12/1475/</url>
    <content><![CDATA[<p>第一次用–nodeps来卸载,出现错误:</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error: </span>specifies multiple packages</span><br></pre></td></tr></table></figure>

<p>于是再加一个–allmatches这下可以成功卸载了.</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">[root@localhost courier-imap<span class="string">-4</span>.1.0]# rpm -qa | grep cyrus-sasl | xargs rpm -e --nodeps</span><br><span class="line"><span class="keyword">error: </span>&quot;cyrus-sasl-lib<span class="string">-2</span>.1.22<span class="string">-5</span>.el5_4.3&quot; specifies multiple packages</span><br><span class="line"><span class="keyword">error: </span>&quot;cyrus-sasl-lib<span class="string">-2</span>.1.22<span class="string">-5</span>.el5_4.3&quot; specifies multiple packages</span><br><span class="line"><span class="keyword">error: </span>&quot;cyrus-sasl-plain<span class="string">-2</span>.1.22<span class="string">-5</span>.el5_4.3&quot; specifies multiple packages</span><br><span class="line"><span class="keyword">error: </span>&quot;cyrus-sasl-plain<span class="string">-2</span>.1.22<span class="string">-5</span>.el5_4.3&quot; specifies multiple packages</span><br><span class="line">[root@localhost courier-imap<span class="string">-4</span>.1.0]# rpm -qa | grep cyrus-sasl | xargs rpm -e -nodeps</span><br><span class="line">-nodeps: unknown option</span><br><span class="line">[root@localhost courier-imap<span class="string">-4</span>.1.0]# rpm -qa | grep cyrus-sasl | xargs rpm -e --allmatches</span><br><span class="line"><span class="keyword">error: </span>Failed dependencies:</span><br><span class="line">libsasl2.so.2()(64bit) is needed by (installed) openldap<span class="string">-2</span>.3.43<span class="string">-12</span>.el5.x86_64</span><br><span class="line">libsasl2.so.2()(64bit) is needed by (installed) autofs<span class="string">-5</span>.0.1<span class="string">-0</span>.rc2.143.el5.x86_64</span><br><span class="line">libsasl2.so.2()(64bit) is needed by (installed) sendmail<span class="string">-8</span>.13.8<span class="string">-8</span>.el5.x86_64</span><br><span class="line">libsasl2.so.2 is needed by (installed) openldap<span class="string">-2</span>.3.43<span class="string">-12</span>.el5.i386</span><br><span class="line">/usr/sbin/saslauthd is needed by (installed) sendmail<span class="string">-8</span>.13.8<span class="string">-8</span>.el5.x86_64</span><br><span class="line">[root@localhost courier-imap<span class="string">-4</span>.1.0]# rpm -qa | grep cyrus-sasl | xargs rpm -e --allmatches --nodeps</span><br></pre></td></tr></table></figure>

<p>好了,卸载成功!</p>
]]></content>
  </entry>
  <entry>
    <title>解决error The pkg-config script could not be found or is too old.</title>
    <url>/2012/12/15/1476/</url>
    <content><![CDATA[<p>报这个错误的原因是缺少pkgconfig这个包,下面该怎么做我不说您应该也知道了.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> pkgconfig</span><br></pre></td></tr></table></figure>
<p>重新编译 正常了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决ERROR!  dnet header not found</title>
    <url>/2013/07/29/1477/</url>
    <content><![CDATA[<p>编译安装snort出现错误:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">ERROR!? dnet header <span class="keyword">not</span> found, go <span class="built_in">get</span> <span class="keyword">it</span> <span class="built_in">from</span></span><br><span class="line"><span class="keyword">http</span>://code.google.com/p/libdnet/ <span class="keyword">or</span> use <span class="keyword">the</span> <span class="comment">--with-dnet-*</span></span><br><span class="line">options, <span class="keyword">if</span> you have <span class="keyword">it</span> installed <span class="keyword">in</span> <span class="keyword">an</span> unusual place</span><br></pre></td></tr></table></figure>

<p>解决办法是去<a href="http://code.google.com/p/libdnet/">http://code.google.com/p/libdnet/</a> 下载 libdnet-1.12.tgz.</p>
<p>然后:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">tar -zxvf libdnet-<span class="number">1.12</span>.tgz</span><br><span class="line"><span class="keyword">cd</span> libdnet-<span class="number">1.12</span></span><br><span class="line">./configure</span><br><span class="line"><span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>

<p>重新编译错误小时!!</p>
]]></content>
  </entry>
  <entry>
    <title>解决extman后台No such file or directory</title>
    <url>/2018/10/31/1479/</url>
    <content><![CDATA[<p>需要启动cmdserver,命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/var/</span>www<span class="regexp">/extsuite/</span>extman<span class="regexp">/daemon/</span>cmdserver -d</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决Failed dependencieslibcrypto.so.4 is needed</title>
    <url>/2012/12/13/1480/</url>
    <content><![CDATA[<p>libcrypto.so.4 and libssl.so.4 were provided by the package openssl097a,while libdb-4.2.so is provided by db4.<br>Check carefully the library versions inside the packages because they are updated frequently.</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$yum</span> install openssl097a db4</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$rpm</span> -ivh tripwire-2.4.0-1.i386.rpm</span></span><br></pre></td></tr></table></figure>

<p>OK!</p>
]]></content>
  </entry>
  <entry>
    <title>解决errormodules.dep (No such file or directory)</title>
    <url>/2016/02/04/1478/</url>
    <content><![CDATA[<p>错误是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">FATAL</span>: Could not load /lib/modules/<span class="number">2</span>.<span class="number">6</span>.<span class="number">18</span>-<span class="number">274</span>.<span class="number">7</span>.<span class="number">1</span>.el<span class="number">5</span>.<span class="number">028</span>stab<span class="number">095</span>.<span class="number">1</span>/modules.dep: No such file or directory</span><br></pre></td></tr></table></figure>

<p>只要执行一条命令就可以了.<br>首先要切换到root用户,</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su root</span></span><br></pre></td></tr></table></figure>

<p>然后运行</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">mkdir /lib/modules/`uname -r` &amp;&amp; depmod -a</span><br></pre></td></tr></table></figure>

<p>问题解决.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Failure (104) Can not open backing device</title>
    <url>/2017/11/09/1482/</url>
    <content><![CDATA[<p>错误:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Failure: (<span class="number">104</span>) Can not open backing device.</span><br><span class="line">Command <span class="string">&#x27;drbdsetup attach 1 /dev/sdb1 /dev/sdb1 internal&#x27;</span> terminated with <span class="keyword">exit</span> code <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>遇到这个错误的时候,我们要看一下是不是已经挂在了 <code>/dev/sbd1</code>,如果是的话就执行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">umount <span class="regexp">/dev/</span>sdb1</span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Failed to convert command to 8 bit charset</title>
    <url>/2014/04/19/1481/</url>
    <content><![CDATA[<p>今天试着用filezilla访问国内的一个ftp,filezilla总是报Failed to convert command to 8 bit charset错误,导致无法访问ftp资源,经过查找,原因是filezilla无法正确判断国内ftp服务器的字符集编码造成的, 具体解决方法是在filezilla的站点管理器里选择出错的站点,在它设置的字符集里面使用自定义的字符集,我用GB2312字符集解决了这个问题.当然你可以试着使用utf-8或者其他字符集,总之要和你的服务器的字符集相对应.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Fatal error Class &#39;ZipArchive&#39; not found</title>
    <url>/2019/01/30/1483/</url>
    <content><![CDATA[<p>出现这个错误说明是程序在调用’ZipArchive’ 这个类的时候没有成功,原因是由于在安装php的时候没有增加php zip的支持(非zlib).</p>
<p>在Windows下的解决办法是:</p>
<p>1、修改php配置文件:</p>
<p>在php.ini文件中,将extension=php_zip.dll前面的分号”;”去除;(如果没有,请添加extension=php_zip.dll此行并确保php_zip.dll文件存在相应的目录),然后同样在php.ini文件中,将:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">zlib.output_compression</span> = <span class="literal">Off</span> <span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">zlib.output_compression</span> = <span class="literal">On</span> <span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>2、重启Apache服务器</p>
<p>在Unix/Linux下的解决办法:</p>
<p>1、安装php的zip模块</p>
<p>在Linux下没有php_zip.dll这个文件(有也不会起作用的),所以需要重新编译一下php的zip模块.具体安装方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>src</span><br><span class="line">wget http:<span class="regexp">//</span>pecl.php.net<span class="regexp">/get/</span>zip</span><br><span class="line">tar -zxvf zip</span><br><span class="line">cd zip-<span class="number">1</span>.x.x</span><br><span class="line">phpize</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make instal</span><br></pre></td></tr></table></figure>

<p>其中, 在最后使用make install命令的时候,可能需要用到root的权限,所以建议使用sudo来运行.安装完之后,屏幕上会提示zip.so的位置.然后将其记录下来,如:<code>/usr/local/lib/php/extensions/zip.so</code>.</p>
<p>2、修改php配置文件</p>
<p>使用root权限修改php.ini(通常可能会在 <code>/usr/local/lib/</code>文件夹下,不过视当初安装php而定,可以通过phpinfo()来查看),增加:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">extension = <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>php<span class="regexp">/extensions/</span>zip.so</span><br></pre></td></tr></table></figure>

<p>然后同样在php.ini文件中:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">zlib.output_compression</span> = <span class="literal">Off</span> <span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">zlib.output_compression</span> = <span class="literal">On</span> <span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>3、最后别忘了重启一下</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service httpd restart</span></span><br></pre></td></tr></table></figure>

<p>这个针对php的zip模块就安装完成了,能够在php中使用ZipArchive类了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决fatalint18boot failure</title>
    <url>/2014/05/20/1484/</url>
    <content><![CDATA[<p>virtualbox 装系统出现 INT18:BOOT FAILURE fatal:int18:boot failure 原因是主分区没激活,要设置为活动分区. 把主分区设置为活动分区即可解决.</p>
<p>解决方法步骤:<br>1.去掉软驱.<br>2. 运行winudos用PE分区软件,启动后在开始-程序选择-分区软件 选中主分区,设置为活动分区即可(专对GHOST版本的XP系统)</p>
]]></content>
  </entry>
  <entry>
    <title>解决Generating SSH1 RSA host key   [FAILED]</title>
    <url>/2019/02/05/1485/</url>
    <content><![CDATA[<p>出现这个错误的原因是没有权限,</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su - root</span></span><br></pre></td></tr></table></figure>

<p>输入密码.<br>重新执行:</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">/etc/init.d/sshd start</span><br><span class="line">Generating SSH1 RSA host key:                              <span class="comment">[  OK  ]</span></span><br><span class="line">Generating SSH2 RSA host key:                              <span class="comment">[  OK  ]</span></span><br><span class="line">Generating SSH2 DSA host key:                              <span class="comment">[  OK  ]</span></span><br><span class="line">Starting sshd:                                             <span class="comment">[  OK  ]</span></span><br></pre></td></tr></table></figure>

<p>成功!</p>
]]></content>
  </entry>
  <entry>
    <title>解决here was an error collecting ganglia data (127.0.0.18652) fsockopen error Connection refused</title>
    <url>/2015/09/11/1486/</url>
    <content><![CDATA[<p>ganglia无法正常启动,打开的网页界面出现以下提示错误:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">There</span> was an <span class="literal">error</span> collecting ganglia data (<span class="number">127.0.0.1:8652</span>): fsockopen <span class="literal">error</span>: Connection refused</span><br></pre></td></tr></table></figure>

<p>网上搜到的解决方法是:service gmetad restart 重启一下gmetad.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="variable">$ </span>service gmetad status</span><br></pre></td></tr></table></figure>

<p>gmetad 已死,但是 subsys 被锁.</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line"><span class="comment">[root@localhost ~]</span>$ service gmetad restart</span><br><span class="line">Shutting down GANGLIA gmetad:                              <span class="comment">[失败]</span></span><br><span class="line">Starting GANGLIA gmetad:                                   <span class="comment">[确定]</span></span><br></pre></td></tr></table></figure>

<p>也有人介绍说:可以通过将 <code>/usr/local/rrdtool</code>的所有者改为nobody(原来为root).</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="keyword">chown</span> nobody /usr/<span class="keyword">local</span>/rrdtool</span><br></pre></td></tr></table></figure>

<p>我在另一台电脑上试验的时候,遇到了这个问题,上述两种方法都试过了,但没有解决.</p>
<p>我的解决办法:<br>在 <code>/var/www/html/ganglia</code>目录下的,可新建一个conf.php空白文档,然后从 <code>/usr/share/ganglia</code>下面找到相应的conf.php,把其内容全部复制给新建的conf.php.如果上面的办法还是不行的话,就把gmetad卸载,重新装一次,就成功了.具体如下:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="variable">$yum</span> <span class="builtin-name">remove</span> ganglia-web ganglia-gmetad</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]$yum install ganglia-web</span><br></pre></td></tr></table></figure>

<p>[注意]上面这一步会自动安装ganglia-gmetad,好像二者有依赖.</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line"><span class="built_in">[root</span>@localhost ~]<span class="variable">$service</span> gmetad <span class="keyword">start</span></span><br></pre></td></tr></table></figure>

<p>总结:遇到上面的问题,可能是ganglia-gmetad的安装顺序有问题.可在其它的软件安装、配置成功后,再安装gmetad.</p>
]]></content>
  </entry>
  <entry>
    <title>解决libexpat.so.1 is needed by avast4workstation-1.3.0-1.i586</title>
    <url>/2012/01/23/1488/</url>
    <content><![CDATA[<p>需要安装libexpat.</p>
<p>下载安装libexpat1-2.0.1-87.1.i386.rpm:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://rpm.pbone.net/index.php<span class="number">3</span>?stat=<span class="number">26</span>&amp;dist=<span class="number">55</span>&amp;size=<span class="number">149897</span>&amp;name=libexpat<span class="number">1</span>-<span class="number">2</span>.<span class="number">0</span>.<span class="number">1</span>-<span class="number">87</span>.<span class="number">1</span>.i<span class="number">386</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh libexpat<span class="number">1</span>-<span class="number">2</span>.<span class="number">0</span>.<span class="number">1</span>-<span class="number">87</span>.<span class="number">1</span>.i<span class="number">386</span>.rpm</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决insserv exiting now without changing boot order!</title>
    <url>/2009/08/01/1487/</url>
    <content><![CDATA[<p>解决方法:<br>编辑 <code>/etc/init.d/vzquota</code><br>在start(){   前面添加如下内容:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">### BEGIN INIT INFO</span></span><br><span class="line"><span class="meta"># Provides: OSSEC HIDS</span></span><br><span class="line"><span class="meta"># Required-Start: $network $remote_fs $syslog $time</span></span><br><span class="line"><span class="meta"># Required-Stop:</span></span><br><span class="line"><span class="meta"># Default-Start: 2 3 4 5</span></span><br><span class="line"><span class="meta"># Default-Stop: 0 1 6</span></span><br><span class="line"><span class="meta"># Short-Description: OSSEC HIDS</span></span><br><span class="line"><span class="meta">### END INIT INFO</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决libipvs.c357 error &#39;ipvs_get_service&#39; undeclared (first use in this function)</title>
    <url>/2014/05/24/1489/</url>
    <content><![CDATA[<p>在编译之前漏了做一个符号链接:<br>因为编译时要用kernel-source,而Makefile文件设置到kernel-source路径是 <code>/usr/src/linux</code>.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>src<span class="regexp">/kernels/</span><span class="number">2.6</span>.<span class="number">18</span>-<span class="number">92</span>.el5-i686<span class="regexp">/ /u</span>sr<span class="regexp">/src/</span>linux</span><br></pre></td></tr></table></figure>

<p>如果找不到2.6****的文件夹就:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> kernel kernel-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决linux 安装 Zend Optimizer出现的错误</title>
    <url>/2017/12/06/1490/</url>
    <content><![CDATA[<p>在 Fedora 10 安装 lighttpd + php5 + mysql5 + zend Optimizer.<br>前3个均可以用 yum 进行安装,很方便.<br>而 zend Optimizer 需要下载解压后,到解压目录输入:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">./<span class="keyword">install</span>.sh</span><br></pre></td></tr></table></figure>

<p>就会出现界面提示安装.安装后重启 lighttpd却没有成功启动zend Optimizer.</p>
<p>解决方法:</p>
<p>1.对于 php.ini文件路径有问题( 我的在 phpinfo()显示php.ini路径正确,我就不用这个方法 )<br>解决方法:</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">php -i <span class="string">| grep php.ini</span></span><br></pre></td></tr></table></figure>

<p>就可以找到当前php使用的php.ini文件.<br>如果php optimizer安装好了 却发现不能加载的话可以 手工指定读取php.ini文件的位置.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php -c <span class="regexp">/etc/</span> -v</span><br></pre></td></tr></table></figure>

<p>如果可以看到zend opt正确加载.<br>那么做个连接就好了,连接到php默认读取的php.ini路径下面:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">ln -sf /etc/php.ini /usr/<span class="keyword">local</span>/lib</span><br><span class="line">$ php -v</span><br><span class="line"></span><br><span class="line">PHP 5.2.5 (<span class="keyword">cli</span>) (built: Jan 22 2006 12:59:19)</span><br><span class="line"><span class="keyword">Copyright</span> (c) 1997-2006 The PHP Group</span><br><span class="line">Zend Engine v1.3.0, <span class="keyword">Copyright</span> (c) 1998-2004 Zend Technologies</span><br><span class="line">with Zend Extension Manager v1.0.9, <span class="keyword">Copyright</span> (c) 2003-2006, <span class="keyword">by</span> Zend Technologies</span><br><span class="line">with Zend Optimizer v3.3.2, <span class="keyword">Copyright</span> (c) 1998-2006, <span class="keyword">by</span> Zend Technologies</span><br></pre></td></tr></table></figure>

<p>Ok 正常了.</p>
<p>2.Failed loading /usr/local/Zend/lib/Optimizer-3.3.0/php-5.2.x/ZendOptimizer.so</p>
<p>php -i 中显示:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Failed loading <span class="regexp">/usr/</span>local<span class="regexp">/Zend/</span>lib<span class="regexp">/Optimizer-3.3.0/</span>php-<span class="number">5.2</span>.x<span class="regexp">/ZendOptimizer.so: /u</span>sr<span class="regexp">/local/</span>Zend<span class="regexp">/lib/</span>Optimizer-<span class="number">3.3</span>.<span class="number">0</span><span class="regexp">/php-5.2.x/</span>ZendOptimizer.so: cannot restore segment prot after reloc: Permission denied</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> -R <span class="number">777</span> /usr/local/Zend/lib/Optimizer-<span class="number">3</span>.<span class="number">3</span>.<span class="number">0</span>/php-<span class="number">5</span>.<span class="number">2</span>.x/ZendOptimizer.so</span><br></pre></td></tr></table></figure>

<p>3.最恶心的SElinux问题</p>
<p>SElinux导致PHP不能使用 <code>zend/lib</code>下的库文件.所以,即便是做了link也不行.只能够拷贝库文件到有权限的目录.或者直接关掉SElinux.<br>但我已在 <code>/etc/selinux/config</code> 的 SELINUX=disabled 关掉SElinux 还是不行, 再网络查询发现<br>在你保证SElinux 被disable后.还执行下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chcon -t texrel_shlib_t <span class="regexp">/usr/</span>local<span class="regexp">/Zend/</span>lib<span class="regexp">/Optimizer-3.3.0/</span>php-<span class="number">5.2</span>.x/ZendOptimizer.so</span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决memoryalloc12bytesreturnednull.</title>
    <url>/2012/10/10/1491/</url>
    <content><![CDATA[<p>打开<code>/etc/yum.conf</code>:<br>加入下面这行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">exclude</span>=filesystem</span><br></pre></td></tr></table></figure>
<p>重新升级.</p>
]]></content>
  </entry>
  <entry>
    <title>解决mysql error while loading shared libraries libmysqlclient.so.16 cannot open shared object file No such file or directory</title>
    <url>/2018/03/03/1492/</url>
    <content><![CDATA[<p>这个错误原因很简单,就是没有找到libmysqlclient.so.16,<br>我们可以用yum来安装它,<br>命令是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">yum install libmysqlclient.so.<span class="number">16</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>lib<span class="regexp">/libmysqlclient.so.18  /u</span>sr<span class="regexp">/lib/</span></span><br></pre></td></tr></table></figure>

<p>照做后仍然报错,原因是该方法适用于32位系统,64位系统应使用下面的这行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>lib<span class="regexp">/libmysqlclient.so.18  /u</span>sr<span class="regexp">/lib64/</span></span><br></pre></td></tr></table></figure>

<p>一共下载8M多的文件,然后启动mysql,错误消失.</p>
]]></content>
  </entry>
  <entry>
    <title>解决mysql远程链接1130错误</title>
    <url>/2018/02/15/1493/</url>
    <content><![CDATA[<p>因为没有远程访问权限,<br>登陆进入mysql:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> Host = <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> = <span class="string">&#x27;主数据库给从库开通的账号&#x27;</span></span><br><span class="line">FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>

<p>但是修改后要记得刷新权限,如果不刷新权限,重启数据库也可以.</p>
<p>否则修改了和没修改是一个样子的 ,会继续出现1130错误.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Nginx 24 Too Many Open Files</title>
    <url>/2016/09/03/1496/</url>
    <content><![CDATA[<p>首先运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su -nginx</span></span><br></pre></td></tr></table></figure>

<p>然后运行:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -Hn</span><br><span class="line"><span class="built_in">ulimit</span> -Sn</span><br></pre></td></tr></table></figure>

<p>这几条命令可以查看软硬文件句柄和打开文件数目,然后我们就可以提升打开文件的数目.<br>编辑 <code>／etc/sysctl.conf</code>:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>追加或者修改下面的行:</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">fs.<span class="keyword">file</span>-<span class="built_in">max</span> = <span class="number">70000</span></span><br></pre></td></tr></table></figure>

<p>保存并关闭文件.<br>编辑 <code>/etc/security/limits.conf</code>:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>security/limits.conf</span><br></pre></td></tr></table></figure>

<p>修改成类似下面的样子:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx</span> 　　soft 　　nofile 　　<span class="number">10000</span></span><br><span class="line"><span class="attribute">nginx</span> 　　hard　　nofile　　 <span class="number">30000</span></span><br></pre></td></tr></table></figure>

<p>这里设置的就是软硬文件句柄和打开文件数目,保存关闭后运行sysctl命令:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sysctl -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>这样我们做的修改会即使生效.<br>nginx也有类似的设置:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>conf/nginx.conf (视你的配置文件的位置而定)</span><br></pre></td></tr></table></figure>

<p>追加或者编辑:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">worker_rlimit_nofile 　　<span class="number">30000</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>保存并关闭文件,重新加载nginx配置,并重新执行开始查看软硬限制的命令:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - nginx</span><br><span class="line"><span class="built_in">ulimit</span> -Hn</span><br><span class="line"><span class="built_in">ulimit</span> -Sn</span><br><span class="line"><span class="comment">#反馈:</span></span><br><span class="line">30000</span><br><span class="line">10000</span><br></pre></td></tr></table></figure>

<p>最后设置nginx的一个参数:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">worker_rlimit_nofile 　　<span class="number">30000</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>这样我们就解决了Nginx: 24: Too Many Open Files这个错误.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Nexus Docker仓库无法搜索镜像（错误代码500）</title>
    <url>/2020/08/17/1495/</url>
    <content><![CDATA[<p>使用docker search来搜索镜像会返回500错误：</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">[root@localhost:~]# docker search idocker.io/hello-world</span><br><span class="line"><span class="keyword">Error </span>response from daemon: Unexpected status code 500</span><br></pre></td></tr></table></figure>

<p>因为平常不怎么使用搜索，而且Nexus前台也有镜像浏览页面，所以一直没花时间去解决。年前封网好不容易有点空闲，寻思着解决下。</p>
<p>经过定位，发现了问题所在：Nexus里面的Docker有3种类型仓库：group、hosted、proxy，也就是组合仓库、本地仓库和代理仓库，其中组合仓库就是本地仓库和代理仓库的聚合，通过测试发现只有本地仓库才支持search请求，其他2种类型仓库都会500错误。所以，报错的直接原因就是我将search的请求转发到了组合仓库导致的。</p>
<p>解决办法非常简单，在nginx转发里面加一条规则即可：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$request_uri</span> ~ <span class="string">&#x27;/search&#x27;</span>) &#123;</span><br><span class="line">        <span class="builtin-name">set</span> <span class="variable">$upstream</span> <span class="string">&quot;nexus_docker_put&quot;</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决NBVPS安装pptpd无法连接的问题</title>
    <url>/2014/02/19/1494/</url>
    <content><![CDATA[<p>安装完成后需要手动修改一下.<br>编辑:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>ppp/<span class="keyword">options</span>.pptpd</span><br></pre></td></tr></table></figure>
<p>把require-mppe-128前面加#号取消强制加密.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Please fix the library issues listed above and try again.</title>
    <url>/2013/12/17/1500/</url>
    <content><![CDATA[<p>安装rrdtool之前确保安装了这些库:</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="title">yum</span> install zlib libpng free<span class="keyword">type</span> libart_lgpl libart_lgpl-devel libxml*</span><br></pre></td></tr></table></figure>

<p>如果还是没用:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> -y install pango*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">Libraries</span>: -lxml<span class="number">2</span> -lcairo -lcairo -lcairo -lm -lcairo -lpng<span class="number">12</span> -lglib-<span class="number">2</span>.<span class="number">0</span> -lpangocairo-<span class="number">1</span>.<span class="number">0</span> -lpango-<span class="number">1</span>.<span class="number">0</span> -lcairo -lgobject-<span class="number">2</span>.<span class="number">0</span> -lgmodule-<span class="number">2</span>.<span class="number">0</span> -lglib-<span class="number">2</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>解决问题 如果源里没有自己手动编译安装.</p>
]]></content>
  </entry>
  <entry>
    <title>解决No backends or directors found in VCL program, at least one is necessary. Running VCC-compiler failed, exit 1</title>
    <url>/2013/02/12/1497/</url>
    <content><![CDATA[<p>安装varnish的时候看网上教程运行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">varnishd -f <span class="regexp">/usr/</span>local<span class="regexp">/varnish/</span>etc<span class="regexp">/varnish/</span><span class="keyword">default</span>.vcl -s malloc,<span class="number">1</span>G -g varnish -u varnish -T <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2000</span></span><br></pre></td></tr></table></figure>

<p>出现错误:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">No backends or directors found <span class="keyword">in</span> VCL program, at least one is necessary. Running VCC-compiler failed, <span class="keyword">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>发现错误的原因是default.vcl配置文件路径出错,解决办法就是删除 <code>-f /usr/local/varnish/etc/varnish/default.vcl</code> 参数启动,如果启动不了就需要:</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -<span class="built_in">name</span> <span class="keyword">default</span>.vcl</span><br></pre></td></tr></table></figure>

<p>填写正确路径就可以正常启动了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决password file must not be other-accessible</title>
    <url>/2018/01/09/1498/</url>
    <content><![CDATA[<p>到这这个错误的原因有两个都是很好解决的.<br>1.Server和Client端的 server.pass 文件保持属主的600权限.<br>2.文件只保存log的密码,格式”password”,而不需要这样 “user:password”. </p>
]]></content>
  </entry>
  <entry>
    <title>解决Please install the GNU compiler.</title>
    <url>/2014/10/13/1501/</url>
    <content><![CDATA[<p>今天站长在安装VirtualBox的时候遇到这个错误,后来发现是gcc没有安装导致的.</p>
<p>解决办法</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc</span><br></pre></td></tr></table></figure>
<p>如果网络不好可能要等一会~</p>
]]></content>
  </entry>
  <entry>
    <title>解决perl warning Setting locale failed.  Cannot set LC_CTYPE to default locale</title>
    <url>/2018/01/11/1499/</url>
    <content><![CDATA[<p>用apt-get安装ppp 出现错误如下:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">mail:/etc<span class="comment"># apt-get install pptp</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading <span class="keyword">state</span> information... Done</span><br><span class="line">E: Couldn&#x27;t find package pptp</span><br><span class="line">mail:/etc<span class="comment"># apt-get install ppp</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading <span class="keyword">state</span> information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">ppp</span><br><span class="line"><span class="number">0</span> upgraded, <span class="number">1</span> newly installed, <span class="number">0</span> <span class="keyword">to</span> remove and <span class="number">281</span> not upgraded.</span><br><span class="line">Need <span class="keyword">to</span> get <span class="number">356</span>kB of archives.</span><br><span class="line">After this operation, <span class="number">1069</span>kB of additional disk space will be used.</span><br><span class="line">Get:<span class="number">1</span> http://mirror.peer1.net stable/main ppp <span class="number">2.4</span>.<span class="number">5</span>-<span class="number">4</span> [<span class="number">356</span>kB]</span><br><span class="line">Fetched <span class="number">356</span>kB <span class="keyword">in</span> <span class="number">1</span>s (<span class="number">206</span>kB/s)</span><br><span class="line">perl: warning: Setting locale failed.</span><br><span class="line">perl: warning: Please check that your locale settings:</span><br><span class="line">LANGUAGE = (unset),</span><br><span class="line">LC_ALL = (unset),</span><br><span class="line">LANG = <span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">are supported and installed <span class="keyword">on</span> your system.</span><br><span class="line">perl: warning: Falling back <span class="keyword">to</span> the standard locale (<span class="string">&quot;C&quot;</span>).</span><br><span class="line">locale: Cannot <span class="built_in">set</span> LC_CTYPE <span class="keyword">to</span> <span class="keyword">default</span> locale: No such file or directory</span><br><span class="line">locale: Cannot <span class="built_in">set</span> LC_MESSAGES <span class="keyword">to</span> <span class="keyword">default</span> locale: No such file or directory</span><br><span class="line">locale: Cannot <span class="built_in">set</span> LC_ALL <span class="keyword">to</span> <span class="keyword">default</span> locale: No such file or directory</span><br><span class="line">Selecting previously deselected package ppp.</span><br></pre></td></tr></table></figure>

<p>解决办法简单,只要执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">dpkg-reconfigure locales</span></span><br></pre></td></tr></table></figure>

<p>然后在弹出的页面选择对应的选项就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Putty出现Network errorSoftware caused connection abort</title>
    <url>/2013/06/18/1502/</url>
    <content><![CDATA[<!--markdown-->1. PuTTY的Connection项目中设定"Sending of null packets to keep session active",也就是每隔几秒传送一个null packet让session不会timeout.
<p>2.启用sshd host的 <code>/etc/ssh/sshd_config</code> 设定值:TCPKeepAlive yes.</p>
]]></content>
  </entry>
  <entry>
    <title>解决putty自动断开的问题</title>
    <url>/2016/05/16/1503/</url>
    <content><![CDATA[<p>报错：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Network</span> <span class="literal">error</span>Software caused connection abort</span><br></pre></td></tr></table></figure>
<ol>
<li>在PuTTY的Connection项目中设定”Sending of null packets to keep session active” 也就是每隔几秒传送一个 null packet 让 session不会 timeout .</li>
<li>启用 sshd host 的 <code>/etc/ssh/sshd_config</code> 设定值: TCPKeepAlive yes .</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>解决Reverse Mapping Checking - Possible Break-in Attempt Error with SSH</title>
    <url>/2018/11/04/1504/</url>
    <content><![CDATA[<p>今天在使用SCP的时候遇到个一个error,如下:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">reverse mapping checking getaddrinfo <span class="keyword">for</span> <span class="module-access"><span class="module"><span class="identifier">XXX</span>.</span><span class="module"><span class="identifier">XXXX</span>.</span></span>com failed - POSSIBLE BREAKIN ATTEMPT!</span><br></pre></td></tr></table></figure>

<p>我用ssh 连接了一下XXX.XXXX.com,同样的问题:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">reverse</span> mapping checking getaddrinfo for sXXX.XXXX.com failed - POSSIBLE BREAKIN ATTEMPT!</span><br><span class="line"><span class="attribute">Last</span> login: Mon May  <span class="number">5</span> <span class="number">16</span>:<span class="number">50</span>:<span class="number">08</span> <span class="number">2008</span> from <span class="number">192.168.82.128</span></span><br></pre></td></tr></table></figure>

<p>但是,还是能进入 XXX.XXXX.com.<br>找到以下解释:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Reverse</span> <span class="keyword">Mapping</span> Checking - Possible Break-<span class="keyword">in</span> Attempt Error <span class="keyword">with</span> SSH</span><br><span class="line">Posted May <span class="number">2</span>nd, <span class="number">2008</span> <span class="keyword">in</span> Linux/Unix/BSD</span><br><span class="line"><span class="keyword">When</span> you <span class="keyword">connect</span> <span class="keyword">to</span> a host <span class="keyword">using</span> SSH <span class="keyword">or</span> SFTP it does a series <span class="keyword">of</span> checks <span class="keyword">to</span> ensure you are connecting <span class="keyword">to</span> the host you are expecting <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span>. One <span class="keyword">of</span> these <span class="keyword">is</span> a <span class="keyword">reverse</span> lookup <span class="keyword">on</span> the IP address <span class="keyword">to</span> <span class="keyword">check</span> the hostname <span class="keyword">is</span> the same <span class="keyword">as</span> the hostname you are connecting <span class="keyword">to</span>. <span class="keyword">If</span> it<span class="string">&#x27;s not, you&#x27;</span>ll <span class="keyword">get</span> an error message <span class="keyword">like</span> &quot;reverse mapping checking getaddrinfo for ... POSSIBLE BREAK-IN ATTEMPT!&quot;. The post looks at a solution <span class="keyword">to</span> this message.</span><br></pre></td></tr></table></figure>

<p>当使用SSH或SFTP连接某个host时,会有一系列的检查以保证你能够连接到你想连接的机器.其中一项是 “reverse lookup on the IP address”检查机器名称和你要连接的机器名称一致.否则,你会得到这样一个错误信息:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;reverse mapping checking getaddrinfo for ... POSSIBLE BREAK-IN ATTEMPT!&quot;</span>.</span><br><span class="line">Connecting <span class="keyword">from</span> <span class="keyword">the</span> command line, you might enter something like this:</span><br><span class="line">ssh <span class="keyword">my</span>.example.comand <span class="keyword">get</span> <span class="keyword">some</span> output like this:</span><br><span class="line">Connecting <span class="keyword">to</span> <span class="keyword">my</span>.example.com...<span class="built_in">reverse</span> mapping checking getaddrinfo <span class="keyword">for</span> <span class="number">192</span><span class="number">-168</span><span class="number">-1</span><span class="number">-243.</span>foo.bar.net failed - POSSIBLE BREAK-IN ATTEMPT!</span><br><span class="line">chris@<span class="keyword">my</span>.example.com&#x27;s password:What this <span class="keyword">is</span> telling us <span class="keyword">is</span> <span class="keyword">that</span> although we are connecting <span class="keyword">to</span> <span class="keyword">my</span>.example.com <span class="keyword">the</span> IP address <span class="keyword">of</span> <span class="keyword">the</span> server we are connecting <span class="keyword">to</span> actually maps <span class="keyword">back</span> <span class="keyword">to</span> <span class="number">192</span><span class="number">-168</span><span class="number">-1</span><span class="number">-243.</span>foo.bar.net <span class="keyword">in</span> this example. When this actually happened <span class="keyword">to</span> <span class="keyword">me</span>, <span class="keyword">it</span>&#x27;s because <span class="keyword">the</span> <span class="built_in">reverse</span> DNS had <span class="keyword">not</span> been <span class="keyword">set</span> up <span class="keyword">for</span> <span class="keyword">the</span> server (which would map e.g. <span class="number">192.168</span><span class="number">.1</span><span class="number">.243</span> <span class="keyword">to</span> <span class="keyword">my</span>.example.com <span class="keyword">as</span> well <span class="keyword">as</span> vice versa)</span><br></pre></td></tr></table></figure>

<p>这是告诉我们,尽管我们在连接my.example.com ,但是实际上该server的IP 地址对应到192-168-1-243.foo.bar.net .但这个发生的时候,就是因为server 上的reverse DNS 没有设置好.<br>举例说,应该是把192.168.1.243 映射到 my.example.com .</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Because I knew this reverse mapping was OK, I can <span class="built_in">add</span> <span class="keyword">an</span> entry <span class="built_in">to</span> my hosts <span class="built_in">file</span> <span class="keyword">and</span> <span class="keyword">it</span> will <span class="built_in">stop</span> <span class="keyword">the</span> error message <span class="built_in">from</span> happening. For <span class="keyword">the</span> above example, I would <span class="built_in">add</span> <span class="keyword">the</span> following <span class="built_in">to</span> my hosts <span class="built_in">file</span>:</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.243</span>  my.example.com,Now when I <span class="built_in">log</span> <span class="keyword">in</span> <span class="keyword">using</span> SSH <span class="built_in">from</span> <span class="keyword">the</span> <span class="keyword">command</span> <span class="title">line</span> <span class="title">I</span> <span class="title">won</span><span class="string">&#x27;t get that error message any more.</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决rsync error error in socket IO (code 10) at clientserver.c</title>
    <url>/2018/04/07/1505/</url>
    <content><![CDATA[<p>报错:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">rsync: failed <span class="keyword">to</span> connect <span class="keyword">to</span> **.**.**.**: <span class="literal">No</span><span class="built_in"> route </span><span class="keyword">to</span> host (113)</span><br><span class="line">rsync error: <span class="builtin-name">error</span> <span class="keyword">in</span> socket IO (code 10) at clientserver.c(104) [<span class="attribute">receiver</span>=2.6.9]</span><br></pre></td></tr></table></figure>

<p>解决:对方没开机、没开rsync、防火墙阻挡、通过的网络上有防火墙阻挡,都有可能.关闭防火墙,其实就是把tcp udp 的873端口打开.</p>
]]></content>
  </entry>
  <entry>
    <title>解决snort安装出现   ERROR!  Libpcre header not found.</title>
    <url>/2015/05/08/1507/</url>
    <content><![CDATA[<p>错误原文:</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">checking pcre.h usability<span class="params">...</span> no</span><br><span class="line">checking pcre.h presence<span class="params">...</span> no</span><br><span class="line">checking for pcre.h<span class="params">...</span> no</span><br><span class="line"></span><br><span class="line">ERROR!? Libpcre <span class="keyword">header</span> <span class="literal">not</span> found.</span><br><span class="line">Get it from http:<span class="comment">//www.pcre.org</span></span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> pcre*</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决statically from the source with nginx by using --with-pcre= option.</title>
    <url>/2012/03/12/1508/</url>
    <content><![CDATA[<p>原因是pcre没有找到.</p>
<p>PCRE是perl所用到的正则表达式,目的是让所装的软件支持正则表达式.默认情况下,Nginx只处理静态的网页请求,也就是html.如果是来自动态的网页请求,比如*.php,那么Nginx就要根据正则表达式查询路径,然后把*.PHP交给PHP去处理.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ rpm -qa | grep pcre</span><br><span class="line"><span class="regexp">//</span>查询系统中有没有安装PCRE,一般装系统是默认装有,所以我们要删掉系统自带的.</span><br><span class="line"></span><br><span class="line">$ cp <span class="regexp">/lib/</span>libpcre.so.<span class="number">0</span> /</span><br><span class="line"><span class="regexp">//</span>在删除系统自带的PCRE之前,要先备份一下libpcre.so.<span class="number">0</span>这个文件,因为RPM包的关联性太强,在删除后没libpcre.so.<span class="number">0</span>这个文件时我们装PCRE是装不上的</span><br><span class="line"></span><br><span class="line">$ rpm -e –nodeps pcre-<span class="number">6.6</span>-<span class="number">1.1</span></span><br><span class="line"><span class="regexp">//</span>删除系统自带的PCRE</span><br></pre></td></tr></table></figure>

<p>进入<a href="ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/">ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/</a> 下载最新版本的pcre,然后编译安装.</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> tar zxvf pcre<span class="number">-8.00</span>.tar.gz</span><br><span class="line"><span class="symbol">$</span> cd pcre<span class="number">-8.00</span></span><br><span class="line"><span class="symbol">$</span> cp /libpcre.so<span class="number">.0</span> /lib/</span><br><span class="line"><span class="comment">//把我们删除系统自带的PCRE之前备份的libpcre.so.0拷贝到/lib 目录下</span></span><br><span class="line"><span class="symbol">$</span> ./configure</span><br><span class="line"><span class="comment">//配置PCRE,因为PCRE是一个库,而不是像pache、php、postfix等这样的程序,所以我们安装时选择默认路径即可,这样会在后面安装其它东西时避免一些不必要的麻烦,执行完这部后会显示出下图,上面显示了我们对PCRE的配置</span></span><br><span class="line"><span class="symbol">$</span> make &amp;&amp; make install</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决ruby command not found</title>
    <url>/2017/01/13/1506/</url>
    <content><![CDATA[<p>错误:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">sudo: <span class="keyword">ruby</span>: <span class="keyword">command</span> not found</span><br></pre></td></tr></table></figure>

<p>所以还要建立以下软链接:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/ruby/</span>bin<span class="regexp">/ruby /u</span>sr<span class="regexp">/bin/</span>ruby</span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/ruby/</span>bin<span class="regexp">/gem /u</span>sr<span class="regexp">/bin/g</span>em</span><br></pre></td></tr></table></figure>

<p>然后执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo gem -v</span></span><br></pre></td></tr></table></figure>

<p>输出 1.3.7.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Strict Standards Only variables should be passed by reference in</title>
    <url>/2012/05/19/1509/</url>
    <content><![CDATA[<p>这个错误的 原因主要是php版本太高导致的.换5.3或者以下的php就好了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决SVN dbtxn-current-lock Permission denied</title>
    <url>/2011/08/08/1512/</url>
    <content><![CDATA[<p>报错如下:</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">Can<span class="symbol">&#x27;t</span> <span class="keyword">open</span> <span class="keyword">file</span> <span class="symbol">&#x27;XXXXXXXXdbtxn</span>-current-lock&#x27;: 拒绝访问</span><br><span class="line">Error1: Can<span class="symbol">&#x27;t</span> <span class="keyword">open</span> <span class="symbol">&#x27;db</span>/txn-current-lock&#x27;: Permission denied</span><br></pre></td></tr></table></figure>

<p>解决方法:添加读写权限.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">LINUX :chmod –R o+rw <span class="regexp">/home/</span>svn</span><br><span class="line">windows :属性中操作一下,添加对应的用户,然后设置上权限.</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决SVN authorization failed异常</title>
    <url>/2016/09/30/1511/</url>
    <content><![CDATA[<p>安装SVN时报异常:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Subclipse</span> Integration for Mylyn <span class="number">3</span>.x (Optional) (<span class="number">3</span>.<span class="number">0</span>.<span class="number">0</span>) requires plug-in <span class="string">&quot;org.eclipse.mylyn.tasks.core (3.0.0)&quot;</span>, or compatible</span><br></pre></td></tr></table></figure>

<p>这只要反subclipse选择框打开并把包含Integrations字样的选择框,也就是报错的那个不要勾上就好了.<br>安装好SVN后新建URL是报些错:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">org<span class="selector-class">.tigris</span><span class="selector-class">.subversion</span><span class="selector-class">.javahl</span><span class="selector-class">.ClientException</span>:</span><br><span class="line">Authorization failed</span><br><span class="line">SVN:认证失败</span><br></pre></td></tr></table></figure>

<p>如果你是客户端,就让别人给你权限.<br>如果能改文件,则尝试以下修改:</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">vi svnserve.conf:</span><br><span class="line"></span><br><span class="line">[general]</span><br><span class="line"><span class="attr">anon-access</span> = read</span><br><span class="line"><span class="attr">auth-access</span> = write</span><br><span class="line"><span class="attr">password-db</span> = passwd</span><br><span class="line"><span class="attr">authz-db</span> = authz</span><br><span class="line"></span><br><span class="line">passwd:</span><br><span class="line">[users]</span><br><span class="line"><span class="attr">harry</span> = harryssecret</span><br><span class="line"></span><br><span class="line">authz:</span><br><span class="line">[groups]</span><br><span class="line">[/]</span><br><span class="line"><span class="attr">harry</span> = rw</span><br></pre></td></tr></table></figure>

<p>出现authorization failed异常,一般都是authz文件里,用户组或者用户权限没有配置好,只要设置[/]就可以,代表根目录下所有的资源,如果要限定资源,可以加上子目录即可.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> anon_access = <span class="built_in">read</span></span></span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">anon_access</span> = none</span><br></pre></td></tr></table></figure>

<p>即不允许匿名用户.</p>
]]></content>
  </entry>
  <entry>
    <title>解决svn UUID报错</title>
    <url>/2017/04/29/1513/</url>
    <content><![CDATA[<p>解决</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svn</span>: Repository UUID &#x27;<span class="number">22</span>fb<span class="number">7890</span>-<span class="number">89</span>d<span class="number">5</span>-<span class="number">447</span>f-<span class="number">8642</span>-daadc<span class="number">72</span>b<span class="number">0</span>a<span class="number">20</span>&#x27; doesn&#x27;t match expected UUID &#x27;aeb<span class="number">8522</span>d-f<span class="number">24</span>f-<span class="number">4</span>b<span class="number">0</span>c-<span class="number">838</span>f-<span class="number">60</span>a<span class="number">56</span>c<span class="number">7</span>c<span class="number">1</span>c<span class="number">6</span>f&#x27;</span><br></pre></td></tr></table></figure>

<p>使用 svnlook uuid查看项目UUID ,后面的是库路径 <code>svnlook uuid /opt/svn/seckill</code></p>
<p>返回22fb7890-89d5-447f-8642-daadc72b0a20<br>使用svnadmin setuuid修改UUID</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">svnadmin</span> setuuid /opt/svn/seckill aeb<span class="number">8522</span>d-f<span class="number">24</span>f-<span class="number">4</span>b<span class="number">0</span>c-<span class="number">838</span>f-<span class="number">60</span>a<span class="number">56</span>c<span class="number">7</span>c<span class="number">1</span>c<span class="number">6</span>f</span><br></pre></td></tr></table></figure>

<p>然后svn co 成功.</p>
]]></content>
  </entry>
  <entry>
    <title>解决su - 后显示-bash-4.1#</title>
    <url>/2013/08/25/1510/</url>
    <content><![CDATA[<p>问题:我每次su -就出现这种界面 <code>bash-4.1#:</code>,而且进入其他目录不显示.</p>
<p>解答:应该是删了/root 目录下的文件,通过这样修复下应该就可以了,到自己家目录拷贝 <code>.bashrc</code>和 <code>.bash_profile</code>,到 <code>/root</code>目录即可.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">bash<span class="literal">-4</span>.<span class="number">1</span><span class="variable">$</span> <span class="built_in">cd</span> /home/wangshuxun</span><br><span class="line">bash<span class="literal">-4</span>.<span class="number">1</span><span class="variable">$</span> <span class="built_in">cd</span> ./.bashrc /root</span><br><span class="line">bash<span class="literal">-4</span>.<span class="number">1</span><span class="variable">$</span> <span class="built_in">cp</span> ./.bash_profile /root</span><br><span class="line">bash<span class="literal">-4</span>.<span class="number">1</span><span class="variable">$</span> su - wangshuxun</span><br><span class="line">[<span class="type">wangshuxun</span>@<span class="type">localhost</span> ~]<span class="variable">$</span> su root</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>完美解决.</p>
]]></content>
  </entry>
  <entry>
    <title>解决Table &#39;mysql.servers&#39; doesn&#39;t exist</title>
    <url>/2011/05/22/1514/</url>
    <content><![CDATA[<p>第一个试过可以:</p>
<p>使用MySQL Query Browser为mysql库创建缺失的表.<br>系统数据库(mysql) 缺少表的创建sql命令为:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> servers (</span><br><span class="line">Server_name <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Host <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Db <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Username <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">Password</span> <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Port <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Socket <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">Wrapper</span> <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">Owner</span> <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY KEY</span> (Server_name)</span><br><span class="line">) ENGINE=MyISAM <span class="keyword">DEFAULT</span> CHARSET=utf8 <span class="keyword">COMMENT</span>=<span class="string">&#x27;MySQL Foreign Servers table&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>另外一种解决办法是:进入Mysql的bin目录运行:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">mysql -u root -<span class="selector-tag">p</span> mysql</span><br></pre></td></tr></table></figure>

<p>输入密码后运行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SOURCE</span> ..<span class="regexp">/share/my</span>sql_fix_privilege_tables.sql</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决The package lists or status file could not be parsed or opened.</title>
    <url>/2015/10/08/1515/</url>
    <content><![CDATA[<p>在使用Ubuntu apt-get命令时发现如下错误:</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">E: The package lists or <span class="keyword">status</span> <span class="keyword">file</span> could not be parsed or <span class="keyword">opened</span>.</span><br></pre></td></tr></table></figure>

<p>解决方法是删除 <code>/var/lib/apt/lists</code>下的文件,然后:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>

<p>即可.<br>ps:虽然知道了解决办法,但是却不明白为什么会出现这个错误……..</p>
]]></content>
  </entry>
  <entry>
    <title>解决These critical programs are missing or too old as ld</title>
    <url>/2012/12/20/1516/</url>
    <content><![CDATA[<p>安装 glibc2.4时遇到这个错误,<br>看了网上的很多教程都没有解决这个问题,<br>原来是这个包太旧了,官方的最新包是glibc.2.15,<br>所以只要下载最新的安装包就不会出现这个问题了.<br>官网:<a href="http://ftp.gnu.org/gnu/glibc/">http://ftp.gnu.org/gnu/glibc/</a></p>
]]></content>
  </entry>
  <entry>
    <title>解决thread.error can&#39;t start new thread</title>
    <url>/2017/12/23/1517/</url>
    <content><![CDATA[<p>在执行yum install vsftpd的时候报错:</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">thread.<span class="literal">error</span>: can<span class="symbol">&#x27;t</span> start <span class="keyword">new</span> thread</span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>禁用fastestmirror就可以了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span><span class="regexp">/pluginconf.d/</span>fastestmirror.conf</span><br></pre></td></tr></table></figure>

<p>将:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>修改为:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">enabled</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决VHCS2的中文乱码</title>
    <url>/2015/01/05/1518/</url>
    <content><![CDATA[<p>VHCS2默认已经安装了中文包了,但是切换到中文包的时候,会乱码,显示不正确,这里,我们要重新安装汉化文件:<br>(1)用管理员帐号登录VHCS2,找到 &gt;Multilanguage,点Chinese后面的uninstall,删除中文语言包.<br>(2)将VHCS2.4.7.1内的<code>/language-files/chinese/vhcs2.4.7.1-chinese-v1.txt</code>下载回本地,用记事本打开,将编码改成UTF-8然后保存.<br>(3)打开存为UTF-8的vhcs2.4.7.1-chinese-v1.txt,找到encoding = GB2312,将其改为encoding =utf-8,保存.<br>(4)用管理员帐号登录VHCS2,找到 &gt;Multilanguage,在Install new language下面,浏览到您修改后的vhcs2.4.7.1-chinese-v1.txt语言包文件,然后点install.<br>(5)用管理员帐号登录VHCS2,找到 &gt;Multilanguage,选中Chinese后面的单选框,然后点下面的”save”保存!刷新页面,界面就变成中文的了!</p>
]]></content>
  </entry>
  <entry>
    <title>解决wamp本地web界面看不到网站文件夹</title>
    <url>/2011/01/28/1519/</url>
    <content><![CDATA[<p>删除.htaccess文件可以恢复正常,上传服务器的时候,在把那个文件放回去就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决waney 553 Could not create file (vsftpd)</title>
    <url>/2015/07/18/1520/</url>
    <content><![CDATA[<p>解决办法终端运行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">setsebool</span> -P allow_ftpd_full_access <span class="number">1</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>解决wordpress提示No input file specified</title>
    <url>/2015/11/10/1521/</url>
    <content><![CDATA[<p>一般在nginx的环境下容易出现这个问题,原因是进入后台的路径如写有问题,</p>
<p>比如<a href="http://www.baidu.com/wp-admin">http://www.baidu.com/wp-admin</a> 和<a href="http://www.baidu.com/wp-admin/">http://www.baidu.com/wp-admin/</a> 是不一样的 站长这里前者会出现问题,而后者没有.</p>
<p>就是这个符号解决了站长的问题,希望也通向能解决大家的类似问题.</p>
]]></content>
  </entry>
  <entry>
    <title>解决zabbix 图形中文乱码</title>
    <url>/2019/05/28/1522/</url>
    <content><![CDATA[<p>Zabbix安装好之后,监控图形页面出现字符集乱码.</p>
<p>解决方法:</p>
<p>1、复制本地电脑 <code>C:\Windows\Fonts\simkai.ttf</code>(楷体)上传到zabbix服务器网站目录的fonts目录下.</p>
<p>2、zabbix网站目录fonts目录查找如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ whereis zabbix</span><br><span class="line">zabbix: <span class="regexp">/usr/</span>lib<span class="regexp">/zabbix /</span>etc<span class="regexp">/zabbix /u</span>sr<span class="regexp">/share/</span>zabbix</span><br><span class="line">$ cd <span class="regexp">/usr/</span>share<span class="regexp">/zabbix/</span>fonts/</span><br><span class="line">$ ll</span><br><span class="line">总用量 <span class="number">23024</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root       <span class="number">33</span> <span class="number">4</span>月  <span class="number">10</span> <span class="number">11</span>:<span class="number">20</span> graphfont.ttf -&gt; <span class="regexp">/etc/</span>alternatives/zabbix-web-font</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">11787224</span> <span class="number">12</span>月 <span class="number">21</span> <span class="number">2017</span> msyh.ttf</span><br></pre></td></tr></table></figure>

<p>3、graphfont.ttf是zabbix默认字符集,现在需要把PC拿到的字体上传到 <code>/usr/share/zabbix/fonts/</code>这个目录下.</p>
<p>4、在zabbix服务器端fonts目录下,就能看到添加的楷体字符集.(这里要留意拷贝进入的字体的权限,最好给777.要不会影响到zabbix图形显示异常).</p>
<p>5、切换至 <code>/etc/alternatives</code>,就可以看到默认软链接指向的字符集.</p>
<p>6、删除默认软链接的字符集,指向新安装的字符集:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ rm -f <span class="regexp">/etc/</span>alternatives/zabbix-web-font </span><br><span class="line">$ ln -s <span class="regexp">/usr/</span>share<span class="regexp">/zabbix/</span>fonts<span class="regexp">/simkai.ttf /</span>etc<span class="regexp">/alternatives/</span>zabbix-web-font</span><br></pre></td></tr></table></figure>

<p>8、重启zabbix-server服务</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ systemctl <span class="keyword">restart</span> zabbix-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>9、web端确认成功.</p>
<p>另外一种原因是,创建数据的时候没有指定好字符集.</p>
]]></content>
  </entry>
  <entry>
    <title>解决安装memcache出现&#39;Z_BUF_ERROR&#39; undeclared (first use in this function)错误</title>
    <url>/2014/10/31/1523/</url>
    <content><![CDATA[<p>原因是zlib没有安装.</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">yum install <span class="literal">zlib</span> <span class="literal">zlib</span>-devel</span><br></pre></td></tr></table></figure>
<p>再次编译 正常通过.</p>
]]></content>
  </entry>
  <entry>
    <title>解决安装ubuntu过程中卡住</title>
    <url>/2016/09/22/1524/</url>
    <content><![CDATA[<p>解决办法很简单,拔掉网线,无线网络的话就点击安装界面右上角的无线网络图标,然后去掉enable networking前面的钩,问题解决.</p>
]]></content>
  </entry>
  <entry>
    <title>解决本地连接老是正在获取网络地址</title>
    <url>/2014/08/09/1525/</url>
    <content><![CDATA[<p>可以手动配置一下网络,ip地址、网关、子网掩码、dns手动设置一下,<br>如果还不行,一般就是服务问题, 查看一下:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">DHCP Client</span><br><span class="line">Network <span class="keyword">Location</span> <span class="title">Awareness</span></span><br></pre></td></tr></table></figure>

<p>服务开启了没有.</p>
]]></content>
  </entry>
  <entry>
    <title>解决服务器用localhost可以访问IP地址不能访问</title>
    <url>/2012/01/31/1526/</url>
    <content><![CDATA[<p>apache的默认监听地址不正确.</p>
<p>修改 <code>/httpd/conf/httpd.conf</code>文件的监听端口:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">listen</span></span> <span class="number">127.0.0.1:80</span></span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">listen</span></span> <span class="number">0.0.0.0:80</span></span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决浏览器被劫持</title>
    <url>/2012/09/07/1528/</url>
    <content><![CDATA[<p>原因是你安装了p2p终结者,关闭或者删除就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决乐宝贝无法同步宝宝名单</title>
    <url>/2011/04/08/1527/</url>
    <content><![CDATA[<p>2019年8月22日更新:<br>看到这篇文章,想起了和王总在南昌广电幼儿园安装门禁的那段不堪回首的往事.</p>
<p>历史内容:<br>症状主要为在网站后台添加了宝宝,但是乐宝贝服务却无法在本地看到宝宝名单,<br>解决这个错误的方法是,把时间文件里的时间往前修改,然后清空当天缓存文件里的内容,<br>重启服务,解决问题.</p>
]]></content>
  </entry>
  <entry>
    <title>解决升级avast出现 An error occured in avast!</title>
    <url>/2017/12/26/1529/</url>
    <content><![CDATA[<p>解决办法是:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo sysctl -w kernel.<span class="attribute">shmmax</span>=128000000</span><br></pre></td></tr></table></figure>

<p>然后,再打开Avast 杀毒,软件正常.</p>
]]></content>
  </entry>
  <entry>
    <title>解决我检测到已有一个面板在运行,现在将退出</title>
    <url>/2019/04/10/1530/</url>
    <content><![CDATA[<p>直接执行<code>killall gnome-panel</code>和<code>gnome-panel</code>命令,就可以重启任务栏,但是不能动系统菜单要不就又卡死了.</p>
]]></content>
  </entry>
  <entry>
    <title>解决无法连接主机 192.168.2.133  套接字操作尝试一个无法连接的主机.</title>
    <url>/2013/01/18/1531/</url>
    <content><![CDATA[<p>在 <code>/etc/sysconfig/iptables</code>中的最后一行上面添加:</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">-A RH-Firewall-<span class="number">1</span>-INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">3690</span> -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>即可.</p>
<p>或者直接关闭防火墙:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables stop</span><br></pre></td></tr></table></figure>

<p>用root帐号登录后,看了一下 <code>/etc/sysconfig/iptables</code>的内容,发现ssh (端口号是22)也有一个同样的语句,只除了”–dport”后面不一样,其他都相同.</p>
<p>保存后重启防火墙:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service iptables restart</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>解决主从数据库出现 Slave_IO_Running NO 以及远程访问mysql数据库</title>
    <url>/2018/05/16/1532/</url>
    <content><![CDATA[<p>站长第一次搭建主从数据库就卡在这里1天的时间,原来是从数据库没有权限访问主数据库,<br>也就是从数据库搭建的时候填写的主数据库的用户名不能连接到主数据库,或者是连接到了没有权限访问,<br>如果是测试的话,可以直接使用主数据库的root帐号进行,但是要保证主数据库有远程访问的权限.<br>至于如何给数据库开通远程访问权限的问题,可以去搜索一下我前面的文章里面有写,<br>就是修改mysql下面的user里面,<br>登陆进入mysql:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> Host = <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> = <span class="string">&#x27;主数据库给从库开通的账号&#x27;</span></span><br><span class="line">FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>

<p>目的就是修改前面的localhost为%,就可以实现远程账号登录了,当然这样修改其他用户的权限也是可以的.</p>
]]></content>
  </entry>
  <entry>
    <title>解决自定义鼠标指针不完全生效的问题</title>
    <url>/2014/12/22/1533/</url>
    <content><![CDATA[<p>在外观里安装的鼠标指针,不能在桌面上显示.</p>
<p>解决方法是修改 <code>~/.icons/default/index.theme</code></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Icon Theme]</span></span><br><span class="line"><span class="attr">Inherits</span>=ComixCursors-LH-Opaque-Blue-Huge-Slim</span><br></pre></td></tr></table></figure>

<p>ComixCursors-LH-Opaque-Blue-Huge-Slim为你的主题文件夹名,没有就新建一个(包括default文件夹)</p>
<p>这个方法只影响本用户.<br>要想改变所有用户的默认鼠标指针,需要将鼠标指针移动到 <code>/usr/share/icons</code>文件夹(需root权限)<br>修改 <code>/usr/share/icons/default/index.theme</code>文件,类似上面.</p>
]]></content>
  </entry>
  <entry>
    <title>禁止Apache列出目录文件</title>
    <url>/2017/07/09/1534/</url>
    <content><![CDATA[<p>默认情况下,Apache服务器会列出网站目录中的文件及子目录,这对于用于发布站点的服务器来说是很不安全的,所以需要禁用,修改httpd.conf配置文件中的对应设置即可.</p>
<p>问题的现象:</p>
<p>如果你的网站目录下有一个xxx的文件夹,如果xxx文件夹下没有默认页面(index.*等),当用户使用URL:http://你的网址/a/ 访问你的网站的话,Apache会把xxx文件夹里的内容全列出来.</p>
<p>解决方法:</p>
<p>要禁止此功能,修改httpd.conf.<br>找到下面这一句删除掉Indexes即可.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br></pre></td></tr></table></figure>

<p>配置示例:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="section">&lt;Directory <span class="string">&quot;E:/Program Files/Apache Software Foundation/Apache2.2/htdocs&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</span></span><br><span class="line">    <span class="comment"># or any combination of:</span></span><br><span class="line">    <span class="comment">#   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</span></span><br><span class="line">    <span class="comment"># doesn&#x27;t give it to you.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The Options directive is both complicated and important. Please see</span></span><br><span class="line">    <span class="comment"># http://httpd.apache.org/docs/2.2/mod/core.html#options</span></span><br><span class="line">    <span class="comment"># for more information.</span></span><br><span class="line">    <span class="comment"># 就是这一行,只去掉indexes也可</span></span><br><span class="line">    <span class="comment">#Options Indexes FollowSymLinks</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> FollowSymLinks</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># AllowOverride controls what directives may be placed in .htaccess files.</span></span><br><span class="line">    <span class="comment"># It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</span></span><br><span class="line">    <span class="comment">#   Options FileInfo AuthConfig Limit</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Controls who can get stuff from this server.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>建议默认情况下,设置APACHE禁止用户浏览目录内容.</p>
]]></content>
  </entry>
  <entry>
    <title>禁止目录下某拓展名文件的访问</title>
    <url>/2011/01/16/1535/</url>
    <content><![CDATA[<p>禁止目录下制定拓展名的文件的外网访问:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">~ ^.*/themes</span>/(.*.html)?$ &#123;<span class="keyword">deny</span> all;&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>局域网连接数据库速度奇慢的解决</title>
    <url>/2011/12/04/1537/</url>
    <content><![CDATA[<p>今天公司出现了一个奇怪的问题,<br>局域网的一台服务器数据库连接奇慢无比,<br>最后找到原因,需要修改数据库的配置文件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>.cnf</span><br></pre></td></tr></table></figure>

<p>然后在[mysqld]下添加</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">skip-<span class="type">name</span>-resolve</span><br><span class="line">skip-<span class="keyword">grant</span>-<span class="keyword">tables</span></span><br></pre></td></tr></table></figure>

<p>完美解决问题.</p>
]]></content>
  </entry>
  <entry>
    <title>局域网访问虚拟机的apache</title>
    <url>/2012/08/24/1536/</url>
    <content><![CDATA[<p>虚拟机直接用NET方式连接外网方便,但是其他主机是没有办法访问到他的.<br>修改网络连接方式为桥接,选择上复制物理网络连接状态.<br>然后ifconfig可以看到,虚拟机和其他主机已经在一个网段内了.</p>
]]></content>
  </entry>
  <entry>
    <title>开启mysql查询缓存</title>
    <url>/2016/03/21/1538/</url>
    <content><![CDATA[<p>下面我用 mysql6.0 最为演示最常用的设置查询缓存.</p>
<p>第一: query_cache_type 使用查询缓存的方式.</p>
<p>一般,我们会把 query_cache_type 设置为 ON,默认情况下应该是ON.</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @<span class="meta">@query_cache_type;</span></span><br><span class="line"></span><br><span class="line">+——————–+</span><br><span class="line">|<span class="string"> @@query_cache_type </span>|</span><br><span class="line">+——————–+</span><br><span class="line">|<span class="string"> ON </span>|</span><br><span class="line">+——————–+</span><br></pre></td></tr></table></figure>

<p>这样 当我们执行:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">select <span class="built_in">id</span>,<span class="built_in">name</span> <span class="keyword">from</span> tableName; </span><br></pre></td></tr></table></figure>

<p>这样就会用到查询缓存.在 query_cache_type 打开的情况下,如果你不想使用缓存,需要指明.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">select sql_no_cache <span class="built_in">id</span>,<span class="built_in">name</span> <span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure>

<p>当然也可以禁用查询缓存:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="builtin-name">set</span> session <span class="attribute">uery_cache_type</span>=off;</span><br></pre></td></tr></table></figure>

<p>这里我们不讨论这个,我们演示常用的设置.</p>
<p>第二:系统变量 have_query_cache 设置查询缓存是否可用.</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;have_query_cache&#x27;;</span><br><span class="line"></span><br><span class="line">+——————+——-+</span><br><span class="line">|<span class="string"> Variable_name </span>|<span class="string"> Value </span>|</span><br><span class="line">+——————+——-+</span><br><span class="line">|<span class="string"> have_query_cache </span>|<span class="string"> YES </span>|</span><br><span class="line">+——————+——-+</span><br></pre></td></tr></table></figure>

<p>上面的显示,表示设置查询缓存是可用的.</p>
<p>第三:系统变量 query_cache_size</p>
<p>表示查询缓存大小,也就是分配内存大小给查询缓存,如果你分配大小为0,<br>那么 第一步 和 第二步 起不到作用,还是没有任何效果.</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @<span class="meta">@global.query_cache_size;</span></span><br><span class="line"></span><br><span class="line">+—————————+</span><br><span class="line">|<span class="string"> @@global.query_cache_size </span>|</span><br><span class="line">+—————————+</span><br><span class="line">|<span class="string"> 16777216 </span>|</span><br><span class="line">+—————————+</span><br></pre></td></tr></table></figure>

<p>上面是 mysql6.0设置默认的,之前的版本好像默认是0的,那么就要自己设置下.<br>设置 set @@global.query_cache_size=1000000; 这里是设置1M左右,900多K.<br>再次查看下</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">select @<span class="meta">@global.query_cache_size;</span></span><br><span class="line">+—————————+</span><br><span class="line">|<span class="string"> @@global.query_cache_size </span>|</span><br><span class="line">+—————————+</span><br><span class="line">|<span class="string"> 999424 </span>|</span><br><span class="line">+—————————+</span><br></pre></td></tr></table></figure>

<p>显示我们设置新的大小,表示设置成功.</p>
<p>第四: query_cache_limit 控制缓存查询结果的最大值</p>
<p>例如: 如果查询结果很大, 也缓存????这个明显是不可能的.<br>MySql 可以设置一个最大的缓存值,当你查询缓存数结果数据超过这个值就不会.<br>进行缓存.缺省为1M,也就是超过了1M查询结果就不会缓存.</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @<span class="meta">@global.query_cache_limit;</span></span><br><span class="line"></span><br><span class="line">+—————————-+</span><br><span class="line">|<span class="string"> @@global.query_cache_limit </span>|</span><br><span class="line">+—————————-+</span><br><span class="line">|<span class="string"> 1048576 </span>|</span><br><span class="line">+—————————-+</span><br></pre></td></tr></table></figure>

<p>这个是默认的数值,如果需要修改,就像设置缓存大小一样设置,使用set重新指定大小.<br>好了,通过4个步骤就可以 打开了查询缓存,具体值的大小和查询的方式 这个因不同的情况来指定了.</p>
<p>可以使用下面的语句检查MySQL服务器是否提供查询缓存功能:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="emphasis">&#x27;have_query_cache&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="code">+------------------+</span>-------+</span><br><span class="line"><span class="section">| Variable_name    | Value |</span></span><br><span class="line"><span class="section">+------------------+-------+</span></span><br><span class="line"><span class="section">| have_query_cache | YES   |</span></span><br><span class="line"><span class="section">+------------------+-------+</span></span><br></pre></td></tr></table></figure>

<p>可以使用FLUSH QUERY CACHE语句来清理查询缓存碎片以提高内存使用性能.该语句不从缓存中移出任何查询.<br>RESET QUERY CACHE语句从查询缓存中移出所有查询.FLUSH TABLES语句也执行同样的工作.<br>为了监视查询缓存性能,使用SHOW STATUS查看缓存状态变量:</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW STATUS LIKE &#x27;Qcache%&#x27;;</span><br><span class="line"></span><br><span class="line">+-------------------------+--------+</span><br><span class="line">|<span class="string">变量名                   </span>|<span class="string">值 </span>|</span><br><span class="line">+-------------------------+--------+</span><br><span class="line">|<span class="string"> Qcache_free_blocks      </span>|<span class="string"> 36     </span>|</span><br><span class="line">|<span class="string"> Qcache_free_memory      </span>|<span class="string"> 138488 </span>|</span><br><span class="line">|<span class="string"> Qcache_hits             </span>|<span class="string"> 79570  </span>|</span><br><span class="line">|<span class="string"> Qcache_inserts          </span>|<span class="string"> 27087  </span>|</span><br><span class="line">|<span class="string"> Qcache_lowmem_prunes    </span>|<span class="string"> 3114   </span>|</span><br><span class="line">|<span class="string"> Qcache_not_cached       </span>|<span class="string"> 22989  </span>|</span><br><span class="line">|<span class="string"> Qcache_queries_in_cache </span>|<span class="string"> 415    </span>|</span><br><span class="line">|<span class="string"> Qcache_total_blocks     </span>|<span class="string"> 912    </span>|</span><br><span class="line">+-------------------------+--------+</span><br></pre></td></tr></table></figure>

<p>这些变量的描述见5.3.4节,”服务器状态变量”.这里描述它们的一些应用.</p>
]]></content>
  </entry>
  <entry>
    <title>开启关闭重启monit脚本</title>
    <url>/2012/05/13/1539/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line">MONIT=/usr/bin/monit</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">daemon <span class="variable">$NICELEVEL</span> <span class="variable">$MONIT</span></span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;Stopping monit: &quot;</span></span><br><span class="line">killproc monit</span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"><span class="variable">$0</span> stop</span><br><span class="line"><span class="variable">$0</span> start</span><br><span class="line">RETVAL=$?</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$RETVAL</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>快速在linux服务器安装xampp</title>
    <url>/2013/01/08/1540/</url>
    <content><![CDATA[<p>2019年8月19日更新:</p>
<p>步骤1最新下载地址为:<a href="https://www.apachefriends.org/xampp-files/7.3.8/xampp-linux-x64-7.3.8-2-installer.run">https://www.apachefriends.org/xampp-files/7.3.8/xampp-linux-x64-7.3.8-2-installer.run</a></p>
<p>历史内容:</p>
<p>步骤 1:下载:</p>
<p>只需点击下面的链接.下载最新版总是好主意.:)<br><a href="http://www.apachefriends.org/download.php?xampp-linux-1.7.7.tar.gz">http://www.apachefriends.org/download.php?xampp-linux-1.7.7.tar.gz</a></p>
<p>步骤 2:安装:</p>
<p>将下载的压缩文件释放到 /opt:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> xvfz xampp-linux-<span class="number">1</span>.<span class="number">7</span>.<span class="number">7</span>.tar.gz -C /opt</span><br><span class="line"><span class="comment">#警告: 只允许使用上述命令安装 XAMPP.不要使用任何 Microsoft Windows 工具释放压缩文件,这没有用.</span></span><br><span class="line"><span class="comment">#警告 2: 使用此命令时,已存在的旧版 XAMPP 会被覆盖.</span></span><br></pre></td></tr></table></figure>

<p>就这样结束了.XAMPP 被安装在 <code>/opt/lampp</code>目录下.</p>
<p>步骤 3:开始运行:</p>
<p>使用下面的命令开始运行 XAMPP:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>lampp/lampp start</span><br></pre></td></tr></table></figure>

<p>您应该能在屏幕上看到类似下面的提示信息:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">Starting XAMPP <span class="number">1.7</span>.<span class="number">7</span>...</span><br><span class="line">LAMPP: Starting Apache...</span><br><span class="line">LAMPP: Starting MySQL...</span><br><span class="line">LAMPP started.</span><br></pre></td></tr></table></figure>

<p>好了.Apache 和 MySQL 正在运行中.</p>
<p>步骤 4:测试:</p>
<p>好了,这很简单,但您如何检测所有组件是否正常工作呢?只需在您的浏览器中输入下面的链接即可:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost</span><br></pre></td></tr></table></figure>

<p>现在您应该能看到包含一些检测已安装软件的工作状态的链接和一些示例程序的 XAMPP 开始页面.</p>
<p>安全问题(必读!)</p>
<p>如前所述,XAMPP 并不适用于生产环境,而仅供开发环境使用.XAMPP 被设置为尽量开放,并提供开发者任何他/她想要的功能.这对于开发环境来说是很棒的,但对于生产环境来说却可能是致命的.</p>
<p>这儿有一份 XAMPP 缺乏安全防护的列表:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">MySQL 管理员(root)没有密码.</span><br><span class="line">MySQL 可通过网络访问.</span><br><span class="line">ProFTPD 使用<span class="string">&quot;lampp&quot;</span>作为用户名<span class="string">&quot;nobody&quot;</span>的密码.</span><br><span class="line">PhpMyAdmin 可以通过网络访问.</span><br><span class="line">示例程序可以通过网络访问.</span><br><span class="line">MySQL 和 Apache 在同一个用户名(nobody)下运行.</span><br></pre></td></tr></table></figure>

<p>要修正绝大部分的安全薄弱环节,只需执行以下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>lampp/lampp security</span><br></pre></td></tr></table></figure>

<p>它会启用一个小小的安全检查功能,使您安装的 XAMPP 更安全.</p>
<p>0.9.4 版以前的 <code>/opt/lampp/lampp</code>只能简单地启动或停止 XAMPP.自从 0.9.5 版开始,它学会了很多新的东西.</p>
<p>高级的启动与停止参数:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">参数 	          描述</span><br><span class="line">start                 启动 XAMPP.</span><br><span class="line">stop                  停止 XAMPP.</span><br><span class="line">restart               重新启动 XAMPP.</span><br><span class="line">startapache           只启动 Apache.</span><br><span class="line">startssl              启动 Apache 的 SSL 支持.该命令将持续激活 SSL 支持,例如:执行该命令后,如果您关闭并重新启动 XAMPP,SSL 仍将处于激活状态.</span><br><span class="line">startmysql            只启动 MySQL 数据库.</span><br><span class="line">startftp              启动 ProFTPD 服务器.通过 FTP,您可以上传文件到您的网络服务器中(用户名<span class="string">&quot;nobody&quot;</span>,密码<span class="string">&quot;lampp&quot;</span>).该命令将持续激活 ProFTPD,例如:执行该命令后,如果您关闭并重新启动 XAMPP,FTP 仍将处于激活状态.</span><br><span class="line">stopapache            停止 Apache.</span><br><span class="line">stopssl               停止 Apache 的 SSL 支持.该命令将持续停止 SSL 支持,例如:执行该命令后,如果您关闭并重新启动 XAMPP,SSL 仍将处于停止状态.</span><br><span class="line">stopmysql             停止 MySQL 数据库.</span><br><span class="line">stopftp               停止 ProFTPD 服务器.该命令将持续停止 ProFTPD,例如:执行该命令后,如果您关闭并重新启动 XAMPP,FTP 仍将处于停止状态.</span><br><span class="line">security              启动一个小型安全检查程序.</span><br></pre></td></tr></table></figure>

<p>例如:想启用带 SSL 支持的 Apache,只需输入如下命令(以 root 身份):</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>lampp/lampp startssl</span><br></pre></td></tr></table></figure>

<p>现在您可以通过 SSL 形式的 <a href="https://localhost/">https://localhost</a> 访问 Apache 服务器了.</p>
<p>重要的文件和目录:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">文件/目录 	                           用途</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/bin/</span>                        XAMPP 命令库.例如 <span class="regexp">/opt/</span>lampp<span class="regexp">/bin/my</span>sql 可执行 MySQL 监视器.</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/htdocs/</span>                     Apache 文档根目录.</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/etc/</span>httpd.conf              Apache 配制文件.</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/etc/my</span>.cnf                  MySQL 配制文件.</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/etc/</span>php.ini                 PHP 配制文件.</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/etc/</span>proftpd.conf            ProFTPD 配制文件.(从 <span class="number">0.9</span>.<span class="number">5</span> 版开始)</span><br><span class="line"><span class="regexp">/opt/</span>lampp<span class="regexp">/phpmyadmin/</span>config.inc.php   phpMyAdmin 配制文件.</span><br></pre></td></tr></table></figure>

<p>想停止 XAMPP,只需输入如下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>lampp/lampp stop</span><br></pre></td></tr></table></figure>

<p>您现在应该能看到:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">Stopping LAMPP <span class="number">1.7</span>.<span class="number">7</span>...</span><br><span class="line">LAMPP: Stopping Apache...</span><br><span class="line">LAMPP: Stopping MySQL...</span><br><span class="line">LAMPP stopped.</span><br></pre></td></tr></table></figure>

<p>然后 XAMPP 的 Linux 版就停止运行了.</p>
<p>卸载:</p>
<p>想卸载 XAMPP,只需输入如下命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -rf <span class="regexp">/opt/</span>lampp</span><br></pre></td></tr></table></figure>

<p>卸载完成.</p>
]]></content>
  </entry>
  <entry>
    <title>利用screen永久后台运行程序</title>
    <url>/2018/03/16/1542/</url>
    <content><![CDATA[<p>root登陆后,输入:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">screen</span></span><br></pre></td></tr></table></figure>

<p>然后回车,然后就会出现窗口,和原来差不多,你在这里,和刚才一样输入:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> qq &amp;&amp; <span class="string">./qq</span></span><br></pre></td></tr></table></figure>

<p>就可以了,登陆以后,</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">Ctrl+<span class="selector-tag">a</span>,再按d.</span><br></pre></td></tr></table></figure>

<p>就算退出了,这是断开连接,QQ就不掉线了.</p>
<p>想再次进入,只需运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">screen -r</span></span><br></pre></td></tr></table></figure>

<p>输入命令screen -ls可以查看到被挂起的窗口:</p>
<figure class="highlight hsp"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">screen</span> -ls</span><br><span class="line"></span><br><span class="line">There is a <span class="keyword">screen</span> <span class="keyword">on</span>:</span><br><span class="line"><span class="number">22496</span>.pts<span class="number">-0.</span>Nginx (Detached)</span><br><span class="line"><span class="number">1</span> Socket in /var/<span class="keyword">run</span>/<span class="keyword">screen</span>/S-root.</span><br></pre></td></tr></table></figure>

<p>恢复窗口:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">screen</span> -r <span class="number">22496</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>乐宝贝安装</title>
    <url>/2018/12/19/1541/</url>
    <content><![CDATA[<p>要带的工具:</p>
<pre><code>1.网线制作工具(网线钳 水晶头 测试仪)
2.考勤机电源和保护盒各4个
3.发卡器1个
4.测试卡3张
5.绝缘胶带
6.多用螺丝刀 尺子
7.电钻
8.光驱
9.win2003系统盘
10.移动硬盘(一体机映像文件 幼儿园安装程序 sql数据库)
</code></pre>
<p>代购产品:</p>
<pre><code>1.网线
2.电源线
3.电源插头
4.pv布线管
</code></pre>
<p>门禁机器的设置:</p>
<pre><code>1.进入常规设置 本机IP:IP地址设置为192.168.1.100,子网掩码:25.255.255.0 网关设置为192.168.1.1.
2.联机设置:服务器IP设置为(一体机的IP地址)192.168.1.118,成功设置报告为启用,监控功能设置为发送实时图像.
3.识别管理:识别方向 识别方向设置为不区分方向,识别方式 先编号后设置为直接有效.
4.高级设置: 拓展设置 识别验证方式 &quot;先从本机档案验证,失败后从服务器识别&quot;,组网方式 RJ45.
5.高级设置:卡头设置 卡先截取再转换选择启用,卡有效位数 取右6位,卡转为十进制选择启用,十进制卡号位数选择默认.
</code></pre>
<p>注意考勤机正负极,接反烧毁.</p>
]]></content>
  </entry>
  <entry>
    <title>连接的失败报错RabbitMQ Exception (403) Reason</title>
    <url>/2019/08/13/1543/</url>
    <content><![CDATA[<p>连接的失败报错:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">RabbitMQ <span class="keyword">Exception</span> (<span class="number">403</span>) Reason: <span class="string">&quot;no access to this vhost&quot;</span></span><br></pre></td></tr></table></figure>

<p>因为没有配置该用户的访问权限,可以通过:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rabbitmqctl add_vhost admin</span></span><br></pre></td></tr></table></figure>

<p>来添加,并赋予权限:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">rabbitmqctl <span class="keyword">set</span>_permissions -p 用户名 admin <span class="string">&quot;.&quot;</span> <span class="string">&quot;.&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure>

<p>代码在连接的时候,必须制定对应的vhost,否则是没有访问权限:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="built_in">conn,</span> err := amqp.Dial(<span class="string">&quot;amqp://sky:password@ip:5672/admin&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>两个路由器一个局域网</title>
    <url>/2019/02/16/1544/</url>
    <content><![CDATA[<p>CentOS 将双网卡绑定成一块网卡,配置起来非常简单,只需要简单几个步骤即可实现,下面我们就一起来体验一下吧.首先,还是将本次实验的环境做个简单的介绍:</p>
<p>操作系统:CentOS 5.5 x86.<br>绑定的前提条件:芯片组型号相同,而且网卡应该具备自己独立的BIOS芯片.</p>
<p>1.先修改eth0 和eht1这2个网卡配置文件.目录在(<code>/etc/sysconfig/network-scripts/</code>)如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">MASTER</span>=bond0 <span class="comment">#也可没有该项</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br></pre></td></tr></table></figure>

<p>2.eth1也是同样的修改.如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth1</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">MASTER</span>=bond0 <span class="comment">#也可没有该项</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br></pre></td></tr></table></figure>

<p>3.新建一个虚拟网卡bond0,创建bond0的配置文件ifcfg-bond0.如下:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=bond0</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">0.223</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">BROADCAST</span>=<span class="number">192.168</span>.<span class="number">0.255</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br></pre></td></tr></table></figure>

<p>注意:编辑的时候在配置文件中把MAC地址去掉,否则会出现mac冲突.</p>
<p>4.修改 <code>/etc/modprobe.conf</code>添加内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">alias</span> bond<span class="number">0</span> bonding</span><br><span class="line"><span class="attribute"><span class="nomarkup">options</span></span> bond<span class="number">0</span> miimon=<span class="number">100</span> mode=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>说明:miimon是用来进行链路监测的. 比如:miimon=100,那么系统每100ms监测一次链路连接状态,如果有一条线路不通就转入另一条线路;mode的值表示工作模式,他共有0,1,2,3四种模式,常用的为0,1两种.<br>mode=0表示load balancing (round-robin)为负载均衡方式,两块网卡都工作.<br>mode=1表示fault-tolerance (active-backup)提供冗余功能,工作方式是主备的工作方式,也就是说默认情况下只有一块网卡工作,另一块做备份.<br>bonding只能提供链路监测,即从主机到交换机的链路是否接通.如果只是交换机对外的链路down掉了,而交换机本身并没有故障,那么bonding会认为链路没有问题而继续使用.<br>MODE=0测试结论:<br>如果交换机未配置链路聚合则会发生MAC动荡的情况,在配置了链路聚合后不会出现,SRV发出数据包的MAC为Bond0的MAC.<br><em>MODE=6</em>测试结论:(这个mode=6不了解)<br>此时交换机无需特殊配置,即可实现负载均衡.2个网卡发出的包使用的是各自的MAC,因此也不会造成交换机MAC地址表的动荡.</p>
<p>5.修改 <code>/etc/rc.d/rc.local</code>添加内容如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifenslave</span> bond<span class="number">0</span> eth<span class="number">0</span> eth<span class="number">1</span></span><br><span class="line"><span class="attribute">route</span> add -net <span class="number">192.168.0.255</span> netmask <span class="number">255.255.255.0</span> bond<span class="number">0</span> 或者</span><br><span class="line"><span class="attribute">route</span> add default gw <span class="number">192.168.0.255</span> –interface bond<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>OK 完成.<br>重启(开始重启network服务没出想要得到的效果,最后选择重启的系统),验证:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ifconfig</span></span><br><span class="line"><span class="attribute">bond0</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">inet</span> addr:<span class="number">202.206.197.171</span> Bcast:<span class="number">202.206.197.191</span> Mask:<span class="number">255.255.255.224</span></span><br><span class="line"><span class="attribute">inet6</span> addr: fe<span class="number">80</span>::<span class="number">250</span>:<span class="number">56</span>ff:fe<span class="number">90</span>:<span class="number">38</span>/<span class="number">64</span> Scope:Link</span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING MASTER MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">688</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">397</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">54107</span> (<span class="number">52</span>.<span class="number">8</span> KiB) TX bytes:<span class="number">31854</span> (<span class="number">31</span>.<span class="number">1</span> KiB)</span><br><span class="line"><span class="attribute">eth0</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING SLAVE MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">345</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">200</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">27202</span> (<span class="number">26</span>.<span class="number">5</span> KiB) TX bytes:<span class="number">15284</span> (<span class="number">14</span>.<span class="number">9</span> KiB)</span><br><span class="line"><span class="attribute">Interrupt</span>:<span class="number">59</span> Base address:<span class="number">0</span>x<span class="number">2024</span></span><br><span class="line"><span class="attribute">eth1</span> Link encap:Ethernet HWaddr <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:<span class="number">90</span>:<span class="number">00</span>:<span class="number">38</span></span><br><span class="line"><span class="attribute">UP</span> BROADCAST RUNNING SLAVE MULTICAST MTU:<span class="number">1500</span> Metric:<span class="number">1</span></span><br><span class="line"><span class="attribute">RX</span> packets:<span class="number">343</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line"><span class="attribute">TX</span> packets:<span class="number">199</span>errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line"><span class="attribute">collisions</span>:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line"><span class="attribute">RX</span> bytes:<span class="number">26905</span> (<span class="number">26</span>.<span class="number">2</span> KiB) TX bytes:<span class="number">16910</span> (<span class="number">16</span>.<span class="number">5</span> KiB)</span><br><span class="line"><span class="attribute">Interrupt</span>:<span class="number">67</span> Base address:<span class="number">0</span>x<span class="number">20</span>a<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>可以down掉其中的一个网卡,链路依然是通的.</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">ifconfig eth* <span class="meta">down</span></span><br><span class="line">ifconfig eth* <span class="meta">up</span></span><br></pre></td></tr></table></figure>

<p>当都down掉的时候就不通了.<br>通过网卡邦定技术既增加了服务器的可靠性,又增加了可用网络带宽,为用户提供不间断的关键服务.</p>
]]></content>
  </entry>
  <entry>
    <title>凌波多媒体教学网的安装和卸载</title>
    <url>/2016/08/23/1545/</url>
    <content><![CDATA[<p>安装前的准备:</p>
<p><strong>1.准备安装</strong></p>
<p>安装凌波多媒体教学网软件前,请先检查您的系统是否符合运行需求,以及TCP/IP网络协议是否设置好.</p>
<p><strong>2.系统需求</strong></p>
<p>首先,您应检查您的计算机系统是否符合凌波多媒体教学网软件的运行条件.下表列出了系统要求:<br>处理器 奔腾133 或更高处理器.<br>内存 32 MB 或以上.<br>显卡 Windows 支持的 100% VGA 兼容图形适配器.<br>磁盘空间 各模块所需磁盘空间均小于 10 MB.<br>操作系统 Windows XP、Windows 2000、Windows NT 4.0<em>、Windows Me、Windows 98<strong>、Windows 95</strong></em>.<br>网络 10/100M或以上.<br>如果操作系统是 Windows NT 4.0,需另外安装WMI、Microsoft Service Pack 4 或以上版本.<br>如果操作系统是Windows 98 或其OSR版本,需另外安装WMI、DirectX 7.0或以上版本.<br>如果操作系统是Windows 95 或其OSR版本,需另外安装WMI、DirectX 7.0、DirectMedia 6.0、WinSock2或以上版本.<br>如果使用语音功能,还需要有全双工声卡.</p>
<p><strong>3.网络协议</strong></p>
<p>运行凌波多媒体教学网需要TCP/IP协议的支持.如果网络中没有服务器或服务器上没有安装DHCP服务,此时网络中所有计算机的网卡所绑定的TCP/IP协议的设置上必须指定一个固定的IP地址.如果网络中有Windows NT 4.0 或 Windows 2000 服务器,并且服务器上安装有DHCP服务,此时学生机网卡所绑定的TCP/IP协议的设置上可以设为自动获取IP地址.具体的设置请咨询您所使用的网络的网络管理员.<br>开始安装.<br>凌波多媒体教学网程序由两部分构成:教师端程序和学生端程序,教师端程序安装在一台教师用电脑上,学生端程序安装在多台学生用电脑上.这些电脑用TCP/IP协议构成一个局域网.</p>
<p><strong>1.教师机的安装</strong></p>
<p>1)如果以前安装的教师端程序正在运行,首先要把教师端程序关闭;</p>
<p>2)执行Setup.exe程序进行安装,如果系统中已经安装过凌波多媒体教学网软件,系统会提示是否删除以前安装的程序,这时可按提示把以前已经安装的删除掉,然后重新运行Setup.exe,开始安装;</p>
<p>3)按照安装提示选择安装部件:教师端;</p>
<p>4)按照安装提示完成安装.</p>
<p><strong>2.学生机的安装</strong></p>
<p>1)如果以前安装的学生端程序正在运行,首先要把学生端程序关闭(可以用热键Ctrl+Win+F12把学生端程序关闭);</p>
<p>2)执行Setup.exe程序进行安装,如果系统中已经安装过凌波多媒体教学网软件,系统会提示是否删除以前安装的程序,这时可按提示把以前已经安装的删除掉,然后重新运行Setup.exe,开始安装;</p>
<p>3)按照安装提示选择安装部件:学生端;</p>
<p>4)按照安装提示完成安装.</p>
<p><strong>3.教师机的卸载</strong></p>
<p>用[控制面版]中的[添加删除程序],可以把教师端程序删除.</p>
<p><strong>4.学生机的卸载</strong></p>
<p>用[控制面版]中的[添加删除程序],可以把学生端程序删除,注意,删除学生端程序时,首先要把学生端程序关闭,可以用热键Ctrl+Win+F12把学生端程序关闭.</p>
]]></content>
  </entry>
  <entry>
    <title>配置apache的Alias</title>
    <url>/2014/01/16/1547/</url>
    <content><![CDATA[<p>在 <code>xamppapacheconfhttpd.conf</code> 文件最后,添加如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Alias</span> /myphp <span class="string">&quot;D:/source/pdt-workspaces/myphp&quot;</span></span><br><span class="line"><span class="section">&lt;directory <span class="string">&quot;D:/source/pdt-workspaces/myphp&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> None</span><br><span class="line">    <span class="attribute"><span class="nomarkup">Order</span></span> <span class="literal">allow</span>,<span class="literal">deny</span></span><br><span class="line">    <span class="attribute"><span class="nomarkup">Allow</span></span> from <span class="literal">all</span></span><br><span class="line"><span class="section">&lt;/directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后启动xampp, 访问 <a href="http://localhost/myphp/test.php">http://localhost/myphp/test.php</a> 就可以了</p>
]]></content>
  </entry>
  <entry>
    <title>配置nginx gzip压缩功能与测试是否启用</title>
    <url>/2019/04/04/1548/</url>
    <content><![CDATA[<p>一般情况下压缩后的html、css、js、php、jhtml等文件,大小能降至原来的25%,也就是说,原本一个100k的html,压缩后只剩下25k.这无疑能节省很多带宽,也能降低服务器的负载.<br>在nginx中配置gzip比较简单.<br>一般情况下只要在nginx.conf的http段中加入下面几行配置即可:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">gzip <span class="keyword">on</span>;</span><br><span class="line">gzip_min_length <span class="number">1000</span>;</span><br><span class="line">gzip_buffers <span class="number">4</span> <span class="number">8</span>k;</span><br><span class="line">gzip_comp_level <span class="number">6</span>; <span class="comment">#0-9 默认值为1,值越大压缩率越高,消耗的cpu资源越多,传输量减小.</span></span><br><span class="line">gzip_types <span class="built_in">text</span>/plain <span class="built_in">text</span>/html <span class="built_in">text</span>/css <span class="built_in">application</span>/json <span class="built_in">application</span>/x-javascript <span class="built_in">text</span>/xml <span class="built_in">application</span>/xml <span class="built_in">application</span>/xml+rss <span class="built_in">text</span>/javascript;</span><br></pre></td></tr></table></figure>

<p>重启nginx:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -s reload</span></span><br></pre></td></tr></table></figure>

<p>可以通过网页gzip检测工具来检测网页是否启用了gzip.</p>
]]></content>
  </entry>
  <entry>
    <title>某个项目apache无法启动数据库</title>
    <url>/2018/11/22/1546/</url>
    <content><![CDATA[<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">vi database.yml</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">development:</span></span><br><span class="line"><span class="symbol">adapter:</span> mysql</span><br><span class="line"><span class="symbol">encoding:</span> utf8</span><br><span class="line"><span class="symbol">database:</span> shonin_development</span><br><span class="line"><span class="symbol">pool:</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">username:</span> root</span><br><span class="line"><span class="symbol">password:</span></span><br><span class="line"><span class="symbol">host:</span> localhost</span><br><span class="line"><span class="symbol">test:</span></span><br><span class="line"><span class="symbol">adapter:</span> mysql</span><br><span class="line"><span class="symbol">encoding:</span> utf8</span><br><span class="line"><span class="symbol">database:</span> shonin_test</span><br><span class="line"><span class="symbol">pool:</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">username:</span> root</span><br><span class="line"><span class="symbol">password:</span></span><br><span class="line"><span class="symbol">host:</span> localhost</span><br><span class="line"><span class="symbol">production:</span></span><br><span class="line"><span class="symbol">adapter:</span> mysql</span><br><span class="line"><span class="symbol">encoding:</span> utf8</span><br><span class="line"><span class="symbol">database:</span> shonin_production</span><br><span class="line"><span class="symbol">pool:</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">username:</span> root</span><br><span class="line"><span class="symbol">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="symbol">host:</span> localhost</span><br><span class="line"><span class="symbol">socket:</span> <span class="meta-keyword">/var/</span>lib<span class="meta-keyword">/mysql/</span>mysql.sock</span><br></pre></td></tr></table></figure>

<p>注意:Linux服务器上,默认第一个读取production数据库配置信息,所以,我们只要确保production里的信息正常就可以.一般只要更改username和password就可以.另,通常要在最下方,加上 <code>socket: /var/lib/mysql/mysql.sock</code>.不同系统,路径不同,也有可能是 <code>socket: /tmp/mysql.sock</code>.</p>
]]></content>
  </entry>
  <entry>
    <title>批处理修改系统首页 并删除自己</title>
    <url>/2011/02/21/1550/</url>
    <content><![CDATA[<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USERSoftwareMicrosoftInternet ExplorerMain&quot;</span> <span class="string">/v</span> <span class="string">&quot;Start Page&quot;</span> <span class="string">/t</span> reg_sz <span class="string">/d</span> http:<span class="string">//www.baidu.com</span> <span class="string">/f</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USERSoftwareMicrosoftInternet ExplorerMain&quot;</span> <span class="string">/v</span> <span class="string">&quot;Default_Page_URL&quot;</span> <span class="string">/t</span> reg_sz <span class="string">/d</span> http:<span class="string">//www.baidu.com</span> <span class="string">/f</span></span><br><span class="line">del %0</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>配置文件现在需要一个短语密码.</title>
    <url>/2015/05/19/1549/</url>
    <content><![CDATA[<p>phpmyadmin出现”配置文件现在需要一个短语密码”问题,可以按下面方法解决:<br>1、用编辑器打开目录 <code>phpmyadmin/libraries</code>中的config.default.php文件<br>2、查找下面这行:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;blowfish_secret&#x27;</span>] = <span class="string">&#x27;这里就是需要的短语密码&#x27;</span>; <span class="comment">#(短语密码请随意填写)</span></span><br></pre></td></tr></table></figure>

<p>会出现这个问题,是在配置phpmyadmin填写认证方法时,即下面这行:</p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">$cfg[<span class="string">&#x27;Servers&#x27;</span>][$i][<span class="string">&#x27;auth_type&#x27;</span>] = <span class="string">&#x27;cookie&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在此有四种模式可供选择,cookie,http,HTTP,config<br>config方式即输入phpmyadmin的访问网址即可直接进入,无需输入用户名和密码,是不安全的,不推荐使用.<br>当该项设置为cookie,http或HTTP时,登录phpmyadmin需要数据用户名和密码进行验证,,具体如下:<br>PHP安装模式为Apache,可以使用http和cookie;<br>PHP安装模式为CGI,可以使用cookie.</p>
]]></content>
  </entry>
  <entry>
    <title>批量删除.svn文件</title>
    <url>/2019/02/12/1551/</url>
    <content><![CDATA[<p>在记事本输入以下代码:</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\C</span>lasses<span class="symbol">\F</span>older<span class="symbol">\s</span>hell<span class="symbol">\D</span>eleteSVN]</span><br><span class="line">@=&quot;Delete SVN Folders&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\C</span>lasses<span class="symbol">\F</span>older<span class="symbol">\s</span>hell<span class="symbol">\D</span>eleteSVN<span class="symbol">\c</span>ommand]</span><br><span class="line">@=&quot;cmd.exe /c <span class="symbol">\&quot;</span>TITLE Removing SVN Folders in <span class="variable">%1 &amp;&amp; COLOR 9A &amp;&amp; FOR /r \&quot;%</span>1<span class="symbol">\&quot;</span> <span class="variable">%%</span>f IN (.svn) DO RD /s /q <span class="symbol">\&quot;</span><span class="variable">%%</span>f<span class="symbol">\&quot;</span> <span class="symbol">\&quot;</span>&quot;</span><br></pre></td></tr></table></figure>

<p>保存为以.reg作为扩展名的文件,双击此reg文件导入注册表.导入后,在需要删除.svn文件的时候,右键点击此文件夹,会在关联菜单看到”Delete SVN Folders”选项,执行即可迅速删除该文件夹下的所有.svn文件.</p>
]]></content>
  </entry>
  <entry>
    <title>批量修改Win7文件权限</title>
    <url>/2016/01/23/1552/</url>
    <content><![CDATA[<p>办法一</p>
<p>1、经过命令的方式,首先运用管理员用户登录系统,然后翻开命令提示符窗口,在命令行程序中输入icacls 命令对文件夹或文件的权限做出修正,并且该命令还支持文件夹或文件权限设置的恢复;<br>示例:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">icacls c<span class="function">:windows</span>* <span class="string">/save</span> AclFile <span class="string">/T</span> <span class="comment">#将 c:windows 及其子目录下一切文件的 ACL 保管到AclFile;</span></span><br><span class="line">icacls file <span class="string">/grant</span> Administrator:<span class="params">(D,WDAC)</span> <span class="comment">#将授予用户对文件删除和写入 DAC 的管理员权限;</span></span><br><span class="line">icacls file <span class="string">/grant</span> *S-1-1-0:<span class="params">(D,WDAC)</span> <span class="comment">#将授予由 sid S-1-1-0 定义的用户对文件删除和写入DAC的权限;</span></span><br><span class="line">icacls c<span class="function">:windows</span> <span class="string">/restore</span> AclFile <span class="comment">#将复原 c:windows 及其子目录下存在的 AclFile 内一切文件的ACL;</span></span><br></pre></td></tr></table></figure>

<p>更多有关 icacls 命令的更多用法和信息,能够再命令行中运用icacls /?停止查看.</p>
<p>办法二:</p>
<p>1、由于在默许状况下,Windows系统中文件夹或文件的权限具有继承性,应用于父文件夹的权限设置同样会被子文件夹以及其中的文件所继承,所以要实 现批量的权限修正的话,用户能够将需求修正权限的文件夹和文件放在一个新建的文件夹中,然后鼠标右击这个新建的文件夹,然后选择”属性”;<br>2、再翻开的界面中,切换到”安全”选项卡,然后就能够对该文件夹停止权限停止修正,修正后的限将被一切的子文件夹及其包含的文件应用;<br>3、在修正完成之后就能够将其中的文件夹和文件挪动到原来的存储途径停止保管即可.<br>以上就是Win7下批量修正文件或者文件夹权限的办法了,有需求的用户,能够选择其中本人喜欢的一种停止设置.</p>
]]></content>
  </entry>
  <entry>
    <title>屏蔽PHP错误提示</title>
    <url>/2017/10/21/1553/</url>
    <content><![CDATA[<p>打开 <code>php.ini</code> 文件，搜索 <code>display_errors = on</code>，默认的应该是 on，即开启报错功能，改为 off 即可。</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ vi php.ini</span><br><span class="line"></span><br><span class="line">display_errors = <span class="keyword">off</span>;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>启用nginx的fastcgi_cache完整教程</title>
    <url>/2017/09/23/1554/</url>
    <content><![CDATA[<p>配置参数:<br>http里:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">fastcgi_cache_path /www/php_cache? <span class="attribute">levels</span>=1:2? <span class="attribute">keys_zone</span>=cache_php:30m <span class="attribute">inactive</span>=1d <span class="attribute">max_size</span>=10g;</span><br></pre></td></tr></table></figure>

<p>server里:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">location ~ .*.php?<span class="variable">$ </span>&#123;</span><br><span class="line">    <span class="comment">#fastcgi_pass? unix:/tmp/php-cgi.sock;</span></span><br><span class="line">    fastcgi_pass? <span class="number">127.0</span>.0.<span class="number">1</span><span class="symbol">:</span><span class="number">9000</span>;</span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    <span class="keyword">include</span> fcgi.conf;</span><br><span class="line">    <span class="comment">#以下是fastcgi_cache的配置</span></span><br><span class="line">    fastcgi_cache?? cache_php;</span><br><span class="line">    fastcgi_cache_valid?? <span class="number">200</span> <span class="number">302</span>? <span class="number">1</span>h;</span><br><span class="line">    fastcgi_cache_min_uses? <span class="number">1</span>;</span><br><span class="line">    fastcgi_cache_use_stale error? timeout invalid_header http_500;</span><br><span class="line">    fastcgi_cache_key <span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#fastcgi_cache_path:fastcgi_cache缓存目录,可以设置目录层级,比如1:2会生成16*256个字目录,cache_php是这个缓存空间的名字,cache是用多少内存(这样热门的内容nginx直接放内存,提高访问速度),inactive表示默认失效时间,max_size表示最多用多少硬盘空间.本来还有个fastcgi_temp_path参数,但发现似乎没用.  </span></span><br><span class="line"><span class="comment">#fastcgi_cache_valid:定义哪些http头要缓存</span></span><br><span class="line"><span class="comment">#fastcgi_cache_min_uses:URL经过多少次请求将被缓存</span></span><br><span class="line"><span class="comment">#fastcgi_cache_use_stale:定义哪些情况下用过期缓存</span></span><br><span class="line"><span class="comment">#fastcgi_cache_key:定义fastcgi_cache的key,示例中就以请求的URI作为缓存的key,Nginx会取这个key的md5作为缓存文件,如果设置了缓存哈希目录,Nginx会从后往前取相应的位数做为目录</span></span><br><span class="line"><span class="comment">#fastcgi_cache:用哪个缓存空间</span></span><br></pre></td></tr></table></figure>

<p>指定删除某一URL的php文件的缓存的PHP程序.<br>大致代码如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$md5</span> = md5(<span class="variable">$url</span>);</span><br><span class="line"><span class="variable">$cacheFile</span> = <span class="string">&#x27;/www/php_cache/&#x27;</span> . substr(<span class="variable">$md5</span>, -<span class="number">1</span>, <span class="number">1</span>) . <span class="string">&#x27;/&#x27;</span> . substr(<span class="variable">$md5</span>, -<span class="number">3</span>, <span class="number">2</span>) . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$md5</span>;</span><br><span class="line"><span class="keyword">if</span> (!file_exists(<span class="variable">$cacheFile</span>)) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;缓存不存在.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@unlink(<span class="variable">$cacheFile</span>)) &#123;</span><br><span class="line">    echo <span class="string">&#x27;清除缓存成功.&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    echo <span class="string">&#x27;清除缓存失败.&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>清理wordpress的数据库</title>
    <url>/2018/10/28/1557/</url>
    <content><![CDATA[<p>清理数据表为: wp_options, wp_posts, wp_postmeta.<br>我使用一款插件来完成clean-options,网上也经常采取删除这个数据库表的方法来处理.不过会丢失一些设置.<br>我也是使用的一款插件处理的 WP Cleaner .<br>下面在给出几条语句让你的wp_postmeta干净到非常.</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> wp_postmeta <span class="keyword">WHERE</span> meta_key = <span class="string">&#x27;_edit_lock&#x27;</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> wp_postmeta <span class="keyword">WHERE</span> meta_key = <span class="string">&#x27;_edit_last&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这是之前给出的两条语句测试安全删除无危险.</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> wp_postmeta <span class="keyword">WHERE</span> meta_key = <span class="string">&#x27;_wp_old_slug&#x27;</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> wp_postmeta <span class="keyword">WHERE</span> meta_key = <span class="string">&#x27;_revision-control&#x27;</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> wp_postmeta <span class="keyword">WHERE</span> meta_value = <span class="string">&#x27;&#123;&#123;unknown&#125;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>清空iptables规则</title>
    <url>/2013/07/19/1555/</url>
    <content><![CDATA[<p>清空iptables规则,设默认为ACCEPT.</p>
<p>我一般写规则之前都会这样做的,哈哈.</p>
<figure class="highlight tp"><table><tr><td class="code"><pre><span class="line">#<span class="comment">!/bin/sh</span></span><br><span class="line"><span class="comment">#accept-all policy</span></span><br><span class="line"><span class="comment">IPT=&#x27;/usr/local/sbin/iptables&#x27;</span></span><br><span class="line"><span class="comment">$</span>IPT -t nat -F</span><br><span class="line"><span class="variable">$IPT</span> -t nat -<span class="keyword">X</span></span><br><span class="line"><span class="variable">$IPT</span> -t nat -<span class="keyword">P</span> PREROUTING <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t nat -<span class="keyword">P</span> POSTROUTING <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t nat -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -F</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">X</span></span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">P</span> PREROUTING <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">P</span> INPUT <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">P</span> FORWARD <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t mangle -<span class="keyword">P</span> POSTROUTING <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -F</span><br><span class="line"><span class="variable">$IPT</span> -<span class="keyword">X</span></span><br><span class="line"><span class="variable">$IPT</span> -<span class="keyword">P</span> FORWARD <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -<span class="keyword">P</span> INPUT <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t raw -F</span><br><span class="line"><span class="variable">$IPT</span> -t raw -<span class="keyword">X</span></span><br><span class="line"><span class="variable">$IPT</span> -t raw -<span class="keyword">P</span> PREROUTING <span class="keyword">ACC</span>EPT</span><br><span class="line"><span class="variable">$IPT</span> -t raw -<span class="keyword">P</span> OUTPUT <span class="keyword">ACC</span>EPT</span><br></pre></td></tr></table></figure>

<p>以上写入脚本,执行,防火墙规则就清空了.</p>
]]></content>
  </entry>
  <entry>
    <title>清空linux记录</title>
    <url>/2015/09/10/1556/</url>
    <content><![CDATA[<p>由于linux会自动记录用户的登录记录和用户的操作历史,<br>所以当记录非常多的时候非常不便于我们查看.<br>这里我就清理一下linux自动生成的记录文件.<br>清除登陆系统成功的记录,也就是last命令看到的记录</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">[root@localhost root]$ echo <span class="string">&quot;&quot;</span>&gt; <span class="regexp">/var/l</span>og/wtmp <span class="comment">#此文件默认打开时乱码的,里面可以看到ip等等信息</span></span><br><span class="line">[root@localhost root]$ echo <span class="string">&quot;&quot;</span>&gt;<span class="regexp">/var/l</span>og/wtmp</span><br><span class="line">[root@localhost root]$ <span class="keyword">last</span></span><br></pre></td></tr></table></figure>

<p>此时即看不到用户登录信息<br>清除登陆系统失败的记录,也就是lastb命令看到的记录</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> root]$ echo <span class="string">&quot;&quot;</span>&gt; /var/<span class="built_in">log</span>/btmp <span class="meta">#此文件默认打开时乱码的</span></span><br><span class="line">[root<span class="symbol">@localhost</span> root]$ echo <span class="string">&quot;&quot;</span>&gt; /var/<span class="built_in">log</span>/btmp</span><br><span class="line">[root<span class="symbol">@localhost</span> root]$ lastb</span><br></pre></td></tr></table></figure>

<p>此时就没有结果输出了<br>清除历史执行命令</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> root]<span class="variable">$ </span>history -c</span><br></pre></td></tr></table></figure>

<p>或者,清空用户目录下的这个文件即可</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> root]<span class="variable">$ </span>echo <span class="string">&quot;&quot;</span>&gt; ./.bash_history</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>去掉linux系统开机动画</title>
    <url>/2017/08/07/1558/</url>
    <content><![CDATA[<p>编辑:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/boot/g</span>rub/grub.conf</span><br></pre></td></tr></table></figure>
<p>注释掉:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">splashimage</span>=(hd<span class="number">0</span>,<span class="number">6</span>)/grub/splash.xpm.gz</span><br></pre></td></tr></table></figure>
<p>开机的动画显示就消失了,剩下的就是文本的启动界面了,看上去很专业的.</p>
]]></content>
  </entry>
  <entry>
    <title>去掉serv-U 8.0 远程Web管理占用的80端口</title>
    <url>/2017/02/19/1559/</url>
    <content><![CDATA[<p>问题表现:安装完serv-U 8.0 ,重新启动之后,原有的Web80端口被Serv_U占用作为Web远程管理端口.<br>解决办法:管理服务器——域详细信息——配置域的监听器,在”监听器”选项卡上即可看到”80 HTTP”,可以将该端口删除,或者改成其他的端口亦可.<br>从安全考虑,可以只留21端口.其他的统统删掉.</p>
]]></content>
  </entry>
  <entry>
    <title>缺少mcrypt扩展和没有找到mbstring扩展</title>
    <url>/2014/05/26/1560/</url>
    <content><![CDATA[<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> php-mcrypt</span><br><span class="line">yum <span class="keyword">install</span> php-mbstring</span><br></pre></td></tr></table></figure>

<p>重启httpd:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/httpd start</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>让ecshop支持GD</title>
    <url>/2014/08/24/1561/</url>
    <content><![CDATA[<p>需要有服务器的管理权限.<br>把配置文件php.ini里的;extension=php_gd2.dll前面的;去掉.<br>重启iis或apache就好了.</p>
]]></content>
  </entry>
  <entry>
    <title>让Flask网站支持gzip压缩</title>
    <url>/2019/09/29/1562/</url>
    <content><![CDATA[<p>首先下载:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> flask-compress</span><br></pre></td></tr></table></figure>

<p>然后在初始化app时这样调用.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask.ext.<span class="keyword">compress</span> import <span class="keyword">Compress</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">app</span> = Flask(__name__)</span><br><span class="line"><span class="keyword">Compress</span>(<span class="keyword">app</span>)</span><br></pre></td></tr></table></figure>

<p>当然不一定只能在初始化时,也可以这样inject.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">flask import Flask</span><br><span class="line">from flask.ext.<span class="keyword">compress</span> import <span class="keyword">Compress</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">compress</span> = <span class="keyword">Compress</span>()</span><br><span class="line"></span><br><span class="line">def start_app():</span><br><span class="line">    <span class="keyword">app</span> = Flask(__name__)</span><br><span class="line">    <span class="keyword">compress</span>.init_app(<span class="keyword">app</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">app</span></span><br></pre></td></tr></table></figure>

<p>实际测试下来效果无限棒,目前还未发现什么bug.<br>当然，业务流量大的还是老老实实用nginx这种东西吧.</p>
]]></content>
  </entry>
  <entry>
    <title>让linux开机自动运行命令</title>
    <url>/2014/07/29/1563/</url>
    <content><![CDATA[<p>编辑 <code>/etc/rc.d/rc.local</code>.<br>这个文件里面的命令会在系统运行的时候执行.<br>所以我们只需要把我们需要开机执行的命令罗列在这里就可以实现开机自动运行了.<br>比如开机自动开启svn.<br>本机的命令就是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>尾部写入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">svnserver -d -r <span class="regexp">/opt/</span>svn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>

<p>reboot就可以看到效果了.</p>
]]></content>
  </entry>
  <entry>
    <title>让linux自动释放内存</title>
    <url>/2017/10/21/1564/</url>
    <content><![CDATA[<p>修改 <code>/proc/sys/vm/drop_caches</code>这个文件里面的内容.<br>默认为0.</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span>– 不释放</span><br><span class="line"><span class="symbol">1 </span>– 释放页缓存</span><br><span class="line"><span class="symbol">2 </span>– 释放dentries和inodes</span><br><span class="line"><span class="symbol">3 </span>– 释放所有缓存</span><br></pre></td></tr></table></figure>

<p>我们可以根据需要修改其值,我们可以将它添加到计划任务.</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">5</span> * * * sync &amp;&amp; echo <span class="string">&quot;3&quot;</span> &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>

<p>凌晨5点执行回收.</p>
]]></content>
  </entry>
  <entry>
    <title>如何解决MariaDB无密码就可以登录的问题(debian)</title>
    <url>/2011/12/16/1566/</url>
    <content><![CDATA[<p>困扰了很久的问题,使用apt-get来安装mysql,安装好之后发现安装的是 MariaDB,如下,无需密码既可以登录了.即使使用mysqladmin设置好密码,用密码登录可以,不用密码登录也可以.</p>
<p>排查思路:</p>
<p>第一看看my.conf有没有skip-grant-tables,跳过密码验证.<br>去跟安装正常的mysql来比较下,如下:</p>
<p>1 正常mysql:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section">mysql&gt; select user, plugin from mysql.user where plugin = &#x27;mysql_native_password&#x27;;</span></span><br><span class="line"><span class="section">+-----------+-----------------------+</span></span><br><span class="line"><span class="section">| user      | plugin                |</span></span><br><span class="line"><span class="section">+-----------+-----------------------+</span></span><br><span class="line"><span class="section">| root      | mysql_native_password |</span></span><br><span class="line"><span class="section">+-----------+-----------------------+</span></span><br><span class="line">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>不正常的:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select user, plugin from mysql.user;</span><br><span class="line"><span class="code">+------+</span>-------------+</span><br><span class="line"><span class="section">| user | plugin      |</span></span><br><span class="line"><span class="section">+------+-------------+</span></span><br><span class="line"><span class="section">| root | unix_socket |</span></span><br><span class="line"><span class="section">+------+-------------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>看到这里应该发现问题了,按照正常的修改就行了:<br>如下:</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">stop</span> mysqld</span><br><span class="line">mysqld_safe <span class="comment">--skip-grant-tables</span></span><br></pre></td></tr></table></figure>

<p>进去mysql执行如下命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">UPDATE</span> mysql.<span class="keyword">user</span> <span class="keyword">SET</span> authentication_string = <span class="keyword">PASSWORD</span>(<span class="string">&#x27;mypassword&#x27;</span>), plugin = <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="keyword">WHERE</span> <span class="keyword">User</span> = <span class="string">&#x27;root&#x27;</span> <span class="keyword">AND</span> Host = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">MariaDB [(<span class="keyword">none</span>)]&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>

<p>验证:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select user, plugin from mysql.user;</span><br><span class="line"><span class="code">+------+</span>-----------------------+</span><br><span class="line"><span class="section">| user | plugin                |</span></span><br><span class="line"><span class="section">+------+-----------------------+</span></span><br><span class="line"><span class="section">| root | mysql_native_password |</span></span><br><span class="line"><span class="section">+------+-----------------------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>ps -ef 查询mysql的pid并杀死:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kill</span> -<span class="number">9</span> pid</span><br></pre></td></tr></table></figure>

<p>启动:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> mysqld</span><br></pre></td></tr></table></figure>

<p>最后验证下:需要密码了.</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">root@debian:~# mysql</span><br><span class="line"><span class="keyword">ERROR </span>1045 (28000): Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: NO)</span><br></pre></td></tr></table></figure>

<p>二  网上还有说可以用另外一种办法:</p>
<p>MariaDB root 账户默认使用了 UNIX_SOCKET 插件,只允许 root 用户连接,无需密码.<br>可以使用 root 用户连接后创建新用户或者执行:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> mysql.<span class="keyword">user</span> <span class="keyword">set</span> plugin = <span class="string">&#x27;&#x27;</span><span class="keyword">where</span> <span class="keyword">User</span>=<span class="string">&#x27;root&#x27;</span>; </span><br><span class="line">flush <span class="keyword">privileges</span>; </span><br><span class="line"><span class="keyword">or</span> </span><br><span class="line"><span class="keyword">update</span> mysql.<span class="keyword">user</span> <span class="keyword">set</span> plugin = <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="keyword">where</span> <span class="keyword">User</span>=<span class="string">&#x27;root&#x27;</span>; </span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

<p>如果需要密码后,却无法进入,可按网上方法进行修改,如下:</p>
<p>方法1: 用SET PASSWORD命令:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; <span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> = <span class="keyword">PASSWORD</span>(<span class="string">&#x27;newpass&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>方法2:用mysqladmin:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u root password <span class="string">&quot;newpass&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果root已经设置过密码,采用如下方法:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u root password oldpass <span class="string">&quot;newpass&quot;</span></span><br></pre></td></tr></table></figure>

<p>方法3: 用UPDATE直接编辑user表:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; <span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">Password</span> = <span class="keyword">PASSWORD</span>(<span class="string">&#x27;newpass&#x27;</span>) <span class="keyword">WHERE</span> <span class="keyword">user</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>

<p>在丢失root密码的时候,可以这样:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysqld_safe <span class="comment">--skip-grant-tables&amp;</span></span><br><span class="line">mysql -u root mysql</span><br><span class="line">mysql&gt; <span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">password</span>=<span class="keyword">PASSWORD</span>(&quot;new password&quot;) <span class="keyword">WHERE</span> <span class="keyword">user</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>让广告在网也加载完成后加载</title>
    <url>/2011/08/28/1565/</url>
    <content><![CDATA[<p>有时候网页上的广告可能会影响用户体验,为了尽可能不影响用户浏览网页的效果,我们可以让广告放在最后加载,也就是网页上其它内容都显示完毕了,再去加载广告.有的广告放了不少联盟的广告,比如Google联盟的广告,我们就可以用Js实现Ajax的方式,让Googe广告最后显示.</p>
<p>第一步,先定义一个显示广告的Div:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">&quot;GoogleAD&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>第二步,以ajax方式加载广告,请把下面的代码放在html标签的<code>&lt;/body&gt;</code>前:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tempGoogleAD&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://pagead2.googlesyndication.com/pagead/show_ads.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">&quot;GoogleAD&quot;</span>).innerHTML = <span class="built_in">document</span>.getElementById(<span class="string">&quot;tempGoogleAD&quot;</span>).innerHTML;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">&quot;tempGoogleAD&quot;</span>).innerHTML = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>不只是Google广告可以这样,像百度联盟的广告或其它形式的广告都可以这样加载,提升你的网页体验度.</p>
]]></content>
  </entry>
  <entry>
    <title>删除已经创建的iptables(防火墙)规则</title>
    <url>/2015/02/17/1568/</url>
    <content><![CDATA[<p>首先使用 iptables -L -n 命令来查看已经创建的防火墙规则,</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[root@webxn ~]# iptables -L -n</span><br><span class="line">Chain <span class="keyword">INPUT</span> (<span class="keyword">policy</span> ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line"><span class="keyword">DROP</span>       <span class="keyword">all</span>  <span class="comment">--  173.231.17.71        0.0.0.0/0</span></span><br><span class="line"><span class="keyword">DROP</span>       <span class="keyword">all</span>  <span class="comment">--  173.231.17.71        0.0.0.0/0</span></span><br><span class="line">ACCEPT     <span class="keyword">all</span>  <span class="comment">--  173.252.192.205      0.0.0.0/0</span></span><br><span class="line"><span class="keyword">DROP</span>       <span class="keyword">all</span>  <span class="comment">--  173.252.192.205      0.0.0.0/0</span></span><br><span class="line"><span class="keyword">DROP</span>       <span class="keyword">all</span>  <span class="comment">--  173.252.192.205      0.0.0.0/0</span></span><br><span class="line">ACCEPT     <span class="keyword">all</span>  <span class="comment">--  173.252.192.205      0.0.0.0/0</span></span><br><span class="line"><span class="keyword">DROP</span>       <span class="keyword">all</span>  <span class="comment">--  173.252.192.205      0.0.0.0/0</span></span><br><span class="line"></span><br><span class="line">Chain FORWARD (<span class="keyword">policy</span> ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (<span class="keyword">policy</span> ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">[root@webxn ~]# iptables -h</span><br><span class="line">iptables v1<span class="number">.3</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到我创建了很多规则.<br>然后我们可以使用命令:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">iptables -D <span class="literal">INPUT</span> * </span><br></pre></td></tr></table></figure>

<p>来删除制定规则,<br>比如我们删除第一行的规则, 那我们就可以执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -D INPUT <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>就可以了.</p>
]]></content>
  </entry>
  <entry>
    <title>删除超过30天的备份</title>
    <url>/2015/04/18/1567/</url>
    <content><![CDATA[<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find</span> <span class="regexp">/home/</span>superman003<span class="regexp">/mysqlbak/</span> -mtime +<span class="number">30</span> -name <span class="string">&quot;*&quot;</span> -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>设置mysql数据库为只读</title>
    <url>/2020/04/15/1569/</url>
    <content><![CDATA[<p>在配置mysql主从同步的时候通常需要设置主库为只读，可以通过以下方式实现。</p>
<p>设置命令：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="builtin-name">set</span> global <span class="attribute">read_only</span>=1;</span><br></pre></td></tr></table></figure>

<p>查看设置结果：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> &quot;%read_only%&quot;;</span><br></pre></td></tr></table></figure>

<p>恢复命令：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="builtin-name">set</span> global <span class="attribute">read_only</span>=0;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>实时监控Linux、FreeBSD登陆用户的操作</title>
    <url>/2012/04/14/1571/</url>
    <content><![CDATA[<p>在 Linux 中,我们可以使用下面这台命令来得到另一个终端的用户的输入输出是什么:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">strace -e <span class="built_in">read</span>,<span class="built_in">write</span> -s16384 -x -p <span class="string">&quot;用户 pst 的pid&quot;</span></span><br></pre></td></tr></table></figure>

<p>但 strace 的输出,基本不可读,我刚好发现在 CPAN 上有相应的模块来来帮大家解析,可以通过那个软件直接见到用户的输入输出的内容,可以实时见到他的操作.相当的方便.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cpanm ttylog</span></span><br></pre></td></tr></table></figure>

<p>这个的使用也很方便,直接使用 w 看看新进入的用户使用的是哪个 tty .然后使用这个软件指定见到的那个 tty 就行.<br>例如新用户进来后是 pst/4.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ttylog</span> pts/<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>这样,就可以实时见到用户的操作了.也可以给这个程序的输出记录到日志中,以后好找别人算账是吧…因为他的每一个操作你都能见到.<br>FreeBSD下的watch命令可以也可实现同样的目的:<br>FreeBSD的watch命令与Linux下的watch命令完全不一样.FreeBSD下的watch命令是查看其它用户的正在运行的操作,而linux下的watch是自动定时运行一个(一行)命令.<br>下面是FreeBSD下的watch命令的介绍:</p>
<figure class="highlight hsp"><table><tr><td class="code"><pre><span class="line">watch — snoop <span class="keyword">on</span> another tty <span class="keyword">line</span></span><br></pre></td></tr></table></figure>

<p>watch允许你偷看其它terminal正在做什么,该命令只能让超级用户使用.<br>为什么要用watch?<br>有时候,基于安全的目的,你可以用watch看某个用户在干什么.也许你发现你的机器被某人黑了,你想看看他正在你的机器干什么.我不清楚,或者你只是好管闲事.<br>运行watch需要什么?<br>watch需要打开下面的Kernel options:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">pseudo</span>-device snp <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>这会允许你拥有4个 snoop devices.<br>建立4个devices:</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/dev</span></span><br><span class="line"><span class="string">./MAKEDEV</span> snp0</span><br><span class="line"><span class="string">./MAKEDEV</span> snp1</span><br><span class="line"><span class="string">./MAKEDEV</span> snp2</span><br><span class="line"><span class="string">./MAKEDEV</span> snp3</span><br></pre></td></tr></table></figure>

<p>错误:如果看到下面这个错误,那你必须按照上面所说的方法去做:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">watch: fata<span class="variable">l:</span> cannot <span class="keyword">open</span> snoop device</span><br></pre></td></tr></table></figure>

<p>运行watch:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># who</span></span><br><span class="line"><span class="attribute">dan</span> ttyp<span class="number">0</span> Nov <span class="number">27</span> <span class="number">17</span>:<span class="number">35</span> (wocker.int) dan ttyp<span class="number">1</span> Nov <span class="number">28</span> <span class="number">12</span>:<span class="number">36</span> (wocker.int)</span><br><span class="line"><span class="comment"># watch ttyp1</span></span><br></pre></td></tr></table></figure>

<p>或者,如果你想要能写入其它的terminal,可以尝试-W参数:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># watch -W ttyp1</span></span><br></pre></td></tr></table></figure>

<p>其它操作:<br>切换终端:</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">Ctrl+<span class="keyword">x</span></span><br></pre></td></tr></table></figure>

<p>退出watch:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Ctrl+g</span><br></pre></td></tr></table></figure>

<p>ttysnoop(s)</p>
<p>ttysnoop是一个重定向对一个终端号的所有输入/输出到另一个终端的程序.<br>目前我所知道的它的所在网站为http: //uscan.cjb.net,但是始终连不上去,从其它途径我得到了ttysnoop-0.12c-5 ,地址是<a href="http://rpmfind.net/linux/RPM/contrib/libc6/i386/ttysnoop-0.12c-5.i386.html">http://rpmfind.net/linux/RPM/contrib/libc6/i386/ttysnoop-0.12c-5.i386.html</a><br>这个版本好象还不能支持shadow password,安装后你需要手动创建目录 <code>/var/spool/ttysnoop</code>测试这个程序是有趣的,下面是相关指令:首先改 <code>/etc</code> <code>/inetd.conf</code>中的in.telnetd默认调用login登录程序为 <code>/sbin/ttysnoops</code>,象下面这样:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># more inetd.conf │ grep in.telnetd</span></span><br><span class="line">telnet stream tcp nowait root <span class="regexp">/usr/</span>sbin<span class="regexp">/tcpd in.telnetd -L /</span>sbin/ttysnoops</span><br></pre></td></tr></table></figure>

<p>更改后一定要运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">killall -HUP inetd</span></span><br></pre></td></tr></table></figure>

<p>使之生效,确保不要使用阴影口令,用#pwunconv禁止阴影口令.<br>再编辑文件 <code>/etc/snooptab</code>,默认配置就可以了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># more snooptab</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ttyS1 <span class="regexp">/dev/</span>tty7 login <span class="regexp">/bin/</span>login ttyS2 <span class="regexp">/dev/</span>tty8 login <span class="regexp">/bin/</span>login * socket login <span class="regexp">/bin/</span>login</span><br></pre></td></tr></table></figure>

<p>最后,如果在某个终端上有人登录进来(你可以用w命令查看它在哪个终端),如登录终端设备为ttyp0,则你可以登录进服务器打入 <code>#/bin/ttysnoop ttyp0</code>(提示输入root口令,再次,上面提到的这个版本不支持阴影口令)以监视用户的登录窗口.没有用过,我想写还是有一定管理作用的.</p>
]]></content>
  </entry>
  <entry>
    <title>设置程序开机启动和检测</title>
    <url>/2018/02/21/1570/</url>
    <content><![CDATA[<p>将pound设置为开机自动启动.</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">$ chkconfig <span class="comment">--level 5 pound on</span></span><br><span class="line">$ chkconfig <span class="comment">--level 3 pound on</span></span><br><span class="line">$ chkconfig <span class="comment">--list|grep pound</span></span><br><span class="line"></span><br><span class="line">pound <span class="number">0</span>:关闭 <span class="number">1</span>:关闭 <span class="number">2</span>:关闭 <span class="number">3</span>:启用 <span class="number">4</span>:关闭 <span class="number">5</span>:启用 <span class="number">6</span>:关闭</span><br></pre></td></tr></table></figure>

<p>以将pound设置为开机启动.<br>通过上面方法设置后,可以通过重启电脑的方式来测试pound是否可以自启动,<br>重启电脑命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br></pre></td></tr></table></figure>

<p>然后等待一段时间.重新连接,连接后可以通过以下命令可以查看pound是否启动成功.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ps</span> -eaf|grep pound</span><br><span class="line"></span><br><span class="line"><span class="attribute">root</span> <span class="number">2651</span> <span class="number">1</span> <span class="number">0</span> <span class="number">18</span>:<span class="number">39</span> ? <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> /usr/sbin/pound</span><br><span class="line"><span class="attribute">root</span> <span class="number">3937</span> <span class="number">3052</span> <span class="number">0</span> <span class="number">18</span>:<span class="number">42</span> pts/<span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep pound</span><br></pre></td></tr></table></figure>

<p>说明pound已经自启动成功了.</p>
]]></content>
  </entry>
  <entry>
    <title>实现ganglia监控多主机的方法</title>
    <url>/2013/06/04/1572/</url>
    <content><![CDATA[<p>在监控服务器编写一个脚本文件,执行它可以将服务快速的发布到被监控主机上.</p>
<p>step1、首先编写一个主机地址文件:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi mynodes</span></span><br></pre></td></tr></table></figure>

<p>添加你的主机名或服务器ip到该文件,我这里只写了5台主机.</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.10.1</span></span><br><span class="line"><span class="number">192.168.10.2</span></span><br><span class="line"><span class="number">192.168.10.3</span></span><br><span class="line"><span class="number">192.168.10.4</span></span><br><span class="line"><span class="number">192.168.10.5</span></span><br></pre></td></tr></table></figure>

<p>step2、编写脚本实现服务的发布</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vi</span> ganglia.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p>使用以下内容,这里使用的是64位OS,如果是32位OS,将下面的lib64改为lib.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat mynodes`; <span class="keyword">do</span></span><br><span class="line">scp <span class="regexp">/usr/</span>bin<span class="regexp">/gmetric $i:/u</span>sr/bin</span><br><span class="line">scp <span class="regexp">/usr/</span>sbin<span class="regexp">/gmond $i:/u</span>sr<span class="regexp">/sbin/gm</span>ond</span><br><span class="line">ssh <span class="variable">$i</span> mkdir -p <span class="regexp">/etc/g</span>anglia/</span><br><span class="line">scp <span class="regexp">/etc/g</span>anglia<span class="regexp">/gmond.conf $i:/</span>etc<span class="regexp">/ganglia/</span></span><br><span class="line">scp <span class="regexp">/etc/i</span>nit.d<span class="regexp">/gmond $i:/</span>etc<span class="regexp">/init.d/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libganglia-3.1.2.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/lib64/</span>libexpat.so.<span class="number">0</span> <span class="variable">$i</span>:<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libconfuse.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp <span class="regexp">/usr/</span>lib64<span class="regexp">/libapr-1.so.0 $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">scp -r <span class="regexp">/usr/</span>lib64<span class="regexp">/ganglia $i:/u</span>sr<span class="regexp">/lib64/</span></span><br><span class="line">ssh <span class="variable">$i</span> service gmond start</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>赋予脚本可执行权限并执行.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">chmod 755 ganglia.<span class="keyword">sh</span></span><br><span class="line">./ganglia.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p>至此ganglia客户端和服务器端的配置完成,可以通过web访问来监控你的群集了.</p>
<p>传送的文件版本可能不同要根据自己的情况去修改版本信息.<br>传送的文件版本可能不同要根据自己的情况去修改版本信息.</p>
]]></content>
  </entry>
  <entry>
    <title>使用chkrootkit工具保护服务器</title>
    <url>/2016/05/09/1575/</url>
    <content><![CDATA[<p>安装chkrootkit,你可以自己去 <a href="http://www.chkrootkit.org/download/">http://www.chkrootkit.org/download/</a> 下载源码包,然后自己编译,也可以和我一样偷懒用别人做好的二进制包.</p>
<p>centos 下用非官方源安装chkrootkit:</p>
<p>首先添加dag 源for centos(我的系统是centos5.2).</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/yum</span>.repos.d/dag.repo</span><br><span class="line"></span><br><span class="line">[dag]</span><br><span class="line">name=Dag RPM Repository <span class="keyword">for</span> Red Hat Enterprise Linux</span><br><span class="line">baseurl=http:<span class="regexp">//</span>apt.sw.be<span class="regexp">/redhat/</span>el<span class="variable">$releasever</span><span class="regexp">/en/</span><span class="variable">$basearch</span>/dag</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rpm –import http:<span class="regexp">//</span>dag.wieers.com<span class="regexp">/rpm/</span>packages/RPM-GPG-KEY.dag.txt</span><br></pre></td></tr></table></figure>

<p>yum 安装chkrootkit:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum update</span><br><span class="line">yum <span class="keyword">install</span> chkrootkit</span><br></pre></td></tr></table></figure>

<p>chkrootkit的应用:</p>
<p>chkrootkit 的使用非常简单直接运行 chkrootkit 命令,然后会有如下输出:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">ROOTDIR <span class="keyword">is</span> `/<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Checking `amd&#x27;</span>… <span class="keyword">not</span> <span class="built_in">found</span></span><br><span class="line">Checking `basenam<span class="string">e&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `biff&#x27;</span>… <span class="keyword">not</span> <span class="built_in">found</span></span><br><span class="line">Checking `chfn<span class="string">&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `chsh&#x27;</span>… <span class="keyword">not</span> infected</span><br><span class="line">Checking `cron<span class="string">&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `crontab&#x27;</span>… <span class="keyword">not</span> infected</span><br><span class="line">Checking `<span class="type">date</span><span class="string">&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `du&#x27;</span>… <span class="keyword">not</span> infected</span><br><span class="line">Checking `dirnam<span class="string">e&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `echo&#x27;</span>… <span class="keyword">not</span> infected</span><br><span class="line">Checking `egrep<span class="string">&#x27;… not infected</span></span><br><span class="line"><span class="string">Checking `env&#x27;</span>… <span class="keyword">not</span> infected</span><br></pre></td></tr></table></figure>

<p>如果有rootkit会报”INFECTED” 所以可以直接用chkrootkit -n|grep ‘INFECTED’更直接一些.</p>
<p>定时检测并在出问题时给管理员发邮件.<br>创建如下脚本chkrootkit.sh并放入crontab 定时运行.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat chkrootkit.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PATH=<span class="regexp">/usr/</span>bin:/bin</span><br><span class="line"></span><br><span class="line">TMPLOG=`mktemp`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the chkrootkit</span></span><br><span class="line"><span class="regexp">/usr/</span>bin/chkrootkit &gt; <span class="variable">$TMPLOG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output the log</span></span><br><span class="line">cat <span class="variable">$TMPLOG</span> | logger -t chkrootkit</span><br><span class="line"></span><br><span class="line"><span class="comment"># bindshe of SMTPSllHow to do some wrongs</span></span><br><span class="line"><span class="keyword">if</span> [ ! -z <span class="string">&quot;$(grep 465 $TMPLOG)&quot;</span> ] &amp;&amp;</span><br><span class="line">[ -z $(<span class="regexp">/usr/</span>sbin/lsof -i:<span class="number">465</span>|grep bindshell) ]; then</span><br><span class="line">sed -i <span class="string">&#x27;/465/d&#x27;</span> <span class="variable">$TMPLOG</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment"># If the rootkit have been found,mail root</span></span><br><span class="line">[ ! -z <span class="string">&quot;$(grep INFECTED $TMPLOG)&quot;</span> ] &amp;&amp;</span><br><span class="line">grep INFECTED <span class="variable">$TMPLOG</span> | mail -s <span class="string">&quot;chkrootkit report in `hostname`&quot;</span> root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod <span class="number">700</span> chkroot.sh</span><br><span class="line">mv chkrootkit <span class="regexp">/etc/</span>cron.daily</span><br></pre></td></tr></table></figure>

<p>这样系统会每天运行chkrootkit 检测系统,并在检测到rootkit 时给root 发一封邮件.</p>
]]></content>
  </entry>
  <entry>
    <title>实现多机ssh免密码登录</title>
    <url>/2013/06/24/1574/</url>
    <content><![CDATA[<p>实现步骤:</p>
<p>1.在你的自己的机器下面使用ssh-keygen命令来实现创建公钥.</p>
<p>使用:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh-keygen -t rsa</span></span><br></pre></td></tr></table></figure>

<p>来创建密钥,程序会问你存放的目录,如果不需要修改,直接回车两次即可.</p>
<p>2.将你 <code>~/.ssh</code>目录中的id_rsa.pub这个文件拷贝到你要登录的服务器的 <code>~/.ssh</code>目录中,然后再运行以下命令来将公钥导入到~`/.ssh/authorized_keys`这个文件中.</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">cat ~<span class="regexp">/.ssh/i</span>d_rsa.pub &gt;&gt; ~<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure>

<p>另外要注意请务必要将服务器上.<br><code>~/.ssh</code>权限设置为700.<br><code>~/.ssh/authorized_keys</code>的权限设置为600.<br>这是linux的安全要求,如果权限不对,自动登录将不会生效.<br>完毕之后,退出服务器的登录,再使用ssh登录,你就会发现服务器不会再向你询问密码了.</p>
<p>补充:<br>有读者提出拷贝公钥文件到服务器上这个过程可以用ssh-copy-id命令来完成,下面是命令使用列表.</p>
<p>默认用法:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">ssh-<span class="keyword">copy</span>-id <span class="keyword">user</span>@<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>自定义用法:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">ssh-<span class="keyword">copy</span>-id -i 公钥文件路径 <span class="keyword">user</span>@<span class="keyword">server</span></span><br><span class="line">ssh-<span class="keyword">copy</span>-id -p 服务器SSH服务端口 <span class="keyword">user</span>@<span class="keyword">server</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>实现Ubuntu Linux下WPA无线上网</title>
    <url>/2018/08/11/1573/</url>
    <content><![CDATA[<p>1、安装wpa_supplicant</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">apt-<span class="builtin-name">get</span> install wpasupplicant</span><br></pre></td></tr></table></figure>

<p>2、创建 <code>/etc/wpa_supplicant.conf</code>包含以下内容</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    <span class="attribute">ssid</span>=<span class="string">&quot;你的无线网ssid&quot;</span></span><br><span class="line">    <span class="attribute">psk</span>=<span class="string">&quot;你的wpa口令&quot;</span></span><br><span class="line">    <span class="attribute">key_mgmt</span>=WPA-PSK</span><br><span class="line">    <span class="attribute">proto</span>=WPA</span><br><span class="line">    <span class="attribute">pairwise</span>=TKIP</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、编辑 <code>/etc/network/interfaces</code></p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">iface eth1 inet dhcp</span><br><span class="line">pre-up wp<span class="built_in">a_supplicant</span> -Bw -Dwext -i eth1 -c/etc/wp<span class="built_in">a_supplicant</span>.conf</span><br><span class="line">post-down killall -q wp<span class="built_in">a_supplicant</span></span><br></pre></td></tr></table></figure>

<p>注:eth1是你的网卡,并且假设你使用dhcp协议.</p>
<p>4、启动你的网卡</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifup</span> eth<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>如果有必要请关闭你的有线网络(ifdown eth0),防止路由问题.</p>
]]></content>
  </entry>
  <entry>
    <title>使用dd命令测试VPS或者独立主机的磁盘读写能力</title>
    <url>/2016/08/08/1576/</url>
    <content><![CDATA[<p>一般我购买了独立主机或者VPS后都希望测试一下机器的性能,下面就是测试主机磁盘读写能力的一个命令,虽然不及一些专业测试软件全面,但是也能对主机的磁盘能力有一个大概的了解.<br>dd 是 Linux/UNIX 下的一个非常有用的命令,作用是用指定大小的块拷贝一个文件,并在拷贝的同时进行指定的转换.</p>
<p>1.命令简介,dd 的主要选项:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#指定数字的地方若以下列字符结尾乘以相应的数字:</span></span><br><span class="line"><span class="attribute">b</span>=512, <span class="attribute">c</span>=1, <span class="attribute">k</span>=1024, <span class="attribute">w</span>=2, <span class="attribute">xm</span>=number m</span><br><span class="line"><span class="attribute">if</span>=file</span><br><span class="line"><span class="comment">#输入文件名,缺省为标准输入.</span></span><br><span class="line"><span class="attribute">of</span>=file</span><br><span class="line"><span class="comment">#输出文件名,缺省为标准输出.</span></span><br><span class="line"><span class="attribute">ibs</span>=bytes</span><br><span class="line"><span class="comment">#一次读入 bytes 个字节(即一个块大小为 bytes 个字节).</span></span><br><span class="line"><span class="attribute">obs</span>=bytes</span><br><span class="line"><span class="comment">#一次写 bytes 个字节(即一个块大小为 bytes 个字节).</span></span><br><span class="line"><span class="attribute">bs</span>=bytes</span><br><span class="line"><span class="comment">#同时设置读写块的大小为 bytes ,可代替 ibs 和 obs .</span></span><br><span class="line"><span class="attribute">cbs</span>=bytes</span><br><span class="line"><span class="comment">#一次转换 bytes 个字节,即转换缓冲区大小.</span></span><br><span class="line"><span class="attribute">skip</span>=blocks</span><br><span class="line"><span class="comment">#从输入文件开头跳过 blocks 个块后再开始复制.</span></span><br><span class="line"><span class="attribute">seek</span>=blocks</span><br><span class="line"><span class="comment">#从输出文件开头跳过 blocks 个块后再开始复制.(通常只有当输出文件是磁盘或磁带时才有效).</span></span><br><span class="line"><span class="attribute">count</span>=blocks</span><br><span class="line"><span class="comment">#仅拷贝 blocks 个块,块大小等于 ibs 指定的字节数.</span></span><br><span class="line"><span class="attribute">conv</span>=conversion[,conversion<span class="built_in">..</span>.]</span><br><span class="line"><span class="comment">#用指定的参数转换文件.</span></span><br></pre></td></tr></table></figure>

<p>转换参数:</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">ascii 转换 EBCDIC 为 ASCII.</span><br><span class="line">ebcdic 转换 ASCII 为 EBCDIC.</span><br><span class="line">ibm 转换 ASCII 为 alternate EBCDIC.</span><br><span class="line">block 把每一行转换为长度为 cbs 的记录,不足部分用空格填充.</span><br><span class="line">unblock 使每一行的长度都为 cbs ,不足部分用空格填充.</span><br><span class="line">lcase 把大写字符转换为小写字符.</span><br><span class="line">ucase 把小写字符转换为大写字符.</span><br><span class="line">swab 交换输入的每对字节.</span><br><span class="line">noerror 出错时不停止.</span><br><span class="line">notrunc 不截短输出文件.</span><br><span class="line">sync 把每个输入块填充到ibs个字节,不足部分用空(NUL)字符补齐.</span><br></pre></td></tr></table></figure>

<p>2.实例分析</p>
<p>备份:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>hdx of=<span class="regexp">/dev/</span>hdy</span><br></pre></td></tr></table></figure>

<p>将本地的/dev/hdx整盘备份到/dev/hdy:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>hdx of=<span class="regexp">/path/</span>to/image</span><br></pre></td></tr></table></figure>

<p>将/dev/hdx全盘数据备份到指定路径的image文件:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>hdx | gzip &gt;<span class="regexp">/path/</span>to/image.gz</span><br></pre></td></tr></table></figure>

<p>备份/dev/hdx全盘数据,并利用gzip工具进行压缩,保存到指定路径.</p>
<p>恢复:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/path/</span>to/image of=<span class="regexp">/dev/</span>hdx</span><br></pre></td></tr></table></figure>

<p>将备份文件恢复到指定盘:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gzip -dc <span class="regexp">/path/</span>to<span class="regexp">/image.gz | dd of=/</span>dev/hdx</span><br></pre></td></tr></table></figure>

<p>将压缩的备份文件恢复到指定盘.</p>
<p>2.1.2.利用netcat远程备份</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/hda <span class="attribute">bs</span>=16065b | netcat &lt; targethost-IP &gt; 1234</span><br></pre></td></tr></table></figure>

<p>在源主机上执行此命令备份/dev/hda:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">netcat -l -p 1234 | dd <span class="attribute">of</span>=/dev/hdc <span class="attribute">bs</span>=16065b</span><br></pre></td></tr></table></figure>

<p>在目的主机上执行此命令来接收数据并写入/dev/hdc:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">netcat</span> -l -p <span class="number">1234</span> | bzip<span class="number">2</span> &gt; partition.img</span><br><span class="line"><span class="attribute">netcat</span> -l -p <span class="number">1234</span> | gzip &gt; partition.img</span><br></pre></td></tr></table></figure>

<p>以上两条指令是目的主机指令的变化分别采用bzip2 gzip对数据进行压缩,并将备份文件保存在当前目录.</p>
<p>2.1.3.备份MBR</p>
<p>备份:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/hdx <span class="attribute">of</span>=/path/to/image <span class="attribute">count</span>=1 <span class="attribute">bs</span>=512</span><br></pre></td></tr></table></figure>

<p>备份磁盘开始的512Byte大小的MBR信息到指定文件.</p>
<p>恢复:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/path/</span>to/image of=<span class="regexp">/dev/</span>hdx</span><br></pre></td></tr></table></figure>

<p>将备份的MBR信息写到磁盘开始部分.</p>
<p>2.1.4.备份软盘</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/fd0 <span class="attribute">of</span>=disk.img <span class="attribute">count</span>=1 <span class="attribute">bs</span>=1440k</span><br></pre></td></tr></table></figure>

<p>将软驱数据备份到当前目录的disk.img文件.</p>
<p>2.1.5.拷贝内存资料到硬盘</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/mem <span class="attribute">of</span>=/root/mem.bin <span class="attribute">bs</span>=1024</span><br></pre></td></tr></table></figure>

<p>将内存里的数据拷贝到root目录下的mem.bin文件.</p>
<p>2.1.6.从光盘拷贝iso镜像</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>cdrom of=<span class="regexp">/root/</span>cd.iso</span><br></pre></td></tr></table></figure>

<p>拷贝光盘数据到root文件夹下,并保存为cd.iso文件.</p>
<p>2.2.增加Swap分区文件大小</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/swapfile <span class="attribute">bs</span>=1024 <span class="attribute">count</span>=262144</span><br></pre></td></tr></table></figure>

<p>创建一个足够大的文件(此处为256M).</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mkswap <span class="string">/swapfile</span></span><br></pre></td></tr></table></figure>

<p>把这个文件变成swap文件.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">swapon <span class="string">/swapfile</span></span><br></pre></td></tr></table></figure>

<p>启用这个swap文件.</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">/swapfile <span class="keyword">swap</span> <span class="keyword">swap</span> defaults <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>在每次开机的时候自动加载swap文件, 需要在 /etc/fstab 文件中增加一行.</p>
<p>2.3.销毁磁盘数据</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/u</span>random of=<span class="regexp">/dev/</span>hda1</span><br></pre></td></tr></table></figure>

<p>利用随机的数据填充硬盘,在某些必要的场合可以用来销毁数据.执行此操作以后,/dev/hda1将无法挂载,创建和拷贝操作无法执行.</p>
<p>2.4磁盘管理</p>
<p>2.4.1.得到最恰当的block size</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">bs</span>=1024 <span class="attribute">count</span>=1000000 <span class="attribute">of</span>=/root/1Gb.file</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">bs</span>=2048 <span class="attribute">count</span>=500000 <span class="attribute">of</span>=/root/1Gb.file</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">bs</span>=4096 <span class="attribute">count</span>=250000 <span class="attribute">of</span>=/root/1Gb.file</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">bs</span>=8192 <span class="attribute">count</span>=125000 <span class="attribute">of</span>=/root/1Gb.file</span><br></pre></td></tr></table></figure>

<p>通过比较dd指令输出中所显示的命令执行时间,即可确定系统最佳的block size大小.</p>
<p>2.4.2测试硬盘读写速度</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/root/1Gb.file <span class="attribute">bs</span>=64k | dd <span class="attribute">of</span>=/dev/null</span><br><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/root/1Gb.file <span class="attribute">bs</span>=1024 <span class="attribute">count</span>=1000000</span><br></pre></td></tr></table></figure>

<p>通过上两个命令输出的执行时间,可以计算出测试硬盘的读／写速度.</p>
<p>2.4.3.修复硬盘</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>sda of=<span class="regexp">/dev/</span>sda</span><br></pre></td></tr></table></figure>

<p>当硬盘较长时间(比如1,2年)放置不使用后,磁盘上会产生magnetic flux point.当磁头读到这些区域时会遇到困难,并可能导致I/O错误.当这种情况影响到硬盘的第一个扇区时,可能导致硬盘报废.上边的命令有可能使这些数据起死回生.且这个过程是安全,高效的.</p>
<p>这个一般都是用来测磁盘阵列的,比如我们单位买的HP VA7110,14块146G 10k转的硬盘做raid 1+0,测出来读是100MB/s、写是50MB/s、读写是40MB/s、40MB/s,与HP宣传手册上的读160MB/s、写84MB/s还是有较大差距,HP的人说这个最高数据是满配时测的,cache为2G,我们只有1G,硬盘多半是15k的,硬盘肯定是加满的.</p>
<p>测试磁盘的纯写入性能:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/file</span><br></pre></td></tr></table></figure>

<p>测试磁盘的纯读取性能:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/file <span class="attribute">of</span>=/dev/null</span><br></pre></td></tr></table></figure>

<p>来测试磁盘的读写性能:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/file1 <span class="attribute">of</span>=/file2</span><br></pre></td></tr></table></figure>

<p>有一些特殊的设备文件.例如 <code>/dev/zero</code>文件代表一个永远输出 0的设备文件,使用它作输入可以得到全为空的文件.因此可用来创建新文件和以覆盖的方式清除旧文件.下面使用dd命令将从zero设备中创建一个10K大小(bs决定每次读写1024字节,count定义读写次数为10次),但内容全为0的文件.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=file <span class="attribute">count</span>=10 <span class="attribute">bs</span>=1024</span><br><span class="line"></span><br><span class="line">10+0 records <span class="keyword">in</span></span><br><span class="line">10+0 records out</span><br><span class="line">10240 bytes transferred <span class="keyword">in</span> 0.001408 secs (7267903 b ytes/sec)</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>使用dd命令直接创建一个大小为1G的文件</title>
    <url>/2014/07/18/1577/</url>
    <content><![CDATA[<p>非常简单的命令,只要运行:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/zero <span class="attribute">of</span>=/tem/test <span class="attribute">bs</span>=1M <span class="attribute">count</span>=1024</span><br></pre></td></tr></table></figure>

<p>就可以在/tem/下建立一个名为test的1g的文件.<br>有些事后测试磁盘IO性能时候还是非常有用的.</p>
]]></content>
  </entry>
  <entry>
    <title>使用git迁移git项目并保留提交记录</title>
    <url>/2015/12/28/1579/</url>
    <content><![CDATA[<p>在平时开发中我们有自己的git仓库,组内提交都是在这个库.突然有一天,领导说要把这个库整合到另一个更大的工程中,那里面有前后端的代码;为了方便大家查找,我们需要将各个组的代码迁移到同一个大工程下.</p>
<p>问题:</p>
<p>1,提交要保留提交记录<br>2,changelog要保留<br>3,组内成员要保留</p>
<p>解决方案:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">git</span></span> push --mirror ......</span><br></pre></td></tr></table></figure>

<p>操作:</p>
<p>假如我们原有的仓库为 <code>git@codehub.devcloud.huaweicloud.com:project.git</code>.</p>
<p>1.从原地址克隆一份裸版本库.</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">--bare</span> git@codehub.devcloud.huaweicloud.com:project.git</span><br></pre></td></tr></table></figure>

<p>2.在新目录创建git___空___项目.</p>
<p>这一步是为了让旧项目有镜像.<br>假如新仓库地址为 <code>git@codehub.devcloud.huaweicloud.com:leaderProject.git</code>.</p>
<p>3.镜像推送代码到新仓库.</p>
<p>进入旧git目录,推送即可.</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>cd project</span><br><span class="line"><span class="variable">$ </span>git push --mirror git<span class="variable">@codehub</span>.<span class="symbol">devcloud.huaweicloud.com:</span>leaderProject.git</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>使用gunicorn启动flask项目</title>
    <url>/2021/06/07/1580/</url>
    <content><![CDATA[<p>gunicorn安装非常简单，使用命令一条即可。</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> gunicorn</span><br></pre></td></tr></table></figure>

<p>一般我们使用gunicorn，主要是为使用其异步的worker模型，还需要安装对应的异步模块。</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ pip <span class="keyword">install</span> greenlet <span class="comment"># 使用异步必须安装</span></span><br><span class="line">$ pip <span class="keyword">install</span> eventlet <span class="comment"># 使用eventlet workers</span></span><br><span class="line">$ pip <span class="keyword">install</span> gevent   <span class="comment"># 使用gevent workers</span></span><br></pre></td></tr></table></figure>

<p>这里使用gunicorn来部署一个flask项目举例，此处flask框架的使用不过多阐述，不是本文的重点。</p>
<p>如下例子，保存为app.py。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span></span><br></pre></td></tr></table></figure>

<p>gunicorn通常使用的参数如下：</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">-c <span class="built_in">CONFIG</span>, --<span class="built_in">config</span>=<span class="built_in">CONFIG</span></span><br></pre></td></tr></table></figure>

<p>设定配置文件。</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">-b <span class="keyword">BIND</span>, --<span class="keyword">bind</span>=<span class="keyword">BIND</span></span><br></pre></td></tr></table></figure>

<p>设定服务需要绑定的端口。建议使用HOST:PORT。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">-w WORKERS, <span class="attribute">--workers</span>=WORKERS</span><br></pre></td></tr></table></figure>

<p>设置工作进程数。建议服务器每一个核心可以设置2-4个。</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-k MODULE</span></span><br></pre></td></tr></table></figure>

<p>选定异步工作方式使用的模块。<br>在shell中输入你的启动配置，比如：</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ gunicorn -w 3 -b 127.0.0.1:8080 <span class="keyword">app</span>:<span class="keyword">app</span></span><br></pre></td></tr></table></figure>

<p>此处app:app中，第一个app为flask项目实例所在的包，第二个app为生成的flask项目实例这样运行正常就可以启动服务器了。</p>
]]></content>
  </entry>
  <entry>
    <title>使用DenyHosts防止ssh被暴力破解</title>
    <url>/2013/01/19/1578/</url>
    <content><![CDATA[<p>我的服务器每天都会有无数的SSH失败尝试记录,有些无聊的人一直不停的扫描,这些人真够无聊的,没事吃饱了撑着,老找些软件在那里穷举扫描,所以大家第一要记的设置一个好的够复杂的密码.<br>怎么样防,如果要一条一条将这些IP阻止显然治标不治本,还好有DenyHosts软件来代替我们手搞定他.<br>DenyHosts是Python语言写的一个程序,它会分析sshd的日志文件,当发现重复的攻击时就会记录IP到 <code>/etc/hosts.deny</code>文件,从而达到自动屏IP的功能.<br>DenyHosts官方网站为:<a href="http://denyhosts.sourceforge.net/">http://denyhosts.sourceforge.net</a></p>
<p>安装:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$wget</span> http:<span class="regexp">//</span>nchc.dl.sourceforge.net<span class="regexp">/....../</span>DenyHosts-<span class="number">2.6</span>-python2.<span class="number">4</span>.noarch.rpm</span><br><span class="line"><span class="variable">$rpm</span> -ivh DenyHosts-<span class="number">2.6</span>-python2.<span class="number">4</span>.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>给denyhosts做成系统本身的服务:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ cd <span class="regexp">/etc/i</span>nit.d</span><br><span class="line">$ ln -s <span class="regexp">/usr/</span>share<span class="regexp">/denyhosts/</span>daemon-control denyhosts</span><br><span class="line">$ chkconfig --add denyhosts</span><br></pre></td></tr></table></figure>

<p>配置:<br>默认是安装到 <code>/usr/share/denyhosts</code>目录的.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> /usr/share/denyhosts/</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cp</span> denyhosts.cfg<span class="literal">-dist</span> denyhosts.cfg</span><br><span class="line"><span class="variable">$</span> vi denyhosts.cfg</span><br></pre></td></tr></table></figure>

<p>根据自己需要进行相应的配置(解释见下文件的配置文件).<br>DenyHosts配置文件:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">SECURE_LOG</span> = /var/log/secure</span><br><span class="line"><span class="comment">#ssh 日志文件,它是根据这个文件来判断的.</span></span><br><span class="line"><span class="attr">HOSTS_DENY</span> = /etc/hosts.deny</span><br><span class="line"><span class="comment">#控制用户登陆的文件</span></span><br><span class="line"><span class="attr">PURGE_DENY</span> = <span class="number">5</span>m</span><br><span class="line"><span class="comment">#过多久后清除已经禁止的</span></span><br><span class="line"><span class="attr">BLOCK_SERVICE</span> = sshd</span><br><span class="line"><span class="comment">#禁止的服务名</span></span><br><span class="line"><span class="attr">DENY_THRESHOLD_INVALID</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">#允许无效用户失败的次数</span></span><br><span class="line"><span class="attr">DENY_THRESHOLD_VALID</span> = <span class="number">3</span></span><br><span class="line"><span class="comment">#允许普通用户登陆失败的次数</span></span><br><span class="line"><span class="attr">DENY_THRESHOLD_ROOT</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">#允许root登陆失败的次数</span></span><br><span class="line"><span class="attr">HOSTNAME_LOOKUP</span>=<span class="literal">NO</span></span><br><span class="line"><span class="comment">#是否做域名反解</span></span><br><span class="line"><span class="attr">ADMIN_EMAIL</span> = iakuf@<span class="number">163</span>.com</span><br><span class="line"><span class="comment">#管理员邮件地址,它会给管理员发邮件</span></span><br><span class="line"><span class="attr">DAEMON_LOG</span> = /var/log/denyhosts</span><br><span class="line"><span class="comment">#自己的日志文件</span></span><br></pre></td></tr></table></figure>

<p>启动服务:<br>让他和系统启动时一起启动:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/etc/i</span>ni.d/denyhosts start</span><br><span class="line"><span class="variable">$chkconfig</span> denyhosts on</span><br></pre></td></tr></table></figure>

<p>可以用一台电脑远程连接过来测试.如果可以看到/etc/hosts.deny内是否有禁止的ip,有的话说明已经安装成功了.<br>注.我发现时间deny以后,删除ip的时间不是很准.解决的方法是改变DAEMON_PURGE = 这个的时间.我发现系统删除时间是以他为准.<br>DAEMON_PURGE:预设清除:当DenyHosts在预设模式下执行,执行清除机械作用过期最久的HOSTS_DENY,这个会影响PURGE_DENY的间隔.</p>
]]></content>
  </entry>
  <entry>
    <title>使用Swatch做Linux日志分析</title>
    <url>/2017/04/09/1582/</url>
    <content><![CDATA[<p>日志文件是我们发现系统问题的重要参考信息. 大部分的系统服务出现问题时<br>都会给syslogd(系统日志守护进程)发送消息. 然后用户发觉并根据错误提示<br>信息采取行动. 然而对于1000行以上的日志文件, 我们必须使用日志检查工具<br>节省时间和避免漏掉重要信息.</p>
<p>Swatch从字面上可以简单理解为Watcher(守护者). 其它的日志分析软件定期地<br>扫描日志文件, 向你报告系统已经发生的问题或者状况. Swatch程序不仅能够<br>做这些, 而且它能够像Syslogd守护程序那样主动的扫描日志文件并对特定的<br>日志消息采取修复行动.</p>
<p>一.准备</p>
<p>1.下载和解压缩最新的Swatch软件包.<br>建议从Swatch的官方网站获得可靠的Swatch软件包.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>sourceforge.net<span class="regexp">/projects/</span>swatch/</span><br></pre></td></tr></table></figure>

<ol>
<li><p>创建Swatch软件包存放的目录.</p>
<p>mkdir -p /usr/local/src/log</p>
</li>
<li><p>解压缩源代码包, 在log目录下会生成一个新的目录apache_1.3.33</p>
<p>tar zpxf swatch-3.1.1.tar.gz</p>
</li>
</ol>
<p>二.安装</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> swatch-<span class="number">3.1</span>.<span class="number">1</span></span><br><span class="line"><span class="keyword">make</span></span><br><span class="line"><span class="keyword">make</span> test</span><br><span class="line"><span class="keyword">make</span> install</span><br><span class="line"><span class="keyword">make</span> realclean</span><br></pre></td></tr></table></figure>

<p>Swatch程序安装成功后, Perl模块将会用于Swatch程序的运行.</p>
<p>三.配置</p>
<p>Swatch程序使用正向表达式(Regular Expressions)来发现感兴趣的目标行. 一旦<br>Swatch发现某一行匹配预设定的模式, 它会立即采取行动, 比如说屏幕打印, 发送<br>电子邮件, 或者采取用户预先设定的行动.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">watchfor <span class="regexp">/[dD]enied│/</span>DEN.*ED/</span><br><span class="line">echo bold</span><br><span class="line">bell <span class="number">3</span></span><br><span class="line">mail</span><br><span class="line">exec <span class="string">&quot;/etc/call_pager 5551234 08&quot;</span></span><br></pre></td></tr></table></figure>

<p>上面的脚本是Swatch配置文件一个部分的例子. 首先Swatch在指定的日志文件中<br>寻找包含设定单词”denied, Denied, 或者其它以DEN开始或者以ED结束的单词的<br>行. 一旦搜索到某行包含三个搜索单词中的任何一个. Swatch程序立即向终端<br>显示粗体行和响铃三下, 然后发送电子邮件给运行swatch程序的用户(通常是<br>root用户)警报所在行和执行 <code>/etc/call_paper</code>程序, 忽略sendmail, fax,<br>unimportant stuff. 在这个例子当中, 搜索字符串sendmail, fax和unimportant<br>stuff将被忽略. 甚至他们符合预定搜索字符串中的一个.</p>
<p>四.使用</p>
<p>使用Swatch非常的简单, 如通常使用Swatch检查日志, 运行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">swatch --config-<span class="keyword">file</span>=<span class="regexp">/home/</span>zhaoke/swatch.conf</span><br><span class="line">--examine=<span class="regexp">/var/</span>log/messages</span><br></pre></td></tr></table></figure>

<p>上面的例子中配置文件所在的系统绝对路径是 <code>/home/zhaoke/swatch.conf</code>, 需要<br>检查的日志文件是/var/log/messages.</p>
<p>使用swatch检查不段增加的日志文件:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">swatch --config-<span class="keyword">file</span>=<span class="regexp">/home/</span>zhaoke/swatch.conf</span><br><span class="line">--tail-<span class="keyword">file</span>=<span class="regexp">/var/</span>log/messages</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>使用UnixBench 测试Linux VPS性能</title>
    <url>/2017/12/13/1583/</url>
    <content><![CDATA[<p>UnixBench是一款不错的Linux下的VPS性能测试软件,现在说一下具体用法.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">wget</span> http://www.kudouzi.com/download/unixbench<span class="literal">-4</span>.<span class="number">1.0</span><span class="literal">-wht</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> tar xzf unixbench<span class="literal">-4</span>.<span class="number">1.0</span><span class="literal">-wht</span>.tar.gz</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> unixbench<span class="literal">-4</span>.<span class="number">1.0</span><span class="literal">-wht</span><span class="literal">-2</span>/</span><br><span class="line"><span class="variable">$</span> make</span><br><span class="line"><span class="variable">$</span> ./Run</span><br></pre></td></tr></table></figure>

<p>一下是运行后显示的内容:</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">BYTE UNIX Benchmarks (Version <span class="number">4</span>.<span class="number">1</span>-wht.<span class="number">2</span>)</span><br><span class="line">System -- Linux noc.lnmp.org <span class="number">2.6.18-92</span>.<span class="number">1</span>.<span class="number">13</span>.el5.<span class="number">028</span>stab059.<span class="number">6</span> #<span class="number">1</span> SMP Fri Nov <span class="number">14 16:01:01</span> MSK <span class="number">2008</span> i686 i686 i386 GNU/Linux</span><br><span class="line">simfs                  <span class="number">5120000</span>   <span class="number">1581972</span>   <span class="number">3538028</span>  <span class="number">31</span>% /</span><br><span class="line"></span><br><span class="line">Start Benchmark Run: Wed Feb  <span class="number">4 05:11:25</span> PST <span class="number">2009</span></span><br><span class="line"><span class="number">05</span>:<span class="number">11</span>:<span class="number">25</span> up <span class="number">20</span> days, <span class="number">21</span>:<span class="number">26</span>,  <span class="number">1</span> user,  load average: <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></span><br><span class="line"></span><br><span class="line">End Benchmark Run: Wed Feb  <span class="number">4 05:21:40</span> PST <span class="number">2009</span></span><br><span class="line"><span class="number">05</span>:<span class="number">21</span>:<span class="number">40</span> up <span class="number">20</span> days, <span class="number">21</span>:<span class="number">37</span>,  <span class="number">1</span> user,  load average: <span class="number">15</span>.<span class="number">46</span>, <span class="number">6</span>.<span class="number">32</span>, <span class="number">2</span>.<span class="number">72</span></span><br><span class="line">INDEX VALUES</span><br><span class="line">TEST                                        BASELINE     RESULT      INDEX</span><br><span class="line"></span><br><span class="line">Dhrystone <span class="number">2</span> using register variables        <span class="number">376783.7</span> <span class="number">23797779.3</span>      <span class="number">631</span>.<span class="number">6</span></span><br><span class="line">Double-Precision Whetstone                      <span class="number">83</span>.<span class="number">1</span>     <span class="number">1407</span>.<span class="number">7</span>      <span class="number">169</span>.<span class="number">4</span></span><br><span class="line">Execl Throughput                               <span class="number">188</span>.<span class="number">3</span>    <span class="number">10095.2</span>      <span class="number">536</span>.<span class="number">1</span></span><br><span class="line">File Copy <span class="number">1024</span> bufsize <span class="number">2000</span> maxblocks         <span class="number">2672</span>.<span class="number">0</span>   <span class="number">204163.0</span>      <span class="number">764</span>.<span class="number">1</span></span><br><span class="line">File Copy <span class="number">256</span> bufsize <span class="number">500</span> maxblocks           <span class="number">1077</span>.<span class="number">0</span>    <span class="number">74664.0</span>      <span class="number">693</span>.<span class="number">3</span></span><br><span class="line">File Read <span class="number">4096</span> bufsize <span class="number">8000</span> maxblocks        <span class="number">15382.0</span>  <span class="number">1629641.0</span>     <span class="number">1059</span>.<span class="number">4</span></span><br><span class="line">Pipe Throughput                             <span class="number">111814.6</span>  <span class="number">3058960.1</span>      <span class="number">273</span>.<span class="number">6</span></span><br><span class="line">Pipe-based Context Switching                 <span class="number">15448.6</span>   <span class="number">887966.3</span>      <span class="number">574</span>.<span class="number">8</span></span><br><span class="line">Process Creation                               <span class="number">569</span>.<span class="number">3</span>    <span class="number">26803.0</span>      <span class="number">470</span>.<span class="number">8</span></span><br><span class="line">Shell Scripts (<span class="number">8</span> concurrent)                    <span class="number">44</span>.<span class="number">8</span>     <span class="number">2503</span>.<span class="number">6</span>      <span class="number">558</span>.<span class="number">8</span></span><br><span class="line">System Call Overhead                        <span class="number">114433.5</span>  <span class="number">2409758.4</span>      <span class="number">210</span>.<span class="number">6</span></span><br><span class="line">=========</span><br><span class="line">FINAL SCORE                                                     <span class="number">475</span>.<span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>```</p>
]]></content>
  </entry>
  <entry>
    <title>使用pssh工具实现批量管理</title>
    <url>/2013/05/12/1581/</url>
    <content><![CDATA[<p>1,本地服务器已做了公私钥 ssh-gen</p>
<p>2, 安装*python*</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">yum install <span class="strong">*python*</span></span><br></pre></td></tr></table></figure>

<p>如安装setuptools包 不成功:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> python-setuptools.noarch</span><br></pre></td></tr></table></figure>

<p>3, 下载最新版本</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://www.theether.org/pssh/pssh-<span class="number">1</span>.<span class="number">4</span>.<span class="number">3</span>.tar.gz</span><br><span class="line"><span class="attribute">tar</span> zxvf pssh-<span class="number">1</span>.<span class="number">4</span>.<span class="number">3</span>.tar.gz</span><br><span class="line"><span class="attribute">cd</span> pssh-<span class="number">1</span>.<span class="number">4</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">python</span> setup.py install</span><br></pre></td></tr></table></figure>

<p>4,在 other.txt 输入已经copy好 公钥的服务器名</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">$ cat other.txt</span><br><span class="line"><span class="number">192.168.2.241</span></span><br><span class="line"><span class="number">192.168.2.148:22</span> (端口不写默认为<span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<p>5,安装成功直接执行命令</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Parallel</span> ssh (pssh) 批量登陆操作某一命令或脚本</span><br><span class="line"><span class="keyword">Parallel</span> scp (pscp) 批量<span class="keyword">copy</span></span><br><span class="line"><span class="keyword">Parallel</span> rsync (prsync) 批量同步</span><br><span class="line"><span class="keyword">Parallel</span> nuke (pnuke) 批量killall 某一进程</span><br><span class="line"><span class="keyword">Parallel</span> slurp (pslurp) 批量远程<span class="keyword">copy</span>文件至当前服务器</span><br></pre></td></tr></table></figure>

<p>例:pscp:</p>
<p>将文件lighttpd-1.4.30.tar.gz 复制到远程各服务器的 <code>/usr/local</code>目录下.</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">pscp -h other<span class="selector-class">.txt</span> -l root /opt/lighttpd-<span class="number">1.4</span>.<span class="number">30</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> /usr/local/</span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">43</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">43</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>例:pssh:</p>
<p>在各服务器上执行 hostname查看 将结果输入到 success 目录下.</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line">pssh -h other.txt -l root -o success -e error hostname</span><br><span class="line"><span class="comment">[1]</span> 11:21:37 <span class="comment">[SUCCESS]</span> 192.168.2.241 22</span><br><span class="line"><span class="comment">[2]</span> 11:21:37 <span class="comment">[SUCCESS]</span> 192.168.2.148 22</span><br><span class="line"></span><br><span class="line">opt]# pssh -h other.txt -l root -i hostname</span><br><span class="line"><span class="comment">[1]</span> 11:39:27 <span class="comment">[SUCCESS]</span> 192.168.2.241 22</span><br><span class="line">testrhelclone.com</span><br><span class="line"><span class="comment">[2]</span> 11:39:27 <span class="comment">[SUCCESS]</span> 192.168.2.148 22</span><br><span class="line">testcobb.com</span><br><span class="line"></span><br><span class="line">pssh -h other.txt -l root -i sh /opt/aa.sh #直接执行远程脚本</span><br><span class="line"><span class="comment">[1]</span> 14:44:16 <span class="comment">[SUCCESS]</span> 192.168.2.241 22</span><br><span class="line">pssh this <span class="keyword">is</span> ok 241</span><br><span class="line">14:42:33</span><br><span class="line"><span class="comment">[2]</span> 14:44:16 <span class="comment">[SUCCESS]</span> 192.168.2.148 22</span><br><span class="line">pssh this <span class="keyword">is</span> ok 148</span><br><span class="line">14:42:33</span><br></pre></td></tr></table></figure>

<p>例:prsync:</p>
<p>将本地的other.txt 同步到远程的 <code>/opt/other1.txt</code>.</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">prsync -r -h other<span class="selector-class">.txt</span> -l root other<span class="selector-class">.txt</span> /opt/other1<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">55</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">55</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>将success压缩传输:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">prsync -r -az -h other<span class="selector-class">.txt</span> -v -l root success /opt/</span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">13</span>:<span class="number">40</span>:<span class="number">49</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">13</span>:<span class="number">40</span>:<span class="number">49</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>例:pslurp:</p>
<p>pslurp 与pscp方向相反!</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Usage: pslurp [OPTIONS] -h hosts.txt -<span class="keyword">o</span> outdir remote local</span><br><span class="line">-r --recursive recusively <span class="keyword">copy</span> directories (OPTIONAL)</span><br><span class="line">-L --localdir output directory <span class="keyword">for</span> remote <span class="keyword">file</span> copies</span><br><span class="line">-h --hosts hosts <span class="keyword">file</span> (each <span class="built_in">line</span> <span class="string">&quot;host[:port] [login]&quot;</span>)</span><br><span class="line">-<span class="keyword">l</span> --user username (OPTIONAL)</span><br><span class="line">-<span class="keyword">p</span> --par <span class="built_in">max</span> <span class="keyword">number</span> of parallel threads (OPTIONAL)</span><br><span class="line">-<span class="keyword">o</span> --outdir output directory <span class="keyword">for</span> stdout <span class="keyword">files</span> (OPTIONAL)</span><br><span class="line">-<span class="keyword">e</span> --errdir output directory <span class="keyword">for</span> stderr <span class="keyword">files</span> (OPTIONAL)</span><br><span class="line">-t --timeout timeout (secs) (-<span class="number">1</span> = <span class="keyword">no</span> timeout) per host (OPTIONAL)</span><br><span class="line">-v --<span class="keyword">verbose</span> turn <span class="keyword">on</span> warning <span class="built_in">and</span> diagnostic <span class="keyword">messages</span> (OPTIONAL)</span><br><span class="line">-O --<span class="keyword">options</span> SSH <span class="keyword">options</span> (OPTIONAL)</span><br><span class="line">Example: pslurp -h hosts.txt -L /tmp/outdir -<span class="keyword">l</span> irb2 </span><br><span class="line">/home/irb2/foo.txt foo.txt</span><br></pre></td></tr></table></figure>

<p>将远程服务器的各个/opt/success 目录递归 拷贝到本地的 <code>/opt/test/</code> 目录下:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">pslurp -r -h other.txt -L /opt/test/ /opt/success remote</span><br><span class="line"><span class="string">[1]</span> <span class="number">14</span>:<span class="number">19</span>:<span class="number">45</span> <span class="string">[SUCCESS]</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">241</span> <span class="number">22</span></span><br><span class="line"><span class="string">[2]</span> <span class="number">14</span>:<span class="number">19</span>:<span class="number">45</span> <span class="string">[SUCCESS]</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">148</span> <span class="number">22</span></span><br><span class="line"><span class="string">[root@testrhel opt]</span># cd test/</span><br><span class="line"><span class="string">[root@testrhel test]</span># ls</span><br><span class="line"><span class="number">192.168.2.148</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">241</span></span><br><span class="line"><span class="string">[root@testrhel test]</span># tree *</span><br><span class="line"><span class="number">192.168.2.148</span></span><br><span class="line">`-- remote</span><br><span class="line">|-- <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">148</span></span><br><span class="line">|-- <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">241</span></span><br><span class="line">|-- aa.txt</span><br><span class="line">`-- daf.d</span><br><span class="line"><span class="number">192.168.2.241</span></span><br><span class="line">`-- remote</span><br><span class="line">|-- <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">148</span></span><br><span class="line">|-- <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">241</span></span><br><span class="line">|-- aa.txt</span><br><span class="line">`-- inotify.sh</span><br></pre></td></tr></table></figure>

<p>例:pnuke:</p>
<p>将远程服务器中的所有以root启动的sendmail 服务关闭 (只要ps aux到 sendmail 就强行关闭 如同 killall命令).</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">pnuke -h /opt/other<span class="selector-class">.txt</span> -l root sendmail</span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">14</span>:<span class="number">29</span>:<span class="number">58</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">14</span>:<span class="number">29</span>:<span class="number">58</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>其它:</p>
<p>1,如果过程中需要交互,如询问yes/no的时候,可以使用以下方式来解决.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">pssh -i -h <span class="regexp">/opt/</span>other.txt <span class="string">&quot;echo y | sudo yum remove xxxx&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样的话,yum询问是否安全的时候,就可以自动确认了.</p>
<p>2,添加环境变量,让命令更简洁</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">export PSSH_HOSTS=<span class="string">&quot;/opt/other.txt&quot;</span></span><br><span class="line">pssh -<span class="selector-tag">i</span> hostname</span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">15</span>:<span class="number">04</span>:<span class="number">06</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br><span class="line">testcobb<span class="selector-class">.com</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">15</span>:<span class="number">04</span>:<span class="number">06</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br><span class="line"></span><br><span class="line">pssh -h ip1<span class="selector-class">.txt</span> -<span class="selector-tag">i</span> hostname 也可另指目录文件</span><br><span class="line"><span class="selector-attr">[1]</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">35</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.148</span> <span class="number">22</span></span><br><span class="line">testcobb<span class="selector-class">.com</span></span><br><span class="line"><span class="selector-attr">[2]</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">35</span> <span class="selector-attr">[SUCCESS]</span> <span class="number">192.168</span>.<span class="number">2.241</span> <span class="number">22</span></span><br><span class="line">testrhelclone.com</span><br></pre></td></tr></table></figure>

<p>官网给出的一些环境变量名,可相应添加!</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">export</span> PSSH_HOSTS=<span class="string">&quot;/x/bnc/ips.txt&quot;</span></span><br><span class="line"># <span class="keyword">export</span> PSSH_USER=<span class="string">&quot;irb2&quot;</span></span><br><span class="line"># <span class="keyword">export</span> PSSH_PAR=<span class="string">&quot;32&quot;</span></span><br><span class="line"># <span class="keyword">export</span> PSSH_OUTDIR=<span class="string">&quot;/tmp/bar&quot;</span></span><br><span class="line"># <span class="keyword">export</span> PSSH_VERBOSE=<span class="string">&quot;0&quot;</span></span><br><span class="line"># <span class="keyword">export</span> PSSH_OPTIONS=<span class="string">&quot;UserKnownHostsFile /tmp/known_hosts&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>使用脚本一键安装zabbix和grafana</title>
    <url>/2020/07/09/1584/</url>
    <content><![CDATA[<p>此脚本为zabbix4.4和grafana6.7.4的一键部署脚本，脚本运行完成即可通过web页面进行管理配置，只适用于RHEL7.X版本，可用于最小化安装的版本，脚本中使用了case语句做了菜单，可自行选择安装zabbix或grafana，脚本中yum源使用的是清华源，可自行更改为阿里源或者其它yum源，脚本中已将zabbix和grafana所需要的端口放通，未关闭防火墙的情况下也可以正常访问。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#此脚本用于RHCL7安装Zabbix4.4和Grafana6.7.4</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF</span><br><span class="line">********请选择需要安装的组件：********</span><br><span class="line">(<span class="number">1</span>) Install Zabbix <span class="number">4.4</span></span><br><span class="line">(<span class="number">2</span>) Install Grafana <span class="number">6.7</span>.<span class="number">4</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">read -p <span class="string">&quot;请选择需要安装的组件：&quot;</span> digit</span><br><span class="line"></span><br><span class="line">case <span class="variable">$digit</span> <span class="keyword">in</span></span><br><span class="line">	<span class="string">&quot;1&quot;</span> )</span><br><span class="line">		echo <span class="string">&quot;Install Zabbix 4.4&quot;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">#关闭SELinux</span></span><br><span class="line">		<span class="keyword">if</span> [ $(getenforce) = <span class="string">&quot;Enforcing&quot;</span> ]; then</span><br><span class="line">		setenforce <span class="number">0</span></span><br><span class="line">		sed -i <span class="string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line">		echo <span class="string">&quot;Selinux已关闭!&quot;</span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		<span class="comment">#安装zabbix的repo源</span></span><br><span class="line">		<span class="keyword">if</span> [ $(curl -sL -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> <span class="string">&quot;https://mirror.tuna.tsinghua.edu.cn/&quot;</span> -o <span class="regexp">/dev/</span>null) -eq <span class="number">200</span> ];then</span><br><span class="line">			echo <span class="string">&quot;地址通畅，继续安装！！！&quot;</span></span><br><span class="line">			rpm -ivh https:<span class="regexp">//mi</span>rror.tuna.tsinghua.edu.cn<span class="regexp">/zabbix/</span>zabbix<span class="regexp">/4.4/</span>rhel<span class="regexp">/7/</span>x86_64/zabbix-release-<span class="number">4.4</span>-<span class="number">1</span>.el7.noarch.rpm</span><br><span class="line">			sed -i -e <span class="string">&#x27;s/repo.zabbix.com/mirror.tuna.tsinghua.edu.cn\/zabbix/g&#x27;</span> <span class="regexp">/etc/yum</span>.repos.d/zabbix.repo</span><br><span class="line">			yum clean all</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			echo <span class="string">&quot;地址不通畅，请检查网络！！！&quot;</span></span><br><span class="line">			<span class="keyword">exit</span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		<span class="comment">#安装zabbix和mariadb</span></span><br><span class="line">		yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent mariadb mariadb-server</span><br><span class="line">		systemctl start mariadb.service</span><br><span class="line">		systemctl enable mariadb.service</span><br><span class="line">		mysql -e <span class="string">&quot;create database zabbix character set utf8 collate utf8_bin;&quot;</span></span><br><span class="line">		mysql -e <span class="string">&quot;grant all privileges on zabbix.* to zabbix@localhost identified by &#x27;zabbix&#x27;;&quot;</span></span><br><span class="line">		mysql -e <span class="string">&quot;flush privileges;&quot;</span></span><br><span class="line">		zcat <span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pzabbix zabbix</span><br><span class="line"></span><br><span class="line">		<span class="comment">#修改zabbix-server配置文件</span></span><br><span class="line">		cp <span class="regexp">/etc/</span>zabbix<span class="regexp">/zabbix_server.conf /</span>etc<span class="regexp">/zabbix/</span>zabbix_server.conf.bak</span><br><span class="line">		sed -i <span class="string">&#x27;s/# DBHost=localhost/DBHost=localhost/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# DBPassword=/DBPassword=zabbix/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# StartPollers=5/StartPollers=40/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# StartPreprocessors=3/StartPreprocessors=20/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# StartPollersUnreachable=1/StartPollersUnreachable=10/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# StartPingers=1/StartPingers=15/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# StartDiscoverers=1/StartDiscoverers=5/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# HousekeepingFrequency=1/HousekeepingFrequency=24/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# MaxHousekeeperDelete=5000/MaxHousekeeperDelete=10000/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# CacheSize=8M/CacheSize=4G/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# ValueCacheSize=8M/ValueCacheSize=2G/&#x27;</span> <span class="regexp">/etc/</span>zabbix/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">		<span class="comment">#修改zabbix-web配置文件</span></span><br><span class="line">		cp <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>zabbix.conf <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>zabbix.conf.bak</span><br><span class="line">		sed -i <span class="string">&#x27;s/memory_limit 128M/memory_limit 512M/&#x27;</span> <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>zabbix.conf</span><br><span class="line">		sed -i <span class="string">&#x27;s/# php_value date.timezone Europe\/Riga/php_value date.timezone Asia\/Shanghai/&#x27;</span> <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>zabbix.conf</span><br><span class="line">		systemctl restart zabbix-server zabbix-agent httpd</span><br><span class="line">		systemctl enable zabbix-server zabbix-agent httpd</span><br><span class="line"></span><br><span class="line">		<span class="comment">#开放端口</span></span><br><span class="line">		firewall-cmd --zone=public --add-port=<span class="number">10050</span>/tcp --permanent</span><br><span class="line">		firewall-cmd --zone=public --add-port=<span class="number">10051</span>/tcp --permanent</span><br><span class="line">		firewall-cmd --zone=public --add-port=<span class="number">80</span>/tcp --permanent</span><br><span class="line">		firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">		<span class="comment">#判断zabbix网页是否正常打开</span></span><br><span class="line">		<span class="keyword">if</span> [ $(curl -sL -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> <span class="string">&quot;http://127.0.0.1/zabbix&quot;</span> -o <span class="regexp">/dev/</span>null) -eq <span class="number">200</span> ]; then</span><br><span class="line">			echo <span class="string">&quot;Zabbix安装成功！！！&quot;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			echo <span class="string">&quot;Zabbix异常，请检查！！！&quot;</span></span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line">	<span class="string">&quot;2&quot;</span> )</span><br><span class="line">		echo <span class="string">&quot;Install Grafana 6.7.4&quot;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">#判断wget是否安装</span></span><br><span class="line">		command -v wget</span><br><span class="line">		<span class="keyword">if</span> [ $? -ne <span class="number">0</span> ]; then</span><br><span class="line">			yum -y install wget</span><br><span class="line">			echo <span class="string">&quot;wget安装成功！！！&quot;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			echo <span class="string">&quot;wget已存在！！！&quot;</span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		<span class="comment">#判断地址是否通畅，通畅则下载rpm包</span></span><br><span class="line">		<span class="keyword">if</span> [ $(curl -sL -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> <span class="string">&quot;https://mirror.tuna.tsinghua.edu.cn/&quot;</span> -o <span class="regexp">/dev/</span>null) -eq <span class="number">200</span> ];then</span><br><span class="line">			echo <span class="string">&quot;地址通畅，继续安装！！！&quot;</span></span><br><span class="line">			wget https:<span class="regexp">//mi</span>rror.tuna.tsinghua.edu.cn<span class="regexp">/grafana/yum</span><span class="regexp">/rpm/g</span>rafana-<span class="number">6.7</span>.<span class="number">4</span>-<span class="number">1</span>.x86_64.rpm</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			echo <span class="string">&quot;地址不通畅，请检查网络！！！&quot;</span></span><br><span class="line">			<span class="keyword">exit</span></span><br><span class="line">		fi</span><br><span class="line"></span><br><span class="line">		<span class="comment">#安装Grafana</span></span><br><span class="line">		yum -y install fontconfig freetype* urw-fonts</span><br><span class="line">		rpm -ivh <span class="regexp">/root/g</span>rafana-<span class="number">6.7</span>.<span class="number">4</span>-<span class="number">1</span>.x86_64.rpm</span><br><span class="line">		grafana-cli plugins install alexanderzobnin-zabbix-app</span><br><span class="line">		systemctl enable grafana-server</span><br><span class="line">		systemctl start grafana-server</span><br><span class="line"></span><br><span class="line">		<span class="comment">#开放端口</span></span><br><span class="line">		firewall-cmd --zone=public --add-port=<span class="number">3000</span>/tcp --permanent</span><br><span class="line">		firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">		<span class="comment">#判断grafana网页是否正常打开</span></span><br><span class="line">		<span class="keyword">if</span> [ $(curl -sL -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> <span class="string">&quot;http://127.0.0.1:3000&quot;</span> -o <span class="regexp">/dev/</span>null) -eq <span class="number">200</span> ]; then</span><br><span class="line">			echo <span class="string">&quot;Grafana安装成功！！！&quot;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			echo <span class="string">&quot;Grafana异常，请检查！！！&quot;</span></span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line">	<span class="string">&quot;*&quot;</span> )</span><br><span class="line">		echo <span class="string">&quot;Error&quot;</span></span><br><span class="line">		;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>事务日志传送</title>
    <url>/2014/03/28/1585/</url>
    <content><![CDATA[<p>SQL Server的事务日志传送备份是仅次于镜像的高可靠性备份方案,可以达到分钟级的灾难恢复能力.其项目实施成本,又远小于镜像的投入,因此是一种非常实用的备份解决方案.前文介绍过SQLServer 镜像功能完全实现,<br>镜像是一种高性能的备份方案,但其局限性在于镜像的辅助服务器也就是镜像服务器只能 有一个,当我们考虑过个目标服务器的时候,镜像就满足不了我们的需求了,这时候日志传送可谓雪中送炭,日志传送也可以结合镜像来组合使用.<br>在选择镜像还是日志传送的时候我们应考虑:</p>
<p>需要多少个目标服务器?<br>如果只需要一个目标数据库,建议使用数据库镜像解决方案.<br>如果需要多个目标数据库,则需要使用日志传送(可以单独使用,也可以与数据库镜像一起使用).如果将这两种方法组合使用,就既能享有数据库镜像的好处,又能获得日志传送提供的多个目标数据库的支持.<br>如果需要延迟还原目标数据库的日志(通常是为了防止逻辑错误),请使用日志传送(可以单独使用,也可以与数据库镜像一起使用).<br>日志传送还可以和数据库复制一起使用.<br>故在事务日志传送中提供了No recovery mode和Standby mode,两者的介绍如下:</p>
<p>1.无恢复模式(No recovery mode):既不前滚也不回滚未提交的事务,数据不可读.<br>2.备用模式(Standby mode):在恢复日志期间回滚所有未提交的事务,并且将所有未提交的事务保存为一个单独的Transaction Undo File(TUF)文件,恢复过程通过该文件来维护事务的完整性,当恢复下一个事物的时候则恢复所有已提交的事务.Standby mode中的复选框勾选则当日志恢复的时候,断开所有用户的连接,如果有一个用户没有断开,则还原无法进行.</p>
<p>事务日志传送实现:</p>
<p>其实操作比较简单,但是会遇到稀奇古怪的问题.在这里也把问题总结下.<br>首先需要两个用来做日志传送的数据库.叫做主数据库和辅助数据库.当然还可以配置监视数据库.<br>主数据库IP: 192.168.0.2<br>辅助数据库IP:192.168.0.3</p>
<p>下面通过简单的几步就可以实现:</p>
<p>1,建立共享文件夹以及复制文件夹</p>
<p>建立好需要传送日志的数据库,并在辅助服务器上建一个共享文件夹叫做PrimaryData,用来传送备份文件.<br>设置好权限.保证主服务器可以访问,或者直接设置EveryOne都可访问.<br>这里设置不当会出现以下错误</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">无法打开备份设备 &#x27;<span class="symbol">\\</span>192.168.0.3<span class="symbol">\P</span>rimaryData<span class="symbol">\t</span>est.bak&#x27;.出现操作系统错误 53(找不到网络路径.).</span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<p>设置共享文件:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">exec</span></span> master..xp_cmdshell <span class="string">&#x27;net use \\192.168.0.3\PrimaryData 密码 /user:用户名&#x27;</span></span><br></pre></td></tr></table></figure>

<p>至于句话的意思大家可以去查下咯.执行成功后就可以将数据库备份到网络路径上了.</p>
<p>报错为:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span>系统发生<span class="number">1312</span>错误</span><br><span class="line"><span class="symbol">3 </span>指定的登陆会话不存在.可能已被终止</span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">exec</span></span> master..xp_cmdshell <span class="string">&#x27;net use \\192.168.0.3\PrimaryData 密码 /user:192.168.10.3\administrator&#x27;</span></span><br></pre></td></tr></table></figure>

<p>2,执行完全备份</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">USEmaster;ALTERDATABASEtestSETRECOVERYFULL;GOBACKUPDATABASEtest  <span class="attribute">TODISK</span>=<span class="string">&#x27;\\192.168.0.3\PrimaryData\test.bak&#x27;</span>WITHFORMAT;GO</span><br></pre></td></tr></table></figure>

<p>如果上面一句话执行成功的话,这个应该没问题.之后的步骤就简单了.</p>
<p>3,开始执行日志传送</p>
<p>访问\192.168.0.3\PrimaryData\ 可以看到刚才备份的文件.<br>然后在数据库上右键-属性-事务日志传送<br>设置备份文件夹,这里我都备份到了辅助服务器上.<br>确定之后点击添加服务器,设置要连接的数据库.<br>设置复制文件的位置,这里最好在辅助服务器上.可以很快访问到,省去了网络带来的延迟.<br>这里的两种模式上文都有介绍,大家可以根据需要来选择.<br>到此,主服务器上的配置就完成了.</p>
<p>4,辅助服务器上查看记录</p>
<p>如果以上步骤没问题的话,我们可以在辅助服务器上的PrimaryData 目录下看到trn后缀的文件.<br>可以在代理下 查看作业执行的历史记录.<br>如果你选择的是备用模式.我通过查看历史记录遇到了一个问题是<br>“因为数据库正在使用,所以无法获得对数据库的独占访问权”<br>网上有介绍说用sql语句来杀掉进程,不过这种方式不是长久之计.可以通过配置数据库的属性,在数据库属性的[选项]选项卡中,设置[限制访问]参数为”Single”即可.<br>使用无恢复模式不会出现这样的问题.</p>
<p>5,故障恢复</p>
<p>将主服务器上的日志传送停止,然后将最后的备份文件复制到辅助服务器上执行以下语句:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">RESTORE <span class="keyword">LOG</span> &lt;Database_Name&gt;</span><br><span class="line"><span class="keyword">FROM</span> DISK =<span class="string">&#x27;d:\PrimaryData\Database_name.trn&#x27;</span> <span class="keyword">WITH</span> RECOVERY</span><br></pre></td></tr></table></figure>

<p>如果无法访问活动事务日志,那么可以使用下面的命令来恢复数据库.</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">RESTORE <span class="keyword">DATABASE</span> &lt;Database_Name&gt; <span class="keyword">WITH</span> RECOVERY;</span><br></pre></td></tr></table></figure>

<p>下篇详细讲故障恢复.<br>如果主服务器数据库一直处于正在还原的状态.<br>可以使用:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">RESTORE <span class="keyword">database</span>   dbname <span class="keyword">with</span> recovery</span><br></pre></td></tr></table></figure>

<p>命令强制结束.</p>
]]></content>
  </entry>
  <entry>
    <title>提示“输入密码以解锁您的登录密钥环”的解决方案</title>
    <url>/2021/02/07/1586/</url>
    <content><![CDATA[<p>打开终端：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -rf ~<span class="regexp">/.local/</span>share<span class="regexp">/keyrings/</span>*</span><br></pre></td></tr></table></figure>
<p>注销或重启即可。</p>
]]></content>
  </entry>
  <entry>
    <title>提示“输入密码以解锁您的登录密钥环”的解决方案</title>
    <url>/2021/02/07/1587/</url>
    <content><![CDATA[<p>打开终端：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -rf ~<span class="regexp">/.local/</span>share<span class="regexp">/keyrings/</span>*</span><br></pre></td></tr></table></figure>
<p>注销或重启即可。</p>
]]></content>
  </entry>
  <entry>
    <title>通过Git钩子实现网站的自动发布</title>
    <url>/2019/08/13/1589/</url>
    <content><![CDATA[<p>如果需要Git服务器的安装配置可以在本站搜索,之前的文章有写过.</p>
<p>Git 钩子安装:</p>
<p>Git 钩子存在于每个 Git 仓库的 <code>./hooks</code>目录中. 当你用 git init 初始化一个新版本库时,Git 默认会在这个目录中放置一些示例脚本.所有的示例都是 shell 脚本,其中一些还混杂了 Perl 代码,不过,任何正确命名的可执行脚本都可以正常使用,你可以用 Ruby 或 Python,或其它语言编写它们.</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">hooks git:(master) <span class="keyword">ls</span></span><br><span class="line">applypatch-msg.<span class="keyword">sample</span>     pre-applypatch.<span class="keyword">sample</span>     pre-rebase.<span class="keyword">sample</span></span><br><span class="line">commit-msg.<span class="keyword">sample</span>         pre-commit.<span class="keyword">sample</span>         prepare-commit-msg.<span class="keyword">sample</span></span><br><span class="line"><span class="keyword">post</span>-<span class="keyword">update</span>.<span class="keyword">sample</span>        pre-push.<span class="keyword">sample</span>           <span class="keyword">update</span>.<span class="keyword">sample</span></span><br></pre></td></tr></table></figure>

<p>.sample拓展名是为了防止它们默认被执行,安装一个钩子只需要去掉.sample拓展名即可.</p>
<p>Git 钩子的作用域:</p>
<p>Git 钩子是对本地仓库相关操作影响,对于任何 Git 仓库来说钩子都是本地的,初始的钩子都是从 Git 默认模板目录中自动安装.</p>
<p>Git 钩子进行自动部署:</p>
<p>如何实现 Git 钩子进行自动部署,其实原理很简单,我们只需要监听每次本地 git push到远程服务器,然后远程服务器同步拉取最新文件.</p>
<p>1.在服务器初始化一个远程 Git 裸仓库 (git init –bare)</p>
<p>裸仓库与 git init 初使化的仓库不太一样,裸仓库其实相当于通过克隆来的仓库里的.git文件夹,整个裸仓库中只有git索引(index),不包含工作目录.要实现 Push to Deploy,首先我们需要一个裸仓库,进入 <code>/data/gitroot/</code>,创建如下:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">git init <span class="comment">--bare project.git</span></span><br></pre></td></tr></table></figure>

<p>或:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">mkdir <span class="keyword">project</span>.git</span><br><span class="line">cd <span class="keyword">project</span>.git</span><br><span class="line">git init --bare</span><br></pre></td></tr></table></figure>

<p>2.配置 Git Hook:</p>
<p>将目录切换至 <code>/data/gitroot/project.git/hooks</code>,用:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">cp <span class="keyword">post</span>-<span class="keyword">update</span>.<span class="keyword">sample</span> <span class="keyword">post</span>-<span class="keyword">update</span></span><br></pre></td></tr></table></figure>

<p>复制并重命名文件后 vim post-update 修改,增加执行脚本:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">unset</span> GIT_DIR</span><br><span class="line"><span class="built_in">cd</span> /home/wwwroot/project/</span><br><span class="line">git pull origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意: 一定要unset GIT_DIR清除变量, 不然会引起remote: fatal: Not a git repository: &#x27;.&#x27;错误.</span></span><br></pre></td></tr></table></figure>

<p>post-update添加执行权限:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">chmod 777 <span class="keyword">post</span>-<span class="keyword">update</span></span><br><span class="line">chown git:git <span class="keyword">post</span>-<span class="keyword">update</span></span><br><span class="line">#添加git用户在该脚本的执行权限</span><br></pre></td></tr></table></figure>

<p>3.本地仓库添加 remote 源</p>
<p>本地仓库添加远程仓库源之后,一旦本地仓库变更提交就会触发 Git 钩子,驱动自动部署</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote <span class="keyword">add</span> origin git<span class="subst">@192</span><span class="number">.168</span><span class="number">.2</span><span class="number">.17</span>:<span class="number">22</span>/data/gitroot/project.git</span><br><span class="line"><span class="meta">#添加远程仓库源</span></span><br><span class="line">git <span class="keyword">push</span> origin master</span><br></pre></td></tr></table></figure>

<p>如果Git协议是ssh则用:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin ssh:<span class="regexp">//gi</span>t@<span class="number">192.168</span>.<span class="number">2.17</span>:<span class="number">22</span><span class="regexp">/data/gi</span>troot/project.git</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<p>踩过的坑:</p>
<p>1.<code>/data/gitroot/project.git/hooks/post-update</code>这个脚本一定要git用户可以执行.<br>2.网站目录一定是git用户可读写的,包括隐藏目录,不要用root用户执行pull之类的操作,文件所有者会变成root.<br>3.如果钩子脚本没有执行,尝试切换到git用户直接执行 <code>/data/gitroot/project.git/hooks/post-update</code>脚本,会看到错误.<br>4.如果网站内容里有和Git仓库冲突的文件,可使用以下脚本代替:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">unset</span> GIT_DIR</span><br><span class="line"><span class="built_in">cd</span> /home/wwwroot/project/</span><br><span class="line">git fetch --all</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure>

<p>该脚本会强行覆盖掉本地文件,不提示冲突.<br>5.不要在服务器修改Git库里有的文件也不要ftp之类上传,如果必须这样操作,记得更新到Git库,否则会提示冲突,用第二个脚本会被直接覆盖掉.<br>6.如果用脚本执行更新操作,git用户在该服务器必须配置免密登陆,也就是使用证书登陆,git pull的时候不能提示输入密码.(9成教程都没有这个,导致钩子脚本不执行.)<br>7.网站目录如果改为git用户的权限了,web程序比如nginx,apache的使用用户必须能读写,否则网页无法访问.</p>
]]></content>
  </entry>
  <entry>
    <title>添加不允许登录系统的用户</title>
    <url>/2015/11/28/1588/</url>
    <content><![CDATA[<p>有些时候我们希望建立一个用户,让他只能登录ftp而不能登录系统,其实这个是很好办到的,</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">useradd username -s <span class="regexp">/sbin/</span>nologin</span><br></pre></td></tr></table></figure>

<p>就可以建立一个不能登录系统的用了,<br>通过</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">passwd username</span></span><br></pre></td></tr></table></figure>

<p>可以修改该用户的密码.<br>这样可以提高系统的安全性.</p>
]]></content>
  </entry>
  <entry>
    <title>通过heartbeat实现drbd的主从切换</title>
    <url>/2016/08/02/1591/</url>
    <content><![CDATA[<p>昨天写了一篇关于drbd的文章,今天是通过heartbeat实现drbd的主从切换,这样挂了一台服务器也不打紧了.<br>下面我们部署这一高可用.首先安装heartbeat,执行 <code>yum install heartbeat</code>即可.<br>我们的主机ip是192.168.79.130,备机ip:192.168.79.131,虚拟ip:192.168.79.135,drbd同步的分区 <code>/dev/sdb1</code>,挂载的目录 <code>/data</code>.</p>
<p>drbd配置:</p>
<p>1、首先对 <code>/dev/sdb</code>分区出 <code>/dev/sdb1</code>,建立目录 <code>/data</code>.</p>
<p>2、配置global和resource.</p>
<p>配置drbd.conf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc/drbd.conf</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">include <span class="string">&quot;drbd.d/global_common.conf&quot;</span><span class="comment">;</span></span><br><span class="line">include <span class="string">&quot;drbd.d/*.res&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>配置global_common.conf:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc<span class="regexp">/drbd.d/g</span>lobal_common.conf</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="class">global </span>&#123;</span><br><span class="line">    usage-count yes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class">common </span>&#123;</span><br><span class="line">    <span class="class">net </span>&#123;</span><br><span class="line">        protocol C;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置r0资源:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/drbd/</span>etc<span class="regexp">/drbd.d/</span>r0.res</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">resource r0 &#123;</span><br><span class="line">    on node1 &#123;</span><br><span class="line">        device <span class="regexp">/dev/</span>drbd1;</span><br><span class="line">        disk <span class="regexp">/dev/</span>sdb1;</span><br><span class="line">        address <span class="number">192.168</span>.<span class="number">79.130</span>:<span class="number">7789</span>;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">    on node2 &#123;</span><br><span class="line">        device <span class="regexp">/dev/</span>drbd1;</span><br><span class="line">        disk <span class="regexp">/dev/</span>sdb1;</span><br><span class="line">        address <span class="number">192.168</span>.<span class="number">79.131</span>:<span class="number">7789</span>;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、设置hostname</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/network</span><br></pre></td></tr></table></figure>

<p>修改HOSTNAME为node1.<br>编辑hosts:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>

<p>添加:</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.79.130</span> node1</span><br><span class="line"><span class="number">192.168.79.131</span> node2</span><br></pre></td></tr></table></figure>

<p>使node1 hostnmae临时生效:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hostname</span> node<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>node2设置类似.</p>
<p>4、设置resource</p>
<p>以下操作需要在node1和node2操作.</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">modprobe</span> <span class="string">drbd</span> //载入 <span class="string">drbd</span> 模块</span><br><span class="line"><span class="string">dd</span> <span class="string">if</span>=/<span class="string">dev</span>/<span class="string">zero</span> <span class="string">of</span>=/<span class="string">dev</span>/<span class="string">sdb1</span> <span class="string">bs</span>=<span class="string">1M</span> <span class="string">count</span>=<span class="string">100</span> /把一些资料塞到 <span class="string">sdb</span> 內 (否则 <span class="built_in">create-md</span> 时有可能会出现错误)</span><br><span class="line"><span class="string">drbdadm</span> <span class="built_in">create-md</span> <span class="string">r0</span> //建立 <span class="string">drbd</span> <span class="string">resource</span></span><br><span class="line"><span class="string">drbdadm</span> <span class="string">up</span> <span class="string">r0</span> //启动 <span class="string">resource</span> <span class="string">r0</span></span><br></pre></td></tr></table></figure>

<p>5、设置Primary Node</p>
<p>以下操作仅在node1执行.<br>设置node1为primary node:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">drbdadm <span class="keyword">primary</span> <span class="comment">--force r0</span></span><br></pre></td></tr></table></figure>

<p>6、创建DRBD文件系统</p>
<p>以下操作仅在node1执行.<br>上面已经完成了 <code>/dev/drbd1</code>的初始化,现在来把 <code>/dev/drbd1</code>格式化成ext3格式的文件系统.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mkfs</span>.ext<span class="number">3</span> /dev/drbd<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>然后将 <code>/dev/drbd1</code>挂载到之前创建的/data目录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>drbd1 /data</span><br></pre></td></tr></table></figure>

<p>heartbeat配置:</p>
<p>ha.cf 监控配置文件<br>haresources 资源管理文件<br>authkeys 心跳线连接加密文件</p>
<p>1、同步两台节点的时间</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -rf <span class="regexp">/etc/</span>localtime</span><br><span class="line">cp -f <span class="regexp">/usr/</span>share<span class="regexp">/zoneinfo/</span>Asia<span class="regexp">/Shanghai /</span>etc/localtime</span><br><span class="line">yum install -y ntp</span><br><span class="line">ntpdate -d cn.pool.ntp.org</span><br></pre></td></tr></table></figure>

<p>2、配置ha.cf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ha.d/ha.cf</span><br><span class="line"></span><br><span class="line">debugfile <span class="regexp">/var/</span>log/ha-debug <span class="comment">#打开错误日志报告</span></span><br><span class="line">keepalive <span class="number">2</span> <span class="comment">#两秒检测一次心跳线连接</span></span><br><span class="line">deadtime <span class="number">10</span> <span class="comment">#10 秒测试不到主服务器心跳线为有问题出现</span></span><br><span class="line">warntime <span class="number">6</span> <span class="comment">#警告时间(最好在 2 ～ 10 之间)</span></span><br><span class="line">initdead <span class="number">120</span> <span class="comment">#初始化启动时 120 秒无连接视为正常,或指定heartbeat</span></span><br><span class="line"><span class="comment">#在启动时,需要等待120秒才去启动任何资源.</span></span><br><span class="line"></span><br><span class="line">udpport <span class="number">694</span> <span class="comment">#用 udp 的 694 端口连接</span></span><br><span class="line">ucast eth0 <span class="number">192.168</span>.<span class="number">79.131</span> <span class="comment">#单播方式连接(主从都写对方的 ip 进行连接)</span></span><br><span class="line">node node1 <span class="comment">#声明主服(注意是主机名uname -n不是域名)</span></span><br><span class="line">node node2 <span class="comment">#声明备服(注意是主机名uname -n不是域名)</span></span><br><span class="line">auto_failback on <span class="comment">#自动切换(主服恢复后可自动切换回来)这个不要开启</span></span><br><span class="line">respawn hacluster <span class="regexp">/usr/</span>lib<span class="regexp">/heartbeat/i</span>pfail <span class="comment">#监控ipfail进程是否挂掉,如果挂掉就重启它</span></span><br></pre></td></tr></table></figure>

<p>3、配置authkeys</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ha.d/authkeys</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">auth</span> <span class="number">1</span></span><br><span class="line"><span class="attribute">1</span> crc</span><br></pre></td></tr></table></figure>

<p>4、配置haresources</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ha.d/haresources</span><br></pre></td></tr></table></figure>

<p>写入:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">node1</span> IPaddr::<span class="number">192.168.79.135</span>/<span class="number">24</span>/eth<span class="number">0</span> drbddisk::r<span class="number">0</span> Filesystem::/dev/drbd<span class="number">1</span>::/data::ext<span class="number">3</span></span><br><span class="line"><span class="attribute">node1</span>:master主机名</span><br><span class="line"><span class="attribute">IPaddr</span>::<span class="number">192.168.79.135</span>/<span class="number">24</span>/eth<span class="number">0</span>:设置虚拟IP</span><br><span class="line"><span class="attribute">drbddisk</span>::r<span class="number">0</span>:管理资源r<span class="number">0</span></span><br><span class="line"><span class="attribute">Filesystem</span>::/dev/drbd<span class="number">1</span>::/data::ext<span class="number">3</span>:执行mount与unmout操作</span><br></pre></td></tr></table></figure>

<p>node2配置基本相同,不同的是ha.cf中的192.168.79.131改为192.168.79.130.</p>
<p>DRBD主从自动切换测试:</p>
<p>首先先在node1启动heartbeat,接着在node2启动,这时,node1等node2完全启动后,相继执行设置虚拟IP,启动drbd并设置primary,并挂载 <code>/dev/drbd1到/data</code>目录,启动命令为:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">service heartbeat <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>这时,我们执行ip a命令,发现多了一个IP 192.168.79.135,这个就是虚拟IP.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/proc/</span>drbd</span><br></pre></td></tr></table></figure>

<p>查看drbd状态,显示primary/secondary状态,df -h显示/dev/drbd1已经挂载到/data目录.<br>然后我们来测试故障自动切换,停止node1的heartbeat服务或者断开网络连接,几秒后到node2查看状态.<br>接着恢复node1的heartbeat服务或者网络连接,查看其状态.</p>
<p>好了,这样我们就完成了今天的教程,如果大家有什么问题欢迎留言~</p>
]]></content>
  </entry>
  <entry>
    <title>通过Hadoop实现集群分布式计算</title>
    <url>/2017/08/17/1590/</url>
    <content><![CDATA[<p>hadoop是一个分布式系统基础架构,由Apache基金会开发.用户可以在不了解分布式底层细节的情况下,开发分布式程序.充分利用集群的威力高速运算和存储.<br>Hadoop实现了一个分布式文件系统(Hadoop Distributed File System),简称HDFS.<br>HDFS有着高容错性的特点,并且设计用来部署在低廉的(low-cost)硬件上.<br>而且它提供高传输率(high throughput)来访问应用程序的数据,<br>适合那些有着超大数据集(large data set)的应用程序.<br>HDFS放宽了(relax)POSIX的要求(requirements)这样可以流的形式访问(streaming access)文件系统中的数据.<br>好现在我们就在centos操作系统里面来实际操作一下:<br>以下集群配置内容,以两台机器为例.其中一台是 master ,另一台是 slave1 .</p>
<p>master 上运行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">name <span class="keyword">node</span><span class="title">, data</span> <span class="keyword">node</span><span class="title">, task</span> tracker, job tracker , secondary name <span class="keyword">node</span><span class="title"></span></span><br></pre></td></tr></table></figure>

<p>slave1 上运行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">data <span class="keyword">node</span><span class="title">, task</span> tracker</span><br></pre></td></tr></table></figure>

<p>前面加 表示对两台机器采取相同的操作.</p>
<p>1.安装 JDK</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install java-<span class="number">1</span>.<span class="number">6</span>.<span class="number">0</span>-openjdk-devel</span><br></pre></td></tr></table></figure>

<p>2.设置环境变量</p>
<p>编辑 <code>/etc/profile</code> 文件,设置 JAVA_HOME 环境变量以及类路径:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=<span class="string">&quot;/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$JAVA_HOME/bin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar</span><br></pre></td></tr></table></figure>

<p>3.添加 hosts 的映射</p>
<p>编辑 <code>/etc/hosts</code> 文件,注意 host name 不要有下划线,见下步骤 9.</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.225.16</span> master</span><br><span class="line"><span class="number">192.168.225.66</span> slave1</span><br></pre></td></tr></table></figure>

<p>4.配置 SSH</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/root</span> &amp; mkdir <span class="string">.ssh</span></span><br><span class="line">chmod 700 <span class="string">.ssh</span> &amp; <span class="keyword">cd</span> <span class="string">.ssh</span></span><br></pre></td></tr></table></figure>

<p>创建密码为空的 RSA 密钥对:</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">ssh-keygen -<span class="built_in">t</span> rsa -P <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>在提示的对称密钥名称中输入 id_rsa ,将公钥添加至 authorized_keys 中:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"><span class="keyword">chmod</span> <span class="number">644</span> authorized_keys <span class="comment"># 重要</span></span><br></pre></td></tr></table></figure>

<p>编辑 sshd 配置文件 <code>/etc/ssh/sshd_config</code> ,把:</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#AuthorizedKeysFile .ssh/authorized_keys</span></span><br></pre></td></tr></table></figure>

<p>前面的注释取消掉.<br>重启 sshd 服务:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service sshd restart</span></span><br></pre></td></tr></table></figure>

<p>测试 SSH 连接.连接时会提示是否连接,按回车后会将此公钥加入至 knows_hosts 中:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh localhost</span></span><br></pre></td></tr></table></figure>

<p>5.配置 master 和 slave1 的 ssh 互通</p>
<p>在 slave1 中重复步骤 4 ,然后把 slave1 中的 .ssh/authorized_keys 复制至 master 的 .ssh/authorized_keys 中.注意复制过去之后,要看最后的类似 root@localhost 的字符串,修改成 root@slave1 .同样将 master 的 key 也复制至 slave1 ,并将最后的串修改成 root@master .</p>
<p>或者使用如下命令:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">ssh-<span class="keyword">copy</span>-id -i ~<span class="regexp">/.ssh/i</span>d_rsa.pub root@slave1</span><br></pre></td></tr></table></figure>

<p>测试 SSH 连接:<br>在 master 上运行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh</span> slave<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>在 slave1 上运行:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">ssh <span class="literal">master</span></span><br></pre></td></tr></table></figure>

<p>6.安装 Hadoop</p>
<p>下载 hadoop 安装包:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//mi</span>rror.bjtu.edu.cn<span class="regexp">/apache/</span>hadoop<span class="regexp">/common/</span>hadoop-<span class="number">0.20</span>.<span class="number">203.0</span>/hadoop-<span class="number">0.20</span>.<span class="number">203.0</span>rc1.tar.gz</span><br></pre></td></tr></table></figure>

<p>复制安装包至 slave1 :</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">scp hadoop-0.<span class="number">20.203</span>.0rc1.tar.gz root<span class="variable">@slave1</span><span class="symbol">:/root/</span></span><br></pre></td></tr></table></figure>

<p>解压:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar xzvf hadoop-<span class="number">0.20</span>.<span class="number">203.0</span>rc1.tar.gz</span><br><span class="line">mkdir <span class="regexp">/usr/</span>local/hadoop</span><br><span class="line">mv hadoop-<span class="number">0.20</span>.<span class="number">203.0</span><span class="regexp">/ /u</span>sr<span class="regexp">/local/</span>hadoop</span><br></pre></td></tr></table></figure>

<p>修改 .bashrc 文件(位于用户目录下,即 <code>~/.bashrc</code> ,对于 root ,即为 <code>/root/.bashrc</code> )<br>添加环境变量:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">HADOOP_HOME</span>=/usr/local/hadoop</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$HADOOP_HOME/bin</span><br></pre></td></tr></table></figure>

<p>7.配置 Hadoop 环境变量</p>
<p>以下所有 hadoop 目录下的文件,均以相对路径 hadoop 开始.<br>修改 <code>hadoop/conf/hadoop-env.sh</code>文件,将里面的 JAVA_HOME 改成步骤 2 中设置的值.</p>
<p>8.创建 Hadoop 本地临时文件夹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mkdir <span class="regexp">/root/</span>hadoop_tmp </span><br></pre></td></tr></table></figure>

<p>(注意这一步,千万不要放在 /tmp 目录下面!!因为 /tmp 默认分配的空间是很小的,往 hdfs 里放几个大文件就会导致空间满了,就会报错)<br>修改权限:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chown -R hadoop:hadoop <span class="regexp">/root/</span>hadoop_tmp</span><br></pre></td></tr></table></figure>

<p>更松地,也可以这样:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod –R <span class="number">777</span> <span class="regexp">/root/</span>hadoop_tmp</span><br></pre></td></tr></table></figure>

<p>9.配置 Hadoop</p>
<p>修改 master 的 <code>hadoop/conf/core-site.xml</code> ,在 节中添加如下内容:<br>注意: fs.default.name 的值不能带下划线.</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">hadoop<span class="selector-class">.tmp</span><span class="selector-class">.dir</span></span><br><span class="line">/root/hadoop_tmp/hadoop_$&#123;user.name&#125;</span><br><span class="line">fs<span class="selector-class">.default</span><span class="selector-class">.name</span></span><br><span class="line">hdfs:<span class="comment">//localhost:54310</span></span><br><span class="line">io<span class="selector-class">.sort</span><span class="selector-class">.mb</span></span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure>

<p>其中 io.sort.mb 值,指定了排序使用的内存,大的内存可以加快 job 的处理速度.<br>修改 <code>hadoop/conf/mapred-site.xml</code> ,在 节中添加如下内容:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">mapred<span class="selector-class">.job</span><span class="selector-class">.tracker</span></span><br><span class="line">localhost:<span class="number">54311</span></span><br><span class="line">mapred<span class="selector-class">.map</span><span class="selector-class">.child</span><span class="selector-class">.java</span><span class="selector-class">.opts</span></span><br><span class="line">-Xmx4096m</span><br><span class="line">mapred<span class="selector-class">.reduce</span><span class="selector-class">.child</span><span class="selector-class">.java</span><span class="selector-class">.opts</span></span><br><span class="line">-Xmx4096m</span><br></pre></td></tr></table></figure>

<p>其中 mapred.map.child.java.opts, mapred.reduce.child.java.opts 分别指定 map/reduce 任务使用的最大堆内存.较小的内存可能导致程序抛出 OutOfMemoryException .<br>修改 <code>conf/hdfs -site.xml</code> ,在 节中添加如下内容:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">dfs.<span class="keyword">replication</span></span><br></pre></td></tr></table></figure>

<p>同样,修改 slave1 的 <code>/usr/local/hadoop/conf/core-site.xml</code> ,在 节中添加如下内容:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">hadoop<span class="selector-class">.tmp</span><span class="selector-class">.dir</span></span><br><span class="line">/root/hadoop_tmp/hadoop_$&#123;user.name&#125;</span><br><span class="line">fs<span class="selector-class">.default</span><span class="selector-class">.name</span></span><br><span class="line">hdfs:<span class="comment">//localhost:54310</span></span><br><span class="line">io<span class="selector-class">.sort</span><span class="selector-class">.mb</span></span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>conf/mapred-site.xml</code> ,在 节中添加如下内容:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">mapred<span class="selector-class">.job</span><span class="selector-class">.tracker</span></span><br><span class="line">localhost:<span class="number">54311</span></span><br><span class="line">mapred<span class="selector-class">.map</span><span class="selector-class">.child</span><span class="selector-class">.java</span><span class="selector-class">.opts</span></span><br><span class="line">-Xmx4096m</span><br><span class="line">mapred<span class="selector-class">.reduce</span><span class="selector-class">.child</span><span class="selector-class">.java</span><span class="selector-class">.opts</span></span><br><span class="line">-Xmx4096m</span><br></pre></td></tr></table></figure>

<p>修改 <code>conf/hdfs-site.xml</code> ,在 节中添加如下内容:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">dfs.<span class="keyword">replication</span></span><br></pre></td></tr></table></figure>

<p>至此, master 和 slave1 都已经完成了 single_node 的搭建,可以分别在两台机器上测试单节点.<br>启动节点:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">hadoop<span class="regexp">/bin/</span>start-all.sh</span><br></pre></td></tr></table></figure>

<p>运行 jps 命令,应能看到类似如下的输出:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">937 </span>DataNode</span><br><span class="line"><span class="symbol">9232 </span>Jps</span><br><span class="line"><span class="symbol">8811 </span>NameNode</span><br><span class="line"><span class="symbol">12033 </span>JobTracker</span><br><span class="line"><span class="symbol">12041 </span>TaskTracker</span><br></pre></td></tr></table></figure>

<p>这个教程有个问题,直接使用start-all.ssh启动的话,执行jps只有:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">5000 </span>Jps</span><br><span class="line"><span class="symbol">4683 </span>SecondaryNameNode</span><br><span class="line"><span class="symbol">4533 </span>DataNode</span><br></pre></td></tr></table></figure>

<p>必须再执行start-mapred.sh 运行才是正常的:</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">6009 </span>TaskTracker</span><br><span class="line"><span class="symbol">5763 </span>SecondaryNameNode</span><br><span class="line"><span class="symbol">6047 </span>Jps</span><br><span class="line"><span class="symbol">5613 </span>DataNode</span><br><span class="line"><span class="symbol">5864 </span>JobTracker</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>统计80端口的连接并排序</title>
    <url>/2014/06/22/1592/</url>
    <content><![CDATA[<p>统计80端口的连接并排序 :</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netstat -na|<span class="type">grep</span> :<span class="number">80</span>|<span class="type">awk</span> &#x27;&#123;print $<span class="number">5</span>&#125;&#x27;|<span class="type">awk</span> -F: &#x27;&#123;print $<span class="number">1</span>&#125;&#x27;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -r -n</span><br></pre></td></tr></table></figure>
<p>这样就能显示出80端口的所有连接并进行排序.</p>
]]></content>
  </entry>
  <entry>
    <title>完美解决ORA-00845 MEMORY_TARGET not supported on this system</title>
    <url>/2020/08/12/1593/</url>
    <content><![CDATA[<p>Linux下，Oracle 11g的自动内存管理不能指定大于这个/dev/shm的总量内存。否则就会出现如下错误：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ORA</span>-<span class="number">00845</span>: MEMORY_TARGET not supported <span class="literal">on</span> this system</span><br></pre></td></tr></table></figure>

<p>修改/etc/fstab,修改tmpfs大小，如果没有则需要自己添加：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># vi <span class="regexp">/etc/</span>fstab</span><br><span class="line"></span><br><span class="line">tmpfs                   <span class="regexp">/dev/</span>shm                tmpfs   defaults,<span class="keyword">size</span>=<span class="number">10240</span>M        <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>重新挂载：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># mount -o remount <span class="regexp">/dev/</span>shm</span><br><span class="line"># df -h</span><br><span class="line"></span><br><span class="line">Filesystem            <span class="keyword">Size</span>  Used Avail Use% Mounted on</span><br><span class="line"><span class="regexp">/dev/</span>sda1             <span class="number">9.7</span>G  <span class="number">4.6</span>G  <span class="number">4.7</span>G  <span class="number">50</span>% /</span><br><span class="line">tmpfs                 <span class="number">10.0</span>G  <span class="number">228</span>K  <span class="number">10.0</span>G   <span class="number">1</span>% <span class="regexp">/dev/</span>shm</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>网卡无法正常启动</title>
    <url>/2013/11/17/1594/</url>
    <content><![CDATA[<p>第一种:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth0</span><br></pre></td></tr></table></figure>

<p>ifcfg-eth0的配置文件里保存了以前的MAC地址,就把这一行删除掉在重启网卡.</p>
<p>第二种:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm -rf <span class="regexp">/etc/u</span>dev<span class="regexp">/rules.d/</span><span class="number">70</span>-persistent-net.rules</span><br></pre></td></tr></table></figure>

<p>删除后重启机器,因为这个文件绑定了网卡和mac地址,所以换了网卡以后MAC地址变了,所以不能正常启动,也可以直接编辑这个配置文件把里面的网卡和mac地址修改乘对应的,不过这样多麻烦,直接删除重启,它会自动生成个.</p>
]]></content>
  </entry>
  <entry>
    <title>网络连通测试脚本</title>
    <url>/2016/05/16/1595/</url>
    <content><![CDATA[<p>这个脚本会自动记录成功与不成功到文件,我们只要定时发送失败文件到邮箱就能知道服务器那些时间断了网.</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="built_in">DATE</span>=<span class="string">`date +%Y年%m月%d日%H:%M`</span></span><br><span class="line">ping <span class="params">-c1</span> www.baidu98798sdf987sd89f.com &gt;/dev/<span class="built_in">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; echo $DATE <span class="string">&quot;网络测试结果为:success&quot;</span> &gt;&gt; /<span class="built_in">var</span>/<span class="keyword">log</span>/ping_ok.<span class="keyword">log</span> || echo $DATE <span class="string">&quot;网络测试结果为:failed&quot;</span> &gt;&gt; /<span class="built_in">var</span>/<span class="keyword">log</span>/ping_error.<span class="keyword">log</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>为WordPress安装memcache和memcached</title>
    <url>/2015/12/04/1597/</url>
    <content><![CDATA[<p>为了让你的程序飞起来,必须安装memcached服务端程序和PHP的Memcached扩展,所以如果您要使用Memcache来缓存系统,memcache和memcached两样我们都需要安装.安装memcache</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> /usr/local/src</span><br><span class="line"><span class="variable">$</span> <span class="built_in">wget</span> http://pecl.php.net/get/memcache<span class="literal">-2</span>.<span class="number">2.5</span>.tgz</span><br><span class="line"><span class="variable">$</span> gzip <span class="literal">-d</span> memcache<span class="literal">-2</span>.<span class="number">2.5</span>.tgz</span><br><span class="line"><span class="variable">$</span> tar xvf memcache<span class="literal">-2</span>.<span class="number">2.5</span>.tar</span><br><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> memcache<span class="literal">-2</span>.<span class="number">2.5</span></span><br></pre></td></tr></table></figure>

<p>以下几句,是以php所在目录为/usr/local/php为例,如果您的php有变化,请自行替换几句中/usr/local/php的部分</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin/phpize</span><br><span class="line">$ .<span class="regexp">/configure –enable-memcache –with-php-config=/u</span>sr<span class="regexp">/local/</span>php<span class="regexp">/bin/</span>php-config –with-zlib-dir</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>将memcache加入php扩展</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>php.ini</span><br></pre></td></tr></table></figure>

<p>(/etc/php.ini地址为我的php.ini位置,如果你不知道你的php.ini在哪里,可以用$ find / -name php.ini进行查找,或者传个探针phpinfo,找到Configuration File (php.ini) Path)中php.ini的位置末尾加入</p>
<p>按键盘上的 i 开始编辑<br>CTRL+F翻页拉到最下面在[Zend]之前加入</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="variable">$extension_dir</span> = <span class="string">&quot;/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/&quot;</span><span class="attribute">extension</span>=memcache.so</span><br><span class="line">按Esc键,再输入</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>

<p>保存退出<br>重启你的web服务器,比如apache</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/etc/i</span>nit.d/httpd restart</span><br></pre></td></tr></table></figure>

<p>下面刷新下PHP探针,看下是不是有这个了,有的话就是装好了<br>memcacheVersion  2.2.5memcacheVersion  2.2.5<br>下面安装memcached</p>
<p>memcached首先需要安装安装libevent<br>如果是centos可以yum安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install libevent-devel</span></span><br><span class="line">如果不支持yum的系统,可以这样装libevent</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget  http://www.monkey.org/~provos/libevent-1.4.12-stable.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar vxf libevent-1.4.12-stable.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> libevent-1.4.12</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure –prefix=/usr/<span class="built_in">local</span>/libevent</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>继续安装memcached</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget http://cloud.github.com/download … ached-1.4.4.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar vxf memcached-1.4.4.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> memcached-1.4.4</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure –prefix=/usr/<span class="built_in">local</span>/memcached</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>安装完后启动memcached并分配32m内存(32为使用内存数,可按自身情况修改)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/memcached/</span>bin/memcached -d -m <span class="number">32</span> -l <span class="number">127.0</span>.<span class="number">0.1</span> -p <span class="number">11211</span> -u root</span><br></pre></td></tr></table></figure>

<p>将memcached加入启动项</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>rc.d/rc.local</span><br><span class="line">按键盘上的 i 开始编辑,在最后加入</span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/memcached/</span>bin/memcached -d -m <span class="number">32</span> -l <span class="number">127.0</span>.<span class="number">0.1</span> -p <span class="number">11211</span> -u root    按Esc键,再输入</span><br><span class="line">:wq  保存退出</span><br></pre></td></tr></table></figure>

<p>如果需要,可以reboot一下,不过不用reboot应该已经生效~<br>加速效果测试<br>用没有什么负载的Discuz X1做个测试,未启用时</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">GMT</span>+<span class="number">8</span>, <span class="number">2010</span>-<span class="number">9</span>-<span class="number">12</span> <span class="number">09</span>:<span class="number">08</span>, Processed in <span class="number">0</span>.<span class="number">038893</span> second(s), <span class="number">2</span> queries.</span><br></pre></td></tr></table></figure>

<p>缓存启用后的效果,不过总体感觉VPS上效果不如用eAccelerato缓存加入效果那么明显</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">GMT</span>+<span class="number">8</span>, <span class="number">2010</span>-<span class="number">9</span>-<span class="number">12</span> <span class="number">09</span>:<span class="number">08</span>, Processed in <span class="number">0</span>.<span class="number">008383</span> second(s), <span class="number">2</span> queries, Memcache <span class="literal">On</span>.</span><br></pre></td></tr></table></figure>

<p>OK,完工!~~</p>
]]></content>
  </entry>
  <entry>
    <title>为centos添加sudo用户</title>
    <url>/2018/07/21/1596/</url>
    <content><![CDATA[<p>1.添加用户sandy</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">adduser sandy</span></span><br></pre></td></tr></table></figure>

<p>2.给用户加密码</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">passwd sandy</span></span><br></pre></td></tr></table></figure>

<p>然后输入两次密码.</p>
<p>3.查看sudo是否安装</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span>|<span class="keyword">grep</span> sudo</span><br></pre></td></tr></table></figure>

<p>4.修改sudoers文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">visudo -f <span class="regexp">/etc/</span>sudoers</span><br></pre></td></tr></table></figure>

<p>在 <code>root ALL=(ALL) ALL</code> 之后增加:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sandy ALL=(ALL) ALL</span><br><span class="line">Defaults:tom timestamp_timeout=-<span class="number">1</span>,runaspw</span><br><span class="line"><span class="regexp">//</span>增加普通账户tom的sudo权限</span><br><span class="line"><span class="regexp">//</span>timestamp_timeout=-<span class="number">1</span> 只需验证一次密码,以后系统自动记忆</span><br><span class="line"><span class="regexp">//</span>runaspw  需要root密码,如果不加默认是要输入普通账户的密码</span><br></pre></td></tr></table></figure>

<p>5.修改普通用户的.bash_profile文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/home/</span>tom/.bash_profile</span><br></pre></td></tr></table></figure>

<p>在PATH变量中增加:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/sbin:/u</span>sr<span class="regexp">/sbin:/u</span>sr<span class="regexp">/local/</span>sbin:<span class="regexp">/usr/</span>kerberos/sbin</span><br></pre></td></tr></table></figure>

<p>如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .bash_profile</span></span><br><span class="line"><span class="comment"># Get the aliases and functionsif [ -f ~/.bashrc ]; then        . ~/.bashrcfi</span></span><br><span class="line"><span class="comment"># User specific environment and startup programs</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span><span class="regexp">/bin:/</span>sbin:<span class="regexp">/usr/</span>sbin:<span class="regexp">/usr/</span>local<span class="regexp">/sbin:/u</span>sr<span class="regexp">/kerberos/</span>sbin</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>

<p>如果要添加超级用户:</p>
<p>1.新添用户不存在(例如要添加longtune)</p>
<p>在root下:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>useradd -G root,bin,daemon,sys,adm,disk,wheel longtune</span><br></pre></td></tr></table></figure>

<p>2.用户已经存在</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>usermod -G root,bin,daemon,sys,adm,disk,wheel longtune</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>无操作自动断开ssh连接</title>
    <url>/2018/06/07/1598/</url>
    <content><![CDATA[<p>SSH Server一般会根据设定的设计自动断开SSH连接,这就是为什么一定时间不操作SSH,SSH会自动断开的原因.按以下步骤可以延长自动断开的时间.以centos5.3为例:<br>编辑配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">nano <span class="regexp">/etc/</span>ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>添加两个参数:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ClientAliveInterval</span> <span class="number">20</span></span><br><span class="line"><span class="attribute">ClientAliveCountMax</span> <span class="number">300</span></span><br></pre></td></tr></table></figure>

<p>按以上的配置的含义就是 SSH 每20秒向客户端发送一次心跳,连续发送300次没有收到客户端道应答,则断开客户端.系统默认是ClientAliveInterval为15,ClientAliveCountMax 为3,所以SSH会在45秒之后断开.<br>保存设置并重载配置文件.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/sshd restart</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>限制CPU使用率的方法</title>
    <url>/2014/03/20/1600/</url>
    <content><![CDATA[<p>1,apache本身的限制功能(RLimitCPU)</p>
<p>引用国外这个帖子:</p>
<p>The PHP test can be used to show that the problem is evident, but it is not conclusive to prove that there is no limit put in place.</p>
<p>The reason is that it depends on how PHP is configured on the server. If the PHP scripting engine is setup as a CGI application which is forked by Apache, then the RLimit* operatives will apply and the PHP script can prove this. If they run within httpd however, the limits would not apply to the PHP engine.</p>
<p>这个限制将施于Apache子服务请求衍生出的进程,而不是Apache子进程本身.这个范围包括CGI脚本和SSI执行命令,但不包括所有从Apache父进程衍生出的进程.比如说管道日志.<br>如果不子进程不衍生进程,或非常占资源的这个进程不属于衍生出来的进程,那不就是没办法了吗?所以呀,这个办法不行地.</p>
<p>2,通过系统的 ulimit命令限制资源的使用</p>
<p>设置文件在:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>security/limits.conf</span><br></pre></td></tr></table></figure>

<p>比如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">xok_la</span>           hard    cpu             <span class="number">1</span></span><br><span class="line"><span class="attribute">xok_la</span>           hard    fsize           <span class="number">50000</span></span><br><span class="line"><span class="attribute">xok_la</span>           hard    memlock         <span class="number">1000</span></span><br><span class="line"><span class="attribute">xok_la</span>           hard    nofile          <span class="number">50</span></span><br><span class="line"><span class="attribute">xok_la</span>           hard    nproc           <span class="number">50</span></span><br></pre></td></tr></table></figure>

<p>这种方式限制是可以的,他是基于用户来限制的,可以限制内存,CPU占用时间,打开的文件数等等.前提是你要登陆到这个系统上.如果只是以这个用户来单独运行文件的话,就不行…….所以我还是要放弃.</p>
<p>3,安装CPU Usage Limiter for Linux</p>
<p>What is it?<br>cpulimit is a simple program that attempts to limit the cpu usage of a process (expressed in percentage, not in cpu time). This is useful to control batch jobs, when you don’t want them to eat too much cpu. It does not act on the nice value or other scheduling priority stuff, but on the real cpu usage. Also, it is able to adapt itself to the overall system load, dynamically and quickly.</p>
<p>可以限制程序使用CPU的百分比,而不是时间.很好,很舒服.</p>
<p>开始安装吧.</p>
<p>官方地址:<a href="http://cpulimit.sourceforge.net/">http://cpulimit.sourceforge.net/</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/root/i</span>nstall/</span><br><span class="line">svn checkout https:<span class="regexp">//</span>cpulimit.svn.sourceforge.net<span class="regexp">/svnroot/</span>cpulimit/trunk cpulimit</span><br><span class="line">cd cpulimit</span><br><span class="line">make  </span><br><span class="line">cp .<span class="regexp">/cpulimit /u</span>sr/sbin</span><br></pre></td></tr></table></figure>

<p>如此简单,很愉快吧?</p>
<p>限制方法:</p>
<p>如果限制进程名,比如将httpd这个进程名的CPU限制在40%</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">cpulimit <span class="params">--exe</span> httpd <span class="params">--limit</span> 40</span><br><span class="line">cpulimit <span class="params">--exe</span> <span class="string">/usr/local/bin/httpd</span> <span class="params">--limit</span> 40</span><br></pre></td></tr></table></figure>

<p>将pid为2960的进程的CPU限制在55%</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cpulimit</span> --pid <span class="number">2960</span> --limit <span class="number">55</span></span><br></pre></td></tr></table></figure>

<p>慢慢对比top 命令那里的CPU变化.嘿嘿,有效果了吧?.<br>再来个完美的<br>自动限制当前进程使用CPU超过20%的进程,将他限制为10%</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cpulimit</span> --pid `ps aux|awk &#x27;&#123;if($<span class="number">3</span> &gt; <span class="number">20</span>) print $<span class="number">2</span>&#125;&#x27;` --limit <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>cpulimit命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Error: You must specify a target process, by name or by PID</span><br><span class="line">Usage: cpulimit TARGET [OPTIONS...]</span><br><span class="line">TARGET must be exactly one of these:</span><br><span class="line">-p, --pid=N        pid of the process (implies -z)</span><br><span class="line">-e, --exe=FILE     name of the executable program file or absolute path name</span><br><span class="line">OPTIONS</span><br><span class="line">-l, --limit=N      percentage of cpu allowed from <span class="number">0</span> to <span class="number">100</span> (required)</span><br><span class="line">-v, --verbose      show control statistics</span><br><span class="line">-z, --lazy         <span class="keyword">exit</span> <span class="keyword">if</span> there is no suitable target process, or <span class="keyword">if</span> it dies</span><br><span class="line">-h, --help         display this help and <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>系统维护常用查询</title>
    <url>/2013/11/12/1599/</url>
    <content><![CDATA[<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">netstat <span class="literal">-anp</span> | grep mysql <span class="comment">#查看数据库端口</span></span><br><span class="line"><span class="built_in">ps</span> <span class="literal">-eaf</span>|grep monit <span class="comment">#查看monit服务是否运行</span></span><br><span class="line"></span><br><span class="line">lsof <span class="literal">-i</span>:<span class="number">8080</span> <span class="comment">#查看端口被什么程序占用了</span></span><br><span class="line">service atd status <span class="comment">#查看服务是否运行</span></span><br><span class="line"><span class="built_in">kill</span> <span class="literal">-9</span> <span class="variable">$</span>(<span class="built_in">ps</span> <span class="literal">-ef</span> | grep httpd | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>) <span class="comment">#进程僵死的处理方法</span></span><br><span class="line"></span><br><span class="line">df <span class="literal">-l</span> <span class="comment">#磁盘情况</span></span><br><span class="line">fdisk <span class="literal">-l</span> <span class="comment">#磁盘挂载情况</span></span><br><span class="line">rpm <span class="literal">-ql</span> mplayer | <span class="built_in">cat</span> <span class="literal">-n</span> <span class="comment">#查看软件安装位置</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>限制linux某个目录的大小</title>
    <url>/2018/07/03/1601/</url>
    <content><![CDATA[<p>一共有两种方式可以实现这个.</p>
<p>第一种:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero of=<span class="regexp">/tmp/</span>ccc.img bs=<span class="number">1</span>M <span class="keyword">count</span>=<span class="number">1000</span></span><br><span class="line">mkfs <span class="regexp">/tmp/</span>ccc.img</span><br><span class="line">mount -o loop <span class="regexp">/tmp/</span>ccc.img <span class="regexp">/mnt/</span>test</span><br></pre></td></tr></table></figure>

<p>现在 <code>/mnt/test</code> 就被限制成为1000M的一个目录了.</p>
<p>第二种:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero of=<span class="regexp">/mnt/</span>point1/<span class="keyword">file</span>.img bs=<span class="number">1</span>Mcount=<span class="number">1000</span></span><br><span class="line">losetup <span class="regexp">/dev/</span>loop1 <span class="regexp">/mnt/</span>point1/<span class="keyword">file</span>.img</span><br><span class="line">mkfs -t ext3 <span class="regexp">/dev/</span>loop1 <span class="number">1000</span></span><br><span class="line">mkdir <span class="regexp">/mnt/</span>point2</span><br><span class="line">mount -t ext3 <span class="regexp">/dev/</span>loop1 <span class="regexp">/mnt/</span>point2</span><br></pre></td></tr></table></figure>

<p>这样 <code>/mnt/point2</code>也被限制成为了1G的大小了.</p>
]]></content>
  </entry>
  <entry>
    <title>新装centos无法使用ssh连接的解决办法</title>
    <url>/2014/11/07/1604/</url>
    <content><![CDATA[<p>非常神气的事情新安装的centos是不启动ssh服务的,</p>
<p>真是匪夷所思啊,我们只要启动ssh的服务就可以了.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/sshd start</span><br></pre></td></tr></table></figure>

<p>然后就可以使用putty连接了.</p>
]]></content>
  </entry>
  <entry>
    <title>限制su命令</title>
    <url>/2013/05/12/1602/</url>
    <content><![CDATA[<p>如果您不想任何人能够su作为root,可以编辑 <code>/etc/pam.d/su</code>文件,增加如下两行:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">auth sufficient <span class="regexp">/lib/</span>security/pam_rootok.so debug</span><br><span class="line">auth required <span class="regexp">/lib/</span>security/pam_wheel.so <span class="keyword">group</span>=chenqs</span><br></pre></td></tr></table></figure>

<p>这时,仅chenqs组的用户可以su作为root.此后,如果您希望用户cqs能够su作为root,可以运行如下命令:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>usermod -G10 cqs</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>新装gnome没有图片浏览器</title>
    <url>/2012/12/25/1605/</url>
    <content><![CDATA[<p>最近新装了系统,yum安装的gnome,后来发现没有图片浏览器.<br>baidu很久发现默认的图片浏览器叫eog.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> eog</span><br></pre></td></tr></table></figure>
<p>就可以安装好了.</p>
]]></content>
  </entry>
  <entry>
    <title>小内存vps 增加swap</title>
    <url>/2014/07/26/1603/</url>
    <content><![CDATA[<p>是用脚本解决问题:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">SWAP=<span class="string">&quot;<span class="variable">$&#123;1:-1024&#125;</span>&quot;</span></span><br><span class="line">NEW=<span class="string">&quot;$[SWAP*1024]&quot;</span>; TEMP=<span class="string">&quot;<span class="variable">$&#123;NEW//?/ &#125;</span>&quot;</span>; OLD=<span class="string">&quot;<span class="variable">$&#123;TEMP:1&#125;</span>0&quot;</span></span><br><span class="line">umount /proc/meminfo 2&gt; /dev/null</span><br><span class="line">sed <span class="string">&quot;/^Swap\(Total\|Free\):/s,<span class="variable">$OLD</span>,<span class="variable">$NEW</span>,&quot;</span> /proc/meminfo &gt; /etc/fake_meminfo</span><br><span class="line">mount --<span class="built_in">bind</span> /etc/fake_meminfo /proc/meminfo</span><br><span class="line">free -m</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>新装nginx的启动 关闭和重启的方法</title>
    <url>/2018/09/21/1606/</url>
    <content><![CDATA[<p>nginx启动命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx</span></span><br></pre></td></tr></table></figure>

<p>nginx重启动命令:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nginx -s reload</span></span><br></pre></td></tr></table></figure>

<p>nginx关闭的命令:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure>

<p>如果提示 -bash:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">nginx:</span> command not found</span><br></pre></td></tr></table></figure>

<p>就执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">whereis nginx</span></span><br></pre></td></tr></table></figure>

<p>然后进入sbin目录 把里面的nginx文件放到/bin目录里面就可以执行上面的命令了.</p>
]]></content>
  </entry>
  <entry>
    <title>修改gho系统文件</title>
    <url>/2012/07/21/1608/</url>
    <content><![CDATA[<p>Symantec Ghost是大名鼎鼎的硬盘备份工具,它可以把一个磁盘上的全部内容复制到另外一个磁盘上,也可以把磁盘内容复制为一个磁盘的镜像文件,以后你可以用镜像文件创建一个原始磁盘的拷贝.Ghost Explorer 可以将使用Norton Ghost备份的镜像(.gho)进行查看和编辑.在你已经使用Ghost对系统进行了备份得到.gho文件或者你在网上下载了一个.gho镜像文件,但是对其中的内容不满意或者想要提取其中的某些文件,那Ghost Explorer可以很顺利的帮您完成这些任务,你可以用Ghost Explorer向.gho镜像添加文件、删除文件、提取文件然后再重新制作成自己满意的ghost(.gho)文件进行封装!</p>
]]></content>
  </entry>
  <entry>
    <title>修改linux网络参数</title>
    <url>/2017/07/05/1609/</url>
    <content><![CDATA[<p>linux下修改IP、DNS、路由命令行设置 ubuntu 版本命令行设置IP.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cat</span> /etc/network/interfaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line"><span class="attribute">auto</span> lo</span><br><span class="line"><span class="attribute">iface</span> lo inet loopback</span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line"><span class="attribute">auto</span> eth<span class="number">0</span></span><br><span class="line"><span class="attribute">iface</span> eth<span class="number">0</span> inet static</span><br><span class="line"><span class="attribute">address</span> <span class="number">192.168.1.104</span></span><br><span class="line"><span class="attribute">netmask</span> <span class="number">255.255.255.0</span></span><br><span class="line"><span class="attribute">network</span> <span class="number">192.168.1.0</span></span><br><span class="line"><span class="attribute">broadcast</span> <span class="number">192.168.1.255</span></span><br><span class="line"><span class="attribute">gateway</span> <span class="number">192.168.1.2</span></span><br><span class="line"><span class="comment"># dns-* options are implemented by the resolvconf package, if installed</span></span><br><span class="line"><span class="attribute">dns</span>-nameservers <span class="number">58.22.96.66</span> <span class="number">218.104.128.106</span> <span class="number">202.101.138.8</span></span><br></pre></td></tr></table></figure>

<p>重启网卡:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/networking restatr</span><br></pre></td></tr></table></figure>

<p>redhat linux版本命令行设置IP:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span> eth<span class="number">0</span> 新ip</span><br></pre></td></tr></table></figure>

<p>然后编辑 <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>,修改ip.</p>
<p>一、修改IP地址</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">vi ifcfg-eth0</span><br><span class="line"></span><br><span class="line"><span class="attribute">DEVICE</span>=eth0</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">IPADDR</span>=219.136.241.211</span><br><span class="line"><span class="attribute">NETMASK</span>=255.255.255.128</span><br><span class="line"><span class="attribute">GATEWAY</span>=219.136.241.254</span><br></pre></td></tr></table></figure>

<p>二、修改网关</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig<span class="built_in">/network</span></span><br><span class="line"><span class="built_in"></span></span><br><span class="line"><span class="attribute">NETWORKING</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=Aaron</span><br><span class="line"><span class="attribute">GATEWAY</span>=192.168.1.1</span><br></pre></td></tr></table></figure>

<p>三、修改DNS</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> resolv.conf</span><br><span class="line"></span><br><span class="line">nameserver <span class="number">202.96.128.68</span></span><br><span class="line">nameserver <span class="number">219.136.241.206</span></span><br></pre></td></tr></table></figure>

<p>四、重新启动网络配置</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/network restart</span><br></pre></td></tr></table></figure>

<p>五、例子</p>
<p>1、修改ip地址</p>
<p>即时生效:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span> eth<span class="number">0</span> <span class="number">192.168.0.20</span> netmask <span class="number">255.255.255.0</span></span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth0</span><br></pre></td></tr></table></figure>

<p>2、修改default gateway</p>
<p>即时生效:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">route <span class="builtin-name">add</span><span class="built_in"> default </span>gw 192.168.0.254</span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig<span class="regexp">/network-scripts/i</span>fcfg-eth0</span><br></pre></td></tr></table></figure>

<p>修改dns:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure>

<p>修改后可即时生效,启动同样有效.</p>
<p>3、修改hostname</p>
<p>即时生效:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hostname</span> fc<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>启动生效:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysconfig/network</span><br></pre></td></tr></table></figure>

<p>ps:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">DEVICE</span>=eth0</span><br><span class="line"><span class="attr">BOOTPROTO</span>=static</span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">8.85</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">248.0</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">8.1</span></span><br><span class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">0</span>uu3:<span class="number">47</span>:<span class="number">2</span>C:D5:<span class="number">40</span></span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<p>4、添加linux系统启动项</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p>5、修改Linux系统SSH的端口号</p>
<p>修改Linux系统SSH的端口号 操作系统linux和Unix都适用: 修改配置文件 <code>/etc/ssh/sshd_config</code>,将里面的Port改为新端口(此端口必须是没有程序用到),比如10022, 然后:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">kill -HUP `<span class="keyword">cat</span> /<span class="keyword">var</span>/<span class="keyword">run</span>/sshd.pid` </span><br></pre></td></tr></table></figure>

<p>就行了.</p>
]]></content>
  </entry>
  <entry>
    <title>修复mysql8.0大小写敏感的问题</title>
    <url>/2019/12/12/1607/</url>
    <content><![CDATA[<p>mysql8的大小写敏感配置比较坑，根据官方文档可以发现，该配置只能在数据库初始化之前配置。之后添加该配置会导致mysql服务无法启动。因此这里记录下重新初始化的方法：</p>
<p>将数据库下所有数据保存备份，如果你不在意数据的话直接删除数据。</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span>停止MySQL</span><br><span class="line"><span class="symbol">2 </span>删除 MySQL的数据 /var/lib/mysql</span><br><span class="line"><span class="symbol">3 </span>修改该 lower_case_table_names = <span class="number">1</span></span><br><span class="line"><span class="symbol">4 </span>启动 mysql</span><br><span class="line"><span class="symbol">5 </span>搞定</span><br></pre></td></tr></table></figure>

<p>在重新初始化之后所有账号数据都会被重置，这里需要查看重新初始化的root账户登陆密码：<br>查看临时密码：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grep</span> <span class="string">&quot;A temporary password&quot;</span> <span class="regexp">/var/</span>log/mysqld.log</span><br></pre></td></tr></table></figure>

<p>登陆mysql修改账户信息即可！?</p>
]]></content>
  </entry>
  <entry>
    <title>修改mysql密码</title>
    <url>/2017/09/06/1610/</url>
    <content><![CDATA[<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; <span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">Password</span> = <span class="keyword">PASSWORD</span>(<span class="string">&#x27;newpass&#x27;</span>) <span class="keyword">WHERE</span> <span class="keyword">user</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>修改phpmyadmin 导入文件大小</title>
    <url>/2017/10/05/1611/</url>
    <content><![CDATA[<p>修改php.ini中的以下三项:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">upload<span class="emphasis">_max_filesize</span></span><br><span class="line"><span class="emphasis">memory_limit</span></span><br><span class="line"><span class="emphasis">post_max_</span>size</span><br></pre></td></tr></table></figure>
<p>三项的值都要改大一些,改完之后记得重启动服务器.</p>
]]></content>
  </entry>
  <entry>
    <title>修改phpmyadmin上传限制</title>
    <url>/2015/04/04/1612/</url>
    <content><![CDATA[<p>方法一:修改 php.ini</p>
<p>相关参数解释:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">file_uploads</span> = <span class="literal">on</span> ;是否允许通过HTTP上传文件的开关.默认为<span class="literal">ON</span>即是开</span><br><span class="line"><span class="attribute">upload_tmp_dir</span> ;文件上传至服务器上存储临时文件的地方,如果没指定就会用系统默认的临时文件夹.</span><br><span class="line"><span class="attribute">upload_max_filesize</span> = <span class="number">2</span>m ;望文生意,即允许上传文件大小的最大值.默认为<span class="number">2</span>M</span><br><span class="line"><span class="attribute">post_max_size</span> = <span class="number">8</span>m ;指通过表单POST给PHP的所能接收的最大值,包括表单里的所有值.默认为<span class="number">8</span>M</span><br><span class="line"><span class="attribute">max_execution_time</span> = <span class="number">30</span> ;每个PHP页面运行的最大时间值(秒),默认<span class="number">30</span>秒</span><br><span class="line"><span class="attribute">max_input_time</span> = <span class="number">60</span> ;每个PHP页面接收数据所需的最大时间,默认<span class="number">60</span>秒</span><br><span class="line"><span class="attribute">memory_limit</span> = <span class="number">128</span>m ;每个PHP页面所吃掉的最大内存,默认<span class="number">128</span>M.如果觉得小了,可以设置大点.<span class="number">128</span>够用.</span><br><span class="line"><span class="attribute">max_execution_time</span> = <span class="number">600</span></span><br><span class="line"><span class="attribute">max_input_time</span> = <span class="number">600</span></span><br><span class="line"><span class="attribute">upload_max_filesize</span> = <span class="number">32</span>m</span><br><span class="line"><span class="attribute">post_max_size</span> = <span class="number">32</span>m</span><br></pre></td></tr></table></figure>

<p>把上述参数修改后,在网络所允许的正常情况下,就可以上传大体积文件了</p>
<p>方法二,利用.htaccess文件:</p>
<p>此法不用直接.修改php.ini,适用于虚拟主机.<br>配置Apache支持.htaccess</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="comment">//找到</span></span><br><span class="line"><span class="params">&lt;directory /&gt;</span></span><br><span class="line">　　Options FollowSymLinks</span><br><span class="line">　　AllowOverride None</span><br><span class="line"><span class="params">&lt;/directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改为</span></span><br><span class="line"><span class="params">&lt;directory /&gt;</span></span><br><span class="line">　　Options FollowSymLinks</span><br><span class="line">　　AllowOverride All</span><br><span class="line"><span class="params">&lt;/directory&gt;</span></span><br><span class="line"><span class="comment">//就可以了</span></span><br></pre></td></tr></table></figure>

<p>在目录下新建一个.htaccess文件,windows默认是不允许这么干的,可以在Dreamweaver的文件管理下新建,就不会了.<br>.htaccess里写入</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">php_value</span> post_max_size <span class="number">12</span>m</span><br><span class="line"><span class="attribute">php_value</span> upload_max_filesize <span class="number">12</span>m</span><br><span class="line"><span class="attribute">php_value</span> max_execution_time <span class="number">120</span></span><br><span class="line"><span class="attribute">php_value</span> max_input_time <span class="number">240</span></span><br></pre></td></tr></table></figure>

<p>就OK了.</p>
<p>补充解释:</p>
<p>使用 <code>ini_set(&quot;post_max_size&quot;,&quot;80M&quot;);</code>的方法是行不通的.</p>
<p>post_max_size的可修改范围是PHP_INI_PERDIR.<br>PHP_INI_PERDIR是域内指令只能在php.ini、httpd.conf或.htaccess文件中修改,故行不通.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">php_value <span class="built_in">name</span> value</span><br></pre></td></tr></table></figure>

<p>设定指定指令的值.仅能用于 PHP_INI_ALL 和 PHP_INI_PERDIR 类型的指令.要清除上一个设定的值,将值设为 none .<br>注: 不要用 php_value 来设定布尔值.应该用 php_flag (见下面)来替代.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">php_flag</span> name <span class="literal">on</span>|<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>用于设定布尔值类型的配置指令.仅能用于 PHP_INI_ALL 和 PHP_INI_PERDIR 类型的指令.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">php_admin_value <span class="built_in">name</span> value</span><br></pre></td></tr></table></figure>

<p>设定指定指令的值.不能在 .htaccess 文件中使用.任何在 php_admin_value 中设定的值不能被 .htaccess 或者 virtualhost 中的指令覆盖.要清除上一个设定的值,将值设为 none .</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">php_admin_flag</span> name <span class="literal">on</span>|<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<p>用于设定布尔值类型的配置指令.不能在 .htaccess 文件中使用.任何在 php_admin_flag 中设定的值不能被 .htaccess 或者 virtualhost 中的指令覆盖.</p>
]]></content>
  </entry>
  <entry>
    <title>修改TOMCAT端口和绑定域名</title>
    <url>/2011/09/18/1613/</url>
    <content><![CDATA[<p>改端口8080为80.<br>80端口是http协议的默认端口,8080端口同80端口,也是被用于WWW代理服务实现网页浏览.<br>在tomcat安装目录下的conf子目录下,找到server.xml文件,查找到如下信息:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Connector port</span>=<span class="string">&quot;8080&quot;</span></span><br></pre></td></tr></table></figure>

<p>将8080改为80即可,省去了输写网址的时候加端口:8080.</p>
<p>Tomcat域名配置:</p>
<p>在 <code>Tomcat/confi/Server.xml</code>下配置如下:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Host <span class="attribute">name</span>=<span class="string">&quot;shuxun.wang&quot;</span> <span class="attribute">appBase</span>=<span class="string">&quot;webapps&quot;</span> <span class="attribute">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">xmlValidation</span>=<span class="string">&quot;false&quot;</span> <span class="attribute">xmlNamespaceAware</span>=<span class="string">&quot;false&quot;</span>&gt; </span><br></pre></td></tr></table></figure>

<p>然后将域名解析到服务器IP就可以访问了.</p>
]]></content>
  </entry>
  <entry>
    <title>修改Winpe系统的注册表</title>
    <url>/2011/10/12/1614/</url>
    <content><![CDATA[<p><code>/WINDOWS/system32/config</code>里面是注册表的文件.<br>在windows中运行regedit,进入注册表编辑器,选中HKLM,选择菜单上的”加载配置单元”,然后指定你要修改的PE的注册表文件进行修改.完成后选”卸载配置单元”,对PE注册表文件的修改就是你所要的”永久性”的了.</p>
]]></content>
  </entry>
  <entry>
    <title>虚拟机修改mac地址无法启动网络</title>
    <url>/2015/05/20/1616/</url>
    <content><![CDATA[<p>删除<code>/etc/udev/rules.d/70-persistent-net.rules</code>中第一个 网卡信息,修改后面一个为eth0,<br>删除<code>/etc/sysconfig/network-script/ifcfg-eth0</code>中mac地址.</p>
]]></content>
  </entry>
  <entry>
    <title>修改用户家目录</title>
    <url>/2013/09/24/1615/</url>
    <content><![CDATA[<p>方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">usermod -d <span class="regexp">/home/</span>www/jiucool jiucool</span><br></pre></td></tr></table></figure>
<p>注: <code>/home/www/jiucool</code> 为修改的目标文件夹.<br>jiucool 为要修改的用户家目录的用户名.</p>
]]></content>
  </entry>
  <entry>
    <title>一路陪你到永远</title>
    <url>/2007/12/13/1617/</url>
    <content><![CDATA[<p>　　作者:王殊勋     来源:江西蓝天学院院报     编辑:晏玉荣     浏览:233     更新:2007-12-13 17:21:43  </p>
<p>　　在江西蓝天学院院报140期三版刊登的&lt;在”蓝天”没有孤儿&gt;一文,曾向读者介绍了一位残疾女孩丁云杰”孤儿不孤”的故事,打动了许多人的心.其实,丁云杰在得到社会得到”蓝天”关爱的同时,也以自己特殊的魅力征服了一位名叫王殊勋的高中同班男孩,从而收获了一份真诚的爱情.这篇由王殊勋写的&lt;一路陪你到永远&gt;,就记录了他们相识相恋相伴的感人历程.<br>　　于果校长、郑守华书记都审阅了此文并为之深深感动.于校长还写下了批示:我会一路陪她到永远,男女主人公的爱情故事很感人.我一向不主张学生在校期间过早谈恋爱,但看了小王同学的文章后,让我感动了,让我们共同关心、祝福他们:好人一生平安.<br>　　除了老师要求写的作文以外,这是我第一次写文章.我要用最朴实的语言,给大家讲讲我和丁云杰的爱情故事.<br>　　我是一个十分内向的男孩,不怎么爱讲话,但云杰却十分外向,爱说爱笑,活泼开朗.有人说,男女之间的性格应该是互补的.以前不怎么理解这句话,现在感受很深.有时我会想,不是我不爱说话,而是上天太爱她了,赐给她开朗的性格,我想说的话都被她说完了.与她结识以来,给我印象最深的是她的微笑,无论遇到什么,她总会微笑,给人一份温暖、一份坚强.<br>　　她长得很漂亮,做事很干脆.与他人不同的是,她是一位不能行走的残疾女孩.我们是在高中结识的,高一刚分完教室,同学们刚坐好,突然门开了,走进了一位拄双拐的女孩,我第一眼就看见了她的微笑,那时内心有一种感觉:这个女孩真的好坚强.<br>　　在以后的几天里,我发现,她经常找人替她买面包.后经留意才发现,她排不上队,无法去食堂打饭,只能常常吃面包.即使是吃面包,可也不会总有人去商店,所以吃面包对她来说都很困难.<br>　　我初中的同桌就是一位肢体残疾的同学,所以我更能体会到残疾人的无奈,于是我主动帮她买面包.一段时间后,我怕她老吃面包太腻了,就帮她打饭,每天帮她把饭打到教室里,等她吃完后再去帮她洗餐具.<br>　　由于我们教室在楼上,她下楼去水房喝水非常困难.于是,我帮他买了一个水瓶,每天给她打水.别人的水瓶也许偶尔会空着,但她的从来没有空过.冬天,打上来的热水很快就会凉掉,我就经常下楼去换,这样,她一直都有热水喝.<br>　　她上、下楼都不方便,我每天就在一边扶着,以免她被别人撞倒.或许有人要问,我为什么对她这么好,说实话,我也不知道.我只是感觉,每天做这些,心里会舒服点,这也可能是上天早就为我安排好的事情吧.总之,我很愿意这样做,到底是为什么,我自己也不清楚,只知道和这个小姑娘在一起很开心,我也从她身上学到了很多不寻常的东西.<br>　　由于我对她很好,她认我做了弟弟,从此我叫她姐姐.我们一起玩一起闹,每天都很开心.<br>　　我原来是个超级”网虫”,一天不去网吧就不舒服,把学业扔得远远的.认识云杰后,我每去一次网吧,她就和我吵一次,吵得很激烈,我都招架不住了,她又采取了”经济封锁(替我保管钱)”的方式,使我在高二时和网吧说再见了.此后,我的成绩从倒数一直上升到中上等.<br>　　随着时间的流逝,到了高二的下半学期,我突然有了一种奇妙的感觉,我发现自己已经爱上了这名残疾女孩.<br>经过无数次的思想斗争,我决定表白,有一天我给她写了张纸条:杰,我爱上你了,你答应我好吗?我是认真的,虽然我还小,但我明白说这句话后要负什么责任,你相信我,好吗?<br>   　 纸条递出后的几天,她一直都没理我.我沉不住气了,直接找到了她,她说:”我不信,也不会答应,因为你太小,还不懂什么是爱情,也没有明白和我好,你究竟要付出多大的代价!”<br>　　我一次又一次地向她发誓我是认真的,但她什么都没说,最后,她递给我一张纸条,这是一张什么样的纸条啊,泪水早已把它浸透,上面只有5个被泪水模糊了的字:我不能爱你!<br>　　既然这样,我也没有勉强她,还是一如既往地照顾她.后来我得知她是一名孤儿,就开始把我的生活费分给她一半,还经常为她买一些衣服,因为她平时穿得太不好了,看到别的女孩子都穿得那么好,我心里有一种酸酸的味道.刚开始她不肯接受,说我这是施舍,经过我的几次解释,加上她也实在没钱,才接受并说有能力后一定加倍偿还我.<br>   　 有一次我陪她去买衣服,从早上八点多开始逛商场,直到晚上八点多我们才回来,她拄着双拐和我走,一天下来有多累是可想而知的.买衣服时,她试了一件又一件,而且专门找人多的地方去挑衣服,我就一直在她身边陪着.她找衣服,我就在一边帮忙;她试衣服, 我就蹲在她的身边.服装店的那些老板和店员都说,你弟弟对你真好啊.<br>　　第二天她问我:”你知道我昨天买衣服为什么要逛一天,并且专门往人多的地方走吗?”我摇了摇头.”我想看你会不会嫌我丢人.结果我很满意,谢谢你!”那天我高兴极了.<br>　　放暑假我们开始补课,有一天,我没地方住了,她那时外住,于是我去了她那里.她租的房子很小,摆了一张床,就没有什么空间了.床是上下铺的, 她睡下铺,我睡上铺,可被子只有一床.蚊子很多,我睡熟以后,她把被子扔到了上铺,努力地替我盖上.因为蚊子实在太多,没有被子,她没办法睡着,就在床上坐了一整夜.早上起来时,我看到她的脸上、手臂上到处都是蚊子叮过的包.<br>　　就这样,我照顾了她两年:替她打了两年的水, 替她打了两年的饭,扶了她两年……高二快结束时,她终于被我的真诚打动了,答应做我的女朋友.<br>　　到了高三,我们就坐在了一起,每天早早地起来学习,每天相互鼓励,我们的学习成绩不断地上升……<br>　　我身边的朋友知道我动了真感情,都劝我和她分手,说她将来会给我带来什么什么样的负担、说我的父母一定会反对的等等,我只是笑笑,因为这些我早已全部想清楚了.<br>　　一次,她认的一名上大学的哥哥来看她,由于一年多没见,她哥拥抱了她一下.我气急了, 我们吵了起来,我要和她分手,把价值一千二的手机也摔了,钱也扔了,衣服也撕碎了……大热天里,我光着上身,只穿了一条短裤,在火烤过一样的马路上,光着脚走回家.走了近三个小时,实在太累了,我就倒在马路上睡着了,后来她打车追上了我,把我拉回了学校.后来她告诉我,这件事让她明白了我有多么的在乎她,她就决定这辈子非我不嫁!<br>   　就这样,我们的感情一天天地加深.有一天晚上,我们在校园里散步时,看到了很多的情侣,她问我:”学校这么多的情侣,有成的吗?”我告诉她:”若只有一双成的,那就是我们;若我们成不了,就不会有一双成的.”<br>   　 很多时候,她会莫名其妙地哭.我问她时,她说,她不能走路,配不上我.她又说:”就算我们坚持了,你父母还是会反对的.你虽然好,但不属于我……”本来她的眼睛一只单眼皮一只双眼皮的,但老是哭,最后都成了双眼皮.<br>　　高中快毕业了,她说她要放弃我们的感情.平时我从来不对她发脾气的,但每当她说这类话时,我就会发疯似地骂她,怨她还不明白我的心.<br>　　我父母知道了我们的事,不出意料,他们极力地反对.我父母都是教授,高考后,他们积极地帮我联系大学,我们开始害怕了,害怕不能在一起上大学.<br>　　父亲为了不让我们联系,便把我关在了家里,连我手机上的短信都要检查.爸爸告诉我,若我再和她来往,就不供我上大学,他一向说到做到的.那次我哭了,泪水流进了心里,像刀割着心一样.<br>   　我让一名男同学给我家打电话,说叫我去他家玩.利用这个机会,我终于出来了.我买了一大束百合花, 打车到了她的家,她一看见我就哭了,我没有说话,她也没有说话,我们紧紧相拥,许久许久……<br>　　我问她为什么不找一名男生打电话叫我出来,她说,这种结果早晚都会发生,我们迟早要面对的……她问我,我们还能继续走下去吗?若不能,她不会怪我,也不会后悔从前一起走过的路.<br>　　我肯定地告诉她:”若我们自己都不相信我们的爱情是真的,那还有谁会相信?”<br>她握住了我的手:”无论发生什么, 我们都要紧握彼此的手,勇敢地走下去!”<br>　　她生日的那天,我又用上次的方法从家里跑出来.我给她买了一个最好的蛋糕.在她的生日蛋糕前,我许下了三个愿望:第一是希望她能做我的新娘,我会给她一个比正常人更浪漫的婚礼;第二是希望有一天我可以背她去海边放风筝;第三是希望有一天我可以背她去长城.<br>　　她听后趴到我怀里哭了,她说自己是残疾人,不能走,以后会拖累我的.<br>　　我也哭了,抱着她说:”我不怕的,你知道你为什么不会走路吗?因为你是天使,天使是不用脚走路的,将来会飞的!”<br>　　我回家后,家人知道我去见她了,不让我吃饭、不和我说话……我理解父母对儿子的爱,她也理解,她知道这件事情后,还为我父母讲了很多好话.<br>　　我们一同报了山东某大学,但怕被我父母发现(我哥哥在山东上大学),我们又一起报了蓝天学院.<br>　　我们近一个暑假没见面,但我们都深信我们的感情.后来听她说,她家人怕我靠不住,不让她等我,让她自己先去青岛上大学,她说,如果我都靠不住的话,那她这辈子不会再相信任何男生了.<br>　　我们一同来到了蓝天学院,大学比我们想象中的要大得多.每天上课的教室都不固定,有时还不在同一栋楼,我的自习室在五楼,她的在二楼,每天我都要从五楼下去接她,把她送到下一节课上课的教室,送到后,我再匆匆忙忙地赶回教室上课.<br>　　教学楼里人那么多,她自己走很不安全,她看到我太累了,多次要求自己走,我没有答应.说实话,真的很累,但让她自己去,会比我累好多倍,所以,我每天都背她,我以前体质不怎么好,现在身上都有肌肉了.所以,无论做任何事情,有苦终会有甜,上天是公平的!<br>　　她没有经济来源,我们就一起打扫卫生、捡饮料瓶、去食堂勤工俭学,再加上学校的一些资助,我们生活得很好.<br>　　我从小就是一个”少爷”,家境不错,一直过着”衣来伸手,饭来张口”的生活.现在为了　她,虽然每天都很忙也很辛苦,但我感觉真的很充实也很快乐.<br>　　我从小就喜欢电脑,电脑知识也还不错,于是不顾父亲的反对,我毅然报了软件工程,我之所以这样做是因为我要赚很多的钱,将来给她一个幸福的家,她从小受的苦太多了,所以我要尽可能地让她幸福.<br>　　大学毕业后我打算跟家人坦白,无论后果怎样,无论以后会发生什么事,我都不会对我们的感情质疑,我们这一路走来真的太辛苦了,也正是这种艰辛为我们的感情垫起了坚固的基石,使之不会被任何风雨摧倒,这些经历也是生活给我们颁发的最好的合格证.<br>　　如果有人问我为什么会这么做?我会告诉他:因为她只有三元钱的时候,花了一元钱给我买面包;因为我们曾一起抱头大哭大笑过;因为我们在最困难的时候一起啃馒头,却高兴得笑出眼泪……<br>　　她现在学习很好,因为我是他的动力;我也很努力,因为她同样是我的动力.无论以后发生什么,我们都会勇敢地面对每一个黎明和黄昏,坚强地度过每一个白天和黑夜,因为我们相信爱情可以让一切变得更加美好多彩,也可以使人更加自信和自强.<br>　　一路走来,我们用三首歌来诠释我们的爱情历程:&lt;童话&gt;、&lt;勇气&gt;和&lt;约定&gt;.我不知道下一首歌会是什么,但我能肯定的是我会一路陪她到永远!!!　　　　　　　　　　　　　　　　　　　　　　　　　　　　　 </p>
<p>王殊勋摘自蓝天官网　</p>
]]></content>
  </entry>
  <entry>
    <title>已经安装erlang20.0 依然提示 erlang &amp;gt;= 19.3 is needed by rabbitmq-server-3.7.10-1.el7.noarch</title>
    <url>/2018/07/15/1618/</url>
    <content><![CDATA[<p>已经安装erlang20.0 依然提示:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">erlang</span> &gt;= <span class="number">19</span>.<span class="number">3</span> is needed by rabbitmq-server-<span class="number">3</span>.<span class="number">7</span>.<span class="number">10</span>-<span class="number">1</span>.el<span class="number">7</span>.noarch</span><br><span class="line"><span class="attribute">After</span> googling a lot, finally below command worked for me!</span><br></pre></td></tr></table></figure>

<p>解决办法:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rpm</span> -ivh --nodeps rabbitmq-server-<span class="number">3</span>.<span class="number">7</span>.<span class="number">10</span>-<span class="number">1</span>.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>问题解决.</p>
]]></content>
  </entry>
  <entry>
    <title>隐藏全部nginx版本信息</title>
    <url>/2013/04/20/1620/</url>
    <content><![CDATA[<p>修改两个地方:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vim</span> nginx.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>

<p>在http区域添加:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br></pre></td></tr></table></figure>

<p>2、修改nginx目录中conf目录下的fastcgi.conf:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fastcgi_param</span>  SERVER_SOFTWARE    nginx/$nginx_version;</span><br><span class="line"><span class="attribute">fastcgi_param</span>  SERVER_SOFTWARE    nginx</span><br></pre></td></tr></table></figure>

<p>可以在编译安装前更改源码,这样信息改的更彻底:</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">vim ngx_http_header_filter_module.<span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p>编辑48、49两行,改成自己需要的内容:</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">static char ngx_http_server_string[] = <span class="string">&quot;Server: nginx&quot;</span> <span class="keyword">CRLF</span><span class="comment">;</span></span><br><span class="line"><span class="number">49</span> static char ngx_http_server_full_string[] = <span class="string">&quot;Server: &quot;</span> NGINX_VER <span class="keyword">CRLF</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>例如:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> ngx_http_server_string[] = <span class="string">&quot;Server: zws&quot;</span> CRLF;</span><br><span class="line"><span class="number">49</span> <span class="keyword">static</span> <span class="keyword">char</span> ngx_http_server_full_string[] = <span class="string">&quot;Server: zws 1.0″  CRLF;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>以指定用户身份运行程序</title>
    <url>/2011/02/01/1619/</url>
    <content><![CDATA[<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">su - 用户名 -<span class="keyword">c</span> <span class="string">&quot;pg_ctl start -D /var/lib/pgsql/data&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>用DNS+GeoIP+Nginx+Varnish做世界级的CDN</title>
    <url>/2012/05/08/1621/</url>
    <content><![CDATA[<p>如何用BIND, GeoIP, Nginx, Varnish来创建你自己的高效的CDN网络?<br>CDN,意思是Content Distrubtion Network,意思是内容分发网络,简单的说,就是全地域范围内的负载均衡,全地域的概念可以是全国,也可以是全世界.由统一的DNS服务器进行地址转发,选择离用户最近的地区服务器进行负载均衡.本质上是从一个机房内的负载均衡扩展到了全世界范围内的负载均衡.同时可以将本地化的内容,由当地的服务器实现.做浏览器的地区自动选择.<br>比如在中国,被人为划分成两大区域,北方是网通,南方是电信.这两个网络之间互访是比较慢的.作为大型网站,一种解决办法是将全部服务器架设在双线或三线ISP处,由ISP来提供路由上的选择.这样做,线路的成本会比较高.另一种办法就是将服务器架设在两边,南方一台,北方一台,然后由服务器自己选择,如果IP在电信,就转发请求到南方的服务器,如果是网通就转发到北方的服务器.<br>再扩大范围,可以将美国来的请求交由美国服务器处理,这样也缩短了用户在路由上的等待时间.这就是内容分发网络.<br>而作为这个网络上的所有节点,都可以当成虚拟服务器来看待.至于在各地的服务器如何做负载均衡,可以由各节点之间完成.<br>准备工作如下:你需要下载如下软件以实现上述功能:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Nginx,</span>BIND,GeoIP,Varnish</span><br></pre></td></tr></table></figure>

<p>接下来是编译和安装bind9和geoip:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf bind-9.2.4.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf GeoIP-1.4.6.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> GeoIP-1.4.6</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure –prefix=/usr/<span class="built_in">local</span>/geoip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> patch -p0 &lt; bind-9.2.4-geodns-patch/patch.diff //给bind9打补丁,让bind9直接支持geoip库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> bind-9.2.4</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> CFLAGS=<span class="string">&quot;-I/usr/local/geoip/include&quot;</span> LDFLAGS=<span class="string">&quot;-L/usr/local/geoip/lib -lGeoIP&quot;</span> ./configure –prefix=/usr/<span class="built_in">local</span>/<span class="built_in">bind</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br></pre></td></tr></table></figure>

<p>装好bind后我们来制作named.conf:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">view</span> &quot;us&quot; &#123;</span><br><span class="line">    // 匹配北美的客户端 US &amp; Canada</span><br><span class="line">    match-clients &#123; country_US; country_CA; &#125;;</span><br><span class="line">    // Provide <span class="keyword">recursive</span> service <span class="keyword">to</span> <span class="type">internal</span> clients <span class="keyword">only</span>.</span><br><span class="line">    recursion <span class="keyword">no</span>;</span><br><span class="line">    <span class="type">zone</span> &quot;cdn.xianglei.com&quot; &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;pri/xianglei-us.db&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">zone</span> &quot;.&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> hint;</span><br><span class="line">        file &quot;named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">view</span> &quot;latin&quot; &#123;</span><br><span class="line">    // 匹配到南美国家</span><br><span class="line">    match-clients &#123; country_AR; country_CL; country_BR; &#125;;</span><br><span class="line">    recursion <span class="keyword">no</span>;</span><br><span class="line">    <span class="type">zone</span> &quot;cdn.xianglei.com&quot; &#123;</span><br><span class="line">        <span class="keyword">type</span> master;</span><br><span class="line">        file &quot;pri/xianglei-latin.db&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">zone</span> &quot;.&quot; <span class="keyword">IN</span> &#123;</span><br><span class="line">        <span class="keyword">type</span> hint;</span><br><span class="line">        file &quot;named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>照此办理,你也可以匹配到欧洲,非洲等等,然后来开始制作nginx和varnish.<br>注意,以上内容是你要在主节点服务器上做的,主节点服务器只负责对DNS请求进行转发.<br>约定一下,我们将Bind服务器叫做动态节点服务器,Nginx+Varnish叫做边界服务器.<br>以下内容是副节点服务器需要做的,也就是实际在某个地区放置的服务器.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ .<span class="regexp">/configure –prefix=/u</span>sr<span class="regexp">/local/</span>nginx –with-http_realip_module</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p>并配置Nginx:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    sendfile on;</span><br><span class="line">    keepalive_timeout <span class="number">65</span>;</span><br><span class="line">    upstream dynamic_node &#123;</span><br><span class="line">    server <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>:<span class="number">80</span>; $ <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span> 是主DNS节点的IP地址</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8080</span>;</span><br><span class="line">    server_name cdn.xianglei.net;</span><br><span class="line">    location ~* .(gif|<span class="type">jpg</span>|<span class="type">jpeg</span>|<span class="type">png</span>|<span class="type">wmv</span>|<span class="type">avi</span>|<span class="type">mpg</span>|<span class="type">mpeg</span>|<span class="type">mp4</span>|<span class="type">htm</span>|<span class="type">html</span>|<span class="type">js</span>|<span class="type">css</span>|<span class="type">mp3</span>|<span class="type">swf</span>|<span class="type">ico</span>|<span class="type">flv</span>)$ &#123;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_pass http://dynamic_node;</span><br><span class="line">    proxy_store /var/www/cache$uri;</span><br><span class="line">    proxy_store_access user:rw group:rw all:r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上我们用nginx只对静态文件进行缓存,将静态文件缓存在/var/www/cache文件夹下,如果你没有的话,需要创建这个文件夹.并且nginx监听的是8080端口,这是因为,我们需要用varnish来监听80端口进行动态文件的转发.这里实际上是用nginx做了一个静态文件的反向代理和缓存的服务器,而真正让用户能够看到网页和动态文件的反向代理是varnish,而静态和动态文件的分开存放,能将效率提升不少.<br>最后我们来配置varnish服务.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf varnish-2.1.2.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./configure –prefix=/usr/<span class="built_in">local</span>/varnish</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make install</span></span><br></pre></td></tr></table></figure>

<p>然后是varnish的选项:</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">backend</span> <span class="string">default</span> &#123;</span><br><span class="line">    .<span class="string">host</span> = <span class="string">&quot;127.0.0.1″;</span></span><br><span class="line"><span class="string">    .port = &quot;</span><span class="string">8080</span>″;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">sub</span> <span class="string">vcl_recv</span> &#123;</span><br><span class="line">    <span class="string">if</span> (<span class="string">req</span>.<span class="string">url</span> ~ <span class="string">&quot;.(js|css|jpg|jpeg|png|gif|gz|tgz|bz2|tbz|mp3|ogg|swf)$&quot;</span>) &#123;</span><br><span class="line">        <span class="string">return</span> (<span class="string">lookup</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">sub</span> <span class="string">vcl_fetch</span> &#123;</span><br><span class="line">    <span class="string">if</span> (<span class="string">req</span>.<span class="string">url</span> ~ <span class="string">&quot;.(js|css|jpg|jpeg|png|gif|gz|tgz|bz2|tbz|mp3|ogg|swf)$&quot;</span>) &#123;</span><br><span class="line">        <span class="string">unset</span> <span class="string">obj</span>.<span class="string">http</span>.<span class="built_in">set-cookie;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他的配置内容可参看varnish的配置文章.</p>
<p>总结:</p>
<p>这样做的好处在于:<br>1.从根源上解决了DNS在轮询上的不确定性,能够做到在DNS上的快速响应.也避免了过去用Nginx+GeoIP时的负载高的问题.毕竟DNS的计算要比Nginx小多了.<br>2.降低大网站的服务器负载压力和运营成本,毕竟F5BigIP和双线路的价格和服务费都太高了.<br>3.易扩展性强,如某地区负载压力大,只需在该地区增加边界服务器组的web server即可完成,无需考虑跳转问题.<br>其他优点我再想想.</p>
]]></content>
  </entry>
  <entry>
    <title>用extundelete恢复ext4文件系统中被误删除的文件</title>
    <url>/2012/03/09/1622/</url>
    <content><![CDATA[<p>到<a href="http://extundelete.sourceforge.net/">http://extundelete.sourceforge.net/</a> 下载extundelete.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">tar -xjf extundelete-<span class="number">0.2</span>.<span class="number">0</span>.tar.bz2</span><br><span class="line"><span class="keyword">cd</span> extundelete-<span class="number">0.2</span>.<span class="number">0</span></span><br><span class="line">./configure</span><br><span class="line"><span class="keyword">make</span></span><br><span class="line"><span class="keyword">make</span> install</span><br></pre></td></tr></table></figure>

<p>恢复 <code>/dev/sda3</code>里一个被误删除的文件</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">extundelete <span class="regexp">/dev/</span>sda3 --restore-<span class="keyword">file</span> <span class="regexp">/an/im</span>portant/<span class="keyword">file</span></span><br></pre></td></tr></table></figure>

<p>恢复 <code>/dev/sda3</code>里一个被误删除的文件夹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">extundelete <span class="regexp">/dev/</span>sda3 --restore-directory <span class="regexp">/an/im</span>portant</span><br></pre></td></tr></table></figure>

<p>恢复 <code>/dev/sda3</code>里所有被删除的东西</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">extundelete</span> /dev/sda<span class="number">3</span> --restore-<span class="literal">all</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>用fdisk创建分区的方法</title>
    <url>/2011/07/17/1623/</url>
    <content><![CDATA[<p>linux的服务器一般都是没有图形界面的,<br>所以如果我们添加了新硬盘需要分区就只能使用fdisk在文本界面操作了.<br>这篇文章就是演示一个完整的分区过程,下面开始:</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">$fdisk /dev/hdb <span class="comment">//准备为 hdb 建立分区</span></span><br><span class="line"></span><br><span class="line">The number <span class="keyword">of</span> cylinders <span class="keyword">for</span> this disk <span class="keyword">is</span> <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">20805</span>.</span><br><span class="line">There <span class="keyword">is</span> nothing wrong <span class="keyword">with</span> that, but this <span class="keyword">is</span> larger than <span class="number">1024</span>,</span><br><span class="line"><span class="keyword">and</span> could <span class="keyword">in</span> certain setups cause problems <span class="keyword">with</span>:</span><br><span class="line"><span class="number">1</span>) software that runs at boot time (e.g., <span class="keyword">old</span> versions <span class="keyword">of</span> LILO)</span><br><span class="line"><span class="number">2</span>) booting <span class="keyword">and</span> partitioning software <span class="keyword">from</span> other OSs</span><br><span class="line">(e.g., DOS FDISK, OS/<span class="number">2</span> FDISK)</span><br><span class="line">Command (m <span class="keyword">for</span> help): n <span class="comment">//键入 n 表示要建立分区</span></span><br><span class="line">Command action</span><br><span class="line">e extended</span><br><span class="line">p primary partition (<span class="number">1</span>-<span class="number">4</span>)</span><br><span class="line">p <span class="comment">//键入 p 表示建立主要分区</span></span><br><span class="line">Partition number (<span class="number">1</span>-<span class="number">4</span>): <span class="number">1</span> <span class="comment">//键入 1 为此主要分区代号</span></span><br><span class="line">First cylinder (<span class="number">1</span>-<span class="number">20805</span>, <span class="keyword">default</span> <span class="number">1</span>): <span class="comment">//开始磁柱值,按下 enter 即可</span></span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> value <span class="number">1</span></span><br><span class="line">Last cylinder <span class="keyword">or</span> +size <span class="keyword">or</span> +sizeM <span class="keyword">or</span> +sizeK (<span class="number">1</span>-<span class="number">20805</span>, <span class="keyword">default</span> <span class="number">20805</span>): <span class="comment">//结束磁柱值,按下 enter 即可</span></span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> value <span class="number">20805</span></span><br><span class="line">Command (m <span class="keyword">for</span> help): w <span class="comment">//键入 w 表示确定执行刚才设定</span></span><br><span class="line">The partition table <span class="keyword">has</span> been altered!</span><br><span class="line">Calling ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br><span class="line">[root@node1 yum.repos.d]$ partprobe <span class="comment">//使刚才的 partition table 变更生效</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>用linux脚本自动发送和收取邮件</title>
    <url>/2019/02/01/1624/</url>
    <content><![CDATA[<p>1.命令行模式下的发送邮件</p>
<p>1.1 安装sendemail</p>
<p>在Ubuntu下可以用新立得软件包管理器搜索安装,或者在终端运行:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install sendemail</span><br></pre></td></tr></table></figure>

<p>建议在安装前先安装另外两个包:libio-socket-ssl-perl, libnet-ssleay-perl.</p>
<p>2.2 使用sendemail和举例</p>
<p>如果你想用你的邮箱<a href="mailto:&#99;&#104;&#114;&#x69;&#115;&#116;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#109;">&#99;&#104;&#114;&#x69;&#115;&#116;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#109;</a>发送邮件到<a href="mailto:&#98;&#x75;&#100;&#100;&#x68;&#x61;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#109;">&#98;&#x75;&#100;&#100;&#x68;&#x61;&#64;&#x71;&#113;&#x2e;&#x63;&#111;&#109;</a>,在终端输入:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">sendemail -s smtp<span class="selector-class">.gmail</span><span class="selector-class">.com</span> -f christ@gmail<span class="selector-class">.com</span> -t buddha@qq<span class="selector-class">.com</span> -u hello -m <span class="string">&quot;A hello from Christans to buddhists via gmail&quot;</span> -xu christ -xp password -o tls=<span class="attribute">auto</span></span><br></pre></td></tr></table></figure>

<p>解释:</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">s smtp.gmail.com 指定服务器域名,邮件发送一般通过SMTP协议实现,其域名一般为smtp.***.com,比如qq邮箱的服务器为smtp.qq.com,<span class="number">163</span>邮箱则为smtp.<span class="number">163</span>.com</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">f christ<span class="variable">@gmail</span>.com指定发送邮箱地址</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">t buddha<span class="variable">@qq</span>.com 指定目的邮箱地址</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">u hello 邮件标题</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">m <span class="string">&quot;A hello from Christans to buddhists via gmail&quot;</span> 邮件正文,较长的正文可以先存在文本文件中,不妨命名为mail.txt,然后换用-o message-file=mail.txt</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">xu christ 指定邮箱用户名,即邮箱地址@之前的部分</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">xp password 指定发送邮箱的密码</span></span><br><span class="line"><span class="ruby"></span>-<span class="ruby">o tls=auto 加密方式在none, tls, ssl中自动选择</span></span><br></pre></td></tr></table></figure>

<p>如果想在邮件中粘帖附件:</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">-a attachme<span class="symbol">nt_file1</span> attachme<span class="symbol">nt_file2</span> attachme<span class="symbol">nt_file3</span></span><br></pre></td></tr></table></figure>

<p>2.命令行模式下的收取邮件</p>
<p>通过邮件客户端收取email邮件主要有两种方式:POP3和IMAP,邮件客户端通过POP3下载服务器上的邮件,但是IMAP默认只下载邮件的主题.基于命令行方式自动化的意义,采用POP3更合适.</p>
<p>2.1 安装getmail4</p>
<p>在Ubuntu下可以用新立得软件包管理器搜索安装,或者:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install getmail4</span><br></pre></td></tr></table></figure>

<p>2.2 配置getmail4和简单举例</p>
<p>安装完毕后在终端执行一下命令:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> .getmail</span><br><span class="line"><span class="keyword">cd</span> .getmail</span><br><span class="line"><span class="built_in">mkdir</span> maildir</span><br><span class="line"><span class="keyword">cd</span> maildir</span><br><span class="line"><span class="built_in">mkdir</span> <span class="keyword">new</span> cur tmp</span><br></pre></td></tr></table></figure>

<p>后在 .getmail/下建立一个配置文件,如果这个配置文件是为收取<a href="mailto:&#98;&#x75;&#100;&#x64;&#104;&#97;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#109;">&#98;&#x75;&#100;&#x64;&#104;&#97;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#109;</a>这个邮箱配置的,不妨命名为getmailrc.buddha,然后编辑该文件,#后是注释:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This is a configuration file for buddha@qq.com</span></span><br><span class="line"><span class="section">[retriever]</span></span><br><span class="line"><span class="attr">type</span> = SimplePOP3Retriever</span><br><span class="line"><span class="attr">server</span> = pop.qq.com  <span class="comment">#如果是gmail则改为pop.gmail.com</span></span><br><span class="line"><span class="attr">username</span> = budda</span><br><span class="line"><span class="attr">password</span> = password</span><br><span class="line"><span class="section">[destination]</span></span><br><span class="line"><span class="attr">type</span> = Maildir</span><br><span class="line"><span class="attr">path</span> = ~/.getmail/maildir/  <span class="comment">#就是刚才在~/.getmail/建立的目录,注意该目录下一定要有new,cur,tmp这三个子目录</span></span><br><span class="line"><span class="section">[options]</span></span><br><span class="line"><span class="attr">read_all</span> = <span class="literal">False</span> <span class="comment">#只接受以前没有收取的邮件,如果改成True则收取邮箱中所有邮件</span></span><br><span class="line"><span class="attr">delete</span> = <span class="literal">False</span> <span class="comment">#下载邮件后不在服务器上删除该邮件,如果改成True则删除</span></span><br><span class="line"><span class="comment"># configuration file ends here</span></span><br></pre></td></tr></table></figure>

<p>编辑好了之后在终端运行:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">getmail <span class="attribute">--rcfile</span>=getmailrc.buddha</span><br></pre></td></tr></table></figure>

<p>getmail会自动收取邮件,下载的邮件会保存在 <code>~/.getmail/maildir/new/</code>下.</p>
<p>2.3 用munpack从邮件中抽取附件</p>
<p>邮件正文和附件是作为一个整体文件被保存的,附件以MIME格式附着在整体文件最后,必须用程序抽取出来.<br>在Ubuntu下可以用新立得软件包管理器搜索安装mpack,或者:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install mpack</span><br></pre></td></tr></table></figure>

<p>在终端中运行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">munpack mail_file</span></span><br></pre></td></tr></table></figure>

<p>程序会自动识别附件并抽取出来.</p>
]]></content>
  </entry>
  <entry>
    <title>用winrar做服务器定时备份</title>
    <url>/2014/05/09/1625/</url>
    <content><![CDATA[<p>我按照网上的这个方法创见了一个WINRAR备份,直接双击可以备份,但我把他拖到计划任务中,在指定的时间不会自动备份,只是弹出WINRAR界面,怎么回事?”保存档案文件名”和”保存选定文件名””立即执行”及”在桌面创建快捷方式”前的复选框都选中了,高手指教</p>
<p>一、制作配置文件<br>　　启动”资源管理器”,进入C:\Work文件夹.选中并右击所有文件,选择”WinRAR→添加到压缩包”,打开”压缩包名称和参数”窗口,单击”备份”标签,勾选”按掩码产生压缩文件名”复选框,后面文本框中的yyyymmddhhmmss分别代表年,月,日,时, 分,秒,可以根据需要选择,比如我们把保存的文件名定为.年,月,日,时,把它改成yyyy-mm-dd-hh即可.中间- 可以不加.加了只是看着方便..接着单击”常规”标签.并单击”浏览”按钮,把文件保存到d:\bak文件夹下.接着,单击”配置”按钮,选择”保存当前配置为新配置”,在”配置名称”中输入备份方案名,如”Work文件备份”,同时选中”保存档案文件名”和”保存选定文件名””立即执行”及”在桌面创建快捷方式”前的复选框.单击”确定”按钮返回”保存档案文件名和参数”窗口,按下”确定”按钮备份文件.</p>
<p>二、定时备份<br>　　点击”开始→设置→控制面板→任务计划”.接着,把桌面上的”Work文件备份”快捷方式拖放到”任务计划”窗口.然后双击”Work文件备份”图标,设置其属性.<br>　　单击”日程安排”标签,单击”任务计划”下拉列表框,从中选择”每天”,而”开始时间”设置为自己的时间.再单击”设置”标签,取消选中”电源管理”下的”如果计算机使用电池来运行,不要启动任务”确定后输入计算机用户的密码,记住如果这个用户没有密码,一定要在用户管理中设一个密码,否则不能自动备份.通过上述设置后,到了你设置的时间,电脑就会自动备份C:\Work下的所有所有文件到d:\bak文件夹下,且会按备份的日期和时间作为文件名,如work20081111141726.rar、work20081110151826.rar等.<br>　　小提示<br>　　1.如果想在电脑空闲时备份数据,可单击”任务计划”下拉列表框,从中选择”空闲时”,在”当计算机空闲时间超过xx分钟”处将时间改为10分钟.完成以上设置后,按”确定”按钮,再在打开的窗口中输入系统管理员密码,退出设置窗口.这样,当10分钟后没有操作,电脑会自动备份数据.<br>　　2.系统启动时自动备份:单击”任务计划”下拉列表框,从中选择”在系统启动时”,系统在启动时将会自动备份数据.<br>　　3.备份完成后就关机:如果你是6点下班,那可以在制作WinRAR配置文件时,单击”高级”标签,然后选中”完成操作后关闭计算机电源”复选框.然后设置任务计划在6点钟备份数据,这样备份完数据后,电脑会自动关闭. </p>
]]></content>
  </entry>
  <entry>
    <title>优化Linux下的内核TCP参数来提高服务器负载能力</title>
    <url>/2012/08/29/1627/</url>
    <content><![CDATA[<p>提高服务器的负载能力,是一个永恒的话题.在一台服务器CPU和内存资源额定有限的情况下,最大的压榨服务器的性能,是最终的目的.要提高Linux系统下的负载能力,可以先启用Apache的Worker模式,来提高单位时间内的并发量.但是即使这么做了,当网站发展起来之后,连接数过多的问题就会日益明显.在节省成本的情况下,可以考虑修改Linux的内核TCP/IP参数,来最大的压榨服务器的性能.当然,如果通过修改内核参数也无法解决的负载问题,也只能考虑升级服务器了,这是硬件所限,没有办法的事.</p>
<p>Linux系统下,TCP/IP连接断开后,会以TIME_WAIT状态保留一定的时间,然后才会释放端口.当并发请求过多的时候,就会产生大量的TIME_WAIT状态的连接,无法及时断开的话,会占用大量的端口资源和服务器资源(因为关闭后进程才会退出).这个时候我们可以考虑优化TCP/IP的内核参数,来及时将TIME_WAIT状态的端口清理掉.</p>
<p>本文介绍的方法只对拥有大量TIME_WAIT状态的连接导致系统资源消耗有效,不是这个原因的情况下,效果可能不明显.那么,到哪儿去查TIME_WAIT状态的连接呢?那就是使用<code>&lt;strong&gt;</code>netstat<code>&lt;/strong&gt;</code>命令.我们可以输入一个复核命令,去查看当前TCP/IP连接的状态和对应的个数:</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line"><span class="built_in">$netstat</span> -n | awk &#x27;/<span class="symbol">^tcp</span>/ &#123;++<span class="keyword">S</span>[<span class="built_in">$NF</span>]&#125; END &#123;<span class="keyword">for</span>(a in <span class="keyword">S</span>) <span class="keyword">print</span> a, <span class="keyword">S</span>[a]&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>这个命令会显示出类似下面的结果:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">LAST_ACK</span> <span class="number">14</span></span><br><span class="line"><span class="attribute">SYN_RECV</span> <span class="number">348</span></span><br><span class="line"><span class="attribute">ESTABLISHED</span> <span class="number">70</span></span><br><span class="line"><span class="attribute">FIN_WAIT1</span> <span class="number">229</span></span><br><span class="line"><span class="attribute">FIN_WAIT2</span> <span class="number">30</span></span><br><span class="line"><span class="attribute">CLOSING</span> <span class="number">33</span></span><br><span class="line"><span class="attribute">TIME_WAIT</span> <span class="number">18122</span></span><br></pre></td></tr></table></figure>

<p>我们只用关心TIME_WAIT的个数,在这里可以看到,有18000多个TIME_WAIT,这样就占用了18000多个端口.要知道端口的数量只有65535个,占用一个少一个,会严重的影响到后继的新连接.这种情况下,我们就有必要调整下Linux的TCP/IP内核参数,让系统更快的释放TIME_WAIT连接.</p>
<p>我们用vim打开配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vim</span> <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>然后,在这个文件中,加入下面的几行内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syncookies = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_recycle = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout = <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>最后输入下面的命令,让内核参数生效:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$<span class="regexp">/sbin/</span>sysctl -p</span><br></pre></td></tr></table></figure>

<p>简单的说明下,上面的参数的含义:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syncookies = <span class="number">1</span>  #表示开启SYN Cookies.当出现SYN等待队列溢出时,启用cookies来处理,可防范少量SYN攻击,默认为<span class="number">0</span>,表示关闭;</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span>    #表示开启重用.允许将TIME-WAIT sockets重新用于新的TCP连接,默认为<span class="number">0</span>,表示关闭;</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_recycle = <span class="number">1</span>  #表示开启TCP连接中TIME-WAIT sockets的快速回收,默认为<span class="number">0</span>,表示关闭;</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout     #修改系統默认的 TIMEOUT 时间.</span><br></pre></td></tr></table></figure>

<p>在经过这样的调整之后,除了会进一步提升服务器的负载能力之外,还能够防御一定程度的DDoS、CC和SYN攻击,是个一举两得的做法.</p>
<p>此外,如果你的连接数本身就很多,我们可以再优化一下TCP/IP的可使用端口范围,进一步提升服务器的并发能力.依然是往上面的参数文件中,加入下面这些配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_keepalive_time = <span class="number">1200</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_local_port_range = <span class="number">10000</span> <span class="number">65000</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">8192</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_tw_buckets = <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>这几个参数,建议只在流量非常大的服务器上开启,会有显著的效果.一般的流量小的服务器上,没有必要去设置这几个参数.这几个参数的含义如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_keepalive_time = <span class="number">1200</span>         #表示当keepalive起用的时候,TCP发送keepalive消息的频度.缺省是<span class="number">2</span>小时,改为<span class="number">20</span>分钟.</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_local_port_range = <span class="number">10000</span> <span class="number">65000</span> #表示用于向外连接的端口范围.缺省情况下很小:<span class="number">32768</span>到<span class="number">61000</span>,改为<span class="number">10000</span>到<span class="number">65000</span>.(注意:这里不要将最低值设的太低,否则可能会占用掉正常的端口!)</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">8192</span>        #表示SYN队列的长度,默认为<span class="number">1024</span>,加大队列长度为<span class="number">8192</span>,可以容纳更多等待连接的网络连接数.</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_tw_buckets = <span class="number">5000</span>         #表示系统同时保持TIME_WAIT的最大数量,如果超过这个数字,TIME_WAIT将立刻被清除并打印警告信息.默 认为<span class="number">180000</span>,改为<span class="number">5000</span>.对于Apache、Nginx等服务器,上几行的参数可以很好地减少TIME_WAIT套接字数量,但是对于 Squid,效果却不大.此项参数可以控制TIME_WAIT的最大数量,避免Squid服务器被大量的TIME_WAIT拖死.</span><br></pre></td></tr></table></figure>

<p>经过这样的配置之后,你的服务器的TCP/IP并发能力又会上一个新台阶.</p>
]]></content>
  </entry>
  <entry>
    <title>优化Linux的内核参数来提高服务器并发处理能力</title>
    <url>/2012/05/28/1626/</url>
    <content><![CDATA[<p>在服务器硬件资源额定有限的情况下,最大的压榨服务器的性能,提高服务器的并发处理能力,是很多运维技术人员思考的问题.要提高Linux系统下的负载能力,可以使用Nginx等原生并发处理能力就很强的Web服务器,如果使用Apache的可以启用其Worker模式,来提高其并发处理能力.除此之外,在考虑节省成本的情况下,可以修改Linux的内核相关TCP参数,来最大的提高服务器性能.当然,最基础的提高负载问题,还是升级服务器硬件了,这是最根本的.<br>Linux系统下,TCP连接断开后,会以TIME_WAIT状态保留一定的时间,然后才会释放端口.当并发请求过多的时候,就会产生大量的TIME_WAIT状态的连接,无法及时断开的话,会占用大量的端口资源和服务器资源.这个时候我们可以优化TCP的内核参数,来及时将TIME_WAIT状态的端口清理掉.<br>本文介绍的方法只对拥有大量TIME_WAIT状态的连接导致系统资源消耗有效,如果不是这种情况下,效果可能不明显.可以使用netstat命令去查TIME_WAIT状态的连接状态,输入下面的组合命令,查看当前TCP连接的状态和对应的连接数量:</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">$ netstat -n | awk &#x27;/<span class="symbol">^tcp</span>/ &#123;++<span class="keyword">S</span>[<span class="built_in">$NF</span>]&#125; END &#123;<span class="keyword">for</span>(a in <span class="keyword">S</span>) <span class="keyword">print</span> a, <span class="keyword">S</span>[a]&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>这个命令会输出类似下面的结果:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">LAST_ACK</span> <span class="number">16</span></span><br><span class="line"><span class="attribute">SYN_RECV</span> <span class="number">348</span></span><br><span class="line"><span class="attribute">ESTABLISHED</span> <span class="number">70</span></span><br><span class="line"><span class="attribute">FIN_WAIT1</span> <span class="number">229</span></span><br><span class="line"><span class="attribute">FIN_WAIT2</span> <span class="number">30</span></span><br><span class="line"><span class="attribute">CLOSING</span> <span class="number">33</span></span><br><span class="line"><span class="attribute">TIME_WAIT</span> <span class="number">18098</span></span><br></pre></td></tr></table></figure>

<p>我们只用关心TIME_WAIT的个数,在这里可以看到,有18000多个TIME_WAIT,这样就占用了18000多个端口.要知道端口的数量只有65535个,占用一个少一个,会严重的影响到后继的新连接.这种情况下,我们就有必要调整下Linux的TCP内核参数,让系统更快的释放TIME_WAIT连接.<br>用vim打开配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vim <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>在这个文件中,加入下面的几行内容:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syncookies = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_recycle = <span class="number">1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout = <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>输入下面的命令,让内核参数生效:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>sysctl -p</span><br></pre></td></tr></table></figure>

<p>简单的说明上面的参数的含义:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syncookies = <span class="number">1</span></span><br><span class="line"><span class="comment">#表示开启SYN Cookies.当出现SYN等待队列溢出时,启用cookies来处理,可防范少量SYN攻击,默认为0,表示关闭;</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span></span><br><span class="line"><span class="comment">#表示开启重用.允许将TIME-WAIT sockets重新用于新的TCP连接,默认为0,表示关闭;</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_recycle = <span class="number">1</span></span><br><span class="line"><span class="comment">#表示开启TCP连接中TIME-WAIT sockets的快速回收,默认为0,表示关闭;</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout</span><br><span class="line"><span class="comment">#修改系統默认的 TIMEOUT 时间.</span></span><br></pre></td></tr></table></figure>

<p>在经过这样的调整之后,除了会进一步提升服务器的负载能力之外,还能够防御小流量程度的DoS、CC和SYN攻击.<br>此外,如果你的连接数本身就很多,我们可以再优化一下TCP的可使用端口范围,进一步提升服务器的并发能力.依然是往上面的参数文件中,加入下面这些配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_keepalive_time = <span class="number">1200</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_local_port_range = <span class="number">10000</span> <span class="number">65000</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">8192</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_tw_buckets = <span class="number">5000</span></span><br><span class="line"><span class="comment">#这几个参数,建议只在流量非常大的服务器上开启,会有显著的效果.一般的流量小的服务器上,没有必要去设置这几个参数.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_keepalive_time = <span class="number">1200</span></span><br><span class="line"><span class="comment">#表示当keepalive起用的时候,TCP发送keepalive消息的频度.缺省是2小时,改为20分钟.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_local_port_range = <span class="number">10000</span> <span class="number">65000</span></span><br><span class="line"><span class="comment">#表示用于向外连接的端口范围.缺省情况下很小:32768到61000,改为10000到65000.(注意:这里不要将最低值设的太低,否则可能会占用掉正常的端口!)</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">8192</span></span><br><span class="line"><span class="comment">#表示SYN队列的长度,默认为1024,加大队列长度为8192,可以容纳更多等待连接的网络连接数.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_tw_buckets = <span class="number">6000</span></span><br><span class="line"><span class="comment">#表示系统同时保持TIME_WAIT的最大数量,如果超过这个数字,TIME_WAIT将立刻被清除并打印警告信息.默 认为180000,改为6000.对于Apache、Nginx等服务器,上几行的参数可以很好地减少TIME_WAIT套接字数量,但是对于 Squid,效果却不大.此项参数可以控制TIME_WAIT的最大数量,避免Squid服务器被大量的TIME_WAIT拖死.</span></span><br></pre></td></tr></table></figure>

<p>内核其他TCP参数说明:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_syn_backlog = <span class="number">65536</span></span><br><span class="line"><span class="comment">#记录的那些尚未收到客户端确认信息的连接请求的最大值.对于有128M内存的系统而言,缺省值是1024,小内存的系统则是128.</span></span><br><span class="line"><span class="attribute">net</span>.core.netdev_max_backlog = <span class="number">32768</span></span><br><span class="line"><span class="comment">#每个网络接口接收数据包的速率比内核处理这些包的速率快时,允许送到队列的数据包的最大数目.</span></span><br><span class="line"><span class="attribute">net</span>.core.somaxconn = <span class="number">32768</span></span><br><span class="line"><span class="comment">#web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128,而nginx定义的NGX_LISTEN_BACKLOG默认为511,所以有必要调整这个值.</span></span><br><span class="line"><span class="attribute">net</span>.core.wmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="attribute">net</span>.core.rmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="attribute">net</span>.core.rmem_max = <span class="number">16777216</span></span><br><span class="line"><span class="comment">#最大socket读buffer,可参考的优化值:873200</span></span><br><span class="line"><span class="attribute">net</span>.core.wmem_max = <span class="number">16777216</span></span><br><span class="line"><span class="comment">#最大socket写buffer,可参考的优化值:873200</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_timestsmps = <span class="number">0</span></span><br><span class="line"><span class="comment">#时间戳可以避免序列号的卷绕.一个1Gbps的链路肯定会遇到以前用过的序列号.时间戳能够让内核接受这种&quot;异常&quot;的数据包.这里需要将其关掉.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_synack_retries = <span class="number">2</span></span><br><span class="line"><span class="comment">#为了打开对端的连接,内核需要发送一个SYN并附带一个回应前面一个SYN的ACK.也就是所谓三次握手中的第二次握手.这个设置决定了内核放弃连接之前发送SYN+ACK包的数量.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_syn_retries = <span class="number">2</span></span><br><span class="line"><span class="comment">#在内核放弃建立连接之前发送SYN包的数量.</span></span><br><span class="line"><span class="comment">#net.ipv4.tcp_tw_len = 1</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_tw_reuse = <span class="number">1</span></span><br><span class="line"><span class="comment"># 开启重用.允许将TIME-WAIT sockets重新用于新的TCP连接.</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_wmem = <span class="number">8192</span> <span class="number">436600</span> <span class="number">873200</span></span><br><span class="line"><span class="comment"># TCP写buffer,可参考的优化值: 8192 436600 873200</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_rmem = <span class="number">32768</span> <span class="number">436600</span> <span class="number">873200</span></span><br><span class="line"><span class="comment"># TCP读buffer,可参考的优化值: 32768 436600 873200</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_mem = <span class="number">94500000</span> <span class="number">91500000</span> <span class="number">92700000</span></span><br><span class="line"><span class="comment"># 同样有3个值,意思是:</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_mem[<span class="number">0</span>]:低于此值,TCP没有内存压力.</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_mem[<span class="number">1</span>]:在此值下,进入内存压力阶段.</span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_mem[<span class="number">2</span>]:高于此值,TCP拒绝分配socket.</span><br><span class="line"><span class="comment">#上述内存单位是页,而不是字节.可参考的优化值是:786432 1048576 1572864</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_max_orphans = <span class="number">3276800</span></span><br><span class="line"><span class="comment">#系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上.</span></span><br><span class="line"><span class="comment">#如果超过这个数字,连接将即刻被复位并打印出警告信息.</span></span><br><span class="line"><span class="comment">#这个限制仅仅是为了防止简单的DoS攻击,不能过分依靠它或者人为地减小这个值,</span></span><br><span class="line"><span class="comment">#更应该增加这个值(如果增加了内存之后).</span></span><br><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.tcp_fin_timeout = <span class="number">30</span></span><br><span class="line"><span class="comment">#如果套接字由本端要求关闭,这个参数决定了它保持在FIN-WAIT-2状态的时间.对端可以出错并永远不关闭连接,甚至意外当机.缺省值是60秒.2.2 内核的通常值是180秒,你可以按这个设置,但要记住的是,即使你的机器是一个轻载的WEB服务器,也有因为大量的死套接字而内存溢出的风险,FIN- WAIT-2的危险性比FIN-WAIT-1要小,因为它最多只能吃掉1.5K内存,但是它们的生存期长些.</span></span><br></pre></td></tr></table></figure>

<p>经过这样的优化配置之后,你的服务器的TCP并发处理能力会显著提高.以上配置仅供参考,用于生产环境请根据自己的实际情况.</p>
]]></content>
  </entry>
  <entry>
    <title>远程执行命令</title>
    <url>/2014/12/26/1628/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh IP_B <span class="string">&quot;echo <span class="variable">$HOSTNAME</span>&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>在 OpenVZ 上安装 OpenVPN</title>
    <url>/2015/11/16/1629/</url>
    <content><![CDATA[<p>第一步:检查 OpenVPN 所需环境</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/dev/</span>net/tun</span><br></pre></td></tr></table></figure>

<p>如果返回信息为:File descriptor in bad state 说明正常.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">iptables</span> -t nat -A POSTROUTING -s <span class="number">10.8.0.0</span>/<span class="number">24</span> -o venet<span class="number">0</span> -j MASQUERADE</span><br></pre></td></tr></table></figure>

<p>如果返回信息为:iptables: Unknown error 4294967295 说明正常.</p>
<p>第二步:安装 OpenVPN</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ rpm -Uvh http:<span class="regexp">//</span>syslogserver.googlecode.com<span class="regexp">/files/</span>epel-release-<span class="number">5</span>-<span class="number">3</span>.noarch.rpm epel-release-<span class="number">5</span>-<span class="number">4</span>.noarch网盘</span><br><span class="line">$ yum install openvpn</span><br></pre></td></tr></table></figure>

<p>第三步:配置 OpenVPN</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ locate easy-rsa</span><br><span class="line">$ cp -R <span class="regexp">/usr/</span>share<span class="regexp">/openvpn/</span>easy-rsa <span class="regexp">/etc/</span>openvpn/</span><br><span class="line">$ cd <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span><span class="number">2.0</span></span><br><span class="line">$ vi vars</span><br></pre></td></tr></table></figure>

<p>Ecvps 上配置的时候,发现无法定位 easy-rsa ,即在使用 locate easy-rsa 时返回:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">locate: can not <span class="keyword">open</span> `/<span class="keyword">var</span>/lib/mlocate/mlocate.<span class="keyword">db</span>&#x27;: <span class="keyword">No</span> such <span class="keyword">file</span> or directory</span><br></pre></td></tr></table></figure>

<p>此时,只需要运行 updatedb 这个命令,即可解决问题!<br>修改如下内容,保存.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_COUNTRY</span>=<span class="string">&quot;CN&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_PROVINCE</span>=<span class="string">&quot;HN&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_CITY</span>=<span class="string">&quot;ZZ&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_ORG</span>=<span class="string">&quot;kangxiaowei.com&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_EMAIL</span>=<span class="string">&quot;sishixiong@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>生成证书.</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> ./clean-<span class="keyword">all</span></span><br><span class="line"><span class="symbol">$</span> source ./vars</span><br><span class="line"><span class="symbol">$</span> ./build-ca server</span><br></pre></td></tr></table></figure>

<p>全部回车.</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">$ ./build-key-<span class="keyword">server</span> <span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>全部回车 最后2个y.</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">$ ./<span class="keyword">build</span>-<span class="keyword">key</span> sishixiong</span><br></pre></td></tr></table></figure>

<p>全部回车 最后2个y.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> ./<span class="built_in">build-dh</span></span><br></pre></td></tr></table></figure>

<p>打包下载客户端所需文件.</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">$ tar -zcvf <span class="built_in">keys</span>.tar.gz <span class="built_in">keys</span></span><br></pre></td></tr></table></figure>

<p>把 keys 放到正确目录.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ mv keys <span class="regexp">/etc/</span>openvpn/</span><br></pre></td></tr></table></figure>

<p>新建 server.conf.</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>openvpn/server.conf</span><br></pre></td></tr></table></figure>

<p>放入如下内容.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">port <span class="number">1194</span> $监听端口</span><br><span class="line">proto udp $可以是 udp 或 tcp</span><br><span class="line">dev tun</span><br><span class="line">ca <span class="regexp">/etc/</span>openvpn<span class="regexp">/keys/</span>ca.crt</span><br><span class="line">cert <span class="regexp">/etc/</span>openvpn<span class="regexp">/keys/</span>server.crt</span><br><span class="line">key <span class="regexp">/etc/</span>openvpn<span class="regexp">/keys/</span>server.key</span><br><span class="line">dh <span class="regexp">/etc/</span>openvpn<span class="regexp">/keys/</span>dh1024.pem</span><br><span class="line">server <span class="number">10.8</span>.<span class="number">0.0</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="keyword">push</span> <span class="string">&quot;redirect-gateway def1&quot;</span></span><br><span class="line"><span class="keyword">push</span> <span class="string">&quot;dhcp-option DNS 8.8.8.8&quot;</span></span><br><span class="line"><span class="keyword">push</span> <span class="string">&quot;dhcp-option DNS 8.8.4.4&quot;</span></span><br><span class="line">client-to-client</span><br><span class="line">keepalive <span class="number">10</span> <span class="number">120</span></span><br><span class="line">comp-lzo</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">verb <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>启用 ipv4 转发.</p>
<p>输入:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>开始编辑,找到:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_forward = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>改成:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_forward = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>保存.<br>让它生效:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sysctl -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>如果此时出现错误.</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error: </span>&quot;Operation not permitted&quot; setting key &quot;net.ipv4.tcp_syncookies&quot;</span><br></pre></td></tr></table></figure>

<p>就编辑 sysctl.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ vi <span class="regexp">/etc/</span>sysctl.conf</span><br></pre></td></tr></table></figure>

<p>注释掉 net.ipv4.tcp_syncookies 那一行.<br>配置 iptables.</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">$ iptables -t nat -A POSTROUTING -s <span class="number">10.8</span>.<span class="number">0.0</span>/<span class="number">24</span> -j SNAT --to-<span class="keyword">source</span> 你的服务器IP地址</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables save</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d/iptables restart</span><br></pre></td></tr></table></figure>

<p>启动 OpenVPN.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> service openvpn <span class="built_in">start</span></span><br></pre></td></tr></table></figure>

<p>检查 OpenVPN.</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">$ netstat -anup <span class="string">| grep 1194</span></span><br></pre></td></tr></table></figure>

<p>OpenVPN 开机启动.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ chkconfig openvpn <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p>第四步:OpenVPN 客户端.</p>
<p>下载客户端 <a href="http://www.openvpn.net/index.php/open-source/downloads.html">http://www.openvpn.net/index.php/open-source/downloads.html</a><br>复制 ca.crt 和 sishixiong.crt 和 sishixiong.key 这三个文件,放到 <code>C:\Program Files\OpenVPN\config</code>.<br>新建 sishixiong.ovpn,输入以下内容:</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">client</span><br><span class="line"><span class="built_in">dev</span> tun</span><br><span class="line">proto udp</span><br><span class="line">remote 服务器IP地址 <span class="number">1194</span></span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">persist-<span class="built_in">key</span></span><br><span class="line">persist-tun</span><br><span class="line">ca ca.crt</span><br><span class="line">cert sishixiong.crt</span><br><span class="line"><span class="built_in">key</span> sishixiong.<span class="built_in">key</span></span><br><span class="line">ns-cert-<span class="built_in">type</span> server</span><br><span class="line">comp-lzo</span><br><span class="line">verb <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>搞定! 可以用:</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">service openvpn start | <span class="type">stop</span> | <span class="type">restart</span></span><br></pre></td></tr></table></figure>

<p>来控制了.</p>
]]></content>
  </entry>
  <entry>
    <title>在Centos上安裝Clamav</title>
    <url>/2017/11/02/1630/</url>
    <content><![CDATA[<p>以下為安裝步驟,大家可以參考一下玩玩看囉.</p>
<p>1.首先下載CentOS6.2</p>
<p>2.Centos安裝步驟就略過囉,若是您沒裝過Centos,用google找一下應該有滿多教學文件的</p>
<p>3.建議安裝完Centos後,將系統做一次更新(首次更新時間會久一點)</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum -y update</span></span><br></pre></td></tr></table></figure>

<p>4.切換到 <code>/etc/yum.repos.d/</code>目錄下</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/etc/yum</span>.repos.d/</span><br></pre></td></tr></table></figure>

<p>5.建立dag.repo檔案</p>
<p>因為 <code>/etc/yum.repos.d/</code>目錄下,是沒dag.repo這個檔案的,建立dag.repo這個檔案的目的,是要讓yum去找clamd這個套件,因為官方的套件資料預設是沒clamd這個套件.<br>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi dag.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#Dag RPM Repository Start</span></span><br><span class="line">[dag]</span><br><span class="line">name=Dag RPM Repository <span class="keyword">for</span> RHEL4</span><br><span class="line">baseurl=http:<span class="regexp">//</span>ftp.riken.jp<span class="regexp">/Linux/</span>dag<span class="regexp">/redhat/</span>el4<span class="regexp">/en/</span><span class="variable">$basearch</span><span class="regexp">/dag/</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line"><span class="comment">#Dag RPM Repository End</span></span><br></pre></td></tr></table></figure>

<p>6.建議再執行一次yum update,更新一下Repository(此次update會載入dag的套件清單)</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum -y update</span></span><br></pre></td></tr></table></figure>

<p>7.安裝clamd,終於可以透過yum來安裝clamd囉</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> clamd</span><br></pre></td></tr></table></figure>

<p>8.啟動clamd</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d/clamav start</span><br></pre></td></tr></table></figure>

<p>9.更新clamav病毒碼</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">freshclam</span></span><br></pre></td></tr></table></figure>

<p>10.測試clamd的病毒掃描功能</p>
<p>請於#符號下輸入下列命令,輸入完畢按下Enter即可:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">clamscan -r <span class="regexp">/tmp/</span></span><br><span class="line">clamscan <span class="regexp">/tmp/</span>zip.zip</span><br></pre></td></tr></table></figure>

<p>分享完畢!</p>
]]></content>
  </entry>
  <entry>
    <title>在Linux下创建与解压zip, tar, tar.gz和tar.bz2文件</title>
    <url>/2011/07/15/1632/</url>
    <content><![CDATA[<p>ZIP:</p>
<p>zip可能是目前使用得最多的文档压缩格式.它最大的优点就是在不同的操作系统平台,比如Linux, Windows以及Mac OS,上使用.缺点就是支持的压缩率不是很高,而tar.gz和tar.gz2在压缩率方面做得非常好.闲话少说,我们步入正题吧:<br>我们可以使用下列的命令压缩一个目录:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">zip</span> -r archive_name.<span class="built_in">zip</span> directory_to_compress</span><br></pre></td></tr></table></figure>

<p>下面是如果解压一个zip文档:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">unzip</span> archive_name.zip</span><br></pre></td></tr></table></figure>

<p>TAR:</p>
<p>Tar是在Linux中使用得非常广泛的文档打包格式.它的好处就是它只消耗非常少的CPU以及时间去打包文件,他仅仅只是一个打包工具,并不负责压缩.下面是如何打包一个目录:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -cvf archive_name.tar directory_to_compress</span><br></pre></td></tr></table></figure>

<p>如何解包:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -xvf archive_name.tar.gz</span><br></pre></td></tr></table></figure>

<p>上面这个解包命令将会将文档解开在当前目录下面.当然,你也可以用这个命令来捏住解包的路径:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -xvf archive_name.tar -C <span class="regexp">/tmp/</span>extract_here/</span><br></pre></td></tr></table></figure>

<p>TAR.GZ:</p>
<p>这种格式是我使用得最多的压缩格式.它在压缩时不会占用太多CPU的,而且可以得到一个非常理想的压缩率.使用下面这种格式去压缩一个目录:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">tar -zcvf archive_name<span class="selector-class">.tar</span><span class="selector-class">.gz</span> directory_to_compress</span><br></pre></td></tr></table></figure>

<p>解压缩:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf archive_name.tar.gz</span><br></pre></td></tr></table></figure>

<p>上面这个解包命令将会将文档解开在当前目录下面.当然,你也可以用这个命令来捏住解包的路径:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -zxvf archive_name.tar.gz -C <span class="regexp">/tmp/</span>extract_here/</span><br></pre></td></tr></table></figure>

<p>TAR.BZ2:</p>
<p>这种压缩格式是我们提到的所有方式中压缩率最好的.当然,这也就意味着,它比前面的方式要占用更多的CPU与时间.这个就是你如何使用tar.bz2进行压缩.</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">tar -<span class="keyword">jcvf </span>archive_name.tar.<span class="keyword">bz2 </span><span class="keyword">directory_to_compress</span></span><br></pre></td></tr></table></figure>

<p>上面这个解包命令将会将文档解开在当前目录下面.当然,你也可以用这个命令来捏住解包的路径:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -jxvf archive_name.tar.bz2 -C <span class="regexp">/tmp/</span>extract_here/</span><br></pre></td></tr></table></figure>

<p>数据压缩是非常有用的,尤其是对于备份来说.所以,你现在应该考虑在你的备份脚本中使用你在这里学到的压缩方式备份你基本的规则文件以减小你备份文件的大小.</p>
]]></content>
  </entry>
  <entry>
    <title>在CentOS下安装配置VNC的过程</title>
    <url>/2012/10/09/1631/</url>
    <content><![CDATA[<p>1.检查vnc客户端和服务器是否已经安装:</p>
<figure class="highlight d"><table><tr><td class="code"><pre><span class="line">[gavin<span class="keyword">@centos</span> ~]$ rpm -q vnc vnc-server</span><br><span class="line"><span class="keyword">package</span> vnc <span class="keyword">is</span> not installed</span><br><span class="line">vnc-server-<span class="number">4.0</span>-<span class="number">8.1</span></span><br><span class="line"><span class="built_in">cent</span> os <span class="number">5</span>已包含vnc的安装包</span><br></pre></td></tr></table></figure>

<p>2.将用户名称加入到配置文件:</p>
<p>(注:这里的”用户名”是指linux系统用户的名称)</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">[gavin@centos ~]$ vi /etc/sysconfig/vncservers</span><br><span class="line">#</span><br><span class="line"># Uncomment the <span class="type">line</span> below <span class="keyword">to</span> <span class="keyword">start</span> a VNC <span class="keyword">server</span> <span class="keyword">on</span> display :<span class="number">1</span></span><br><span class="line"># <span class="keyword">as</span> my <span class="string">&#x27;myusername&#x27;</span> (adjust this <span class="keyword">to</span> your own). You will <span class="keyword">also</span></span><br><span class="line"># need <span class="keyword">to</span> <span class="keyword">set</span> a VNC <span class="keyword">password</span>; run <span class="string">&#x27;man vncpasswd&#x27;</span> <span class="keyword">to</span> see how</span><br><span class="line"># <span class="keyword">to</span> <span class="keyword">do</span> that.</span><br><span class="line">#</span><br><span class="line"># <span class="keyword">DO</span> <span class="keyword">NOT</span> RUN THIS SERVICE <span class="keyword">if</span> your <span class="keyword">local</span> area network <span class="keyword">is</span></span><br><span class="line"># untrusted! <span class="keyword">For</span> a secure way <span class="keyword">of</span> <span class="keyword">using</span> VNC, see</span><br><span class="line"># http://www.uk.research.att.com/vnc/sshvnc.html&gt;.</span><br><span class="line"># VNCSERVERS=&quot;1:myusername&quot;</span><br><span class="line"># VNCSERVERS=&quot;1:gavin 2:john&quot; # use the <span class="keyword">method</span> <span class="keyword">for</span> more <span class="keyword">user</span></span><br><span class="line">VNCSERVERS=&quot;1:gavin 2:root 3:root&quot;</span><br><span class="line"># VNCSERVERARGS[<span class="number">1</span>]=&quot;-geometry 800x600&quot;</span><br><span class="line">VNCSERVERARGS[<span class="number">1</span>]=&quot;-geometry 1024x768&quot;</span><br></pre></td></tr></table></figure>

<p>3.设置用户gavin的密码:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">[gavin@centos ~]$ vncpasswd</span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line"><span class="symbol">Verify:</span></span><br></pre></td></tr></table></figure>

<p>4.启动VNC服务:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[gavin<span class="variable">@centos</span> ~]<span class="variable">$ </span>/sbin/service vncserver start</span><br><span class="line">Starting VNC <span class="symbol">server:</span> <span class="number">1</span><span class="symbol">:gavin</span> [ OK ]</span><br></pre></td></tr></table></figure>

<p>5.输入命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">[gavin@centos ~]$ cd ~<span class="regexp">/.vnc/</span></span><br><span class="line">[gavin@centos .vnc]$ vi xstartup</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Uncomment the following two lines for normal desktop:</span></span><br><span class="line"><span class="comment">#unset SESSION_MANAGER</span></span><br><span class="line"><span class="comment">#exec /etc/X11/xinit/xinitrc</span></span><br><span class="line">[ -x <span class="regexp">/etc/</span>vnc<span class="regexp">/xstartup ] &amp;&amp; exec /</span>etc<span class="regexp">/vnc/</span>xstartup</span><br><span class="line">[ -r <span class="variable">$HOME</span><span class="regexp">/.Xresources ] &amp;&amp; xrdb $HOME/</span>.Xresources</span><br><span class="line">xsetroot -solid grey</span><br><span class="line">vncconfig -iconic &amp;</span><br><span class="line"><span class="comment">#xterm -geometry 80x24+10+10 -ls -title &quot;$VNCDESKTOP Desktop&quot; &amp;</span></span><br><span class="line">gnome-session &amp; <span class="comment">#set starting GNOME desktop</span></span><br><span class="line"><span class="comment">#startkde &amp; #kde desktop</span></span><br><span class="line"><span class="comment">#twm &amp; #Text interface</span></span><br></pre></td></tr></table></figure>

<p>6.重启vncserver:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">[gavin<span class="variable">@centos</span> ~]<span class="variable">$ </span>/sbin/service vncserver restart</span><br><span class="line">Shutting down VNC <span class="symbol">server:</span> <span class="number">1</span><span class="symbol">:gavin</span> [ OK ]</span><br><span class="line">Starting VNC <span class="symbol">server:</span> <span class="number">1</span><span class="symbol">:gavin</span> [ OK ]</span><br></pre></td></tr></table></figure>

<p>7.Windows登陆到VNC Server:</p>
<p>(1).从IE登录<br>直接从IE浏览器中输入如下地址:<br><a href="http://xxx.xxx.xxx.xxx:5802/">http://xxx.xxx.xxx.xxx:5802</a><br>输入密码即可使用.<br>(2).从VNC view登录<br>在windows上安装vnc view,然后输入xxx.xxx.xxx.xxx:2,连接登录,输入密码即可.<br>备注:如果从vnc view登录时,提示connection refused(10061),则是因为linux防火墙的问题,登录centos系统,选择System–&gt;Preferences–&gt;Remote Desktop,勾选sharing中的两项,Security两项不勾,点击关闭,然后再重新用vnc view登录即可.</p>
]]></content>
  </entry>
  <entry>
    <title>在WAMP环境启用GZIP</title>
    <url>/2014/03/23/1634/</url>
    <content><![CDATA[<p>开启gzip实际上非常容易,但是我发现大多数已存的建议都是错的.下面说明我这里是如何实现的:</p>
<p>1,开启Apache的 deflate_module 和 headers_module.(译者注:这里采用了译者实际实现的方式.)</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">去掉 <span class="comment">#LoadModule headers_module modules/mod_headers.so 前面的注释#</span></span><br><span class="line">去掉 <span class="comment">#LoadModule deflate_module modules/mod_deflate.so 前面的注释#</span></span><br><span class="line"><span class="comment">#上面两段如果配置文件中没有就自己加上.</span></span><br></pre></td></tr></table></figure>

<p>2,编辑httpd.conf,在文件末尾,include文件之前加入如下片段(注意ifmodule标签之间的文字是一行,不要打断):</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;ifmodule mod_deflate.c&gt;</span><br><span class="line">    AddOutputFilterByType DEFLATE <span class="built_in">text</span>/html <span class="built_in">text</span>/plain <span class="built_in">text</span>/xml <span class="built_in">text</span>/css <span class="built_in">text</span>/javascript <span class="built_in">application</span>/x- </span><br><span class="line">    javascript <span class="built_in">application</span>/javascript</span><br><span class="line">&lt;/ifmodule&gt;</span><br></pre></td></tr></table></figure>

<p>3, 重启服务.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">service httpd restart</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>在mysql命令行里执行sql脚本</title>
    <url>/2015/11/03/1633/</url>
    <content><![CDATA[<p>命令为:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysql</span></span><br></pre></td></tr></table></figure>

<p>输入:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> d:book.sql</span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">. </span>d:book.sql</span><br></pre></td></tr></table></figure>

<p>回车即可.</p>
]]></content>
  </entry>
  <entry>
    <title>找不到mysql.h</title>
    <url>/2015/11/02/1636/</url>
    <content><![CDATA[<p>这个需要安装mysql-devel这个包,<br>或者直接下载mysql的源码编译.</p>
]]></content>
  </entry>
  <entry>
    <title>找不到mod_dav_svn.so</title>
    <url>/2018/07/15/1635/</url>
    <content><![CDATA[<p>执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install mod_dav_svn.x<span class="number">86</span>_<span class="number">64</span></span><br></pre></td></tr></table></figure>

<p>我的是64位的系统.<br>可以执行:</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum search dav_svn</span></span><br></pre></td></tr></table></figure>

<p>找到对应包.<br>如果找不到 换源.<br>apache配置文件添加:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> dav_svn_module     路径/mod_dav_svn.so</span><br><span class="line"><span class="attribute"><span class="nomarkup">LoadModule</span></span> authz_svn_module   路径/mod_authz_svn.so</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>真正解决error while loading shared libraries libmysqlclient.so.15 cannot open shared object file</title>
    <url>/2012/07/13/1637/</url>
    <content><![CDATA[<p>我是今天再用postfix得时候发现出现问题了,再网上搜索了一下,发现有人和我一样得问题.</p>
<p>64位解决得方法是:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://files.directadmin.com/services/es_<span class="number">5</span>.<span class="number">0</span>_<span class="number">64</span>/libmysqlclient.so.<span class="number">15</span></span><br><span class="line"><span class="attribute">mv</span> libmysqlclient.so.<span class="number">15</span> /usr/lib<span class="number">64</span>/libmysqlclient.so.<span class="number">15</span></span><br><span class="line"><span class="attribute">chmod</span> <span class="number">755</span> /usr/lib<span class="number">64</span>/libmysqlclient.so.<span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>32位解决得方法是:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>files.directadmin.com<span class="regexp">/services/</span>es_5.<span class="number">0</span>/libmysqlclient.so.<span class="number">15</span></span><br><span class="line">mv libmysqlclient.so.<span class="number">15</span> <span class="regexp">/usr/</span>lib/libmysqlclient.so.<span class="number">15</span></span><br><span class="line">chmod <span class="number">755</span> <span class="regexp">/usr/</span>lib/libmysqlclient.so.<span class="number">15</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>真正解决Please install the build and header files for your current Linux kernel.</title>
    <url>/2018/08/24/1638/</url>
    <content><![CDATA[<p>这个问题就是缺少kenerl开发包吧,呵呵,这个还得在研究下,我执行这些命令后就可以了:<br>因为是centos,所以:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> kernel-devel</span><br></pre></td></tr></table></figure>

<p>系统提示重启机器,一切OK～可能还会有其他问题,但是我这里没有遇到.<br>网上还有提示如下:已安装好内核开发包.但当再次安装Guest Additions时,还是会提示需要安装内核开发包.只有给当前内核创建个链接后才能正常安装VirtualBox的Guest Additions.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ln</span> -s /usr/src/kernels/<span class="number">2</span>.<span class="number">6</span>.<span class="number">18</span>-<span class="number">92</span>.<span class="number">1</span>.<span class="number">18</span>.el<span class="number">5</span>-i<span class="number">686</span> /usr/src/linux</span><br><span class="line"><span class="attribute">sh</span> VirtualBox-<span class="number">4</span>.<span class="number">1</span>.<span class="number">8</span>-<span class="number">75467</span>-Linux_amd<span class="number">64</span>.run</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>中文PureFTPd配置文件</title>
    <url>/2015/11/28/1640/</url>
    <content><![CDATA[<p>2019年8月14更新:<br>现在完全不用自己安装配置,lnmp.org下载脚本里面有PureFTPd的自动化安装脚本,可以非常方便的安装配置和使用.</p>
<p>如果你想要使用配置文件代替命令行选项来运行 Pure-FTPd ,请运行下面的命令:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/pureftpd/</span>sbin<span class="regexp">/pure-config.pl /u</span>sr<span class="regexp">/local/</span>pureftpd<span class="regexp">/etc/</span>pure-ftpd.conf</span><br></pre></td></tr></table></figure>

<p>RPM 缺省使用另外一个配置文件:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>sysconfig/pure-ftpd</span><br></pre></td></tr></table></figure>

<p>请不要忘了浏览一下<a href="http://www.pureftpd.org/documentation.html%E7%9A%84%E6%96%87%E6%A1%A3,%E6%9F%A5%E7%9C%8B%E5%85%A8%E9%83%A8%E7%9A%84%E9%80%89%E9%A1%B9%E5%88%97%E8%A1%A8">http://www.pureftpd.org/documentation.html的文档,查看全部的选项列表</a>.</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 限制所有用户在其主目录中</span></span><br><span class="line"><span class="meta"># ChrootEveryone yes</span></span><br><span class="line"><span class="meta"># 如果前一个指令被设置为了 &quot;no&quot;,下面组的成员(GID)就不受主目录的限制了.而其他的用户还是</span></span><br><span class="line"><span class="meta"># 会被限制在自己的主目录里.如果你不想把任何用户限制在自己的主目录里,只要注释掉 ChrootEveryone</span></span><br><span class="line"><span class="meta"># 和 TrustedGID 就可以了.</span></span><br><span class="line">TrustedGID <span class="number">100</span></span><br><span class="line"><span class="meta"># 兼容ie等比较非正规化的ftp客户端</span></span><br><span class="line">BrokenClientsCompatibility no</span><br><span class="line"><span class="meta"># 服务器总共允许同时连接的最大用户数</span></span><br><span class="line">MaxClientsNumber <span class="number">50</span></span><br><span class="line"><span class="meta"># 做为守护(doemon)进程运行(Fork in background)</span></span><br><span class="line">Daemonize yes</span><br><span class="line"><span class="meta"># 同一IP允许同时连接的用户数(Maximum number of sim clients with the same IP address)</span></span><br><span class="line">MaxClientsPerIP <span class="number">8</span></span><br><span class="line"><span class="meta"># 如果你要记录所有的客户命令,设置这个指令为 &quot;yes&quot;.</span></span><br><span class="line"><span class="meta"># This directive can be duplicated to also log server responses.</span></span><br><span class="line">VerboseLog no</span><br><span class="line"><span class="meta"># 即使客户端没有发送 &#x27;-a&#x27; 选项也列出隐藏文件( dot-files .</span></span><br><span class="line">DisplayDotFiles yes</span><br><span class="line"><span class="meta"># 不允许认证用户 - 仅作为一个公共的匿名FTP.</span></span><br><span class="line">AnonymousOnly no</span><br><span class="line"><span class="meta"># 不允许匿名连接,仅允许认证用户使用.</span></span><br><span class="line">NoAnonymous no</span><br><span class="line"><span class="meta"># Syslog facility (auth, authpriv, daemon, ftp, security, user, local*)</span></span><br><span class="line"><span class="meta"># 缺省的功能( facility 是 &quot;ftp&quot;. &quot;none&quot; 将禁止日志.</span></span><br><span class="line">SyslogFacility ftp</span><br><span class="line"><span class="meta"># 定制用户登陆后的显示信息(Display fortune cookies)</span></span><br><span class="line"><span class="meta"># FortunesFile /usr/share/fortune/zippy</span></span><br><span class="line"><span class="meta"># 在日志文件中不解析主机名.日志没那么详细的话,就使用更少的带宽.在一个访问量很大</span></span><br><span class="line"><span class="meta"># 的站点中,设置这个指令为 &quot;yes&quot; ,如果你没有一个能工作的DNS的话.</span></span><br><span class="line">DontResolve yes</span><br><span class="line"><span class="meta"># 客户端允许的最大的空闲时间(分钟,缺省15分钟)</span></span><br><span class="line">MaxIdleTime <span class="number">15</span></span><br><span class="line"><span class="meta"># LDAP 配置文件 (参考 README.LDAP)</span></span><br><span class="line"><span class="meta"># LDAPConfigFile /etc/pureftpd-ldap.conf</span></span><br><span class="line"><span class="meta"># MySQL 配置文件 (参考 README.MySQL)</span></span><br><span class="line"><span class="meta"># MySQLConfigFile /etc/pureftpd-mysql.conf</span></span><br><span class="line"><span class="meta"># Postgres 配置文件 (参考 README.PGSQL)</span></span><br><span class="line"><span class="meta"># PGSQLConfigFile /etc/pureftpd-pgsql.conf</span></span><br><span class="line"><span class="meta"># PureDB 用户数据库 (参考 README.Virtual-Users)</span></span><br><span class="line"><span class="meta"># PureDB /etc/pureftpd.pdb</span></span><br><span class="line"><span class="meta"># pure-authd 的socket 路径(参考 README.Authentication-Modules)</span></span><br><span class="line"><span class="meta"># ExtAuth /var/run/ftpd.sock</span></span><br><span class="line"><span class="meta"># 如果你要启用 PAM 认证方式, 去掉下面行的注释.</span></span><br><span class="line"><span class="meta"># PAMAuthentication yes</span></span><br><span class="line"><span class="meta"># 如果你要启用 简单的 Unix系统 认证方式(/etc/passwd), 去掉下面行的注释.</span></span><br><span class="line"><span class="meta"># UnixAuthentication yes</span></span><br><span class="line"><span class="meta"># 请注意,LDAPConfigFile, MySQLConfigFile, PAMAuthentication 和</span></span><br><span class="line"><span class="meta"># UnixAuthentication 这些指令只能被使用一次,不过,他们能被混合在一起用.例如:如果你使用了</span></span><br><span class="line"><span class="meta"># MySQLConfigFile 和 UnixAuthentication,那么 SQL 服务器将被访问.如果因为用户名未找</span></span><br><span class="line"><span class="meta"># 到而使 SQL 认证失败的话,就会在/etc/passwd 和 /etc/shadow 中尝试另外一种认证,如果因</span></span><br><span class="line"><span class="meta"># 为密码错误而使 SQL 认证失败的话,认证就会在此结束了.认证方式由它们被给出来的顺序而被链</span></span><br><span class="line"><span class="meta"># 接了起来.</span></span><br><span class="line"><span class="meta"># &#x27;ls&#x27; 命令的递归限制.第一个参数给出文件显示的最大数目.第二个参数给出最大的子目录深度.</span></span><br><span class="line">LimitRecursion <span class="number">2000</span> <span class="number">8</span></span><br><span class="line"><span class="meta"># 允许匿名用户创建新目录?</span></span><br><span class="line">AnonymousCanCreateDirs no</span><br><span class="line"><span class="meta"># 如果系统被 loaded 超过下面的值,匿名用户会被禁止下载.</span></span><br><span class="line">MaxLoad <span class="number">4</span></span><br><span class="line"><span class="meta"># 被动连接响应的端口范围.- for firewalling.</span></span><br><span class="line"><span class="meta"># PassivePortRange 30000 50000</span></span><br><span class="line"><span class="meta"># 强制一个IP地址使用被动响应( PASV/EPSV/SPSV replies). - for NAT.</span></span><br><span class="line"><span class="meta"># Symbolic host names are also accepted for gateways with dynamic IP</span></span><br><span class="line"><span class="meta"># addresses.</span></span><br><span class="line"><span class="meta"># ForcePassiveIP 192.168.0.1</span></span><br><span class="line"><span class="meta"># 匿名用户的上传/下载的比率.</span></span><br><span class="line"><span class="meta"># AnonymousRatio 1 10</span></span><br><span class="line"><span class="meta"># 所有用户的上传/下载的比率.</span></span><br><span class="line"><span class="meta"># This directive superscedes the previous one.</span></span><br><span class="line"><span class="meta"># UserRatio 1 10</span></span><br><span class="line"><span class="meta"># 不接受所有者为 &quot;ftp&quot; 的文件的下载.例如:那些匿名用户上传后未被本地管理员验证的文件.</span></span><br><span class="line">AntiWarez yes</span><br><span class="line"><span class="meta"># 服务监听的IP 地址和端口.(缺省是所有IP地址和21端口)</span></span><br><span class="line"><span class="meta"># Bind 127.0.0.1,21</span></span><br><span class="line"><span class="meta"># 匿名用户的最大带宽(KB/s).</span></span><br><span class="line"><span class="meta"># AnonymousBandwidth 8</span></span><br><span class="line"><span class="meta"># 所有用户的最大带宽(KB/s),包括匿名用户.</span></span><br><span class="line"><span class="meta"># Use AnonymousBandwidth *or* UserBandwidth, both makes no sense.</span></span><br><span class="line"><span class="meta"># UserBandwidth 8</span></span><br><span class="line"><span class="meta"># 新建目录及文件的属性掩码值.&lt;文件掩码&gt;:&lt;目录掩码&gt; .</span></span><br><span class="line"><span class="meta"># 177:077 if you feel paranoid.</span></span><br><span class="line">Umask <span class="number">133</span>:<span class="number">022</span></span><br><span class="line"><span class="meta"># 认证用户允许登陆的最小组ID(UID) .</span></span><br><span class="line">MinUID <span class="number">100</span></span><br><span class="line"><span class="meta"># 仅允许认证用户进行 FXP 传输.</span></span><br><span class="line">AllowUserFXP yes</span><br><span class="line"><span class="meta"># 对匿名用户和非匿名用户允许进行匿名 FXP 传输.</span></span><br><span class="line">AllowAnonymousFXP no</span><br><span class="line"><span class="meta"># 用户不能删除和写点文件(文件名以 &#x27;.&#x27; 开头的文件),即使用户是文件的所有者也不行.</span></span><br><span class="line"><span class="meta"># 如果 TrustedGID 指令是 enabled ,文件所属组用户能够访问点文件(dot-files).</span></span><br><span class="line">ProhibitDotFilesWrite no</span><br><span class="line"><span class="meta"># 禁止读点文件(文件名以 &#x27;.&#x27; 开头的文件) (.history, .ssh...)</span></span><br><span class="line">ProhibitDotFilesRead no</span><br><span class="line"><span class="meta"># 永不覆盖文件.当上传的文件,其文件名已经存在时,自动重命名,如: file.1, file.2, file.3, ...</span></span><br><span class="line">AutoRename no</span><br><span class="line"><span class="meta"># 不接受匿名用户上传新文件( no = 允许上传)</span></span><br><span class="line">AnonymousCantUpload no</span><br><span class="line"><span class="meta"># 仅允许来自以下IP地址的非匿名用户连接.你可以使用这个指令来打开几个公网IP来提供匿名FTP,</span></span><br><span class="line"><span class="meta"># 而保留一个私有的防火墙保护的IP来进行远程管理.你还可以只允许一内网地址进行认证,而在另外</span></span><br><span class="line"><span class="meta"># 一个IP上提供纯匿名的FTP服务.</span></span><br><span class="line"><span class="meta">#TrustedIP 10.1.1.1</span></span><br><span class="line"><span class="meta"># 如果你要为日志每一行添加 PID 去掉下面行的注释.</span></span><br><span class="line"><span class="meta"># LogPID yes</span></span><br><span class="line"><span class="meta"># 使用类似于Apache的格式创建一个额外的日志文件,如:</span></span><br><span class="line"><span class="meta"># fw.c9x.org - jedi [13/Dec/1975:19:36:39] &quot;GET /ftp/linux.tar.bz2&quot; 200 21809338</span></span><br><span class="line"><span class="meta"># 这个日志文件能被 www 流量分析器处理.</span></span><br><span class="line"><span class="meta"># AltLog clf:/var/log/pureftpd.log</span></span><br><span class="line"><span class="meta"># 使用优化过的格式为统计报告创建一个额外的日志文件.</span></span><br><span class="line"><span class="meta"># AltLog stats:/var/log/pureftpd.log</span></span><br><span class="line"><span class="meta"># 使用标准的W3C格式创建一个额外的日志文件.(与大部分的商业日志分析器兼容)</span></span><br><span class="line"><span class="meta"># AltLog w3c:/var/log/pureftpd.log</span></span><br><span class="line"><span class="meta"># 不接受 CHMOD 命令.用户不能更改他们文件的属性.</span></span><br><span class="line"><span class="meta"># NoChmod yes</span></span><br><span class="line"><span class="meta"># 允许用户恢复和上传文件,却不允许删除他们.</span></span><br><span class="line"><span class="meta"># KeepAllFiles yes</span></span><br><span class="line"><span class="meta"># 用户主目录不存在的话,自动创建.</span></span><br><span class="line"><span class="meta"># CreateHomeDir yes</span></span><br><span class="line"><span class="meta"># 启用虚拟的磁盘限额.第一个数字是最大的文件数.</span></span><br><span class="line"><span class="meta"># 第二个数字是最大的总的文件大小(单位:Mb).</span></span><br><span class="line"><span class="meta"># 所以,1000:10 就限制每一个用户只能使用 1000 个文件,共10Mb.</span></span><br><span class="line"><span class="meta"># Quota 1000:10</span></span><br><span class="line"><span class="meta"># 如果你的 pure-ftpd 编译时加入了独立服务器( standalone 支持,你能够改变 pid 文件</span></span><br><span class="line"><span class="meta"># 的位置.缺省位置是 /var/run/pure-ftpd.pid .</span></span><br><span class="line"><span class="meta"># PIDFile /var/run/pure-ftpd.pid</span></span><br><span class="line"><span class="meta"># 如果你的 pure-ftpd 编译时加入了 pure-uploadscript 支持,这个指令将会使 pure-ftpd</span></span><br><span class="line"><span class="meta"># 发送关于新上传的情况信息到 /var/run/pure-ftpd.upload.pipe,这样 pure-uploadscript</span></span><br><span class="line"><span class="meta"># 就能读然后调用一个脚本去处理新的上传.</span></span><br><span class="line"><span class="meta"># CallUploadScript yes</span></span><br><span class="line"><span class="meta"># 这个选项对允许匿名上传的服务器是有用的.当 /var/ftp 在 /var 里时,需要保留一定磁盘空间</span></span><br><span class="line"><span class="meta"># 来保护日志文件.当所在磁盘分区使用超过百分之 X 时,将不在接受新的上传.</span></span><br><span class="line">MaxDiskUsage <span class="number">99</span></span><br><span class="line"><span class="meta"># 如果你不想要你的用户重命名文件的话,就设置为 &#x27;yes&#x27; .</span></span><br><span class="line"><span class="meta"># NoRename yes</span></span><br><span class="line"><span class="meta"># 是 &#x27;customer proof&#x27; : 工作区(workaround)反对普通的客户错误,类似于:&#x27;chmod 0 public_html&#x27; 的错误.</span></span><br><span class="line"><span class="meta"># 那是一个有效的命令,不过,将导致无知的客户所定他们自己的文件,将使你的技术支持忙于愚蠢的的问题中.</span></span><br><span class="line"><span class="meta"># 如果你确信你所有的用户都有基本的Unix知识的话,这个特性将没什么用了.不过,如果你是一个主机提供商</span></span><br><span class="line"><span class="meta"># 的话,启用它.</span></span><br><span class="line">CustomerProof yes</span><br><span class="line"><span class="meta"># 每一个用户的并发限制.只有在添加了 --with-peruserlimits 编译选项进行编译后,这个指令才起</span></span><br><span class="line"><span class="meta"># 作用.(大部分的二进制的发布版本就是例子)</span></span><br><span class="line"><span class="meta"># 格式是 : &lt;每一个用户最大允许的进程&gt;:&lt;最大的匿名用户进程&gt;</span></span><br><span class="line"><span class="meta"># 例如: 3:20 意思是同一个认证用户最大可以有3个同时活动的进程.而且同时最多只能有20个匿名用户进程.</span></span><br><span class="line"><span class="meta"># PerUserLimits 3:20</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>正确解决mysql.h no such file or directory</title>
    <url>/2019/03/20/1639/</url>
    <content><![CDATA[<p>没有安装mysql开发库:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> mysql-devel</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>重建mysql套接字 解决找不到mysql.sock文件错误</title>
    <url>/2015/12/25/1641/</url>
    <content><![CDATA[<p>mysql5.0.37数据库使用源码安装,版本5.0.37-log,使用Localhost via UNIX socket,启动脚本 <code>/usr/local/bin/mysqld_safe</code>;判断一般人解决故障时没有切换到mysql用户,造成权限有问题,无法创建mysql授权表,所以也就无法创建 <code>/tmp/mysql.sock</code>和 <code>hostname.pid</code>文件.因此,总结解决方法如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$su</span> mysql</span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/bin/my</span>sql_install_db     <span class="regexp">//</span>重建授权表</span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/bin/my</span>sqld_safe &amp;</span><br><span class="line">$<span class="regexp">/usr/</span>local<span class="regexp">/bin/my</span>sql                <span class="regexp">//</span>测试</span><br><span class="line"><span class="variable">$mysq</span>&gt;bye;</span><br></pre></td></tr></table></figure>

<p>文件已经解决,重新生成新的 /tmp/mysql.sock 和 hostname.pid</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$su</span> root</span><br><span class="line"><span class="variable">$chmod</span> +t <span class="regexp">/tmp/my</span>sql.sock            <span class="regexp">//</span>添加保护</span><br></pre></td></tr></table></figure>

<p>全部结束!</p>
]]></content>
  </entry>
  <entry>
    <title>C preprocessor &quot;/lib/cpp&quot; fails sanity check</title>
    <url>/2019/01/24/1645/</url>
    <content><![CDATA[<p>原因:</p>
<p>缺少包安装<code>linux-kernel-headers</code>.</p>
<p>解决:</p>
<p>有桌面系统进入yast2 搜索linux-kernel-headers安装.<br>没有桌面系统去<a href="http://rpm.pbone.net/">http://rpm.pbone.net/</a> 搜索下载rpm安装.<br>下载地址:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ftp</span>://ftp.pbone.net/mirror/ftp.opensuse.org/distribution/<span class="number">11</span>.<span class="number">2</span>/repo/oss/suse/noarch/linux-kernel-headers-<span class="number">2</span>.<span class="number">6</span>.<span class="number">31</span>-<span class="number">3</span>.<span class="number">4</span>.noarch.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh linux-kernel-headers-<span class="number">2</span>.<span class="number">6</span>.<span class="number">31</span>-<span class="number">3</span>.<span class="number">4</span>.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>成功安装.</p>
]]></content>
  </entry>
  <entry>
    <title>子进程 已安装 pre-removal 脚本 返回了错误号 1或2 与 子进程 已安装 post-installation 脚本 返回了错误号 1或2</title>
    <url>/2018/02/17/1642/</url>
    <content><![CDATA[<p>解决办法：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">sudo rm <span class="regexp">/var/</span>lib<span class="regexp">/dpkg/i</span>nfo/&lt;<span class="keyword">package</span> name&gt;.*</span><br></pre></td></tr></table></figure>

<p>比如:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo rm <span class="regexp">/var/</span>lib<span class="regexp">/dpkg/i</span>nfo/vsftpd.*</span><br></pre></td></tr></table></figure>

<p>存档后，再进行操作就OK了。</p>
]]></content>
  </entry>
  <entry>
    <title>error while loading shared libraries libinotifytools.so.0 cannot open shared object file No such file or directory</title>
    <url>/2011/09/22/1643/</url>
    <content><![CDATA[<p>做个软链接:<br>32位系统:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libinotifytools.so.<span class="number">0</span> <span class="regexp">/usr/</span>lib/libinotifytools.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>64位系统:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>libinotifytools.so.<span class="number">0</span> <span class="regexp">/usr/</span>lib64/libinotifytools.so.<span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>8 位平台上运行 Linux 系统</title>
    <url>/2019/05/02/1644/</url>
    <content><![CDATA[<p>第一眼看到这个新闻挺震撼的,大家可能不知到,小时候玩的小霸王游戏机就是8位芯片组的.<br>国外友人还真是拥有着非凡的抗折腾的能力.一位技术宅(Dmitry Grinberg,也许人家并不是技术宅)写了一篇博文来介绍在 8 位微控制器上运行 Linux 的文章.结果是,他花了两个小时的时间引导到 bash, 花了四个多小时运行到了 Ubuntu,而可用性则基本是0.<br>这个项目的具体实现方式是这样的:由于 Linux 不具备原生 8 位平台的支持能力,且须需要一个内存管理单元以及位载入内核准备的兆级内存,因此,他首先写了一个为 8 位控制器 ATmega1284p 的 ARM 模拟器,并基此进行之后的操作.<br>除了执行 “init=/bin/bash” 花费了将近 2 小时、执行”exec init” 四个多小时之外,进入 X 花费了更长的时间.模拟器所模拟的 CPU 速度大约为 6.5KHz. Lwn 评论,这个系统是基本不可用的,因为,输入的字符几分钟之内才能有反应.因此,这个系统可用的功能是格式化SD卡,倒是颇为讽刺.<br>不过正如 Lwn 所说,这虽然不是最快的电脑,但据对算是最便宜、最慢、最简单、最低端的计算机系统了.Solidot 给出了这个项目所用系统的镜像.</p>
]]></content>
  </entry>
  <entry>
    <title>64位安装永中Office2012</title>
    <url>/2017/11/17/1646/</url>
    <content><![CDATA[<p>刚刚安装成功了,看到有很多人都没有成功安装.我的系统是Linux Mint 12, 基本上就是Ubuntu 11.10.我是按照Linux Deepin的步骤来的.<br>把终端cd到解压缩以后的tar文件夹里面,执行以下命令:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">sudo apt-get install ia32-libs</span><br><span class="line">chmod +x setup.sh</span><br><span class="line">sudo ./setup.sh</span><br></pre></td></tr></table></figure>

<p>最后一条执行的时候会等一会儿然后弹出安装程序界面,我就是用的默认设置,把程序安装在 <code>/usr/local</code>下.进度条走完以后会在”configuring system…” 的地方卡个2分钟左右,然后就安装成功了.</p>
]]></content>
  </entry>
  <entry>
    <title>fedora的/etc/modules.conf 位置</title>
    <url>/2014/03/21/1648/</url>
    <content><![CDATA[<p>fc3使用2.6的内核,模块配置文件改为:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/m</span>odprobe.conf</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>选择商城网站还是淘宝?</title>
    <url>/2015/06/01/1647/</url>
    <content><![CDATA[<p>很多人一想到开网店就想到了淘宝,但这不一定是正确的选择.</p>
<p>看两个案例,某君毕业后一直找不到满意工作,后来发现自己亲戚就是做衣服批发生意的,于是计划在淘宝开个店来创业.马上注册淘宝、支付宝,然后一系列的验证绑定等,费了不少周折,网店终于算是开了.<br>然后便马不停蹄处理产品照片上传等几天时间就把几百件产品放了上去,然后就是宣传推广.</p>
<p>一两个月过去了,成交为零,他认为是新站问题,于是再努力维护宣传.后来我们给他出个计,给了段流量代码给他,叫他放上去,这下可好,每天的流量一目了然,每天竟然只有可怜的几个IP量!还包括他自己的一个.他有一点还是很值得学习的,就是肯坚持.可半年一年过去了,效果就真让他跌破眼镜了,虽然自己是新手吧,可好歹自己也是大学生玩网络长大的,现在完全熟悉了淘宝流程,并且所有工作和宣传也都是认认真真地去做了,可为何效果还是那么差呢?别说赚钱,就连维持生存都难!</p>
<p>很多人都会说,那是你经营有问题,你看人家的生意多好,多好卖呢!各位这就有所不知了吧,淘宝也是站在消费者角度考虑,你是新店,一没信用,二没经验,三没人气,四没收藏,五是没交钱开直通车.知道了吧,如果你是新店或信用不高的,淘宝那么高的流量和份额还是没你的份!除非花钱做他们广告位.毕竟你用的是别人的平台,就必须听他的.到现在这位某君都一直在为如何提高信用和人气收藏烦恼呢.</p>
<p>再来看另一个,是我们客户,刚大学毕业,有创业激情,跟朋友合伙找我们奇亿网络做了个高校在线购物站,做好后一直努力宣传,如果说马上就有效果肯定也是假的,一个月也同样没有几个流量,更别谈有人购物,后来没坚持两个月,他们团队意见不合分了,他获得网站所有权,然后他静下心思考了番,打算自己一个人来运营!</p>
<p>后来找我们聊了下,我们告诉他网站也需要宣传推广,得靠自己,不过电子商务网站最好的还是口碑,所以建议他服务好每一个客户,控制好每一件产品质量,做好每一个售后.后来他认真自己全力操刀,从产品上传到网站宣传,再从客户咨询到售后,忙得不亦乐呼.再后来他的客户就慢慢积累起来了,生意也越来越好,现在他已经发展成一个拥有五百多位代理商和一百多家实体店购买商的在线批发商城了.他给自己的总结就是生意是靠积累和口碑的.</p>
<p>是的,做生意的都知道,客户都是靠积累起的,这就决定了为什么淘宝店和独立商城的生意区别.没错,淘宝店是有很多卖家火暴的,可那毕竟是老卖家,是做了好几年把信用做上去的,那是以前,你现在再做淘宝就未免有点晚了,因为淘宝规则不会再去讨你一个小卖家,因为他已经足够大,都去发展品牌客户了.</p>
<p>所以,想创业的朋友们,如果想在电子商务领域有所成就,拥有自己的独立平台绝对是首选,因为现在电子商务做的就是创新,再想依赖别人平台来创业已经不太可行了,制作自己独立商城网站才是王道!</p>
<p>读后感:本人做网络多年,虽然未涉足电子商务领域,但如果是建立网上商城我建议还是选择独立网站的好,如果有什么不懂的可以来问我,懂的东西一定告诉大家.</p>
]]></content>
  </entry>
  <entry>
    <title>128M内存VPS性能优化</title>
    <url>/2018/09/21/1649/</url>
    <content><![CDATA[<p>VPS(全称Virtual Private Server)是利用最新虚拟化技术在一台物理服务器上创建多个相互隔离的虚拟私有主机.它们以最大化的效率共享硬件、软件许可证以及管理资源.对其用户和应用程序来讲,每一个VPS平台的运行和管理都与一台独立主机完全相同,因为每一个VPS均可独立进行重启并拥有自己的root访问权限、用户、IP地址、内存、过程、文件、应用程序、系统函数库以及配置文件.<br>VPS服务器最重要的指标就是内存大小,多个VPS服务器可以共享一颗CPU,但不能共享同一块内存.内存越大,价格越贵.<br>下面,以我的博客所在的VPS为例,介绍在128M内存下对 Nginx 0.7.x + PHP 5.2.6(FastCGI)+ MySQL 5.1 的优化.<br>优化后的效果:<br>提供HTTP服务的1个Nginx进程占用11M物理内存,5个php-cgi进程每个占用8M左右物理内存,1个MySQL服务器占用7M物理内存, 加上两个占用内存不大的Nginx和php-cgi父进程,Nginx + PHP + MySQL 系列总共只占用47.7%的物理内存,即62M物理内存(128M * 47.7% ≈ 62M).<br>另外,VPS服务器系统自身和其它程序也会使用一些内存,但128M内存的VPS已经够用.总体而言,经过优化后,128M内存的VPS跑 Nginx + PHP + MySQL 效果不错.当然,如果有Money购买更大内存的VPS,就更好了.<br>优化项如下:</p>
<p>零、充分利用多核</p>
<p>Nginx 在 Linux 上有一个 worker_cpu_affinity 参数,可以为每个工作进程绑定到不同的 CPU ,所以如果你的 VPS 具有多核的话,那么可以充分利用各 CPU .比如如果有 4 个 CPU,那么可以进行如下配置:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br><span class="line"><span class="attribute">worker_cpu_affinity</span> <span class="number">0001</span> <span class="number">0010</span> <span class="number">0100</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>一、增加256M的swap交换文件</p>
<p>1、创建并激活swap交换文件</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/var/</span></span><br><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero of=swapfile bs=<span class="number">1024</span> <span class="keyword">count</span>=<span class="number">262144</span></span><br><span class="line"><span class="regexp">/sbin/m</span>kswap swapfile</span><br><span class="line"><span class="regexp">/sbin/</span>swapon swapfile</span><br></pre></td></tr></table></figure>

<p>2、加到fstab文件中让系统引导时自动启动</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>fstab </span><br><span class="line"><span class="comment">#在末尾增加以下内容:</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">/var/</span>swapfile swap swap defaults <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>二、Nginx 0.7.19 的主配置文件(nginx.conf)优化</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">user</span>  www www;</span><br><span class="line"><span class="comment">#Nginx每个进程耗费10M~12M内存,这里只开启一个Nginx进程,节省内存.</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span>  /data1/logs/nginx_error.log  <span class="literal">crit</span>;</span><br><span class="line"><span class="attribute">pid</span>        /usr/local/webserver/nginx/nginx.pid;</span><br><span class="line"><span class="comment">#Specifies the value for maximum file descriptors that can be opened by this process.</span></span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">51200</span>;</span><br><span class="line"><span class="section">events</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">51200</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="comment">#charset  gb2312;</span></span><br><span class="line">    <span class="attribute">server_names_hash_bucket_size</span> <span class="number">128</span>;</span><br><span class="line">    <span class="attribute">client_header_buffer_size</span> <span class="number">32k</span>;</span><br><span class="line">    <span class="attribute">large_client_header_buffers</span> <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span>     <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">60</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">fastcgi_connect_timeout</span> <span class="number">300</span>;</span><br><span class="line">    <span class="attribute">fastcgi_send_timeout</span> <span class="number">300</span>;</span><br><span class="line">    <span class="attribute">fastcgi_read_timeout</span> <span class="number">300</span>;</span><br><span class="line">    <span class="attribute">fastcgi_buffer_size</span> <span class="number">64k</span>;</span><br><span class="line">    <span class="attribute">fastcgi_buffers</span> <span class="number">4</span> <span class="number">64k</span>;</span><br><span class="line">    <span class="attribute">fastcgi_busy_buffers_size</span> <span class="number">128k</span>;</span><br><span class="line">    <span class="attribute">fastcgi_temp_file_write_size</span> <span class="number">128k</span>;</span><br><span class="line">    <span class="comment">#对网页文件、CSS、JS、XML等启动gzip压缩,减少数据传输量,提高访问速度.</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span>  <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span>     <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span>       text/plain application/x-javascript text/css application/xml;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#limit_zone  crawler  $binary_remote_addr  10m;</span></span><br><span class="line">    <span class="section">server</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  www.s135.com s135.com <span class="regexp">*.s</span>135.com;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">        <span class="attribute">root</span>  /data0/htdocs/blog;</span><br><span class="line">        <span class="comment">#limit_conn   crawler  20;</span></span><br><span class="line">        <span class="comment">#针对Bo-Blog系统的Rewrite静态化</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/post/([0-9]+).htm$</span> /read.php?<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/post/([0-9]+)_([0-9]+).htm$</span> /read.php?<span class="variable">$1</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/post/([0-9]+)_([0-9]+)_([0-9]+).htm$</span> /read.php?<span class="variable">$1</span>&amp;page=<span class="variable">$2</span>?=<span class="variable">$3</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/index_([0-9]+)_([0-9]+).htm$</span> /index.php?mode=<span class="variable">$1</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/star_([0-9]+)_([0-9]+).htm$</span> /star.php?mode=<span class="variable">$1</span>&amp;page=<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/category_([0-9]+).htm$</span> /index.php?go=category_<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/category_([0-9]+)_([0-9]+)_([0-9]+).htm$</span> /index.php?go=category_<span class="variable">$1</span>&amp;mode=<span class="variable">$2</span>&amp;page=<span class="variable">$3</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/archive_([0-9]+)_([0-9]+).htm$</span> /index.php?go=archive&amp;cm=<span class="variable">$1</span>&amp;cy=<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/archive_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+).htm$</span> /index.php?go=archive&amp;cm=<span class="variable">$1</span>&amp;cy=<span class="variable">$2</span>&amp;mode=<span class="variable">$3</span>&amp;page=<span class="variable">$4</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/showday_([0-9]+)_([0-9]+)_([0-9]+).htm$</span> /index.php?go=showday_<span class="variable">$1</span>-<span class="variable">$2</span>-<span class="variable">$3</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/showday_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+)_([0-9]+).htm$</span> /index.php?go=showday_<span class="variable">$1</span>-<span class="variable">$2</span>-<span class="variable">$3</span>&amp;mode=<span class="variable">$4</span>&amp;page=<span class="variable">$5</span> <span class="literal">last</span>;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ .*.(php|php5)?$</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">#将Nginx与FastCGI的通信方式由TCP改为Unix Socket.TCP在高并发访问下比Unix Socket稳定,但Unix Socket速度要比TCP快.</span></span><br><span class="line">            <span class="attribute">fastcgi_pass</span>  unix:/tmp/php-cgi.sock;</span><br><span class="line">            <span class="comment">#fastcgi_pass  127.0.0.1:9000;</span></span><br><span class="line">            <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">            <span class="attribute">include</span> fcgi.conf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /read.php</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">#将Nginx与FastCGI的通信方式由TCP改为Unix Socket.TCP在高并发访问下比Unix Socket稳定,但Unix Socket速度要比TCP快.</span></span><br><span class="line">            <span class="attribute">fastcgi_pass</span>  unix:/tmp/php-cgi.sock;</span><br><span class="line">            <span class="comment">#fastcgi_pass  127.0.0.1:9000;</span></span><br><span class="line">            <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">            <span class="attribute">include</span> fcgi.conf;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">#博客的图片较多,更改较少,将它们在浏览器本地缓存15天,可以提高下次打开我博客的页面加载速度.</span></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attribute">expires</span>      <span class="number">15d</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#博客会加载很多JavaScript、CSS,将它们在浏览器本地缓存1天,访问者在看完一篇文章或一页后,再看另一篇文件或另一页的内容,无需从服务器再次下载相同的JavaScript、CSS,提高了页面显示速度.</span></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ .*.(js|css)?$</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attribute">expires</span>      <span class="number">1d</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">log_format</span>  access  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">        <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">        <span class="string">&#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;</span>;</span><br><span class="line">        <span class="attribute">access_log</span>  /data1/logs/access.log  access;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三、PHP 5.2.6(FastCGI)的配置优化</p>
<p>1、php.ini 配置文件中关于eAcelerator的优化.只使用1M共享内存,删除所有在最后3600秒内无法存取的脚本缓存,用磁盘辅助进行缓存.</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[eaccelerator]</span></span><br><span class="line"><span class="attr">zend_extension</span>=<span class="string">&quot;/usr/local/webserver/php/lib/php/extensions/no-debug-non-zts-20060613/eaccelerator.so&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_size</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.cache_dir</span>=<span class="string">&quot;/usr/local/webserver/eaccelerator_cache&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.enable</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.optimizer</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.check_mtime</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.debug</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.filter</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_max</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_ttl</span>=<span class="string">&quot;3600&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_prune_period</span>=<span class="string">&quot;3600&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.shm_only</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.compress_level</span>=<span class="string">&quot;9&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.keys</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.sessions</span> = <span class="string">&quot;disk_only&quot;</span></span><br><span class="line"><span class="attr">eaccelerator.content</span> = <span class="string">&quot;disk_only&quot;</span></span><br></pre></td></tr></table></figure>

<p>2、php-fpm.conf 的配置优化</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#修改两项,一是修改以下一行,将启动的php-cgi进程数由原来的128个改为5个:</span></span><br><span class="line">&gt;value <span class="attribute">name</span>=<span class="string">&quot;max_children&quot;</span>&gt;5&gt;/value&gt;</span><br><span class="line"><span class="comment">#二是修改以下一行,将TCP模式改为Unix Socket模式:</span></span><br><span class="line">&gt;value <span class="attribute">name</span>=<span class="string">&quot;listen_address&quot;</span>&gt;/tmp/php-cgi.sock&gt;/value&gt;</span><br></pre></td></tr></table></figure>

<p>四、MySQL 5.1.26 配置优化</p>
<p>1、使用以下参数编译安装的 MySQL 5.1 默认支持4种存储引擎:CSV、MRG_MYISAM、MEMORY、MyISAM,不支持InnoDB存储引擎.由于内存有限,而InnoDB耗费的内存较大,这里推荐使用MyISAM存储引擎.</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/webserver/mysql/</span> <span class="params">--enable-assembler</span> <span class="params">--with-extra-charsets=complex</span> <span class="params">--enable-thread-safe-client</span> <span class="params">--with-big-tables</span> <span class="params">--with-readline</span> <span class="params">--with-ssl</span> <span class="params">--with-embedded-server</span> <span class="params">--enable-local-infile</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>2、MySQL 5.1 配置文件(my.cnf)优化</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="comment">#在后面增加如下内容:</span></span><br><span class="line"></span><br><span class="line">skip-innodb</span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attr">user</span> = mysql</span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">open_files_limit</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">back_log</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">max_connect_errors</span> = <span class="number">200</span></span><br><span class="line"><span class="attr">table_cache</span> = <span class="number">60</span></span><br><span class="line"><span class="attr">external-locking</span> = FALSE</span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">16</span>M</span><br><span class="line"><span class="attr">sort_buffer_size</span> = <span class="number">128</span>K</span><br><span class="line"><span class="attr">join_buffer_size</span> = <span class="number">128</span>K</span><br><span class="line"><span class="attr">thread_cache_size</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">thread_concurrency</span> = <span class="number">8</span></span><br><span class="line"><span class="attr">query_cache_size</span> = <span class="number">0</span>M</span><br><span class="line"><span class="attr">query_cache_limit</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">query_cache_min_res_unit</span> = <span class="number">2</span>k</span><br><span class="line"><span class="attr">default_table_type</span> = MyISAM</span><br><span class="line"><span class="attr">thread_stack</span> = <span class="number">192</span>K</span><br><span class="line"><span class="attr">transaction_isolation</span> = READ-UNCOMMITTED</span><br><span class="line"><span class="attr">tmp_table_size</span> = <span class="number">512</span>K</span><br><span class="line"><span class="attr">max_heap_table_size</span> = <span class="number">32</span>M</span><br><span class="line"><span class="attr">long_query_time</span> = <span class="number">1</span></span><br><span class="line">log_long_format</span><br><span class="line"><span class="attr">server-id</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">binlog_cache_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">max_binlog_cache_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">max_binlog_size</span> = <span class="number">512</span>M</span><br><span class="line"><span class="attr">expire_logs_days</span> = <span class="number">7</span></span><br><span class="line"><span class="attr">key_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">read_buffer_size</span> = <span class="number">1</span>M</span><br><span class="line"><span class="attr">read_rnd_buffer_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">bulk_insert_buffer_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">myisam_sort_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">myisam_max_sort_file_size</span> = <span class="number">10</span>G</span><br><span class="line"><span class="attr">myisam_max_extra_sort_file_size</span> = <span class="number">10</span>G</span><br><span class="line"><span class="attr">myisam_repair_threads</span> = <span class="number">1</span></span><br><span class="line">myisam_recover</span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">16</span>M</span><br></pre></td></tr></table></figure>

<p>3.重启MySQL</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">service mysqld <span class="keyword">restart</span></span><br><span class="line">#让mysql更安全:</span><br><span class="line"></span><br><span class="line">mysql -u root -p [此时会要求你输入刚刚设置的密码,输入后回车即可]</span><br><span class="line">mysql&gt; <span class="keyword">DROP</span> <span class="keyword">DATABASE</span> test; [删除test数据库]</span><br><span class="line">mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span> <span class="keyword">WHERE</span> <span class="keyword">user</span> = <span class="string">&#x27;&#x27;</span>; [删除匿名帐户]</span><br><span class="line">mysql&gt;<span class="keyword">DELETE</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span> <span class="keyword">WHERE</span> <span class="keyword">password</span> = <span class="string">&#x27;&#x27;</span>;[删除无密码帐户]</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>; [重载权限]</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>异常/bin/sh^M bad interpreter No such file or dire</title>
    <url>/2013/08/03/1650/</url>
    <content><![CDATA[<p>在Linux中执行.sh脚本,出现错误:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/bin/</span>sh^M: bad interpreter: No such <span class="keyword">file</span> or directory.</span><br></pre></td></tr></table></figure>

<p>分析:这是不同系统编码格式引起的:在windows系统中编辑的.sh文件可能有不可见字符,所以在Linux系统下执行会报以上异常信息.</p>
<p>解决:</p>
<p>1)在windows下转换:</p>
<p>利用一些编辑器如UltraEdit或EditPlus等工具先将脚本编码转换,再放到Linux中执行.转换方式如下(UltraEdit):File–&gt;Conversions–&gt;DOS-&gt;UNIX即可.</p>
<p>2)也可在Linux中转换:</p>
<p>首先要确保文件有可执行权限:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$sh</span>&gt;chmod a+x filename</span></span><br></pre></td></tr></table></figure>

<p>然后修改文件格式:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$sh</span>&gt;vi filename</span></span><br></pre></td></tr></table></figure>

<p>利用如下命令查看文件格式:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="meta">:set ff 或 :set</span> fileformat</span><br></pre></td></tr></table></figure>

<p>可以看到如下信息:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fileformat</span>=dos 或 <span class="attribute">fileformat</span>=unix</span><br></pre></td></tr></table></figure>

<p>利用如下命令修改文件格式:</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="meta">:set ff=unix 或 :set</span> fileformat=unix</span><br><span class="line">:wq (存盘退出)</span><br></pre></td></tr></table></figure>

<p>最后再执行文件:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$sh</span>&gt;./filename</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Can&#39;t locate Text/Iconv.pm in @INC Can&#39;t locate Date/Format.pm in @INC解决方法</title>
    <url>/2014/10/21/1653/</url>
    <content><![CDATA[<p>错误提示：</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">Can&#x27;<span class="built_in">t</span> locate <span class="built_in">Text</span>/Iconv.pm in @INC</span><br></pre></td></tr></table></figure>

<p>解决方法:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/var/</span>www<span class="regexp">/cgi-bin/</span>openwebmail<span class="regexp">/misc/</span>patches<span class="regexp">/iconv.pl.fake　/</span>var<span class="regexp">/www/</span>cgi-bin<span class="regexp">/openwebmail/</span>shares/iconv.pl</span><br><span class="line"></span><br><span class="line">yum install perl-TimeDate</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Can&#39;t exec /usr/sbin/makeuserdb  No such file or directory</title>
    <url>/2015/03/29/1652/</url>
    <content><![CDATA[<p>需要安装:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">courier</span>-authlib-userdb-<span class="number">0</span>.<span class="number">60</span>.<span class="number">6</span>-<span class="number">2</span>.<span class="number">1</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>没有/lib/ld-linux.so.2 libstdc++.so.6</title>
    <url>/2015/05/25/1651/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install ld-linux.so.<span class="number">2</span> libstdc++.so.<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>if the yum fail,you can use this method.</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> ftp://rpmfind.net/linux/opensuse/distribution/<span class="number">11</span>.<span class="number">1</span>/repo/oss/suse/x<span class="number">86</span>_<span class="number">64</span>/glibc-<span class="number">32</span>bit-<span class="number">2</span>.<span class="number">9</span>-<span class="number">2</span>.<span class="number">3</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ihv glibc-<span class="number">32</span>bit-<span class="number">2</span>.<span class="number">9</span>-<span class="number">2</span>.<span class="number">3</span>.x<span class="number">86</span>_<span class="number">64</span>.rpm</span><br></pre></td></tr></table></figure>

<p>updatedb (update database)</p>
<figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">locate ls-linux.so.2 <span class="function"><span class="keyword">#</span><span class="params">(<span class="variable">check</span> <span class="variable">if</span> <span class="variable">the</span> <span class="variable">file</span> <span class="variable">is</span> <span class="variable">exist</span>)</span></span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Can&#39;t locate ExtUtils/MakeMaker.pm in @INC  Can&#39;t locate Time/HiRes.pm in @INC an&#39;t locate Date/Format.pm in @INC</title>
    <url>/2016/05/16/1654/</url>
    <content><![CDATA[<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install perl-ExtUtils-MakeMaker.x<span class="number">86</span>_<span class="number">64</span></span><br><span class="line"><span class="attribute">yum</span> install perl-Time-HiRes.x<span class="number">86</span>_<span class="number">64</span></span><br></pre></td></tr></table></figure>

<p>基本这类错误都可以用这样的方式解决.</p>
]]></content>
  </entry>
  <entry>
    <title>信创版致信迁移注意事项</title>
    <url>/2021/07/13/1655/</url>
    <content><![CDATA[<p>host映射地址确认：<br>确保/etc/host中有如下映射，不存在会导致启动协同后无法登陆。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="number">166.166</span>.<span class="number">166.25</span> rcx-zookeeper-<span class="keyword">node</span><span class="title">-1</span> rcx-server-<span class="keyword">node</span><span class="title">-1</span> file-fdfs-<span class="keyword">node</span><span class="title">-1</span> file-server-<span class="keyword">node</span><span class="title">-1</span> rtc-server-<span class="keyword">node</span><span class="title">-1</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-1-master</span>  rcx-rcdb-<span class="keyword">node</span><span class="title">-2-master</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-3-master</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-4-master</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-1-vip</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-2-vip</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-3-vip</span> rcx-rcdb-<span class="keyword">node</span><span class="title">-4-vip</span> rce-redis-vip rce-elasticsearch-<span class="keyword">node</span><span class="title">-1</span> rce-mysql-<span class="keyword">node</span><span class="title">-1</span> rce-mysql-vip</span><br></pre></td></tr></table></figure>

<p>关闭防火墙和selinux:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/&quot;</span> /etc/selinux<span class="built_in">/config </span>&amp;&amp; setenfoce 0</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure>

<p>手动安装supervisor:<br>脚本无法自动安装supervisor，不配置supervisor启动会失败。</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> /opt/ansible-master/packages/middleware</span><br><span class="line"><span class="attribute">rpm</span> -ivh python<span class="number">3</span>-meld<span class="number">3</span>-<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>-<span class="number">2</span>.ky<span class="number">10</span>.noarch.rpm</span><br><span class="line"><span class="attribute">rpm</span> -ivh supervisor-<span class="number">4</span>.<span class="number">0</span>.<span class="number">4</span>-<span class="number">3</span>.ky<span class="number">10</span>.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>检查是否安装成功,存在即为安装成功：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ll <span class="regexp">/usr/</span>bin/supervisord</span><br></pre></td></tr></table></figure>
<p>安装完成后，将原服务器supervisord配置文件覆盖到新服务器。</p>
<p>修正库文件错误路径:<br>默认库文件路径错误，不修复fastdfs启动会失败。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/usr/</span>lib<span class="regexp">/libfastcommon.so /u</span>sr<span class="regexp">/lib64/</span></span><br></pre></td></tr></table></figure>
<p>迁移需要将旧服务器的/usr/lib64/libfastcommon.so拷贝到新服务器对应目录。</p>
<p>主机名配置:<br>需要设置主机名为rcx-server-node-1，否则nginx会启动失败。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">hostname rcx-server-<span class="keyword">node</span><span class="title">-1</span></span><br><span class="line">echo &#x27;rcx-server-<span class="keyword">node</span><span class="title">-1</span>&#x27; &gt; /etc/hostname</span><br></pre></td></tr></table></figure>

<p>服务确认:<br>启动协同版致信。</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cd <span class="regexp">/rcloud/</span>logs</span><br><span class="line"><span class="keyword">grep</span> -r -e <span class="string">&#x27;error&#x27;</span> &amp;&amp; <span class="keyword">grep</span> -r -e <span class="string">&#x27;ERROR&#x27;</span></span><br></pre></td></tr></table></figure>
<p>没有错误日志为启动成功。</p>
]]></content>
  </entry>
</search>
